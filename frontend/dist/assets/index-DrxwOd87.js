var wne=Object.defineProperty;var Sne=(e,t,r)=>t in e?wne(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var dv=(e,t,r)=>Sne(e,typeof t!="symbol"?t+"":t,r);function Ene(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const a in n)if(a!=="default"&&!(a in e)){const u=Object.getOwnPropertyDescriptor(n,a);u&&Object.defineProperty(e,a,u.get?u:{enumerable:!0,get:()=>n[a]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const u of a)if(u.type==="childList")for(const f of u.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&n(f)}).observe(document,{childList:!0,subtree:!0});function r(a){const u={};return a.integrity&&(u.integrity=a.integrity),a.referrerPolicy&&(u.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?u.credentials="include":a.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function n(a){if(a.ep)return;a.ep=!0;const u=r(a);fetch(a.href,u)}})();var Wu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function vs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Tne(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var a=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,a.get?a:{enumerable:!0,get:function(){return e[n]}})}),r}var dC={exports:{}},j0={},hC={exports:{}},Bi={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var NF;function Cne(){if(NF)return Bi;NF=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),u=Symbol.for("react.provider"),f=Symbol.for("react.context"),i=Symbol.for("react.forward_ref"),y=Symbol.for("react.suspense"),w=Symbol.for("react.memo"),T=Symbol.for("react.lazy"),A=Symbol.iterator;function k(De){return De===null||typeof De!="object"?null:(De=A&&De[A]||De["@@iterator"],typeof De=="function"?De:null)}var F={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},D=Object.assign,O={};function N(De,Ke,lt){this.props=De,this.context=Ke,this.refs=O,this.updater=lt||F}N.prototype.isReactComponent={},N.prototype.setState=function(De,Ke){if(typeof De!="object"&&typeof De!="function"&&De!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,De,Ke,"setState")},N.prototype.forceUpdate=function(De){this.updater.enqueueForceUpdate(this,De,"forceUpdate")};function V(){}V.prototype=N.prototype;function H(De,Ke,lt){this.props=De,this.context=Ke,this.refs=O,this.updater=lt||F}var Z=H.prototype=new V;Z.constructor=H,D(Z,N.prototype),Z.isPureReactComponent=!0;var J=Array.isArray,G=Object.prototype.hasOwnProperty,Y={current:null},ie={key:!0,ref:!0,__self:!0,__source:!0};function ce(De,Ke,lt){var Ye,Ve={},Et=null,kt=null;if(Ke!=null)for(Ye in Ke.ref!==void 0&&(kt=Ke.ref),Ke.key!==void 0&&(Et=""+Ke.key),Ke)G.call(Ke,Ye)&&!ie.hasOwnProperty(Ye)&&(Ve[Ye]=Ke[Ye]);var Wt=arguments.length-2;if(Wt===1)Ve.children=lt;else if(1<Wt){for(var Tt=Array(Wt),Ht=0;Ht<Wt;Ht++)Tt[Ht]=arguments[Ht+2];Ve.children=Tt}if(De&&De.defaultProps)for(Ye in Wt=De.defaultProps,Wt)Ve[Ye]===void 0&&(Ve[Ye]=Wt[Ye]);return{$$typeof:e,type:De,key:Et,ref:kt,props:Ve,_owner:Y.current}}function ge(De,Ke){return{$$typeof:e,type:De.type,key:Ke,ref:De.ref,props:De.props,_owner:De._owner}}function be(De){return typeof De=="object"&&De!==null&&De.$$typeof===e}function xe(De){var Ke={"=":"=0",":":"=2"};return"$"+De.replace(/[=:]/g,function(lt){return Ke[lt]})}var Le=/\/+/g;function ze(De,Ke){return typeof De=="object"&&De!==null&&De.key!=null?xe(""+De.key):Ke.toString(36)}function Xe(De,Ke,lt,Ye,Ve){var Et=typeof De;(Et==="undefined"||Et==="boolean")&&(De=null);var kt=!1;if(De===null)kt=!0;else switch(Et){case"string":case"number":kt=!0;break;case"object":switch(De.$$typeof){case e:case t:kt=!0}}if(kt)return kt=De,Ve=Ve(kt),De=Ye===""?"."+ze(kt,0):Ye,J(Ve)?(lt="",De!=null&&(lt=De.replace(Le,"$&/")+"/"),Xe(Ve,Ke,lt,"",function(Ht){return Ht})):Ve!=null&&(be(Ve)&&(Ve=ge(Ve,lt+(!Ve.key||kt&&kt.key===Ve.key?"":(""+Ve.key).replace(Le,"$&/")+"/")+De)),Ke.push(Ve)),1;if(kt=0,Ye=Ye===""?".":Ye+":",J(De))for(var Wt=0;Wt<De.length;Wt++){Et=De[Wt];var Tt=Ye+ze(Et,Wt);kt+=Xe(Et,Ke,lt,Tt,Ve)}else if(Tt=k(De),typeof Tt=="function")for(De=Tt.call(De),Wt=0;!(Et=De.next()).done;)Et=Et.value,Tt=Ye+ze(Et,Wt++),kt+=Xe(Et,Ke,lt,Tt,Ve);else if(Et==="object")throw Ke=String(De),Error("Objects are not valid as a React child (found: "+(Ke==="[object Object]"?"object with keys {"+Object.keys(De).join(", ")+"}":Ke)+"). If you meant to render a collection of children, use an array instead.");return kt}function Je(De,Ke,lt){if(De==null)return De;var Ye=[],Ve=0;return Xe(De,Ye,"","",function(Et){return Ke.call(lt,Et,Ve++)}),Ye}function tt(De){if(De._status===-1){var Ke=De._result;Ke=Ke(),Ke.then(function(lt){(De._status===0||De._status===-1)&&(De._status=1,De._result=lt)},function(lt){(De._status===0||De._status===-1)&&(De._status=2,De._result=lt)}),De._status===-1&&(De._status=0,De._result=Ke)}if(De._status===1)return De._result.default;throw De._result}var st={current:null},Ne={transition:null},We={ReactCurrentDispatcher:st,ReactCurrentBatchConfig:Ne,ReactCurrentOwner:Y};function Ue(){throw Error("act(...) is not supported in production builds of React.")}return Bi.Children={map:Je,forEach:function(De,Ke,lt){Je(De,function(){Ke.apply(this,arguments)},lt)},count:function(De){var Ke=0;return Je(De,function(){Ke++}),Ke},toArray:function(De){return Je(De,function(Ke){return Ke})||[]},only:function(De){if(!be(De))throw Error("React.Children.only expected to receive a single React element child.");return De}},Bi.Component=N,Bi.Fragment=r,Bi.Profiler=a,Bi.PureComponent=H,Bi.StrictMode=n,Bi.Suspense=y,Bi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=We,Bi.act=Ue,Bi.cloneElement=function(De,Ke,lt){if(De==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+De+".");var Ye=D({},De.props),Ve=De.key,Et=De.ref,kt=De._owner;if(Ke!=null){if(Ke.ref!==void 0&&(Et=Ke.ref,kt=Y.current),Ke.key!==void 0&&(Ve=""+Ke.key),De.type&&De.type.defaultProps)var Wt=De.type.defaultProps;for(Tt in Ke)G.call(Ke,Tt)&&!ie.hasOwnProperty(Tt)&&(Ye[Tt]=Ke[Tt]===void 0&&Wt!==void 0?Wt[Tt]:Ke[Tt])}var Tt=arguments.length-2;if(Tt===1)Ye.children=lt;else if(1<Tt){Wt=Array(Tt);for(var Ht=0;Ht<Tt;Ht++)Wt[Ht]=arguments[Ht+2];Ye.children=Wt}return{$$typeof:e,type:De.type,key:Ve,ref:Et,props:Ye,_owner:kt}},Bi.createContext=function(De){return De={$$typeof:f,_currentValue:De,_currentValue2:De,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},De.Provider={$$typeof:u,_context:De},De.Consumer=De},Bi.createElement=ce,Bi.createFactory=function(De){var Ke=ce.bind(null,De);return Ke.type=De,Ke},Bi.createRef=function(){return{current:null}},Bi.forwardRef=function(De){return{$$typeof:i,render:De}},Bi.isValidElement=be,Bi.lazy=function(De){return{$$typeof:T,_payload:{_status:-1,_result:De},_init:tt}},Bi.memo=function(De,Ke){return{$$typeof:w,type:De,compare:Ke===void 0?null:Ke}},Bi.startTransition=function(De){var Ke=Ne.transition;Ne.transition={};try{De()}finally{Ne.transition=Ke}},Bi.unstable_act=Ue,Bi.useCallback=function(De,Ke){return st.current.useCallback(De,Ke)},Bi.useContext=function(De){return st.current.useContext(De)},Bi.useDebugValue=function(){},Bi.useDeferredValue=function(De){return st.current.useDeferredValue(De)},Bi.useEffect=function(De,Ke){return st.current.useEffect(De,Ke)},Bi.useId=function(){return st.current.useId()},Bi.useImperativeHandle=function(De,Ke,lt){return st.current.useImperativeHandle(De,Ke,lt)},Bi.useInsertionEffect=function(De,Ke){return st.current.useInsertionEffect(De,Ke)},Bi.useLayoutEffect=function(De,Ke){return st.current.useLayoutEffect(De,Ke)},Bi.useMemo=function(De,Ke){return st.current.useMemo(De,Ke)},Bi.useReducer=function(De,Ke,lt){return st.current.useReducer(De,Ke,lt)},Bi.useRef=function(De){return st.current.useRef(De)},Bi.useState=function(De){return st.current.useState(De)},Bi.useSyncExternalStore=function(De,Ke,lt){return st.current.useSyncExternalStore(De,Ke,lt)},Bi.useTransition=function(){return st.current.useTransition()},Bi.version="18.3.1",Bi}var zF;function OE(){return zF||(zF=1,hC.exports=Cne()),hC.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var FF;function Ane(){if(FF)return j0;FF=1;var e=OE(),t=Symbol.for("react.element"),r=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,a=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function f(i,y,w){var T,A={},k=null,F=null;w!==void 0&&(k=""+w),y.key!==void 0&&(k=""+y.key),y.ref!==void 0&&(F=y.ref);for(T in y)n.call(y,T)&&!u.hasOwnProperty(T)&&(A[T]=y[T]);if(i&&i.defaultProps)for(T in y=i.defaultProps,y)A[T]===void 0&&(A[T]=y[T]);return{$$typeof:t,type:i,key:k,ref:F,props:A,_owner:a.current}}return j0.Fragment=r,j0.jsx=f,j0.jsxs=f,j0}var BF;function Pne(){return BF||(BF=1,dC.exports=Ane()),dC.exports}var b=Pne();const Mne=console.warn;console.warn=(...e)=>{const t=e[0];typeof t=="string"&&(t.includes("-ms-high-contrast")||t.includes("google.maps")||t.includes("React Router Future Flag")||t.includes("Timeout expired")||t.includes("Erreur de suivi GPS")||t.includes("Précision GPS insuffisante")||t.includes("Erreur lors de la mise à jour GPS")||t.includes("Erreur géolocalisation"))||Mne.apply(console,e)};const Ine=console.error;console.error=(...e)=>{const t=e[0];typeof t=="string"&&(t.includes("google.maps.Marker is deprecated")||t.includes("google.maps.places.SearchBox"))||Ine.apply(console,e)};var j=OE();const jt=vs(j),TR=Ene({__proto__:null,default:jt},[j]);var Q1={},fC={exports:{}},vc={},pC={exports:{}},mC={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $F;function kne(){return $F||($F=1,function(e){function t(Ne,We){var Ue=Ne.length;Ne.push(We);e:for(;0<Ue;){var De=Ue-1>>>1,Ke=Ne[De];if(0<a(Ke,We))Ne[De]=We,Ne[Ue]=Ke,Ue=De;else break e}}function r(Ne){return Ne.length===0?null:Ne[0]}function n(Ne){if(Ne.length===0)return null;var We=Ne[0],Ue=Ne.pop();if(Ue!==We){Ne[0]=Ue;e:for(var De=0,Ke=Ne.length,lt=Ke>>>1;De<lt;){var Ye=2*(De+1)-1,Ve=Ne[Ye],Et=Ye+1,kt=Ne[Et];if(0>a(Ve,Ue))Et<Ke&&0>a(kt,Ve)?(Ne[De]=kt,Ne[Et]=Ue,De=Et):(Ne[De]=Ve,Ne[Ye]=Ue,De=Ye);else if(Et<Ke&&0>a(kt,Ue))Ne[De]=kt,Ne[Et]=Ue,De=Et;else break e}}return We}function a(Ne,We){var Ue=Ne.sortIndex-We.sortIndex;return Ue!==0?Ue:Ne.id-We.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;e.unstable_now=function(){return u.now()}}else{var f=Date,i=f.now();e.unstable_now=function(){return f.now()-i}}var y=[],w=[],T=1,A=null,k=3,F=!1,D=!1,O=!1,N=typeof setTimeout=="function"?setTimeout:null,V=typeof clearTimeout=="function"?clearTimeout:null,H=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Z(Ne){for(var We=r(w);We!==null;){if(We.callback===null)n(w);else if(We.startTime<=Ne)n(w),We.sortIndex=We.expirationTime,t(y,We);else break;We=r(w)}}function J(Ne){if(O=!1,Z(Ne),!D)if(r(y)!==null)D=!0,tt(G);else{var We=r(w);We!==null&&st(J,We.startTime-Ne)}}function G(Ne,We){D=!1,O&&(O=!1,V(ce),ce=-1),F=!0;var Ue=k;try{for(Z(We),A=r(y);A!==null&&(!(A.expirationTime>We)||Ne&&!xe());){var De=A.callback;if(typeof De=="function"){A.callback=null,k=A.priorityLevel;var Ke=De(A.expirationTime<=We);We=e.unstable_now(),typeof Ke=="function"?A.callback=Ke:A===r(y)&&n(y),Z(We)}else n(y);A=r(y)}if(A!==null)var lt=!0;else{var Ye=r(w);Ye!==null&&st(J,Ye.startTime-We),lt=!1}return lt}finally{A=null,k=Ue,F=!1}}var Y=!1,ie=null,ce=-1,ge=5,be=-1;function xe(){return!(e.unstable_now()-be<ge)}function Le(){if(ie!==null){var Ne=e.unstable_now();be=Ne;var We=!0;try{We=ie(!0,Ne)}finally{We?ze():(Y=!1,ie=null)}}else Y=!1}var ze;if(typeof H=="function")ze=function(){H(Le)};else if(typeof MessageChannel<"u"){var Xe=new MessageChannel,Je=Xe.port2;Xe.port1.onmessage=Le,ze=function(){Je.postMessage(null)}}else ze=function(){N(Le,0)};function tt(Ne){ie=Ne,Y||(Y=!0,ze())}function st(Ne,We){ce=N(function(){Ne(e.unstable_now())},We)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(Ne){Ne.callback=null},e.unstable_continueExecution=function(){D||F||(D=!0,tt(G))},e.unstable_forceFrameRate=function(Ne){0>Ne||125<Ne?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ge=0<Ne?Math.floor(1e3/Ne):5},e.unstable_getCurrentPriorityLevel=function(){return k},e.unstable_getFirstCallbackNode=function(){return r(y)},e.unstable_next=function(Ne){switch(k){case 1:case 2:case 3:var We=3;break;default:We=k}var Ue=k;k=We;try{return Ne()}finally{k=Ue}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(Ne,We){switch(Ne){case 1:case 2:case 3:case 4:case 5:break;default:Ne=3}var Ue=k;k=Ne;try{return We()}finally{k=Ue}},e.unstable_scheduleCallback=function(Ne,We,Ue){var De=e.unstable_now();switch(typeof Ue=="object"&&Ue!==null?(Ue=Ue.delay,Ue=typeof Ue=="number"&&0<Ue?De+Ue:De):Ue=De,Ne){case 1:var Ke=-1;break;case 2:Ke=250;break;case 5:Ke=1073741823;break;case 4:Ke=1e4;break;default:Ke=5e3}return Ke=Ue+Ke,Ne={id:T++,callback:We,priorityLevel:Ne,startTime:Ue,expirationTime:Ke,sortIndex:-1},Ue>De?(Ne.sortIndex=Ue,t(w,Ne),r(y)===null&&Ne===r(w)&&(O?(V(ce),ce=-1):O=!0,st(J,Ue-De))):(Ne.sortIndex=Ke,t(y,Ne),D||F||(D=!0,tt(G))),Ne},e.unstable_shouldYield=xe,e.unstable_wrapCallback=function(Ne){var We=k;return function(){var Ue=k;k=We;try{return Ne.apply(this,arguments)}finally{k=Ue}}}}(mC)),mC}var VF;function One(){return VF||(VF=1,pC.exports=kne()),pC.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var UF;function Lne(){if(UF)return vc;UF=1;var e=OE(),t=One();function r(_){for(var E="https://reactjs.org/docs/error-decoder.html?invariant="+_,z=1;z<arguments.length;z++)E+="&args[]="+encodeURIComponent(arguments[z]);return"Minified React error #"+_+"; visit "+E+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=new Set,a={};function u(_,E){f(_,E),f(_+"Capture",E)}function f(_,E){for(a[_]=E,_=0;_<E.length;_++)n.add(E[_])}var i=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),y=Object.prototype.hasOwnProperty,w=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,T={},A={};function k(_){return y.call(A,_)?!0:y.call(T,_)?!1:w.test(_)?A[_]=!0:(T[_]=!0,!1)}function F(_,E,z,K){if(z!==null&&z.type===0)return!1;switch(typeof E){case"function":case"symbol":return!0;case"boolean":return K?!1:z!==null?!z.acceptsBooleans:(_=_.toLowerCase().slice(0,5),_!=="data-"&&_!=="aria-");default:return!1}}function D(_,E,z,K){if(E===null||typeof E>"u"||F(_,E,z,K))return!0;if(K)return!1;if(z!==null)switch(z.type){case 3:return!E;case 4:return E===!1;case 5:return isNaN(E);case 6:return isNaN(E)||1>E}return!1}function O(_,E,z,K,se,me,Re){this.acceptsBooleans=E===2||E===3||E===4,this.attributeName=K,this.attributeNamespace=se,this.mustUseProperty=z,this.propertyName=_,this.type=E,this.sanitizeURL=me,this.removeEmptyString=Re}var N={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(_){N[_]=new O(_,0,!1,_,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(_){var E=_[0];N[E]=new O(E,1,!1,_[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(_){N[_]=new O(_,2,!1,_.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(_){N[_]=new O(_,2,!1,_,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(_){N[_]=new O(_,3,!1,_.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(_){N[_]=new O(_,3,!0,_,null,!1,!1)}),["capture","download"].forEach(function(_){N[_]=new O(_,4,!1,_,null,!1,!1)}),["cols","rows","size","span"].forEach(function(_){N[_]=new O(_,6,!1,_,null,!1,!1)}),["rowSpan","start"].forEach(function(_){N[_]=new O(_,5,!1,_.toLowerCase(),null,!1,!1)});var V=/[\-:]([a-z])/g;function H(_){return _[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(_){var E=_.replace(V,H);N[E]=new O(E,1,!1,_,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(_){var E=_.replace(V,H);N[E]=new O(E,1,!1,_,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(_){var E=_.replace(V,H);N[E]=new O(E,1,!1,_,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(_){N[_]=new O(_,1,!1,_.toLowerCase(),null,!1,!1)}),N.xlinkHref=new O("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(_){N[_]=new O(_,1,!1,_.toLowerCase(),null,!0,!0)});function Z(_,E,z,K){var se=N.hasOwnProperty(E)?N[E]:null;(se!==null?se.type!==0:K||!(2<E.length)||E[0]!=="o"&&E[0]!=="O"||E[1]!=="n"&&E[1]!=="N")&&(D(E,z,se,K)&&(z=null),K||se===null?k(E)&&(z===null?_.removeAttribute(E):_.setAttribute(E,""+z)):se.mustUseProperty?_[se.propertyName]=z===null?se.type===3?!1:"":z:(E=se.attributeName,K=se.attributeNamespace,z===null?_.removeAttribute(E):(se=se.type,z=se===3||se===4&&z===!0?"":""+z,K?_.setAttributeNS(K,E,z):_.setAttribute(E,z))))}var J=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,G=Symbol.for("react.element"),Y=Symbol.for("react.portal"),ie=Symbol.for("react.fragment"),ce=Symbol.for("react.strict_mode"),ge=Symbol.for("react.profiler"),be=Symbol.for("react.provider"),xe=Symbol.for("react.context"),Le=Symbol.for("react.forward_ref"),ze=Symbol.for("react.suspense"),Xe=Symbol.for("react.suspense_list"),Je=Symbol.for("react.memo"),tt=Symbol.for("react.lazy"),st=Symbol.for("react.offscreen"),Ne=Symbol.iterator;function We(_){return _===null||typeof _!="object"?null:(_=Ne&&_[Ne]||_["@@iterator"],typeof _=="function"?_:null)}var Ue=Object.assign,De;function Ke(_){if(De===void 0)try{throw Error()}catch(z){var E=z.stack.trim().match(/\n( *(at )?)/);De=E&&E[1]||""}return`
`+De+_}var lt=!1;function Ye(_,E){if(!_||lt)return"";lt=!0;var z=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(E)if(E=function(){throw Error()},Object.defineProperty(E.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(E,[])}catch(nr){var K=nr}Reflect.construct(_,[],E)}else{try{E.call()}catch(nr){K=nr}_.call(E.prototype)}else{try{throw Error()}catch(nr){K=nr}_()}}catch(nr){if(nr&&K&&typeof nr.stack=="string"){for(var se=nr.stack.split(`
`),me=K.stack.split(`
`),Re=se.length-1,ht=me.length-1;1<=Re&&0<=ht&&se[Re]!==me[ht];)ht--;for(;1<=Re&&0<=ht;Re--,ht--)if(se[Re]!==me[ht]){if(Re!==1||ht!==1)do if(Re--,ht--,0>ht||se[Re]!==me[ht]){var bt=`
`+se[Re].replace(" at new "," at ");return _.displayName&&bt.includes("<anonymous>")&&(bt=bt.replace("<anonymous>",_.displayName)),bt}while(1<=Re&&0<=ht);break}}}finally{lt=!1,Error.prepareStackTrace=z}return(_=_?_.displayName||_.name:"")?Ke(_):""}function Ve(_){switch(_.tag){case 5:return Ke(_.type);case 16:return Ke("Lazy");case 13:return Ke("Suspense");case 19:return Ke("SuspenseList");case 0:case 2:case 15:return _=Ye(_.type,!1),_;case 11:return _=Ye(_.type.render,!1),_;case 1:return _=Ye(_.type,!0),_;default:return""}}function Et(_){if(_==null)return null;if(typeof _=="function")return _.displayName||_.name||null;if(typeof _=="string")return _;switch(_){case ie:return"Fragment";case Y:return"Portal";case ge:return"Profiler";case ce:return"StrictMode";case ze:return"Suspense";case Xe:return"SuspenseList"}if(typeof _=="object")switch(_.$$typeof){case xe:return(_.displayName||"Context")+".Consumer";case be:return(_._context.displayName||"Context")+".Provider";case Le:var E=_.render;return _=_.displayName,_||(_=E.displayName||E.name||"",_=_!==""?"ForwardRef("+_+")":"ForwardRef"),_;case Je:return E=_.displayName||null,E!==null?E:Et(_.type)||"Memo";case tt:E=_._payload,_=_._init;try{return Et(_(E))}catch{}}return null}function kt(_){var E=_.type;switch(_.tag){case 24:return"Cache";case 9:return(E.displayName||"Context")+".Consumer";case 10:return(E._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return _=E.render,_=_.displayName||_.name||"",E.displayName||(_!==""?"ForwardRef("+_+")":"ForwardRef");case 7:return"Fragment";case 5:return E;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Et(E);case 8:return E===ce?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof E=="function")return E.displayName||E.name||null;if(typeof E=="string")return E}return null}function Wt(_){switch(typeof _){case"boolean":case"number":case"string":case"undefined":return _;case"object":return _;default:return""}}function Tt(_){var E=_.type;return(_=_.nodeName)&&_.toLowerCase()==="input"&&(E==="checkbox"||E==="radio")}function Ht(_){var E=Tt(_)?"checked":"value",z=Object.getOwnPropertyDescriptor(_.constructor.prototype,E),K=""+_[E];if(!_.hasOwnProperty(E)&&typeof z<"u"&&typeof z.get=="function"&&typeof z.set=="function"){var se=z.get,me=z.set;return Object.defineProperty(_,E,{configurable:!0,get:function(){return se.call(this)},set:function(Re){K=""+Re,me.call(this,Re)}}),Object.defineProperty(_,E,{enumerable:z.enumerable}),{getValue:function(){return K},setValue:function(Re){K=""+Re},stopTracking:function(){_._valueTracker=null,delete _[E]}}}}function ur(_){_._valueTracker||(_._valueTracker=Ht(_))}function Jt(_){if(!_)return!1;var E=_._valueTracker;if(!E)return!0;var z=E.getValue(),K="";return _&&(K=Tt(_)?_.checked?"true":"false":_.value),_=K,_!==z?(E.setValue(_),!0):!1}function Rt(_){if(_=_||(typeof document<"u"?document:void 0),typeof _>"u")return null;try{return _.activeElement||_.body}catch{return _.body}}function Dt(_,E){var z=E.checked;return Ue({},E,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:z??_._wrapperState.initialChecked})}function sr(_,E){var z=E.defaultValue==null?"":E.defaultValue,K=E.checked!=null?E.checked:E.defaultChecked;z=Wt(E.value!=null?E.value:z),_._wrapperState={initialChecked:K,initialValue:z,controlled:E.type==="checkbox"||E.type==="radio"?E.checked!=null:E.value!=null}}function mr(_,E){E=E.checked,E!=null&&Z(_,"checked",E,!1)}function Vr(_,E){mr(_,E);var z=Wt(E.value),K=E.type;if(z!=null)K==="number"?(z===0&&_.value===""||_.value!=z)&&(_.value=""+z):_.value!==""+z&&(_.value=""+z);else if(K==="submit"||K==="reset"){_.removeAttribute("value");return}E.hasOwnProperty("value")?$r(_,E.type,z):E.hasOwnProperty("defaultValue")&&$r(_,E.type,Wt(E.defaultValue)),E.checked==null&&E.defaultChecked!=null&&(_.defaultChecked=!!E.defaultChecked)}function rn(_,E,z){if(E.hasOwnProperty("value")||E.hasOwnProperty("defaultValue")){var K=E.type;if(!(K!=="submit"&&K!=="reset"||E.value!==void 0&&E.value!==null))return;E=""+_._wrapperState.initialValue,z||E===_.value||(_.value=E),_.defaultValue=E}z=_.name,z!==""&&(_.name=""),_.defaultChecked=!!_._wrapperState.initialChecked,z!==""&&(_.name=z)}function $r(_,E,z){(E!=="number"||Rt(_.ownerDocument)!==_)&&(z==null?_.defaultValue=""+_._wrapperState.initialValue:_.defaultValue!==""+z&&(_.defaultValue=""+z))}var Yr=Array.isArray;function un(_,E,z,K){if(_=_.options,E){E={};for(var se=0;se<z.length;se++)E["$"+z[se]]=!0;for(z=0;z<_.length;z++)se=E.hasOwnProperty("$"+_[z].value),_[z].selected!==se&&(_[z].selected=se),se&&K&&(_[z].defaultSelected=!0)}else{for(z=""+Wt(z),E=null,se=0;se<_.length;se++){if(_[se].value===z){_[se].selected=!0,K&&(_[se].defaultSelected=!0);return}E!==null||_[se].disabled||(E=_[se])}E!==null&&(E.selected=!0)}}function Fn(_,E){if(E.dangerouslySetInnerHTML!=null)throw Error(r(91));return Ue({},E,{value:void 0,defaultValue:void 0,children:""+_._wrapperState.initialValue})}function vi(_,E){var z=E.value;if(z==null){if(z=E.children,E=E.defaultValue,z!=null){if(E!=null)throw Error(r(92));if(Yr(z)){if(1<z.length)throw Error(r(93));z=z[0]}E=z}E==null&&(E=""),z=E}_._wrapperState={initialValue:Wt(z)}}function xr(_,E){var z=Wt(E.value),K=Wt(E.defaultValue);z!=null&&(z=""+z,z!==_.value&&(_.value=z),E.defaultValue==null&&_.defaultValue!==z&&(_.defaultValue=z)),K!=null&&(_.defaultValue=""+K)}function Hr(_){var E=_.textContent;E===_._wrapperState.initialValue&&E!==""&&E!==null&&(_.value=E)}function wn(_){switch(_){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function xi(_,E){return _==null||_==="http://www.w3.org/1999/xhtml"?wn(E):_==="http://www.w3.org/2000/svg"&&E==="foreignObject"?"http://www.w3.org/1999/xhtml":_}var ms,Ui=function(_){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(E,z,K,se){MSApp.execUnsafeLocalFunction(function(){return _(E,z,K,se)})}:_}(function(_,E){if(_.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in _)_.innerHTML=E;else{for(ms=ms||document.createElement("div"),ms.innerHTML="<svg>"+E.valueOf().toString()+"</svg>",E=ms.firstChild;_.firstChild;)_.removeChild(_.firstChild);for(;E.firstChild;)_.appendChild(E.firstChild)}});function js(_,E){if(E){var z=_.firstChild;if(z&&z===_.lastChild&&z.nodeType===3){z.nodeValue=E;return}}_.textContent=E}var es={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Uo=["Webkit","ms","Moz","O"];Object.keys(es).forEach(function(_){Uo.forEach(function(E){E=E+_.charAt(0).toUpperCase()+_.substring(1),es[E]=es[_]})});function Ys(_,E,z){return E==null||typeof E=="boolean"||E===""?"":z||typeof E!="number"||E===0||es.hasOwnProperty(_)&&es[_]?(""+E).trim():E+"px"}function Js(_,E){_=_.style;for(var z in E)if(E.hasOwnProperty(z)){var K=z.indexOf("--")===0,se=Ys(z,E[z],K);z==="float"&&(z="cssFloat"),K?_.setProperty(z,se):_[z]=se}}var bo=Ue({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function wo(_,E){if(E){if(bo[_]&&(E.children!=null||E.dangerouslySetInnerHTML!=null))throw Error(r(137,_));if(E.dangerouslySetInnerHTML!=null){if(E.children!=null)throw Error(r(60));if(typeof E.dangerouslySetInnerHTML!="object"||!("__html"in E.dangerouslySetInnerHTML))throw Error(r(61))}if(E.style!=null&&typeof E.style!="object")throw Error(r(62))}}function So(_,E){if(_.indexOf("-")===-1)return typeof E.is=="string";switch(_){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Jn=null;function Ds(_){return _=_.target||_.srcElement||window,_.correspondingUseElement&&(_=_.correspondingUseElement),_.nodeType===3?_.parentNode:_}var Io=null,_s=null,uo=null;function qo(_){if(_=xd(_)){if(typeof Io!="function")throw Error(r(280));var E=_.stateNode;E&&(E=Ah(E),Io(_.stateNode,_.type,E))}}function oa(_){_s?uo?uo.push(_):uo=[_]:_s=_}function Qt(){if(_s){var _=_s,E=uo;if(uo=_s=null,qo(_),E)for(_=0;_<E.length;_++)qo(E[_])}}function Hs(_,E){return _(E)}function Go(){}var dt=!1;function ae(_,E,z){if(dt)return _(E,z);dt=!0;try{return Hs(_,E,z)}finally{dt=!1,(_s!==null||uo!==null)&&(Go(),Qt())}}function oe(_,E){var z=_.stateNode;if(z===null)return null;var K=Ah(z);if(K===null)return null;z=K[E];e:switch(E){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(K=!K.disabled)||(_=_.type,K=!(_==="button"||_==="input"||_==="select"||_==="textarea")),_=!K;break e;default:_=!1}if(_)return null;if(z&&typeof z!="function")throw Error(r(231,E,typeof z));return z}var pe=!1;if(i)try{var $e={};Object.defineProperty($e,"passive",{get:function(){pe=!0}}),window.addEventListener("test",$e,$e),window.removeEventListener("test",$e,$e)}catch{pe=!1}function He(_,E,z,K,se,me,Re,ht,bt){var nr=Array.prototype.slice.call(arguments,3);try{E.apply(z,nr)}catch(Dr){this.onError(Dr)}}var et=!1,rt=null,nt=!1,mt=null,Ct={onError:function(_){et=!0,rt=_}};function pt(_,E,z,K,se,me,Re,ht,bt){et=!1,rt=null,He.apply(Ct,arguments)}function rr(_,E,z,K,se,me,Re,ht,bt){if(pt.apply(this,arguments),et){if(et){var nr=rt;et=!1,rt=null}else throw Error(r(198));nt||(nt=!0,mt=nr)}}function ar(_){var E=_,z=_;if(_.alternate)for(;E.return;)E=E.return;else{_=E;do E=_,(E.flags&4098)!==0&&(z=E.return),_=E.return;while(_)}return E.tag===3?z:null}function gr(_){if(_.tag===13){var E=_.memoizedState;if(E===null&&(_=_.alternate,_!==null&&(E=_.memoizedState)),E!==null)return E.dehydrated}return null}function Ur(_){if(ar(_)!==_)throw Error(r(188))}function Xr(_){var E=_.alternate;if(!E){if(E=ar(_),E===null)throw Error(r(188));return E!==_?null:_}for(var z=_,K=E;;){var se=z.return;if(se===null)break;var me=se.alternate;if(me===null){if(K=se.return,K!==null){z=K;continue}break}if(se.child===me.child){for(me=se.child;me;){if(me===z)return Ur(se),_;if(me===K)return Ur(se),E;me=me.sibling}throw Error(r(188))}if(z.return!==K.return)z=se,K=me;else{for(var Re=!1,ht=se.child;ht;){if(ht===z){Re=!0,z=se,K=me;break}if(ht===K){Re=!0,K=se,z=me;break}ht=ht.sibling}if(!Re){for(ht=me.child;ht;){if(ht===z){Re=!0,z=me,K=se;break}if(ht===K){Re=!0,K=me,z=se;break}ht=ht.sibling}if(!Re)throw Error(r(189))}}if(z.alternate!==K)throw Error(r(190))}if(z.tag!==3)throw Error(r(188));return z.stateNode.current===z?_:E}function Jr(_){return _=Xr(_),_!==null?nn(_):null}function nn(_){if(_.tag===5||_.tag===6)return _;for(_=_.child;_!==null;){var E=nn(_);if(E!==null)return E;_=_.sibling}return null}var Qn=t.unstable_scheduleCallback,sn=t.unstable_cancelCallback,Bn=t.unstable_shouldYield,Tn=t.unstable_requestPaint,on=t.unstable_now,Vn=t.unstable_getCurrentPriorityLevel,li=t.unstable_ImmediatePriority,bi=t.unstable_UserBlockingPriority,Ci=t.unstable_NormalPriority,Ki=t.unstable_LowPriority,Ho=t.unstable_IdlePriority,Qs=null,xs=null;function eo(_){if(xs&&typeof xs.onCommitFiberRoot=="function")try{xs.onCommitFiberRoot(Qs,_,void 0,(_.current.flags&128)===128)}catch{}}var cs=Math.clz32?Math.clz32:gf,$l=Math.log,nd=Math.LN2;function gf(_){return _>>>=0,_===0?32:31-($l(_)/nd|0)|0}var Ac=64,id=4194304;function Pc(_){switch(_&-_){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return _&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return _}}function Vl(_,E){var z=_.pendingLanes;if(z===0)return 0;var K=0,se=_.suspendedLanes,me=_.pingedLanes,Re=z&268435455;if(Re!==0){var ht=Re&~se;ht!==0?K=Pc(ht):(me&=Re,me!==0&&(K=Pc(me)))}else Re=z&~se,Re!==0?K=Pc(Re):me!==0&&(K=Pc(me));if(K===0)return 0;if(E!==0&&E!==K&&(E&se)===0&&(se=K&-K,me=E&-E,se>=me||se===16&&(me&4194240)!==0))return E;if((K&4)!==0&&(K|=z&16),E=_.entangledLanes,E!==0)for(_=_.entanglements,E&=K;0<E;)z=31-cs(E),se=1<<z,K|=_[z],E&=~se;return K}function yf(_,E){switch(_){case 1:case 2:case 4:return E+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return E+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function sg(_,E){for(var z=_.suspendedLanes,K=_.pingedLanes,se=_.expirationTimes,me=_.pendingLanes;0<me;){var Re=31-cs(me),ht=1<<Re,bt=se[Re];bt===-1?((ht&z)===0||(ht&K)!==0)&&(se[Re]=yf(ht,E)):bt<=E&&(_.expiredLanes|=ht),me&=~ht}}function Ia(_){return _=_.pendingLanes&-1073741825,_!==0?_:_&1073741824?1073741824:0}function kp(){var _=Ac;return Ac<<=1,(Ac&4194240)===0&&(Ac=64),_}function Wo(_){for(var E=[],z=0;31>z;z++)E.push(_);return E}function aa(_,E,z){_.pendingLanes|=E,E!==536870912&&(_.suspendedLanes=0,_.pingedLanes=0),_=_.eventTimes,E=31-cs(E),_[E]=z}function Mc(_,E){var z=_.pendingLanes&~E;_.pendingLanes=E,_.suspendedLanes=0,_.pingedLanes=0,_.expiredLanes&=E,_.mutableReadLanes&=E,_.entangledLanes&=E,E=_.entanglements;var K=_.eventTimes;for(_=_.expirationTimes;0<z;){var se=31-cs(z),me=1<<se;E[se]=0,K[se]=-1,_[se]=-1,z&=~me}}function ka(_,E){var z=_.entangledLanes|=E;for(_=_.entanglements;z;){var K=31-cs(z),se=1<<K;se&E|_[K]&E&&(_[K]|=E),z&=~se}}var wi=0;function Oa(_){return _&=-_,1<_?4<_?(_&268435455)!==0?16:536870912:4:1}var nh,vf,Ul,ih,Op,sd=!1,ho=[],bl=null,wl=null,La=null,sh=new Map,hu=new Map,Sl=[],Un="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function od(_,E){switch(_){case"focusin":case"focusout":bl=null;break;case"dragenter":case"dragleave":wl=null;break;case"mouseover":case"mouseout":La=null;break;case"pointerover":case"pointerout":sh.delete(E.pointerId);break;case"gotpointercapture":case"lostpointercapture":hu.delete(E.pointerId)}}function ql(_,E,z,K,se,me){return _===null||_.nativeEvent!==me?(_={blockedOn:E,domEventName:z,eventSystemFlags:K,nativeEvent:me,targetContainers:[se]},E!==null&&(E=xd(E),E!==null&&vf(E)),_):(_.eventSystemFlags|=K,E=_.targetContainers,se!==null&&E.indexOf(se)===-1&&E.push(se),_)}function q_(_,E,z,K,se){switch(E){case"focusin":return bl=ql(bl,_,E,z,K,se),!0;case"dragenter":return wl=ql(wl,_,E,z,K,se),!0;case"mouseover":return La=ql(La,_,E,z,K,se),!0;case"pointerover":var me=se.pointerId;return sh.set(me,ql(sh.get(me)||null,_,E,z,K,se)),!0;case"gotpointercapture":return me=se.pointerId,hu.set(me,ql(hu.get(me)||null,_,E,z,K,se)),!0}return!1}function og(_){var E=Bc(_.target);if(E!==null){var z=ar(E);if(z!==null){if(E=z.tag,E===13){if(E=gr(z),E!==null){_.blockedOn=E,Op(_.priority,function(){Ul(z)});return}}else if(E===3&&z.stateNode.current.memoizedState.isDehydrated){_.blockedOn=z.tag===3?z.stateNode.containerInfo:null;return}}}_.blockedOn=null}function Gl(_){if(_.blockedOn!==null)return!1;for(var E=_.targetContainers;0<E.length;){var z=Hl(_.domEventName,_.eventSystemFlags,E[0],_.nativeEvent);if(z===null){z=_.nativeEvent;var K=new z.constructor(z.type,z);Jn=K,z.target.dispatchEvent(K),Jn=null}else return E=xd(z),E!==null&&vf(E),_.blockedOn=z,!1;E.shift()}return!0}function Ic(_,E,z){Gl(_)&&z.delete(E)}function oh(){sd=!1,bl!==null&&Gl(bl)&&(bl=null),wl!==null&&Gl(wl)&&(wl=null),La!==null&&Gl(La)&&(La=null),sh.forEach(Ic),hu.forEach(Ic)}function ah(_,E){_.blockedOn===E&&(_.blockedOn=null,sd||(sd=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,oh)))}function ad(_){function E(se){return ah(se,_)}if(0<ho.length){ah(ho[0],_);for(var z=1;z<ho.length;z++){var K=ho[z];K.blockedOn===_&&(K.blockedOn=null)}}for(bl!==null&&ah(bl,_),wl!==null&&ah(wl,_),La!==null&&ah(La,_),sh.forEach(E),hu.forEach(E),z=0;z<Sl.length;z++)K=Sl[z],K.blockedOn===_&&(K.blockedOn=null);for(;0<Sl.length&&(z=Sl[0],z.blockedOn===null);)og(z),z.blockedOn===null&&Sl.shift()}var Ja=J.ReactCurrentBatchConfig,fu=!0;function lh(_,E,z,K){var se=wi,me=Ja.transition;Ja.transition=null;try{wi=1,_f(_,E,z,K)}finally{wi=se,Ja.transition=me}}function Lp(_,E,z,K){var se=wi,me=Ja.transition;Ja.transition=null;try{wi=4,_f(_,E,z,K)}finally{wi=se,Ja.transition=me}}function _f(_,E,z,K){if(fu){var se=Hl(_,E,z,K);if(se===null)pg(_,E,K,ko,z),od(_,K);else if(q_(se,_,E,z,K))K.stopPropagation();else if(od(_,K),E&4&&-1<Un.indexOf(_)){for(;se!==null;){var me=xd(se);if(me!==null&&nh(me),me=Hl(_,E,z,K),me===null&&pg(_,E,K,ko,z),me===se)break;se=me}se!==null&&K.stopPropagation()}else pg(_,E,K,null,z)}}var ko=null;function Hl(_,E,z,K){if(ko=null,_=Ds(K),_=Bc(_),_!==null)if(E=ar(_),E===null)_=null;else if(z=E.tag,z===13){if(_=gr(E),_!==null)return _;_=null}else if(z===3){if(E.stateNode.current.memoizedState.isDehydrated)return E.tag===3?E.stateNode.containerInfo:null;_=null}else E!==_&&(_=null);return ko=_,null}function Rp(_){switch(_){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Vn()){case li:return 1;case bi:return 4;case Ci:case Ki:return 16;case Ho:return 536870912;default:return 16}default:return 16}}var Wl=null,ch=null,Zl=null;function la(){if(Zl)return Zl;var _,E=ch,z=E.length,K,se="value"in Wl?Wl.value:Wl.textContent,me=se.length;for(_=0;_<z&&E[_]===se[_];_++);var Re=z-_;for(K=1;K<=Re&&E[z-K]===se[me-K];K++);return Zl=se.slice(_,1<K?1-K:void 0)}function uh(_){var E=_.keyCode;return"charCode"in _?(_=_.charCode,_===0&&E===13&&(_=13)):_=E,_===10&&(_=13),32<=_||_===13?_:0}function ld(){return!0}function dh(){return!1}function Pn(_){function E(z,K,se,me,Re){this._reactName=z,this._targetInst=se,this.type=K,this.nativeEvent=me,this.target=Re,this.currentTarget=null;for(var ht in _)_.hasOwnProperty(ht)&&(z=_[ht],this[ht]=z?z(me):me[ht]);return this.isDefaultPrevented=(me.defaultPrevented!=null?me.defaultPrevented:me.returnValue===!1)?ld:dh,this.isPropagationStopped=dh,this}return Ue(E.prototype,{preventDefault:function(){this.defaultPrevented=!0;var z=this.nativeEvent;z&&(z.preventDefault?z.preventDefault():typeof z.returnValue!="unknown"&&(z.returnValue=!1),this.isDefaultPrevented=ld)},stopPropagation:function(){var z=this.nativeEvent;z&&(z.stopPropagation?z.stopPropagation():typeof z.cancelBubble!="unknown"&&(z.cancelBubble=!0),this.isPropagationStopped=ld)},persist:function(){},isPersistent:ld}),E}var cd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(_){return _.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Br=Pn(cd),hh=Ue({},cd,{view:0,detail:0}),jp=Pn(hh),fh,ud,Zo,Xl=Ue({},hh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:mu,button:0,buttons:0,relatedTarget:function(_){return _.relatedTarget===void 0?_.fromElement===_.srcElement?_.toElement:_.fromElement:_.relatedTarget},movementX:function(_){return"movementX"in _?_.movementX:(_!==Zo&&(Zo&&_.type==="mousemove"?(fh=_.screenX-Zo.screenX,ud=_.screenY-Zo.screenY):ud=fh=0,Zo=_),fh)},movementY:function(_){return"movementY"in _?_.movementY:ud}}),kc=Pn(Xl),Rr=Ue({},Xl,{dataTransfer:0}),hi=Pn(Rr),ri=Ue({},hh,{relatedTarget:0}),Oo=Pn(ri),pu=Ue({},cd,{animationName:0,elapsedTime:0,pseudoElement:0}),ei=Pn(pu),dd=Ue({},cd,{clipboardData:function(_){return"clipboardData"in _?_.clipboardData:window.clipboardData}}),xf=Pn(dd),bf=Ue({},cd,{data:0}),Lo=Pn(bf),Ps={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},G_={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wf={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ag(_){var E=this.nativeEvent;return E.getModifierState?E.getModifierState(_):(_=wf[_])?!!E[_]:!1}function mu(){return ag}var gu=Ue({},hh,{key:function(_){if(_.key){var E=Ps[_.key]||_.key;if(E!=="Unidentified")return E}return _.type==="keypress"?(_=uh(_),_===13?"Enter":String.fromCharCode(_)):_.type==="keydown"||_.type==="keyup"?G_[_.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:mu,charCode:function(_){return _.type==="keypress"?uh(_):0},keyCode:function(_){return _.type==="keydown"||_.type==="keyup"?_.keyCode:0},which:function(_){return _.type==="keypress"?uh(_):_.type==="keydown"||_.type==="keyup"?_.keyCode:0}}),Dp=Pn(gu),Xo=Ue({},Xl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Qa=Pn(Xo),ca=Ue({},hh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:mu}),zy=Pn(ca),ph=Ue({},cd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Fs=Pn(ph),Ko=Ue({},Xl,{deltaX:function(_){return"deltaX"in _?_.deltaX:"wheelDeltaX"in _?-_.wheelDeltaX:0},deltaY:function(_){return"deltaY"in _?_.deltaY:"wheelDeltaY"in _?-_.wheelDeltaY:"wheelDelta"in _?-_.wheelDelta:0},deltaZ:0,deltaMode:0}),gn=Pn(Ko),Er=[9,13,27,32],hd=i&&"CompositionEvent"in window,qr=null;i&&"documentMode"in document&&(qr=document.documentMode);var fd=i&&"TextEvent"in window&&!qr,pd=i&&(!hd||qr&&8<qr&&11>=qr),Zr=" ",lg=!1;function el(_,E){switch(_){case"keyup":return Er.indexOf(E.keyCode)!==-1;case"keydown":return E.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function cg(_){return _=_.detail,typeof _=="object"&&"data"in _?_.data:null}var Oc=!1;function Ro(_,E){switch(_){case"compositionend":return cg(E);case"keypress":return E.which!==32?null:(lg=!0,Zr);case"textInput":return _=E.data,_===Zr&&lg?null:_;default:return null}}function Yo(_,E){if(Oc)return _==="compositionend"||!hd&&el(_,E)?(_=la(),Zl=ch=Wl=null,Oc=!1,_):null;switch(_){case"paste":return null;case"keypress":if(!(E.ctrlKey||E.altKey||E.metaKey)||E.ctrlKey&&E.altKey){if(E.char&&1<E.char.length)return E.char;if(E.which)return String.fromCharCode(E.which)}return null;case"compositionend":return pd&&E.locale!=="ko"?null:E.data;default:return null}}var mh={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Lc(_){var E=_&&_.nodeName&&_.nodeName.toLowerCase();return E==="input"?!!mh[_.type]:E==="textarea"}function yu(_,E,z,K){oa(K),E=wh(E,"onChange"),0<E.length&&(z=new Br("onChange","change",null,z,K),_.push({event:z,listeners:E}))}var El=null,to=null;function Sf(_){Uy(_,0)}function vu(_){var E=Tu(_);if(Jt(E))return _}function H_(_,E){if(_==="change")return E}var Kl=!1;if(i){var Ef;if(i){var tl="oninput"in document;if(!tl){var Np=document.createElement("div");Np.setAttribute("oninput","return;"),tl=typeof Np.oninput=="function"}Ef=tl}else Ef=!1;Kl=Ef&&(!document.documentMode||9<document.documentMode)}function Rc(){El&&(El.detachEvent("onpropertychange",Fy),to=El=null)}function Fy(_){if(_.propertyName==="value"&&vu(to)){var E=[];yu(E,to,_,Ds(_)),ae(Sf,E)}}function W_(_,E,z){_==="focusin"?(Rc(),El=E,to=z,El.attachEvent("onpropertychange",Fy)):_==="focusout"&&Rc()}function By(_){if(_==="selectionchange"||_==="keyup"||_==="keydown")return vu(to)}function $y(_,E){if(_==="click")return vu(E)}function Z_(_,E){if(_==="input"||_==="change")return vu(E)}function zp(_,E){return _===E&&(_!==0||1/_===1/E)||_!==_&&E!==E}var rl=typeof Object.is=="function"?Object.is:zp;function nl(_,E){if(rl(_,E))return!0;if(typeof _!="object"||_===null||typeof E!="object"||E===null)return!1;var z=Object.keys(_),K=Object.keys(E);if(z.length!==K.length)return!1;for(K=0;K<z.length;K++){var se=z[K];if(!y.call(E,se)||!rl(_[se],E[se]))return!1}return!0}function ug(_){for(;_&&_.firstChild;)_=_.firstChild;return _}function dg(_,E){var z=ug(_);_=0;for(var K;z;){if(z.nodeType===3){if(K=_+z.textContent.length,_<=E&&K>=E)return{node:z,offset:E-_};_=K}e:{for(;z;){if(z.nextSibling){z=z.nextSibling;break e}z=z.parentNode}z=void 0}z=ug(z)}}function Yl(_,E){return _&&E?_===E?!0:_&&_.nodeType===3?!1:E&&E.nodeType===3?Yl(_,E.parentNode):"contains"in _?_.contains(E):_.compareDocumentPosition?!!(_.compareDocumentPosition(E)&16):!1:!1}function gh(){for(var _=window,E=Rt();E instanceof _.HTMLIFrameElement;){try{var z=typeof E.contentWindow.location.href=="string"}catch{z=!1}if(z)_=E.contentWindow;else break;E=Rt(_.document)}return E}function Tf(_){var E=_&&_.nodeName&&_.nodeName.toLowerCase();return E&&(E==="input"&&(_.type==="text"||_.type==="search"||_.type==="tel"||_.type==="url"||_.type==="password")||E==="textarea"||_.contentEditable==="true")}function il(_){var E=gh(),z=_.focusedElem,K=_.selectionRange;if(E!==z&&z&&z.ownerDocument&&Yl(z.ownerDocument.documentElement,z)){if(K!==null&&Tf(z)){if(E=K.start,_=K.end,_===void 0&&(_=E),"selectionStart"in z)z.selectionStart=E,z.selectionEnd=Math.min(_,z.value.length);else if(_=(E=z.ownerDocument||document)&&E.defaultView||window,_.getSelection){_=_.getSelection();var se=z.textContent.length,me=Math.min(K.start,se);K=K.end===void 0?me:Math.min(K.end,se),!_.extend&&me>K&&(se=K,K=me,me=se),se=dg(z,me);var Re=dg(z,K);se&&Re&&(_.rangeCount!==1||_.anchorNode!==se.node||_.anchorOffset!==se.offset||_.focusNode!==Re.node||_.focusOffset!==Re.offset)&&(E=E.createRange(),E.setStart(se.node,se.offset),_.removeAllRanges(),me>K?(_.addRange(E),_.extend(Re.node,Re.offset)):(E.setEnd(Re.node,Re.offset),_.addRange(E)))}}for(E=[],_=z;_=_.parentNode;)_.nodeType===1&&E.push({element:_,left:_.scrollLeft,top:_.scrollTop});for(typeof z.focus=="function"&&z.focus(),z=0;z<E.length;z++)_=E[z],_.element.scrollLeft=_.left,_.element.scrollTop=_.top}}var yh=i&&"documentMode"in document&&11>=document.documentMode,Tl=null,Cf=null,_u=null,ua=!1;function Af(_,E,z){var K=z.window===z?z.document:z.nodeType===9?z:z.ownerDocument;ua||Tl==null||Tl!==Rt(K)||(K=Tl,"selectionStart"in K&&Tf(K)?K={start:K.selectionStart,end:K.selectionEnd}:(K=(K.ownerDocument&&K.ownerDocument.defaultView||window).getSelection(),K={anchorNode:K.anchorNode,anchorOffset:K.anchorOffset,focusNode:K.focusNode,focusOffset:K.focusOffset}),_u&&nl(_u,K)||(_u=K,K=wh(Cf,"onSelect"),0<K.length&&(E=new Br("onSelect","select",null,E,z),_.push({event:E,listeners:K}),E.target=Tl)))}function or(_,E){var z={};return z[_.toLowerCase()]=E.toLowerCase(),z["Webkit"+_]="webkit"+E,z["Moz"+_]="moz"+E,z}var xu={animationend:or("Animation","AnimationEnd"),animationiteration:or("Animation","AnimationIteration"),animationstart:or("Animation","AnimationStart"),transitionend:or("Transition","TransitionEnd")},vh={},Pf={};i&&(Pf=document.createElement("div").style,"AnimationEvent"in window||(delete xu.animationend.animation,delete xu.animationiteration.animation,delete xu.animationstart.animation),"TransitionEvent"in window||delete xu.transitionend.transition);function _h(_){if(vh[_])return vh[_];if(!xu[_])return _;var E=xu[_],z;for(z in E)if(E.hasOwnProperty(z)&&z in Pf)return vh[_]=E[z];return _}var bu=_h("animationend"),Ra=_h("animationiteration"),md=_h("animationstart"),jc=_h("transitionend"),xh=new Map,wu="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ja(_,E){xh.set(_,E),u(E,[_])}for(var Dn=0;Dn<wu.length;Dn++){var Mf=wu[Dn],X_=Mf.toLowerCase(),Vy=Mf[0].toUpperCase()+Mf.slice(1);ja(X_,"on"+Vy)}ja(bu,"onAnimationEnd"),ja(Ra,"onAnimationIteration"),ja(md,"onAnimationStart"),ja("dblclick","onDoubleClick"),ja("focusin","onFocus"),ja("focusout","onBlur"),ja(jc,"onTransitionEnd"),f("onMouseEnter",["mouseout","mouseover"]),f("onMouseLeave",["mouseout","mouseover"]),f("onPointerEnter",["pointerout","pointerover"]),f("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var gd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),hg=new Set("cancel close invalid load scroll toggle".split(" ").concat(gd));function Vi(_,E,z){var K=_.type||"unknown-event";_.currentTarget=z,rr(K,E,void 0,_),_.currentTarget=null}function Uy(_,E){E=(E&4)!==0;for(var z=0;z<_.length;z++){var K=_[z],se=K.event;K=K.listeners;e:{var me=void 0;if(E)for(var Re=K.length-1;0<=Re;Re--){var ht=K[Re],bt=ht.instance,nr=ht.currentTarget;if(ht=ht.listener,bt!==me&&se.isPropagationStopped())break e;Vi(se,ht,nr),me=bt}else for(Re=0;Re<K.length;Re++){if(ht=K[Re],bt=ht.instance,nr=ht.currentTarget,ht=ht.listener,bt!==me&&se.isPropagationStopped())break e;Vi(se,ht,nr),me=bt}}}if(nt)throw _=mt,nt=!1,mt=null,_}function Cs(_,E){var z=E[Lf];z===void 0&&(z=E[Lf]=new Set);var K=_+"__bubble";z.has(K)||(Of(E,_,2,!1),z.add(K))}function fg(_,E,z){var K=0;E&&(K|=4),Of(z,_,K,E)}var If="_reactListening"+Math.random().toString(36).slice(2);function kf(_){if(!_[If]){_[If]=!0,n.forEach(function(z){z!=="selectionchange"&&(hg.has(z)||fg(z,!1,_),fg(z,!0,_))});var E=_.nodeType===9?_:_.ownerDocument;E===null||E[If]||(E[If]=!0,fg("selectionchange",!1,E))}}function Of(_,E,z,K){switch(Rp(E)){case 1:var se=lh;break;case 4:se=Lp;break;default:se=_f}z=se.bind(null,E,z,_),se=void 0,!pe||E!=="touchstart"&&E!=="touchmove"&&E!=="wheel"||(se=!0),K?se!==void 0?_.addEventListener(E,z,{capture:!0,passive:se}):_.addEventListener(E,z,!0):se!==void 0?_.addEventListener(E,z,{passive:se}):_.addEventListener(E,z,!1)}function pg(_,E,z,K,se){var me=K;if((E&1)===0&&(E&2)===0&&K!==null)e:for(;;){if(K===null)return;var Re=K.tag;if(Re===3||Re===4){var ht=K.stateNode.containerInfo;if(ht===se||ht.nodeType===8&&ht.parentNode===se)break;if(Re===4)for(Re=K.return;Re!==null;){var bt=Re.tag;if((bt===3||bt===4)&&(bt=Re.stateNode.containerInfo,bt===se||bt.nodeType===8&&bt.parentNode===se))return;Re=Re.return}for(;ht!==null;){if(Re=Bc(ht),Re===null)return;if(bt=Re.tag,bt===5||bt===6){K=me=Re;continue e}ht=ht.parentNode}}K=K.return}ae(function(){var nr=me,Dr=Ds(z),Fr=[];e:{var Lr=xh.get(_);if(Lr!==void 0){var ln=Br,xn=_;switch(_){case"keypress":if(uh(z)===0)break e;case"keydown":case"keyup":ln=Dp;break;case"focusin":xn="focus",ln=Oo;break;case"focusout":xn="blur",ln=Oo;break;case"beforeblur":case"afterblur":ln=Oo;break;case"click":if(z.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ln=kc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ln=hi;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ln=zy;break;case bu:case Ra:case md:ln=ei;break;case jc:ln=Fs;break;case"scroll":ln=jp;break;case"wheel":ln=gn;break;case"copy":case"cut":case"paste":ln=xf;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ln=Qa}var Cn=(E&4)!==0,ao=!Cn&&_==="scroll",qt=Cn?Lr!==null?Lr+"Capture":null:Lr;Cn=[];for(var It=nr,Gt;It!==null;){Gt=It;var kr=Gt.stateNode;if(Gt.tag===5&&kr!==null&&(Gt=kr,qt!==null&&(kr=oe(It,qt),kr!=null&&Cn.push(bh(It,kr,Gt)))),ao)break;It=It.return}0<Cn.length&&(Lr=new ln(Lr,xn,null,z,Dr),Fr.push({event:Lr,listeners:Cn}))}}if((E&7)===0){e:{if(Lr=_==="mouseover"||_==="pointerover",ln=_==="mouseout"||_==="pointerout",Lr&&z!==Jn&&(xn=z.relatedTarget||z.fromElement)&&(Bc(xn)||xn[Fc]))break e;if((ln||Lr)&&(Lr=Dr.window===Dr?Dr:(Lr=Dr.ownerDocument)?Lr.defaultView||Lr.parentWindow:window,ln?(xn=z.relatedTarget||z.toElement,ln=nr,xn=xn?Bc(xn):null,xn!==null&&(ao=ar(xn),xn!==ao||xn.tag!==5&&xn.tag!==6)&&(xn=null)):(ln=null,xn=nr),ln!==xn)){if(Cn=kc,kr="onMouseLeave",qt="onMouseEnter",It="mouse",(_==="pointerout"||_==="pointerover")&&(Cn=Qa,kr="onPointerLeave",qt="onPointerEnter",It="pointer"),ao=ln==null?Lr:Tu(ln),Gt=xn==null?Lr:Tu(xn),Lr=new Cn(kr,It+"leave",ln,z,Dr),Lr.target=ao,Lr.relatedTarget=Gt,kr=null,Bc(Dr)===nr&&(Cn=new Cn(qt,It+"enter",xn,z,Dr),Cn.target=Gt,Cn.relatedTarget=ao,kr=Cn),ao=kr,ln&&xn)t:{for(Cn=ln,qt=xn,It=0,Gt=Cn;Gt;Gt=Dc(Gt))It++;for(Gt=0,kr=qt;kr;kr=Dc(kr))Gt++;for(;0<It-Gt;)Cn=Dc(Cn),It--;for(;0<Gt-It;)qt=Dc(qt),Gt--;for(;It--;){if(Cn===qt||qt!==null&&Cn===qt.alternate)break t;Cn=Dc(Cn),qt=Dc(qt)}Cn=null}else Cn=null;ln!==null&&Fp(Fr,Lr,ln,Cn,!1),xn!==null&&ao!==null&&Fp(Fr,ao,xn,Cn,!0)}}e:{if(Lr=nr?Tu(nr):window,ln=Lr.nodeName&&Lr.nodeName.toLowerCase(),ln==="select"||ln==="input"&&Lr.type==="file")var In=H_;else if(Lc(Lr))if(Kl)In=Z_;else{In=By;var Nn=W_}else(ln=Lr.nodeName)&&ln.toLowerCase()==="input"&&(Lr.type==="checkbox"||Lr.type==="radio")&&(In=$y);if(In&&(In=In(_,nr))){yu(Fr,In,z,Dr);break e}Nn&&Nn(_,Lr,nr),_==="focusout"&&(Nn=Lr._wrapperState)&&Nn.controlled&&Lr.type==="number"&&$r(Lr,"number",Lr.value)}switch(Nn=nr?Tu(nr):window,_){case"focusin":(Lc(Nn)||Nn.contentEditable==="true")&&(Tl=Nn,Cf=nr,_u=null);break;case"focusout":_u=Cf=Tl=null;break;case"mousedown":ua=!0;break;case"contextmenu":case"mouseup":case"dragend":ua=!1,Af(Fr,z,Dr);break;case"selectionchange":if(yh)break;case"keydown":case"keyup":Af(Fr,z,Dr)}var Gn;if(hd)e:{switch(_){case"compositionstart":var ti="onCompositionStart";break e;case"compositionend":ti="onCompositionEnd";break e;case"compositionupdate":ti="onCompositionUpdate";break e}ti=void 0}else Oc?el(_,z)&&(ti="onCompositionEnd"):_==="keydown"&&z.keyCode===229&&(ti="onCompositionStart");ti&&(pd&&z.locale!=="ko"&&(Oc||ti!=="onCompositionStart"?ti==="onCompositionEnd"&&Oc&&(Gn=la()):(Wl=Dr,ch="value"in Wl?Wl.value:Wl.textContent,Oc=!0)),Nn=wh(nr,ti),0<Nn.length&&(ti=new Lo(ti,_,null,z,Dr),Fr.push({event:ti,listeners:Nn}),Gn?ti.data=Gn:(Gn=cg(z),Gn!==null&&(ti.data=Gn)))),(Gn=fd?Ro(_,z):Yo(_,z))&&(nr=wh(nr,"onBeforeInput"),0<nr.length&&(Dr=new Lo("onBeforeInput","beforeinput",null,z,Dr),Fr.push({event:Dr,listeners:nr}),Dr.data=Gn))}Uy(Fr,E)})}function bh(_,E,z){return{instance:_,listener:E,currentTarget:z}}function wh(_,E){for(var z=E+"Capture",K=[];_!==null;){var se=_,me=se.stateNode;se.tag===5&&me!==null&&(se=me,me=oe(_,z),me!=null&&K.unshift(bh(_,me,se)),me=oe(_,E),me!=null&&K.push(bh(_,me,se))),_=_.return}return K}function Dc(_){if(_===null)return null;do _=_.return;while(_&&_.tag!==5);return _||null}function Fp(_,E,z,K,se){for(var me=E._reactName,Re=[];z!==null&&z!==K;){var ht=z,bt=ht.alternate,nr=ht.stateNode;if(bt!==null&&bt===K)break;ht.tag===5&&nr!==null&&(ht=nr,se?(bt=oe(z,me),bt!=null&&Re.unshift(bh(z,bt,ht))):se||(bt=oe(z,me),bt!=null&&Re.push(bh(z,bt,ht)))),z=z.return}Re.length!==0&&_.push({event:E,listeners:Re})}var yd=/\r\n?/g,mg=/\u0000|\uFFFD/g;function gg(_){return(typeof _=="string"?_:""+_).replace(yd,`
`).replace(mg,"")}function Nc(_,E,z){if(E=gg(E),gg(_)!==E&&z)throw Error(r(425))}function Su(){}var Sh=null,Eh=null;function Eu(_,E){return _==="textarea"||_==="noscript"||typeof E.children=="string"||typeof E.children=="number"||typeof E.dangerouslySetInnerHTML=="object"&&E.dangerouslySetInnerHTML!==null&&E.dangerouslySetInnerHTML.__html!=null}var Th=typeof setTimeout=="function"?setTimeout:void 0,yg=typeof clearTimeout=="function"?clearTimeout:void 0,vg=typeof Promise=="function"?Promise:void 0,_g=typeof queueMicrotask=="function"?queueMicrotask:typeof vg<"u"?function(_){return vg.resolve(null).then(_).catch(Bp)}:Th;function Bp(_){setTimeout(function(){throw _})}function vd(_,E){var z=E,K=0;do{var se=z.nextSibling;if(_.removeChild(z),se&&se.nodeType===8)if(z=se.data,z==="/$"){if(K===0){_.removeChild(se),ad(E);return}K--}else z!=="$"&&z!=="$?"&&z!=="$!"||K++;z=se}while(z);ad(E)}function zc(_){for(;_!=null;_=_.nextSibling){var E=_.nodeType;if(E===1||E===3)break;if(E===8){if(E=_.data,E==="$"||E==="$!"||E==="$?")break;if(E==="/$")return null}}return _}function xg(_){_=_.previousSibling;for(var E=0;_;){if(_.nodeType===8){var z=_.data;if(z==="$"||z==="$!"||z==="$?"){if(E===0)return _;E--}else z==="/$"&&E++}_=_.previousSibling}return null}var _d=Math.random().toString(36).slice(2),da="__reactFiber$"+_d,Ch="__reactProps$"+_d,Fc="__reactContainer$"+_d,Lf="__reactEvents$"+_d,K_="__reactListeners$"+_d,$p="__reactHandles$"+_d;function Bc(_){var E=_[da];if(E)return E;for(var z=_.parentNode;z;){if(E=z[Fc]||z[da]){if(z=E.alternate,E.child!==null||z!==null&&z.child!==null)for(_=xg(_);_!==null;){if(z=_[da])return z;_=xg(_)}return E}_=z,z=_.parentNode}return null}function xd(_){return _=_[da]||_[Fc],!_||_.tag!==5&&_.tag!==6&&_.tag!==13&&_.tag!==3?null:_}function Tu(_){if(_.tag===5||_.tag===6)return _.stateNode;throw Error(r(33))}function Ah(_){return _[Ch]||null}var Rf=[],Cl=-1;function Da(_){return{current:_}}function ts(_){0>Cl||(_.current=Rf[Cl],Rf[Cl]=null,Cl--)}function gs(_,E){Cl++,Rf[Cl]=_.current,_.current=E}var Bs={},ro=Da(Bs),jo=Da(!1),Jl=Bs;function $c(_,E){var z=_.type.contextTypes;if(!z)return Bs;var K=_.stateNode;if(K&&K.__reactInternalMemoizedUnmaskedChildContext===E)return K.__reactInternalMemoizedMaskedChildContext;var se={},me;for(me in z)se[me]=E[me];return K&&(_=_.stateNode,_.__reactInternalMemoizedUnmaskedChildContext=E,_.__reactInternalMemoizedMaskedChildContext=se),se}function Do(_){return _=_.childContextTypes,_!=null}function Ph(){ts(jo),ts(ro)}function jf(_,E,z){if(ro.current!==Bs)throw Error(r(168));gs(ro,E),gs(jo,z)}function Vp(_,E,z){var K=_.stateNode;if(E=E.childContextTypes,typeof K.getChildContext!="function")return z;K=K.getChildContext();for(var se in K)if(!(se in E))throw Error(r(108,kt(_)||"Unknown",se));return Ue({},z,K)}function bd(_){return _=(_=_.stateNode)&&_.__reactInternalMemoizedMergedChildContext||Bs,Jl=ro.current,gs(ro,_),gs(jo,jo.current),!0}function Mh(_,E,z){var K=_.stateNode;if(!K)throw Error(r(169));z?(_=Vp(_,E,Jl),K.__reactInternalMemoizedMergedChildContext=_,ts(jo),ts(ro),gs(ro,_)):ts(jo),gs(jo,z)}var Na=null,Df=!1,Vc=!1;function qy(_){Na===null?Na=[_]:Na.push(_)}function Y_(_){Df=!0,qy(_)}function Uc(){if(!Vc&&Na!==null){Vc=!0;var _=0,E=wi;try{var z=Na;for(wi=1;_<z.length;_++){var K=z[_];do K=K(!0);while(K!==null)}Na=null,Df=!1}catch(se){throw Na!==null&&(Na=Na.slice(_+1)),Qn(li,Uc),se}finally{wi=E,Vc=!1}}return null}var wd=[],Ih=0,Up=null,kh=0,Jo=[],za=0,Fa=null,Ql=1,ec="";function qc(_,E){wd[Ih++]=kh,wd[Ih++]=Up,Up=_,kh=E}function Nf(_,E,z){Jo[za++]=Ql,Jo[za++]=ec,Jo[za++]=Fa,Fa=_;var K=Ql;_=ec;var se=32-cs(K)-1;K&=~(1<<se),z+=1;var me=32-cs(E)+se;if(30<me){var Re=se-se%5;me=(K&(1<<Re)-1).toString(32),K>>=Re,se-=Re,Ql=1<<32-cs(E)+se|z<<se|K,ec=me+_}else Ql=1<<me|z<<se|K,ec=_}function tc(_){_.return!==null&&(qc(_,1),Nf(_,1,0))}function qp(_){for(;_===Up;)Up=wd[--Ih],wd[Ih]=null,kh=wd[--Ih],wd[Ih]=null;for(;_===Fa;)Fa=Jo[--za],Jo[za]=null,ec=Jo[--za],Jo[za]=null,Ql=Jo[--za],Jo[za]=null}var As=null,ha=null,ys=!1,sl=null;function Gp(_,E){var z=Ws(5,null,null,0);z.elementType="DELETED",z.stateNode=E,z.return=_,E=_.deletions,E===null?(_.deletions=[z],_.flags|=16):E.push(z)}function zf(_,E){switch(_.tag){case 5:var z=_.type;return E=E.nodeType!==1||z.toLowerCase()!==E.nodeName.toLowerCase()?null:E,E!==null?(_.stateNode=E,As=_,ha=zc(E.firstChild),!0):!1;case 6:return E=_.pendingProps===""||E.nodeType!==3?null:E,E!==null?(_.stateNode=E,As=_,ha=null,!0):!1;case 13:return E=E.nodeType!==8?null:E,E!==null?(z=Fa!==null?{id:Ql,overflow:ec}:null,_.memoizedState={dehydrated:E,treeContext:z,retryLane:1073741824},z=Ws(18,null,null,0),z.stateNode=E,z.return=_,_.child=z,As=_,ha=null,!0):!1;default:return!1}}function Oh(_){return(_.mode&1)!==0&&(_.flags&128)===0}function Hp(_){if(ys){var E=ha;if(E){var z=E;if(!zf(_,E)){if(Oh(_))throw Error(r(418));E=zc(z.nextSibling);var K=As;E&&zf(_,E)?Gp(K,z):(_.flags=_.flags&-4097|2,ys=!1,As=_)}}else{if(Oh(_))throw Error(r(418));_.flags=_.flags&-4097|2,ys=!1,As=_}}}function Ff(_){for(_=_.return;_!==null&&_.tag!==5&&_.tag!==3&&_.tag!==13;)_=_.return;As=_}function rc(_){if(_!==As)return!1;if(!ys)return Ff(_),ys=!0,!1;var E;if((E=_.tag!==3)&&!(E=_.tag!==5)&&(E=_.type,E=E!=="head"&&E!=="body"&&!Eu(_.type,_.memoizedProps)),E&&(E=ha)){if(Oh(_))throw bg(),Error(r(418));for(;E;)Gp(_,E),E=zc(E.nextSibling)}if(Ff(_),_.tag===13){if(_=_.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(r(317));e:{for(_=_.nextSibling,E=0;_;){if(_.nodeType===8){var z=_.data;if(z==="/$"){if(E===0){ha=zc(_.nextSibling);break e}E--}else z!=="$"&&z!=="$!"&&z!=="$?"||E++}_=_.nextSibling}ha=null}}else ha=As?zc(_.stateNode.nextSibling):null;return!0}function bg(){for(var _=ha;_;)_=zc(_.nextSibling)}function Lh(){ha=As=null,ys=!1}function Al(_){sl===null?sl=[_]:sl.push(_)}var J_=J.ReactCurrentBatchConfig;function Sd(_,E,z){if(_=z.ref,_!==null&&typeof _!="function"&&typeof _!="object"){if(z._owner){if(z=z._owner,z){if(z.tag!==1)throw Error(r(309));var K=z.stateNode}if(!K)throw Error(r(147,_));var se=K,me=""+_;return E!==null&&E.ref!==null&&typeof E.ref=="function"&&E.ref._stringRef===me?E.ref:(E=function(Re){var ht=se.refs;Re===null?delete ht[me]:ht[me]=Re},E._stringRef=me,E)}if(typeof _!="string")throw Error(r(284));if(!z._owner)throw Error(r(290,_))}return _}function Ed(_,E){throw _=Object.prototype.toString.call(E),Error(r(31,_==="[object Object]"?"object with keys {"+Object.keys(E).join(", ")+"}":_))}function Td(_){var E=_._init;return E(_._payload)}function Cu(_){function E(qt,It){if(_){var Gt=qt.deletions;Gt===null?(qt.deletions=[It],qt.flags|=16):Gt.push(It)}}function z(qt,It){if(!_)return null;for(;It!==null;)E(qt,It),It=It.sibling;return null}function K(qt,It){for(qt=new Map;It!==null;)It.key!==null?qt.set(It.key,It):qt.set(It.index,It),It=It.sibling;return qt}function se(qt,It){return qt=qa(qt,It),qt.index=0,qt.sibling=null,qt}function me(qt,It,Gt){return qt.index=Gt,_?(Gt=qt.alternate,Gt!==null?(Gt=Gt.index,Gt<It?(qt.flags|=2,It):Gt):(qt.flags|=2,It)):(qt.flags|=1048576,It)}function Re(qt){return _&&qt.alternate===null&&(qt.flags|=2),qt}function ht(qt,It,Gt,kr){return It===null||It.tag!==6?(It=Hh(Gt,qt.mode,kr),It.return=qt,It):(It=se(It,Gt),It.return=qt,It)}function bt(qt,It,Gt,kr){var In=Gt.type;return In===ie?Dr(qt,It,Gt.props.children,kr,Gt.key):It!==null&&(It.elementType===In||typeof In=="object"&&In!==null&&In.$$typeof===tt&&Td(In)===It.type)?(kr=se(It,Gt.props),kr.ref=Sd(qt,It,Gt),kr.return=qt,kr):(kr=pc(Gt.type,Gt.key,Gt.props,null,qt.mode,kr),kr.ref=Sd(qt,It,Gt),kr.return=qt,kr)}function nr(qt,It,Gt,kr){return It===null||It.tag!==4||It.stateNode.containerInfo!==Gt.containerInfo||It.stateNode.implementation!==Gt.implementation?(It=Nd(Gt,qt.mode,kr),It.return=qt,It):(It=se(It,Gt.children||[]),It.return=qt,It)}function Dr(qt,It,Gt,kr,In){return It===null||It.tag!==7?(It=mc(Gt,qt.mode,kr,In),It.return=qt,It):(It=se(It,Gt),It.return=qt,It)}function Fr(qt,It,Gt){if(typeof It=="string"&&It!==""||typeof It=="number")return It=Hh(""+It,qt.mode,Gt),It.return=qt,It;if(typeof It=="object"&&It!==null){switch(It.$$typeof){case G:return Gt=pc(It.type,It.key,It.props,null,qt.mode,Gt),Gt.ref=Sd(qt,null,It),Gt.return=qt,Gt;case Y:return It=Nd(It,qt.mode,Gt),It.return=qt,It;case tt:var kr=It._init;return Fr(qt,kr(It._payload),Gt)}if(Yr(It)||We(It))return It=mc(It,qt.mode,Gt,null),It.return=qt,It;Ed(qt,It)}return null}function Lr(qt,It,Gt,kr){var In=It!==null?It.key:null;if(typeof Gt=="string"&&Gt!==""||typeof Gt=="number")return In!==null?null:ht(qt,It,""+Gt,kr);if(typeof Gt=="object"&&Gt!==null){switch(Gt.$$typeof){case G:return Gt.key===In?bt(qt,It,Gt,kr):null;case Y:return Gt.key===In?nr(qt,It,Gt,kr):null;case tt:return In=Gt._init,Lr(qt,It,In(Gt._payload),kr)}if(Yr(Gt)||We(Gt))return In!==null?null:Dr(qt,It,Gt,kr,null);Ed(qt,Gt)}return null}function ln(qt,It,Gt,kr,In){if(typeof kr=="string"&&kr!==""||typeof kr=="number")return qt=qt.get(Gt)||null,ht(It,qt,""+kr,In);if(typeof kr=="object"&&kr!==null){switch(kr.$$typeof){case G:return qt=qt.get(kr.key===null?Gt:kr.key)||null,bt(It,qt,kr,In);case Y:return qt=qt.get(kr.key===null?Gt:kr.key)||null,nr(It,qt,kr,In);case tt:var Nn=kr._init;return ln(qt,It,Gt,Nn(kr._payload),In)}if(Yr(kr)||We(kr))return qt=qt.get(Gt)||null,Dr(It,qt,kr,In,null);Ed(It,kr)}return null}function xn(qt,It,Gt,kr){for(var In=null,Nn=null,Gn=It,ti=It=0,ea=null;Gn!==null&&ti<Gt.length;ti++){Gn.index>ti?(ea=Gn,Gn=null):ea=Gn.sibling;var rs=Lr(qt,Gn,Gt[ti],kr);if(rs===null){Gn===null&&(Gn=ea);break}_&&Gn&&rs.alternate===null&&E(qt,Gn),It=me(rs,It,ti),Nn===null?In=rs:Nn.sibling=rs,Nn=rs,Gn=ea}if(ti===Gt.length)return z(qt,Gn),ys&&qc(qt,ti),In;if(Gn===null){for(;ti<Gt.length;ti++)Gn=Fr(qt,Gt[ti],kr),Gn!==null&&(It=me(Gn,It,ti),Nn===null?In=Gn:Nn.sibling=Gn,Nn=Gn);return ys&&qc(qt,ti),In}for(Gn=K(qt,Gn);ti<Gt.length;ti++)ea=ln(Gn,qt,ti,Gt[ti],kr),ea!==null&&(_&&ea.alternate!==null&&Gn.delete(ea.key===null?ti:ea.key),It=me(ea,It,ti),Nn===null?In=ea:Nn.sibling=ea,Nn=ea);return _&&Gn.forEach(function(gc){return E(qt,gc)}),ys&&qc(qt,ti),In}function Cn(qt,It,Gt,kr){var In=We(Gt);if(typeof In!="function")throw Error(r(150));if(Gt=In.call(Gt),Gt==null)throw Error(r(151));for(var Nn=In=null,Gn=It,ti=It=0,ea=null,rs=Gt.next();Gn!==null&&!rs.done;ti++,rs=Gt.next()){Gn.index>ti?(ea=Gn,Gn=null):ea=Gn.sibling;var gc=Lr(qt,Gn,rs.value,kr);if(gc===null){Gn===null&&(Gn=ea);break}_&&Gn&&gc.alternate===null&&E(qt,Gn),It=me(gc,It,ti),Nn===null?In=gc:Nn.sibling=gc,Nn=gc,Gn=ea}if(rs.done)return z(qt,Gn),ys&&qc(qt,ti),In;if(Gn===null){for(;!rs.done;ti++,rs=Gt.next())rs=Fr(qt,rs.value,kr),rs!==null&&(It=me(rs,It,ti),Nn===null?In=rs:Nn.sibling=rs,Nn=rs);return ys&&qc(qt,ti),In}for(Gn=K(qt,Gn);!rs.done;ti++,rs=Gt.next())rs=ln(Gn,qt,ti,rs.value,kr),rs!==null&&(_&&rs.alternate!==null&&Gn.delete(rs.key===null?ti:rs.key),It=me(rs,It,ti),Nn===null?In=rs:Nn.sibling=rs,Nn=rs);return _&&Gn.forEach(function(a1){return E(qt,a1)}),ys&&qc(qt,ti),In}function ao(qt,It,Gt,kr){if(typeof Gt=="object"&&Gt!==null&&Gt.type===ie&&Gt.key===null&&(Gt=Gt.props.children),typeof Gt=="object"&&Gt!==null){switch(Gt.$$typeof){case G:e:{for(var In=Gt.key,Nn=It;Nn!==null;){if(Nn.key===In){if(In=Gt.type,In===ie){if(Nn.tag===7){z(qt,Nn.sibling),It=se(Nn,Gt.props.children),It.return=qt,qt=It;break e}}else if(Nn.elementType===In||typeof In=="object"&&In!==null&&In.$$typeof===tt&&Td(In)===Nn.type){z(qt,Nn.sibling),It=se(Nn,Gt.props),It.ref=Sd(qt,Nn,Gt),It.return=qt,qt=It;break e}z(qt,Nn);break}else E(qt,Nn);Nn=Nn.sibling}Gt.type===ie?(It=mc(Gt.props.children,qt.mode,kr,Gt.key),It.return=qt,qt=It):(kr=pc(Gt.type,Gt.key,Gt.props,null,qt.mode,kr),kr.ref=Sd(qt,It,Gt),kr.return=qt,qt=kr)}return Re(qt);case Y:e:{for(Nn=Gt.key;It!==null;){if(It.key===Nn)if(It.tag===4&&It.stateNode.containerInfo===Gt.containerInfo&&It.stateNode.implementation===Gt.implementation){z(qt,It.sibling),It=se(It,Gt.children||[]),It.return=qt,qt=It;break e}else{z(qt,It);break}else E(qt,It);It=It.sibling}It=Nd(Gt,qt.mode,kr),It.return=qt,qt=It}return Re(qt);case tt:return Nn=Gt._init,ao(qt,It,Nn(Gt._payload),kr)}if(Yr(Gt))return xn(qt,It,Gt,kr);if(We(Gt))return Cn(qt,It,Gt,kr);Ed(qt,Gt)}return typeof Gt=="string"&&Gt!==""||typeof Gt=="number"?(Gt=""+Gt,It!==null&&It.tag===6?(z(qt,It.sibling),It=se(It,Gt),It.return=qt,qt=It):(z(qt,It),It=Hh(Gt,qt.mode,kr),It.return=qt,qt=It),Re(qt)):z(qt,It)}return ao}var Pl=Cu(!0),Rh=Cu(!1),Au=Da(null),Cd=null,Pu=null,jh=null;function Bf(){jh=Pu=Cd=null}function Mu(_){var E=Au.current;ts(Au),_._currentValue=E}function Ad(_,E,z){for(;_!==null;){var K=_.alternate;if((_.childLanes&E)!==E?(_.childLanes|=E,K!==null&&(K.childLanes|=E)):K!==null&&(K.childLanes&E)!==E&&(K.childLanes|=E),_===z)break;_=_.return}}function yr(_,E){Cd=_,jh=Pu=null,_=_.dependencies,_!==null&&_.firstContext!==null&&((_.lanes&E)!==0&&(fo=!0),_.firstContext=null)}function Qo(_){var E=_._currentValue;if(jh!==_)if(_={context:_,memoizedValue:E,next:null},Pu===null){if(Cd===null)throw Error(r(308));Pu=_,Cd.dependencies={lanes:0,firstContext:_}}else Pu=Pu.next=_;return E}var Ba=null;function nc(_){Ba===null?Ba=[_]:Ba.push(_)}function Gc(_,E,z,K){var se=E.interleaved;return se===null?(z.next=z,nc(E)):(z.next=se.next,se.next=z),E.interleaved=z,zr(_,K)}function zr(_,E){_.lanes|=E;var z=_.alternate;for(z!==null&&(z.lanes|=E),z=_,_=_.return;_!==null;)_.childLanes|=E,z=_.alternate,z!==null&&(z.childLanes|=E),z=_,_=_.return;return z.tag===3?z.stateNode:null}var ic=!1;function wg(_){_.updateQueue={baseState:_.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Sg(_,E){_=_.updateQueue,E.updateQueue===_&&(E.updateQueue={baseState:_.baseState,firstBaseUpdate:_.firstBaseUpdate,lastBaseUpdate:_.lastBaseUpdate,shared:_.shared,effects:_.effects})}function $a(_,E){return{eventTime:_,lane:E,tag:0,payload:null,callback:null,next:null}}function Hc(_,E,z){var K=_.updateQueue;if(K===null)return null;if(K=K.shared,(he&2)!==0){var se=K.pending;return se===null?E.next=E:(E.next=se.next,se.next=E),K.pending=E,zr(_,z)}return se=K.interleaved,se===null?(E.next=E,nc(K)):(E.next=se.next,se.next=E),K.interleaved=E,zr(_,z)}function Wp(_,E,z){if(E=E.updateQueue,E!==null&&(E=E.shared,(z&4194240)!==0)){var K=E.lanes;K&=_.pendingLanes,z|=K,E.lanes=z,ka(_,z)}}function Eg(_,E){var z=_.updateQueue,K=_.alternate;if(K!==null&&(K=K.updateQueue,z===K)){var se=null,me=null;if(z=z.firstBaseUpdate,z!==null){do{var Re={eventTime:z.eventTime,lane:z.lane,tag:z.tag,payload:z.payload,callback:z.callback,next:null};me===null?se=me=Re:me=me.next=Re,z=z.next}while(z!==null);me===null?se=me=E:me=me.next=E}else se=me=E;z={baseState:K.baseState,firstBaseUpdate:se,lastBaseUpdate:me,shared:K.shared,effects:K.effects},_.updateQueue=z;return}_=z.lastBaseUpdate,_===null?z.firstBaseUpdate=E:_.next=E,z.lastBaseUpdate=E}function Zp(_,E,z,K){var se=_.updateQueue;ic=!1;var me=se.firstBaseUpdate,Re=se.lastBaseUpdate,ht=se.shared.pending;if(ht!==null){se.shared.pending=null;var bt=ht,nr=bt.next;bt.next=null,Re===null?me=nr:Re.next=nr,Re=bt;var Dr=_.alternate;Dr!==null&&(Dr=Dr.updateQueue,ht=Dr.lastBaseUpdate,ht!==Re&&(ht===null?Dr.firstBaseUpdate=nr:ht.next=nr,Dr.lastBaseUpdate=bt))}if(me!==null){var Fr=se.baseState;Re=0,Dr=nr=bt=null,ht=me;do{var Lr=ht.lane,ln=ht.eventTime;if((K&Lr)===Lr){Dr!==null&&(Dr=Dr.next={eventTime:ln,lane:0,tag:ht.tag,payload:ht.payload,callback:ht.callback,next:null});e:{var xn=_,Cn=ht;switch(Lr=E,ln=z,Cn.tag){case 1:if(xn=Cn.payload,typeof xn=="function"){Fr=xn.call(ln,Fr,Lr);break e}Fr=xn;break e;case 3:xn.flags=xn.flags&-65537|128;case 0:if(xn=Cn.payload,Lr=typeof xn=="function"?xn.call(ln,Fr,Lr):xn,Lr==null)break e;Fr=Ue({},Fr,Lr);break e;case 2:ic=!0}}ht.callback!==null&&ht.lane!==0&&(_.flags|=64,Lr=se.effects,Lr===null?se.effects=[ht]:Lr.push(ht))}else ln={eventTime:ln,lane:Lr,tag:ht.tag,payload:ht.payload,callback:ht.callback,next:null},Dr===null?(nr=Dr=ln,bt=Fr):Dr=Dr.next=ln,Re|=Lr;if(ht=ht.next,ht===null){if(ht=se.shared.pending,ht===null)break;Lr=ht,ht=Lr.next,Lr.next=null,se.lastBaseUpdate=Lr,se.shared.pending=null}}while(!0);if(Dr===null&&(bt=Fr),se.baseState=bt,se.firstBaseUpdate=nr,se.lastBaseUpdate=Dr,E=se.shared.interleaved,E!==null){se=E;do Re|=se.lane,se=se.next;while(se!==E)}else me===null&&(se.shared.lanes=0);qe|=Re,_.lanes=Re,_.memoizedState=Fr}}function Gy(_,E,z){if(_=E.effects,E.effects=null,_!==null)for(E=0;E<_.length;E++){var K=_[E],se=K.callback;if(se!==null){if(K.callback=null,K=z,typeof se!="function")throw Error(r(191,se));se.call(K)}}}var Pd={},ol=Da(Pd),Md=Da(Pd),Id=Da(Pd);function no(_){if(_===Pd)throw Error(r(174));return _}function sc(_,E){switch(gs(Id,E),gs(Md,_),gs(ol,Pd),_=E.nodeType,_){case 9:case 11:E=(E=E.documentElement)?E.namespaceURI:xi(null,"");break;default:_=_===8?E.parentNode:E,E=_.namespaceURI||null,_=_.tagName,E=xi(E,_)}ts(ol),gs(ol,E)}function al(){ts(ol),ts(Md),ts(Id)}function $f(_){no(Id.current);var E=no(ol.current),z=xi(E,_.type);E!==z&&(gs(Md,_),gs(ol,z))}function Dh(_){Md.current===_&&(ts(ol),ts(Md))}var us=Da(0);function Vf(_){for(var E=_;E!==null;){if(E.tag===13){var z=E.memoizedState;if(z!==null&&(z=z.dehydrated,z===null||z.data==="$?"||z.data==="$!"))return E}else if(E.tag===19&&E.memoizedProps.revealOrder!==void 0){if((E.flags&128)!==0)return E}else if(E.child!==null){E.child.return=E,E=E.child;continue}if(E===_)break;for(;E.sibling===null;){if(E.return===null||E.return===_)return null;E=E.return}E.sibling.return=E.return,E=E.sibling}return null}var Sa=[];function ni(){for(var _=0;_<Sa.length;_++)Sa[_]._workInProgressVersionPrimary=null;Sa.length=0}var Iu=J.ReactCurrentDispatcher,oc=J.ReactCurrentBatchConfig,ku=0,Ms=null,io=null,Eo=null,Wc=!1,Ml=!1,er=0,br=0;function $s(){throw Error(r(321))}function qi(_,E){if(E===null)return!1;for(var z=0;z<E.length&&z<_.length;z++)if(!rl(_[z],E[z]))return!1;return!0}function ft(_,E,z,K,se,me){if(ku=me,Ms=E,E.memoizedState=null,E.updateQueue=null,E.lanes=0,Iu.current=_===null||_.memoizedState===null?Rd:Vh,_=z(K,se),Ml){me=0;do{if(Ml=!1,er=0,25<=me)throw Error(r(301));me+=1,Eo=io=null,E.updateQueue=null,Iu.current=pa,_=z(K,se)}while(Ml)}if(Iu.current=Ld,E=io!==null&&io.next!==null,ku=0,Eo=io=Ms=null,Wc=!1,E)throw Error(r(300));return _}function Va(){var _=er!==0;return er=0,_}function Ua(){var _={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Eo===null?Ms.memoizedState=Eo=_:Eo=Eo.next=_,Eo}function fa(){if(io===null){var _=Ms.alternate;_=_!==null?_.memoizedState:null}else _=io.next;var E=Eo===null?Ms.memoizedState:Eo.next;if(E!==null)Eo=E,io=_;else{if(_===null)throw Error(r(310));io=_,_={memoizedState:io.memoizedState,baseState:io.baseState,baseQueue:io.baseQueue,queue:io.queue,next:null},Eo===null?Ms.memoizedState=Eo=_:Eo=Eo.next=_}return Eo}function kd(_,E){return typeof E=="function"?E(_):E}function Xp(_){var E=fa(),z=E.queue;if(z===null)throw Error(r(311));z.lastRenderedReducer=_;var K=io,se=K.baseQueue,me=z.pending;if(me!==null){if(se!==null){var Re=se.next;se.next=me.next,me.next=Re}K.baseQueue=se=me,z.pending=null}if(se!==null){me=se.next,K=K.baseState;var ht=Re=null,bt=null,nr=me;do{var Dr=nr.lane;if((ku&Dr)===Dr)bt!==null&&(bt=bt.next={lane:0,action:nr.action,hasEagerState:nr.hasEagerState,eagerState:nr.eagerState,next:null}),K=nr.hasEagerState?nr.eagerState:_(K,nr.action);else{var Fr={lane:Dr,action:nr.action,hasEagerState:nr.hasEagerState,eagerState:nr.eagerState,next:null};bt===null?(ht=bt=Fr,Re=K):bt=bt.next=Fr,Ms.lanes|=Dr,qe|=Dr}nr=nr.next}while(nr!==null&&nr!==me);bt===null?Re=K:bt.next=ht,rl(K,E.memoizedState)||(fo=!0),E.memoizedState=K,E.baseState=Re,E.baseQueue=bt,z.lastRenderedState=K}if(_=z.interleaved,_!==null){se=_;do me=se.lane,Ms.lanes|=me,qe|=me,se=se.next;while(se!==_)}else se===null&&(z.lanes=0);return[E.memoizedState,z.dispatch]}function Kp(_){var E=fa(),z=E.queue;if(z===null)throw Error(r(311));z.lastRenderedReducer=_;var K=z.dispatch,se=z.pending,me=E.memoizedState;if(se!==null){z.pending=null;var Re=se=se.next;do me=_(me,Re.action),Re=Re.next;while(Re!==se);rl(me,E.memoizedState)||(fo=!0),E.memoizedState=me,E.baseQueue===null&&(E.baseState=me),z.lastRenderedState=me}return[me,K]}function Od(){}function Hy(_,E){var z=Ms,K=fa(),se=E(),me=!rl(K.memoizedState,se);if(me&&(K.memoizedState=se,fo=!0),K=K.queue,To(Uf.bind(null,z,K,_),[_]),K.getSnapshot!==E||me||Eo!==null&&Eo.memoizedState.tag&1){if(z.flags|=2048,Ou(9,Tg.bind(null,z,K,se,E),void 0,null),Se===null)throw Error(r(349));(ku&30)!==0||Wy(z,E,se)}return se}function Wy(_,E,z){_.flags|=16384,_={getSnapshot:E,value:z},E=Ms.updateQueue,E===null?(E={lastEffect:null,stores:null},Ms.updateQueue=E,E.stores=[_]):(z=E.stores,z===null?E.stores=[_]:z.push(_))}function Tg(_,E,z,K){E.value=z,E.getSnapshot=K,Yp(E)&&Jp(_)}function Uf(_,E,z){return z(function(){Yp(E)&&Jp(_)})}function Yp(_){var E=_.getSnapshot;_=_.value;try{var z=E();return!rl(_,z)}catch{return!0}}function Jp(_){var E=zr(_,1);E!==null&&vr(E,_,1,-1)}function Cg(_){var E=Ua();return typeof _=="function"&&(_=_()),E.memoizedState=E.baseState=_,_={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:kd,lastRenderedState:_},E.queue=_,_=_.dispatch=Ag.bind(null,Ms,_),[E.memoizedState,_]}function Ou(_,E,z,K){return _={tag:_,create:E,destroy:z,deps:K,next:null},E=Ms.updateQueue,E===null?(E={lastEffect:null,stores:null},Ms.updateQueue=E,E.lastEffect=_.next=_):(z=E.lastEffect,z===null?E.lastEffect=_.next=_:(K=z.next,z.next=_,_.next=K,E.lastEffect=_)),_}function Nh(){return fa().memoizedState}function ac(_,E,z,K){var se=Ua();Ms.flags|=_,se.memoizedState=Ou(1|E,z,void 0,K===void 0?null:K)}function zh(_,E,z,K){var se=fa();K=K===void 0?null:K;var me=void 0;if(io!==null){var Re=io.memoizedState;if(me=Re.destroy,K!==null&&qi(K,Re.deps)){se.memoizedState=Ou(E,z,me,K);return}}Ms.flags|=_,se.memoizedState=Ou(1|E,z,me,K)}function Zc(_,E){return ac(8390656,8,_,E)}function To(_,E){return zh(2048,8,_,E)}function Zy(_,E){return zh(4,2,_,E)}function Fh(_,E){return zh(4,4,_,E)}function Ai(_,E){if(typeof E=="function")return _=_(),E(_),function(){E(null)};if(E!=null)return _=_(),E.current=_,function(){E.current=null}}function qn(_,E,z){return z=z!=null?z.concat([_]):null,zh(4,4,Ai.bind(null,E,_),z)}function qf(){}function lc(_,E){var z=fa();E=E===void 0?null:E;var K=z.memoizedState;return K!==null&&E!==null&&qi(E,K[1])?K[0]:(z.memoizedState=[_,E],_)}function Gf(_,E){var z=fa();E=E===void 0?null:E;var K=z.memoizedState;return K!==null&&E!==null&&qi(E,K[1])?K[0]:(_=_(),z.memoizedState=[_,E],_)}function Lu(_,E,z){return(ku&21)===0?(_.baseState&&(_.baseState=!1,fo=!0),_.memoizedState=z):(rl(z,E)||(z=kp(),Ms.lanes|=z,qe|=z,_.baseState=!0),E)}function Bh(_,E){var z=wi;wi=z!==0&&4>z?z:4,_(!0);var K=oc.transition;oc.transition={};try{_(!1),E()}finally{wi=z,oc.transition=K}}function Hf(){return fa().memoizedState}function $h(_,E,z){var K=Cr(_);if(z={lane:K,action:z,hasEagerState:!1,eagerState:null,next:null},Qp(_))Il(E,z);else if(z=Gc(_,E,z,K),z!==null){var se=dr();vr(z,_,K,se),cc(z,E,K)}}function Ag(_,E,z){var K=Cr(_),se={lane:K,action:z,hasEagerState:!1,eagerState:null,next:null};if(Qp(_))Il(E,se);else{var me=_.alternate;if(_.lanes===0&&(me===null||me.lanes===0)&&(me=E.lastRenderedReducer,me!==null))try{var Re=E.lastRenderedState,ht=me(Re,z);if(se.hasEagerState=!0,se.eagerState=ht,rl(ht,Re)){var bt=E.interleaved;bt===null?(se.next=se,nc(E)):(se.next=bt.next,bt.next=se),E.interleaved=se;return}}catch{}finally{}z=Gc(_,E,se,K),z!==null&&(se=dr(),vr(z,_,K,se),cc(z,E,K))}}function Qp(_){var E=_.alternate;return _===Ms||E!==null&&E===Ms}function Il(_,E){Ml=Wc=!0;var z=_.pending;z===null?E.next=E:(E.next=z.next,z.next=E),_.pending=E}function cc(_,E,z){if((z&4194240)!==0){var K=E.lanes;K&=_.pendingLanes,z|=K,E.lanes=z,ka(_,z)}}var Ld={readContext:Qo,useCallback:$s,useContext:$s,useEffect:$s,useImperativeHandle:$s,useInsertionEffect:$s,useLayoutEffect:$s,useMemo:$s,useReducer:$s,useRef:$s,useState:$s,useDebugValue:$s,useDeferredValue:$s,useTransition:$s,useMutableSource:$s,useSyncExternalStore:$s,useId:$s,unstable_isNewReconciler:!1},Rd={readContext:Qo,useCallback:function(_,E){return Ua().memoizedState=[_,E===void 0?null:E],_},useContext:Qo,useEffect:Zc,useImperativeHandle:function(_,E,z){return z=z!=null?z.concat([_]):null,ac(4194308,4,Ai.bind(null,E,_),z)},useLayoutEffect:function(_,E){return ac(4194308,4,_,E)},useInsertionEffect:function(_,E){return ac(4,2,_,E)},useMemo:function(_,E){var z=Ua();return E=E===void 0?null:E,_=_(),z.memoizedState=[_,E],_},useReducer:function(_,E,z){var K=Ua();return E=z!==void 0?z(E):E,K.memoizedState=K.baseState=E,_={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:_,lastRenderedState:E},K.queue=_,_=_.dispatch=$h.bind(null,Ms,_),[K.memoizedState,_]},useRef:function(_){var E=Ua();return _={current:_},E.memoizedState=_},useState:Cg,useDebugValue:qf,useDeferredValue:function(_){return Ua().memoizedState=_},useTransition:function(){var _=Cg(!1),E=_[0];return _=Bh.bind(null,_[1]),Ua().memoizedState=_,[E,_]},useMutableSource:function(){},useSyncExternalStore:function(_,E,z){var K=Ms,se=Ua();if(ys){if(z===void 0)throw Error(r(407));z=z()}else{if(z=E(),Se===null)throw Error(r(349));(ku&30)!==0||Wy(K,E,z)}se.memoizedState=z;var me={value:z,getSnapshot:E};return se.queue=me,Zc(Uf.bind(null,K,me,_),[_]),K.flags|=2048,Ou(9,Tg.bind(null,K,me,z,E),void 0,null),z},useId:function(){var _=Ua(),E=Se.identifierPrefix;if(ys){var z=ec,K=Ql;z=(K&~(1<<32-cs(K)-1)).toString(32)+z,E=":"+E+"R"+z,z=er++,0<z&&(E+="H"+z.toString(32)),E+=":"}else z=br++,E=":"+E+"r"+z.toString(32)+":";return _.memoizedState=E},unstable_isNewReconciler:!1},Vh={readContext:Qo,useCallback:lc,useContext:Qo,useEffect:To,useImperativeHandle:qn,useInsertionEffect:Zy,useLayoutEffect:Fh,useMemo:Gf,useReducer:Xp,useRef:Nh,useState:function(){return Xp(kd)},useDebugValue:qf,useDeferredValue:function(_){var E=fa();return Lu(E,io.memoizedState,_)},useTransition:function(){var _=Xp(kd)[0],E=fa().memoizedState;return[_,E]},useMutableSource:Od,useSyncExternalStore:Hy,useId:Hf,unstable_isNewReconciler:!1},pa={readContext:Qo,useCallback:lc,useContext:Qo,useEffect:To,useImperativeHandle:qn,useInsertionEffect:Zy,useLayoutEffect:Fh,useMemo:Gf,useReducer:Kp,useRef:Nh,useState:function(){return Kp(kd)},useDebugValue:qf,useDeferredValue:function(_){var E=fa();return io===null?E.memoizedState=_:Lu(E,io.memoizedState,_)},useTransition:function(){var _=Kp(kd)[0],E=fa().memoizedState;return[_,E]},useMutableSource:Od,useSyncExternalStore:Hy,useId:Hf,unstable_isNewReconciler:!1};function so(_,E){if(_&&_.defaultProps){E=Ue({},E),_=_.defaultProps;for(var z in _)E[z]===void 0&&(E[z]=_[z]);return E}return E}function Wf(_,E,z,K){E=_.memoizedState,z=z(K,E),z=z==null?E:Ue({},E,z),_.memoizedState=z,_.lanes===0&&(_.updateQueue.baseState=z)}var kl={isMounted:function(_){return(_=_._reactInternals)?ar(_)===_:!1},enqueueSetState:function(_,E,z){_=_._reactInternals;var K=dr(),se=Cr(_),me=$a(K,se);me.payload=E,z!=null&&(me.callback=z),E=Hc(_,me,se),E!==null&&(vr(E,_,se,K),Wp(E,_,se))},enqueueReplaceState:function(_,E,z){_=_._reactInternals;var K=dr(),se=Cr(_),me=$a(K,se);me.tag=1,me.payload=E,z!=null&&(me.callback=z),E=Hc(_,me,se),E!==null&&(vr(E,_,se,K),Wp(E,_,se))},enqueueForceUpdate:function(_,E){_=_._reactInternals;var z=dr(),K=Cr(_),se=$a(z,K);se.tag=2,E!=null&&(se.callback=E),E=Hc(_,se,K),E!==null&&(vr(E,_,K,z),Wp(E,_,K))}};function em(_,E,z,K,se,me,Re){return _=_.stateNode,typeof _.shouldComponentUpdate=="function"?_.shouldComponentUpdate(K,me,Re):E.prototype&&E.prototype.isPureReactComponent?!nl(z,K)||!nl(se,me):!0}function Zf(_,E,z){var K=!1,se=Bs,me=E.contextType;return typeof me=="object"&&me!==null?me=Qo(me):(se=Do(E)?Jl:ro.current,K=E.contextTypes,me=(K=K!=null)?$c(_,se):Bs),E=new E(z,me),_.memoizedState=E.state!==null&&E.state!==void 0?E.state:null,E.updater=kl,_.stateNode=E,E._reactInternals=_,K&&(_=_.stateNode,_.__reactInternalMemoizedUnmaskedChildContext=se,_.__reactInternalMemoizedMaskedChildContext=me),E}function Uh(_,E,z,K){_=E.state,typeof E.componentWillReceiveProps=="function"&&E.componentWillReceiveProps(z,K),typeof E.UNSAFE_componentWillReceiveProps=="function"&&E.UNSAFE_componentWillReceiveProps(z,K),E.state!==_&&kl.enqueueReplaceState(E,E.state,null)}function Xf(_,E,z,K){var se=_.stateNode;se.props=z,se.state=_.memoizedState,se.refs={},wg(_);var me=E.contextType;typeof me=="object"&&me!==null?se.context=Qo(me):(me=Do(E)?Jl:ro.current,se.context=$c(_,me)),se.state=_.memoizedState,me=E.getDerivedStateFromProps,typeof me=="function"&&(Wf(_,E,me,z),se.state=_.memoizedState),typeof E.getDerivedStateFromProps=="function"||typeof se.getSnapshotBeforeUpdate=="function"||typeof se.UNSAFE_componentWillMount!="function"&&typeof se.componentWillMount!="function"||(E=se.state,typeof se.componentWillMount=="function"&&se.componentWillMount(),typeof se.UNSAFE_componentWillMount=="function"&&se.UNSAFE_componentWillMount(),E!==se.state&&kl.enqueueReplaceState(se,se.state,null),Zp(_,z,se,K),se.state=_.memoizedState),typeof se.componentDidMount=="function"&&(_.flags|=4194308)}function bs(_,E){try{var z="",K=E;do z+=Ve(K),K=K.return;while(K);var se=z}catch(me){se=`
Error generating stack: `+me.message+`
`+me.stack}return{value:_,source:E,stack:se,digest:null}}function Kf(_,E,z){return{value:_,source:null,stack:z??null,digest:E??null}}function Yf(_,E){try{console.error(E.value)}catch(z){setTimeout(function(){throw z})}}var Ru=typeof WeakMap=="function"?WeakMap:Map;function qh(_,E,z){z=$a(-1,z),z.tag=3,z.payload={element:null};var K=E.value;return z.callback=function(){gt||(gt=!0,ot=K),Yf(_,E)},z}function tm(_,E,z){z=$a(-1,z),z.tag=3;var K=_.type.getDerivedStateFromError;if(typeof K=="function"){var se=E.value;z.payload=function(){return K(se)},z.callback=function(){Yf(_,E)}}var me=_.stateNode;return me!==null&&typeof me.componentDidCatch=="function"&&(z.callback=function(){Yf(_,E),typeof K!="function"&&(Lt===null?Lt=new Set([this]):Lt.add(this));var Re=E.stack;this.componentDidCatch(E.value,{componentStack:Re!==null?Re:""})}),z}function Jf(_,E,z){var K=_.pingCache;if(K===null){K=_.pingCache=new Ru;var se=new Set;K.set(E,se)}else se=K.get(E),se===void 0&&(se=new Set,K.set(E,se));se.has(z)||(se.add(z),_=oo.bind(null,_,E,z),E.then(_,_))}function ju(_){do{var E;if((E=_.tag===13)&&(E=_.memoizedState,E=E!==null?E.dehydrated!==null:!0),E)return _;_=_.return}while(_!==null);return null}function rm(_,E,z,K,se){return(_.mode&1)===0?(_===E?_.flags|=65536:(_.flags|=128,z.flags|=131072,z.flags&=-52805,z.tag===1&&(z.alternate===null?z.tag=17:(E=$a(-1,1),E.tag=2,Hc(z,E,1))),z.lanes|=1),_):(_.flags|=65536,_.lanes=se,_)}var Qf=J.ReactCurrentOwner,fo=!1;function po(_,E,z,K){E.child=_===null?Rh(E,null,z,K):Pl(E,_.child,z,K)}function nm(_,E,z,K,se){z=z.render;var me=E.ref;return yr(E,se),K=ft(_,E,z,K,me,se),z=Va(),_!==null&&!fo?(E.updateQueue=_.updateQueue,E.flags&=-2053,_.lanes&=~se,Ea(_,E,se)):(ys&&z&&tc(E),E.flags|=1,po(_,E,K,se),E.child)}function ep(_,E,z,K,se){if(_===null){var me=z.type;return typeof me=="function"&&!hl(me)&&me.defaultProps===void 0&&z.compare===null&&z.defaultProps===void 0?(E.tag=15,E.type=me,Pg(_,E,me,K,se)):(_=pc(z.type,null,K,E,E.mode,se),_.ref=E.ref,_.return=E,E.child=_)}if(me=_.child,(_.lanes&se)===0){var Re=me.memoizedProps;if(z=z.compare,z=z!==null?z:nl,z(Re,K)&&_.ref===E.ref)return Ea(_,E,se)}return E.flags|=1,_=qa(me,K),_.ref=E.ref,_.return=E,E.child=_}function Pg(_,E,z,K,se){if(_!==null){var me=_.memoizedProps;if(nl(me,K)&&_.ref===E.ref)if(fo=!1,E.pendingProps=K=me,(_.lanes&se)!==0)(_.flags&131072)!==0&&(fo=!0);else return E.lanes=_.lanes,Ea(_,E,se)}return im(_,E,z,K,se)}function tp(_,E,z){var K=E.pendingProps,se=K.children,me=_!==null?_.memoizedState:null;if(K.mode==="hidden")if((E.mode&1)===0)E.memoizedState={baseLanes:0,cachePool:null,transitions:null},gs(Fe,Be),Be|=z;else{if((z&1073741824)===0)return _=me!==null?me.baseLanes|z:z,E.lanes=E.childLanes=1073741824,E.memoizedState={baseLanes:_,cachePool:null,transitions:null},E.updateQueue=null,gs(Fe,Be),Be|=_,null;E.memoizedState={baseLanes:0,cachePool:null,transitions:null},K=me!==null?me.baseLanes:z,gs(Fe,Be),Be|=K}else me!==null?(K=me.baseLanes|z,E.memoizedState=null):K=z,gs(Fe,Be),Be|=K;return po(_,E,se,z),E.child}function Mg(_,E){var z=E.ref;(_===null&&z!==null||_!==null&&_.ref!==z)&&(E.flags|=512,E.flags|=2097152)}function im(_,E,z,K,se){var me=Do(z)?Jl:ro.current;return me=$c(E,me),yr(E,se),z=ft(_,E,z,K,me,se),K=Va(),_!==null&&!fo?(E.updateQueue=_.updateQueue,E.flags&=-2053,_.lanes&=~se,Ea(_,E,se)):(ys&&K&&tc(E),E.flags|=1,po(_,E,z,se),E.child)}function Ig(_,E,z,K,se){if(Do(z)){var me=!0;bd(E)}else me=!1;if(yr(E,se),E.stateNode===null)um(_,E),Zf(E,z,K),Xf(E,z,K,se),K=!0;else if(_===null){var Re=E.stateNode,ht=E.memoizedProps;Re.props=ht;var bt=Re.context,nr=z.contextType;typeof nr=="object"&&nr!==null?nr=Qo(nr):(nr=Do(z)?Jl:ro.current,nr=$c(E,nr));var Dr=z.getDerivedStateFromProps,Fr=typeof Dr=="function"||typeof Re.getSnapshotBeforeUpdate=="function";Fr||typeof Re.UNSAFE_componentWillReceiveProps!="function"&&typeof Re.componentWillReceiveProps!="function"||(ht!==K||bt!==nr)&&Uh(E,Re,K,nr),ic=!1;var Lr=E.memoizedState;Re.state=Lr,Zp(E,K,Re,se),bt=E.memoizedState,ht!==K||Lr!==bt||jo.current||ic?(typeof Dr=="function"&&(Wf(E,z,Dr,K),bt=E.memoizedState),(ht=ic||em(E,z,ht,K,Lr,bt,nr))?(Fr||typeof Re.UNSAFE_componentWillMount!="function"&&typeof Re.componentWillMount!="function"||(typeof Re.componentWillMount=="function"&&Re.componentWillMount(),typeof Re.UNSAFE_componentWillMount=="function"&&Re.UNSAFE_componentWillMount()),typeof Re.componentDidMount=="function"&&(E.flags|=4194308)):(typeof Re.componentDidMount=="function"&&(E.flags|=4194308),E.memoizedProps=K,E.memoizedState=bt),Re.props=K,Re.state=bt,Re.context=nr,K=ht):(typeof Re.componentDidMount=="function"&&(E.flags|=4194308),K=!1)}else{Re=E.stateNode,Sg(_,E),ht=E.memoizedProps,nr=E.type===E.elementType?ht:so(E.type,ht),Re.props=nr,Fr=E.pendingProps,Lr=Re.context,bt=z.contextType,typeof bt=="object"&&bt!==null?bt=Qo(bt):(bt=Do(z)?Jl:ro.current,bt=$c(E,bt));var ln=z.getDerivedStateFromProps;(Dr=typeof ln=="function"||typeof Re.getSnapshotBeforeUpdate=="function")||typeof Re.UNSAFE_componentWillReceiveProps!="function"&&typeof Re.componentWillReceiveProps!="function"||(ht!==Fr||Lr!==bt)&&Uh(E,Re,K,bt),ic=!1,Lr=E.memoizedState,Re.state=Lr,Zp(E,K,Re,se);var xn=E.memoizedState;ht!==Fr||Lr!==xn||jo.current||ic?(typeof ln=="function"&&(Wf(E,z,ln,K),xn=E.memoizedState),(nr=ic||em(E,z,nr,K,Lr,xn,bt)||!1)?(Dr||typeof Re.UNSAFE_componentWillUpdate!="function"&&typeof Re.componentWillUpdate!="function"||(typeof Re.componentWillUpdate=="function"&&Re.componentWillUpdate(K,xn,bt),typeof Re.UNSAFE_componentWillUpdate=="function"&&Re.UNSAFE_componentWillUpdate(K,xn,bt)),typeof Re.componentDidUpdate=="function"&&(E.flags|=4),typeof Re.getSnapshotBeforeUpdate=="function"&&(E.flags|=1024)):(typeof Re.componentDidUpdate!="function"||ht===_.memoizedProps&&Lr===_.memoizedState||(E.flags|=4),typeof Re.getSnapshotBeforeUpdate!="function"||ht===_.memoizedProps&&Lr===_.memoizedState||(E.flags|=1024),E.memoizedProps=K,E.memoizedState=xn),Re.props=K,Re.state=xn,Re.context=bt,K=nr):(typeof Re.componentDidUpdate!="function"||ht===_.memoizedProps&&Lr===_.memoizedState||(E.flags|=4),typeof Re.getSnapshotBeforeUpdate!="function"||ht===_.memoizedProps&&Lr===_.memoizedState||(E.flags|=1024),K=!1)}return sm(_,E,z,K,me,se)}function sm(_,E,z,K,se,me){Mg(_,E);var Re=(E.flags&128)!==0;if(!K&&!Re)return se&&Mh(E,z,!1),Ea(_,E,me);K=E.stateNode,Qf.current=E;var ht=Re&&typeof z.getDerivedStateFromError!="function"?null:K.render();return E.flags|=1,_!==null&&Re?(E.child=Pl(E,_.child,null,me),E.child=Pl(E,null,ht,me)):po(_,E,ht,me),E.memoizedState=K.state,se&&Mh(E,z,!0),E.child}function om(_){var E=_.stateNode;E.pendingContext?jf(_,E.pendingContext,E.pendingContext!==E.context):E.context&&jf(_,E.context,!1),sc(_,E.containerInfo)}function kg(_,E,z,K,se){return Lh(),Al(se),E.flags|=256,po(_,E,z,K),E.child}var am={dehydrated:null,treeContext:null,retryLane:0};function lm(_){return{baseLanes:_,cachePool:null,transitions:null}}function Og(_,E,z){var K=E.pendingProps,se=us.current,me=!1,Re=(E.flags&128)!==0,ht;if((ht=Re)||(ht=_!==null&&_.memoizedState===null?!1:(se&2)!==0),ht?(me=!0,E.flags&=-129):(_===null||_.memoizedState!==null)&&(se|=1),gs(us,se&1),_===null)return Hp(E),_=E.memoizedState,_!==null&&(_=_.dehydrated,_!==null)?((E.mode&1)===0?E.lanes=1:_.data==="$!"?E.lanes=8:E.lanes=1073741824,null):(Re=K.children,_=K.fallback,me?(K=E.mode,me=E.child,Re={mode:"hidden",children:Re},(K&1)===0&&me!==null?(me.childLanes=0,me.pendingProps=Re):me=Dd(Re,K,0,null),_=mc(_,K,z,null),me.return=E,_.return=E,me.sibling=_,E.child=me,E.child.memoizedState=lm(z),E.memoizedState=am,_):cm(E,Re));if(se=_.memoizedState,se!==null&&(ht=se.dehydrated,ht!==null))return Q_(_,E,Re,K,ht,se,z);if(me){me=K.fallback,Re=E.mode,se=_.child,ht=se.sibling;var bt={mode:"hidden",children:K.children};return(Re&1)===0&&E.child!==se?(K=E.child,K.childLanes=0,K.pendingProps=bt,E.deletions=null):(K=qa(se,bt),K.subtreeFlags=se.subtreeFlags&14680064),ht!==null?me=qa(ht,me):(me=mc(me,Re,z,null),me.flags|=2),me.return=E,K.return=E,K.sibling=me,E.child=K,K=me,me=E.child,Re=_.child.memoizedState,Re=Re===null?lm(z):{baseLanes:Re.baseLanes|z,cachePool:null,transitions:Re.transitions},me.memoizedState=Re,me.childLanes=_.childLanes&~z,E.memoizedState=am,K}return me=_.child,_=me.sibling,K=qa(me,{mode:"visible",children:K.children}),(E.mode&1)===0&&(K.lanes=z),K.return=E,K.sibling=null,_!==null&&(z=E.deletions,z===null?(E.deletions=[_],E.flags|=16):z.push(_)),E.child=K,E.memoizedState=null,K}function cm(_,E){return E=Dd({mode:"visible",children:E},_.mode,0,null),E.return=_,_.child=E}function rp(_,E,z,K){return K!==null&&Al(K),Pl(E,_.child,null,z),_=cm(E,E.pendingProps.children),_.flags|=2,E.memoizedState=null,_}function Q_(_,E,z,K,se,me,Re){if(z)return E.flags&256?(E.flags&=-257,K=Kf(Error(r(422))),rp(_,E,Re,K)):E.memoizedState!==null?(E.child=_.child,E.flags|=128,null):(me=K.fallback,se=E.mode,K=Dd({mode:"visible",children:K.children},se,0,null),me=mc(me,se,Re,null),me.flags|=2,K.return=E,me.return=E,K.sibling=me,E.child=K,(E.mode&1)!==0&&Pl(E,_.child,null,Re),E.child.memoizedState=lm(Re),E.memoizedState=am,me);if((E.mode&1)===0)return rp(_,E,Re,null);if(se.data==="$!"){if(K=se.nextSibling&&se.nextSibling.dataset,K)var ht=K.dgst;return K=ht,me=Error(r(419)),K=Kf(me,K,void 0),rp(_,E,Re,K)}if(ht=(Re&_.childLanes)!==0,fo||ht){if(K=Se,K!==null){switch(Re&-Re){case 4:se=2;break;case 16:se=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:se=32;break;case 536870912:se=268435456;break;default:se=0}se=(se&(K.suspendedLanes|Re))!==0?0:se,se!==0&&se!==me.retryLane&&(me.retryLane=se,zr(_,se),vr(K,_,se,-1))}return Hi(),K=Kf(Error(r(421))),rp(_,E,Re,K)}return se.data==="$?"?(E.flags|=128,E.child=_.child,E=yo.bind(null,_),se._reactRetry=E,null):(_=me.treeContext,ha=zc(se.nextSibling),As=E,ys=!0,sl=null,_!==null&&(Jo[za++]=Ql,Jo[za++]=ec,Jo[za++]=Fa,Ql=_.id,ec=_.overflow,Fa=E),E=cm(E,K.children),E.flags|=4096,E)}function Xy(_,E,z){_.lanes|=E;var K=_.alternate;K!==null&&(K.lanes|=E),Ad(_.return,E,z)}function ji(_,E,z,K,se){var me=_.memoizedState;me===null?_.memoizedState={isBackwards:E,rendering:null,renderingStartTime:0,last:K,tail:z,tailMode:se}:(me.isBackwards=E,me.rendering=null,me.renderingStartTime=0,me.last=K,me.tail=z,me.tailMode=se)}function Lg(_,E,z){var K=E.pendingProps,se=K.revealOrder,me=K.tail;if(po(_,E,K.children,z),K=us.current,(K&2)!==0)K=K&1|2,E.flags|=128;else{if(_!==null&&(_.flags&128)!==0)e:for(_=E.child;_!==null;){if(_.tag===13)_.memoizedState!==null&&Xy(_,z,E);else if(_.tag===19)Xy(_,z,E);else if(_.child!==null){_.child.return=_,_=_.child;continue}if(_===E)break e;for(;_.sibling===null;){if(_.return===null||_.return===E)break e;_=_.return}_.sibling.return=_.return,_=_.sibling}K&=1}if(gs(us,K),(E.mode&1)===0)E.memoizedState=null;else switch(se){case"forwards":for(z=E.child,se=null;z!==null;)_=z.alternate,_!==null&&Vf(_)===null&&(se=z),z=z.sibling;z=se,z===null?(se=E.child,E.child=null):(se=z.sibling,z.sibling=null),ji(E,!1,se,z,me);break;case"backwards":for(z=null,se=E.child,E.child=null;se!==null;){if(_=se.alternate,_!==null&&Vf(_)===null){E.child=se;break}_=se.sibling,se.sibling=z,z=se,se=_}ji(E,!0,z,null,me);break;case"together":ji(E,!1,null,null,void 0);break;default:E.memoizedState=null}return E.child}function um(_,E){(E.mode&1)===0&&_!==null&&(_.alternate=null,E.alternate=null,E.flags|=2)}function Ea(_,E,z){if(_!==null&&(E.dependencies=_.dependencies),qe|=E.lanes,(z&E.childLanes)===0)return null;if(_!==null&&E.child!==_.child)throw Error(r(153));if(E.child!==null){for(_=E.child,z=qa(_,_.pendingProps),E.child=z,z.return=E;_.sibling!==null;)_=_.sibling,z=z.sibling=qa(_,_.pendingProps),z.return=E;z.sibling=null}return E.child}function e0(_,E,z){switch(E.tag){case 3:om(E),Lh();break;case 5:$f(E);break;case 1:Do(E.type)&&bd(E);break;case 4:sc(E,E.stateNode.containerInfo);break;case 10:var K=E.type._context,se=E.memoizedProps.value;gs(Au,K._currentValue),K._currentValue=se;break;case 13:if(K=E.memoizedState,K!==null)return K.dehydrated!==null?(gs(us,us.current&1),E.flags|=128,null):(z&E.child.childLanes)!==0?Og(_,E,z):(gs(us,us.current&1),_=Ea(_,E,z),_!==null?_.sibling:null);gs(us,us.current&1);break;case 19:if(K=(z&E.childLanes)!==0,(_.flags&128)!==0){if(K)return Lg(_,E,z);E.flags|=128}if(se=E.memoizedState,se!==null&&(se.rendering=null,se.tail=null,se.lastEffect=null),gs(us,us.current),K)break;return null;case 22:case 23:return E.lanes=0,tp(_,E,z)}return Ea(_,E,z)}var jd,dm,np,Gh;jd=function(_,E){for(var z=E.child;z!==null;){if(z.tag===5||z.tag===6)_.appendChild(z.stateNode);else if(z.tag!==4&&z.child!==null){z.child.return=z,z=z.child;continue}if(z===E)break;for(;z.sibling===null;){if(z.return===null||z.return===E)return;z=z.return}z.sibling.return=z.return,z=z.sibling}},dm=function(){},np=function(_,E,z,K){var se=_.memoizedProps;if(se!==K){_=E.stateNode,no(ol.current);var me=null;switch(z){case"input":se=Dt(_,se),K=Dt(_,K),me=[];break;case"select":se=Ue({},se,{value:void 0}),K=Ue({},K,{value:void 0}),me=[];break;case"textarea":se=Fn(_,se),K=Fn(_,K),me=[];break;default:typeof se.onClick!="function"&&typeof K.onClick=="function"&&(_.onclick=Su)}wo(z,K);var Re;z=null;for(nr in se)if(!K.hasOwnProperty(nr)&&se.hasOwnProperty(nr)&&se[nr]!=null)if(nr==="style"){var ht=se[nr];for(Re in ht)ht.hasOwnProperty(Re)&&(z||(z={}),z[Re]="")}else nr!=="dangerouslySetInnerHTML"&&nr!=="children"&&nr!=="suppressContentEditableWarning"&&nr!=="suppressHydrationWarning"&&nr!=="autoFocus"&&(a.hasOwnProperty(nr)?me||(me=[]):(me=me||[]).push(nr,null));for(nr in K){var bt=K[nr];if(ht=se!=null?se[nr]:void 0,K.hasOwnProperty(nr)&&bt!==ht&&(bt!=null||ht!=null))if(nr==="style")if(ht){for(Re in ht)!ht.hasOwnProperty(Re)||bt&&bt.hasOwnProperty(Re)||(z||(z={}),z[Re]="");for(Re in bt)bt.hasOwnProperty(Re)&&ht[Re]!==bt[Re]&&(z||(z={}),z[Re]=bt[Re])}else z||(me||(me=[]),me.push(nr,z)),z=bt;else nr==="dangerouslySetInnerHTML"?(bt=bt?bt.__html:void 0,ht=ht?ht.__html:void 0,bt!=null&&ht!==bt&&(me=me||[]).push(nr,bt)):nr==="children"?typeof bt!="string"&&typeof bt!="number"||(me=me||[]).push(nr,""+bt):nr!=="suppressContentEditableWarning"&&nr!=="suppressHydrationWarning"&&(a.hasOwnProperty(nr)?(bt!=null&&nr==="onScroll"&&Cs("scroll",_),me||ht===bt||(me=[])):(me=me||[]).push(nr,bt))}z&&(me=me||[]).push("style",z);var nr=me;(E.updateQueue=nr)&&(E.flags|=4)}},Gh=function(_,E,z,K){z!==K&&(E.flags|=4)};function Ta(_,E){if(!ys)switch(_.tailMode){case"hidden":E=_.tail;for(var z=null;E!==null;)E.alternate!==null&&(z=E),E=E.sibling;z===null?_.tail=null:z.sibling=null;break;case"collapsed":z=_.tail;for(var K=null;z!==null;)z.alternate!==null&&(K=z),z=z.sibling;K===null?E||_.tail===null?_.tail=null:_.tail.sibling=null:K.sibling=null}}function mo(_){var E=_.alternate!==null&&_.alternate.child===_.child,z=0,K=0;if(E)for(var se=_.child;se!==null;)z|=se.lanes|se.childLanes,K|=se.subtreeFlags&14680064,K|=se.flags&14680064,se.return=_,se=se.sibling;else for(se=_.child;se!==null;)z|=se.lanes|se.childLanes,K|=se.subtreeFlags,K|=se.flags,se.return=_,se=se.sibling;return _.subtreeFlags|=K,_.childLanes=z,E}function ws(_,E,z){var K=E.pendingProps;switch(qp(E),E.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return mo(E),null;case 1:return Do(E.type)&&Ph(),mo(E),null;case 3:return K=E.stateNode,al(),ts(jo),ts(ro),ni(),K.pendingContext&&(K.context=K.pendingContext,K.pendingContext=null),(_===null||_.child===null)&&(rc(E)?E.flags|=4:_===null||_.memoizedState.isDehydrated&&(E.flags&256)===0||(E.flags|=1024,sl!==null&&(ii(sl),sl=null))),dm(_,E),mo(E),null;case 5:Dh(E);var se=no(Id.current);if(z=E.type,_!==null&&E.stateNode!=null)np(_,E,z,K,se),_.ref!==E.ref&&(E.flags|=512,E.flags|=2097152);else{if(!K){if(E.stateNode===null)throw Error(r(166));return mo(E),null}if(_=no(ol.current),rc(E)){K=E.stateNode,z=E.type;var me=E.memoizedProps;switch(K[da]=E,K[Ch]=me,_=(E.mode&1)!==0,z){case"dialog":Cs("cancel",K),Cs("close",K);break;case"iframe":case"object":case"embed":Cs("load",K);break;case"video":case"audio":for(se=0;se<gd.length;se++)Cs(gd[se],K);break;case"source":Cs("error",K);break;case"img":case"image":case"link":Cs("error",K),Cs("load",K);break;case"details":Cs("toggle",K);break;case"input":sr(K,me),Cs("invalid",K);break;case"select":K._wrapperState={wasMultiple:!!me.multiple},Cs("invalid",K);break;case"textarea":vi(K,me),Cs("invalid",K)}wo(z,me),se=null;for(var Re in me)if(me.hasOwnProperty(Re)){var ht=me[Re];Re==="children"?typeof ht=="string"?K.textContent!==ht&&(me.suppressHydrationWarning!==!0&&Nc(K.textContent,ht,_),se=["children",ht]):typeof ht=="number"&&K.textContent!==""+ht&&(me.suppressHydrationWarning!==!0&&Nc(K.textContent,ht,_),se=["children",""+ht]):a.hasOwnProperty(Re)&&ht!=null&&Re==="onScroll"&&Cs("scroll",K)}switch(z){case"input":ur(K),rn(K,me,!0);break;case"textarea":ur(K),Hr(K);break;case"select":case"option":break;default:typeof me.onClick=="function"&&(K.onclick=Su)}K=se,E.updateQueue=K,K!==null&&(E.flags|=4)}else{Re=se.nodeType===9?se:se.ownerDocument,_==="http://www.w3.org/1999/xhtml"&&(_=wn(z)),_==="http://www.w3.org/1999/xhtml"?z==="script"?(_=Re.createElement("div"),_.innerHTML="<script><\/script>",_=_.removeChild(_.firstChild)):typeof K.is=="string"?_=Re.createElement(z,{is:K.is}):(_=Re.createElement(z),z==="select"&&(Re=_,K.multiple?Re.multiple=!0:K.size&&(Re.size=K.size))):_=Re.createElementNS(_,z),_[da]=E,_[Ch]=K,jd(_,E,!1,!1),E.stateNode=_;e:{switch(Re=So(z,K),z){case"dialog":Cs("cancel",_),Cs("close",_),se=K;break;case"iframe":case"object":case"embed":Cs("load",_),se=K;break;case"video":case"audio":for(se=0;se<gd.length;se++)Cs(gd[se],_);se=K;break;case"source":Cs("error",_),se=K;break;case"img":case"image":case"link":Cs("error",_),Cs("load",_),se=K;break;case"details":Cs("toggle",_),se=K;break;case"input":sr(_,K),se=Dt(_,K),Cs("invalid",_);break;case"option":se=K;break;case"select":_._wrapperState={wasMultiple:!!K.multiple},se=Ue({},K,{value:void 0}),Cs("invalid",_);break;case"textarea":vi(_,K),se=Fn(_,K),Cs("invalid",_);break;default:se=K}wo(z,se),ht=se;for(me in ht)if(ht.hasOwnProperty(me)){var bt=ht[me];me==="style"?Js(_,bt):me==="dangerouslySetInnerHTML"?(bt=bt?bt.__html:void 0,bt!=null&&Ui(_,bt)):me==="children"?typeof bt=="string"?(z!=="textarea"||bt!=="")&&js(_,bt):typeof bt=="number"&&js(_,""+bt):me!=="suppressContentEditableWarning"&&me!=="suppressHydrationWarning"&&me!=="autoFocus"&&(a.hasOwnProperty(me)?bt!=null&&me==="onScroll"&&Cs("scroll",_):bt!=null&&Z(_,me,bt,Re))}switch(z){case"input":ur(_),rn(_,K,!1);break;case"textarea":ur(_),Hr(_);break;case"option":K.value!=null&&_.setAttribute("value",""+Wt(K.value));break;case"select":_.multiple=!!K.multiple,me=K.value,me!=null?un(_,!!K.multiple,me,!1):K.defaultValue!=null&&un(_,!!K.multiple,K.defaultValue,!0);break;default:typeof se.onClick=="function"&&(_.onclick=Su)}switch(z){case"button":case"input":case"select":case"textarea":K=!!K.autoFocus;break e;case"img":K=!0;break e;default:K=!1}}K&&(E.flags|=4)}E.ref!==null&&(E.flags|=512,E.flags|=2097152)}return mo(E),null;case 6:if(_&&E.stateNode!=null)Gh(_,E,_.memoizedProps,K);else{if(typeof K!="string"&&E.stateNode===null)throw Error(r(166));if(z=no(Id.current),no(ol.current),rc(E)){if(K=E.stateNode,z=E.memoizedProps,K[da]=E,(me=K.nodeValue!==z)&&(_=As,_!==null))switch(_.tag){case 3:Nc(K.nodeValue,z,(_.mode&1)!==0);break;case 5:_.memoizedProps.suppressHydrationWarning!==!0&&Nc(K.nodeValue,z,(_.mode&1)!==0)}me&&(E.flags|=4)}else K=(z.nodeType===9?z:z.ownerDocument).createTextNode(K),K[da]=E,E.stateNode=K}return mo(E),null;case 13:if(ts(us),K=E.memoizedState,_===null||_.memoizedState!==null&&_.memoizedState.dehydrated!==null){if(ys&&ha!==null&&(E.mode&1)!==0&&(E.flags&128)===0)bg(),Lh(),E.flags|=98560,me=!1;else if(me=rc(E),K!==null&&K.dehydrated!==null){if(_===null){if(!me)throw Error(r(318));if(me=E.memoizedState,me=me!==null?me.dehydrated:null,!me)throw Error(r(317));me[da]=E}else Lh(),(E.flags&128)===0&&(E.memoizedState=null),E.flags|=4;mo(E),me=!1}else sl!==null&&(ii(sl),sl=null),me=!0;if(!me)return E.flags&65536?E:null}return(E.flags&128)!==0?(E.lanes=z,E):(K=K!==null,K!==(_!==null&&_.memoizedState!==null)&&K&&(E.child.flags|=8192,(E.mode&1)!==0&&(_===null||(us.current&1)!==0?je===0&&(je=3):Hi())),E.updateQueue!==null&&(E.flags|=4),mo(E),null);case 4:return al(),dm(_,E),_===null&&kf(E.stateNode.containerInfo),mo(E),null;case 10:return Mu(E.type._context),mo(E),null;case 17:return Do(E.type)&&Ph(),mo(E),null;case 19:if(ts(us),me=E.memoizedState,me===null)return mo(E),null;if(K=(E.flags&128)!==0,Re=me.rendering,Re===null)if(K)Ta(me,!1);else{if(je!==0||_!==null&&(_.flags&128)!==0)for(_=E.child;_!==null;){if(Re=Vf(_),Re!==null){for(E.flags|=128,Ta(me,!1),K=Re.updateQueue,K!==null&&(E.updateQueue=K,E.flags|=4),E.subtreeFlags=0,K=z,z=E.child;z!==null;)me=z,_=K,me.flags&=14680066,Re=me.alternate,Re===null?(me.childLanes=0,me.lanes=_,me.child=null,me.subtreeFlags=0,me.memoizedProps=null,me.memoizedState=null,me.updateQueue=null,me.dependencies=null,me.stateNode=null):(me.childLanes=Re.childLanes,me.lanes=Re.lanes,me.child=Re.child,me.subtreeFlags=0,me.deletions=null,me.memoizedProps=Re.memoizedProps,me.memoizedState=Re.memoizedState,me.updateQueue=Re.updateQueue,me.type=Re.type,_=Re.dependencies,me.dependencies=_===null?null:{lanes:_.lanes,firstContext:_.firstContext}),z=z.sibling;return gs(us,us.current&1|2),E.child}_=_.sibling}me.tail!==null&&on()>Zt&&(E.flags|=128,K=!0,Ta(me,!1),E.lanes=4194304)}else{if(!K)if(_=Vf(Re),_!==null){if(E.flags|=128,K=!0,z=_.updateQueue,z!==null&&(E.updateQueue=z,E.flags|=4),Ta(me,!0),me.tail===null&&me.tailMode==="hidden"&&!Re.alternate&&!ys)return mo(E),null}else 2*on()-me.renderingStartTime>Zt&&z!==1073741824&&(E.flags|=128,K=!0,Ta(me,!1),E.lanes=4194304);me.isBackwards?(Re.sibling=E.child,E.child=Re):(z=me.last,z!==null?z.sibling=Re:E.child=Re,me.last=Re)}return me.tail!==null?(E=me.tail,me.rendering=E,me.tail=E.sibling,me.renderingStartTime=on(),E.sibling=null,z=us.current,gs(us,K?z&1|2:z&1),E):(mo(E),null);case 22:case 23:return kn(),K=E.memoizedState!==null,_!==null&&_.memoizedState!==null!==K&&(E.flags|=8192),K&&(E.mode&1)!==0?(Be&1073741824)!==0&&(mo(E),E.subtreeFlags&6&&(E.flags|=8192)):mo(E),null;case 24:return null;case 25:return null}throw Error(r(156,E.tag))}function Ol(_,E){switch(qp(E),E.tag){case 1:return Do(E.type)&&Ph(),_=E.flags,_&65536?(E.flags=_&-65537|128,E):null;case 3:return al(),ts(jo),ts(ro),ni(),_=E.flags,(_&65536)!==0&&(_&128)===0?(E.flags=_&-65537|128,E):null;case 5:return Dh(E),null;case 13:if(ts(us),_=E.memoizedState,_!==null&&_.dehydrated!==null){if(E.alternate===null)throw Error(r(340));Lh()}return _=E.flags,_&65536?(E.flags=_&-65537|128,E):null;case 19:return ts(us),null;case 4:return al(),null;case 10:return Mu(E.type._context),null;case 22:case 23:return kn(),null;case 24:return null;default:return null}}var Du=!1,go=!1,Ky=typeof WeakSet=="function"?WeakSet:Set,hn=null;function uc(_,E){var z=_.ref;if(z!==null)if(typeof z=="function")try{z(null)}catch(K){Mn(_,E,K)}else z.current=null}function hm(_,E,z){try{z()}catch(K){Mn(_,E,K)}}var fm=!1;function ll(_,E){if(Sh=fu,_=gh(),Tf(_)){if("selectionStart"in _)var z={start:_.selectionStart,end:_.selectionEnd};else e:{z=(z=_.ownerDocument)&&z.defaultView||window;var K=z.getSelection&&z.getSelection();if(K&&K.rangeCount!==0){z=K.anchorNode;var se=K.anchorOffset,me=K.focusNode;K=K.focusOffset;try{z.nodeType,me.nodeType}catch{z=null;break e}var Re=0,ht=-1,bt=-1,nr=0,Dr=0,Fr=_,Lr=null;t:for(;;){for(var ln;Fr!==z||se!==0&&Fr.nodeType!==3||(ht=Re+se),Fr!==me||K!==0&&Fr.nodeType!==3||(bt=Re+K),Fr.nodeType===3&&(Re+=Fr.nodeValue.length),(ln=Fr.firstChild)!==null;)Lr=Fr,Fr=ln;for(;;){if(Fr===_)break t;if(Lr===z&&++nr===se&&(ht=Re),Lr===me&&++Dr===K&&(bt=Re),(ln=Fr.nextSibling)!==null)break;Fr=Lr,Lr=Fr.parentNode}Fr=ln}z=ht===-1||bt===-1?null:{start:ht,end:bt}}else z=null}z=z||{start:0,end:0}}else z=null;for(Eh={focusedElem:_,selectionRange:z},fu=!1,hn=E;hn!==null;)if(E=hn,_=E.child,(E.subtreeFlags&1028)!==0&&_!==null)_.return=E,hn=_;else for(;hn!==null;){E=hn;try{var xn=E.alternate;if((E.flags&1024)!==0)switch(E.tag){case 0:case 11:case 15:break;case 1:if(xn!==null){var Cn=xn.memoizedProps,ao=xn.memoizedState,qt=E.stateNode,It=qt.getSnapshotBeforeUpdate(E.elementType===E.type?Cn:so(E.type,Cn),ao);qt.__reactInternalSnapshotBeforeUpdate=It}break;case 3:var Gt=E.stateNode.containerInfo;Gt.nodeType===1?Gt.textContent="":Gt.nodeType===9&&Gt.documentElement&&Gt.removeChild(Gt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(r(163))}}catch(kr){Mn(E,E.return,kr)}if(_=E.sibling,_!==null){_.return=E.return,hn=_;break}hn=E.return}return xn=fm,fm=!1,xn}function Xc(_,E,z){var K=E.updateQueue;if(K=K!==null?K.lastEffect:null,K!==null){var se=K=K.next;do{if((se.tag&_)===_){var me=se.destroy;se.destroy=void 0,me!==void 0&&hm(E,z,me)}se=se.next}while(se!==K)}}function Nu(_,E){if(E=E.updateQueue,E=E!==null?E.lastEffect:null,E!==null){var z=E=E.next;do{if((z.tag&_)===_){var K=z.create;z.destroy=K()}z=z.next}while(z!==E)}}function zu(_){var E=_.ref;if(E!==null){var z=_.stateNode;switch(_.tag){case 5:_=z;break;default:_=z}typeof E=="function"?E(_):E.current=_}}function dc(_){var E=_.alternate;E!==null&&(_.alternate=null,dc(E)),_.child=null,_.deletions=null,_.sibling=null,_.tag===5&&(E=_.stateNode,E!==null&&(delete E[da],delete E[Ch],delete E[Lf],delete E[K_],delete E[$p])),_.stateNode=null,_.return=null,_.dependencies=null,_.memoizedProps=null,_.memoizedState=null,_.pendingProps=null,_.stateNode=null,_.updateQueue=null}function cl(_){return _.tag===5||_.tag===3||_.tag===4}function ul(_){e:for(;;){for(;_.sibling===null;){if(_.return===null||cl(_.return))return null;_=_.return}for(_.sibling.return=_.return,_=_.sibling;_.tag!==5&&_.tag!==6&&_.tag!==18;){if(_.flags&2||_.child===null||_.tag===4)continue e;_.child.return=_,_=_.child}if(!(_.flags&2))return _.stateNode}}function hc(_,E,z){var K=_.tag;if(K===5||K===6)_=_.stateNode,E?z.nodeType===8?z.parentNode.insertBefore(_,E):z.insertBefore(_,E):(z.nodeType===8?(E=z.parentNode,E.insertBefore(_,z)):(E=z,E.appendChild(_)),z=z._reactRootContainer,z!=null||E.onclick!==null||(E.onclick=Su));else if(K!==4&&(_=_.child,_!==null))for(hc(_,E,z),_=_.sibling;_!==null;)hc(_,E,z),_=_.sibling}function Kc(_,E,z){var K=_.tag;if(K===5||K===6)_=_.stateNode,E?z.insertBefore(_,E):z.appendChild(_);else if(K!==4&&(_=_.child,_!==null))for(Kc(_,E,z),_=_.sibling;_!==null;)Kc(_,E,z),_=_.sibling}var m=null,o=!1;function d(_,E,z){for(z=z.child;z!==null;)g(_,E,z),z=z.sibling}function g(_,E,z){if(xs&&typeof xs.onCommitFiberUnmount=="function")try{xs.onCommitFiberUnmount(Qs,z)}catch{}switch(z.tag){case 5:go||uc(z,E);case 6:var K=m,se=o;m=null,d(_,E,z),m=K,o=se,m!==null&&(o?(_=m,z=z.stateNode,_.nodeType===8?_.parentNode.removeChild(z):_.removeChild(z)):m.removeChild(z.stateNode));break;case 18:m!==null&&(o?(_=m,z=z.stateNode,_.nodeType===8?vd(_.parentNode,z):_.nodeType===1&&vd(_,z),ad(_)):vd(m,z.stateNode));break;case 4:K=m,se=o,m=z.stateNode.containerInfo,o=!0,d(_,E,z),m=K,o=se;break;case 0:case 11:case 14:case 15:if(!go&&(K=z.updateQueue,K!==null&&(K=K.lastEffect,K!==null))){se=K=K.next;do{var me=se,Re=me.destroy;me=me.tag,Re!==void 0&&((me&2)!==0||(me&4)!==0)&&hm(z,E,Re),se=se.next}while(se!==K)}d(_,E,z);break;case 1:if(!go&&(uc(z,E),K=z.stateNode,typeof K.componentWillUnmount=="function"))try{K.props=z.memoizedProps,K.state=z.memoizedState,K.componentWillUnmount()}catch(ht){Mn(z,E,ht)}d(_,E,z);break;case 21:d(_,E,z);break;case 22:z.mode&1?(go=(K=go)||z.memoizedState!==null,d(_,E,z),go=K):d(_,E,z);break;default:d(_,E,z)}}function S(_){var E=_.updateQueue;if(E!==null){_.updateQueue=null;var z=_.stateNode;z===null&&(z=_.stateNode=new Ky),E.forEach(function(K){var se=Ll.bind(null,_,K);z.has(K)||(z.add(K),K.then(se,se))})}}function C(_,E){var z=E.deletions;if(z!==null)for(var K=0;K<z.length;K++){var se=z[K];try{var me=_,Re=E,ht=Re;e:for(;ht!==null;){switch(ht.tag){case 5:m=ht.stateNode,o=!1;break e;case 3:m=ht.stateNode.containerInfo,o=!0;break e;case 4:m=ht.stateNode.containerInfo,o=!0;break e}ht=ht.return}if(m===null)throw Error(r(160));g(me,Re,se),m=null,o=!1;var bt=se.alternate;bt!==null&&(bt.return=null),se.return=null}catch(nr){Mn(se,E,nr)}}if(E.subtreeFlags&12854)for(E=E.child;E!==null;)M(E,_),E=E.sibling}function M(_,E){var z=_.alternate,K=_.flags;switch(_.tag){case 0:case 11:case 14:case 15:if(C(E,_),L(_),K&4){try{Xc(3,_,_.return),Nu(3,_)}catch(Cn){Mn(_,_.return,Cn)}try{Xc(5,_,_.return)}catch(Cn){Mn(_,_.return,Cn)}}break;case 1:C(E,_),L(_),K&512&&z!==null&&uc(z,z.return);break;case 5:if(C(E,_),L(_),K&512&&z!==null&&uc(z,z.return),_.flags&32){var se=_.stateNode;try{js(se,"")}catch(Cn){Mn(_,_.return,Cn)}}if(K&4&&(se=_.stateNode,se!=null)){var me=_.memoizedProps,Re=z!==null?z.memoizedProps:me,ht=_.type,bt=_.updateQueue;if(_.updateQueue=null,bt!==null)try{ht==="input"&&me.type==="radio"&&me.name!=null&&mr(se,me),So(ht,Re);var nr=So(ht,me);for(Re=0;Re<bt.length;Re+=2){var Dr=bt[Re],Fr=bt[Re+1];Dr==="style"?Js(se,Fr):Dr==="dangerouslySetInnerHTML"?Ui(se,Fr):Dr==="children"?js(se,Fr):Z(se,Dr,Fr,nr)}switch(ht){case"input":Vr(se,me);break;case"textarea":xr(se,me);break;case"select":var Lr=se._wrapperState.wasMultiple;se._wrapperState.wasMultiple=!!me.multiple;var ln=me.value;ln!=null?un(se,!!me.multiple,ln,!1):Lr!==!!me.multiple&&(me.defaultValue!=null?un(se,!!me.multiple,me.defaultValue,!0):un(se,!!me.multiple,me.multiple?[]:"",!1))}se[Ch]=me}catch(Cn){Mn(_,_.return,Cn)}}break;case 6:if(C(E,_),L(_),K&4){if(_.stateNode===null)throw Error(r(162));se=_.stateNode,me=_.memoizedProps;try{se.nodeValue=me}catch(Cn){Mn(_,_.return,Cn)}}break;case 3:if(C(E,_),L(_),K&4&&z!==null&&z.memoizedState.isDehydrated)try{ad(E.containerInfo)}catch(Cn){Mn(_,_.return,Cn)}break;case 4:C(E,_),L(_);break;case 13:C(E,_),L(_),se=_.child,se.flags&8192&&(me=se.memoizedState!==null,se.stateNode.isHidden=me,!me||se.alternate!==null&&se.alternate.memoizedState!==null||(Mt=on())),K&4&&S(_);break;case 22:if(Dr=z!==null&&z.memoizedState!==null,_.mode&1?(go=(nr=go)||Dr,C(E,_),go=nr):C(E,_),L(_),K&8192){if(nr=_.memoizedState!==null,(_.stateNode.isHidden=nr)&&!Dr&&(_.mode&1)!==0)for(hn=_,Dr=_.child;Dr!==null;){for(Fr=hn=Dr;hn!==null;){switch(Lr=hn,ln=Lr.child,Lr.tag){case 0:case 11:case 14:case 15:Xc(4,Lr,Lr.return);break;case 1:uc(Lr,Lr.return);var xn=Lr.stateNode;if(typeof xn.componentWillUnmount=="function"){K=Lr,z=Lr.return;try{E=K,xn.props=E.memoizedProps,xn.state=E.memoizedState,xn.componentWillUnmount()}catch(Cn){Mn(K,z,Cn)}}break;case 5:uc(Lr,Lr.return);break;case 22:if(Lr.memoizedState!==null){ee(Fr);continue}}ln!==null?(ln.return=Lr,hn=ln):ee(Fr)}Dr=Dr.sibling}e:for(Dr=null,Fr=_;;){if(Fr.tag===5){if(Dr===null){Dr=Fr;try{se=Fr.stateNode,nr?(me=se.style,typeof me.setProperty=="function"?me.setProperty("display","none","important"):me.display="none"):(ht=Fr.stateNode,bt=Fr.memoizedProps.style,Re=bt!=null&&bt.hasOwnProperty("display")?bt.display:null,ht.style.display=Ys("display",Re))}catch(Cn){Mn(_,_.return,Cn)}}}else if(Fr.tag===6){if(Dr===null)try{Fr.stateNode.nodeValue=nr?"":Fr.memoizedProps}catch(Cn){Mn(_,_.return,Cn)}}else if((Fr.tag!==22&&Fr.tag!==23||Fr.memoizedState===null||Fr===_)&&Fr.child!==null){Fr.child.return=Fr,Fr=Fr.child;continue}if(Fr===_)break e;for(;Fr.sibling===null;){if(Fr.return===null||Fr.return===_)break e;Dr===Fr&&(Dr=null),Fr=Fr.return}Dr===Fr&&(Dr=null),Fr.sibling.return=Fr.return,Fr=Fr.sibling}}break;case 19:C(E,_),L(_),K&4&&S(_);break;case 21:break;default:C(E,_),L(_)}}function L(_){var E=_.flags;if(E&2){try{e:{for(var z=_.return;z!==null;){if(cl(z)){var K=z;break e}z=z.return}throw Error(r(160))}switch(K.tag){case 5:var se=K.stateNode;K.flags&32&&(js(se,""),K.flags&=-33);var me=ul(_);Kc(_,me,se);break;case 3:case 4:var Re=K.stateNode.containerInfo,ht=ul(_);hc(_,ht,Re);break;default:throw Error(r(161))}}catch(bt){Mn(_,_.return,bt)}_.flags&=-3}E&4096&&(_.flags&=-4097)}function B(_,E,z){hn=_,q(_)}function q(_,E,z){for(var K=(_.mode&1)!==0;hn!==null;){var se=hn,me=se.child;if(se.tag===22&&K){var Re=se.memoizedState!==null||Du;if(!Re){var ht=se.alternate,bt=ht!==null&&ht.memoizedState!==null||go;ht=Du;var nr=go;if(Du=Re,(go=bt)&&!nr)for(hn=se;hn!==null;)Re=hn,bt=Re.child,Re.tag===22&&Re.memoizedState!==null?Q(se):bt!==null?(bt.return=Re,hn=bt):Q(se);for(;me!==null;)hn=me,q(me),me=me.sibling;hn=se,Du=ht,go=nr}X(_)}else(se.subtreeFlags&8772)!==0&&me!==null?(me.return=se,hn=me):X(_)}}function X(_){for(;hn!==null;){var E=hn;if((E.flags&8772)!==0){var z=E.alternate;try{if((E.flags&8772)!==0)switch(E.tag){case 0:case 11:case 15:go||Nu(5,E);break;case 1:var K=E.stateNode;if(E.flags&4&&!go)if(z===null)K.componentDidMount();else{var se=E.elementType===E.type?z.memoizedProps:so(E.type,z.memoizedProps);K.componentDidUpdate(se,z.memoizedState,K.__reactInternalSnapshotBeforeUpdate)}var me=E.updateQueue;me!==null&&Gy(E,me,K);break;case 3:var Re=E.updateQueue;if(Re!==null){if(z=null,E.child!==null)switch(E.child.tag){case 5:z=E.child.stateNode;break;case 1:z=E.child.stateNode}Gy(E,Re,z)}break;case 5:var ht=E.stateNode;if(z===null&&E.flags&4){z=ht;var bt=E.memoizedProps;switch(E.type){case"button":case"input":case"select":case"textarea":bt.autoFocus&&z.focus();break;case"img":bt.src&&(z.src=bt.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(E.memoizedState===null){var nr=E.alternate;if(nr!==null){var Dr=nr.memoizedState;if(Dr!==null){var Fr=Dr.dehydrated;Fr!==null&&ad(Fr)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(r(163))}go||E.flags&512&&zu(E)}catch(Lr){Mn(E,E.return,Lr)}}if(E===_){hn=null;break}if(z=E.sibling,z!==null){z.return=E.return,hn=z;break}hn=E.return}}function ee(_){for(;hn!==null;){var E=hn;if(E===_){hn=null;break}var z=E.sibling;if(z!==null){z.return=E.return,hn=z;break}hn=E.return}}function Q(_){for(;hn!==null;){var E=hn;try{switch(E.tag){case 0:case 11:case 15:var z=E.return;try{Nu(4,E)}catch(bt){Mn(E,z,bt)}break;case 1:var K=E.stateNode;if(typeof K.componentDidMount=="function"){var se=E.return;try{K.componentDidMount()}catch(bt){Mn(E,se,bt)}}var me=E.return;try{zu(E)}catch(bt){Mn(E,me,bt)}break;case 5:var Re=E.return;try{zu(E)}catch(bt){Mn(E,Re,bt)}}}catch(bt){Mn(E,E.return,bt)}if(E===_){hn=null;break}var ht=E.sibling;if(ht!==null){ht.return=E.return,hn=ht;break}hn=E.return}}var ne=Math.ceil,fe=J.ReactCurrentDispatcher,de=J.ReactCurrentOwner,ye=J.ReactCurrentBatchConfig,he=0,Se=null,Ae=null,Pe=0,Be=0,Fe=Da(0),je=0,ke=null,qe=0,Ze=0,yt=0,ut=null,At=null,Mt=0,Zt=1/0,at=null,gt=!1,ot=null,Lt=null,vt=!1,zt=null,Ot=0,$t=0,Ut=null,wr=-1,Ar=0;function dr(){return(he&6)!==0?on():wr!==-1?wr:wr=on()}function Cr(_){return(_.mode&1)===0?1:(he&2)!==0&&Pe!==0?Pe&-Pe:J_.transition!==null?(Ar===0&&(Ar=kp()),Ar):(_=wi,_!==0||(_=window.event,_=_===void 0?16:Rp(_.type)),_)}function vr(_,E,z,K){if(50<$t)throw $t=0,Ut=null,Error(r(185));aa(_,z,K),((he&2)===0||_!==Se)&&(_===Se&&((he&2)===0&&(Ze|=z),je===4&&fn(_,Pe)),jr(_,K),z===1&&he===0&&(E.mode&1)===0&&(Zt=on()+500,Df&&Uc()))}function jr(_,E){var z=_.callbackNode;sg(_,E);var K=Vl(_,_===Se?Pe:0);if(K===0)z!==null&&sn(z),_.callbackNode=null,_.callbackPriority=0;else if(E=K&-K,_.callbackPriority!==E){if(z!=null&&sn(z),E===1)_.tag===0?Y_(Gi.bind(null,_)):qy(Gi.bind(null,_)),_g(function(){(he&6)===0&&Uc()}),z=null;else{switch(Oa(K)){case 1:z=li;break;case 4:z=bi;break;case 16:z=Ci;break;case 536870912:z=Ho;break;default:z=Ci}z=ma(z,Qr.bind(null,_))}_.callbackPriority=E,_.callbackNode=z}}function Qr(_,E){if(wr=-1,Ar=0,(he&6)!==0)throw Error(r(327));var z=_.callbackNode;if(pi()&&_.callbackNode!==z)return null;var K=Vl(_,_===Se?Pe:0);if(K===0)return null;if((K&30)!==0||(K&_.expiredLanes)!==0||E)E=os(_,K);else{E=K;var se=he;he|=2;var me=Ss();(Se!==_||Pe!==E)&&(at=null,Zt=on()+500,On(_,E));do try{pn();break}catch(ht){oi(_,ht)}while(!0);Bf(),fe.current=me,he=se,Ae!==null?E=0:(Se=null,Pe=0,E=je)}if(E!==0){if(E===2&&(se=Ia(_),se!==0&&(K=se,E=_n(_,se))),E===1)throw z=ke,On(_,0),fn(_,K),jr(_,on()),z;if(E===6)fn(_,K);else{if(se=_.current.alternate,(K&30)===0&&!si(se)&&(E=os(_,K),E===2&&(me=Ia(_),me!==0&&(K=me,E=_n(_,me))),E===1))throw z=ke,On(_,0),fn(_,K),jr(_,on()),z;switch(_.finishedWork=se,_.finishedLanes=K,E){case 0:case 1:throw Error(r(345));case 2:ci(_,At,at);break;case 3:if(fn(_,K),(K&130023424)===K&&(E=Mt+500-on(),10<E)){if(Vl(_,0)!==0)break;if(se=_.suspendedLanes,(se&K)!==K){dr(),_.pingedLanes|=_.suspendedLanes&se;break}_.timeoutHandle=Th(ci.bind(null,_,At,at),E);break}ci(_,At,at);break;case 4:if(fn(_,K),(K&4194240)===K)break;for(E=_.eventTimes,se=-1;0<K;){var Re=31-cs(K);me=1<<Re,Re=E[Re],Re>se&&(se=Re),K&=~me}if(K=se,K=on()-K,K=(120>K?120:480>K?480:1080>K?1080:1920>K?1920:3e3>K?3e3:4320>K?4320:1960*ne(K/1960))-K,10<K){_.timeoutHandle=Th(ci.bind(null,_,At,at),K);break}ci(_,At,at);break;case 5:ci(_,At,at);break;default:throw Error(r(329))}}}return jr(_,on()),_.callbackNode===z?Qr.bind(null,_):null}function _n(_,E){var z=ut;return _.current.memoizedState.isDehydrated&&(On(_,E).flags|=256),_=os(_,E),_!==2&&(E=At,At=z,E!==null&&ii(E)),_}function ii(_){At===null?At=_:At.push.apply(At,_)}function si(_){for(var E=_;;){if(E.flags&16384){var z=E.updateQueue;if(z!==null&&(z=z.stores,z!==null))for(var K=0;K<z.length;K++){var se=z[K],me=se.getSnapshot;se=se.value;try{if(!rl(me(),se))return!1}catch{return!1}}}if(z=E.child,E.subtreeFlags&16384&&z!==null)z.return=E,E=z;else{if(E===_)break;for(;E.sibling===null;){if(E.return===null||E.return===_)return!0;E=E.return}E.sibling.return=E.return,E=E.sibling}}return!0}function fn(_,E){for(E&=~yt,E&=~Ze,_.suspendedLanes|=E,_.pingedLanes&=~E,_=_.expirationTimes;0<E;){var z=31-cs(E),K=1<<z;_[z]=-1,E&=~K}}function Gi(_){if((he&6)!==0)throw Error(r(327));pi();var E=Vl(_,0);if((E&1)===0)return jr(_,on()),null;var z=os(_,E);if(_.tag!==0&&z===2){var K=Ia(_);K!==0&&(E=K,z=_n(_,K))}if(z===1)throw z=ke,On(_,0),fn(_,E),jr(_,on()),z;if(z===6)throw Error(r(345));return _.finishedWork=_.current.alternate,_.finishedLanes=E,ci(_,At,at),jr(_,on()),null}function Pi(_,E){var z=he;he|=1;try{return _(E)}finally{he=z,he===0&&(Zt=on()+500,Df&&Uc())}}function en(_){zt!==null&&zt.tag===0&&(he&6)===0&&pi();var E=he;he|=1;var z=ye.transition,K=wi;try{if(ye.transition=null,wi=1,_)return _()}finally{wi=K,ye.transition=z,he=E,(he&6)===0&&Uc()}}function kn(){Be=Fe.current,ts(Fe)}function On(_,E){_.finishedWork=null,_.finishedLanes=0;var z=_.timeoutHandle;if(z!==-1&&(_.timeoutHandle=-1,yg(z)),Ae!==null)for(z=Ae.return;z!==null;){var K=z;switch(qp(K),K.tag){case 1:K=K.type.childContextTypes,K!=null&&Ph();break;case 3:al(),ts(jo),ts(ro),ni();break;case 5:Dh(K);break;case 4:al();break;case 13:ts(us);break;case 19:ts(us);break;case 10:Mu(K.type._context);break;case 22:case 23:kn()}z=z.return}if(Se=_,Ae=_=qa(_.current,null),Pe=Be=E,je=0,ke=null,yt=Ze=qe=0,At=ut=null,Ba!==null){for(E=0;E<Ba.length;E++)if(z=Ba[E],K=z.interleaved,K!==null){z.interleaved=null;var se=K.next,me=z.pending;if(me!==null){var Re=me.next;me.next=se,K.next=Re}z.pending=K}Ba=null}return _}function oi(_,E){do{var z=Ae;try{if(Bf(),Iu.current=Ld,Wc){for(var K=Ms.memoizedState;K!==null;){var se=K.queue;se!==null&&(se.pending=null),K=K.next}Wc=!1}if(ku=0,Eo=io=Ms=null,Ml=!1,er=0,de.current=null,z===null||z.return===null){je=1,ke=E,Ae=null;break}e:{var me=_,Re=z.return,ht=z,bt=E;if(E=Pe,ht.flags|=32768,bt!==null&&typeof bt=="object"&&typeof bt.then=="function"){var nr=bt,Dr=ht,Fr=Dr.tag;if((Dr.mode&1)===0&&(Fr===0||Fr===11||Fr===15)){var Lr=Dr.alternate;Lr?(Dr.updateQueue=Lr.updateQueue,Dr.memoizedState=Lr.memoizedState,Dr.lanes=Lr.lanes):(Dr.updateQueue=null,Dr.memoizedState=null)}var ln=ju(Re);if(ln!==null){ln.flags&=-257,rm(ln,Re,ht,me,E),ln.mode&1&&Jf(me,nr,E),E=ln,bt=nr;var xn=E.updateQueue;if(xn===null){var Cn=new Set;Cn.add(bt),E.updateQueue=Cn}else xn.add(bt);break e}else{if((E&1)===0){Jf(me,nr,E),Hi();break e}bt=Error(r(426))}}else if(ys&&ht.mode&1){var ao=ju(Re);if(ao!==null){(ao.flags&65536)===0&&(ao.flags|=256),rm(ao,Re,ht,me,E),Al(bs(bt,ht));break e}}me=bt=bs(bt,ht),je!==4&&(je=2),ut===null?ut=[me]:ut.push(me),me=Re;do{switch(me.tag){case 3:me.flags|=65536,E&=-E,me.lanes|=E;var qt=qh(me,bt,E);Eg(me,qt);break e;case 1:ht=bt;var It=me.type,Gt=me.stateNode;if((me.flags&128)===0&&(typeof It.getDerivedStateFromError=="function"||Gt!==null&&typeof Gt.componentDidCatch=="function"&&(Lt===null||!Lt.has(Gt)))){me.flags|=65536,E&=-E,me.lanes|=E;var kr=tm(me,ht,E);Eg(me,kr);break e}}me=me.return}while(me!==null)}zn(z)}catch(In){E=In,Ae===z&&z!==null&&(Ae=z=z.return);continue}break}while(!0)}function Ss(){var _=fe.current;return fe.current=Ld,_===null?Ld:_}function Hi(){(je===0||je===3||je===2)&&(je=4),Se===null||(qe&268435455)===0&&(Ze&268435455)===0||fn(Se,Pe)}function os(_,E){var z=he;he|=2;var K=Ss();(Se!==_||Pe!==E)&&(at=null,On(_,E));do try{Di();break}catch(se){oi(_,se)}while(!0);if(Bf(),he=z,fe.current=K,Ae!==null)throw Error(r(261));return Se=null,Pe=0,je}function Di(){for(;Ae!==null;)Si(Ae)}function pn(){for(;Ae!==null&&!Bn();)Si(Ae)}function Si(_){var E=fc(_.alternate,_,Be);_.memoizedProps=_.pendingProps,E===null?zn(_):Ae=E,de.current=null}function zn(_){var E=_;do{var z=E.alternate;if(_=E.return,(E.flags&32768)===0){if(z=ws(z,E,Be),z!==null){Ae=z;return}}else{if(z=Ol(z,E),z!==null){z.flags&=32767,Ae=z;return}if(_!==null)_.flags|=32768,_.subtreeFlags=0,_.deletions=null;else{je=6,Ae=null;return}}if(E=E.sibling,E!==null){Ae=E;return}Ae=E=_}while(E!==null);je===0&&(je=5)}function ci(_,E,z){var K=wi,se=ye.transition;try{ye.transition=null,wi=1,Zn(_,E,z,K)}finally{ye.transition=se,wi=K}return null}function Zn(_,E,z,K){do pi();while(zt!==null);if((he&6)!==0)throw Error(r(327));z=_.finishedWork;var se=_.finishedLanes;if(z===null)return null;if(_.finishedWork=null,_.finishedLanes=0,z===_.current)throw Error(r(177));_.callbackNode=null,_.callbackPriority=0;var me=z.lanes|z.childLanes;if(Mc(_,me),_===Se&&(Ae=Se=null,Pe=0),(z.subtreeFlags&2064)===0&&(z.flags&2064)===0||vt||(vt=!0,ma(Ci,function(){return pi(),null})),me=(z.flags&15990)!==0,(z.subtreeFlags&15990)!==0||me){me=ye.transition,ye.transition=null;var Re=wi;wi=1;var ht=he;he|=4,de.current=null,ll(_,z),M(z,_),il(Eh),fu=!!Sh,Eh=Sh=null,_.current=z,B(z),Tn(),he=ht,wi=Re,ye.transition=me}else _.current=z;if(vt&&(vt=!1,zt=_,Ot=se),me=_.pendingLanes,me===0&&(Lt=null),eo(z.stateNode),jr(_,on()),E!==null)for(K=_.onRecoverableError,z=0;z<E.length;z++)se=E[z],K(se.value,{componentStack:se.stack,digest:se.digest});if(gt)throw gt=!1,_=ot,ot=null,_;return(Ot&1)!==0&&_.tag!==0&&pi(),me=_.pendingLanes,(me&1)!==0?_===Ut?$t++:($t=0,Ut=_):$t=0,Uc(),null}function pi(){if(zt!==null){var _=Oa(Ot),E=ye.transition,z=wi;try{if(ye.transition=null,wi=16>_?16:_,zt===null)var K=!1;else{if(_=zt,zt=null,Ot=0,(he&6)!==0)throw Error(r(331));var se=he;for(he|=4,hn=_.current;hn!==null;){var me=hn,Re=me.child;if((hn.flags&16)!==0){var ht=me.deletions;if(ht!==null){for(var bt=0;bt<ht.length;bt++){var nr=ht[bt];for(hn=nr;hn!==null;){var Dr=hn;switch(Dr.tag){case 0:case 11:case 15:Xc(8,Dr,me)}var Fr=Dr.child;if(Fr!==null)Fr.return=Dr,hn=Fr;else for(;hn!==null;){Dr=hn;var Lr=Dr.sibling,ln=Dr.return;if(dc(Dr),Dr===nr){hn=null;break}if(Lr!==null){Lr.return=ln,hn=Lr;break}hn=ln}}}var xn=me.alternate;if(xn!==null){var Cn=xn.child;if(Cn!==null){xn.child=null;do{var ao=Cn.sibling;Cn.sibling=null,Cn=ao}while(Cn!==null)}}hn=me}}if((me.subtreeFlags&2064)!==0&&Re!==null)Re.return=me,hn=Re;else e:for(;hn!==null;){if(me=hn,(me.flags&2048)!==0)switch(me.tag){case 0:case 11:case 15:Xc(9,me,me.return)}var qt=me.sibling;if(qt!==null){qt.return=me.return,hn=qt;break e}hn=me.return}}var It=_.current;for(hn=It;hn!==null;){Re=hn;var Gt=Re.child;if((Re.subtreeFlags&2064)!==0&&Gt!==null)Gt.return=Re,hn=Gt;else e:for(Re=It;hn!==null;){if(ht=hn,(ht.flags&2048)!==0)try{switch(ht.tag){case 0:case 11:case 15:Nu(9,ht)}}catch(In){Mn(ht,ht.return,In)}if(ht===Re){hn=null;break e}var kr=ht.sibling;if(kr!==null){kr.return=ht.return,hn=kr;break e}hn=ht.return}}if(he=se,Uc(),xs&&typeof xs.onPostCommitFiberRoot=="function")try{xs.onPostCommitFiberRoot(Qs,_)}catch{}K=!0}return K}finally{wi=z,ye.transition=E}}return!1}function Vs(_,E,z){E=bs(z,E),E=qh(_,E,1),_=Hc(_,E,1),E=dr(),_!==null&&(aa(_,1,E),jr(_,E))}function Mn(_,E,z){if(_.tag===3)Vs(_,_,z);else for(;E!==null;){if(E.tag===3){Vs(E,_,z);break}else if(E.tag===1){var K=E.stateNode;if(typeof E.type.getDerivedStateFromError=="function"||typeof K.componentDidCatch=="function"&&(Lt===null||!Lt.has(K))){_=bs(z,_),_=tm(E,_,1),E=Hc(E,_,1),_=dr(),E!==null&&(aa(E,1,_),jr(E,_));break}}E=E.return}}function oo(_,E,z){var K=_.pingCache;K!==null&&K.delete(E),E=dr(),_.pingedLanes|=_.suspendedLanes&z,Se===_&&(Pe&z)===z&&(je===4||je===3&&(Pe&130023424)===Pe&&500>on()-Mt?On(_,0):yt|=z),jr(_,E)}function ds(_,E){E===0&&((_.mode&1)===0?E=1:(E=id,id<<=1,(id&130023424)===0&&(id=4194304)));var z=dr();_=zr(_,E),_!==null&&(aa(_,E,z),jr(_,z))}function yo(_){var E=_.memoizedState,z=0;E!==null&&(z=E.retryLane),ds(_,z)}function Ll(_,E){var z=0;switch(_.tag){case 13:var K=_.stateNode,se=_.memoizedState;se!==null&&(z=se.retryLane);break;case 19:K=_.stateNode;break;default:throw Error(r(314))}K!==null&&K.delete(E),ds(_,z)}var fc;fc=function(_,E,z){if(_!==null)if(_.memoizedProps!==E.pendingProps||jo.current)fo=!0;else{if((_.lanes&z)===0&&(E.flags&128)===0)return fo=!1,e0(_,E,z);fo=(_.flags&131072)!==0}else fo=!1,ys&&(E.flags&1048576)!==0&&Nf(E,kh,E.index);switch(E.lanes=0,E.tag){case 2:var K=E.type;um(_,E),_=E.pendingProps;var se=$c(E,ro.current);yr(E,z),se=ft(null,E,K,_,se,z);var me=Va();return E.flags|=1,typeof se=="object"&&se!==null&&typeof se.render=="function"&&se.$$typeof===void 0?(E.tag=1,E.memoizedState=null,E.updateQueue=null,Do(K)?(me=!0,bd(E)):me=!1,E.memoizedState=se.state!==null&&se.state!==void 0?se.state:null,wg(E),se.updater=kl,E.stateNode=se,se._reactInternals=E,Xf(E,K,_,z),E=sm(null,E,K,!0,me,z)):(E.tag=0,ys&&me&&tc(E),po(null,E,se,z),E=E.child),E;case 16:K=E.elementType;e:{switch(um(_,E),_=E.pendingProps,se=K._init,K=se(K._payload),E.type=K,se=E.tag=Rl(K),_=so(K,_),se){case 0:E=im(null,E,K,_,z);break e;case 1:E=Ig(null,E,K,_,z);break e;case 11:E=nm(null,E,K,_,z);break e;case 14:E=ep(null,E,K,so(K.type,_),z);break e}throw Error(r(306,K,""))}return E;case 0:return K=E.type,se=E.pendingProps,se=E.elementType===K?se:so(K,se),im(_,E,K,se,z);case 1:return K=E.type,se=E.pendingProps,se=E.elementType===K?se:so(K,se),Ig(_,E,K,se,z);case 3:e:{if(om(E),_===null)throw Error(r(387));K=E.pendingProps,me=E.memoizedState,se=me.element,Sg(_,E),Zp(E,K,null,z);var Re=E.memoizedState;if(K=Re.element,me.isDehydrated)if(me={element:K,isDehydrated:!1,cache:Re.cache,pendingSuspenseBoundaries:Re.pendingSuspenseBoundaries,transitions:Re.transitions},E.updateQueue.baseState=me,E.memoizedState=me,E.flags&256){se=bs(Error(r(423)),E),E=kg(_,E,K,z,se);break e}else if(K!==se){se=bs(Error(r(424)),E),E=kg(_,E,K,z,se);break e}else for(ha=zc(E.stateNode.containerInfo.firstChild),As=E,ys=!0,sl=null,z=Rh(E,null,K,z),E.child=z;z;)z.flags=z.flags&-3|4096,z=z.sibling;else{if(Lh(),K===se){E=Ea(_,E,z);break e}po(_,E,K,z)}E=E.child}return E;case 5:return $f(E),_===null&&Hp(E),K=E.type,se=E.pendingProps,me=_!==null?_.memoizedProps:null,Re=se.children,Eu(K,se)?Re=null:me!==null&&Eu(K,me)&&(E.flags|=32),Mg(_,E),po(_,E,Re,z),E.child;case 6:return _===null&&Hp(E),null;case 13:return Og(_,E,z);case 4:return sc(E,E.stateNode.containerInfo),K=E.pendingProps,_===null?E.child=Pl(E,null,K,z):po(_,E,K,z),E.child;case 11:return K=E.type,se=E.pendingProps,se=E.elementType===K?se:so(K,se),nm(_,E,K,se,z);case 7:return po(_,E,E.pendingProps,z),E.child;case 8:return po(_,E,E.pendingProps.children,z),E.child;case 12:return po(_,E,E.pendingProps.children,z),E.child;case 10:e:{if(K=E.type._context,se=E.pendingProps,me=E.memoizedProps,Re=se.value,gs(Au,K._currentValue),K._currentValue=Re,me!==null)if(rl(me.value,Re)){if(me.children===se.children&&!jo.current){E=Ea(_,E,z);break e}}else for(me=E.child,me!==null&&(me.return=E);me!==null;){var ht=me.dependencies;if(ht!==null){Re=me.child;for(var bt=ht.firstContext;bt!==null;){if(bt.context===K){if(me.tag===1){bt=$a(-1,z&-z),bt.tag=2;var nr=me.updateQueue;if(nr!==null){nr=nr.shared;var Dr=nr.pending;Dr===null?bt.next=bt:(bt.next=Dr.next,Dr.next=bt),nr.pending=bt}}me.lanes|=z,bt=me.alternate,bt!==null&&(bt.lanes|=z),Ad(me.return,z,E),ht.lanes|=z;break}bt=bt.next}}else if(me.tag===10)Re=me.type===E.type?null:me.child;else if(me.tag===18){if(Re=me.return,Re===null)throw Error(r(341));Re.lanes|=z,ht=Re.alternate,ht!==null&&(ht.lanes|=z),Ad(Re,z,E),Re=me.sibling}else Re=me.child;if(Re!==null)Re.return=me;else for(Re=me;Re!==null;){if(Re===E){Re=null;break}if(me=Re.sibling,me!==null){me.return=Re.return,Re=me;break}Re=Re.return}me=Re}po(_,E,se.children,z),E=E.child}return E;case 9:return se=E.type,K=E.pendingProps.children,yr(E,z),se=Qo(se),K=K(se),E.flags|=1,po(_,E,K,z),E.child;case 14:return K=E.type,se=so(K,E.pendingProps),se=so(K.type,se),ep(_,E,K,se,z);case 15:return Pg(_,E,E.type,E.pendingProps,z);case 17:return K=E.type,se=E.pendingProps,se=E.elementType===K?se:so(K,se),um(_,E),E.tag=1,Do(K)?(_=!0,bd(E)):_=!1,yr(E,z),Zf(E,K,se),Xf(E,K,se,z),sm(null,E,K,!0,_,z);case 19:return Lg(_,E,z);case 22:return tp(_,E,z)}throw Error(r(156,E.tag))};function ma(_,E){return Qn(_,E)}function dl(_,E,z,K){this.tag=_,this.key=z,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=E,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=K,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ws(_,E,z,K){return new dl(_,E,z,K)}function hl(_){return _=_.prototype,!(!_||!_.isReactComponent)}function Rl(_){if(typeof _=="function")return hl(_)?1:0;if(_!=null){if(_=_.$$typeof,_===Le)return 11;if(_===Je)return 14}return 2}function qa(_,E){var z=_.alternate;return z===null?(z=Ws(_.tag,E,_.key,_.mode),z.elementType=_.elementType,z.type=_.type,z.stateNode=_.stateNode,z.alternate=_,_.alternate=z):(z.pendingProps=E,z.type=_.type,z.flags=0,z.subtreeFlags=0,z.deletions=null),z.flags=_.flags&14680064,z.childLanes=_.childLanes,z.lanes=_.lanes,z.child=_.child,z.memoizedProps=_.memoizedProps,z.memoizedState=_.memoizedState,z.updateQueue=_.updateQueue,E=_.dependencies,z.dependencies=E===null?null:{lanes:E.lanes,firstContext:E.firstContext},z.sibling=_.sibling,z.index=_.index,z.ref=_.ref,z}function pc(_,E,z,K,se,me){var Re=2;if(K=_,typeof _=="function")hl(_)&&(Re=1);else if(typeof _=="string")Re=5;else e:switch(_){case ie:return mc(z.children,se,me,E);case ce:Re=8,se|=8;break;case ge:return _=Ws(12,z,E,se|2),_.elementType=ge,_.lanes=me,_;case ze:return _=Ws(13,z,E,se),_.elementType=ze,_.lanes=me,_;case Xe:return _=Ws(19,z,E,se),_.elementType=Xe,_.lanes=me,_;case st:return Dd(z,se,me,E);default:if(typeof _=="object"&&_!==null)switch(_.$$typeof){case be:Re=10;break e;case xe:Re=9;break e;case Le:Re=11;break e;case Je:Re=14;break e;case tt:Re=16,K=null;break e}throw Error(r(130,_==null?_:typeof _,""))}return E=Ws(Re,z,E,se),E.elementType=_,E.type=K,E.lanes=me,E}function mc(_,E,z,K){return _=Ws(7,_,K,E),_.lanes=z,_}function Dd(_,E,z,K){return _=Ws(22,_,K,E),_.elementType=st,_.lanes=z,_.stateNode={isHidden:!1},_}function Hh(_,E,z){return _=Ws(6,_,null,E),_.lanes=z,_}function Nd(_,E,z){return E=Ws(4,_.children!==null?_.children:[],_.key,E),E.lanes=z,E.stateNode={containerInfo:_.containerInfo,pendingChildren:null,implementation:_.implementation},E}function Mi(_,E,z,K,se){this.tag=E,this.containerInfo=_,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Wo(0),this.expirationTimes=Wo(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Wo(0),this.identifierPrefix=K,this.onRecoverableError=se,this.mutableSourceEagerHydrationData=null}function Fu(_,E,z,K,se,me,Re,ht,bt){return _=new Mi(_,E,z,ht,bt),E===1?(E=1,me===!0&&(E|=8)):E=0,me=Ws(3,null,null,E),_.current=me,me.stateNode=_,me.memoizedState={element:K,isDehydrated:z,cache:null,transitions:null,pendingSuspenseBoundaries:null},wg(me),_}function Rg(_,E,z){var K=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Y,key:K==null?null:""+K,children:_,containerInfo:E,implementation:z}}function t0(_){if(!_)return Bs;_=_._reactInternals;e:{if(ar(_)!==_||_.tag!==1)throw Error(r(170));var E=_;do{switch(E.tag){case 3:E=E.stateNode.context;break e;case 1:if(Do(E.type)){E=E.stateNode.__reactInternalMemoizedMergedChildContext;break e}}E=E.return}while(E!==null);throw Error(r(171))}if(_.tag===1){var z=_.type;if(Do(z))return Vp(_,z,E)}return E}function i1(_,E,z,K,se,me,Re,ht,bt){return _=Fu(z,K,!0,_,se,me,Re,ht,bt),_.context=t0(null),z=_.current,K=dr(),se=Cr(z),me=$a(K,se),me.callback=E??null,Hc(z,me,se),_.current.lanes=se,aa(_,se,K),jr(_,K),_}function pm(_,E,z,K){var se=E.current,me=dr(),Re=Cr(se);return z=t0(z),E.context===null?E.context=z:E.pendingContext=z,E=$a(me,Re),E.payload={element:_},K=K===void 0?null:K,K!==null&&(E.callback=K),_=Hc(se,E,Re),_!==null&&(vr(_,se,Re,me),Wp(_,se,Re)),Re}function jl(_){if(_=_.current,!_.child)return null;switch(_.child.tag){case 5:return _.child.stateNode;default:return _.child.stateNode}}function Bu(_,E){if(_=_.memoizedState,_!==null&&_.dehydrated!==null){var z=_.retryLane;_.retryLane=z!==0&&z<E?z:E}}function Yy(_,E){Bu(_,E),(_=_.alternate)&&Bu(_,E)}function s1(){return null}var jg=typeof reportError=="function"?reportError:function(_){console.error(_)};function Dg(_){this._internalRoot=_}Wh.prototype.render=Dg.prototype.render=function(_){var E=this._internalRoot;if(E===null)throw Error(r(409));pm(_,E,null,null)},Wh.prototype.unmount=Dg.prototype.unmount=function(){var _=this._internalRoot;if(_!==null){this._internalRoot=null;var E=_.containerInfo;en(function(){pm(null,_,null,null)}),E[Fc]=null}};function Wh(_){this._internalRoot=_}Wh.prototype.unstable_scheduleHydration=function(_){if(_){var E=ih();_={blockedOn:null,target:_,priority:E};for(var z=0;z<Sl.length&&E!==0&&E<Sl[z].priority;z++);Sl.splice(z,0,_),z===0&&og(_)}};function mm(_){return!(!_||_.nodeType!==1&&_.nodeType!==9&&_.nodeType!==11)}function Ng(_){return!(!_||_.nodeType!==1&&_.nodeType!==9&&_.nodeType!==11&&(_.nodeType!==8||_.nodeValue!==" react-mount-point-unstable "))}function zg(){}function r0(_,E,z,K,se){if(se){if(typeof K=="function"){var me=K;K=function(){var nr=jl(Re);me.call(nr)}}var Re=i1(E,K,_,0,null,!1,!1,"",zg);return _._reactRootContainer=Re,_[Fc]=Re.current,kf(_.nodeType===8?_.parentNode:_),en(),Re}for(;se=_.lastChild;)_.removeChild(se);if(typeof K=="function"){var ht=K;K=function(){var nr=jl(bt);ht.call(nr)}}var bt=Fu(_,0,!1,null,null,!1,!1,"",zg);return _._reactRootContainer=bt,_[Fc]=bt.current,kf(_.nodeType===8?_.parentNode:_),en(function(){pm(E,bt,z,K)}),bt}function gm(_,E,z,K,se){var me=z._reactRootContainer;if(me){var Re=me;if(typeof se=="function"){var ht=se;se=function(){var bt=jl(Re);ht.call(bt)}}pm(E,Re,_,se)}else Re=r0(z,E,_,se,K);return jl(Re)}nh=function(_){switch(_.tag){case 3:var E=_.stateNode;if(E.current.memoizedState.isDehydrated){var z=Pc(E.pendingLanes);z!==0&&(ka(E,z|1),jr(E,on()),(he&6)===0&&(Zt=on()+500,Uc()))}break;case 13:en(function(){var K=zr(_,1);if(K!==null){var se=dr();vr(K,_,1,se)}}),Yy(_,1)}},vf=function(_){if(_.tag===13){var E=zr(_,134217728);if(E!==null){var z=dr();vr(E,_,134217728,z)}Yy(_,134217728)}},Ul=function(_){if(_.tag===13){var E=Cr(_),z=zr(_,E);if(z!==null){var K=dr();vr(z,_,E,K)}Yy(_,E)}},ih=function(){return wi},Op=function(_,E){var z=wi;try{return wi=_,E()}finally{wi=z}},Io=function(_,E,z){switch(E){case"input":if(Vr(_,z),E=z.name,z.type==="radio"&&E!=null){for(z=_;z.parentNode;)z=z.parentNode;for(z=z.querySelectorAll("input[name="+JSON.stringify(""+E)+'][type="radio"]'),E=0;E<z.length;E++){var K=z[E];if(K!==_&&K.form===_.form){var se=Ah(K);if(!se)throw Error(r(90));Jt(K),Vr(K,se)}}}break;case"textarea":xr(_,z);break;case"select":E=z.value,E!=null&&un(_,!!z.multiple,E,!1)}},Hs=Pi,Go=en;var o1={usingClientEntryPoint:!1,Events:[xd,Tu,Ah,oa,Qt,Pi]},ym={findFiberByHostInstance:Bc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Zh={bundleType:ym.bundleType,version:ym.version,rendererPackageName:ym.rendererPackageName,rendererConfig:ym.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:J.ReactCurrentDispatcher,findHostInstanceByFiber:function(_){return _=Jr(_),_===null?null:_.stateNode},findFiberByHostInstance:ym.findFiberByHostInstance||s1,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Fg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Fg.isDisabled&&Fg.supportsFiber)try{Qs=Fg.inject(Zh),xs=Fg}catch{}}return vc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=o1,vc.createPortal=function(_,E){var z=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!mm(E))throw Error(r(200));return Rg(_,E,null,z)},vc.createRoot=function(_,E){if(!mm(_))throw Error(r(299));var z=!1,K="",se=jg;return E!=null&&(E.unstable_strictMode===!0&&(z=!0),E.identifierPrefix!==void 0&&(K=E.identifierPrefix),E.onRecoverableError!==void 0&&(se=E.onRecoverableError)),E=Fu(_,1,!1,null,null,z,!1,K,se),_[Fc]=E.current,kf(_.nodeType===8?_.parentNode:_),new Dg(E)},vc.findDOMNode=function(_){if(_==null)return null;if(_.nodeType===1)return _;var E=_._reactInternals;if(E===void 0)throw typeof _.render=="function"?Error(r(188)):(_=Object.keys(_).join(","),Error(r(268,_)));return _=Jr(E),_=_===null?null:_.stateNode,_},vc.flushSync=function(_){return en(_)},vc.hydrate=function(_,E,z){if(!Ng(E))throw Error(r(200));return gm(null,_,E,!0,z)},vc.hydrateRoot=function(_,E,z){if(!mm(_))throw Error(r(405));var K=z!=null&&z.hydratedSources||null,se=!1,me="",Re=jg;if(z!=null&&(z.unstable_strictMode===!0&&(se=!0),z.identifierPrefix!==void 0&&(me=z.identifierPrefix),z.onRecoverableError!==void 0&&(Re=z.onRecoverableError)),E=i1(E,null,_,1,z??null,se,!1,me,Re),_[Fc]=E.current,kf(_),K)for(_=0;_<K.length;_++)z=K[_],se=z._getVersion,se=se(z._source),E.mutableSourceEagerHydrationData==null?E.mutableSourceEagerHydrationData=[z,se]:E.mutableSourceEagerHydrationData.push(z,se);return new Wh(E)},vc.render=function(_,E,z){if(!Ng(E))throw Error(r(200));return gm(null,_,E,!1,z)},vc.unmountComponentAtNode=function(_){if(!Ng(_))throw Error(r(40));return _._reactRootContainer?(en(function(){gm(null,null,_,!1,function(){_._reactRootContainer=null,_[Fc]=null})}),!0):!1},vc.unstable_batchedUpdates=Pi,vc.unstable_renderSubtreeIntoContainer=function(_,E,z,K){if(!Ng(z))throw Error(r(200));if(_==null||_._reactInternals===void 0)throw Error(r(38));return gm(_,E,z,!1,K)},vc.version="18.3.1-next-f1338f8080-20240426",vc}var qF;function sH(){if(qF)return fC.exports;qF=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),fC.exports=Lne(),fC.exports}var GF;function Rne(){if(GF)return Q1;GF=1;var e=sH();return Q1.createRoot=e.createRoot,Q1.hydrateRoot=e.hydrateRoot,Q1}var jne=Rne();const Dne=vs(jne);var Cp=sH();const oH=vs(Cp);/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Px(){return Px=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Px.apply(this,arguments)}var Lm;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Lm||(Lm={}));const HF="popstate";function Nne(e){e===void 0&&(e={});function t(n,a){let{pathname:u,search:f,hash:i}=n.location;return Kk("",{pathname:u,search:f,hash:i},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function r(n,a){return typeof a=="string"?a:Qw(a)}return Fne(t,r,null,e)}function Vo(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function aH(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function zne(){return Math.random().toString(36).substr(2,8)}function WF(e,t){return{usr:e.state,key:e.key,idx:t}}function Kk(e,t,r,n){return r===void 0&&(r=null),Px({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?T_(t):t,{state:r,key:t&&t.key||n||zne()})}function Qw(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function T_(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function Fne(e,t,r,n){n===void 0&&(n={});let{window:a=document.defaultView,v5Compat:u=!1}=n,f=a.history,i=Lm.Pop,y=null,w=T();w==null&&(w=0,f.replaceState(Px({},f.state,{idx:w}),""));function T(){return(f.state||{idx:null}).idx}function A(){i=Lm.Pop;let N=T(),V=N==null?null:N-w;w=N,y&&y({action:i,location:O.location,delta:V})}function k(N,V){i=Lm.Push;let H=Kk(O.location,N,V);w=T()+1;let Z=WF(H,w),J=O.createHref(H);try{f.pushState(Z,"",J)}catch(G){if(G instanceof DOMException&&G.name==="DataCloneError")throw G;a.location.assign(J)}u&&y&&y({action:i,location:O.location,delta:1})}function F(N,V){i=Lm.Replace;let H=Kk(O.location,N,V);w=T();let Z=WF(H,w),J=O.createHref(H);f.replaceState(Z,"",J),u&&y&&y({action:i,location:O.location,delta:0})}function D(N){let V=a.location.origin!=="null"?a.location.origin:a.location.href,H=typeof N=="string"?N:Qw(N);return H=H.replace(/ $/,"%20"),Vo(V,"No window.location.(origin|href) available to create URL for href: "+H),new URL(H,V)}let O={get action(){return i},get location(){return e(a,f)},listen(N){if(y)throw new Error("A history only accepts one active listener");return a.addEventListener(HF,A),y=N,()=>{a.removeEventListener(HF,A),y=null}},createHref(N){return t(a,N)},createURL:D,encodeLocation(N){let V=D(N);return{pathname:V.pathname,search:V.search,hash:V.hash}},push:k,replace:F,go(N){return f.go(N)}};return O}var ZF;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(ZF||(ZF={}));function Bne(e,t,r){return r===void 0&&(r="/"),$ne(e,t,r)}function $ne(e,t,r,n){let a=typeof t=="string"?T_(t):t,u=CR(a.pathname||"/",r);if(u==null)return null;let f=lH(e);Vne(f);let i=null;for(let y=0;i==null&&y<f.length;++y){let w=eie(u);i=Yne(f[y],w)}return i}function lH(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),n===void 0&&(n="");let a=(u,f,i)=>{let y={relativePath:i===void 0?u.path||"":i,caseSensitive:u.caseSensitive===!0,childrenIndex:f,route:u};y.relativePath.startsWith("/")&&(Vo(y.relativePath.startsWith(n),'Absolute route path "'+y.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),y.relativePath=y.relativePath.slice(n.length));let w=Fm([n,y.relativePath]),T=r.concat(y);u.children&&u.children.length>0&&(Vo(u.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+w+'".')),lH(u.children,t,T,w)),!(u.path==null&&!u.index)&&t.push({path:w,score:Xne(w,u.index),routesMeta:T})};return e.forEach((u,f)=>{var i;if(u.path===""||!((i=u.path)!=null&&i.includes("?")))a(u,f);else for(let y of cH(u.path))a(u,f,y)}),t}function cH(e){let t=e.split("/");if(t.length===0)return[];let[r,...n]=t,a=r.endsWith("?"),u=r.replace(/\?$/,"");if(n.length===0)return a?[u,""]:[u];let f=cH(n.join("/")),i=[];return i.push(...f.map(y=>y===""?u:[u,y].join("/"))),a&&i.push(...f),i.map(y=>e.startsWith("/")&&y===""?"/":y)}function Vne(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:Kne(t.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const Une=/^:[\w-]+$/,qne=3,Gne=2,Hne=1,Wne=10,Zne=-2,XF=e=>e==="*";function Xne(e,t){let r=e.split("/"),n=r.length;return r.some(XF)&&(n+=Zne),t&&(n+=Gne),r.filter(a=>!XF(a)).reduce((a,u)=>a+(Une.test(u)?qne:u===""?Hne:Wne),n)}function Kne(e,t){return e.length===t.length&&e.slice(0,-1).every((n,a)=>n===t[a])?e[e.length-1]-t[t.length-1]:0}function Yne(e,t,r){let{routesMeta:n}=e,a={},u="/",f=[];for(let i=0;i<n.length;++i){let y=n[i],w=i===n.length-1,T=u==="/"?t:t.slice(u.length)||"/",A=Jne({path:y.relativePath,caseSensitive:y.caseSensitive,end:w},T),k=y.route;if(!A)return null;Object.assign(a,A.params),f.push({params:a,pathname:Fm([u,A.pathname]),pathnameBase:iie(Fm([u,A.pathnameBase])),route:k}),A.pathnameBase!=="/"&&(u=Fm([u,A.pathnameBase]))}return f}function Jne(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=Qne(e.path,e.caseSensitive,e.end),a=t.match(r);if(!a)return null;let u=a[0],f=u.replace(/(.)\/+$/,"$1"),i=a.slice(1);return{params:n.reduce((w,T,A)=>{let{paramName:k,isOptional:F}=T;if(k==="*"){let O=i[A]||"";f=u.slice(0,u.length-O.length).replace(/(.)\/+$/,"$1")}const D=i[A];return F&&!D?w[k]=void 0:w[k]=(D||"").replace(/%2F/g,"/"),w},{}),pathname:u,pathnameBase:f,pattern:e}}function Qne(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),aH(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let n=[],a="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(f,i,y)=>(n.push({paramName:i,isOptional:y!=null}),y?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(n.push({paramName:"*"}),a+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?a+="\\/*$":e!==""&&e!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,t?void 0:"i"),n]}function eie(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return aH(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function CR(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&n!=="/"?null:e.slice(r)||"/"}function tie(e,t){t===void 0&&(t="/");let{pathname:r,search:n="",hash:a=""}=typeof e=="string"?T_(e):e;return{pathname:r?r.startsWith("/")?r:rie(r,t):t,search:sie(n),hash:oie(a)}}function rie(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(a=>{a===".."?r.length>1&&r.pop():a!=="."&&r.push(a)}),r.length>1?r.join("/"):"/"}function gC(e,t,r,n){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function nie(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function AR(e,t){let r=nie(e);return t?r.map((n,a)=>a===r.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function PR(e,t,r,n){n===void 0&&(n=!1);let a;typeof e=="string"?a=T_(e):(a=Px({},e),Vo(!a.pathname||!a.pathname.includes("?"),gC("?","pathname","search",a)),Vo(!a.pathname||!a.pathname.includes("#"),gC("#","pathname","hash",a)),Vo(!a.search||!a.search.includes("#"),gC("#","search","hash",a)));let u=e===""||a.pathname==="",f=u?"/":a.pathname,i;if(f==null)i=r;else{let A=t.length-1;if(!n&&f.startsWith("..")){let k=f.split("/");for(;k[0]==="..";)k.shift(),A-=1;a.pathname=k.join("/")}i=A>=0?t[A]:"/"}let y=tie(a,i),w=f&&f!=="/"&&f.endsWith("/"),T=(u||f===".")&&r.endsWith("/");return!y.pathname.endsWith("/")&&(w||T)&&(y.pathname+="/"),y}const Fm=e=>e.join("/").replace(/\/\/+/g,"/"),iie=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),sie=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,oie=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function aie(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const uH=["post","put","patch","delete"];new Set(uH);const lie=["get",...uH];new Set(lie);/**
 * React Router v6.30.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Mx(){return Mx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Mx.apply(this,arguments)}const MR=j.createContext(null),cie=j.createContext(null),Xm=j.createContext(null),LE=j.createContext(null),Ap=j.createContext({outlet:null,matches:[],isDataRoute:!1}),dH=j.createContext(null);function uie(e,t){let{relative:r}=t===void 0?{}:t;C_()||Vo(!1);let{basename:n,navigator:a}=j.useContext(Xm),{hash:u,pathname:f,search:i}=fH(e,{relative:r}),y=f;return n!=="/"&&(y=f==="/"?n:Fm([n,f])),a.createHref({pathname:y,search:i,hash:u})}function C_(){return j.useContext(LE)!=null}function Sc(){return C_()||Vo(!1),j.useContext(LE).location}function hH(e){j.useContext(Xm).static||j.useLayoutEffect(e)}function Mo(){let{isDataRoute:e}=j.useContext(Ap);return e?Sie():die()}function die(){C_()||Vo(!1);let e=j.useContext(MR),{basename:t,future:r,navigator:n}=j.useContext(Xm),{matches:a}=j.useContext(Ap),{pathname:u}=Sc(),f=JSON.stringify(AR(a,r.v7_relativeSplatPath)),i=j.useRef(!1);return hH(()=>{i.current=!0}),j.useCallback(function(w,T){if(T===void 0&&(T={}),!i.current)return;if(typeof w=="number"){n.go(w);return}let A=PR(w,JSON.parse(f),u,T.relative==="path");e==null&&t!=="/"&&(A.pathname=A.pathname==="/"?t:Fm([t,A.pathname])),(T.replace?n.replace:n.push)(A,T.state,T)},[t,n,f,u,e])}function IR(){let{matches:e}=j.useContext(Ap),t=e[e.length-1];return t?t.params:{}}function fH(e,t){let{relative:r}=t===void 0?{}:t,{future:n}=j.useContext(Xm),{matches:a}=j.useContext(Ap),{pathname:u}=Sc(),f=JSON.stringify(AR(a,n.v7_relativeSplatPath));return j.useMemo(()=>PR(e,JSON.parse(f),u,r==="path"),[e,f,u,r])}function hie(e,t){return fie(e,t)}function fie(e,t,r,n){C_()||Vo(!1);let{navigator:a,static:u}=j.useContext(Xm),{matches:f}=j.useContext(Ap),i=f[f.length-1],y=i?i.params:{};i&&i.pathname;let w=i?i.pathnameBase:"/";i&&i.route;let T=Sc(),A;if(t){var k;let V=typeof t=="string"?T_(t):t;w==="/"||(k=V.pathname)!=null&&k.startsWith(w)||Vo(!1),A=V}else A=T;let F=A.pathname||"/",D=F;if(w!=="/"){let V=w.replace(/^\//,"").split("/");D="/"+F.replace(/^\//,"").split("/").slice(V.length).join("/")}let O=Bne(e,{pathname:D}),N=vie(O&&O.map(V=>Object.assign({},V,{params:Object.assign({},y,V.params),pathname:Fm([w,a.encodeLocation?a.encodeLocation(V.pathname).pathname:V.pathname]),pathnameBase:V.pathnameBase==="/"?w:Fm([w,a.encodeLocation?a.encodeLocation(V.pathnameBase).pathname:V.pathnameBase])})),f,r,n);return t&&N?j.createElement(LE.Provider,{value:{location:Mx({pathname:"/",search:"",hash:"",state:null,key:"default"},A),navigationType:Lm.Pop}},N):N}function pie(){let e=wie(),t=aie(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,a={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return j.createElement(j.Fragment,null,j.createElement("h2",null,"Unexpected Application Error!"),j.createElement("h3",{style:{fontStyle:"italic"}},t),r?j.createElement("pre",{style:a},r):null,null)}const mie=j.createElement(pie,null);class gie extends j.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?j.createElement(Ap.Provider,{value:this.props.routeContext},j.createElement(dH.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function yie(e){let{routeContext:t,match:r,children:n}=e,a=j.useContext(MR);return a&&a.static&&a.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=r.route.id),j.createElement(Ap.Provider,{value:t},n)}function vie(e,t,r,n){var a;if(t===void 0&&(t=[]),r===void 0&&(r=null),n===void 0&&(n=null),e==null){var u;if(!r)return null;if(r.errors)e=r.matches;else if((u=n)!=null&&u.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let f=e,i=(a=r)==null?void 0:a.errors;if(i!=null){let T=f.findIndex(A=>A.route.id&&(i==null?void 0:i[A.route.id])!==void 0);T>=0||Vo(!1),f=f.slice(0,Math.min(f.length,T+1))}let y=!1,w=-1;if(r&&n&&n.v7_partialHydration)for(let T=0;T<f.length;T++){let A=f[T];if((A.route.HydrateFallback||A.route.hydrateFallbackElement)&&(w=T),A.route.id){let{loaderData:k,errors:F}=r,D=A.route.loader&&k[A.route.id]===void 0&&(!F||F[A.route.id]===void 0);if(A.route.lazy||D){y=!0,w>=0?f=f.slice(0,w+1):f=[f[0]];break}}}return f.reduceRight((T,A,k)=>{let F,D=!1,O=null,N=null;r&&(F=i&&A.route.id?i[A.route.id]:void 0,O=A.route.errorElement||mie,y&&(w<0&&k===0?(Eie("route-fallback"),D=!0,N=null):w===k&&(D=!0,N=A.route.hydrateFallbackElement||null)));let V=t.concat(f.slice(0,k+1)),H=()=>{let Z;return F?Z=O:D?Z=N:A.route.Component?Z=j.createElement(A.route.Component,null):A.route.element?Z=A.route.element:Z=T,j.createElement(yie,{match:A,routeContext:{outlet:T,matches:V,isDataRoute:r!=null},children:Z})};return r&&(A.route.ErrorBoundary||A.route.errorElement||k===0)?j.createElement(gie,{location:r.location,revalidation:r.revalidation,component:O,error:F,children:H(),routeContext:{outlet:null,matches:V,isDataRoute:!0}}):H()},null)}var pH=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(pH||{}),mH=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(mH||{});function _ie(e){let t=j.useContext(MR);return t||Vo(!1),t}function xie(e){let t=j.useContext(cie);return t||Vo(!1),t}function bie(e){let t=j.useContext(Ap);return t||Vo(!1),t}function gH(e){let t=bie(),r=t.matches[t.matches.length-1];return r.route.id||Vo(!1),r.route.id}function wie(){var e;let t=j.useContext(dH),r=xie(),n=gH();return t!==void 0?t:(e=r.errors)==null?void 0:e[n]}function Sie(){let{router:e}=_ie(pH.UseNavigateStable),t=gH(mH.UseNavigateStable),r=j.useRef(!1);return hH(()=>{r.current=!0}),j.useCallback(function(a,u){u===void 0&&(u={}),r.current&&(typeof a=="number"?e.navigate(a):e.navigate(a,Mx({fromRouteId:t},u)))},[e,t])}const KF={};function Eie(e,t,r){KF[e]||(KF[e]=!0)}function Tie(e,t){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function Cie(e){let{to:t,replace:r,state:n,relative:a}=e;C_()||Vo(!1);let{future:u,static:f}=j.useContext(Xm),{matches:i}=j.useContext(Ap),{pathname:y}=Sc(),w=Mo(),T=PR(t,AR(i,u.v7_relativeSplatPath),y,a==="path"),A=JSON.stringify(T);return j.useEffect(()=>w(JSON.parse(A),{replace:r,state:n,relative:a}),[w,A,a,r,n]),null}function Is(e){Vo(!1)}function Aie(e){let{basename:t="/",children:r=null,location:n,navigationType:a=Lm.Pop,navigator:u,static:f=!1,future:i}=e;C_()&&Vo(!1);let y=t.replace(/^\/*/,"/"),w=j.useMemo(()=>({basename:y,navigator:u,static:f,future:Mx({v7_relativeSplatPath:!1},i)}),[y,i,u,f]);typeof n=="string"&&(n=T_(n));let{pathname:T="/",search:A="",hash:k="",state:F=null,key:D="default"}=n,O=j.useMemo(()=>{let N=CR(T,y);return N==null?null:{location:{pathname:N,search:A,hash:k,state:F,key:D},navigationType:a}},[y,T,A,k,F,D,a]);return O==null?null:j.createElement(Xm.Provider,{value:w},j.createElement(LE.Provider,{children:r,value:O}))}function Pie(e){let{children:t,location:r}=e;return hie(Yk(t),r)}new Promise(()=>{});function Yk(e,t){t===void 0&&(t=[]);let r=[];return j.Children.forEach(e,(n,a)=>{if(!j.isValidElement(n))return;let u=[...t,a];if(n.type===j.Fragment){r.push.apply(r,Yk(n.props.children,u));return}n.type!==Is&&Vo(!1),!n.props.index||!n.props.children||Vo(!1);let f={id:n.props.id||u.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(f.children=Yk(n.props.children,u)),r.push(f)}),r}/**
 * React Router DOM v6.30.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Jk(){return Jk=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Jk.apply(this,arguments)}function Mie(e,t){if(e==null)return{};var r={},n=Object.keys(e),a,u;for(u=0;u<n.length;u++)a=n[u],!(t.indexOf(a)>=0)&&(r[a]=e[a]);return r}function Iie(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function kie(e,t){return e.button===0&&(!t||t==="_self")&&!Iie(e)}function Qk(e){return e===void 0&&(e=""),new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,r)=>{let n=e[r];return t.concat(Array.isArray(n)?n.map(a=>[r,a]):[[r,n]])},[]))}function Oie(e,t){let r=Qk(e);return t&&t.forEach((n,a)=>{r.has(a)||t.getAll(a).forEach(u=>{r.append(a,u)})}),r}const Lie=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Rie="6";try{window.__reactRouterVersion=Rie}catch{}const jie="startTransition",YF=TR[jie];function Die(e){let{basename:t,children:r,future:n,window:a}=e,u=j.useRef();u.current==null&&(u.current=Nne({window:a,v5Compat:!0}));let f=u.current,[i,y]=j.useState({action:f.action,location:f.location}),{v7_startTransition:w}=n||{},T=j.useCallback(A=>{w&&YF?YF(()=>y(A)):y(A)},[y,w]);return j.useLayoutEffect(()=>f.listen(T),[f,T]),j.useEffect(()=>Tie(n),[n]),j.createElement(Aie,{basename:t,children:r,location:i.location,navigationType:i.action,navigator:f,future:n})}const Nie=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",zie=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Bo=j.forwardRef(function(t,r){let{onClick:n,relative:a,reloadDocument:u,replace:f,state:i,target:y,to:w,preventScrollReset:T,viewTransition:A}=t,k=Mie(t,Lie),{basename:F}=j.useContext(Xm),D,O=!1;if(typeof w=="string"&&zie.test(w)&&(D=w,Nie))try{let Z=new URL(window.location.href),J=w.startsWith("//")?new URL(Z.protocol+w):new URL(w),G=CR(J.pathname,F);J.origin===Z.origin&&G!=null?w=G+J.search+J.hash:O=!0}catch{}let N=uie(w,{relative:a}),V=Fie(w,{replace:f,state:i,target:y,preventScrollReset:T,relative:a,viewTransition:A});function H(Z){n&&n(Z),Z.defaultPrevented||V(Z)}return j.createElement("a",Jk({},k,{href:D||N,onClick:O||u?n:H,ref:r,target:y}))});var JF;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(JF||(JF={}));var QF;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(QF||(QF={}));function Fie(e,t){let{target:r,replace:n,state:a,preventScrollReset:u,relative:f,viewTransition:i}=t===void 0?{}:t,y=Mo(),w=Sc(),T=fH(e,{relative:f});return j.useCallback(A=>{if(kie(A,r)){A.preventDefault();let k=n!==void 0?n:Qw(w)===Qw(T);y(e,{replace:k,state:a,preventScrollReset:u,relative:f,viewTransition:i})}},[w,y,T,n,a,r,e,u,f,i])}function Bie(e){let t=j.useRef(Qk(e)),r=j.useRef(!1),n=Sc(),a=j.useMemo(()=>Oie(n.search,r.current?null:t.current),[n.search]),u=Mo(),f=j.useCallback((i,y)=>{const w=Qk(typeof i=="function"?i(a):i);r.current=!0,u("?"+w,y)},[u,a]);return[a,f]}const $n={HOME:"/",LOGIN:"/login",REGISTER:"/register",CONFIRMATION:"/register/confirmation",SERVICE_CREATE:"/creation/service",CREATION_PAGE:"/creation",CREATION_SMART_SERVICE:"/creation-smart-service",FORMULAIRE_YUKPO_INTELLIGENT:"/formulaire-yukpo-intelligent",FORMULAIRE_SERVICE_MODERNE:"/formulaire-service-moderne",RECHERCHE_BESOIN:"/recherche-besoin",YUKPO_IA_HUB:"/ia-hub",CHAT_DIALOG:"/chat/:client_id",MON_SOLDE:"/mon-solde",RECHARGE_TOKENS:"/recharge-tokens",SERVICES:"/services",CATALOGUE:"/catalogue",CONTACT:"/contact",ABOUT:"/about",ESPACE:"/espace",DASHBOARD_ADMIN_AUDIT:"/admin/audit",MES_SERVICES:"/dashboard/mes-services",DASHBOARD:"/dashboard",DASHBOARD_ADMIN_API:"/admin/api",PLANS:"/plans"};class ix extends Error{}ix.prototype.name="InvalidTokenError";function $ie(e){return decodeURIComponent(atob(e).replace(/(.)/g,(t,r)=>{let n=r.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))}function Vie(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return $ie(t)}catch{return atob(t)}}function yH(e,t){if(typeof e!="string")throw new ix("Invalid token specified: must be a string");t||(t={});const r=t.header===!0?0:1,n=e.split(".")[r];if(typeof n!="string")throw new ix(`Invalid token specified: missing part #${r+1}`);let a;try{a=Vie(n)}catch(u){throw new ix(`Invalid token specified: invalid base64 for part #${r+1} (${u.message})`)}try{return JSON.parse(a)}catch(u){throw new ix(`Invalid token specified: invalid json for part #${r+1} (${u.message})`)}}const Rs=()=>{const[e,t]=j.useState(null),[r,n]=j.useState(!0),a=j.useRef(!1),u=j.useRef(null),f=j.useCallback(()=>{const i=localStorage.getItem("token");localStorage.getItem("__DEV_FAKE_USER__");let y=null;if(console.log("[useUser] Initialisation, token présent:",!!i),i)try{const T=yH(i);console.log("[useUser] Token décodé:",T),T.exp*1e3>Date.now()?(y={id:String(T.sub),email:T.email,role:T.role,isAdmin:T.role==="admin",isUser:T.role==="user",name:T.name||"",photo:T.photo||T.picture||"",credits:T.tokens_balance??0,currency:T.currency??"XAF"},console.log("[useUser] Utilisateur authentifié:",y)):(console.log("[useUser] Token expiré, suppression"),localStorage.removeItem("token"))}catch(T){console.error("[useUser] Erreur décodage token:",T),localStorage.removeItem("token")}const w=localStorage.getItem("tokens_balance");return w!==null&&y&&(y.credits=parseInt(w,10),console.log("[useUser] Solde mis à jour depuis localStorage:",y.credits)),y},[]);return j.useEffect(()=>{if(a.current)return;a.current=!0;const i=()=>{const T=f();JSON.stringify(T)!==JSON.stringify(u.current)&&(t(T),u.current=T),n(!1)};i();const y=T=>{(T.key==="tokens_balance"||T.key==="token")&&(console.log("[useUser] Changement détecté dans localStorage:",T.key),i())};window.addEventListener("storage",y);const w=()=>{console.log("[useUser] CustomEvent tokens_updated reçu"),i()};return window.addEventListener("tokens_updated",w),()=>{window.removeEventListener("storage",y),window.removeEventListener("tokens_updated",w)}},[f]),j.useEffect(()=>{typeof window<"u"&&(window.__YUKPOMNANG_TOGGLE_DEV=()=>{const i=localStorage.getItem("__DEV_FAKE_USER__")==="true";localStorage.setItem("__DEV_FAKE_USER__",i?"false":"true"),window.location.reload()})},[]),{user:e,isLoading:r,login:i=>{console.log("[useUser] Login avec token de longueur:",i.length),localStorage.setItem("token",i),window.location.reload()},logout:()=>{console.log("[useUser] Logout"),localStorage.removeItem("token"),localStorage.removeItem("__DEV_FAKE_USER__"),window.location.href="/"}}},D0=({children:e,allowedRoles:t})=>{const{user:r,isLoading:n}=Rs(),a=Sc();return n?b.jsx("div",{className:"flex justify-center items-center min-h-screen",children:"Chargement..."}):r?t&&!t.includes(r.role)?b.jsxs("div",{className:"p-8 text-center text-red-600 font-semibold",children:["🚫 Accès interdit — votre rôle ",b.jsx("code",{children:r.role})," ne permet pas d’accéder à cette page."]}):b.jsx(b.Fragment,{children:e}):b.jsx(Cie,{to:"/login",state:{from:a},replace:!0})},kR=j.createContext({});function OR(e){const t=j.useRef(null);return t.current===null&&(t.current=e()),t.current}const RE=j.createContext(null),LR=j.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class Uie extends j.Component{getSnapshotBeforeUpdate(t){const r=this.props.childRef.current;if(r&&t.isPresent&&!this.props.isPresent){const n=this.props.sizeRef.current;n.height=r.offsetHeight||0,n.width=r.offsetWidth||0,n.top=r.offsetTop,n.left=r.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function qie({children:e,isPresent:t}){const r=j.useId(),n=j.useRef(null),a=j.useRef({width:0,height:0,top:0,left:0}),{nonce:u}=j.useContext(LR);return j.useInsertionEffect(()=>{const{width:f,height:i,top:y,left:w}=a.current;if(t||!n.current||!f||!i)return;n.current.dataset.motionPopId=r;const T=document.createElement("style");return u&&(T.nonce=u),document.head.appendChild(T),T.sheet&&T.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${f}px !important;
            height: ${i}px !important;
            top: ${y}px !important;
            left: ${w}px !important;
          }
        `),()=>{document.head.removeChild(T)}},[t]),b.jsx(Uie,{isPresent:t,childRef:n,sizeRef:a,children:j.cloneElement(e,{ref:n})})}const Gie=({children:e,initial:t,isPresent:r,onExitComplete:n,custom:a,presenceAffectsLayout:u,mode:f})=>{const i=OR(Hie),y=j.useId(),w=j.useCallback(A=>{i.set(A,!0);for(const k of i.values())if(!k)return;n&&n()},[i,n]),T=j.useMemo(()=>({id:y,initial:t,isPresent:r,custom:a,onExitComplete:w,register:A=>(i.set(A,!1),()=>i.delete(A))}),u?[Math.random(),w]:[r,w]);return j.useMemo(()=>{i.forEach((A,k)=>i.set(k,!1))},[r]),j.useEffect(()=>{!r&&!i.size&&n&&n()},[r]),f==="popLayout"&&(e=b.jsx(qie,{isPresent:r,children:e})),b.jsx(RE.Provider,{value:T,children:e})};function Hie(){return new Map}function vH(e=!0){const t=j.useContext(RE);if(t===null)return[!0,null];const{isPresent:r,onExitComplete:n,register:a}=t,u=j.useId();j.useEffect(()=>{e&&a(u)},[e]);const f=j.useCallback(()=>e&&n&&n(u),[u,n,e]);return!r&&n?[!1,f]:[!0]}const ew=e=>e.key||"";function eB(e){const t=[];return j.Children.forEach(e,r=>{j.isValidElement(r)&&t.push(r)}),t}const RR=typeof window<"u",_H=RR?j.useLayoutEffect:j.useEffect,Wie=({children:e,custom:t,initial:r=!0,onExitComplete:n,presenceAffectsLayout:a=!0,mode:u="sync",propagate:f=!1})=>{const[i,y]=vH(f),w=j.useMemo(()=>eB(e),[e]),T=f&&!i?[]:w.map(ew),A=j.useRef(!0),k=j.useRef(w),F=OR(()=>new Map),[D,O]=j.useState(w),[N,V]=j.useState(w);_H(()=>{A.current=!1,k.current=w;for(let J=0;J<N.length;J++){const G=ew(N[J]);T.includes(G)?F.delete(G):F.get(G)!==!0&&F.set(G,!1)}},[N,T.length,T.join("-")]);const H=[];if(w!==D){let J=[...w];for(let G=0;G<N.length;G++){const Y=N[G],ie=ew(Y);T.includes(ie)||(J.splice(G,0,Y),H.push(Y))}u==="wait"&&H.length&&(J=H),V(eB(J)),O(w);return}const{forceRender:Z}=j.useContext(kR);return b.jsx(b.Fragment,{children:N.map(J=>{const G=ew(J),Y=f&&!i?!1:w===N||T.includes(G),ie=()=>{if(F.has(G))F.set(G,!0);else return;let ce=!0;F.forEach(ge=>{ge||(ce=!1)}),ce&&(Z==null||Z(),V(k.current),f&&(y==null||y()),n&&n())};return b.jsx(Gie,{isPresent:Y,initial:!A.current||r?void 0:!1,custom:Y?void 0:t,presenceAffectsLayout:a,mode:u,onExitComplete:Y?void 0:ie,children:J},G)})})},au=e=>e;let xH=au;function jR(e){let t;return()=>(t===void 0&&(t=e()),t)}const Wv=(e,t,r)=>{const n=t-e;return n===0?1:(r-e)/n},fp=e=>e*1e3,pp=e=>e/1e3,Zie={useManualTiming:!1};function Xie(e){let t=new Set,r=new Set,n=!1,a=!1;const u=new WeakSet;let f={delta:0,timestamp:0,isProcessing:!1};function i(w){u.has(w)&&(y.schedule(w),e()),w(f)}const y={schedule:(w,T=!1,A=!1)=>{const F=A&&n?t:r;return T&&u.add(w),F.has(w)||F.add(w),w},cancel:w=>{r.delete(w),u.delete(w)},process:w=>{if(f=w,n){a=!0;return}n=!0,[t,r]=[r,t],t.forEach(i),t.clear(),n=!1,a&&(a=!1,y.process(w))}};return y}const tw=["read","resolveKeyframes","update","preRender","render","postRender"],Kie=40;function bH(e,t){let r=!1,n=!0;const a={delta:0,timestamp:0,isProcessing:!1},u=()=>r=!0,f=tw.reduce((V,H)=>(V[H]=Xie(u),V),{}),{read:i,resolveKeyframes:y,update:w,preRender:T,render:A,postRender:k}=f,F=()=>{const V=performance.now();r=!1,a.delta=n?1e3/60:Math.max(Math.min(V-a.timestamp,Kie),1),a.timestamp=V,a.isProcessing=!0,i.process(a),y.process(a),w.process(a),T.process(a),A.process(a),k.process(a),a.isProcessing=!1,r&&t&&(n=!1,e(F))},D=()=>{r=!0,n=!0,a.isProcessing||e(F)};return{schedule:tw.reduce((V,H)=>{const Z=f[H];return V[H]=(J,G=!1,Y=!1)=>(r||D(),Z.schedule(J,G,Y)),V},{}),cancel:V=>{for(let H=0;H<tw.length;H++)f[tw[H]].cancel(V)},state:a,steps:f}}const{schedule:Ks,cancel:Vm,state:Wa,steps:yC}=bH(typeof requestAnimationFrame<"u"?requestAnimationFrame:au,!0),wH=j.createContext({strict:!1}),tB={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Zv={};for(const e in tB)Zv[e]={isEnabled:t=>tB[e].some(r=>!!t[r])};function Yie(e){for(const t in e)Zv[t]={...Zv[t],...e[t]}}const Jie=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function eS(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||Jie.has(e)}let SH=e=>!eS(e);function Qie(e){e&&(SH=t=>t.startsWith("on")?!eS(t):e(t))}try{Qie(require("@emotion/is-prop-valid").default)}catch{}function ese(e,t,r){const n={};for(const a in e)a==="values"&&typeof e.values=="object"||(SH(a)||r===!0&&eS(a)||!t&&!eS(a)||e.draggable&&a.startsWith("onDrag"))&&(n[a]=e[a]);return n}function tse(e){if(typeof Proxy>"u")return e;const t=new Map,r=(...n)=>e(...n);return new Proxy(r,{get:(n,a)=>a==="create"?e:(t.has(a)||t.set(a,e(a)),t.get(a))})}const jE=j.createContext({});function Ix(e){return typeof e=="string"||Array.isArray(e)}function DE(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}const DR=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],NR=["initial",...DR];function NE(e){return DE(e.animate)||NR.some(t=>Ix(e[t]))}function EH(e){return!!(NE(e)||e.variants)}function rse(e,t){if(NE(e)){const{initial:r,animate:n}=e;return{initial:r===!1||Ix(r)?r:void 0,animate:Ix(n)?n:void 0}}return e.inherit!==!1?t:{}}function nse(e){const{initial:t,animate:r}=rse(e,j.useContext(jE));return j.useMemo(()=>({initial:t,animate:r}),[rB(t),rB(r)])}function rB(e){return Array.isArray(e)?e.join(" "):e}const ise=Symbol.for("motionComponentSymbol");function Av(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function sse(e,t,r){return j.useCallback(n=>{n&&e.onMount&&e.onMount(n),t&&(n?t.mount(n):t.unmount()),r&&(typeof r=="function"?r(n):Av(r)&&(r.current=n))},[t])}const zR=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),ose="framerAppearId",TH="data-"+zR(ose),{schedule:FR}=bH(queueMicrotask,!1),CH=j.createContext({});function ase(e,t,r,n,a){var u,f;const{visualElement:i}=j.useContext(jE),y=j.useContext(wH),w=j.useContext(RE),T=j.useContext(LR).reducedMotion,A=j.useRef(null);n=n||y.renderer,!A.current&&n&&(A.current=n(e,{visualState:t,parent:i,props:r,presenceContext:w,blockInitialAnimation:w?w.initial===!1:!1,reducedMotionConfig:T}));const k=A.current,F=j.useContext(CH);k&&!k.projection&&a&&(k.type==="html"||k.type==="svg")&&lse(A.current,r,a,F);const D=j.useRef(!1);j.useInsertionEffect(()=>{k&&D.current&&k.update(r,w)});const O=r[TH],N=j.useRef(!!O&&!(!((u=window.MotionHandoffIsComplete)===null||u===void 0)&&u.call(window,O))&&((f=window.MotionHasOptimisedAnimation)===null||f===void 0?void 0:f.call(window,O)));return _H(()=>{k&&(D.current=!0,window.MotionIsMounted=!0,k.updateFeatures(),FR.render(k.render),N.current&&k.animationState&&k.animationState.animateChanges())}),j.useEffect(()=>{k&&(!N.current&&k.animationState&&k.animationState.animateChanges(),N.current&&(queueMicrotask(()=>{var V;(V=window.MotionHandoffMarkAsComplete)===null||V===void 0||V.call(window,O)}),N.current=!1))}),k}function lse(e,t,r,n){const{layoutId:a,layout:u,drag:f,dragConstraints:i,layoutScroll:y,layoutRoot:w}=t;e.projection=new r(e.latestValues,t["data-framer-portal-id"]?void 0:AH(e.parent)),e.projection.setOptions({layoutId:a,layout:u,alwaysMeasureLayout:!!f||i&&Av(i),visualElement:e,animationType:typeof u=="string"?u:"both",initialPromotionConfig:n,layoutScroll:y,layoutRoot:w})}function AH(e){if(e)return e.options.allowProjection!==!1?e.projection:AH(e.parent)}function cse({preloadedFeatures:e,createVisualElement:t,useRender:r,useVisualState:n,Component:a}){var u,f;e&&Yie(e);function i(w,T){let A;const k={...j.useContext(LR),...w,layoutId:use(w)},{isStatic:F}=k,D=nse(w),O=n(w,F);if(!F&&RR){dse();const N=hse(k);A=N.MeasureLayout,D.visualElement=ase(a,O,k,t,N.ProjectionNode)}return b.jsxs(jE.Provider,{value:D,children:[A&&D.visualElement?b.jsx(A,{visualElement:D.visualElement,...k}):null,r(a,w,sse(O,D.visualElement,T),O,F,D.visualElement)]})}i.displayName=`motion.${typeof a=="string"?a:`create(${(f=(u=a.displayName)!==null&&u!==void 0?u:a.name)!==null&&f!==void 0?f:""})`}`;const y=j.forwardRef(i);return y[ise]=a,y}function use({layoutId:e}){const t=j.useContext(kR).id;return t&&e!==void 0?t+"-"+e:e}function dse(e,t){j.useContext(wH).strict}function hse(e){const{drag:t,layout:r}=Zv;if(!t&&!r)return{};const n={...t,...r};return{MeasureLayout:t!=null&&t.isEnabled(e)||r!=null&&r.isEnabled(e)?n.MeasureLayout:void 0,ProjectionNode:n.ProjectionNode}}const fse=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function BR(e){return typeof e!="string"||e.includes("-")?!1:!!(fse.indexOf(e)>-1||/[A-Z]/u.test(e))}function nB(e){const t=[{},{}];return e==null||e.values.forEach((r,n)=>{t[0][n]=r.get(),t[1][n]=r.getVelocity()}),t}function $R(e,t,r,n){if(typeof t=="function"){const[a,u]=nB(n);t=t(r!==void 0?r:e.custom,a,u)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[a,u]=nB(n);t=t(r!==void 0?r:e.custom,a,u)}return t}const eO=e=>Array.isArray(e),pse=e=>!!(e&&typeof e=="object"&&e.mix&&e.toValue),mse=e=>eO(e)?e[e.length-1]||0:e,_l=e=>!!(e&&e.getVelocity);function Bw(e){const t=_l(e)?e.get():e;return pse(t)?t.toValue():t}function gse({scrapeMotionValuesFromProps:e,createRenderState:t,onUpdate:r},n,a,u){const f={latestValues:yse(n,a,u,e),renderState:t()};return r&&(f.onMount=i=>r({props:n,current:i,...f}),f.onUpdate=i=>r(i)),f}const PH=e=>(t,r)=>{const n=j.useContext(jE),a=j.useContext(RE),u=()=>gse(e,t,n,a);return r?u():OR(u)};function yse(e,t,r,n){const a={},u=n(e,{});for(const k in u)a[k]=Bw(u[k]);let{initial:f,animate:i}=e;const y=NE(e),w=EH(e);t&&w&&!y&&e.inherit!==!1&&(f===void 0&&(f=t.initial),i===void 0&&(i=t.animate));let T=r?r.initial===!1:!1;T=T||f===!1;const A=T?i:f;if(A&&typeof A!="boolean"&&!DE(A)){const k=Array.isArray(A)?A:[A];for(let F=0;F<k.length;F++){const D=$R(e,k[F]);if(D){const{transitionEnd:O,transition:N,...V}=D;for(const H in V){let Z=V[H];if(Array.isArray(Z)){const J=T?Z.length-1:0;Z=Z[J]}Z!==null&&(a[H]=Z)}for(const H in O)a[H]=O[H]}}}return a}const A_=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Iy=new Set(A_),MH=e=>t=>typeof t=="string"&&t.startsWith(e),IH=MH("--"),vse=MH("var(--"),VR=e=>vse(e)?_se.test(e.split("/*")[0].trim()):!1,_se=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,kH=(e,t)=>t&&typeof e=="number"?t.transform(e):e,vp=(e,t,r)=>r>t?t:r<e?e:r,P_={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},kx={...P_,transform:e=>vp(0,1,e)},rw={...P_,default:1},kb=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),Am=kb("deg"),sf=kb("%"),Kn=kb("px"),xse=kb("vh"),bse=kb("vw"),iB={...sf,parse:e=>sf.parse(e)/100,transform:e=>sf.transform(e*100)},wse={borderWidth:Kn,borderTopWidth:Kn,borderRightWidth:Kn,borderBottomWidth:Kn,borderLeftWidth:Kn,borderRadius:Kn,radius:Kn,borderTopLeftRadius:Kn,borderTopRightRadius:Kn,borderBottomRightRadius:Kn,borderBottomLeftRadius:Kn,width:Kn,maxWidth:Kn,height:Kn,maxHeight:Kn,top:Kn,right:Kn,bottom:Kn,left:Kn,padding:Kn,paddingTop:Kn,paddingRight:Kn,paddingBottom:Kn,paddingLeft:Kn,margin:Kn,marginTop:Kn,marginRight:Kn,marginBottom:Kn,marginLeft:Kn,backgroundPositionX:Kn,backgroundPositionY:Kn},Sse={rotate:Am,rotateX:Am,rotateY:Am,rotateZ:Am,scale:rw,scaleX:rw,scaleY:rw,scaleZ:rw,skew:Am,skewX:Am,skewY:Am,distance:Kn,translateX:Kn,translateY:Kn,translateZ:Kn,x:Kn,y:Kn,z:Kn,perspective:Kn,transformPerspective:Kn,opacity:kx,originX:iB,originY:iB,originZ:Kn},sB={...P_,transform:Math.round},UR={...wse,...Sse,zIndex:sB,size:Kn,fillOpacity:kx,strokeOpacity:kx,numOctaves:sB},Ese={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Tse=A_.length;function Cse(e,t,r){let n="",a=!0;for(let u=0;u<Tse;u++){const f=A_[u],i=e[f];if(i===void 0)continue;let y=!0;if(typeof i=="number"?y=i===(f.startsWith("scale")?1:0):y=parseFloat(i)===0,!y||r){const w=kH(i,UR[f]);if(!y){a=!1;const T=Ese[f]||f;n+=`${T}(${w}) `}r&&(t[f]=w)}}return n=n.trim(),r?n=r(t,a?"":n):a&&(n="none"),n}function qR(e,t,r){const{style:n,vars:a,transformOrigin:u}=e;let f=!1,i=!1;for(const y in t){const w=t[y];if(Iy.has(y)){f=!0;continue}else if(IH(y)){a[y]=w;continue}else{const T=kH(w,UR[y]);y.startsWith("origin")?(i=!0,u[y]=T):n[y]=T}}if(t.transform||(f||r?n.transform=Cse(t,e.transform,r):n.transform&&(n.transform="none")),i){const{originX:y="50%",originY:w="50%",originZ:T=0}=u;n.transformOrigin=`${y} ${w} ${T}`}}const Ase={offset:"stroke-dashoffset",array:"stroke-dasharray"},Pse={offset:"strokeDashoffset",array:"strokeDasharray"};function Mse(e,t,r=1,n=0,a=!0){e.pathLength=1;const u=a?Ase:Pse;e[u.offset]=Kn.transform(-n);const f=Kn.transform(t),i=Kn.transform(r);e[u.array]=`${f} ${i}`}function oB(e,t,r){return typeof e=="string"?e:Kn.transform(t+r*e)}function Ise(e,t,r){const n=oB(t,e.x,e.width),a=oB(r,e.y,e.height);return`${n} ${a}`}function GR(e,{attrX:t,attrY:r,attrScale:n,originX:a,originY:u,pathLength:f,pathSpacing:i=1,pathOffset:y=0,...w},T,A){if(qR(e,w,A),T){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:k,style:F,dimensions:D}=e;k.transform&&(D&&(F.transform=k.transform),delete k.transform),D&&(a!==void 0||u!==void 0||F.transform)&&(F.transformOrigin=Ise(D,a!==void 0?a:.5,u!==void 0?u:.5)),t!==void 0&&(k.x=t),r!==void 0&&(k.y=r),n!==void 0&&(k.scale=n),f!==void 0&&Mse(k,f,i,y,!1)}const HR=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),OH=()=>({...HR(),attrs:{}}),WR=e=>typeof e=="string"&&e.toLowerCase()==="svg";function LH(e,{style:t,vars:r},n,a){Object.assign(e.style,t,a&&a.getProjectionStyles(n));for(const u in r)e.style.setProperty(u,r[u])}const RH=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function jH(e,t,r,n){LH(e,t,void 0,n);for(const a in t.attrs)e.setAttribute(RH.has(a)?a:zR(a),t.attrs[a])}const tS={};function kse(e){Object.assign(tS,e)}function DH(e,{layout:t,layoutId:r}){return Iy.has(e)||e.startsWith("origin")||(t||r!==void 0)&&(!!tS[e]||e==="opacity")}function ZR(e,t,r){var n;const{style:a}=e,u={};for(const f in a)(_l(a[f])||t.style&&_l(t.style[f])||DH(f,e)||((n=r==null?void 0:r.getValue(f))===null||n===void 0?void 0:n.liveStyle)!==void 0)&&(u[f]=a[f]);return u}function NH(e,t,r){const n=ZR(e,t,r);for(const a in e)if(_l(e[a])||_l(t[a])){const u=A_.indexOf(a)!==-1?"attr"+a.charAt(0).toUpperCase()+a.substring(1):a;n[u]=e[a]}return n}function Ose(e,t){try{t.dimensions=typeof e.getBBox=="function"?e.getBBox():e.getBoundingClientRect()}catch{t.dimensions={x:0,y:0,width:0,height:0}}}const aB=["x","y","width","height","cx","cy","r"],Lse={useVisualState:PH({scrapeMotionValuesFromProps:NH,createRenderState:OH,onUpdate:({props:e,prevProps:t,current:r,renderState:n,latestValues:a})=>{if(!r)return;let u=!!e.drag;if(!u){for(const i in a)if(Iy.has(i)){u=!0;break}}if(!u)return;let f=!t;if(t)for(let i=0;i<aB.length;i++){const y=aB[i];e[y]!==t[y]&&(f=!0)}f&&Ks.read(()=>{Ose(r,n),Ks.render(()=>{GR(n,a,WR(r.tagName),e.transformTemplate),jH(r,n)})})}})},Rse={useVisualState:PH({scrapeMotionValuesFromProps:ZR,createRenderState:HR})};function zH(e,t,r){for(const n in t)!_l(t[n])&&!DH(n,r)&&(e[n]=t[n])}function jse({transformTemplate:e},t){return j.useMemo(()=>{const r=HR();return qR(r,t,e),Object.assign({},r.vars,r.style)},[t])}function Dse(e,t){const r=e.style||{},n={};return zH(n,r,e),Object.assign(n,jse(e,t)),n}function Nse(e,t){const r={},n=Dse(e,t);return e.drag&&e.dragListener!==!1&&(r.draggable=!1,n.userSelect=n.WebkitUserSelect=n.WebkitTouchCallout="none",n.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(r.tabIndex=0),r.style=n,r}function zse(e,t,r,n){const a=j.useMemo(()=>{const u=OH();return GR(u,t,WR(n),e.transformTemplate),{...u.attrs,style:{...u.style}}},[t]);if(e.style){const u={};zH(u,e.style,e),a.style={...u,...a.style}}return a}function Fse(e=!1){return(r,n,a,{latestValues:u},f)=>{const y=(BR(r)?zse:Nse)(n,u,f,r),w=ese(n,typeof r=="string",e),T=r!==j.Fragment?{...w,...y,ref:a}:{},{children:A}=n,k=j.useMemo(()=>_l(A)?A.get():A,[A]);return j.createElement(r,{...T,children:k})}}function Bse(e,t){return function(n,{forwardMotionProps:a}={forwardMotionProps:!1}){const f={...BR(n)?Lse:Rse,preloadedFeatures:e,useRender:Fse(a),createVisualElement:t,Component:n};return cse(f)}}function FH(e,t){if(!Array.isArray(t))return!1;const r=t.length;if(r!==e.length)return!1;for(let n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function zE(e,t,r){const n=e.getProps();return $R(n,t,r!==void 0?r:n.custom,e)}const $se=jR(()=>window.ScrollTimeline!==void 0);class Vse{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>"finished"in t?t.finished:t))}getAll(t){return this.animations[0][t]}setAll(t,r){for(let n=0;n<this.animations.length;n++)this.animations[n][t]=r}attachTimeline(t,r){const n=this.animations.map(a=>{if($se()&&a.attachTimeline)return a.attachTimeline(t);if(typeof r=="function")return r(a)});return()=>{n.forEach((a,u)=>{a&&a(),this.animations[u].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get startTime(){return this.getAll("startTime")}get duration(){let t=0;for(let r=0;r<this.animations.length;r++)t=Math.max(t,this.animations[r].duration);return t}runAll(t){this.animations.forEach(r=>r[t]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class Use extends Vse{then(t,r){return Promise.all(this.animations).then(t).catch(r)}}function XR(e,t){return e?e[t]||e.default||e:void 0}const tO=2e4;function BH(e){let t=0;const r=50;let n=e.next(t);for(;!n.done&&t<tO;)t+=r,n=e.next(t);return t>=tO?1/0:t}function KR(e){return typeof e=="function"}function lB(e,t){e.timeline=t,e.onfinish=null}const YR=e=>Array.isArray(e)&&typeof e[0]=="number",qse={linearEasing:void 0};function Gse(e,t){const r=jR(e);return()=>{var n;return(n=qse[t])!==null&&n!==void 0?n:r()}}const rS=Gse(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),$H=(e,t,r=10)=>{let n="";const a=Math.max(Math.round(t/r),2);for(let u=0;u<a;u++)n+=e(Wv(0,a-1,u))+", ";return`linear(${n.substring(0,n.length-2)})`};function VH(e){return!!(typeof e=="function"&&rS()||!e||typeof e=="string"&&(e in rO||rS())||YR(e)||Array.isArray(e)&&e.every(VH))}const sx=([e,t,r,n])=>`cubic-bezier(${e}, ${t}, ${r}, ${n})`,rO={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:sx([0,.65,.55,1]),circOut:sx([.55,0,1,.45]),backIn:sx([.31,.01,.66,-.59]),backOut:sx([.33,1.53,.69,.99])};function UH(e,t){if(e)return typeof e=="function"&&rS()?$H(e,t):YR(e)?sx(e):Array.isArray(e)?e.map(r=>UH(r,t)||rO.easeOut):rO[e]}const qd={x:!1,y:!1};function qH(){return qd.x||qd.y}function Hse(e,t,r){var n;if(e instanceof Element)return[e];if(typeof e=="string"){let a=document;const u=(n=void 0)!==null&&n!==void 0?n:a.querySelectorAll(e);return u?Array.from(u):[]}return Array.from(e)}function GH(e,t){const r=Hse(e),n=new AbortController,a={passive:!0,...t,signal:n.signal};return[r,a,()=>n.abort()]}function cB(e){return t=>{t.pointerType==="touch"||qH()||e(t)}}function Wse(e,t,r={}){const[n,a,u]=GH(e,r),f=cB(i=>{const{target:y}=i,w=t(i);if(typeof w!="function"||!y)return;const T=cB(A=>{w(A),y.removeEventListener("pointerleave",T)});y.addEventListener("pointerleave",T,a)});return n.forEach(i=>{i.addEventListener("pointerenter",f,a)}),u}const HH=(e,t)=>t?e===t?!0:HH(e,t.parentElement):!1,JR=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,Zse=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function Xse(e){return Zse.has(e.tagName)||e.tabIndex!==-1}const ox=new WeakSet;function uB(e){return t=>{t.key==="Enter"&&e(t)}}function vC(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const Kse=(e,t)=>{const r=e.currentTarget;if(!r)return;const n=uB(()=>{if(ox.has(r))return;vC(r,"down");const a=uB(()=>{vC(r,"up")}),u=()=>vC(r,"cancel");r.addEventListener("keyup",a,t),r.addEventListener("blur",u,t)});r.addEventListener("keydown",n,t),r.addEventListener("blur",()=>r.removeEventListener("keydown",n),t)};function dB(e){return JR(e)&&!qH()}function Yse(e,t,r={}){const[n,a,u]=GH(e,r),f=i=>{const y=i.currentTarget;if(!dB(i)||ox.has(y))return;ox.add(y);const w=t(i),T=(F,D)=>{window.removeEventListener("pointerup",A),window.removeEventListener("pointercancel",k),!(!dB(F)||!ox.has(y))&&(ox.delete(y),typeof w=="function"&&w(F,{success:D}))},A=F=>{T(F,r.useGlobalTarget||HH(y,F.target))},k=F=>{T(F,!1)};window.addEventListener("pointerup",A,a),window.addEventListener("pointercancel",k,a)};return n.forEach(i=>{!Xse(i)&&i.getAttribute("tabindex")===null&&(i.tabIndex=0),(r.useGlobalTarget?window:i).addEventListener("pointerdown",f,a),i.addEventListener("focus",w=>Kse(w,a),a)}),u}function Jse(e){return e==="x"||e==="y"?qd[e]?null:(qd[e]=!0,()=>{qd[e]=!1}):qd.x||qd.y?null:(qd.x=qd.y=!0,()=>{qd.x=qd.y=!1})}const WH=new Set(["width","height","top","left","right","bottom",...A_]);let $w;function Qse(){$w=void 0}const of={now:()=>($w===void 0&&of.set(Wa.isProcessing||Zie.useManualTiming?Wa.timestamp:performance.now()),$w),set:e=>{$w=e,queueMicrotask(Qse)}};function QR(e,t){e.indexOf(t)===-1&&e.push(t)}function ej(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}class tj{constructor(){this.subscriptions=[]}add(t){return QR(this.subscriptions,t),()=>ej(this.subscriptions,t)}notify(t,r,n){const a=this.subscriptions.length;if(a)if(a===1)this.subscriptions[0](t,r,n);else for(let u=0;u<a;u++){const f=this.subscriptions[u];f&&f(t,r,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function ZH(e,t){return t?e*(1e3/t):0}const hB=30,eoe=e=>!isNaN(parseFloat(e));class toe{constructor(t,r={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(n,a=!0)=>{const u=of.now();this.updatedAt!==u&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(n),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),a&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=r.owner}setCurrent(t){this.current=t,this.updatedAt=of.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=eoe(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,r){this.events[t]||(this.events[t]=new tj);const n=this.events[t].add(r);return t==="change"?()=>{n(),Ks.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,r){this.passiveEffect=t,this.stopPassiveEffect=r}set(t,r=!0){!r||!this.passiveEffect?this.updateAndNotify(t,r):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,r,n){this.set(r),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-n}jump(t,r=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,r&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=of.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>hB)return 0;const r=Math.min(this.updatedAt-this.prevUpdatedAt,hB);return ZH(parseFloat(this.current)-parseFloat(this.prevFrameValue),r)}start(t){return this.stop(),new Promise(r=>{this.hasAnimated=!0,this.animation=t(r),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Ox(e,t){return new toe(e,t)}function roe(e,t,r){e.hasValue(t)?e.getValue(t).set(r):e.addValue(t,Ox(r))}function noe(e,t){const r=zE(e,t);let{transitionEnd:n={},transition:a={},...u}=r||{};u={...u,...n};for(const f in u){const i=mse(u[f]);roe(e,f,i)}}function ioe(e){return!!(_l(e)&&e.add)}function nO(e,t){const r=e.getValue("willChange");if(ioe(r))return r.add(t)}function XH(e){return e.props[TH]}const KH=(e,t,r)=>(((1-3*r+3*t)*e+(3*r-6*t))*e+3*t)*e,soe=1e-7,ooe=12;function aoe(e,t,r,n,a){let u,f,i=0;do f=t+(r-t)/2,u=KH(f,n,a)-e,u>0?r=f:t=f;while(Math.abs(u)>soe&&++i<ooe);return f}function Ob(e,t,r,n){if(e===t&&r===n)return au;const a=u=>aoe(u,0,1,e,r);return u=>u===0||u===1?u:KH(a(u),t,n)}const YH=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,JH=e=>t=>1-e(1-t),QH=Ob(.33,1.53,.69,.99),rj=JH(QH),eW=YH(rj),tW=e=>(e*=2)<1?.5*rj(e):.5*(2-Math.pow(2,-10*(e-1))),nj=e=>1-Math.sin(Math.acos(e)),rW=JH(nj),nW=YH(nj),iW=e=>/^0[^.\s]+$/u.test(e);function loe(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||iW(e):!0}const hx=e=>Math.round(e*1e5)/1e5,ij=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function coe(e){return e==null}const uoe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,sj=(e,t)=>r=>!!(typeof r=="string"&&uoe.test(r)&&r.startsWith(e)||t&&!coe(r)&&Object.prototype.hasOwnProperty.call(r,t)),sW=(e,t,r)=>n=>{if(typeof n!="string")return n;const[a,u,f,i]=n.match(ij);return{[e]:parseFloat(a),[t]:parseFloat(u),[r]:parseFloat(f),alpha:i!==void 0?parseFloat(i):1}},doe=e=>vp(0,255,e),_C={...P_,transform:e=>Math.round(doe(e))},sy={test:sj("rgb","red"),parse:sW("red","green","blue"),transform:({red:e,green:t,blue:r,alpha:n=1})=>"rgba("+_C.transform(e)+", "+_C.transform(t)+", "+_C.transform(r)+", "+hx(kx.transform(n))+")"};function hoe(e){let t="",r="",n="",a="";return e.length>5?(t=e.substring(1,3),r=e.substring(3,5),n=e.substring(5,7),a=e.substring(7,9)):(t=e.substring(1,2),r=e.substring(2,3),n=e.substring(3,4),a=e.substring(4,5),t+=t,r+=r,n+=n,a+=a),{red:parseInt(t,16),green:parseInt(r,16),blue:parseInt(n,16),alpha:a?parseInt(a,16)/255:1}}const iO={test:sj("#"),parse:hoe,transform:sy.transform},Pv={test:sj("hsl","hue"),parse:sW("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:r,alpha:n=1})=>"hsla("+Math.round(e)+", "+sf.transform(hx(t))+", "+sf.transform(hx(r))+", "+hx(kx.transform(n))+")"},ml={test:e=>sy.test(e)||iO.test(e)||Pv.test(e),parse:e=>sy.test(e)?sy.parse(e):Pv.test(e)?Pv.parse(e):iO.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?sy.transform(e):Pv.transform(e)},foe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function poe(e){var t,r;return isNaN(e)&&typeof e=="string"&&(((t=e.match(ij))===null||t===void 0?void 0:t.length)||0)+(((r=e.match(foe))===null||r===void 0?void 0:r.length)||0)>0}const oW="number",aW="color",moe="var",goe="var(",fB="${}",yoe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Lx(e){const t=e.toString(),r=[],n={color:[],number:[],var:[]},a=[];let u=0;const i=t.replace(yoe,y=>(ml.test(y)?(n.color.push(u),a.push(aW),r.push(ml.parse(y))):y.startsWith(goe)?(n.var.push(u),a.push(moe),r.push(y)):(n.number.push(u),a.push(oW),r.push(parseFloat(y))),++u,fB)).split(fB);return{values:r,split:i,indexes:n,types:a}}function lW(e){return Lx(e).values}function cW(e){const{split:t,types:r}=Lx(e),n=t.length;return a=>{let u="";for(let f=0;f<n;f++)if(u+=t[f],a[f]!==void 0){const i=r[f];i===oW?u+=hx(a[f]):i===aW?u+=ml.transform(a[f]):u+=a[f]}return u}}const voe=e=>typeof e=="number"?0:e;function _oe(e){const t=lW(e);return cW(e)(t.map(voe))}const Um={test:poe,parse:lW,createTransformer:cW,getAnimatableNone:_oe},xoe=new Set(["brightness","contrast","saturate","opacity"]);function boe(e){const[t,r]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[n]=r.match(ij)||[];if(!n)return e;const a=r.replace(n,"");let u=xoe.has(t)?1:0;return n!==r&&(u*=100),t+"("+u+a+")"}const woe=/\b([a-z-]*)\(.*?\)/gu,sO={...Um,getAnimatableNone:e=>{const t=e.match(woe);return t?t.map(boe).join(" "):e}},Soe={...UR,color:ml,backgroundColor:ml,outlineColor:ml,fill:ml,stroke:ml,borderColor:ml,borderTopColor:ml,borderRightColor:ml,borderBottomColor:ml,borderLeftColor:ml,filter:sO,WebkitFilter:sO},oj=e=>Soe[e];function uW(e,t){let r=oj(e);return r!==sO&&(r=Um),r.getAnimatableNone?r.getAnimatableNone(t):void 0}const Eoe=new Set(["auto","none","0"]);function Toe(e,t,r){let n=0,a;for(;n<e.length&&!a;){const u=e[n];typeof u=="string"&&!Eoe.has(u)&&Lx(u).values.length&&(a=e[n]),n++}if(a&&r)for(const u of t)e[u]=uW(r,a)}const pB=e=>e===P_||e===Kn,mB=(e,t)=>parseFloat(e.split(", ")[t]),gB=(e,t)=>(r,{transform:n})=>{if(n==="none"||!n)return 0;const a=n.match(/^matrix3d\((.+)\)$/u);if(a)return mB(a[1],t);{const u=n.match(/^matrix\((.+)\)$/u);return u?mB(u[1],e):0}},Coe=new Set(["x","y","z"]),Aoe=A_.filter(e=>!Coe.has(e));function Poe(e){const t=[];return Aoe.forEach(r=>{const n=e.getValue(r);n!==void 0&&(t.push([r,n.get()]),n.set(r.startsWith("scale")?1:0))}),t}const Xv={width:({x:e},{paddingLeft:t="0",paddingRight:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),height:({y:e},{paddingTop:t="0",paddingBottom:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:gB(4,13),y:gB(5,14)};Xv.translateX=Xv.x;Xv.translateY=Xv.y;const fy=new Set;let oO=!1,aO=!1;function dW(){if(aO){const e=Array.from(fy).filter(n=>n.needsMeasurement),t=new Set(e.map(n=>n.element)),r=new Map;t.forEach(n=>{const a=Poe(n);a.length&&(r.set(n,a),n.render())}),e.forEach(n=>n.measureInitialState()),t.forEach(n=>{n.render();const a=r.get(n);a&&a.forEach(([u,f])=>{var i;(i=n.getValue(u))===null||i===void 0||i.set(f)})}),e.forEach(n=>n.measureEndState()),e.forEach(n=>{n.suspendedScrollY!==void 0&&window.scrollTo(0,n.suspendedScrollY)})}aO=!1,oO=!1,fy.forEach(e=>e.complete()),fy.clear()}function hW(){fy.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(aO=!0)})}function Moe(){hW(),dW()}class aj{constructor(t,r,n,a,u,f=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=r,this.name=n,this.motionValue=a,this.element=u,this.isAsync=f}scheduleResolve(){this.isScheduled=!0,this.isAsync?(fy.add(this),oO||(oO=!0,Ks.read(hW),Ks.resolveKeyframes(dW))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:r,element:n,motionValue:a}=this;for(let u=0;u<t.length;u++)if(t[u]===null)if(u===0){const f=a==null?void 0:a.get(),i=t[t.length-1];if(f!==void 0)t[0]=f;else if(n&&r){const y=n.readValue(r,i);y!=null&&(t[0]=y)}t[0]===void 0&&(t[0]=i),a&&f===void 0&&a.set(t[0])}else t[u]=t[u-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),fy.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,fy.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const fW=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),Ioe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function koe(e){const t=Ioe.exec(e);if(!t)return[,];const[,r,n,a]=t;return[`--${r??n}`,a]}function pW(e,t,r=1){const[n,a]=koe(e);if(!n)return;const u=window.getComputedStyle(t).getPropertyValue(n);if(u){const f=u.trim();return fW(f)?parseFloat(f):f}return VR(a)?pW(a,t,r+1):a}const mW=e=>t=>t.test(e),Ooe={test:e=>e==="auto",parse:e=>e},gW=[P_,Kn,sf,Am,bse,xse,Ooe],yB=e=>gW.find(mW(e));class yW extends aj{constructor(t,r,n,a,u){super(t,r,n,a,u,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:r,name:n}=this;if(!r||!r.current)return;super.readKeyframes();for(let y=0;y<t.length;y++){let w=t[y];if(typeof w=="string"&&(w=w.trim(),VR(w))){const T=pW(w,r.current);T!==void 0&&(t[y]=T),y===t.length-1&&(this.finalKeyframe=w)}}if(this.resolveNoneKeyframes(),!WH.has(n)||t.length!==2)return;const[a,u]=t,f=yB(a),i=yB(u);if(f!==i)if(pB(f)&&pB(i))for(let y=0;y<t.length;y++){const w=t[y];typeof w=="string"&&(t[y]=parseFloat(w))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:r}=this,n=[];for(let a=0;a<t.length;a++)loe(t[a])&&n.push(a);n.length&&Toe(t,n,r)}measureInitialState(){const{element:t,unresolvedKeyframes:r,name:n}=this;if(!t||!t.current)return;n==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Xv[n](t.measureViewportBox(),window.getComputedStyle(t.current)),r[0]=this.measuredOrigin;const a=r[r.length-1];a!==void 0&&t.getValue(n,a).jump(a,!1)}measureEndState(){var t;const{element:r,name:n,unresolvedKeyframes:a}=this;if(!r||!r.current)return;const u=r.getValue(n);u&&u.jump(this.measuredOrigin,!1);const f=a.length-1,i=a[f];a[f]=Xv[n](r.measureViewportBox(),window.getComputedStyle(r.current)),i!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=i),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([y,w])=>{r.getValue(y).set(w)}),this.resolveNoneKeyframes()}}const vB=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(Um.test(e)||e==="0")&&!e.startsWith("url("));function Loe(e){const t=e[0];if(e.length===1)return!0;for(let r=0;r<e.length;r++)if(e[r]!==t)return!0}function Roe(e,t,r,n){const a=e[0];if(a===null)return!1;if(t==="display"||t==="visibility")return!0;const u=e[e.length-1],f=vB(a,t),i=vB(u,t);return!f||!i?!1:Loe(e)||(r==="spring"||KR(r))&&n}const joe=e=>e!==null;function FE(e,{repeat:t,repeatType:r="loop"},n){const a=e.filter(joe),u=t&&r!=="loop"&&t%2===1?0:a.length-1;return!u||n===void 0?a[u]:n}const Doe=40;class vW{constructor({autoplay:t=!0,delay:r=0,type:n="keyframes",repeat:a=0,repeatDelay:u=0,repeatType:f="loop",...i}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=of.now(),this.options={autoplay:t,delay:r,type:n,repeat:a,repeatDelay:u,repeatType:f,...i},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>Doe?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&Moe(),this._resolved}onKeyframesResolved(t,r){this.resolvedAt=of.now(),this.hasAttemptedResolve=!0;const{name:n,type:a,velocity:u,delay:f,onComplete:i,onUpdate:y,isGenerator:w}=this.options;if(!w&&!Roe(t,n,a,u))if(f)this.options.duration=0;else{y&&y(FE(t,this.options,r)),i&&i(),this.resolveFinishedPromise();return}const T=this.initPlayback(t,r);T!==!1&&(this._resolved={keyframes:t,finalKeyframe:r,...T},this.onPostResolved())}onPostResolved(){}then(t,r){return this.currentFinishedPromise.then(t,r)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}const _o=(e,t,r)=>e+(t-e)*r;function xC(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function Noe({hue:e,saturation:t,lightness:r,alpha:n}){e/=360,t/=100,r/=100;let a=0,u=0,f=0;if(!t)a=u=f=r;else{const i=r<.5?r*(1+t):r+t-r*t,y=2*r-i;a=xC(y,i,e+1/3),u=xC(y,i,e),f=xC(y,i,e-1/3)}return{red:Math.round(a*255),green:Math.round(u*255),blue:Math.round(f*255),alpha:n}}function nS(e,t){return r=>r>0?t:e}const bC=(e,t,r)=>{const n=e*e,a=r*(t*t-n)+n;return a<0?0:Math.sqrt(a)},zoe=[iO,sy,Pv],Foe=e=>zoe.find(t=>t.test(e));function _B(e){const t=Foe(e);if(!t)return!1;let r=t.parse(e);return t===Pv&&(r=Noe(r)),r}const xB=(e,t)=>{const r=_B(e),n=_B(t);if(!r||!n)return nS(e,t);const a={...r};return u=>(a.red=bC(r.red,n.red,u),a.green=bC(r.green,n.green,u),a.blue=bC(r.blue,n.blue,u),a.alpha=_o(r.alpha,n.alpha,u),sy.transform(a))},Boe=(e,t)=>r=>t(e(r)),Lb=(...e)=>e.reduce(Boe),lO=new Set(["none","hidden"]);function $oe(e,t){return lO.has(e)?r=>r<=0?e:t:r=>r>=1?t:e}function Voe(e,t){return r=>_o(e,t,r)}function lj(e){return typeof e=="number"?Voe:typeof e=="string"?VR(e)?nS:ml.test(e)?xB:Goe:Array.isArray(e)?_W:typeof e=="object"?ml.test(e)?xB:Uoe:nS}function _W(e,t){const r=[...e],n=r.length,a=e.map((u,f)=>lj(u)(u,t[f]));return u=>{for(let f=0;f<n;f++)r[f]=a[f](u);return r}}function Uoe(e,t){const r={...e,...t},n={};for(const a in r)e[a]!==void 0&&t[a]!==void 0&&(n[a]=lj(e[a])(e[a],t[a]));return a=>{for(const u in n)r[u]=n[u](a);return r}}function qoe(e,t){var r;const n=[],a={color:0,var:0,number:0};for(let u=0;u<t.values.length;u++){const f=t.types[u],i=e.indexes[f][a[f]],y=(r=e.values[i])!==null&&r!==void 0?r:0;n[u]=y,a[f]++}return n}const Goe=(e,t)=>{const r=Um.createTransformer(t),n=Lx(e),a=Lx(t);return n.indexes.var.length===a.indexes.var.length&&n.indexes.color.length===a.indexes.color.length&&n.indexes.number.length>=a.indexes.number.length?lO.has(e)&&!a.values.length||lO.has(t)&&!n.values.length?$oe(e,t):Lb(_W(qoe(n,a),a.values),r):nS(e,t)};function xW(e,t,r){return typeof e=="number"&&typeof t=="number"&&typeof r=="number"?_o(e,t,r):lj(e)(e,t)}const Hoe=5;function bW(e,t,r){const n=Math.max(t-Hoe,0);return ZH(r-e(n),t-n)}const Ao={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},bB=.001;function Woe({duration:e=Ao.duration,bounce:t=Ao.bounce,velocity:r=Ao.velocity,mass:n=Ao.mass}){let a,u,f=1-t;f=vp(Ao.minDamping,Ao.maxDamping,f),e=vp(Ao.minDuration,Ao.maxDuration,pp(e)),f<1?(a=w=>{const T=w*f,A=T*e,k=T-r,F=cO(w,f),D=Math.exp(-A);return bB-k/F*D},u=w=>{const A=w*f*e,k=A*r+r,F=Math.pow(f,2)*Math.pow(w,2)*e,D=Math.exp(-A),O=cO(Math.pow(w,2),f);return(-a(w)+bB>0?-1:1)*((k-F)*D)/O}):(a=w=>{const T=Math.exp(-w*e),A=(w-r)*e+1;return-.001+T*A},u=w=>{const T=Math.exp(-w*e),A=(r-w)*(e*e);return T*A});const i=5/e,y=Xoe(a,u,i);if(e=fp(e),isNaN(y))return{stiffness:Ao.stiffness,damping:Ao.damping,duration:e};{const w=Math.pow(y,2)*n;return{stiffness:w,damping:f*2*Math.sqrt(n*w),duration:e}}}const Zoe=12;function Xoe(e,t,r){let n=r;for(let a=1;a<Zoe;a++)n=n-e(n)/t(n);return n}function cO(e,t){return e*Math.sqrt(1-t*t)}const Koe=["duration","bounce"],Yoe=["stiffness","damping","mass"];function wB(e,t){return t.some(r=>e[r]!==void 0)}function Joe(e){let t={velocity:Ao.velocity,stiffness:Ao.stiffness,damping:Ao.damping,mass:Ao.mass,isResolvedFromDuration:!1,...e};if(!wB(e,Yoe)&&wB(e,Koe))if(e.visualDuration){const r=e.visualDuration,n=2*Math.PI/(r*1.2),a=n*n,u=2*vp(.05,1,1-(e.bounce||0))*Math.sqrt(a);t={...t,mass:Ao.mass,stiffness:a,damping:u}}else{const r=Woe(e);t={...t,...r,mass:Ao.mass},t.isResolvedFromDuration=!0}return t}function wW(e=Ao.visualDuration,t=Ao.bounce){const r=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:n,restDelta:a}=r;const u=r.keyframes[0],f=r.keyframes[r.keyframes.length-1],i={done:!1,value:u},{stiffness:y,damping:w,mass:T,duration:A,velocity:k,isResolvedFromDuration:F}=Joe({...r,velocity:-pp(r.velocity||0)}),D=k||0,O=w/(2*Math.sqrt(y*T)),N=f-u,V=pp(Math.sqrt(y/T)),H=Math.abs(N)<5;n||(n=H?Ao.restSpeed.granular:Ao.restSpeed.default),a||(a=H?Ao.restDelta.granular:Ao.restDelta.default);let Z;if(O<1){const G=cO(V,O);Z=Y=>{const ie=Math.exp(-O*V*Y);return f-ie*((D+O*V*N)/G*Math.sin(G*Y)+N*Math.cos(G*Y))}}else if(O===1)Z=G=>f-Math.exp(-V*G)*(N+(D+V*N)*G);else{const G=V*Math.sqrt(O*O-1);Z=Y=>{const ie=Math.exp(-O*V*Y),ce=Math.min(G*Y,300);return f-ie*((D+O*V*N)*Math.sinh(ce)+G*N*Math.cosh(ce))/G}}const J={calculatedDuration:F&&A||null,next:G=>{const Y=Z(G);if(F)i.done=G>=A;else{let ie=0;O<1&&(ie=G===0?fp(D):bW(Z,G,Y));const ce=Math.abs(ie)<=n,ge=Math.abs(f-Y)<=a;i.done=ce&&ge}return i.value=i.done?f:Y,i},toString:()=>{const G=Math.min(BH(J),tO),Y=$H(ie=>J.next(G*ie).value,G,30);return G+"ms "+Y}};return J}function SB({keyframes:e,velocity:t=0,power:r=.8,timeConstant:n=325,bounceDamping:a=10,bounceStiffness:u=500,modifyTarget:f,min:i,max:y,restDelta:w=.5,restSpeed:T}){const A=e[0],k={done:!1,value:A},F=ce=>i!==void 0&&ce<i||y!==void 0&&ce>y,D=ce=>i===void 0?y:y===void 0||Math.abs(i-ce)<Math.abs(y-ce)?i:y;let O=r*t;const N=A+O,V=f===void 0?N:f(N);V!==N&&(O=V-A);const H=ce=>-O*Math.exp(-ce/n),Z=ce=>V+H(ce),J=ce=>{const ge=H(ce),be=Z(ce);k.done=Math.abs(ge)<=w,k.value=k.done?V:be};let G,Y;const ie=ce=>{F(k.value)&&(G=ce,Y=wW({keyframes:[k.value,D(k.value)],velocity:bW(Z,ce,k.value),damping:a,stiffness:u,restDelta:w,restSpeed:T}))};return ie(0),{calculatedDuration:null,next:ce=>{let ge=!1;return!Y&&G===void 0&&(ge=!0,J(ce),ie(ce)),G!==void 0&&ce>=G?Y.next(ce-G):(!ge&&J(ce),k)}}}const Qoe=Ob(.42,0,1,1),eae=Ob(0,0,.58,1),SW=Ob(.42,0,.58,1),tae=e=>Array.isArray(e)&&typeof e[0]!="number",rae={linear:au,easeIn:Qoe,easeInOut:SW,easeOut:eae,circIn:nj,circInOut:nW,circOut:rW,backIn:rj,backInOut:eW,backOut:QH,anticipate:tW},EB=e=>{if(YR(e)){xH(e.length===4);const[t,r,n,a]=e;return Ob(t,r,n,a)}else if(typeof e=="string")return rae[e];return e};function nae(e,t,r){const n=[],a=r||xW,u=e.length-1;for(let f=0;f<u;f++){let i=a(e[f],e[f+1]);if(t){const y=Array.isArray(t)?t[f]||au:t;i=Lb(y,i)}n.push(i)}return n}function iae(e,t,{clamp:r=!0,ease:n,mixer:a}={}){const u=e.length;if(xH(u===t.length),u===1)return()=>t[0];if(u===2&&t[0]===t[1])return()=>t[1];const f=e[0]===e[1];e[0]>e[u-1]&&(e=[...e].reverse(),t=[...t].reverse());const i=nae(t,n,a),y=i.length,w=T=>{if(f&&T<e[0])return t[0];let A=0;if(y>1)for(;A<e.length-2&&!(T<e[A+1]);A++);const k=Wv(e[A],e[A+1],T);return i[A](k)};return r?T=>w(vp(e[0],e[u-1],T)):w}function sae(e,t){const r=e[e.length-1];for(let n=1;n<=t;n++){const a=Wv(0,t,n);e.push(_o(r,1,a))}}function oae(e){const t=[0];return sae(t,e.length-1),t}function aae(e,t){return e.map(r=>r*t)}function lae(e,t){return e.map(()=>t||SW).splice(0,e.length-1)}function iS({duration:e=300,keyframes:t,times:r,ease:n="easeInOut"}){const a=tae(n)?n.map(EB):EB(n),u={done:!1,value:t[0]},f=aae(r&&r.length===t.length?r:oae(t),e),i=iae(f,t,{ease:Array.isArray(a)?a:lae(t,a)});return{calculatedDuration:e,next:y=>(u.value=i(y),u.done=y>=e,u)}}const cae=e=>{const t=({timestamp:r})=>e(r);return{start:()=>Ks.update(t,!0),stop:()=>Vm(t),now:()=>Wa.isProcessing?Wa.timestamp:of.now()}},uae={decay:SB,inertia:SB,tween:iS,keyframes:iS,spring:wW},dae=e=>e/100;class cj extends vW{constructor(t){super(t),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:y}=this.options;y&&y()};const{name:r,motionValue:n,element:a,keyframes:u}=this.options,f=(a==null?void 0:a.KeyframeResolver)||aj,i=(y,w)=>this.onKeyframesResolved(y,w);this.resolver=new f(u,i,r,n,a),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(t){const{type:r="keyframes",repeat:n=0,repeatDelay:a=0,repeatType:u,velocity:f=0}=this.options,i=KR(r)?r:uae[r]||iS;let y,w;i!==iS&&typeof t[0]!="number"&&(y=Lb(dae,xW(t[0],t[1])),t=[0,100]);const T=i({...this.options,keyframes:t});u==="mirror"&&(w=i({...this.options,keyframes:[...t].reverse(),velocity:-f})),T.calculatedDuration===null&&(T.calculatedDuration=BH(T));const{calculatedDuration:A}=T,k=A+a,F=k*(n+1)-a;return{generator:T,mirroredGenerator:w,mapPercentToKeyframes:y,calculatedDuration:A,resolvedDuration:k,totalDuration:F}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,r=!1){const{resolved:n}=this;if(!n){const{keyframes:ce}=this.options;return{done:!0,value:ce[ce.length-1]}}const{finalKeyframe:a,generator:u,mirroredGenerator:f,mapPercentToKeyframes:i,keyframes:y,calculatedDuration:w,totalDuration:T,resolvedDuration:A}=n;if(this.startTime===null)return u.next(0);const{delay:k,repeat:F,repeatType:D,repeatDelay:O,onUpdate:N}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-T/this.speed,this.startTime)),r?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const V=this.currentTime-k*(this.speed>=0?1:-1),H=this.speed>=0?V<0:V>T;this.currentTime=Math.max(V,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=T);let Z=this.currentTime,J=u;if(F){const ce=Math.min(this.currentTime,T)/A;let ge=Math.floor(ce),be=ce%1;!be&&ce>=1&&(be=1),be===1&&ge--,ge=Math.min(ge,F+1),!!(ge%2)&&(D==="reverse"?(be=1-be,O&&(be-=O/A)):D==="mirror"&&(J=f)),Z=vp(0,1,be)*A}const G=H?{done:!1,value:y[0]}:J.next(Z);i&&(G.value=i(G.value));let{done:Y}=G;!H&&w!==null&&(Y=this.speed>=0?this.currentTime>=T:this.currentTime<=0);const ie=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&Y);return ie&&a!==void 0&&(G.value=FE(y,this.options,a)),N&&N(G.value),ie&&this.finish(),G}get duration(){const{resolved:t}=this;return t?pp(t.calculatedDuration):0}get time(){return pp(this.currentTime)}set time(t){t=fp(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const r=this.playbackSpeed!==t;this.playbackSpeed=t,r&&(this.time=pp(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=cae,onPlay:r,startTime:n}=this.options;this.driver||(this.driver=t(u=>this.tick(u))),r&&r();const a=this.driver.now();this.holdTime!==null?this.startTime=a-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=a):this.startTime=n??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const hae=new Set(["opacity","clipPath","filter","transform"]);function fae(e,t,r,{delay:n=0,duration:a=300,repeat:u=0,repeatType:f="loop",ease:i="easeInOut",times:y}={}){const w={[t]:r};y&&(w.offset=y);const T=UH(i,a);return Array.isArray(T)&&(w.easing=T),e.animate(w,{delay:n,duration:a,easing:Array.isArray(T)?"linear":T,fill:"both",iterations:u+1,direction:f==="reverse"?"alternate":"normal"})}const pae=jR(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),sS=10,mae=2e4;function gae(e){return KR(e.type)||e.type==="spring"||!VH(e.ease)}function yae(e,t){const r=new cj({...t,keyframes:e,repeat:0,delay:0,isGenerator:!0});let n={done:!1,value:e[0]};const a=[];let u=0;for(;!n.done&&u<mae;)n=r.sample(u),a.push(n.value),u+=sS;return{times:void 0,keyframes:a,duration:u-sS,ease:"linear"}}const EW={anticipate:tW,backInOut:eW,circInOut:nW};function vae(e){return e in EW}class TB extends vW{constructor(t){super(t);const{name:r,motionValue:n,element:a,keyframes:u}=this.options;this.resolver=new yW(u,(f,i)=>this.onKeyframesResolved(f,i),r,n,a),this.resolver.scheduleResolve()}initPlayback(t,r){let{duration:n=300,times:a,ease:u,type:f,motionValue:i,name:y,startTime:w}=this.options;if(!i.owner||!i.owner.current)return!1;if(typeof u=="string"&&rS()&&vae(u)&&(u=EW[u]),gae(this.options)){const{onComplete:A,onUpdate:k,motionValue:F,element:D,...O}=this.options,N=yae(t,O);t=N.keyframes,t.length===1&&(t[1]=t[0]),n=N.duration,a=N.times,u=N.ease,f="keyframes"}const T=fae(i.owner.current,y,t,{...this.options,duration:n,times:a,ease:u});return T.startTime=w??this.calcStartTime(),this.pendingTimeline?(lB(T,this.pendingTimeline),this.pendingTimeline=void 0):T.onfinish=()=>{const{onComplete:A}=this.options;i.set(FE(t,this.options,r)),A&&A(),this.cancel(),this.resolveFinishedPromise()},{animation:T,duration:n,times:a,type:f,ease:u,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:r}=t;return pp(r)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:r}=t;return pp(r.currentTime||0)}set time(t){const{resolved:r}=this;if(!r)return;const{animation:n}=r;n.currentTime=fp(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:r}=t;return r.playbackRate}set speed(t){const{resolved:r}=this;if(!r)return;const{animation:n}=r;n.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:r}=t;return r.playState}get startTime(){const{resolved:t}=this;if(!t)return null;const{animation:r}=t;return r.startTime}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:r}=this;if(!r)return au;const{animation:n}=r;lB(n,t)}return au}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:r}=t;r.playState==="finished"&&this.updateFinishedPromise(),r.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:r}=t;r.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:t}=this;if(!t)return;const{animation:r,keyframes:n,duration:a,type:u,ease:f,times:i}=t;if(r.playState==="idle"||r.playState==="finished")return;if(this.time){const{motionValue:w,onUpdate:T,onComplete:A,element:k,...F}=this.options,D=new cj({...F,keyframes:n,duration:a,type:u,ease:f,times:i,isGenerator:!0}),O=fp(this.time);w.setWithVelocity(D.sample(O-sS).value,D.sample(O).value,sS)}const{onStop:y}=this.options;y&&y(),this.cancel()}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:r,name:n,repeatDelay:a,repeatType:u,damping:f,type:i}=t;if(!r||!r.owner||!(r.owner.current instanceof HTMLElement))return!1;const{onUpdate:y,transformTemplate:w}=r.owner.getProps();return pae()&&n&&hae.has(n)&&!y&&!w&&!a&&u!=="mirror"&&f!==0&&i!=="inertia"}}const _ae={type:"spring",stiffness:500,damping:25,restSpeed:10},xae=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),bae={type:"keyframes",duration:.8},wae={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Sae=(e,{keyframes:t})=>t.length>2?bae:Iy.has(e)?e.startsWith("scale")?xae(t[1]):_ae:wae;function Eae({when:e,delay:t,delayChildren:r,staggerChildren:n,staggerDirection:a,repeat:u,repeatType:f,repeatDelay:i,from:y,elapsed:w,...T}){return!!Object.keys(T).length}const uj=(e,t,r,n={},a,u)=>f=>{const i=XR(n,e)||{},y=i.delay||n.delay||0;let{elapsed:w=0}=n;w=w-fp(y);let T={keyframes:Array.isArray(r)?r:[null,r],ease:"easeOut",velocity:t.getVelocity(),...i,delay:-w,onUpdate:k=>{t.set(k),i.onUpdate&&i.onUpdate(k)},onComplete:()=>{f(),i.onComplete&&i.onComplete()},name:e,motionValue:t,element:u?void 0:a};Eae(i)||(T={...T,...Sae(e,T)}),T.duration&&(T.duration=fp(T.duration)),T.repeatDelay&&(T.repeatDelay=fp(T.repeatDelay)),T.from!==void 0&&(T.keyframes[0]=T.from);let A=!1;if((T.type===!1||T.duration===0&&!T.repeatDelay)&&(T.duration=0,T.delay===0&&(A=!0)),A&&!u&&t.get()!==void 0){const k=FE(T.keyframes,i);if(k!==void 0)return Ks.update(()=>{T.onUpdate(k),T.onComplete()}),new Use([])}return!u&&TB.supports(T)?new TB(T):new cj(T)};function Tae({protectedKeys:e,needsAnimating:t},r){const n=e.hasOwnProperty(r)&&t[r]!==!0;return t[r]=!1,n}function TW(e,t,{delay:r=0,transitionOverride:n,type:a}={}){var u;let{transition:f=e.getDefaultTransition(),transitionEnd:i,...y}=t;n&&(f=n);const w=[],T=a&&e.animationState&&e.animationState.getState()[a];for(const A in y){const k=e.getValue(A,(u=e.latestValues[A])!==null&&u!==void 0?u:null),F=y[A];if(F===void 0||T&&Tae(T,A))continue;const D={delay:r,...XR(f||{},A)};let O=!1;if(window.MotionHandoffAnimation){const V=XH(e);if(V){const H=window.MotionHandoffAnimation(V,A,Ks);H!==null&&(D.startTime=H,O=!0)}}nO(e,A),k.start(uj(A,k,F,e.shouldReduceMotion&&WH.has(A)?{type:!1}:D,e,O));const N=k.animation;N&&w.push(N)}return i&&Promise.all(w).then(()=>{Ks.update(()=>{i&&noe(e,i)})}),w}function uO(e,t,r={}){var n;const a=zE(e,t,r.type==="exit"?(n=e.presenceContext)===null||n===void 0?void 0:n.custom:void 0);let{transition:u=e.getDefaultTransition()||{}}=a||{};r.transitionOverride&&(u=r.transitionOverride);const f=a?()=>Promise.all(TW(e,a,r)):()=>Promise.resolve(),i=e.variantChildren&&e.variantChildren.size?(w=0)=>{const{delayChildren:T=0,staggerChildren:A,staggerDirection:k}=u;return Cae(e,t,T+w,A,k,r)}:()=>Promise.resolve(),{when:y}=u;if(y){const[w,T]=y==="beforeChildren"?[f,i]:[i,f];return w().then(()=>T())}else return Promise.all([f(),i(r.delay)])}function Cae(e,t,r=0,n=0,a=1,u){const f=[],i=(e.variantChildren.size-1)*n,y=a===1?(w=0)=>w*n:(w=0)=>i-w*n;return Array.from(e.variantChildren).sort(Aae).forEach((w,T)=>{w.notify("AnimationStart",t),f.push(uO(w,t,{...u,delay:r+y(T)}).then(()=>w.notify("AnimationComplete",t)))}),Promise.all(f)}function Aae(e,t){return e.sortNodePosition(t)}function Pae(e,t,r={}){e.notify("AnimationStart",t);let n;if(Array.isArray(t)){const a=t.map(u=>uO(e,u,r));n=Promise.all(a)}else if(typeof t=="string")n=uO(e,t,r);else{const a=typeof t=="function"?zE(e,t,r.custom):t;n=Promise.all(TW(e,a,r))}return n.then(()=>{e.notify("AnimationComplete",t)})}const Mae=NR.length;function CW(e){if(!e)return;if(!e.isControllingVariants){const r=e.parent?CW(e.parent)||{}:{};return e.props.initial!==void 0&&(r.initial=e.props.initial),r}const t={};for(let r=0;r<Mae;r++){const n=NR[r],a=e.props[n];(Ix(a)||a===!1)&&(t[n]=a)}return t}const Iae=[...DR].reverse(),kae=DR.length;function Oae(e){return t=>Promise.all(t.map(({animation:r,options:n})=>Pae(e,r,n)))}function Lae(e){let t=Oae(e),r=CB(),n=!0;const a=y=>(w,T)=>{var A;const k=zE(e,T,y==="exit"?(A=e.presenceContext)===null||A===void 0?void 0:A.custom:void 0);if(k){const{transition:F,transitionEnd:D,...O}=k;w={...w,...O,...D}}return w};function u(y){t=y(e)}function f(y){const{props:w}=e,T=CW(e.parent)||{},A=[],k=new Set;let F={},D=1/0;for(let N=0;N<kae;N++){const V=Iae[N],H=r[V],Z=w[V]!==void 0?w[V]:T[V],J=Ix(Z),G=V===y?H.isActive:null;G===!1&&(D=N);let Y=Z===T[V]&&Z!==w[V]&&J;if(Y&&n&&e.manuallyAnimateOnMount&&(Y=!1),H.protectedKeys={...F},!H.isActive&&G===null||!Z&&!H.prevProp||DE(Z)||typeof Z=="boolean")continue;const ie=Rae(H.prevProp,Z);let ce=ie||V===y&&H.isActive&&!Y&&J||N>D&&J,ge=!1;const be=Array.isArray(Z)?Z:[Z];let xe=be.reduce(a(V),{});G===!1&&(xe={});const{prevResolvedValues:Le={}}=H,ze={...Le,...xe},Xe=st=>{ce=!0,k.has(st)&&(ge=!0,k.delete(st)),H.needsAnimating[st]=!0;const Ne=e.getValue(st);Ne&&(Ne.liveStyle=!1)};for(const st in ze){const Ne=xe[st],We=Le[st];if(F.hasOwnProperty(st))continue;let Ue=!1;eO(Ne)&&eO(We)?Ue=!FH(Ne,We):Ue=Ne!==We,Ue?Ne!=null?Xe(st):k.add(st):Ne!==void 0&&k.has(st)?Xe(st):H.protectedKeys[st]=!0}H.prevProp=Z,H.prevResolvedValues=xe,H.isActive&&(F={...F,...xe}),n&&e.blockInitialAnimation&&(ce=!1),ce&&(!(Y&&ie)||ge)&&A.push(...be.map(st=>({animation:st,options:{type:V}})))}if(k.size){const N={};k.forEach(V=>{const H=e.getBaseTarget(V),Z=e.getValue(V);Z&&(Z.liveStyle=!0),N[V]=H??null}),A.push({animation:N})}let O=!!A.length;return n&&(w.initial===!1||w.initial===w.animate)&&!e.manuallyAnimateOnMount&&(O=!1),n=!1,O?t(A):Promise.resolve()}function i(y,w){var T;if(r[y].isActive===w)return Promise.resolve();(T=e.variantChildren)===null||T===void 0||T.forEach(k=>{var F;return(F=k.animationState)===null||F===void 0?void 0:F.setActive(y,w)}),r[y].isActive=w;const A=f(y);for(const k in r)r[k].protectedKeys={};return A}return{animateChanges:f,setActive:i,setAnimateFunction:u,getState:()=>r,reset:()=>{r=CB(),n=!0}}}function Rae(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!FH(t,e):!1}function Yg(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function CB(){return{animate:Yg(!0),whileInView:Yg(),whileHover:Yg(),whileTap:Yg(),whileDrag:Yg(),whileFocus:Yg(),exit:Yg()}}class Km{constructor(t){this.isMounted=!1,this.node=t}update(){}}class jae extends Km{constructor(t){super(t),t.animationState||(t.animationState=Lae(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();DE(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:r}=this.node.prevProps||{};t!==r&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)===null||t===void 0||t.call(this)}}let Dae=0;class Nae extends Km{constructor(){super(...arguments),this.id=Dae++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:r}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===n)return;const a=this.node.animationState.setActive("exit",!t);r&&!t&&a.then(()=>r(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const zae={animation:{Feature:jae},exit:{Feature:Nae}};function Rx(e,t,r,n={passive:!0}){return e.addEventListener(t,r,n),()=>e.removeEventListener(t,r)}function Rb(e){return{point:{x:e.pageX,y:e.pageY}}}const Fae=e=>t=>JR(t)&&e(t,Rb(t));function fx(e,t,r,n){return Rx(e,t,Fae(r),n)}const AB=(e,t)=>Math.abs(e-t);function Bae(e,t){const r=AB(e.x,t.x),n=AB(e.y,t.y);return Math.sqrt(r**2+n**2)}class AW{constructor(t,r,{transformPagePoint:n,contextWindow:a,dragSnapToOrigin:u=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const A=SC(this.lastMoveEventInfo,this.history),k=this.startEvent!==null,F=Bae(A.offset,{x:0,y:0})>=3;if(!k&&!F)return;const{point:D}=A,{timestamp:O}=Wa;this.history.push({...D,timestamp:O});const{onStart:N,onMove:V}=this.handlers;k||(N&&N(this.lastMoveEvent,A),this.startEvent=this.lastMoveEvent),V&&V(this.lastMoveEvent,A)},this.handlePointerMove=(A,k)=>{this.lastMoveEvent=A,this.lastMoveEventInfo=wC(k,this.transformPagePoint),Ks.update(this.updatePoint,!0)},this.handlePointerUp=(A,k)=>{this.end();const{onEnd:F,onSessionEnd:D,resumeAnimation:O}=this.handlers;if(this.dragSnapToOrigin&&O&&O(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const N=SC(A.type==="pointercancel"?this.lastMoveEventInfo:wC(k,this.transformPagePoint),this.history);this.startEvent&&F&&F(A,N),D&&D(A,N)},!JR(t))return;this.dragSnapToOrigin=u,this.handlers=r,this.transformPagePoint=n,this.contextWindow=a||window;const f=Rb(t),i=wC(f,this.transformPagePoint),{point:y}=i,{timestamp:w}=Wa;this.history=[{...y,timestamp:w}];const{onSessionStart:T}=r;T&&T(t,SC(i,this.history)),this.removeListeners=Lb(fx(this.contextWindow,"pointermove",this.handlePointerMove),fx(this.contextWindow,"pointerup",this.handlePointerUp),fx(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),Vm(this.updatePoint)}}function wC(e,t){return t?{point:t(e.point)}:e}function PB(e,t){return{x:e.x-t.x,y:e.y-t.y}}function SC({point:e},t){return{point:e,delta:PB(e,PW(t)),offset:PB(e,$ae(t)),velocity:Vae(t,.1)}}function $ae(e){return e[0]}function PW(e){return e[e.length-1]}function Vae(e,t){if(e.length<2)return{x:0,y:0};let r=e.length-1,n=null;const a=PW(e);for(;r>=0&&(n=e[r],!(a.timestamp-n.timestamp>fp(t)));)r--;if(!n)return{x:0,y:0};const u=pp(a.timestamp-n.timestamp);if(u===0)return{x:0,y:0};const f={x:(a.x-n.x)/u,y:(a.y-n.y)/u};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}const MW=1e-4,Uae=1-MW,qae=1+MW,IW=.01,Gae=0-IW,Hae=0+IW;function uu(e){return e.max-e.min}function Wae(e,t,r){return Math.abs(e-t)<=r}function MB(e,t,r,n=.5){e.origin=n,e.originPoint=_o(t.min,t.max,e.origin),e.scale=uu(r)/uu(t),e.translate=_o(r.min,r.max,e.origin)-e.originPoint,(e.scale>=Uae&&e.scale<=qae||isNaN(e.scale))&&(e.scale=1),(e.translate>=Gae&&e.translate<=Hae||isNaN(e.translate))&&(e.translate=0)}function px(e,t,r,n){MB(e.x,t.x,r.x,n?n.originX:void 0),MB(e.y,t.y,r.y,n?n.originY:void 0)}function IB(e,t,r){e.min=r.min+t.min,e.max=e.min+uu(t)}function Zae(e,t,r){IB(e.x,t.x,r.x),IB(e.y,t.y,r.y)}function kB(e,t,r){e.min=t.min-r.min,e.max=e.min+uu(t)}function mx(e,t,r){kB(e.x,t.x,r.x),kB(e.y,t.y,r.y)}function Xae(e,{min:t,max:r},n){return t!==void 0&&e<t?e=n?_o(t,e,n.min):Math.max(e,t):r!==void 0&&e>r&&(e=n?_o(r,e,n.max):Math.min(e,r)),e}function OB(e,t,r){return{min:t!==void 0?e.min+t:void 0,max:r!==void 0?e.max+r-(e.max-e.min):void 0}}function Kae(e,{top:t,left:r,bottom:n,right:a}){return{x:OB(e.x,r,a),y:OB(e.y,t,n)}}function LB(e,t){let r=t.min-e.min,n=t.max-e.max;return t.max-t.min<e.max-e.min&&([r,n]=[n,r]),{min:r,max:n}}function Yae(e,t){return{x:LB(e.x,t.x),y:LB(e.y,t.y)}}function Jae(e,t){let r=.5;const n=uu(e),a=uu(t);return a>n?r=Wv(t.min,t.max-n,e.min):n>a&&(r=Wv(e.min,e.max-a,t.min)),vp(0,1,r)}function Qae(e,t){const r={};return t.min!==void 0&&(r.min=t.min-e.min),t.max!==void 0&&(r.max=t.max-e.min),r}const dO=.35;function ele(e=dO){return e===!1?e=0:e===!0&&(e=dO),{x:RB(e,"left","right"),y:RB(e,"top","bottom")}}function RB(e,t,r){return{min:jB(e,t),max:jB(e,r)}}function jB(e,t){return typeof e=="number"?e:e[t]||0}const DB=()=>({translate:0,scale:1,origin:0,originPoint:0}),Mv=()=>({x:DB(),y:DB()}),NB=()=>({min:0,max:0}),Fo=()=>({x:NB(),y:NB()});function Gu(e){return[e("x"),e("y")]}function kW({top:e,left:t,right:r,bottom:n}){return{x:{min:t,max:r},y:{min:e,max:n}}}function tle({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function rle(e,t){if(!t)return e;const r=t({x:e.left,y:e.top}),n=t({x:e.right,y:e.bottom});return{top:r.y,left:r.x,bottom:n.y,right:n.x}}function EC(e){return e===void 0||e===1}function hO({scale:e,scaleX:t,scaleY:r}){return!EC(e)||!EC(t)||!EC(r)}function ty(e){return hO(e)||OW(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function OW(e){return zB(e.x)||zB(e.y)}function zB(e){return e&&e!=="0%"}function oS(e,t,r){const n=e-r,a=t*n;return r+a}function FB(e,t,r,n,a){return a!==void 0&&(e=oS(e,a,n)),oS(e,r,n)+t}function fO(e,t=0,r=1,n,a){e.min=FB(e.min,t,r,n,a),e.max=FB(e.max,t,r,n,a)}function LW(e,{x:t,y:r}){fO(e.x,t.translate,t.scale,t.originPoint),fO(e.y,r.translate,r.scale,r.originPoint)}const BB=.999999999999,$B=1.0000000000001;function nle(e,t,r,n=!1){const a=r.length;if(!a)return;t.x=t.y=1;let u,f;for(let i=0;i<a;i++){u=r[i],f=u.projectionDelta;const{visualElement:y}=u.options;y&&y.props.style&&y.props.style.display==="contents"||(n&&u.options.layoutScroll&&u.scroll&&u!==u.root&&kv(e,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),f&&(t.x*=f.x.scale,t.y*=f.y.scale,LW(e,f)),n&&ty(u.latestValues)&&kv(e,u.latestValues))}t.x<$B&&t.x>BB&&(t.x=1),t.y<$B&&t.y>BB&&(t.y=1)}function Iv(e,t){e.min=e.min+t,e.max=e.max+t}function VB(e,t,r,n,a=.5){const u=_o(e.min,e.max,a);fO(e,t,r,u,n)}function kv(e,t){VB(e.x,t.x,t.scaleX,t.scale,t.originX),VB(e.y,t.y,t.scaleY,t.scale,t.originY)}function RW(e,t){return kW(rle(e.getBoundingClientRect(),t))}function ile(e,t,r){const n=RW(e,r),{scroll:a}=t;return a&&(Iv(n.x,a.offset.x),Iv(n.y,a.offset.y)),n}const jW=({current:e})=>e?e.ownerDocument.defaultView:null,sle=new WeakMap;class ole{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Fo(),this.visualElement=t}start(t,{snapToCursor:r=!1}={}){const{presenceContext:n}=this.visualElement;if(n&&n.isPresent===!1)return;const a=T=>{const{dragSnapToOrigin:A}=this.getProps();A?this.pauseAnimation():this.stopAnimation(),r&&this.snapToCursor(Rb(T).point)},u=(T,A)=>{const{drag:k,dragPropagation:F,onDragStart:D}=this.getProps();if(k&&!F&&(this.openDragLock&&this.openDragLock(),this.openDragLock=Jse(k),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Gu(N=>{let V=this.getAxisMotionValue(N).get()||0;if(sf.test(V)){const{projection:H}=this.visualElement;if(H&&H.layout){const Z=H.layout.layoutBox[N];Z&&(V=uu(Z)*(parseFloat(V)/100))}}this.originPoint[N]=V}),D&&Ks.postRender(()=>D(T,A)),nO(this.visualElement,"transform");const{animationState:O}=this.visualElement;O&&O.setActive("whileDrag",!0)},f=(T,A)=>{const{dragPropagation:k,dragDirectionLock:F,onDirectionLock:D,onDrag:O}=this.getProps();if(!k&&!this.openDragLock)return;const{offset:N}=A;if(F&&this.currentDirection===null){this.currentDirection=ale(N),this.currentDirection!==null&&D&&D(this.currentDirection);return}this.updateAxis("x",A.point,N),this.updateAxis("y",A.point,N),this.visualElement.render(),O&&O(T,A)},i=(T,A)=>this.stop(T,A),y=()=>Gu(T=>{var A;return this.getAnimationState(T)==="paused"&&((A=this.getAxisMotionValue(T).animation)===null||A===void 0?void 0:A.play())}),{dragSnapToOrigin:w}=this.getProps();this.panSession=new AW(t,{onSessionStart:a,onStart:u,onMove:f,onSessionEnd:i,resumeAnimation:y},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:w,contextWindow:jW(this.visualElement)})}stop(t,r){const n=this.isDragging;if(this.cancel(),!n)return;const{velocity:a}=r;this.startAnimation(a);const{onDragEnd:u}=this.getProps();u&&Ks.postRender(()=>u(t,r))}cancel(){this.isDragging=!1;const{projection:t,animationState:r}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),r&&r.setActive("whileDrag",!1)}updateAxis(t,r,n){const{drag:a}=this.getProps();if(!n||!nw(t,a,this.currentDirection))return;const u=this.getAxisMotionValue(t);let f=this.originPoint[t]+n[t];this.constraints&&this.constraints[t]&&(f=Xae(f,this.constraints[t],this.elastic[t])),u.set(f)}resolveConstraints(){var t;const{dragConstraints:r,dragElastic:n}=this.getProps(),a=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,u=this.constraints;r&&Av(r)?this.constraints||(this.constraints=this.resolveRefConstraints()):r&&a?this.constraints=Kae(a.layoutBox,r):this.constraints=!1,this.elastic=ele(n),u!==this.constraints&&a&&this.constraints&&!this.hasMutatedConstraints&&Gu(f=>{this.constraints!==!1&&this.getAxisMotionValue(f)&&(this.constraints[f]=Qae(a.layoutBox[f],this.constraints[f]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:r}=this.getProps();if(!t||!Av(t))return!1;const n=t.current,{projection:a}=this.visualElement;if(!a||!a.layout)return!1;const u=ile(n,a.root,this.visualElement.getTransformPagePoint());let f=Yae(a.layout.layoutBox,u);if(r){const i=r(tle(f));this.hasMutatedConstraints=!!i,i&&(f=kW(i))}return f}startAnimation(t){const{drag:r,dragMomentum:n,dragElastic:a,dragTransition:u,dragSnapToOrigin:f,onDragTransitionEnd:i}=this.getProps(),y=this.constraints||{},w=Gu(T=>{if(!nw(T,r,this.currentDirection))return;let A=y&&y[T]||{};f&&(A={min:0,max:0});const k=a?200:1e6,F=a?40:1e7,D={type:"inertia",velocity:n?t[T]:0,bounceStiffness:k,bounceDamping:F,timeConstant:750,restDelta:1,restSpeed:10,...u,...A};return this.startAxisValueAnimation(T,D)});return Promise.all(w).then(i)}startAxisValueAnimation(t,r){const n=this.getAxisMotionValue(t);return nO(this.visualElement,t),n.start(uj(t,n,0,r,this.visualElement,!1))}stopAnimation(){Gu(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Gu(t=>{var r;return(r=this.getAxisMotionValue(t).animation)===null||r===void 0?void 0:r.pause()})}getAnimationState(t){var r;return(r=this.getAxisMotionValue(t).animation)===null||r===void 0?void 0:r.state}getAxisMotionValue(t){const r=`_drag${t.toUpperCase()}`,n=this.visualElement.getProps(),a=n[r];return a||this.visualElement.getValue(t,(n.initial?n.initial[t]:void 0)||0)}snapToCursor(t){Gu(r=>{const{drag:n}=this.getProps();if(!nw(r,n,this.currentDirection))return;const{projection:a}=this.visualElement,u=this.getAxisMotionValue(r);if(a&&a.layout){const{min:f,max:i}=a.layout.layoutBox[r];u.set(t[r]-_o(f,i,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:r}=this.getProps(),{projection:n}=this.visualElement;if(!Av(r)||!n||!this.constraints)return;this.stopAnimation();const a={x:0,y:0};Gu(f=>{const i=this.getAxisMotionValue(f);if(i&&this.constraints!==!1){const y=i.get();a[f]=Jae({min:y,max:y},this.constraints[f])}});const{transformTemplate:u}=this.visualElement.getProps();this.visualElement.current.style.transform=u?u({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),Gu(f=>{if(!nw(f,t,null))return;const i=this.getAxisMotionValue(f),{min:y,max:w}=this.constraints[f];i.set(_o(y,w,a[f]))})}addListeners(){if(!this.visualElement.current)return;sle.set(this.visualElement,this);const t=this.visualElement.current,r=fx(t,"pointerdown",y=>{const{drag:w,dragListener:T=!0}=this.getProps();w&&T&&this.start(y)}),n=()=>{const{dragConstraints:y}=this.getProps();Av(y)&&y.current&&(this.constraints=this.resolveRefConstraints())},{projection:a}=this.visualElement,u=a.addEventListener("measure",n);a&&!a.layout&&(a.root&&a.root.updateScroll(),a.updateLayout()),Ks.read(n);const f=Rx(window,"resize",()=>this.scalePositionWithinConstraints()),i=a.addEventListener("didUpdate",({delta:y,hasLayoutChanged:w})=>{this.isDragging&&w&&(Gu(T=>{const A=this.getAxisMotionValue(T);A&&(this.originPoint[T]+=y[T].translate,A.set(A.get()+y[T].translate))}),this.visualElement.render())});return()=>{f(),r(),u(),i&&i()}}getProps(){const t=this.visualElement.getProps(),{drag:r=!1,dragDirectionLock:n=!1,dragPropagation:a=!1,dragConstraints:u=!1,dragElastic:f=dO,dragMomentum:i=!0}=t;return{...t,drag:r,dragDirectionLock:n,dragPropagation:a,dragConstraints:u,dragElastic:f,dragMomentum:i}}}function nw(e,t,r){return(t===!0||t===e)&&(r===null||r===e)}function ale(e,t=10){let r=null;return Math.abs(e.y)>t?r="y":Math.abs(e.x)>t&&(r="x"),r}class lle extends Km{constructor(t){super(t),this.removeGroupControls=au,this.removeListeners=au,this.controls=new ole(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||au}unmount(){this.removeGroupControls(),this.removeListeners()}}const UB=e=>(t,r)=>{e&&Ks.postRender(()=>e(t,r))};class cle extends Km{constructor(){super(...arguments),this.removePointerDownListener=au}onPointerDown(t){this.session=new AW(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:jW(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:r,onPan:n,onPanEnd:a}=this.node.getProps();return{onSessionStart:UB(t),onStart:UB(r),onMove:n,onEnd:(u,f)=>{delete this.session,a&&Ks.postRender(()=>a(u,f))}}}mount(){this.removePointerDownListener=fx(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const Vw={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function qB(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const N0={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(Kn.test(e))e=parseFloat(e);else return e;const r=qB(e,t.target.x),n=qB(e,t.target.y);return`${r}% ${n}%`}},ule={correct:(e,{treeScale:t,projectionDelta:r})=>{const n=e,a=Um.parse(e);if(a.length>5)return n;const u=Um.createTransformer(e),f=typeof a[0]!="number"?1:0,i=r.x.scale*t.x,y=r.y.scale*t.y;a[0+f]/=i,a[1+f]/=y;const w=_o(i,y,.5);return typeof a[2+f]=="number"&&(a[2+f]/=w),typeof a[3+f]=="number"&&(a[3+f]/=w),u(a)}};class dle extends j.Component{componentDidMount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:n,layoutId:a}=this.props,{projection:u}=t;kse(hle),u&&(r.group&&r.group.add(u),n&&n.register&&a&&n.register(u),u.root.didUpdate(),u.addEventListener("animationComplete",()=>{this.safeToRemove()}),u.setOptions({...u.options,onExitComplete:()=>this.safeToRemove()})),Vw.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:r,visualElement:n,drag:a,isPresent:u}=this.props,f=n.projection;return f&&(f.isPresent=u,a||t.layoutDependency!==r||r===void 0?f.willUpdate():this.safeToRemove(),t.isPresent!==u&&(u?f.promote():f.relegate()||Ks.postRender(()=>{const i=f.getStack();(!i||!i.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),FR.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:n}=this.props,{projection:a}=t;a&&(a.scheduleCheckAfterUnmount(),r&&r.group&&r.group.remove(a),n&&n.deregister&&n.deregister(a))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function DW(e){const[t,r]=vH(),n=j.useContext(kR);return b.jsx(dle,{...e,layoutGroup:n,switchLayoutGroup:j.useContext(CH),isPresent:t,safeToRemove:r})}const hle={borderRadius:{...N0,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:N0,borderTopRightRadius:N0,borderBottomLeftRadius:N0,borderBottomRightRadius:N0,boxShadow:ule};function fle(e,t,r){const n=_l(e)?e:Ox(e);return n.start(uj("",n,t,r)),n.animation}function ple(e){return e instanceof SVGElement&&e.tagName!=="svg"}const mle=(e,t)=>e.depth-t.depth;class gle{constructor(){this.children=[],this.isDirty=!1}add(t){QR(this.children,t),this.isDirty=!0}remove(t){ej(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(mle),this.isDirty=!1,this.children.forEach(t)}}function yle(e,t){const r=of.now(),n=({timestamp:a})=>{const u=a-r;u>=t&&(Vm(n),e(u-t))};return Ks.read(n,!0),()=>Vm(n)}const NW=["TopLeft","TopRight","BottomLeft","BottomRight"],vle=NW.length,GB=e=>typeof e=="string"?parseFloat(e):e,HB=e=>typeof e=="number"||Kn.test(e);function _le(e,t,r,n,a,u){a?(e.opacity=_o(0,r.opacity!==void 0?r.opacity:1,xle(n)),e.opacityExit=_o(t.opacity!==void 0?t.opacity:1,0,ble(n))):u&&(e.opacity=_o(t.opacity!==void 0?t.opacity:1,r.opacity!==void 0?r.opacity:1,n));for(let f=0;f<vle;f++){const i=`border${NW[f]}Radius`;let y=WB(t,i),w=WB(r,i);if(y===void 0&&w===void 0)continue;y||(y=0),w||(w=0),y===0||w===0||HB(y)===HB(w)?(e[i]=Math.max(_o(GB(y),GB(w),n),0),(sf.test(w)||sf.test(y))&&(e[i]+="%")):e[i]=w}(t.rotate||r.rotate)&&(e.rotate=_o(t.rotate||0,r.rotate||0,n))}function WB(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const xle=zW(0,.5,rW),ble=zW(.5,.95,au);function zW(e,t,r){return n=>n<e?0:n>t?1:r(Wv(e,t,n))}function ZB(e,t){e.min=t.min,e.max=t.max}function Vu(e,t){ZB(e.x,t.x),ZB(e.y,t.y)}function XB(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function KB(e,t,r,n,a){return e-=t,e=oS(e,1/r,n),a!==void 0&&(e=oS(e,1/a,n)),e}function wle(e,t=0,r=1,n=.5,a,u=e,f=e){if(sf.test(t)&&(t=parseFloat(t),t=_o(f.min,f.max,t/100)-f.min),typeof t!="number")return;let i=_o(u.min,u.max,n);e===u&&(i-=t),e.min=KB(e.min,t,r,i,a),e.max=KB(e.max,t,r,i,a)}function YB(e,t,[r,n,a],u,f){wle(e,t[r],t[n],t[a],t.scale,u,f)}const Sle=["x","scaleX","originX"],Ele=["y","scaleY","originY"];function JB(e,t,r,n){YB(e.x,t,Sle,r?r.x:void 0,n?n.x:void 0),YB(e.y,t,Ele,r?r.y:void 0,n?n.y:void 0)}function QB(e){return e.translate===0&&e.scale===1}function FW(e){return QB(e.x)&&QB(e.y)}function e4(e,t){return e.min===t.min&&e.max===t.max}function Tle(e,t){return e4(e.x,t.x)&&e4(e.y,t.y)}function t4(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function BW(e,t){return t4(e.x,t.x)&&t4(e.y,t.y)}function r4(e){return uu(e.x)/uu(e.y)}function n4(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class Cle{constructor(){this.members=[]}add(t){QR(this.members,t),t.scheduleRender()}remove(t){if(ej(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const r=this.members[this.members.length-1];r&&this.promote(r)}}relegate(t){const r=this.members.findIndex(a=>t===a);if(r===0)return!1;let n;for(let a=r;a>=0;a--){const u=this.members[a];if(u.isPresent!==!1){n=u;break}}return n?(this.promote(n),!0):!1}promote(t,r){const n=this.lead;if(t!==n&&(this.prevLead=n,this.lead=t,t.show(),n)){n.instance&&n.scheduleRender(),t.scheduleRender(),t.resumeFrom=n,r&&(t.resumeFrom.preserveOpacity=!0),n.snapshot&&(t.snapshot=n.snapshot,t.snapshot.latestValues=n.animationValues||n.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:a}=t.options;a===!1&&n.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:r,resumingFrom:n}=t;r.onExitComplete&&r.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function Ale(e,t,r){let n="";const a=e.x.translate/t.x,u=e.y.translate/t.y,f=(r==null?void 0:r.z)||0;if((a||u||f)&&(n=`translate3d(${a}px, ${u}px, ${f}px) `),(t.x!==1||t.y!==1)&&(n+=`scale(${1/t.x}, ${1/t.y}) `),r){const{transformPerspective:w,rotate:T,rotateX:A,rotateY:k,skewX:F,skewY:D}=r;w&&(n=`perspective(${w}px) ${n}`),T&&(n+=`rotate(${T}deg) `),A&&(n+=`rotateX(${A}deg) `),k&&(n+=`rotateY(${k}deg) `),F&&(n+=`skewX(${F}deg) `),D&&(n+=`skewY(${D}deg) `)}const i=e.x.scale*t.x,y=e.y.scale*t.y;return(i!==1||y!==1)&&(n+=`scale(${i}, ${y})`),n||"none"}const ry={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},ax=typeof window<"u"&&window.MotionDebug!==void 0,TC=["","X","Y","Z"],Ple={visibility:"hidden"},i4=1e3;let Mle=0;function CC(e,t,r,n){const{latestValues:a}=t;a[e]&&(r[e]=a[e],t.setStaticValue(e,0),n&&(n[e]=0))}function $W(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const r=XH(t);if(window.MotionHasOptimisedAnimation(r,"transform")){const{layout:a,layoutId:u}=e.options;window.MotionCancelOptimisedAnimation(r,"transform",Ks,!(a||u))}const{parent:n}=e;n&&!n.hasCheckedOptimisedAppear&&$W(n)}function VW({attachResizeListener:e,defaultParent:t,measureScroll:r,checkIsScrollRoot:n,resetTransform:a}){return class{constructor(f={},i=t==null?void 0:t()){this.id=Mle++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,ax&&(ry.totalNodes=ry.resolvedTargetDeltas=ry.recalculatedProjection=0),this.nodes.forEach(Ole),this.nodes.forEach(Nle),this.nodes.forEach(zle),this.nodes.forEach(Lle),ax&&window.MotionDebug.record(ry)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=f,this.root=i?i.root||i:this,this.path=i?[...i.path,i]:[],this.parent=i,this.depth=i?i.depth+1:0;for(let y=0;y<this.path.length;y++)this.path[y].shouldResetTransform=!0;this.root===this&&(this.nodes=new gle)}addEventListener(f,i){return this.eventHandlers.has(f)||this.eventHandlers.set(f,new tj),this.eventHandlers.get(f).add(i)}notifyListeners(f,...i){const y=this.eventHandlers.get(f);y&&y.notify(...i)}hasListeners(f){return this.eventHandlers.has(f)}mount(f,i=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=ple(f),this.instance=f;const{layoutId:y,layout:w,visualElement:T}=this.options;if(T&&!T.current&&T.mount(f),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),i&&(w||y)&&(this.isLayoutDirty=!0),e){let A;const k=()=>this.root.updateBlockedByResize=!1;e(f,()=>{this.root.updateBlockedByResize=!0,A&&A(),A=yle(k,250),Vw.hasAnimatedSinceResize&&(Vw.hasAnimatedSinceResize=!1,this.nodes.forEach(o4))})}y&&this.root.registerSharedNode(y,this),this.options.animate!==!1&&T&&(y||w)&&this.addEventListener("didUpdate",({delta:A,hasLayoutChanged:k,hasRelativeTargetChanged:F,layout:D})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const O=this.options.transition||T.getDefaultTransition()||Ule,{onLayoutAnimationStart:N,onLayoutAnimationComplete:V}=T.getProps(),H=!this.targetLayout||!BW(this.targetLayout,D)||F,Z=!k&&F;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||Z||k&&(H||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(A,Z);const J={...XR(O,"layout"),onPlay:N,onComplete:V};(T.shouldReduceMotion||this.options.layoutRoot)&&(J.delay=0,J.type=!1),this.startAnimation(J)}else k||o4(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=D})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const f=this.getStack();f&&f.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Vm(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Fle),this.animationId++)}getTransformTemplate(){const{visualElement:f}=this.options;return f&&f.getProps().transformTemplate}willUpdate(f=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&$W(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let T=0;T<this.path.length;T++){const A=this.path[T];A.shouldResetTransform=!0,A.updateScroll("snapshot"),A.options.layoutRoot&&A.willUpdate(!1)}const{layoutId:i,layout:y}=this.options;if(i===void 0&&!y)return;const w=this.getTransformTemplate();this.prevTransformTemplateValue=w?w(this.latestValues,""):void 0,this.updateSnapshot(),f&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(s4);return}this.isUpdating||this.nodes.forEach(jle),this.isUpdating=!1,this.nodes.forEach(Dle),this.nodes.forEach(Ile),this.nodes.forEach(kle),this.clearAllSnapshots();const i=of.now();Wa.delta=vp(0,1e3/60,i-Wa.timestamp),Wa.timestamp=i,Wa.isProcessing=!0,yC.update.process(Wa),yC.preRender.process(Wa),yC.render.process(Wa),Wa.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,FR.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Rle),this.sharedNodes.forEach(Ble)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Ks.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Ks.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let y=0;y<this.path.length;y++)this.path[y].updateScroll();const f=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Fo(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:i}=this.options;i&&i.notify("LayoutMeasure",this.layout.layoutBox,f?f.layoutBox:void 0)}updateScroll(f="measure"){let i=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===f&&(i=!1),i){const y=n(this.instance);this.scroll={animationId:this.root.animationId,phase:f,isRoot:y,offset:r(this.instance),wasRoot:this.scroll?this.scroll.isRoot:y}}}resetTransform(){if(!a)return;const f=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,i=this.projectionDelta&&!FW(this.projectionDelta),y=this.getTransformTemplate(),w=y?y(this.latestValues,""):void 0,T=w!==this.prevTransformTemplateValue;f&&(i||ty(this.latestValues)||T)&&(a(this.instance,w),this.shouldResetTransform=!1,this.scheduleRender())}measure(f=!0){const i=this.measurePageBox();let y=this.removeElementScroll(i);return f&&(y=this.removeTransform(y)),qle(y),{animationId:this.root.animationId,measuredBox:i,layoutBox:y,latestValues:{},source:this.id}}measurePageBox(){var f;const{visualElement:i}=this.options;if(!i)return Fo();const y=i.measureViewportBox();if(!(((f=this.scroll)===null||f===void 0?void 0:f.wasRoot)||this.path.some(Gle))){const{scroll:T}=this.root;T&&(Iv(y.x,T.offset.x),Iv(y.y,T.offset.y))}return y}removeElementScroll(f){var i;const y=Fo();if(Vu(y,f),!((i=this.scroll)===null||i===void 0)&&i.wasRoot)return y;for(let w=0;w<this.path.length;w++){const T=this.path[w],{scroll:A,options:k}=T;T!==this.root&&A&&k.layoutScroll&&(A.wasRoot&&Vu(y,f),Iv(y.x,A.offset.x),Iv(y.y,A.offset.y))}return y}applyTransform(f,i=!1){const y=Fo();Vu(y,f);for(let w=0;w<this.path.length;w++){const T=this.path[w];!i&&T.options.layoutScroll&&T.scroll&&T!==T.root&&kv(y,{x:-T.scroll.offset.x,y:-T.scroll.offset.y}),ty(T.latestValues)&&kv(y,T.latestValues)}return ty(this.latestValues)&&kv(y,this.latestValues),y}removeTransform(f){const i=Fo();Vu(i,f);for(let y=0;y<this.path.length;y++){const w=this.path[y];if(!w.instance||!ty(w.latestValues))continue;hO(w.latestValues)&&w.updateSnapshot();const T=Fo(),A=w.measurePageBox();Vu(T,A),JB(i,w.latestValues,w.snapshot?w.snapshot.layoutBox:void 0,T)}return ty(this.latestValues)&&JB(i,this.latestValues),i}setTargetDelta(f){this.targetDelta=f,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(f){this.options={...this.options,...f,crossfade:f.crossfade!==void 0?f.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Wa.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(f=!1){var i;const y=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=y.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=y.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=y.isSharedProjectionDirty);const w=!!this.resumingFrom||this!==y;if(!(f||w&&this.isSharedProjectionDirty||this.isProjectionDirty||!((i=this.parent)===null||i===void 0)&&i.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:A,layoutId:k}=this.options;if(!(!this.layout||!(A||k))){if(this.resolvedRelativeTargetAt=Wa.timestamp,!this.targetDelta&&!this.relativeTarget){const F=this.getClosestProjectingParent();F&&F.layout&&this.animationProgress!==1?(this.relativeParent=F,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Fo(),this.relativeTargetOrigin=Fo(),mx(this.relativeTargetOrigin,this.layout.layoutBox,F.layout.layoutBox),Vu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Fo(),this.targetWithTransforms=Fo()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Zae(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Vu(this.target,this.layout.layoutBox),LW(this.target,this.targetDelta)):Vu(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const F=this.getClosestProjectingParent();F&&!!F.resumingFrom==!!this.resumingFrom&&!F.options.layoutScroll&&F.target&&this.animationProgress!==1?(this.relativeParent=F,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Fo(),this.relativeTargetOrigin=Fo(),mx(this.relativeTargetOrigin,this.target,F.target),Vu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}ax&&ry.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||hO(this.parent.latestValues)||OW(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var f;const i=this.getLead(),y=!!this.resumingFrom||this!==i;let w=!0;if((this.isProjectionDirty||!((f=this.parent)===null||f===void 0)&&f.isProjectionDirty)&&(w=!1),y&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(w=!1),this.resolvedRelativeTargetAt===Wa.timestamp&&(w=!1),w)return;const{layout:T,layoutId:A}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(T||A))return;Vu(this.layoutCorrected,this.layout.layoutBox);const k=this.treeScale.x,F=this.treeScale.y;nle(this.layoutCorrected,this.treeScale,this.path,y),i.layout&&!i.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(i.target=i.layout.layoutBox,i.targetWithTransforms=Fo());const{target:D}=i;if(!D){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(XB(this.prevProjectionDelta.x,this.projectionDelta.x),XB(this.prevProjectionDelta.y,this.projectionDelta.y)),px(this.projectionDelta,this.layoutCorrected,D,this.latestValues),(this.treeScale.x!==k||this.treeScale.y!==F||!n4(this.projectionDelta.x,this.prevProjectionDelta.x)||!n4(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",D)),ax&&ry.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(f=!0){var i;if((i=this.options.visualElement)===null||i===void 0||i.scheduleRender(),f){const y=this.getStack();y&&y.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Mv(),this.projectionDelta=Mv(),this.projectionDeltaWithTransform=Mv()}setAnimationOrigin(f,i=!1){const y=this.snapshot,w=y?y.latestValues:{},T={...this.latestValues},A=Mv();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!i;const k=Fo(),F=y?y.source:void 0,D=this.layout?this.layout.source:void 0,O=F!==D,N=this.getStack(),V=!N||N.members.length<=1,H=!!(O&&!V&&this.options.crossfade===!0&&!this.path.some(Vle));this.animationProgress=0;let Z;this.mixTargetDelta=J=>{const G=J/1e3;a4(A.x,f.x,G),a4(A.y,f.y,G),this.setTargetDelta(A),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(mx(k,this.layout.layoutBox,this.relativeParent.layout.layoutBox),$le(this.relativeTarget,this.relativeTargetOrigin,k,G),Z&&Tle(this.relativeTarget,Z)&&(this.isProjectionDirty=!1),Z||(Z=Fo()),Vu(Z,this.relativeTarget)),O&&(this.animationValues=T,_le(T,w,this.latestValues,G,H,V)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=G},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(f){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Vm(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Ks.update(()=>{Vw.hasAnimatedSinceResize=!0,this.currentAnimation=fle(0,i4,{...f,onUpdate:i=>{this.mixTargetDelta(i),f.onUpdate&&f.onUpdate(i)},onComplete:()=>{f.onComplete&&f.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const f=this.getStack();f&&f.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(i4),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const f=this.getLead();let{targetWithTransforms:i,target:y,layout:w,latestValues:T}=f;if(!(!i||!y||!w)){if(this!==f&&this.layout&&w&&UW(this.options.animationType,this.layout.layoutBox,w.layoutBox)){y=this.target||Fo();const A=uu(this.layout.layoutBox.x);y.x.min=f.target.x.min,y.x.max=y.x.min+A;const k=uu(this.layout.layoutBox.y);y.y.min=f.target.y.min,y.y.max=y.y.min+k}Vu(i,y),kv(i,T),px(this.projectionDeltaWithTransform,this.layoutCorrected,i,T)}}registerSharedNode(f,i){this.sharedNodes.has(f)||this.sharedNodes.set(f,new Cle),this.sharedNodes.get(f).add(i);const w=i.options.initialPromotionConfig;i.promote({transition:w?w.transition:void 0,preserveFollowOpacity:w&&w.shouldPreserveFollowOpacity?w.shouldPreserveFollowOpacity(i):void 0})}isLead(){const f=this.getStack();return f?f.lead===this:!0}getLead(){var f;const{layoutId:i}=this.options;return i?((f=this.getStack())===null||f===void 0?void 0:f.lead)||this:this}getPrevLead(){var f;const{layoutId:i}=this.options;return i?(f=this.getStack())===null||f===void 0?void 0:f.prevLead:void 0}getStack(){const{layoutId:f}=this.options;if(f)return this.root.sharedNodes.get(f)}promote({needsReset:f,transition:i,preserveFollowOpacity:y}={}){const w=this.getStack();w&&w.promote(this,y),f&&(this.projectionDelta=void 0,this.needsReset=!0),i&&this.setOptions({transition:i})}relegate(){const f=this.getStack();return f?f.relegate(this):!1}resetSkewAndRotation(){const{visualElement:f}=this.options;if(!f)return;let i=!1;const{latestValues:y}=f;if((y.z||y.rotate||y.rotateX||y.rotateY||y.rotateZ||y.skewX||y.skewY)&&(i=!0),!i)return;const w={};y.z&&CC("z",f,w,this.animationValues);for(let T=0;T<TC.length;T++)CC(`rotate${TC[T]}`,f,w,this.animationValues),CC(`skew${TC[T]}`,f,w,this.animationValues);f.render();for(const T in w)f.setStaticValue(T,w[T]),this.animationValues&&(this.animationValues[T]=w[T]);f.scheduleRender()}getProjectionStyles(f){var i,y;if(!this.instance||this.isSVG)return;if(!this.isVisible)return Ple;const w={visibility:""},T=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,w.opacity="",w.pointerEvents=Bw(f==null?void 0:f.pointerEvents)||"",w.transform=T?T(this.latestValues,""):"none",w;const A=this.getLead();if(!this.projectionDelta||!this.layout||!A.target){const O={};return this.options.layoutId&&(O.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,O.pointerEvents=Bw(f==null?void 0:f.pointerEvents)||""),this.hasProjected&&!ty(this.latestValues)&&(O.transform=T?T({},""):"none",this.hasProjected=!1),O}const k=A.animationValues||A.latestValues;this.applyTransformsToTarget(),w.transform=Ale(this.projectionDeltaWithTransform,this.treeScale,k),T&&(w.transform=T(k,w.transform));const{x:F,y:D}=this.projectionDelta;w.transformOrigin=`${F.origin*100}% ${D.origin*100}% 0`,A.animationValues?w.opacity=A===this?(y=(i=k.opacity)!==null&&i!==void 0?i:this.latestValues.opacity)!==null&&y!==void 0?y:1:this.preserveOpacity?this.latestValues.opacity:k.opacityExit:w.opacity=A===this?k.opacity!==void 0?k.opacity:"":k.opacityExit!==void 0?k.opacityExit:0;for(const O in tS){if(k[O]===void 0)continue;const{correct:N,applyTo:V}=tS[O],H=w.transform==="none"?k[O]:N(k[O],A);if(V){const Z=V.length;for(let J=0;J<Z;J++)w[V[J]]=H}else w[O]=H}return this.options.layoutId&&(w.pointerEvents=A===this?Bw(f==null?void 0:f.pointerEvents)||"":"none"),w}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(f=>{var i;return(i=f.currentAnimation)===null||i===void 0?void 0:i.stop()}),this.root.nodes.forEach(s4),this.root.sharedNodes.clear()}}}function Ile(e){e.updateLayout()}function kle(e){var t;const r=((t=e.resumeFrom)===null||t===void 0?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&r&&e.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:a}=e.layout,{animationType:u}=e.options,f=r.source!==e.layout.source;u==="size"?Gu(A=>{const k=f?r.measuredBox[A]:r.layoutBox[A],F=uu(k);k.min=n[A].min,k.max=k.min+F}):UW(u,r.layoutBox,n)&&Gu(A=>{const k=f?r.measuredBox[A]:r.layoutBox[A],F=uu(n[A]);k.max=k.min+F,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[A].max=e.relativeTarget[A].min+F)});const i=Mv();px(i,n,r.layoutBox);const y=Mv();f?px(y,e.applyTransform(a,!0),r.measuredBox):px(y,n,r.layoutBox);const w=!FW(i);let T=!1;if(!e.resumeFrom){const A=e.getClosestProjectingParent();if(A&&!A.resumeFrom){const{snapshot:k,layout:F}=A;if(k&&F){const D=Fo();mx(D,r.layoutBox,k.layoutBox);const O=Fo();mx(O,n,F.layoutBox),BW(D,O)||(T=!0),A.options.layoutRoot&&(e.relativeTarget=O,e.relativeTargetOrigin=D,e.relativeParent=A)}}}e.notifyListeners("didUpdate",{layout:n,snapshot:r,delta:y,layoutDelta:i,hasLayoutChanged:w,hasRelativeTargetChanged:T})}else if(e.isLead()){const{onExitComplete:n}=e.options;n&&n()}e.options.transition=void 0}function Ole(e){ax&&ry.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function Lle(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function Rle(e){e.clearSnapshot()}function s4(e){e.clearMeasurements()}function jle(e){e.isLayoutDirty=!1}function Dle(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function o4(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function Nle(e){e.resolveTargetDelta()}function zle(e){e.calcProjection()}function Fle(e){e.resetSkewAndRotation()}function Ble(e){e.removeLeadSnapshot()}function a4(e,t,r){e.translate=_o(t.translate,0,r),e.scale=_o(t.scale,1,r),e.origin=t.origin,e.originPoint=t.originPoint}function l4(e,t,r,n){e.min=_o(t.min,r.min,n),e.max=_o(t.max,r.max,n)}function $le(e,t,r,n){l4(e.x,t.x,r.x,n),l4(e.y,t.y,r.y,n)}function Vle(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const Ule={duration:.45,ease:[.4,0,.1,1]},c4=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),u4=c4("applewebkit/")&&!c4("chrome/")?Math.round:au;function d4(e){e.min=u4(e.min),e.max=u4(e.max)}function qle(e){d4(e.x),d4(e.y)}function UW(e,t,r){return e==="position"||e==="preserve-aspect"&&!Wae(r4(t),r4(r),.2)}function Gle(e){var t;return e!==e.root&&((t=e.scroll)===null||t===void 0?void 0:t.wasRoot)}const Hle=VW({attachResizeListener:(e,t)=>Rx(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),AC={current:void 0},qW=VW({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!AC.current){const e=new Hle({});e.mount(window),e.setOptions({layoutScroll:!0}),AC.current=e}return AC.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),Wle={pan:{Feature:cle},drag:{Feature:lle,ProjectionNode:qW,MeasureLayout:DW}};function h4(e,t,r){const{props:n}=e;e.animationState&&n.whileHover&&e.animationState.setActive("whileHover",r==="Start");const a="onHover"+r,u=n[a];u&&Ks.postRender(()=>u(t,Rb(t)))}class Zle extends Km{mount(){const{current:t}=this.node;t&&(this.unmount=Wse(t,r=>(h4(this.node,r,"Start"),n=>h4(this.node,n,"End"))))}unmount(){}}class Xle extends Km{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Lb(Rx(this.node.current,"focus",()=>this.onFocus()),Rx(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function f4(e,t,r){const{props:n}=e;e.animationState&&n.whileTap&&e.animationState.setActive("whileTap",r==="Start");const a="onTap"+(r==="End"?"":r),u=n[a];u&&Ks.postRender(()=>u(t,Rb(t)))}class Kle extends Km{mount(){const{current:t}=this.node;t&&(this.unmount=Yse(t,r=>(f4(this.node,r,"Start"),(n,{success:a})=>f4(this.node,n,a?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const pO=new WeakMap,PC=new WeakMap,Yle=e=>{const t=pO.get(e.target);t&&t(e)},Jle=e=>{e.forEach(Yle)};function Qle({root:e,...t}){const r=e||document;PC.has(r)||PC.set(r,{});const n=PC.get(r),a=JSON.stringify(t);return n[a]||(n[a]=new IntersectionObserver(Jle,{root:e,...t})),n[a]}function ece(e,t,r){const n=Qle(t);return pO.set(e,r),n.observe(e),()=>{pO.delete(e),n.unobserve(e)}}const tce={some:0,all:1};class rce extends Km{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:r,margin:n,amount:a="some",once:u}=t,f={root:r?r.current:void 0,rootMargin:n,threshold:typeof a=="number"?a:tce[a]},i=y=>{const{isIntersecting:w}=y;if(this.isInView===w||(this.isInView=w,u&&!w&&this.hasEnteredView))return;w&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",w);const{onViewportEnter:T,onViewportLeave:A}=this.node.getProps(),k=w?T:A;k&&k(y)};return ece(this.node.current,f,i)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:r}=this.node;["amount","margin","root"].some(nce(t,r))&&this.startObserver()}unmount(){}}function nce({viewport:e={}},{viewport:t={}}={}){return r=>e[r]!==t[r]}const ice={inView:{Feature:rce},tap:{Feature:Kle},focus:{Feature:Xle},hover:{Feature:Zle}},sce={layout:{ProjectionNode:qW,MeasureLayout:DW}},mO={current:null},GW={current:!1};function oce(){if(GW.current=!0,!!RR)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>mO.current=e.matches;e.addListener(t),t()}else mO.current=!1}const ace=[...gW,ml,Um],lce=e=>ace.find(mW(e)),p4=new WeakMap;function cce(e,t,r){for(const n in t){const a=t[n],u=r[n];if(_l(a))e.addValue(n,a);else if(_l(u))e.addValue(n,Ox(a,{owner:e}));else if(u!==a)if(e.hasValue(n)){const f=e.getValue(n);f.liveStyle===!0?f.jump(a):f.hasAnimated||f.set(a)}else{const f=e.getStaticValue(n);e.addValue(n,Ox(f!==void 0?f:a,{owner:e}))}}for(const n in r)t[n]===void 0&&e.removeValue(n);return t}const m4=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class uce{scrapeMotionValuesFromProps(t,r,n){return{}}constructor({parent:t,props:r,presenceContext:n,reducedMotionConfig:a,blockInitialAnimation:u,visualState:f},i={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=aj,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const F=of.now();this.renderScheduledAt<F&&(this.renderScheduledAt=F,Ks.render(this.render,!1,!0))};const{latestValues:y,renderState:w,onUpdate:T}=f;this.onUpdate=T,this.latestValues=y,this.baseTarget={...y},this.initialValues=r.initial?{...y}:{},this.renderState=w,this.parent=t,this.props=r,this.presenceContext=n,this.depth=t?t.depth+1:0,this.reducedMotionConfig=a,this.options=i,this.blockInitialAnimation=!!u,this.isControllingVariants=NE(r),this.isVariantNode=EH(r),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:A,...k}=this.scrapeMotionValuesFromProps(r,{},this);for(const F in k){const D=k[F];y[F]!==void 0&&_l(D)&&D.set(y[F],!1)}}mount(t){this.current=t,p4.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((r,n)=>this.bindToMotionValue(n,r)),GW.current||oce(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:mO.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){p4.delete(this.current),this.projection&&this.projection.unmount(),Vm(this.notifyUpdate),Vm(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const r=this.features[t];r&&(r.unmount(),r.isMounted=!1)}this.current=null}bindToMotionValue(t,r){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const n=Iy.has(t),a=r.on("change",i=>{this.latestValues[t]=i,this.props.onUpdate&&Ks.preRender(this.notifyUpdate),n&&this.projection&&(this.projection.isTransformDirty=!0)}),u=r.on("renderRequest",this.scheduleRender);let f;window.MotionCheckAppearSync&&(f=window.MotionCheckAppearSync(this,t,r)),this.valueSubscriptions.set(t,()=>{a(),u(),f&&f(),r.owner&&r.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in Zv){const r=Zv[t];if(!r)continue;const{isEnabled:n,Feature:a}=r;if(!this.features[t]&&a&&n(this.props)&&(this.features[t]=new a(this)),this.features[t]){const u=this.features[t];u.isMounted?u.update():(u.mount(),u.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Fo()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,r){this.latestValues[t]=r}update(t,r){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=r;for(let n=0;n<m4.length;n++){const a=m4[n];this.propEventSubscriptions[a]&&(this.propEventSubscriptions[a](),delete this.propEventSubscriptions[a]);const u="on"+a,f=t[u];f&&(this.propEventSubscriptions[a]=this.on(a,f))}this.prevMotionValues=cce(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const r=this.getClosestVariantNode();if(r)return r.variantChildren&&r.variantChildren.add(t),()=>r.variantChildren.delete(t)}addValue(t,r){const n=this.values.get(t);r!==n&&(n&&this.removeValue(t),this.bindToMotionValue(t,r),this.values.set(t,r),this.latestValues[t]=r.get())}removeValue(t){this.values.delete(t);const r=this.valueSubscriptions.get(t);r&&(r(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,r){if(this.props.values&&this.props.values[t])return this.props.values[t];let n=this.values.get(t);return n===void 0&&r!==void 0&&(n=Ox(r===null?void 0:r,{owner:this}),this.addValue(t,n)),n}readValue(t,r){var n;let a=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(n=this.getBaseTargetFromProps(this.props,t))!==null&&n!==void 0?n:this.readValueFromInstance(this.current,t,this.options);return a!=null&&(typeof a=="string"&&(fW(a)||iW(a))?a=parseFloat(a):!lce(a)&&Um.test(r)&&(a=uW(t,r)),this.setBaseTarget(t,_l(a)?a.get():a)),_l(a)?a.get():a}setBaseTarget(t,r){this.baseTarget[t]=r}getBaseTarget(t){var r;const{initial:n}=this.props;let a;if(typeof n=="string"||typeof n=="object"){const f=$R(this.props,n,(r=this.presenceContext)===null||r===void 0?void 0:r.custom);f&&(a=f[t])}if(n&&a!==void 0)return a;const u=this.getBaseTargetFromProps(this.props,t);return u!==void 0&&!_l(u)?u:this.initialValues[t]!==void 0&&a===void 0?void 0:this.baseTarget[t]}on(t,r){return this.events[t]||(this.events[t]=new tj),this.events[t].add(r)}notify(t,...r){this.events[t]&&this.events[t].notify(...r)}}class HW extends uce{constructor(){super(...arguments),this.KeyframeResolver=yW}sortInstanceNodePosition(t,r){return t.compareDocumentPosition(r)&2?1:-1}getBaseTargetFromProps(t,r){return t.style?t.style[r]:void 0}removeValueFromRenderState(t,{vars:r,style:n}){delete r[t],delete n[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;_l(t)&&(this.childSubscription=t.on("change",r=>{this.current&&(this.current.textContent=`${r}`)}))}}function dce(e){return window.getComputedStyle(e)}class hce extends HW{constructor(){super(...arguments),this.type="html",this.renderInstance=LH}readValueFromInstance(t,r){if(Iy.has(r)){const n=oj(r);return n&&n.default||0}else{const n=dce(t),a=(IH(r)?n.getPropertyValue(r):n[r])||0;return typeof a=="string"?a.trim():a}}measureInstanceViewportBox(t,{transformPagePoint:r}){return RW(t,r)}build(t,r,n){qR(t,r,n.transformTemplate)}scrapeMotionValuesFromProps(t,r,n){return ZR(t,r,n)}}class fce extends HW{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Fo}getBaseTargetFromProps(t,r){return t[r]}readValueFromInstance(t,r){if(Iy.has(r)){const n=oj(r);return n&&n.default||0}return r=RH.has(r)?r:zR(r),t.getAttribute(r)}scrapeMotionValuesFromProps(t,r,n){return NH(t,r,n)}build(t,r,n){GR(t,r,this.isSVGTag,n.transformTemplate)}renderInstance(t,r,n,a){jH(t,r,n,a)}mount(t){this.isSVGTag=WR(t.tagName),super.mount(t)}}const pce=(e,t)=>BR(e)?new fce(t):new hce(t,{allowProjection:e!==j.Fragment}),mce=Bse({...zae,...ice,...Wle,...sce},pce),va=tse(mce);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gce=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),yce=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,r,n)=>n?n.toUpperCase():r.toLowerCase()),g4=e=>{const t=yce(e);return t.charAt(0).toUpperCase()+t.slice(1)},WW=(...e)=>e.filter((t,r,n)=>!!t&&t.trim()!==""&&n.indexOf(t)===r).join(" ").trim(),vce=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var _ce={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xce=j.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:a="",children:u,iconNode:f,...i},y)=>j.createElement("svg",{ref:y,..._ce,width:t,height:t,stroke:e,strokeWidth:n?Number(r)*24/Number(t):r,className:WW("lucide",a),...!u&&!vce(i)&&{"aria-hidden":"true"},...i},[...f.map(([w,T])=>j.createElement(w,T)),...Array.isArray(u)?u:[u]]));/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const an=(e,t)=>{const r=j.forwardRef(({className:n,...a},u)=>j.createElement(xce,{ref:u,iconNode:t,className:WW(`lucide-${gce(g4(e))}`,`lucide-${e}`,n),...a}));return r.displayName=g4(e),r};/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bce=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],BE=an("arrow-left",bce);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wce=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],MC=an("bell",wce);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sce=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],Ece=an("bot",Sce);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tce=[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]],gO=an("brain",Tce);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cce=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Ace=an("calendar",Cce);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pce=[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],ZW=an("camera",Pce);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mce=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],y4=an("check-check",Mce);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ice=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],yO=an("check",Ice);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kce=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Oce=an("chevron-down",kce);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lce=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Rce=an("chevron-left",Lce);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jce=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Dce=an("chevron-right",jce);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nce=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],gx=an("circle-alert",Nce);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zce=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],oy=an("circle-check-big",zce);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fce=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],XW=an("clock",Fce);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bce=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],$ce=an("cloud",Bce);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vce=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Uce=an("copy",Vce);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qce=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]],Gce=an("crosshair",qce);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hce=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],v4=an("crown",Hce);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wce=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],Zce=an("dollar-sign",Wce);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xce=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],Kce=an("ellipsis-vertical",Xce);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yce=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],vO=an("external-link",Yce);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jce=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],jx=an("eye",Jce);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qce=[["path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z",key:"1jg4f8"}]],eue=an("facebook",Qce);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tue=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]],rue=an("file-spreadsheet",tue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nue=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],aS=an("file-text",nue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iue=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],sue=an("file",iue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oue=[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]],_4=an("flag",oue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aue=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],lS=an("globe",aue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lue=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],cue=an("hash",lue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uue=[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]],cS=an("heart",uue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const due=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]],hue=an("house",due);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fue=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Fv=an("image",fue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pue=[["path",{d:"M18 22H4a2 2 0 0 1-2-2V6",key:"pblm9e"}],["path",{d:"m22 13-1.296-1.296a2.41 2.41 0 0 0-3.408 0L11 18",key:"nf6bnh"}],["circle",{cx:"12",cy:"8",r:"2",key:"1822b1"}],["rect",{width:"16",height:"16",x:"6",y:"2",rx:"2",key:"12espp"}]],mue=an("images",pue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gue=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],yue=an("info",gue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vue=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],_ue=an("link",vue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xue=[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]],x4=an("list",xue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bue=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],wue=an("loader-circle",bue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sue=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],$E=an("mail",Sue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eue=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],ou=an("map-pin",Eue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tue=[["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 18h16",key:"19g7jn"}],["path",{d:"M4 6h16",key:"1o0s65"}]],Cue=an("menu",Tue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aue=[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]],xy=an("message-circle",Aue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pue=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]],KW=an("message-square",Pue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mue=[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],b4=an("mic-off",Mue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Iue=[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],Rm=an("mic",Iue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kue=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],_O=an("navigation",kue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oue=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],w4=an("package",Oue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lue=[["path",{d:"M13.234 20.252 21 12.3",key:"1cbrk9"}],["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486",key:"1pkts6"}]],YW=an("paperclip",Lue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rue=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],JW=an("pen",Rue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jue=[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]],jb=an("phone",jue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Due=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],QW=an("play",Due);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nue=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],S4=an("plus",Nue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zue=[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Fue=an("power-off",zue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bue=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],$ue=an("power",Bue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vue=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Uue=an("save",Vue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const que=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Gue=an("search",que);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hue=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Wue=an("send",Hue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zue=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],Kv=an("share-2",Zue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xue=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"3",x2:"21",y1:"9",y2:"9",key:"1vqk6q"}],["line",{x1:"3",x2:"21",y1:"15",y2:"15",key:"o2sbyz"}],["line",{x1:"9",x2:"9",y1:"9",y2:"21",key:"1ib60c"}],["line",{x1:"15",x2:"15",y1:"9",y2:"21",key:"1n26ft"}]],E4=an("sheet",Xue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kue=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],eZ=an("smile",Kue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yue=[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]],Jue=an("sparkles",Yue);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Que=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],uS=an("star",Que);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ede=[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]],tZ=an("thumbs-up",ede);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tde=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],rZ=an("trash-2",tde);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rde=[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]],nde=an("trending-up",rde);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ide=[["path",{d:"M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z",key:"pff0z6"}]],sde=an("twitter",ide);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ode=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],ade=an("upload",ode);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lde=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],cde=an("user",lde);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ude=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],xO=an("users",ude);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dde=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],qm=an("video",dde);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hde=[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],T4=an("video-off",hde);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fde=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],pde=an("wifi-off",fde);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mde=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],gde=an("wifi",mde);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yde=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Os=an("x",yde);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vde=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],C4=an("zap",vde),_de=({confidence:e=0,tokensUsed:t=0,tokensFactured:r=0,isProcessing:n=!1,inputLength:a=0,miniMode:u=!1,tokensCostXaf:f})=>{const{user:i}=Rs(),[y,w]=j.useState(0),[T,A]=j.useState(0),[k,F]=j.useState("simple"),[D,O]=j.useState(!1);j.useEffect(()=>{const Z=setTimeout(()=>{w(e)},100);return()=>clearTimeout(Z)},[e]),j.useEffect(()=>{const Z=setTimeout(()=>{A(t)},200);return()=>clearTimeout(Z)},[t]),j.useEffect(()=>{a<50?F("simple"):a<200?F("modérée"):F("complexe")},[a]);const N=()=>{switch(k){case"simple":return"text-green-500";case"modérée":return"text-yellow-500";case"complexe":return"text-red-500";default:return"text-gray-500"}},V=()=>y>=80?"from-green-400 to-green-600":y>=50?"from-yellow-400 to-yellow-600":"from-red-400 to-red-600";let H="";return typeof f=="number"?H=f:f===0?H=0:H="",u?b.jsx(va.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"inline-block",children:b.jsxs("div",{className:"bg-white/95 dark:bg-gray-800/95 backdrop-blur-sm rounded-lg shadow-md border border-gray-200/50 dark:border-gray-700/50 p-1 min-w-[220px] max-w-[320px] h-[38px] flex items-center",children:[b.jsxs(va.div,{className:"p-2 cursor-pointer",onClick:()=>O(!D),whileHover:{scale:1.02},whileTap:{scale:.98},children:[b.jsxs("div",{className:"flex items-center gap-2 text-xs whitespace-nowrap overflow-hidden text-ellipsis w-full",style:{minWidth:0},children:[b.jsxs("div",{className:"relative flex-shrink-0",children:[b.jsx(gO,{className:"w-4 h-4 text-primary"}),n&&b.jsx(va.div,{className:"absolute -top-1 -right-1 w-2 h-2 bg-green-500 rounded-full",animate:{scale:[1,1.5,1]},transition:{repeat:1/0,duration:1}})]}),b.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[b.jsx("span",{className:"text-gray-500",children:"Confiance:"}),b.jsxs("span",{className:"font-medium",children:[y,"%"]})]}),b.jsx("div",{className:"text-gray-400 flex-shrink-0",children:"•"}),b.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[b.jsx("span",{className:"text-gray-500",children:"Tokens:"}),b.jsx("span",{className:"font-medium",children:t}),r>0&&r<t&&b.jsxs("span",{className:"text-green-600 text-[10px]",children:["(-",t-r,")"]}),b.jsx(C4,{className:"w-3 h-3 text-yellow-500"})]}),b.jsx("div",{className:"text-gray-400 flex-shrink-0",children:"•"}),b.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0 max-w-[110px] overflow-hidden text-ellipsis whitespace-nowrap",children:[b.jsx("span",{className:"text-gray-500",children:"Coût:"}),b.jsx("span",{className:"font-medium",children:H!==""?b.jsxs(b.Fragment,{children:[H," ",b.jsx("span",{className:"text-red-600",children:"XAF"})]}):b.jsx("span",{className:"text-gray-400",children:"—"})})]})]}),b.jsx(va.div,{animate:{rotate:D?180:0},transition:{duration:.2},children:b.jsx(Oce,{className:"w-3 h-3 text-gray-400"})})]}),b.jsx(Wie,{children:D&&b.jsx(va.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:b.jsxs("div",{className:"px-2 pb-2 pt-0 space-y-1.5 border-t border-gray-200 dark:border-gray-700",children:[b.jsxs("div",{className:"mt-1.5",children:[b.jsx("div",{className:"text-xs text-gray-500 mb-0.5",children:"Confiance"}),b.jsx("div",{className:"relative h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:b.jsx(va.div,{className:`absolute inset-y-0 left-0 bg-gradient-to-r ${V()}`,initial:{width:0},animate:{width:`${y}%`},transition:{duration:.5,ease:"easeOut"}})})]}),b.jsxs("div",{className:"flex justify-between items-center",children:[b.jsx("span",{className:"text-xs text-gray-500",children:"Complexité:"}),b.jsx("span",{className:`text-xs font-medium ${N()}`,children:k})]}),(i==null?void 0:i.credits)!==void 0&&b.jsxs("div",{className:"flex justify-between items-center",children:[b.jsx("span",{className:"text-xs text-gray-500",children:"Solde:"}),b.jsx("span",{className:"text-xs font-medium text-primary",children:i.credits.toLocaleString()})]})]})})})]})}):b.jsxs(va.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6",children:[b.jsxs("div",{className:"flex items-center justify-between mb-4",children:[b.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[b.jsx(gO,{className:"w-5 h-5 text-primary"}),"Statistiques IA"]}),n&&b.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-500",children:[b.jsx(Ece,{className:"w-4 h-4 animate-pulse"}),b.jsx("span",{children:"Traitement en cours..."})]})]}),b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[b.jsxs("div",{className:"space-y-2",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Niveau de confiance"}),b.jsxs("span",{className:"text-sm font-semibold",children:[y,"%"]})]}),b.jsx("div",{className:"relative h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:b.jsx(va.div,{className:`absolute inset-y-0 left-0 bg-gradient-to-r ${V()}`,initial:{width:0},animate:{width:`${y}%`},transition:{duration:.5,ease:"easeOut"}})})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400 flex items-center gap-1",children:[b.jsx(C4,{className:"w-4 h-4"}),"Tokens utilisés"]}),b.jsx("span",{className:"text-sm font-semibold",children:T})]}),b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx(Jue,{className:"w-4 h-4 text-yellow-500"}),b.jsx("span",{className:"text-xs text-gray-500",children:(i==null?void 0:i.credits)!==void 0?`Solde: ${i.credits.toLocaleString()}`:"Chargement..."})]})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400 flex items-center gap-1",children:[b.jsx(nde,{className:"w-4 h-4"}),"Complexité"]}),b.jsx("span",{className:`text-sm font-semibold ${N()}`,children:k})]}),b.jsxs("div",{className:"text-xs text-gray-500",children:["Basé sur ",a," caractères"]})]})]}),b.jsx(va.div,{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:b.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[b.jsx("span",{children:"Performance optimale"}),b.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(Z=>b.jsx(va.div,{className:`w-2 h-2 rounded-full ${Z<=Math.ceil(y/20)?"bg-green-500":"bg-gray-300 dark:bg-gray-600"}`,initial:{scale:0},animate:{scale:1},transition:{delay:Z*.1}},Z))})]})})]})},VE=jt.createContext({confidence:0,tokensUsed:0,tokensFactured:0,isProcessing:!1,inputLength:0,tokensCostXaf:void 0,setStats:e=>{}}),xde=({children:e})=>{const[t,r]=j.useState({confidence:0,tokensUsed:0,tokensFactured:0,isProcessing:!1,inputLength:0,tokensCostXaf:void 0}),n=a=>{console.log("[GlobalIAStats] Mise à jour des statistiques:",a),console.log("[GlobalIAStats] Anciennes valeurs:",t),console.log("[GlobalIAStats] Changements détectés:",{confidence:t.confidence!==a.confidence?`${t.confidence} → ${a.confidence}`:"inchangé",tokensUsed:t.tokensUsed!==a.tokensUsed?`${t.tokensUsed} → ${a.tokensUsed}`:"inchangé",tokensCostXaf:t.tokensCostXaf!==a.tokensCostXaf?`${t.tokensCostXaf} → ${a.tokensCostXaf}`:"inchangé"}),r(a)};return b.jsx(VE.Provider,{value:{...t,setStats:n},children:e})},nZ=()=>{const{confidence:e,tokensUsed:t,tokensFactured:r,isProcessing:n,inputLength:a,tokensCostXaf:u}=jt.useContext(VE);return jt.useEffect(()=>{console.log("[GlobalIAStatsPanel] Valeurs reçues:",{confidence:e,tokensUsed:t,tokensFactured:r,isProcessing:n,inputLength:a,tokensCostXaf:u})},[e,t,r,n,a,u]),b.jsx("div",{className:"fixed top-24 left-4 z-40",children:b.jsx(_de,{confidence:e,tokensUsed:t,tokensFactured:r,isProcessing:n,inputLength:a,tokensCostXaf:u,miniMode:!0})})},iZ=j.createContext(null),bde=({children:e})=>{const[t,r]=j.useState(null),n=j.useCallback(a=>{r(a),setTimeout(()=>r(null),4e3)},[]);return b.jsxs(iZ.Provider,{value:{toast:n},children:[e,t&&b.jsxs("div",{className:"fixed bottom-4 right-4 p-4 bg-white border rounded-lg shadow-lg z-50",children:[b.jsx("div",{className:"font-semibold",children:t.title}),t.description&&b.jsx("div",{className:"text-sm text-muted-foreground",children:t.description})]})]})};let wde={data:""},Sde=e=>typeof window=="object"?((e?e.querySelector("#_goober"):window._goober)||Object.assign((e||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:e||wde,Ede=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,Tde=/\/\*[^]*?\*\/|  +/g,A4=/\n+/g,Om=(e,t)=>{let r="",n="",a="";for(let u in e){let f=e[u];u[0]=="@"?u[1]=="i"?r=u+" "+f+";":n+=u[1]=="f"?Om(f,u):u+"{"+Om(f,u[1]=="k"?"":t)+"}":typeof f=="object"?n+=Om(f,t?t.replace(/([^,])+/g,i=>u.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,y=>/&/.test(y)?y.replace(/&/g,i):i?i+" "+y:y)):u):f!=null&&(u=/^--/.test(u)?u:u.replace(/[A-Z]/g,"-$&").toLowerCase(),a+=Om.p?Om.p(u,f):u+":"+f+";")}return r+(t&&a?t+"{"+a+"}":a)+n},sp={},sZ=e=>{if(typeof e=="object"){let t="";for(let r in e)t+=r+sZ(e[r]);return t}return e},Cde=(e,t,r,n,a)=>{let u=sZ(e),f=sp[u]||(sp[u]=(y=>{let w=0,T=11;for(;w<y.length;)T=101*T+y.charCodeAt(w++)>>>0;return"go"+T})(u));if(!sp[f]){let y=u!==e?e:(w=>{let T,A,k=[{}];for(;T=Ede.exec(w.replace(Tde,""));)T[4]?k.shift():T[3]?(A=T[3].replace(A4," ").trim(),k.unshift(k[0][A]=k[0][A]||{})):k[0][T[1]]=T[2].replace(A4," ").trim();return k[0]})(e);sp[f]=Om(a?{["@keyframes "+f]:y}:y,r?"":"."+f)}let i=r&&sp.g?sp.g:null;return r&&(sp.g=sp[f]),((y,w,T,A)=>{A?w.data=w.data.replace(A,y):w.data.indexOf(y)===-1&&(w.data=T?y+w.data:w.data+y)})(sp[f],t,n,i),f},Ade=(e,t,r)=>e.reduce((n,a,u)=>{let f=t[u];if(f&&f.call){let i=f(r),y=i&&i.props&&i.props.className||/^go/.test(i)&&i;f=y?"."+y:i&&typeof i=="object"?i.props?"":Om(i,""):i===!1?"":i}return n+a+(f??"")},"");function UE(e){let t=this||{},r=e.call?e(t.p):e;return Cde(r.unshift?r.raw?Ade(r,[].slice.call(arguments,1),t.p):r.reduce((n,a)=>Object.assign(n,a&&a.call?a(t.p):a),{}):r,Sde(t.target),t.g,t.o,t.k)}let oZ,bO,wO;UE.bind({g:1});let _p=UE.bind({k:1});function Pde(e,t,r,n){Om.p=t,oZ=e,bO=r,wO=n}function Ym(e,t){let r=this||{};return function(){let n=arguments;function a(u,f){let i=Object.assign({},u),y=i.className||a.className;r.p=Object.assign({theme:bO&&bO()},i),r.o=/ *go\d+/.test(y),i.className=UE.apply(r,n)+(y?" "+y:"");let w=e;return e[0]&&(w=i.as||e,delete i.as),wO&&w[0]&&wO(i),oZ(w,i)}return a}}var Mde=e=>typeof e=="function",dS=(e,t)=>Mde(e)?e(t):e,Ide=(()=>{let e=0;return()=>(++e).toString()})(),aZ=(()=>{let e;return()=>{if(e===void 0&&typeof window<"u"){let t=matchMedia("(prefers-reduced-motion: reduce)");e=!t||t.matches}return e}})(),kde=20,lZ=(e,t)=>{switch(t.type){case 0:return{...e,toasts:[t.toast,...e.toasts].slice(0,kde)};case 1:return{...e,toasts:e.toasts.map(u=>u.id===t.toast.id?{...u,...t.toast}:u)};case 2:let{toast:r}=t;return lZ(e,{type:e.toasts.find(u=>u.id===r.id)?1:0,toast:r});case 3:let{toastId:n}=t;return{...e,toasts:e.toasts.map(u=>u.id===n||n===void 0?{...u,dismissed:!0,visible:!1}:u)};case 4:return t.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(u=>u.id!==t.toastId)};case 5:return{...e,pausedAt:t.time};case 6:let a=t.time-(e.pausedAt||0);return{...e,pausedAt:void 0,toasts:e.toasts.map(u=>({...u,pauseDuration:u.pauseDuration+a}))}}},Uw=[],ay={toasts:[],pausedAt:void 0},ky=e=>{ay=lZ(ay,e),Uw.forEach(t=>{t(ay)})},Ode={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},Lde=(e={})=>{let[t,r]=j.useState(ay),n=j.useRef(ay);j.useEffect(()=>(n.current!==ay&&r(ay),Uw.push(r),()=>{let u=Uw.indexOf(r);u>-1&&Uw.splice(u,1)}),[]);let a=t.toasts.map(u=>{var f,i,y;return{...e,...e[u.type],...u,removeDelay:u.removeDelay||((f=e[u.type])==null?void 0:f.removeDelay)||(e==null?void 0:e.removeDelay),duration:u.duration||((i=e[u.type])==null?void 0:i.duration)||(e==null?void 0:e.duration)||Ode[u.type],style:{...e.style,...(y=e[u.type])==null?void 0:y.style,...u.style}}});return{...t,toasts:a}},Rde=(e,t="blank",r)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:t,ariaProps:{role:"status","aria-live":"polite"},message:e,pauseDuration:0,...r,id:(r==null?void 0:r.id)||Ide()}),Db=e=>(t,r)=>{let n=Rde(t,e,r);return ky({type:2,toast:n}),n.id},Yn=(e,t)=>Db("blank")(e,t);Yn.error=Db("error");Yn.success=Db("success");Yn.loading=Db("loading");Yn.custom=Db("custom");Yn.dismiss=e=>{ky({type:3,toastId:e})};Yn.remove=e=>ky({type:4,toastId:e});Yn.promise=(e,t,r)=>{let n=Yn.loading(t.loading,{...r,...r==null?void 0:r.loading});return typeof e=="function"&&(e=e()),e.then(a=>{let u=t.success?dS(t.success,a):void 0;return u?Yn.success(u,{id:n,...r,...r==null?void 0:r.success}):Yn.dismiss(n),a}).catch(a=>{let u=t.error?dS(t.error,a):void 0;u?Yn.error(u,{id:n,...r,...r==null?void 0:r.error}):Yn.dismiss(n)}),e};var jde=(e,t)=>{ky({type:1,toast:{id:e,height:t}})},Dde=()=>{ky({type:5,time:Date.now()})},yx=new Map,Nde=1e3,zde=(e,t=Nde)=>{if(yx.has(e))return;let r=setTimeout(()=>{yx.delete(e),ky({type:4,toastId:e})},t);yx.set(e,r)},Fde=e=>{let{toasts:t,pausedAt:r}=Lde(e);j.useEffect(()=>{if(r)return;let u=Date.now(),f=t.map(i=>{if(i.duration===1/0)return;let y=(i.duration||0)+i.pauseDuration-(u-i.createdAt);if(y<0){i.visible&&Yn.dismiss(i.id);return}return setTimeout(()=>Yn.dismiss(i.id),y)});return()=>{f.forEach(i=>i&&clearTimeout(i))}},[t,r]);let n=j.useCallback(()=>{r&&ky({type:6,time:Date.now()})},[r]),a=j.useCallback((u,f)=>{let{reverseOrder:i=!1,gutter:y=8,defaultPosition:w}=f||{},T=t.filter(F=>(F.position||w)===(u.position||w)&&F.height),A=T.findIndex(F=>F.id===u.id),k=T.filter((F,D)=>D<A&&F.visible).length;return T.filter(F=>F.visible).slice(...i?[k+1]:[0,k]).reduce((F,D)=>F+(D.height||0)+y,0)},[t]);return j.useEffect(()=>{t.forEach(u=>{if(u.dismissed)zde(u.id,u.removeDelay);else{let f=yx.get(u.id);f&&(clearTimeout(f),yx.delete(u.id))}})},[t]),{toasts:t,handlers:{updateHeight:jde,startPause:Dde,endPause:n,calculateOffset:a}}},Bde=_p`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,$de=_p`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Vde=_p`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,Ude=Ym("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${e=>e.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Bde} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${$de} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${e=>e.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${Vde} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,qde=_p`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,Gde=Ym("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${e=>e.secondary||"#e0e0e0"};
  border-right-color: ${e=>e.primary||"#616161"};
  animation: ${qde} 1s linear infinite;
`,Hde=_p`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,Wde=_p`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,Zde=Ym("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${e=>e.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Hde} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${Wde} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${e=>e.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,Xde=Ym("div")`
  position: absolute;
`,Kde=Ym("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,Yde=_p`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Jde=Ym("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${Yde} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,Qde=({toast:e})=>{let{icon:t,type:r,iconTheme:n}=e;return t!==void 0?typeof t=="string"?j.createElement(Jde,null,t):t:r==="blank"?null:j.createElement(Kde,null,j.createElement(Gde,{...n}),r!=="loading"&&j.createElement(Xde,null,r==="error"?j.createElement(Ude,{...n}):j.createElement(Zde,{...n})))},ehe=e=>`
0% {transform: translate3d(0,${e*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,the=e=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${e*-150}%,-1px) scale(.6); opacity:0;}
`,rhe="0%{opacity:0;} 100%{opacity:1;}",nhe="0%{opacity:1;} 100%{opacity:0;}",ihe=Ym("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,she=Ym("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,ohe=(e,t)=>{let r=e.includes("top")?1:-1,[n,a]=aZ()?[rhe,nhe]:[ehe(r),the(r)];return{animation:t?`${_p(n)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${_p(a)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},ahe=j.memo(({toast:e,position:t,style:r,children:n})=>{let a=e.height?ohe(e.position||t||"top-center",e.visible):{opacity:0},u=j.createElement(Qde,{toast:e}),f=j.createElement(she,{...e.ariaProps},dS(e.message,e));return j.createElement(ihe,{className:e.className,style:{...a,...r,...e.style}},typeof n=="function"?n({icon:u,message:f}):j.createElement(j.Fragment,null,u,f))});Pde(j.createElement);var lhe=({id:e,className:t,style:r,onHeightUpdate:n,children:a})=>{let u=j.useCallback(f=>{if(f){let i=()=>{let y=f.getBoundingClientRect().height;n(e,y)};i(),new MutationObserver(i).observe(f,{subtree:!0,childList:!0,characterData:!0})}},[e,n]);return j.createElement("div",{ref:u,className:t,style:r},a)},che=(e,t)=>{let r=e.includes("top"),n=r?{top:0}:{bottom:0},a=e.includes("center")?{justifyContent:"center"}:e.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:aZ()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${t*(r?1:-1)}px)`,...n,...a}},uhe=UE`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,iw=16,dhe=({reverseOrder:e,position:t="top-center",toastOptions:r,gutter:n,children:a,containerStyle:u,containerClassName:f})=>{let{toasts:i,handlers:y}=Fde(r);return j.createElement("div",{id:"_rht_toaster",style:{position:"fixed",zIndex:9999,top:iw,left:iw,right:iw,bottom:iw,pointerEvents:"none",...u},className:f,onMouseEnter:y.startPause,onMouseLeave:y.endPause},i.map(w=>{let T=w.position||t,A=y.calculateOffset(w,{reverseOrder:e,gutter:n,defaultPosition:t}),k=che(T,A);return j.createElement(lhe,{id:w.id,key:w.id,onHeightUpdate:y.updateHeight,className:w.visible?uhe:"",style:k},w.type==="custom"?dS(w.message,w):a?a(w):j.createElement(ahe,{toast:w,position:T}))}))},Tm=Yn;class hhe{constructor(){dv(this,"isTracking",!1);dv(this,"trackingInterval",null);dv(this,"lastUpdateTime",0);dv(this,"UPDATE_INTERVAL",5*60*1e3);dv(this,"MIN_ACCURACY",100)}startTracking(){this.isTracking||(this.isTracking=!0,console.log("🚀 Démarrage du suivi GPS automatique"),this.updateLocation(),this.trackingInterval=setInterval(()=>{this.updateLocation()},this.UPDATE_INTERVAL),"geolocation"in navigator&&navigator.geolocation.watchPosition(t=>{Date.now()-this.lastUpdateTime>this.UPDATE_INTERVAL&&this.handlePositionUpdate(t)},t=>{console.warn("⚠️ Erreur de suivi GPS:",t.message)},{enableHighAccuracy:!0,timeout:3e4,maximumAge:6e4}))}stopTracking(){this.isTracking&&(this.isTracking=!1,console.log("🛑 Arrêt du suivi GPS automatique"),this.trackingInterval&&(clearInterval(this.trackingInterval),this.trackingInterval=null))}async updateLocation(){if(!navigator.geolocation){console.warn("⚠️ Géolocalisation non supportée");return}try{const t=await this.getCurrentPosition();await this.handlePositionUpdate(t)}catch(t){console.warn("⚠️ Erreur lors de la mise à jour GPS:",t)}}getCurrentPosition(){return new Promise((t,r)=>{const n={enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5};navigator.geolocation.getCurrentPosition(t,a=>{switch(a.code){case a.PERMISSION_DENIED:r(new Error("Permission de géolocalisation refusée"));break;case a.POSITION_UNAVAILABLE:r(new Error("Position non disponible"));break;case a.TIMEOUT:r(new Error("Délai d'attente dépassé"));break;default:r(new Error("Erreur de géolocalisation inconnue"))}},n)})}async handlePositionUpdate(t){const{latitude:r,longitude:n,accuracy:a}=t.coords;if(a&&a>this.MIN_ACCURACY){console.warn(`⚠️ Précision GPS insuffisante: ${a}m`);return}const u={latitude:r,longitude:n,accuracy:a,timestamp:Date.now()};console.log(`📍 Position GPS mise à jour: ${r.toFixed(6)}, ${n.toFixed(6)} (précision: ${a}m)`),await this.sendLocationToBackend(u),this.lastUpdateTime=Date.now()}async sendLocationToBackend(t){try{const r=await fetch("/api/user/me/gps_location",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({latitude:t.latitude,longitude:t.longitude,accuracy:t.accuracy})});r.ok?console.log("✅ Position GPS envoyée au backend"):console.warn("⚠️ Erreur lors de l'envoi de la position GPS:",r.status)}catch(r){console.error("❌ Erreur lors de l'envoi de la position GPS:",r)}}async getCurrentLocation(){if(!navigator.geolocation)return null;try{const t=await this.getCurrentPosition();return{latitude:t.coords.latitude,longitude:t.coords.longitude,accuracy:t.coords.accuracy,timestamp:Date.now()}}catch(t){return console.warn("⚠️ Impossible d'obtenir la position actuelle:",t),null}}isActive(){return this.isTracking}}const vx=new hhe,fhe=()=>{Rs();const[e,t]=j.useState(!1),[r,n]=j.useState(null),[a,u]=j.useState(null),f=j.useRef(null),i=j.useRef(0),y=3,w=j.useCallback(async()=>{try{const D=await vx.getCurrentLocation();if(D){const O={latitude:D.latitude,longitude:D.longitude,accuracy:D.accuracy,timestamp:Date.now()};return n(O),u(null),console.log(`📍 Position GPS mise à jour: ${D.latitude.toFixed(6)}, ${D.longitude.toFixed(6)}`),await T(D.latitude,D.longitude,D.accuracy),O}}catch(D){throw console.error("❌ Erreur lors de la récupération de la position:",D),u("Erreur lors de la récupération de la position GPS"),D}return null},[]),T=j.useCallback(async(D,O,N)=>{try{const V=localStorage.getItem("token");if(!V)throw new Error("Token d'authentification manquant");(await fetch("/api/user/me/gps_location",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${V}`},body:JSON.stringify({latitude:D,longitude:O,accuracy:N||10})})).ok?console.log("✅ Position GPS mise à jour dans le backend"):(console.warn("⚠️ Erreur lors de la mise à jour GPS dans le backend"),u("Erreur lors de la mise à jour GPS dans le backend"))}catch(V){console.error("❌ Erreur réseau lors de la mise à jour GPS:",V),u("Erreur réseau lors de la mise à jour GPS")}},[]),A=j.useCallback(async()=>{if(!e)try{console.log("🚀 Démarrage du tracking GPS automatique..."),vx.startTracking(),t(!0),u(null),i.current=0,await w();const D=async()=>{try{await w(),i.current=0,f.current=setTimeout(D,5*60*1e3)}catch(O){if(i.current++,i.current>=y){u(`Échec GPS après ${y} tentatives: ${O instanceof Error?O.message:"Erreur inconnue"}`),t(!1);return}const N=Math.min(1e3*Math.pow(2,i.current),1e4);console.log(`🔄 Tentative ${i.current}/${y} dans ${N}ms...`),f.current=setTimeout(D,N)}};f.current=setTimeout(D,5*60*1e3)}catch(D){console.error("❌ Erreur lors du démarrage du tracking GPS:",D),u("Erreur lors du démarrage du tracking GPS"),t(!1)}},[e,w]),k=j.useCallback(()=>{vx.stopTracking(),t(!1),f.current&&(clearTimeout(f.current),f.current=null),console.log("🛑 Tracking GPS arrêté")},[]),F=j.useCallback(()=>r?`${r.latitude.toFixed(6)},${r.longitude.toFixed(6)}`:"",[r]);return j.useEffect(()=>()=>{f.current&&clearTimeout(f.current)},[]),{isTracking:e,currentLocation:r,locationString:F(),error:a,startTracking:A,stopTracking:k,getCurrentLocation:w,updateBackendGPS:T}},cZ=j.createContext({user:null,setUser:()=>{},tokensBalance:null,updateTokensBalance:()=>{},refreshTokensBalance:async()=>{}}),phe=()=>j.useContext(cZ);function mhe({children:e}){const[t,r]=j.useState(null),[n,a]=j.useState(null),u=j.useCallback(async()=>{const i=localStorage.getItem("token");if(!i||!t){a(null);return}try{const y=await fetch("/api/users/balance",{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}});if(y.ok){const w=await y.json();console.log(`[UserContext] Solde récupéré pour utilisateur ${t.id}:`,w.tokens_balance),a(w.tokens_balance)}else console.error("[UserContext] Erreur récupération solde:",y.status),a(null)}catch(y){console.error("[UserContext] Erreur réseau récupération solde:",y),a(null)}},[t]),f=j.useCallback(i=>{console.log(`[UserContext] Mise à jour solde local pour utilisateur ${t==null?void 0:t.id}: ${n} → ${i}`),a(i)},[t==null?void 0:t.id,n]);return j.useEffect(()=>{const i=localStorage.getItem("token");if(!i){r(null),a(null);return}try{const y=yH(i);if(y.exp*1e3>Date.now()){const w=String(y.sub);console.log("[UserContext] Utilisateur connecté:",w),r({id:w,email:y.email,role:y.role,exp:y.exp}),y.tokens_balance!==void 0&&a(y.tokens_balance)}else console.log("[UserContext] Token expiré, déconnexion"),localStorage.removeItem("token"),r(null),a(null)}catch(y){console.warn("[UserContext] Erreur de décodage JWT",y),r(null),a(null)}},[]),j.useEffect(()=>{t?(console.log(`[UserContext] Utilisateur changé vers ${t.id}, récupération du solde...`),u()):(console.log("[UserContext] Pas d'utilisateur, réinitialisation du solde"),a(null))},[t]),b.jsx(cZ.Provider,{value:{user:t,setUser:r,tokensBalance:n,updateTokensBalance:f,refreshTokensBalance:u},children:e})}const ghe=({children:e})=>{const{user:t}=phe(),{startTracking:r,stopTracking:n,isTracking:a}=fhe();return j.useEffect(()=>{t&&!a&&(console.log("👤 Utilisateur connecté, démarrage du tracking GPS..."),r())},[t,a,r]),j.useEffect(()=>()=>{a&&n()},[a,n]),b.jsx(b.Fragment,{children:e})};function Ec(...e){return e.filter(Boolean).join(" ")}const P4={default:"bg-primary text-white hover:bg-primary/90",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300",outline:"border border-input text-black hover:bg-gray-100",ghost:"bg-transparent hover:bg-gray-100 dark:hover:bg-gray-800",destructive:"bg-red-600 text-white hover:bg-red-700"},M4={sm:"h-8 px-3 text-sm",default:"h-10 px-4 text-sm",lg:"h-12 px-6 text-base",icon:"h-10 w-10 p-0"},cr=j.forwardRef(({className:e,variant:t="default",size:r="default",loading:n=!1,iconLeft:a,iconRight:u,children:f,...i},y)=>{const w=P4[t]||P4.default,T=M4[r]||M4.default;return b.jsxs("button",{ref:y,className:Ec("inline-flex items-center justify-center rounded-md font-medium shadow transition-colors focus:outline-none focus:ring-2 focus:ring-primary/50 disabled:opacity-50 disabled:pointer-events-none",w,T,e),disabled:n||i.disabled,...i,children:[n&&b.jsxs("svg",{className:"animate-spin mr-2 h-4 w-4 text-white dark:text-black",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[b.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),b.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4l3.5-3.5L12 0v4a8 8 0 00-8 8z"})]}),!n&&a&&b.jsx("span",{className:"mr-2",children:a}),f,!n&&u&&b.jsx("span",{className:"ml-2",children:u})]})});cr.displayName="Button";const yhe=jt.forwardRef((e,t)=>b.jsx(cr,{ref:t,variant:"default",...e}));yhe.displayName="PrimaryButton";const vhe=jt.forwardRef((e,t)=>b.jsx(cr,{ref:t,variant:"destructive",...e}));vhe.displayName="DangerButton";const _he=jt.forwardRef((e,t)=>b.jsx(cr,{ref:t,variant:"outline",...e}));_he.displayName="OutlineButton";const xhe=jt.forwardRef((e,t)=>b.jsx(cr,{ref:t,variant:"ghost",...e}));xhe.displayName="GhostButton";function _c(e,t,{checkForDefaultPrevented:r=!0}={}){return function(a){if(e==null||e(a),r===!1||!a.defaultPrevented)return t==null?void 0:t(a)}}function I4(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function bhe(...e){return t=>{let r=!1;const n=e.map(a=>{const u=I4(a,t);return!r&&typeof u=="function"&&(r=!0),u});if(r)return()=>{for(let a=0;a<n.length;a++){const u=n[a];typeof u=="function"?u():I4(e[a],null)}}}}function Qu(...e){return j.useCallback(bhe(...e),e)}function whe(e,t){const r=j.createContext(t),n=u=>{const{children:f,...i}=u,y=j.useMemo(()=>i,Object.values(i));return b.jsx(r.Provider,{value:y,children:f})};n.displayName=e+"Provider";function a(u){const f=j.useContext(r);if(f)return f;if(t!==void 0)return t;throw new Error(`\`${u}\` must be used within \`${e}\``)}return[n,a]}function dj(e,t=[]){let r=[];function n(u,f){const i=j.createContext(f),y=r.length;r=[...r,f];const w=A=>{var V;const{scope:k,children:F,...D}=A,O=((V=k==null?void 0:k[e])==null?void 0:V[y])||i,N=j.useMemo(()=>D,Object.values(D));return b.jsx(O.Provider,{value:N,children:F})};w.displayName=u+"Provider";function T(A,k){var O;const F=((O=k==null?void 0:k[e])==null?void 0:O[y])||i,D=j.useContext(F);if(D)return D;if(f!==void 0)return f;throw new Error(`\`${A}\` must be used within \`${u}\``)}return[w,T]}const a=()=>{const u=r.map(f=>j.createContext(f));return function(i){const y=(i==null?void 0:i[e])||u;return j.useMemo(()=>({[`__scope${e}`]:{...i,[e]:y}}),[i,y])}};return a.scopeName=e,[n,She(a,...t)]}function She(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const n=e.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(u){const f=n.reduce((i,{useScope:y,scopeName:w})=>{const A=y(u)[`__scope${w}`];return{...i,...A}},{});return j.useMemo(()=>({[`__scope${t.scopeName}`]:f}),[f])}};return r.scopeName=t.scopeName,r}function uZ(e){const t=Ehe(e),r=j.forwardRef((n,a)=>{const{children:u,...f}=n,i=j.Children.toArray(u),y=i.find(Che);if(y){const w=y.props.children,T=i.map(A=>A===y?j.Children.count(w)>1?j.Children.only(null):j.isValidElement(w)?w.props.children:null:A);return b.jsx(t,{...f,ref:a,children:j.isValidElement(w)?j.cloneElement(w,void 0,T):null})}return b.jsx(t,{...f,ref:a,children:u})});return r.displayName=`${e}.Slot`,r}function Ehe(e){const t=j.forwardRef((r,n)=>{const{children:a,...u}=r,f=j.isValidElement(a)?Phe(a):void 0,i=Qu(f,n);if(j.isValidElement(a)){const y=Ahe(u,a.props);return a.type!==j.Fragment&&(y.ref=i),j.cloneElement(a,y)}return j.Children.count(a)>1?j.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var dZ=Symbol("radix.slottable");function The(e){const t=({children:r})=>b.jsx(b.Fragment,{children:r});return t.displayName=`${e}.Slottable`,t.__radixId=dZ,t}function Che(e){return j.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===dZ}function Ahe(e,t){const r={...t};for(const n in t){const a=e[n],u=t[n];/^on[A-Z]/.test(n)?a&&u?r[n]=(...i)=>{const y=u(...i);return a(...i),y}:a&&(r[n]=a):n==="style"?r[n]={...a,...u}:n==="className"&&(r[n]=[a,u].filter(Boolean).join(" "))}return{...e,...r}}function Phe(e){var n,a;let t=(n=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:n.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=(a=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:a.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}var Mhe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Tc=Mhe.reduce((e,t)=>{const r=uZ(`Primitive.${t}`),n=j.forwardRef((a,u)=>{const{asChild:f,...i}=a,y=f?r:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),b.jsx(y,{...i,ref:u})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function Ihe(e,t){e&&Cp.flushSync(()=>e.dispatchEvent(t))}function Yv(e){const t=j.useRef(e);return j.useEffect(()=>{t.current=e}),j.useMemo(()=>(...r)=>{var n;return(n=t.current)==null?void 0:n.call(t,...r)},[])}function khe(e,t=globalThis==null?void 0:globalThis.document){const r=Yv(e);j.useEffect(()=>{const n=a=>{a.key==="Escape"&&r(a)};return t.addEventListener("keydown",n,{capture:!0}),()=>t.removeEventListener("keydown",n,{capture:!0})},[r,t])}var Ohe="DismissableLayer",SO="dismissableLayer.update",Lhe="dismissableLayer.pointerDownOutside",Rhe="dismissableLayer.focusOutside",k4,hZ=j.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),hj=j.forwardRef((e,t)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:n,onPointerDownOutside:a,onFocusOutside:u,onInteractOutside:f,onDismiss:i,...y}=e,w=j.useContext(hZ),[T,A]=j.useState(null),k=(T==null?void 0:T.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,F]=j.useState({}),D=Qu(t,ie=>A(ie)),O=Array.from(w.layers),[N]=[...w.layersWithOutsidePointerEventsDisabled].slice(-1),V=O.indexOf(N),H=T?O.indexOf(T):-1,Z=w.layersWithOutsidePointerEventsDisabled.size>0,J=H>=V,G=Nhe(ie=>{const ce=ie.target,ge=[...w.branches].some(be=>be.contains(ce));!J||ge||(a==null||a(ie),f==null||f(ie),ie.defaultPrevented||i==null||i())},k),Y=zhe(ie=>{const ce=ie.target;[...w.branches].some(be=>be.contains(ce))||(u==null||u(ie),f==null||f(ie),ie.defaultPrevented||i==null||i())},k);return khe(ie=>{H===w.layers.size-1&&(n==null||n(ie),!ie.defaultPrevented&&i&&(ie.preventDefault(),i()))},k),j.useEffect(()=>{if(T)return r&&(w.layersWithOutsidePointerEventsDisabled.size===0&&(k4=k.body.style.pointerEvents,k.body.style.pointerEvents="none"),w.layersWithOutsidePointerEventsDisabled.add(T)),w.layers.add(T),O4(),()=>{r&&w.layersWithOutsidePointerEventsDisabled.size===1&&(k.body.style.pointerEvents=k4)}},[T,k,r,w]),j.useEffect(()=>()=>{T&&(w.layers.delete(T),w.layersWithOutsidePointerEventsDisabled.delete(T),O4())},[T,w]),j.useEffect(()=>{const ie=()=>F({});return document.addEventListener(SO,ie),()=>document.removeEventListener(SO,ie)},[]),b.jsx(Tc.div,{...y,ref:D,style:{pointerEvents:Z?J?"auto":"none":void 0,...e.style},onFocusCapture:_c(e.onFocusCapture,Y.onFocusCapture),onBlurCapture:_c(e.onBlurCapture,Y.onBlurCapture),onPointerDownCapture:_c(e.onPointerDownCapture,G.onPointerDownCapture)})});hj.displayName=Ohe;var jhe="DismissableLayerBranch",Dhe=j.forwardRef((e,t)=>{const r=j.useContext(hZ),n=j.useRef(null),a=Qu(t,n);return j.useEffect(()=>{const u=n.current;if(u)return r.branches.add(u),()=>{r.branches.delete(u)}},[r.branches]),b.jsx(Tc.div,{...e,ref:a})});Dhe.displayName=jhe;function Nhe(e,t=globalThis==null?void 0:globalThis.document){const r=Yv(e),n=j.useRef(!1),a=j.useRef(()=>{});return j.useEffect(()=>{const u=i=>{if(i.target&&!n.current){let y=function(){fZ(Lhe,r,w,{discrete:!0})};const w={originalEvent:i};i.pointerType==="touch"?(t.removeEventListener("click",a.current),a.current=y,t.addEventListener("click",a.current,{once:!0})):y()}else t.removeEventListener("click",a.current);n.current=!1},f=window.setTimeout(()=>{t.addEventListener("pointerdown",u)},0);return()=>{window.clearTimeout(f),t.removeEventListener("pointerdown",u),t.removeEventListener("click",a.current)}},[t,r]),{onPointerDownCapture:()=>n.current=!0}}function zhe(e,t=globalThis==null?void 0:globalThis.document){const r=Yv(e),n=j.useRef(!1);return j.useEffect(()=>{const a=u=>{u.target&&!n.current&&fZ(Rhe,r,{originalEvent:u},{discrete:!1})};return t.addEventListener("focusin",a),()=>t.removeEventListener("focusin",a)},[t,r]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function O4(){const e=new CustomEvent(SO);document.dispatchEvent(e)}function fZ(e,t,r,{discrete:n}){const a=r.originalEvent.target,u=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:r});t&&a.addEventListener(e,t,{once:!0}),n?Ihe(a,u):a.dispatchEvent(u)}var Gm=globalThis!=null&&globalThis.document?j.useLayoutEffect:()=>{},Fhe=TR[" useId ".trim().toString()]||(()=>{}),Bhe=0;function qw(e){const[t,r]=j.useState(Fhe());return Gm(()=>{r(n=>n??String(Bhe++))},[e]),t?`radix-${t}`:""}const $he=["top","right","bottom","left"],Hm=Math.min,tu=Math.max,hS=Math.round,sw=Math.floor,af=e=>({x:e,y:e}),Vhe={left:"right",right:"left",bottom:"top",top:"bottom"},Uhe={start:"end",end:"start"};function EO(e,t,r){return tu(e,Hm(t,r))}function xp(e,t){return typeof e=="function"?e(t):e}function bp(e){return e.split("-")[0]}function M_(e){return e.split("-")[1]}function fj(e){return e==="x"?"y":"x"}function pj(e){return e==="y"?"height":"width"}function mp(e){return["top","bottom"].includes(bp(e))?"y":"x"}function mj(e){return fj(mp(e))}function qhe(e,t,r){r===void 0&&(r=!1);const n=M_(e),a=mj(e),u=pj(a);let f=a==="x"?n===(r?"end":"start")?"right":"left":n==="start"?"bottom":"top";return t.reference[u]>t.floating[u]&&(f=fS(f)),[f,fS(f)]}function Ghe(e){const t=fS(e);return[TO(e),t,TO(t)]}function TO(e){return e.replace(/start|end/g,t=>Uhe[t])}function Hhe(e,t,r){const n=["left","right"],a=["right","left"],u=["top","bottom"],f=["bottom","top"];switch(e){case"top":case"bottom":return r?t?a:n:t?n:a;case"left":case"right":return t?u:f;default:return[]}}function Whe(e,t,r,n){const a=M_(e);let u=Hhe(bp(e),r==="start",n);return a&&(u=u.map(f=>f+"-"+a),t&&(u=u.concat(u.map(TO)))),u}function fS(e){return e.replace(/left|right|bottom|top/g,t=>Vhe[t])}function Zhe(e){return{top:0,right:0,bottom:0,left:0,...e}}function pZ(e){return typeof e!="number"?Zhe(e):{top:e,right:e,bottom:e,left:e}}function pS(e){const{x:t,y:r,width:n,height:a}=e;return{width:n,height:a,top:r,left:t,right:t+n,bottom:r+a,x:t,y:r}}function L4(e,t,r){let{reference:n,floating:a}=e;const u=mp(t),f=mj(t),i=pj(f),y=bp(t),w=u==="y",T=n.x+n.width/2-a.width/2,A=n.y+n.height/2-a.height/2,k=n[i]/2-a[i]/2;let F;switch(y){case"top":F={x:T,y:n.y-a.height};break;case"bottom":F={x:T,y:n.y+n.height};break;case"right":F={x:n.x+n.width,y:A};break;case"left":F={x:n.x-a.width,y:A};break;default:F={x:n.x,y:n.y}}switch(M_(t)){case"start":F[f]-=k*(r&&w?-1:1);break;case"end":F[f]+=k*(r&&w?-1:1);break}return F}const Xhe=async(e,t,r)=>{const{placement:n="bottom",strategy:a="absolute",middleware:u=[],platform:f}=r,i=u.filter(Boolean),y=await(f.isRTL==null?void 0:f.isRTL(t));let w=await f.getElementRects({reference:e,floating:t,strategy:a}),{x:T,y:A}=L4(w,n,y),k=n,F={},D=0;for(let O=0;O<i.length;O++){const{name:N,fn:V}=i[O],{x:H,y:Z,data:J,reset:G}=await V({x:T,y:A,initialPlacement:n,placement:k,strategy:a,middlewareData:F,rects:w,platform:f,elements:{reference:e,floating:t}});T=H??T,A=Z??A,F={...F,[N]:{...F[N],...J}},G&&D<=50&&(D++,typeof G=="object"&&(G.placement&&(k=G.placement),G.rects&&(w=G.rects===!0?await f.getElementRects({reference:e,floating:t,strategy:a}):G.rects),{x:T,y:A}=L4(w,k,y)),O=-1)}return{x:T,y:A,placement:k,strategy:a,middlewareData:F}};async function Dx(e,t){var r;t===void 0&&(t={});const{x:n,y:a,platform:u,rects:f,elements:i,strategy:y}=e,{boundary:w="clippingAncestors",rootBoundary:T="viewport",elementContext:A="floating",altBoundary:k=!1,padding:F=0}=xp(t,e),D=pZ(F),N=i[k?A==="floating"?"reference":"floating":A],V=pS(await u.getClippingRect({element:(r=await(u.isElement==null?void 0:u.isElement(N)))==null||r?N:N.contextElement||await(u.getDocumentElement==null?void 0:u.getDocumentElement(i.floating)),boundary:w,rootBoundary:T,strategy:y})),H=A==="floating"?{x:n,y:a,width:f.floating.width,height:f.floating.height}:f.reference,Z=await(u.getOffsetParent==null?void 0:u.getOffsetParent(i.floating)),J=await(u.isElement==null?void 0:u.isElement(Z))?await(u.getScale==null?void 0:u.getScale(Z))||{x:1,y:1}:{x:1,y:1},G=pS(u.convertOffsetParentRelativeRectToViewportRelativeRect?await u.convertOffsetParentRelativeRectToViewportRelativeRect({elements:i,rect:H,offsetParent:Z,strategy:y}):H);return{top:(V.top-G.top+D.top)/J.y,bottom:(G.bottom-V.bottom+D.bottom)/J.y,left:(V.left-G.left+D.left)/J.x,right:(G.right-V.right+D.right)/J.x}}const Khe=e=>({name:"arrow",options:e,async fn(t){const{x:r,y:n,placement:a,rects:u,platform:f,elements:i,middlewareData:y}=t,{element:w,padding:T=0}=xp(e,t)||{};if(w==null)return{};const A=pZ(T),k={x:r,y:n},F=mj(a),D=pj(F),O=await f.getDimensions(w),N=F==="y",V=N?"top":"left",H=N?"bottom":"right",Z=N?"clientHeight":"clientWidth",J=u.reference[D]+u.reference[F]-k[F]-u.floating[D],G=k[F]-u.reference[F],Y=await(f.getOffsetParent==null?void 0:f.getOffsetParent(w));let ie=Y?Y[Z]:0;(!ie||!await(f.isElement==null?void 0:f.isElement(Y)))&&(ie=i.floating[Z]||u.floating[D]);const ce=J/2-G/2,ge=ie/2-O[D]/2-1,be=Hm(A[V],ge),xe=Hm(A[H],ge),Le=be,ze=ie-O[D]-xe,Xe=ie/2-O[D]/2+ce,Je=EO(Le,Xe,ze),tt=!y.arrow&&M_(a)!=null&&Xe!==Je&&u.reference[D]/2-(Xe<Le?be:xe)-O[D]/2<0,st=tt?Xe<Le?Xe-Le:Xe-ze:0;return{[F]:k[F]+st,data:{[F]:Je,centerOffset:Xe-Je-st,...tt&&{alignmentOffset:st}},reset:tt}}}),Yhe=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var r,n;const{placement:a,middlewareData:u,rects:f,initialPlacement:i,platform:y,elements:w}=t,{mainAxis:T=!0,crossAxis:A=!0,fallbackPlacements:k,fallbackStrategy:F="bestFit",fallbackAxisSideDirection:D="none",flipAlignment:O=!0,...N}=xp(e,t);if((r=u.arrow)!=null&&r.alignmentOffset)return{};const V=bp(a),H=mp(i),Z=bp(i)===i,J=await(y.isRTL==null?void 0:y.isRTL(w.floating)),G=k||(Z||!O?[fS(i)]:Ghe(i)),Y=D!=="none";!k&&Y&&G.push(...Whe(i,O,D,J));const ie=[i,...G],ce=await Dx(t,N),ge=[];let be=((n=u.flip)==null?void 0:n.overflows)||[];if(T&&ge.push(ce[V]),A){const Je=qhe(a,f,J);ge.push(ce[Je[0]],ce[Je[1]])}if(be=[...be,{placement:a,overflows:ge}],!ge.every(Je=>Je<=0)){var xe,Le;const Je=(((xe=u.flip)==null?void 0:xe.index)||0)+1,tt=ie[Je];if(tt){var ze;const Ne=A==="alignment"?H!==mp(tt):!1,We=((ze=be[0])==null?void 0:ze.overflows[0])>0;if(!Ne||We)return{data:{index:Je,overflows:be},reset:{placement:tt}}}let st=(Le=be.filter(Ne=>Ne.overflows[0]<=0).sort((Ne,We)=>Ne.overflows[1]-We.overflows[1])[0])==null?void 0:Le.placement;if(!st)switch(F){case"bestFit":{var Xe;const Ne=(Xe=be.filter(We=>{if(Y){const Ue=mp(We.placement);return Ue===H||Ue==="y"}return!0}).map(We=>[We.placement,We.overflows.filter(Ue=>Ue>0).reduce((Ue,De)=>Ue+De,0)]).sort((We,Ue)=>We[1]-Ue[1])[0])==null?void 0:Xe[0];Ne&&(st=Ne);break}case"initialPlacement":st=i;break}if(a!==st)return{reset:{placement:st}}}return{}}}};function R4(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function j4(e){return $he.some(t=>e[t]>=0)}const Jhe=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:r}=t,{strategy:n="referenceHidden",...a}=xp(e,t);switch(n){case"referenceHidden":{const u=await Dx(t,{...a,elementContext:"reference"}),f=R4(u,r.reference);return{data:{referenceHiddenOffsets:f,referenceHidden:j4(f)}}}case"escaped":{const u=await Dx(t,{...a,altBoundary:!0}),f=R4(u,r.floating);return{data:{escapedOffsets:f,escaped:j4(f)}}}default:return{}}}}};async function Qhe(e,t){const{placement:r,platform:n,elements:a}=e,u=await(n.isRTL==null?void 0:n.isRTL(a.floating)),f=bp(r),i=M_(r),y=mp(r)==="y",w=["left","top"].includes(f)?-1:1,T=u&&y?-1:1,A=xp(t,e);let{mainAxis:k,crossAxis:F,alignmentAxis:D}=typeof A=="number"?{mainAxis:A,crossAxis:0,alignmentAxis:null}:{mainAxis:A.mainAxis||0,crossAxis:A.crossAxis||0,alignmentAxis:A.alignmentAxis};return i&&typeof D=="number"&&(F=i==="end"?D*-1:D),y?{x:F*T,y:k*w}:{x:k*w,y:F*T}}const efe=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var r,n;const{x:a,y:u,placement:f,middlewareData:i}=t,y=await Qhe(t,e);return f===((r=i.offset)==null?void 0:r.placement)&&(n=i.arrow)!=null&&n.alignmentOffset?{}:{x:a+y.x,y:u+y.y,data:{...y,placement:f}}}}},tfe=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:r,y:n,placement:a}=t,{mainAxis:u=!0,crossAxis:f=!1,limiter:i={fn:N=>{let{x:V,y:H}=N;return{x:V,y:H}}},...y}=xp(e,t),w={x:r,y:n},T=await Dx(t,y),A=mp(bp(a)),k=fj(A);let F=w[k],D=w[A];if(u){const N=k==="y"?"top":"left",V=k==="y"?"bottom":"right",H=F+T[N],Z=F-T[V];F=EO(H,F,Z)}if(f){const N=A==="y"?"top":"left",V=A==="y"?"bottom":"right",H=D+T[N],Z=D-T[V];D=EO(H,D,Z)}const O=i.fn({...t,[k]:F,[A]:D});return{...O,data:{x:O.x-r,y:O.y-n,enabled:{[k]:u,[A]:f}}}}}},rfe=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:r,y:n,placement:a,rects:u,middlewareData:f}=t,{offset:i=0,mainAxis:y=!0,crossAxis:w=!0}=xp(e,t),T={x:r,y:n},A=mp(a),k=fj(A);let F=T[k],D=T[A];const O=xp(i,t),N=typeof O=="number"?{mainAxis:O,crossAxis:0}:{mainAxis:0,crossAxis:0,...O};if(y){const Z=k==="y"?"height":"width",J=u.reference[k]-u.floating[Z]+N.mainAxis,G=u.reference[k]+u.reference[Z]-N.mainAxis;F<J?F=J:F>G&&(F=G)}if(w){var V,H;const Z=k==="y"?"width":"height",J=["top","left"].includes(bp(a)),G=u.reference[A]-u.floating[Z]+(J&&((V=f.offset)==null?void 0:V[A])||0)+(J?0:N.crossAxis),Y=u.reference[A]+u.reference[Z]+(J?0:((H=f.offset)==null?void 0:H[A])||0)-(J?N.crossAxis:0);D<G?D=G:D>Y&&(D=Y)}return{[k]:F,[A]:D}}}},nfe=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var r,n;const{placement:a,rects:u,platform:f,elements:i}=t,{apply:y=()=>{},...w}=xp(e,t),T=await Dx(t,w),A=bp(a),k=M_(a),F=mp(a)==="y",{width:D,height:O}=u.floating;let N,V;A==="top"||A==="bottom"?(N=A,V=k===(await(f.isRTL==null?void 0:f.isRTL(i.floating))?"start":"end")?"left":"right"):(V=A,N=k==="end"?"top":"bottom");const H=O-T.top-T.bottom,Z=D-T.left-T.right,J=Hm(O-T[N],H),G=Hm(D-T[V],Z),Y=!t.middlewareData.shift;let ie=J,ce=G;if((r=t.middlewareData.shift)!=null&&r.enabled.x&&(ce=Z),(n=t.middlewareData.shift)!=null&&n.enabled.y&&(ie=H),Y&&!k){const be=tu(T.left,0),xe=tu(T.right,0),Le=tu(T.top,0),ze=tu(T.bottom,0);F?ce=D-2*(be!==0||xe!==0?be+xe:tu(T.left,T.right)):ie=O-2*(Le!==0||ze!==0?Le+ze:tu(T.top,T.bottom))}await y({...t,availableWidth:ce,availableHeight:ie});const ge=await f.getDimensions(i.floating);return D!==ge.width||O!==ge.height?{reset:{rects:!0}}:{}}}};function qE(){return typeof window<"u"}function I_(e){return mZ(e)?(e.nodeName||"").toLowerCase():"#document"}function lu(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function ff(e){var t;return(t=(mZ(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function mZ(e){return qE()?e instanceof Node||e instanceof lu(e).Node:!1}function Jd(e){return qE()?e instanceof Element||e instanceof lu(e).Element:!1}function df(e){return qE()?e instanceof HTMLElement||e instanceof lu(e).HTMLElement:!1}function D4(e){return!qE()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof lu(e).ShadowRoot}function Nb(e){const{overflow:t,overflowX:r,overflowY:n,display:a}=Qd(e);return/auto|scroll|overlay|hidden|clip/.test(t+n+r)&&!["inline","contents"].includes(a)}function ife(e){return["table","td","th"].includes(I_(e))}function GE(e){return[":popover-open",":modal"].some(t=>{try{return e.matches(t)}catch{return!1}})}function gj(e){const t=yj(),r=Jd(e)?Qd(e):e;return["transform","translate","scale","rotate","perspective"].some(n=>r[n]?r[n]!=="none":!1)||(r.containerType?r.containerType!=="normal":!1)||!t&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!t&&(r.filter?r.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(n=>(r.willChange||"").includes(n))||["paint","layout","strict","content"].some(n=>(r.contain||"").includes(n))}function sfe(e){let t=Wm(e);for(;df(t)&&!Jv(t);){if(gj(t))return t;if(GE(t))return null;t=Wm(t)}return null}function yj(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Jv(e){return["html","body","#document"].includes(I_(e))}function Qd(e){return lu(e).getComputedStyle(e)}function HE(e){return Jd(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Wm(e){if(I_(e)==="html")return e;const t=e.assignedSlot||e.parentNode||D4(e)&&e.host||ff(e);return D4(t)?t.host:t}function gZ(e){const t=Wm(e);return Jv(t)?e.ownerDocument?e.ownerDocument.body:e.body:df(t)&&Nb(t)?t:gZ(t)}function Nx(e,t,r){var n;t===void 0&&(t=[]),r===void 0&&(r=!0);const a=gZ(e),u=a===((n=e.ownerDocument)==null?void 0:n.body),f=lu(a);if(u){const i=CO(f);return t.concat(f,f.visualViewport||[],Nb(a)?a:[],i&&r?Nx(i):[])}return t.concat(a,Nx(a,[],r))}function CO(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function yZ(e){const t=Qd(e);let r=parseFloat(t.width)||0,n=parseFloat(t.height)||0;const a=df(e),u=a?e.offsetWidth:r,f=a?e.offsetHeight:n,i=hS(r)!==u||hS(n)!==f;return i&&(r=u,n=f),{width:r,height:n,$:i}}function vj(e){return Jd(e)?e:e.contextElement}function Bv(e){const t=vj(e);if(!df(t))return af(1);const r=t.getBoundingClientRect(),{width:n,height:a,$:u}=yZ(t);let f=(u?hS(r.width):r.width)/n,i=(u?hS(r.height):r.height)/a;return(!f||!Number.isFinite(f))&&(f=1),(!i||!Number.isFinite(i))&&(i=1),{x:f,y:i}}const ofe=af(0);function vZ(e){const t=lu(e);return!yj()||!t.visualViewport?ofe:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function afe(e,t,r){return t===void 0&&(t=!1),!r||t&&r!==lu(e)?!1:t}function by(e,t,r,n){t===void 0&&(t=!1),r===void 0&&(r=!1);const a=e.getBoundingClientRect(),u=vj(e);let f=af(1);t&&(n?Jd(n)&&(f=Bv(n)):f=Bv(e));const i=afe(u,r,n)?vZ(u):af(0);let y=(a.left+i.x)/f.x,w=(a.top+i.y)/f.y,T=a.width/f.x,A=a.height/f.y;if(u){const k=lu(u),F=n&&Jd(n)?lu(n):n;let D=k,O=CO(D);for(;O&&n&&F!==D;){const N=Bv(O),V=O.getBoundingClientRect(),H=Qd(O),Z=V.left+(O.clientLeft+parseFloat(H.paddingLeft))*N.x,J=V.top+(O.clientTop+parseFloat(H.paddingTop))*N.y;y*=N.x,w*=N.y,T*=N.x,A*=N.y,y+=Z,w+=J,D=lu(O),O=CO(D)}}return pS({width:T,height:A,x:y,y:w})}function _j(e,t){const r=HE(e).scrollLeft;return t?t.left+r:by(ff(e)).left+r}function _Z(e,t,r){r===void 0&&(r=!1);const n=e.getBoundingClientRect(),a=n.left+t.scrollLeft-(r?0:_j(e,n)),u=n.top+t.scrollTop;return{x:a,y:u}}function lfe(e){let{elements:t,rect:r,offsetParent:n,strategy:a}=e;const u=a==="fixed",f=ff(n),i=t?GE(t.floating):!1;if(n===f||i&&u)return r;let y={scrollLeft:0,scrollTop:0},w=af(1);const T=af(0),A=df(n);if((A||!A&&!u)&&((I_(n)!=="body"||Nb(f))&&(y=HE(n)),df(n))){const F=by(n);w=Bv(n),T.x=F.x+n.clientLeft,T.y=F.y+n.clientTop}const k=f&&!A&&!u?_Z(f,y,!0):af(0);return{width:r.width*w.x,height:r.height*w.y,x:r.x*w.x-y.scrollLeft*w.x+T.x+k.x,y:r.y*w.y-y.scrollTop*w.y+T.y+k.y}}function cfe(e){return Array.from(e.getClientRects())}function ufe(e){const t=ff(e),r=HE(e),n=e.ownerDocument.body,a=tu(t.scrollWidth,t.clientWidth,n.scrollWidth,n.clientWidth),u=tu(t.scrollHeight,t.clientHeight,n.scrollHeight,n.clientHeight);let f=-r.scrollLeft+_j(e);const i=-r.scrollTop;return Qd(n).direction==="rtl"&&(f+=tu(t.clientWidth,n.clientWidth)-a),{width:a,height:u,x:f,y:i}}function dfe(e,t){const r=lu(e),n=ff(e),a=r.visualViewport;let u=n.clientWidth,f=n.clientHeight,i=0,y=0;if(a){u=a.width,f=a.height;const w=yj();(!w||w&&t==="fixed")&&(i=a.offsetLeft,y=a.offsetTop)}return{width:u,height:f,x:i,y}}function hfe(e,t){const r=by(e,!0,t==="fixed"),n=r.top+e.clientTop,a=r.left+e.clientLeft,u=df(e)?Bv(e):af(1),f=e.clientWidth*u.x,i=e.clientHeight*u.y,y=a*u.x,w=n*u.y;return{width:f,height:i,x:y,y:w}}function N4(e,t,r){let n;if(t==="viewport")n=dfe(e,r);else if(t==="document")n=ufe(ff(e));else if(Jd(t))n=hfe(t,r);else{const a=vZ(e);n={x:t.x-a.x,y:t.y-a.y,width:t.width,height:t.height}}return pS(n)}function xZ(e,t){const r=Wm(e);return r===t||!Jd(r)||Jv(r)?!1:Qd(r).position==="fixed"||xZ(r,t)}function ffe(e,t){const r=t.get(e);if(r)return r;let n=Nx(e,[],!1).filter(i=>Jd(i)&&I_(i)!=="body"),a=null;const u=Qd(e).position==="fixed";let f=u?Wm(e):e;for(;Jd(f)&&!Jv(f);){const i=Qd(f),y=gj(f);!y&&i.position==="fixed"&&(a=null),(u?!y&&!a:!y&&i.position==="static"&&!!a&&["absolute","fixed"].includes(a.position)||Nb(f)&&!y&&xZ(e,f))?n=n.filter(T=>T!==f):a=i,f=Wm(f)}return t.set(e,n),n}function pfe(e){let{element:t,boundary:r,rootBoundary:n,strategy:a}=e;const f=[...r==="clippingAncestors"?GE(t)?[]:ffe(t,this._c):[].concat(r),n],i=f[0],y=f.reduce((w,T)=>{const A=N4(t,T,a);return w.top=tu(A.top,w.top),w.right=Hm(A.right,w.right),w.bottom=Hm(A.bottom,w.bottom),w.left=tu(A.left,w.left),w},N4(t,i,a));return{width:y.right-y.left,height:y.bottom-y.top,x:y.left,y:y.top}}function mfe(e){const{width:t,height:r}=yZ(e);return{width:t,height:r}}function gfe(e,t,r){const n=df(t),a=ff(t),u=r==="fixed",f=by(e,!0,u,t);let i={scrollLeft:0,scrollTop:0};const y=af(0);function w(){y.x=_j(a)}if(n||!n&&!u)if((I_(t)!=="body"||Nb(a))&&(i=HE(t)),n){const F=by(t,!0,u,t);y.x=F.x+t.clientLeft,y.y=F.y+t.clientTop}else a&&w();u&&!n&&a&&w();const T=a&&!n&&!u?_Z(a,i):af(0),A=f.left+i.scrollLeft-y.x-T.x,k=f.top+i.scrollTop-y.y-T.y;return{x:A,y:k,width:f.width,height:f.height}}function IC(e){return Qd(e).position==="static"}function z4(e,t){if(!df(e)||Qd(e).position==="fixed")return null;if(t)return t(e);let r=e.offsetParent;return ff(e)===r&&(r=r.ownerDocument.body),r}function bZ(e,t){const r=lu(e);if(GE(e))return r;if(!df(e)){let a=Wm(e);for(;a&&!Jv(a);){if(Jd(a)&&!IC(a))return a;a=Wm(a)}return r}let n=z4(e,t);for(;n&&ife(n)&&IC(n);)n=z4(n,t);return n&&Jv(n)&&IC(n)&&!gj(n)?r:n||sfe(e)||r}const yfe=async function(e){const t=this.getOffsetParent||bZ,r=this.getDimensions,n=await r(e.floating);return{reference:gfe(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function vfe(e){return Qd(e).direction==="rtl"}const _fe={convertOffsetParentRelativeRectToViewportRelativeRect:lfe,getDocumentElement:ff,getClippingRect:pfe,getOffsetParent:bZ,getElementRects:yfe,getClientRects:cfe,getDimensions:mfe,getScale:Bv,isElement:Jd,isRTL:vfe};function wZ(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function xfe(e,t){let r=null,n;const a=ff(e);function u(){var i;clearTimeout(n),(i=r)==null||i.disconnect(),r=null}function f(i,y){i===void 0&&(i=!1),y===void 0&&(y=1),u();const w=e.getBoundingClientRect(),{left:T,top:A,width:k,height:F}=w;if(i||t(),!k||!F)return;const D=sw(A),O=sw(a.clientWidth-(T+k)),N=sw(a.clientHeight-(A+F)),V=sw(T),Z={rootMargin:-D+"px "+-O+"px "+-N+"px "+-V+"px",threshold:tu(0,Hm(1,y))||1};let J=!0;function G(Y){const ie=Y[0].intersectionRatio;if(ie!==y){if(!J)return f();ie?f(!1,ie):n=setTimeout(()=>{f(!1,1e-7)},1e3)}ie===1&&!wZ(w,e.getBoundingClientRect())&&f(),J=!1}try{r=new IntersectionObserver(G,{...Z,root:a.ownerDocument})}catch{r=new IntersectionObserver(G,Z)}r.observe(e)}return f(!0),u}function bfe(e,t,r,n){n===void 0&&(n={});const{ancestorScroll:a=!0,ancestorResize:u=!0,elementResize:f=typeof ResizeObserver=="function",layoutShift:i=typeof IntersectionObserver=="function",animationFrame:y=!1}=n,w=vj(e),T=a||u?[...w?Nx(w):[],...Nx(t)]:[];T.forEach(V=>{a&&V.addEventListener("scroll",r,{passive:!0}),u&&V.addEventListener("resize",r)});const A=w&&i?xfe(w,r):null;let k=-1,F=null;f&&(F=new ResizeObserver(V=>{let[H]=V;H&&H.target===w&&F&&(F.unobserve(t),cancelAnimationFrame(k),k=requestAnimationFrame(()=>{var Z;(Z=F)==null||Z.observe(t)})),r()}),w&&!y&&F.observe(w),F.observe(t));let D,O=y?by(e):null;y&&N();function N(){const V=by(e);O&&!wZ(O,V)&&r(),O=V,D=requestAnimationFrame(N)}return r(),()=>{var V;T.forEach(H=>{a&&H.removeEventListener("scroll",r),u&&H.removeEventListener("resize",r)}),A==null||A(),(V=F)==null||V.disconnect(),F=null,y&&cancelAnimationFrame(D)}}const wfe=efe,Sfe=tfe,Efe=Yhe,Tfe=nfe,Cfe=Jhe,F4=Khe,Afe=rfe,Pfe=(e,t,r)=>{const n=new Map,a={platform:_fe,...r},u={...a.platform,_c:n};return Xhe(e,t,{...a,platform:u})};var Gw=typeof document<"u"?j.useLayoutEffect:j.useEffect;function mS(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let r,n,a;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(r=e.length,r!==t.length)return!1;for(n=r;n--!==0;)if(!mS(e[n],t[n]))return!1;return!0}if(a=Object.keys(e),r=a.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!{}.hasOwnProperty.call(t,a[n]))return!1;for(n=r;n--!==0;){const u=a[n];if(!(u==="_owner"&&e.$$typeof)&&!mS(e[u],t[u]))return!1}return!0}return e!==e&&t!==t}function SZ(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function B4(e,t){const r=SZ(e);return Math.round(t*r)/r}function kC(e){const t=j.useRef(e);return Gw(()=>{t.current=e}),t}function Mfe(e){e===void 0&&(e={});const{placement:t="bottom",strategy:r="absolute",middleware:n=[],platform:a,elements:{reference:u,floating:f}={},transform:i=!0,whileElementsMounted:y,open:w}=e,[T,A]=j.useState({x:0,y:0,strategy:r,placement:t,middlewareData:{},isPositioned:!1}),[k,F]=j.useState(n);mS(k,n)||F(n);const[D,O]=j.useState(null),[N,V]=j.useState(null),H=j.useCallback(Ne=>{Ne!==Y.current&&(Y.current=Ne,O(Ne))},[]),Z=j.useCallback(Ne=>{Ne!==ie.current&&(ie.current=Ne,V(Ne))},[]),J=u||D,G=f||N,Y=j.useRef(null),ie=j.useRef(null),ce=j.useRef(T),ge=y!=null,be=kC(y),xe=kC(a),Le=kC(w),ze=j.useCallback(()=>{if(!Y.current||!ie.current)return;const Ne={placement:t,strategy:r,middleware:k};xe.current&&(Ne.platform=xe.current),Pfe(Y.current,ie.current,Ne).then(We=>{const Ue={...We,isPositioned:Le.current!==!1};Xe.current&&!mS(ce.current,Ue)&&(ce.current=Ue,Cp.flushSync(()=>{A(Ue)}))})},[k,t,r,xe,Le]);Gw(()=>{w===!1&&ce.current.isPositioned&&(ce.current.isPositioned=!1,A(Ne=>({...Ne,isPositioned:!1})))},[w]);const Xe=j.useRef(!1);Gw(()=>(Xe.current=!0,()=>{Xe.current=!1}),[]),Gw(()=>{if(J&&(Y.current=J),G&&(ie.current=G),J&&G){if(be.current)return be.current(J,G,ze);ze()}},[J,G,ze,be,ge]);const Je=j.useMemo(()=>({reference:Y,floating:ie,setReference:H,setFloating:Z}),[H,Z]),tt=j.useMemo(()=>({reference:J,floating:G}),[J,G]),st=j.useMemo(()=>{const Ne={position:r,left:0,top:0};if(!tt.floating)return Ne;const We=B4(tt.floating,T.x),Ue=B4(tt.floating,T.y);return i?{...Ne,transform:"translate("+We+"px, "+Ue+"px)",...SZ(tt.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:We,top:Ue}},[r,i,tt.floating,T.x,T.y]);return j.useMemo(()=>({...T,update:ze,refs:Je,elements:tt,floatingStyles:st}),[T,ze,Je,tt,st])}const Ife=e=>{function t(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:e,fn(r){const{element:n,padding:a}=typeof e=="function"?e(r):e;return n&&t(n)?n.current!=null?F4({element:n.current,padding:a}).fn(r):{}:n?F4({element:n,padding:a}).fn(r):{}}}},kfe=(e,t)=>({...wfe(e),options:[e,t]}),Ofe=(e,t)=>({...Sfe(e),options:[e,t]}),Lfe=(e,t)=>({...Afe(e),options:[e,t]}),Rfe=(e,t)=>({...Efe(e),options:[e,t]}),jfe=(e,t)=>({...Tfe(e),options:[e,t]}),Dfe=(e,t)=>({...Cfe(e),options:[e,t]}),Nfe=(e,t)=>({...Ife(e),options:[e,t]});var zfe="Arrow",EZ=j.forwardRef((e,t)=>{const{children:r,width:n=10,height:a=5,...u}=e;return b.jsx(Tc.svg,{...u,ref:t,width:n,height:a,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?r:b.jsx("polygon",{points:"0,0 30,0 15,10"})})});EZ.displayName=zfe;var Ffe=EZ;function Bfe(e){const[t,r]=j.useState(void 0);return Gm(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});const n=new ResizeObserver(a=>{if(!Array.isArray(a)||!a.length)return;const u=a[0];let f,i;if("borderBoxSize"in u){const y=u.borderBoxSize,w=Array.isArray(y)?y[0]:y;f=w.inlineSize,i=w.blockSize}else f=e.offsetWidth,i=e.offsetHeight;r({width:f,height:i})});return n.observe(e,{box:"border-box"}),()=>n.unobserve(e)}else r(void 0)},[e]),t}var xj="Popper",[TZ,CZ]=dj(xj),[$fe,AZ]=TZ(xj),PZ=e=>{const{__scopePopper:t,children:r}=e,[n,a]=j.useState(null);return b.jsx($fe,{scope:t,anchor:n,onAnchorChange:a,children:r})};PZ.displayName=xj;var MZ="PopperAnchor",IZ=j.forwardRef((e,t)=>{const{__scopePopper:r,virtualRef:n,...a}=e,u=AZ(MZ,r),f=j.useRef(null),i=Qu(t,f);return j.useEffect(()=>{u.onAnchorChange((n==null?void 0:n.current)||f.current)}),n?null:b.jsx(Tc.div,{...a,ref:i})});IZ.displayName=MZ;var bj="PopperContent",[Vfe,Ufe]=TZ(bj),kZ=j.forwardRef((e,t)=>{var kt,Wt,Tt,Ht,ur,Jt;const{__scopePopper:r,side:n="bottom",sideOffset:a=0,align:u="center",alignOffset:f=0,arrowPadding:i=0,avoidCollisions:y=!0,collisionBoundary:w=[],collisionPadding:T=0,sticky:A="partial",hideWhenDetached:k=!1,updatePositionStrategy:F="optimized",onPlaced:D,...O}=e,N=AZ(bj,r),[V,H]=j.useState(null),Z=Qu(t,Rt=>H(Rt)),[J,G]=j.useState(null),Y=Bfe(J),ie=(Y==null?void 0:Y.width)??0,ce=(Y==null?void 0:Y.height)??0,ge=n+(u!=="center"?"-"+u:""),be=typeof T=="number"?T:{top:0,right:0,bottom:0,left:0,...T},xe=Array.isArray(w)?w:[w],Le=xe.length>0,ze={padding:be,boundary:xe.filter(Gfe),altBoundary:Le},{refs:Xe,floatingStyles:Je,placement:tt,isPositioned:st,middlewareData:Ne}=Mfe({strategy:"fixed",placement:ge,whileElementsMounted:(...Rt)=>bfe(...Rt,{animationFrame:F==="always"}),elements:{reference:N.anchor},middleware:[kfe({mainAxis:a+ce,alignmentAxis:f}),y&&Ofe({mainAxis:!0,crossAxis:!1,limiter:A==="partial"?Lfe():void 0,...ze}),y&&Rfe({...ze}),jfe({...ze,apply:({elements:Rt,rects:Dt,availableWidth:sr,availableHeight:mr})=>{const{width:Vr,height:rn}=Dt.reference,$r=Rt.floating.style;$r.setProperty("--radix-popper-available-width",`${sr}px`),$r.setProperty("--radix-popper-available-height",`${mr}px`),$r.setProperty("--radix-popper-anchor-width",`${Vr}px`),$r.setProperty("--radix-popper-anchor-height",`${rn}px`)}}),J&&Nfe({element:J,padding:i}),Hfe({arrowWidth:ie,arrowHeight:ce}),k&&Dfe({strategy:"referenceHidden",...ze})]}),[We,Ue]=RZ(tt),De=Yv(D);Gm(()=>{st&&(De==null||De())},[st,De]);const Ke=(kt=Ne.arrow)==null?void 0:kt.x,lt=(Wt=Ne.arrow)==null?void 0:Wt.y,Ye=((Tt=Ne.arrow)==null?void 0:Tt.centerOffset)!==0,[Ve,Et]=j.useState();return Gm(()=>{V&&Et(window.getComputedStyle(V).zIndex)},[V]),b.jsx("div",{ref:Xe.setFloating,"data-radix-popper-content-wrapper":"",style:{...Je,transform:st?Je.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Ve,"--radix-popper-transform-origin":[(Ht=Ne.transformOrigin)==null?void 0:Ht.x,(ur=Ne.transformOrigin)==null?void 0:ur.y].join(" "),...((Jt=Ne.hide)==null?void 0:Jt.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:b.jsx(Vfe,{scope:r,placedSide:We,onArrowChange:G,arrowX:Ke,arrowY:lt,shouldHideArrow:Ye,children:b.jsx(Tc.div,{"data-side":We,"data-align":Ue,...O,ref:Z,style:{...O.style,animation:st?void 0:"none"}})})})});kZ.displayName=bj;var OZ="PopperArrow",qfe={top:"bottom",right:"left",bottom:"top",left:"right"},LZ=j.forwardRef(function(t,r){const{__scopePopper:n,...a}=t,u=Ufe(OZ,n),f=qfe[u.placedSide];return b.jsx("span",{ref:u.onArrowChange,style:{position:"absolute",left:u.arrowX,top:u.arrowY,[f]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[u.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[u.placedSide],visibility:u.shouldHideArrow?"hidden":void 0},children:b.jsx(Ffe,{...a,ref:r,style:{...a.style,display:"block"}})})});LZ.displayName=OZ;function Gfe(e){return e!==null}var Hfe=e=>({name:"transformOrigin",options:e,fn(t){var N,V,H;const{placement:r,rects:n,middlewareData:a}=t,f=((N=a.arrow)==null?void 0:N.centerOffset)!==0,i=f?0:e.arrowWidth,y=f?0:e.arrowHeight,[w,T]=RZ(r),A={start:"0%",center:"50%",end:"100%"}[T],k=(((V=a.arrow)==null?void 0:V.x)??0)+i/2,F=(((H=a.arrow)==null?void 0:H.y)??0)+y/2;let D="",O="";return w==="bottom"?(D=f?A:`${k}px`,O=`${-y}px`):w==="top"?(D=f?A:`${k}px`,O=`${n.floating.height+y}px`):w==="right"?(D=`${-y}px`,O=f?A:`${F}px`):w==="left"&&(D=`${n.floating.width+y}px`,O=f?A:`${F}px`),{data:{x:D,y:O}}}});function RZ(e){const[t,r="center"]=e.split("-");return[t,r]}var Wfe=PZ,Zfe=IZ,Xfe=kZ,Kfe=LZ,Yfe="Portal",jZ=j.forwardRef((e,t)=>{var i;const{container:r,...n}=e,[a,u]=j.useState(!1);Gm(()=>u(!0),[]);const f=r||a&&((i=globalThis==null?void 0:globalThis.document)==null?void 0:i.body);return f?oH.createPortal(b.jsx(Tc.div,{...n,ref:t}),f):null});jZ.displayName=Yfe;function Jfe(e,t){return j.useReducer((r,n)=>t[r][n]??r,e)}var zb=e=>{const{present:t,children:r}=e,n=Qfe(t),a=typeof r=="function"?r({present:n.isPresent}):j.Children.only(r),u=Qu(n.ref,epe(a));return typeof r=="function"||n.isPresent?j.cloneElement(a,{ref:u}):null};zb.displayName="Presence";function Qfe(e){const[t,r]=j.useState(),n=j.useRef(null),a=j.useRef(e),u=j.useRef("none"),f=e?"mounted":"unmounted",[i,y]=Jfe(f,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return j.useEffect(()=>{const w=ow(n.current);u.current=i==="mounted"?w:"none"},[i]),Gm(()=>{const w=n.current,T=a.current;if(T!==e){const k=u.current,F=ow(w);e?y("MOUNT"):F==="none"||(w==null?void 0:w.display)==="none"?y("UNMOUNT"):y(T&&k!==F?"ANIMATION_OUT":"UNMOUNT"),a.current=e}},[e,y]),Gm(()=>{if(t){let w;const T=t.ownerDocument.defaultView??window,A=F=>{const O=ow(n.current).includes(F.animationName);if(F.target===t&&O&&(y("ANIMATION_END"),!a.current)){const N=t.style.animationFillMode;t.style.animationFillMode="forwards",w=T.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=N)})}},k=F=>{F.target===t&&(u.current=ow(n.current))};return t.addEventListener("animationstart",k),t.addEventListener("animationcancel",A),t.addEventListener("animationend",A),()=>{T.clearTimeout(w),t.removeEventListener("animationstart",k),t.removeEventListener("animationcancel",A),t.removeEventListener("animationend",A)}}else y("ANIMATION_END")},[t,y]),{isPresent:["mounted","unmountSuspended"].includes(i),ref:j.useCallback(w=>{n.current=w?getComputedStyle(w):null,r(w)},[])}}function ow(e){return(e==null?void 0:e.animationName)||"none"}function epe(e){var n,a;let t=(n=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:n.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=(a=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:a.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}var tpe=TR[" useInsertionEffect ".trim().toString()]||Gm;function DZ({prop:e,defaultProp:t,onChange:r=()=>{},caller:n}){const[a,u,f]=rpe({defaultProp:t,onChange:r}),i=e!==void 0,y=i?e:a;{const T=j.useRef(e!==void 0);j.useEffect(()=>{const A=T.current;A!==i&&console.warn(`${n} is changing from ${A?"controlled":"uncontrolled"} to ${i?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),T.current=i},[i,n])}const w=j.useCallback(T=>{var A;if(i){const k=npe(T)?T(e):T;k!==e&&((A=f.current)==null||A.call(f,k))}else u(T)},[i,e,u,f]);return[y,w]}function rpe({defaultProp:e,onChange:t}){const[r,n]=j.useState(e),a=j.useRef(r),u=j.useRef(t);return tpe(()=>{u.current=t},[t]),j.useEffect(()=>{var f;a.current!==r&&((f=u.current)==null||f.call(u,r),a.current=r)},[r,a]),[r,n,u]}function npe(e){return typeof e=="function"}var ipe=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),spe="VisuallyHidden",NZ=j.forwardRef((e,t)=>b.jsx(Tc.span,{...e,ref:t,style:{...ipe,...e.style}}));NZ.displayName=spe;var ope=NZ,[WE,kFe]=dj("Tooltip",[CZ]),ZE=CZ(),zZ="TooltipProvider",ape=700,AO="tooltip.open",[lpe,wj]=WE(zZ),FZ=e=>{const{__scopeTooltip:t,delayDuration:r=ape,skipDelayDuration:n=300,disableHoverableContent:a=!1,children:u}=e,f=j.useRef(!0),i=j.useRef(!1),y=j.useRef(0);return j.useEffect(()=>{const w=y.current;return()=>window.clearTimeout(w)},[]),b.jsx(lpe,{scope:t,isOpenDelayedRef:f,delayDuration:r,onOpen:j.useCallback(()=>{window.clearTimeout(y.current),f.current=!1},[]),onClose:j.useCallback(()=>{window.clearTimeout(y.current),y.current=window.setTimeout(()=>f.current=!0,n)},[n]),isPointerInTransitRef:i,onPointerInTransitChange:j.useCallback(w=>{i.current=w},[]),disableHoverableContent:a,children:u})};FZ.displayName=zZ;var zx="Tooltip",[cpe,XE]=WE(zx),BZ=e=>{const{__scopeTooltip:t,children:r,open:n,defaultOpen:a,onOpenChange:u,disableHoverableContent:f,delayDuration:i}=e,y=wj(zx,e.__scopeTooltip),w=ZE(t),[T,A]=j.useState(null),k=qw(),F=j.useRef(0),D=f??y.disableHoverableContent,O=i??y.delayDuration,N=j.useRef(!1),[V,H]=DZ({prop:n,defaultProp:a??!1,onChange:ie=>{ie?(y.onOpen(),document.dispatchEvent(new CustomEvent(AO))):y.onClose(),u==null||u(ie)},caller:zx}),Z=j.useMemo(()=>V?N.current?"delayed-open":"instant-open":"closed",[V]),J=j.useCallback(()=>{window.clearTimeout(F.current),F.current=0,N.current=!1,H(!0)},[H]),G=j.useCallback(()=>{window.clearTimeout(F.current),F.current=0,H(!1)},[H]),Y=j.useCallback(()=>{window.clearTimeout(F.current),F.current=window.setTimeout(()=>{N.current=!0,H(!0),F.current=0},O)},[O,H]);return j.useEffect(()=>()=>{F.current&&(window.clearTimeout(F.current),F.current=0)},[]),b.jsx(Wfe,{...w,children:b.jsx(cpe,{scope:t,contentId:k,open:V,stateAttribute:Z,trigger:T,onTriggerChange:A,onTriggerEnter:j.useCallback(()=>{y.isOpenDelayedRef.current?Y():J()},[y.isOpenDelayedRef,Y,J]),onTriggerLeave:j.useCallback(()=>{D?G():(window.clearTimeout(F.current),F.current=0)},[G,D]),onOpen:J,onClose:G,disableHoverableContent:D,children:r})})};BZ.displayName=zx;var PO="TooltipTrigger",$Z=j.forwardRef((e,t)=>{const{__scopeTooltip:r,...n}=e,a=XE(PO,r),u=wj(PO,r),f=ZE(r),i=j.useRef(null),y=Qu(t,i,a.onTriggerChange),w=j.useRef(!1),T=j.useRef(!1),A=j.useCallback(()=>w.current=!1,[]);return j.useEffect(()=>()=>document.removeEventListener("pointerup",A),[A]),b.jsx(Zfe,{asChild:!0,...f,children:b.jsx(Tc.button,{"aria-describedby":a.open?a.contentId:void 0,"data-state":a.stateAttribute,...n,ref:y,onPointerMove:_c(e.onPointerMove,k=>{k.pointerType!=="touch"&&!T.current&&!u.isPointerInTransitRef.current&&(a.onTriggerEnter(),T.current=!0)}),onPointerLeave:_c(e.onPointerLeave,()=>{a.onTriggerLeave(),T.current=!1}),onPointerDown:_c(e.onPointerDown,()=>{a.open&&a.onClose(),w.current=!0,document.addEventListener("pointerup",A,{once:!0})}),onFocus:_c(e.onFocus,()=>{w.current||a.onOpen()}),onBlur:_c(e.onBlur,a.onClose),onClick:_c(e.onClick,a.onClose)})})});$Z.displayName=PO;var upe="TooltipPortal",[OFe,dpe]=WE(upe,{forceMount:void 0}),Qv="TooltipContent",VZ=j.forwardRef((e,t)=>{const r=dpe(Qv,e.__scopeTooltip),{forceMount:n=r.forceMount,side:a="top",...u}=e,f=XE(Qv,e.__scopeTooltip);return b.jsx(zb,{present:n||f.open,children:f.disableHoverableContent?b.jsx(UZ,{side:a,...u,ref:t}):b.jsx(hpe,{side:a,...u,ref:t})})}),hpe=j.forwardRef((e,t)=>{const r=XE(Qv,e.__scopeTooltip),n=wj(Qv,e.__scopeTooltip),a=j.useRef(null),u=Qu(t,a),[f,i]=j.useState(null),{trigger:y,onClose:w}=r,T=a.current,{onPointerInTransitChange:A}=n,k=j.useCallback(()=>{i(null),A(!1)},[A]),F=j.useCallback((D,O)=>{const N=D.currentTarget,V={x:D.clientX,y:D.clientY},H=gpe(V,N.getBoundingClientRect()),Z=ype(V,H),J=vpe(O.getBoundingClientRect()),G=xpe([...Z,...J]);i(G),A(!0)},[A]);return j.useEffect(()=>()=>k(),[k]),j.useEffect(()=>{if(y&&T){const D=N=>F(N,T),O=N=>F(N,y);return y.addEventListener("pointerleave",D),T.addEventListener("pointerleave",O),()=>{y.removeEventListener("pointerleave",D),T.removeEventListener("pointerleave",O)}}},[y,T,F,k]),j.useEffect(()=>{if(f){const D=O=>{const N=O.target,V={x:O.clientX,y:O.clientY},H=(y==null?void 0:y.contains(N))||(T==null?void 0:T.contains(N)),Z=!_pe(V,f);H?k():Z&&(k(),w())};return document.addEventListener("pointermove",D),()=>document.removeEventListener("pointermove",D)}},[y,T,f,w,k]),b.jsx(UZ,{...e,ref:u})}),[fpe,ppe]=WE(zx,{isInside:!1}),mpe=The("TooltipContent"),UZ=j.forwardRef((e,t)=>{const{__scopeTooltip:r,children:n,"aria-label":a,onEscapeKeyDown:u,onPointerDownOutside:f,...i}=e,y=XE(Qv,r),w=ZE(r),{onClose:T}=y;return j.useEffect(()=>(document.addEventListener(AO,T),()=>document.removeEventListener(AO,T)),[T]),j.useEffect(()=>{if(y.trigger){const A=k=>{const F=k.target;F!=null&&F.contains(y.trigger)&&T()};return window.addEventListener("scroll",A,{capture:!0}),()=>window.removeEventListener("scroll",A,{capture:!0})}},[y.trigger,T]),b.jsx(hj,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:u,onPointerDownOutside:f,onFocusOutside:A=>A.preventDefault(),onDismiss:T,children:b.jsxs(Xfe,{"data-state":y.stateAttribute,...w,...i,ref:t,style:{...i.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[b.jsx(mpe,{children:n}),b.jsx(fpe,{scope:r,isInside:!0,children:b.jsx(ope,{id:y.contentId,role:"tooltip",children:a||n})})]})})});VZ.displayName=Qv;var qZ="TooltipArrow",GZ=j.forwardRef((e,t)=>{const{__scopeTooltip:r,...n}=e,a=ZE(r);return ppe(qZ,r).isInside?null:b.jsx(Kfe,{...a,...n,ref:t})});GZ.displayName=qZ;function gpe(e,t){const r=Math.abs(t.top-e.y),n=Math.abs(t.bottom-e.y),a=Math.abs(t.right-e.x),u=Math.abs(t.left-e.x);switch(Math.min(r,n,a,u)){case u:return"left";case a:return"right";case r:return"top";case n:return"bottom";default:throw new Error("unreachable")}}function ype(e,t,r=5){const n=[];switch(t){case"top":n.push({x:e.x-r,y:e.y+r},{x:e.x+r,y:e.y+r});break;case"bottom":n.push({x:e.x-r,y:e.y-r},{x:e.x+r,y:e.y-r});break;case"left":n.push({x:e.x+r,y:e.y-r},{x:e.x+r,y:e.y+r});break;case"right":n.push({x:e.x-r,y:e.y-r},{x:e.x-r,y:e.y+r});break}return n}function vpe(e){const{top:t,right:r,bottom:n,left:a}=e;return[{x:a,y:t},{x:r,y:t},{x:r,y:n},{x:a,y:n}]}function _pe(e,t){const{x:r,y:n}=e;let a=!1;for(let u=0,f=t.length-1;u<t.length;f=u++){const i=t[u],y=t[f],w=i.x,T=i.y,A=y.x,k=y.y;T>n!=k>n&&r<(A-w)*(n-T)/(k-T)+w&&(a=!a)}return a}function xpe(e){const t=e.slice();return t.sort((r,n)=>r.x<n.x?-1:r.x>n.x?1:r.y<n.y?-1:r.y>n.y?1:0),bpe(t)}function bpe(e){if(e.length<=1)return e.slice();const t=[];for(let n=0;n<e.length;n++){const a=e[n];for(;t.length>=2;){const u=t[t.length-1],f=t[t.length-2];if((u.x-f.x)*(a.y-f.y)>=(u.y-f.y)*(a.x-f.x))t.pop();else break}t.push(a)}t.pop();const r=[];for(let n=e.length-1;n>=0;n--){const a=e[n];for(;r.length>=2;){const u=r[r.length-1],f=r[r.length-2];if((u.x-f.x)*(a.y-f.y)>=(u.y-f.y)*(a.x-f.x))r.pop();else break}r.push(a)}return r.pop(),t.length===1&&r.length===1&&t[0].x===r[0].x&&t[0].y===r[0].y?t:t.concat(r)}var wpe=FZ,Spe=BZ,Epe=$Z,Tpe=VZ,Cpe=GZ;const Ape=wpe,Cm=({children:e,content:t,side:r="top",delay:n=300})=>b.jsx(Ape,{delayDuration:n,children:b.jsxs(Spe,{children:[b.jsx(Epe,{asChild:!0,children:e}),b.jsxs(Tpe,{side:r,sideOffset:5,className:Ec("z-50 rounded-md bg-gray-900 px-3 py-1.5 text-xs text-white shadow-md animate-fade-in-out"),children:[t,b.jsx(Cpe,{className:"fill-gray-900"})]})]})});function Fx(e){"@babel/helpers - typeof";return Fx=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fx(e)}function Ppe(e,t){if(Fx(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Fx(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Mpe(e){var t=Ppe(e,"string");return Fx(t)=="symbol"?t:t+""}function Sr(e,t,r){return(t=Mpe(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function HZ(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var OC,$4;function Ipe(){if($4)return OC;$4=1;var e=function(r,n,a,u,f,i,y,w){if(!r){var T;if(n===void 0)T=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var A=[a,u,f,i,y,w],k=0;T=new Error(n.replace(/%s/g,function(){return A[k++]})),T.name="Invariant Violation"}throw T.framesToPop=1,T}};return OC=e,OC}var kpe=Ipe(),xa=HZ(kpe),Ri=j.createContext(null);function Ope(){xa(!!j.useContext,"useGoogleMap is React hook and requires React version 16.8+");var e=j.useContext(Ri);return xa(!!e,"useGoogleMap needs a GoogleMap available up in the tree"),e}function Lpe(e,t,r){return Object.keys(e).reduce(function(a,u){return t(a,e[u],u)},r)}function Rpe(e,t){Object.keys(e).forEach(r=>t(e[r],r))}function jpe(e,t,r,n){var a={},u=(f,i)=>{var y=r[i];y!==t[i]&&(a[i]=y,f(n,y))};return Rpe(e,u),a}function Dpe(e,t,r){var n=Lpe(r,function(u,f,i){return typeof e[i]=="function"&&u.push(google.maps.event.addListener(t,f,e[i])),u},[]);return n}function Npe(e){google.maps.event.removeListener(e)}function Qi(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];e.forEach(Npe)}function Xi(e){var{updaterMap:t,eventMap:r,prevProps:n,nextProps:a,instance:u}=e,f=Dpe(a,u,r);return jpe(t,n,a,u),f}function zpe(e){var{children:t,options:r,id:n,mapContainerStyle:a,mapContainerClassName:u,center:f,onClick:i,onDblClick:y,onDrag:w,onDragEnd:T,onDragStart:A,onMouseMove:k,onMouseOut:F,onMouseOver:D,onMouseDown:O,onMouseUp:N,onRightClick:V,onCenterChanged:H,onLoad:Z,onUnmount:J}=e,[G,Y]=j.useState(null),ie=j.useRef(null),[ce,ge]=j.useState(null),[be,xe]=j.useState(null),[Le,ze]=j.useState(null),[Xe,Je]=j.useState(null),[tt,st]=j.useState(null),[Ne,We]=j.useState(null),[Ue,De]=j.useState(null),[Ke,lt]=j.useState(null),[Ye,Ve]=j.useState(null),[Et,kt]=j.useState(null),[Wt,Tt]=j.useState(null),[Ht,ur]=j.useState(null);return j.useEffect(()=>{r&&G!==null&&G.setOptions(r)},[G,r]),j.useEffect(()=>{G!==null&&typeof f<"u"&&G.setCenter(f)},[G,f]),j.useEffect(()=>{G&&y&&(be!==null&&google.maps.event.removeListener(be),xe(google.maps.event.addListener(G,"dblclick",y)))},[y]),j.useEffect(()=>{G&&T&&(Le!==null&&google.maps.event.removeListener(Le),ze(google.maps.event.addListener(G,"dragend",T)))},[T]),j.useEffect(()=>{G&&A&&(Xe!==null&&google.maps.event.removeListener(Xe),Je(google.maps.event.addListener(G,"dragstart",A)))},[A]),j.useEffect(()=>{G&&O&&(tt!==null&&google.maps.event.removeListener(tt),st(google.maps.event.addListener(G,"mousedown",O)))},[O]),j.useEffect(()=>{G&&k&&(Ne!==null&&google.maps.event.removeListener(Ne),We(google.maps.event.addListener(G,"mousemove",k)))},[k]),j.useEffect(()=>{G&&F&&(Ue!==null&&google.maps.event.removeListener(Ue),De(google.maps.event.addListener(G,"mouseout",F)))},[F]),j.useEffect(()=>{G&&D&&(Ke!==null&&google.maps.event.removeListener(Ke),lt(google.maps.event.addListener(G,"mouseover",D)))},[D]),j.useEffect(()=>{G&&N&&(Ye!==null&&google.maps.event.removeListener(Ye),Ve(google.maps.event.addListener(G,"mouseup",N)))},[N]),j.useEffect(()=>{G&&V&&(Et!==null&&google.maps.event.removeListener(Et),kt(google.maps.event.addListener(G,"rightclick",V)))},[V]),j.useEffect(()=>{G&&i&&(Wt!==null&&google.maps.event.removeListener(Wt),Tt(google.maps.event.addListener(G,"click",i)))},[i]),j.useEffect(()=>{G&&w&&(Ht!==null&&google.maps.event.removeListener(Ht),ur(google.maps.event.addListener(G,"drag",w)))},[w]),j.useEffect(()=>{G&&H&&(ce!==null&&google.maps.event.removeListener(ce),ge(google.maps.event.addListener(G,"center_changed",H)))},[i]),j.useEffect(()=>{var Jt=ie.current===null?null:new google.maps.Map(ie.current,r);return Y(Jt),Jt!==null&&Z&&Z(Jt),()=>{Jt!==null&&J&&J(Jt)}},[]),b.jsx("div",{id:n,ref:ie,style:a,className:u,children:b.jsx(Ri.Provider,{value:G,children:G!==null?t:null})})}j.memo(zpe);function V4(e,t,r,n,a,u,f){try{var i=e[u](f),y=i.value}catch(w){return void r(w)}i.done?t(y):Promise.resolve(y).then(n,a)}function WZ(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var u=e.apply(t,r);function f(y){V4(u,n,a,f,i,"next",y)}function i(y){V4(u,n,a,f,i,"throw",y)}f(void 0)})}}function ZZ(e){var{googleMapsApiKey:t,googleMapsClientId:r,version:n="weekly",language:a,region:u,libraries:f,channel:i,mapIds:y,authReferrerPolicy:w,apiUrl:T="https://maps.googleapis.com"}=e,A=[];return xa(t&&r||!(t&&r),"You need to specify either googleMapsApiKey or googleMapsClientId for @react-google-maps/api load script to work. You cannot use both at the same time."),t?A.push("key=".concat(t)):r&&A.push("client=".concat(r)),n&&A.push("v=".concat(n)),a&&A.push("language=".concat(a)),u&&A.push("region=".concat(u)),f&&f.length&&A.push("libraries=".concat(f.sort().join(","))),i&&A.push("channel=".concat(i)),y&&y.length&&A.push("map_ids=".concat(y.join(","))),w&&A.push("auth_referrer_policy=".concat(w)),A.push("loading=async"),A.push("callback=initMap"),"".concat(T,"/maps/api/js?").concat(A.join("&"))}var jm=typeof document<"u";function XZ(e){var{url:t,id:r,nonce:n}=e;return jm?new Promise(function(u,f){var i=document.getElementById(r),y=window;if(i){var w=i.getAttribute("data-state");if(i.src===t&&w!=="error"){if(w==="ready")return u(r);var T=y.initMap,A=i.onerror;y.initMap=function(){T&&T(),u(r)},i.onerror=function(F){A&&A(F),f(F)};return}else i.remove()}var k=document.createElement("script");k.type="text/javascript",k.src=t,k.id=r,k.async=!0,k.nonce=n||"",k.onerror=function(D){k.setAttribute("data-state","error"),f(D)},y.initMap=function(){k.setAttribute("data-state","ready"),u(r)},document.head.appendChild(k)}).catch(a=>{throw console.error("injectScript error: ",a),a}):Promise.reject(new Error("document is undefined"))}function U4(e){var t=e.href;return t&&(t.indexOf("https://fonts.googleapis.com/css?family=Roboto")===0||t.indexOf("https://fonts.googleapis.com/css?family=Google+Sans+Text")===0)?!0:e.tagName.toLowerCase()==="style"&&e.styleSheet&&e.styleSheet.cssText&&e.styleSheet.cssText.replace(`\r
`,"").indexOf(".gm-style")===0?(e.styleSheet.cssText="",!0):e.tagName.toLowerCase()==="style"&&e.innerHTML&&e.innerHTML.replace(`\r
`,"").indexOf(".gm-style")===0?(e.innerHTML="",!0):e.tagName.toLowerCase()==="style"&&!e.styleSheet&&!e.innerHTML}function Sj(){var e=document.getElementsByTagName("head")[0];if(e){var t=e.insertBefore.bind(e);e.insertBefore=function(a,u){return U4(a)||Reflect.apply(t,e,[a,u]),a};var r=e.appendChild.bind(e);e.appendChild=function(a){return U4(a)||Reflect.apply(r,e,[a]),a}}}var z0=!1;function KZ(){return b.jsx("div",{children:"Loading..."})}var Bx={id:"script-loader",version:"weekly"};class Fpe extends j.PureComponent{constructor(){super(...arguments),Sr(this,"check",null),Sr(this,"state",{loaded:!1}),Sr(this,"cleanupCallback",()=>{delete window.google.maps,this.injectScript()}),Sr(this,"isCleaningUp",WZ(function*(){function t(r){if(!z0)r();else if(jm)var n=window.setInterval(function(){z0||(window.clearInterval(n),r())},1)}return new Promise(t)})),Sr(this,"cleanup",()=>{z0=!0;var t=document.getElementById(this.props.id);t&&t.parentNode&&t.parentNode.removeChild(t),Array.prototype.slice.call(document.getElementsByTagName("script")).filter(function(n){return typeof n.src=="string"&&n.src.includes("maps.googleapis")}).forEach(function(n){n.parentNode&&n.parentNode.removeChild(n)}),Array.prototype.slice.call(document.getElementsByTagName("link")).filter(function(n){return n.href==="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Google+Sans"}).forEach(function(n){n.parentNode&&n.parentNode.removeChild(n)}),Array.prototype.slice.call(document.getElementsByTagName("style")).filter(function(n){return n.innerText!==void 0&&n.innerText.length>0&&n.innerText.includes(".gm-")}).forEach(function(n){n.parentNode&&n.parentNode.removeChild(n)})}),Sr(this,"injectScript",()=>{this.props.preventGoogleFontsLoading&&Sj(),xa(!!this.props.id,'LoadScript requires "id" prop to be a string: %s',this.props.id);var t={id:this.props.id,nonce:this.props.nonce,url:ZZ(this.props)};XZ(t).then(()=>{this.props.onLoad&&this.props.onLoad(),this.setState(function(){return{loaded:!0}})}).catch(r=>{this.props.onError&&this.props.onError(r),console.error(`
          There has been an Error with loading Google Maps API script, please check that you provided correct google API key (`.concat(this.props.googleMapsApiKey||"-",") or Client ID (").concat(this.props.googleMapsClientId||"-",`) to <LoadScript />
          Otherwise it is a Network issue.
        `))})}),Sr(this,"getRef",t=>{this.check=t})}componentDidMount(){if(jm){if(window.google&&window.google.maps&&!z0){console.error("google api is already presented");return}this.isCleaningUp().then(this.injectScript).catch(function(r){console.error("Error at injecting script after cleaning up: ",r)})}}componentDidUpdate(t){this.props.libraries!==t.libraries&&console.warn("Performance warning! LoadScript has been reloaded unintentionally! You should not pass `libraries` prop as new array. Please keep an array of libraries as static class property for Components and PureComponents, or just a const variable outside of component, or somewhere in config files or ENV variables"),jm&&t.language!==this.props.language&&(this.cleanup(),this.setState(function(){return{loaded:!1}},this.cleanupCallback))}componentWillUnmount(){if(jm){this.cleanup();var t=()=>{this.check||(delete window.google,z0=!1)};window.setTimeout(t,1),this.props.onUnmount&&this.props.onUnmount()}}render(){return b.jsxs(b.Fragment,{children:[b.jsx("div",{ref:this.getRef}),this.state.loaded?this.props.children:this.props.loadingElement||b.jsx(KZ,{})]})}}Sr(Fpe,"defaultProps",Bx);function Bpe(e,t){if(e==null)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(t.includes(n))continue;r[n]=e[n]}return r}function Ej(e,t){if(e==null)return{};var r,n,a=Bpe(e,t);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(n=0;n<u.length;n++)r=u[n],t.includes(r)||{}.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var q4;function $pe(e){var{id:t=Bx.id,version:r=Bx.version,nonce:n,googleMapsApiKey:a,googleMapsClientId:u,language:f,region:i,libraries:y,preventGoogleFontsLoading:w,channel:T,mapIds:A,authReferrerPolicy:k,apiUrl:F="https://maps.googleapis.com"}=e,D=j.useRef(!1),[O,N]=j.useState(!1),[V,H]=j.useState(void 0);j.useEffect(function(){return D.current=!0,()=>{D.current=!1}},[]),j.useEffect(function(){jm&&w&&Sj()},[w]),j.useEffect(function(){O&&xa(!!window.google,"useLoadScript was marked as loaded, but window.google is not present. Something went wrong.")},[O]);var Z=ZZ({version:r,googleMapsApiKey:a,googleMapsClientId:u,language:f,region:i,libraries:y,channel:T,mapIds:A,authReferrerPolicy:k,apiUrl:F});j.useEffect(function(){if(!jm)return;function Y(){D.current&&(N(!0),q4=Z)}if(window.google&&window.google.maps&&q4===Z){Y();return}XZ({id:t,url:Z,nonce:n}).then(Y).catch(function(ce){D.current&&H(ce),console.warn(`
        There has been an Error with loading Google Maps API script, please check that you provided correct google API key (`.concat(a||"-",") or Client ID (").concat(u||"-",`)
        Otherwise it is a Network issue.
      `)),console.error(ce)})},[t,Z,n]);var J=j.useRef(void 0);return j.useEffect(function(){J.current&&y!==J.current&&console.warn("Performance warning! LoadScript has been reloaded unintentionally! You should not pass `libraries` prop as new array. Please keep an array of libraries as static class property for Components and PureComponents, or just a const variable outside of component, or somewhere in config files or ENV variables"),J.current=y},[y]),{isLoaded:O,loadError:V,url:Z}}var Vpe=["loadingElement","onLoad","onError","onUnmount","children"],Upe=b.jsx(KZ,{});function qpe(e){var{loadingElement:t,onLoad:r,onError:n,onUnmount:a,children:u}=e,f=Ej(e,Vpe),{isLoaded:i,loadError:y}=$pe(f);return j.useEffect(function(){i&&typeof r=="function"&&r()},[i,r]),j.useEffect(function(){y&&typeof n=="function"&&n(y)},[y,n]),j.useEffect(function(){return()=>{a&&a()}},[a]),i?u:t||Upe}j.memo(qpe);function Gpe(e,t,r,n){function a(u){return u instanceof r?u:new r(function(f){f(u)})}return new(r||(r=Promise))(function(u,f){function i(T){try{w(n.next(T))}catch(A){f(A)}}function y(T){try{w(n.throw(T))}catch(A){f(A)}}function w(T){T.done?u(T.value):a(T.value).then(i,y)}w((n=n.apply(e,[])).next())})}function Hpe(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Wpe=function e(t,r){if(t===r)return!0;if(t&&r&&typeof t=="object"&&typeof r=="object"){if(t.constructor!==r.constructor)return!1;var n,a,u;if(Array.isArray(t)){if(n=t.length,n!=r.length)return!1;for(a=n;a--!==0;)if(!e(t[a],r[a]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if(u=Object.keys(t),n=u.length,n!==Object.keys(r).length)return!1;for(a=n;a--!==0;)if(!Object.prototype.hasOwnProperty.call(r,u[a]))return!1;for(a=n;a--!==0;){var f=u[a];if(!e(t[f],r[f]))return!1}return!0}return t!==t&&r!==r},Zpe=Hpe(Wpe),G4="__googleMapsScriptId",Ov;(function(e){e[e.INITIALIZED=0]="INITIALIZED",e[e.LOADING=1]="LOADING",e[e.SUCCESS=2]="SUCCESS",e[e.FAILURE=3]="FAILURE"})(Ov||(Ov={}));let Xpe=class Tv{constructor(t){var{apiKey:r,authReferrerPolicy:n,channel:a,client:u,id:f=G4,language:i,libraries:y=[],mapIds:w,nonce:T,region:A,retries:k=3,url:F="https://maps.googleapis.com/maps/api/js",version:D}=t;if(this.callbacks=[],this.done=!1,this.loading=!1,this.errors=[],this.apiKey=r,this.authReferrerPolicy=n,this.channel=a,this.client=u,this.id=f||G4,this.language=i,this.libraries=y,this.mapIds=w,this.nonce=T,this.region=A,this.retries=k,this.url=F,this.version=D,Tv.instance){if(!Zpe(this.options,Tv.instance.options))throw new Error("Loader must not be called again with different options. ".concat(JSON.stringify(this.options)," !== ").concat(JSON.stringify(Tv.instance.options)));return Tv.instance}Tv.instance=this}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url,authReferrerPolicy:this.authReferrerPolicy}}get status(){return this.errors.length?Ov.FAILURE:this.done?Ov.SUCCESS:this.loading?Ov.LOADING:Ov.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}createUrl(){var t=this.url;return t+="?callback=__googleMapsCallback&loading=async",this.apiKey&&(t+="&key=".concat(this.apiKey)),this.channel&&(t+="&channel=".concat(this.channel)),this.client&&(t+="&client=".concat(this.client)),this.libraries.length>0&&(t+="&libraries=".concat(this.libraries.join(","))),this.language&&(t+="&language=".concat(this.language)),this.region&&(t+="&region=".concat(this.region)),this.version&&(t+="&v=".concat(this.version)),this.mapIds&&(t+="&map_ids=".concat(this.mapIds.join(","))),this.authReferrerPolicy&&(t+="&auth_referrer_policy=".concat(this.authReferrerPolicy)),t}deleteScript(){var t=document.getElementById(this.id);t&&t.remove()}load(){return this.loadPromise()}loadPromise(){return new Promise((t,r)=>{this.loadCallback(n=>{n?r(n.error):t(window.google)})})}importLibrary(t){return this.execute(),google.maps.importLibrary(t)}loadCallback(t){this.callbacks.push(t),this.execute()}setScript(){var t,r;if(document.getElementById(this.id)){this.callback();return}var n={key:this.apiKey,channel:this.channel,client:this.client,libraries:this.libraries.length&&this.libraries,v:this.version,mapIds:this.mapIds,language:this.language,region:this.region,authReferrerPolicy:this.authReferrerPolicy};Object.keys(n).forEach(u=>!n[u]&&delete n[u]),!((r=(t=window==null?void 0:window.google)===null||t===void 0?void 0:t.maps)===null||r===void 0)&&r.importLibrary||(u=>{var f,i,y,w="The Google Maps JavaScript API",T="google",A="importLibrary",k="__ib__",F=document,D=window;D=D[T]||(D[T]={});var O=D.maps||(D.maps={}),N=new Set,V=new URLSearchParams,H=()=>f||(f=new Promise((Z,J)=>Gpe(this,void 0,void 0,function*(){var G;yield i=F.createElement("script"),i.id=this.id,V.set("libraries",[...N]+"");for(y in u)V.set(y.replace(/[A-Z]/g,Y=>"_"+Y[0].toLowerCase()),u[y]);V.set("callback",T+".maps."+k),i.src=this.url+"?"+V,O[k]=Z,i.onerror=()=>f=J(Error(w+" could not load.")),i.nonce=this.nonce||((G=F.querySelector("script[nonce]"))===null||G===void 0?void 0:G.nonce)||"",F.head.append(i)})));O[A]?console.warn(w+" only loads once. Ignoring:",u):O[A]=function(Z){for(var J=arguments.length,G=new Array(J>1?J-1:0),Y=1;Y<J;Y++)G[Y-1]=arguments[Y];return N.add(Z)&&H().then(()=>O[A](Z,...G))}})(n);var a=this.libraries.map(u=>this.importLibrary(u));a.length||a.push(this.importLibrary("core")),Promise.all(a).then(()=>this.callback(),u=>{var f=new ErrorEvent("error",{error:u});this.loadErrorCallback(f)})}reset(){this.deleteScript(),this.done=!1,this.loading=!1,this.errors=[],this.onerrorEvent=null}resetIfRetryingFailed(){this.failed&&this.reset()}loadErrorCallback(t){if(this.errors.push(t),this.errors.length<=this.retries){var r=this.errors.length*Math.pow(2,this.errors.length);console.error("Failed to load Google Maps script, retrying in ".concat(r," ms.")),setTimeout(()=>{this.deleteScript(),this.setScript()},r)}else this.onerrorEvent=t,this.callback()}callback(){this.done=!0,this.loading=!1,this.callbacks.forEach(t=>{t(this.onerrorEvent)}),this.callbacks=[]}execute(){if(this.resetIfRetryingFailed(),!this.loading)if(this.done)this.callback();else{if(window.google&&window.google.maps&&window.google.maps.version){console.warn("Google Maps already loaded outside @googlemaps/js-api-loader. This may result in undesirable behavior as options and script parameters may not match."),this.callback();return}this.loading=!0,this.setScript()}}};var Kpe=["maps"];function Ype(e){var{id:t=Bx.id,version:r=Bx.version,nonce:n,googleMapsApiKey:a,language:u,region:f,libraries:i=Kpe,preventGoogleFontsLoading:y,mapIds:w,authReferrerPolicy:T}=e,A=j.useRef(!1),[k,F]=j.useState(!1),[D,O]=j.useState(void 0);j.useEffect(function(){return A.current=!0,()=>{A.current=!1}},[]);var N=j.useMemo(()=>new Xpe({id:t,apiKey:a,version:r,libraries:i,language:u||"en",region:f||"US",mapIds:w||[],nonce:n||"",authReferrerPolicy:T||"origin"}),[t,a,r,i,u,f,w,n,T]);j.useEffect(function(){k||N.load().then(()=>{A.current&&F(!0)}).catch(Z=>{O(Z)})},[]),j.useEffect(()=>{jm&&y&&Sj()},[y]);var V=j.useRef();return j.useEffect(()=>{V.current&&i!==V.current&&console.warn("Performance warning! LoadScript has been reloaded unintentionally! You should not pass `libraries` prop as new array. Please keep an array of libraries as static class property for Components and PureComponents, or just a const variable outside of component, or somewhere in config files or ENV variables"),V.current=i},[i]),{isLoaded:k,loadError:D}}function H4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function gS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?H4(Object(r),!0).forEach(function(n){Sr(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var W4={},Z4={options(e,t){e.setOptions(t)}};function Jpe(e){var{options:t,onLoad:r,onUnmount:n}=e,a=j.useContext(Ri),[u,f]=j.useState(null);return j.useEffect(()=>{u!==null&&u.setMap(a)},[a]),j.useEffect(()=>{t&&u!==null&&u.setOptions(t)},[u,t]),j.useEffect(()=>{var i=new google.maps.TrafficLayer(gS(gS({},t),{},{map:a}));return f(i),r&&r(i),()=>{u!==null&&(n&&n(u),u.setMap(null))}},[]),null}j.memo(Jpe);class Qpe extends j.PureComponent{constructor(){super(...arguments),Sr(this,"state",{trafficLayer:null}),Sr(this,"setTrafficLayerCallback",()=>{this.state.trafficLayer!==null&&this.props.onLoad&&this.props.onLoad(this.state.trafficLayer)}),Sr(this,"registeredEvents",[])}componentDidMount(){var t=new google.maps.TrafficLayer(gS(gS({},this.props.options),{},{map:this.context}));this.registeredEvents=Xi({updaterMap:Z4,eventMap:W4,prevProps:{},nextProps:this.props,instance:t}),this.setState(function(){return{trafficLayer:t}},this.setTrafficLayerCallback)}componentDidUpdate(t){this.state.trafficLayer!==null&&(Qi(this.registeredEvents),this.registeredEvents=Xi({updaterMap:Z4,eventMap:W4,prevProps:t,nextProps:this.props,instance:this.state.trafficLayer}))}componentWillUnmount(){this.state.trafficLayer!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.trafficLayer),Qi(this.registeredEvents),this.state.trafficLayer.setMap(null))}render(){return null}}Sr(Qpe,"contextType",Ri);function eme(e){var{onLoad:t,onUnmount:r}=e,n=j.useContext(Ri),[a,u]=j.useState(null);return j.useEffect(()=>{a!==null&&a.setMap(n)},[n]),j.useEffect(()=>{var f=new google.maps.BicyclingLayer;return u(f),f.setMap(n),t&&t(f),()=>{f!==null&&(r&&r(f),f.setMap(null))}},[]),null}j.memo(eme);class tme extends j.PureComponent{constructor(){super(...arguments),Sr(this,"state",{bicyclingLayer:null}),Sr(this,"setBicyclingLayerCallback",()=>{this.state.bicyclingLayer!==null&&(this.state.bicyclingLayer.setMap(this.context),this.props.onLoad&&this.props.onLoad(this.state.bicyclingLayer))})}componentDidMount(){var t=new google.maps.BicyclingLayer;this.setState(()=>({bicyclingLayer:t}),this.setBicyclingLayerCallback)}componentWillUnmount(){this.state.bicyclingLayer!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.bicyclingLayer),this.state.bicyclingLayer.setMap(null))}render(){return null}}Sr(tme,"contextType",Ri);function rme(e){var{onLoad:t,onUnmount:r}=e,n=j.useContext(Ri),[a,u]=j.useState(null);return j.useEffect(()=>{a!==null&&a.setMap(n)},[n]),j.useEffect(()=>{var f=new google.maps.TransitLayer;return u(f),f.setMap(n),t&&t(f),()=>{a!==null&&(r&&r(a),a.setMap(null))}},[]),null}j.memo(rme);class nme extends j.PureComponent{constructor(){super(...arguments),Sr(this,"state",{transitLayer:null}),Sr(this,"setTransitLayerCallback",()=>{this.state.transitLayer!==null&&(this.state.transitLayer.setMap(this.context),this.props.onLoad&&this.props.onLoad(this.state.transitLayer))})}componentDidMount(){var t=new google.maps.TransitLayer;this.setState(function(){return{transitLayer:t}},this.setTransitLayerCallback)}componentWillUnmount(){this.state.transitLayer!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.transitLayer),this.state.transitLayer.setMap(null))}render(){return null}}Sr(nme,"contextType",Ri);function X4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function yS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?X4(Object(r),!0).forEach(function(n){Sr(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):X4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var K4={onCircleComplete:"circlecomplete",onMarkerComplete:"markercomplete",onOverlayComplete:"overlaycomplete",onPolygonComplete:"polygoncomplete",onPolylineComplete:"polylinecomplete",onRectangleComplete:"rectanglecomplete"},Y4={drawingMode(e,t){e.setDrawingMode(t)},options(e,t){e.setOptions(t)}};function ime(e){var{options:t,drawingMode:r,onCircleComplete:n,onMarkerComplete:a,onOverlayComplete:u,onPolygonComplete:f,onPolylineComplete:i,onRectangleComplete:y,onLoad:w,onUnmount:T}=e,A=j.useContext(Ri),[k,F]=j.useState(null),[D,O]=j.useState(null),[N,V]=j.useState(null),[H,Z]=j.useState(null),[J,G]=j.useState(null),[Y,ie]=j.useState(null),[ce,ge]=j.useState(null);return j.useEffect(()=>{k!==null&&k.setMap(A)},[A]),j.useEffect(()=>{t&&k!==null&&k.setOptions(t)},[k,t]),j.useEffect(()=>{k!==null&&k.setDrawingMode(r??null)},[k,r]),j.useEffect(()=>{k&&n&&(D!==null&&google.maps.event.removeListener(D),O(google.maps.event.addListener(k,"circlecomplete",n)))},[k,n]),j.useEffect(()=>{k&&a&&(N!==null&&google.maps.event.removeListener(N),V(google.maps.event.addListener(k,"markercomplete",a)))},[k,a]),j.useEffect(()=>{k&&u&&(H!==null&&google.maps.event.removeListener(H),Z(google.maps.event.addListener(k,"overlaycomplete",u)))},[k,u]),j.useEffect(()=>{k&&f&&(J!==null&&google.maps.event.removeListener(J),G(google.maps.event.addListener(k,"polygoncomplete",f)))},[k,f]),j.useEffect(()=>{k&&i&&(Y!==null&&google.maps.event.removeListener(Y),ie(google.maps.event.addListener(k,"polylinecomplete",i)))},[k,i]),j.useEffect(()=>{k&&y&&(ce!==null&&google.maps.event.removeListener(ce),ge(google.maps.event.addListener(k,"rectanglecomplete",y)))},[k,y]),j.useEffect(()=>{xa(!!google.maps.drawing,"Did you include prop libraries={['drawing']} in the URL? %s",google.maps.drawing);var be=new google.maps.drawing.DrawingManager(yS(yS({},t),{},{map:A}));return r&&be.setDrawingMode(r),n&&O(google.maps.event.addListener(be,"circlecomplete",n)),a&&V(google.maps.event.addListener(be,"markercomplete",a)),u&&Z(google.maps.event.addListener(be,"overlaycomplete",u)),f&&G(google.maps.event.addListener(be,"polygoncomplete",f)),i&&ie(google.maps.event.addListener(be,"polylinecomplete",i)),y&&ge(google.maps.event.addListener(be,"rectanglecomplete",y)),F(be),w&&w(be),()=>{k!==null&&(D&&google.maps.event.removeListener(D),N&&google.maps.event.removeListener(N),H&&google.maps.event.removeListener(H),J&&google.maps.event.removeListener(J),Y&&google.maps.event.removeListener(Y),ce&&google.maps.event.removeListener(ce),T&&T(k),k.setMap(null))}},[]),null}j.memo(ime);class sme extends j.PureComponent{constructor(t){super(t),Sr(this,"registeredEvents",[]),Sr(this,"state",{drawingManager:null}),Sr(this,"setDrawingManagerCallback",()=>{this.state.drawingManager!==null&&this.props.onLoad&&this.props.onLoad(this.state.drawingManager)}),xa(!!google.maps.drawing,"Did you include prop libraries={['drawing']} in the URL? %s",google.maps.drawing)}componentDidMount(){var t=new google.maps.drawing.DrawingManager(yS(yS({},this.props.options),{},{map:this.context}));this.registeredEvents=Xi({updaterMap:Y4,eventMap:K4,prevProps:{},nextProps:this.props,instance:t}),this.setState(function(){return{drawingManager:t}},this.setDrawingManagerCallback)}componentDidUpdate(t){this.state.drawingManager!==null&&(Qi(this.registeredEvents),this.registeredEvents=Xi({updaterMap:Y4,eventMap:K4,prevProps:t,nextProps:this.props,instance:this.state.drawingManager}))}componentWillUnmount(){this.state.drawingManager!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.drawingManager),Qi(this.registeredEvents),this.state.drawingManager.setMap(null))}render(){return null}}Sr(sme,"contextType",Ri);function J4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function $v(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?J4(Object(r),!0).forEach(function(n){Sr(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Q4={onAnimationChanged:"animation_changed",onClick:"click",onClickableChanged:"clickable_changed",onCursorChanged:"cursor_changed",onDblClick:"dblclick",onDrag:"drag",onDragEnd:"dragend",onDraggableChanged:"draggable_changed",onDragStart:"dragstart",onFlatChanged:"flat_changed",onIconChanged:"icon_changed",onMouseDown:"mousedown",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onPositionChanged:"position_changed",onRightClick:"rightclick",onShapeChanged:"shape_changed",onTitleChanged:"title_changed",onVisibleChanged:"visible_changed",onZindexChanged:"zindex_changed"},e5={animation(e,t){e.setAnimation(t)},clickable(e,t){e.setClickable(t)},cursor(e,t){e.setCursor(t)},draggable(e,t){e.setDraggable(t)},icon(e,t){e.setIcon(t)},label(e,t){e.setLabel(t)},map(e,t){e.setMap(t)},opacity(e,t){e.setOpacity(t)},options(e,t){e.setOptions(t)},position(e,t){e.setPosition(t)},shape(e,t){e.setShape(t)},title(e,t){e.setTitle(t)},visible(e,t){e.setVisible(t)},zIndex(e,t){e.setZIndex(t)}},vS={};function ome(e){var{position:t,options:r,clusterer:n,noClustererRedraw:a,children:u,draggable:f,visible:i,animation:y,clickable:w,cursor:T,icon:A,label:k,opacity:F,shape:D,title:O,zIndex:N,onClick:V,onDblClick:H,onDrag:Z,onDragEnd:J,onDragStart:G,onMouseOut:Y,onMouseOver:ie,onMouseUp:ce,onMouseDown:ge,onRightClick:be,onClickableChanged:xe,onCursorChanged:Le,onAnimationChanged:ze,onDraggableChanged:Xe,onFlatChanged:Je,onIconChanged:tt,onPositionChanged:st,onShapeChanged:Ne,onTitleChanged:We,onVisibleChanged:Ue,onZindexChanged:De,onLoad:Ke,onUnmount:lt}=e,Ye=j.useContext(Ri),[Ve,Et]=j.useState(null),[kt,Wt]=j.useState(null),[Tt,Ht]=j.useState(null),[ur,Jt]=j.useState(null),[Rt,Dt]=j.useState(null),[sr,mr]=j.useState(null),[Vr,rn]=j.useState(null),[$r,Yr]=j.useState(null),[un,Fn]=j.useState(null),[vi,xr]=j.useState(null),[Hr,wn]=j.useState(null),[xi,ms]=j.useState(null),[Ui,js]=j.useState(null),[es,Uo]=j.useState(null),[Ys,Js]=j.useState(null),[bo,wo]=j.useState(null),[So,Jn]=j.useState(null),[Ds,Io]=j.useState(null),[_s,uo]=j.useState(null),[qo,oa]=j.useState(null),[Qt,Hs]=j.useState(null),[Go,dt]=j.useState(null);j.useEffect(()=>{Ve!==null&&Ve.setMap(Ye)},[Ye]),j.useEffect(()=>{typeof r<"u"&&Ve!==null&&Ve.setOptions(r)},[Ve,r]),j.useEffect(()=>{typeof f<"u"&&Ve!==null&&Ve.setDraggable(f)},[Ve,f]),j.useEffect(()=>{t&&Ve!==null&&Ve.setPosition(t)},[Ve,t]),j.useEffect(()=>{typeof i<"u"&&Ve!==null&&Ve.setVisible(i)},[Ve,i]),j.useEffect(()=>{Ve==null||Ve.setAnimation(y)},[Ve,y]),j.useEffect(()=>{Ve&&w!==void 0&&Ve.setClickable(w)},[Ve,w]),j.useEffect(()=>{Ve&&T!==void 0&&Ve.setCursor(T)},[Ve,T]),j.useEffect(()=>{Ve&&A!==void 0&&Ve.setIcon(A)},[Ve,A]),j.useEffect(()=>{Ve&&k!==void 0&&Ve.setLabel(k)},[Ve,k]),j.useEffect(()=>{Ve&&F!==void 0&&Ve.setOpacity(F)},[Ve,F]),j.useEffect(()=>{Ve&&D!==void 0&&Ve.setShape(D)},[Ve,D]),j.useEffect(()=>{Ve&&O!==void 0&&Ve.setTitle(O)},[Ve,O]),j.useEffect(()=>{Ve&&N!==void 0&&Ve.setZIndex(N)},[Ve,N]),j.useEffect(()=>{Ve&&H&&(kt!==null&&google.maps.event.removeListener(kt),Wt(google.maps.event.addListener(Ve,"dblclick",H)))},[H]),j.useEffect(()=>{Ve&&J&&(Tt!==null&&google.maps.event.removeListener(Tt),Ht(google.maps.event.addListener(Ve,"dragend",J)))},[J]),j.useEffect(()=>{Ve&&G&&(ur!==null&&google.maps.event.removeListener(ur),Jt(google.maps.event.addListener(Ve,"dragstart",G)))},[G]),j.useEffect(()=>{Ve&&ge&&(Rt!==null&&google.maps.event.removeListener(Rt),Dt(google.maps.event.addListener(Ve,"mousedown",ge)))},[ge]),j.useEffect(()=>{Ve&&Y&&(sr!==null&&google.maps.event.removeListener(sr),mr(google.maps.event.addListener(Ve,"mouseout",Y)))},[Y]),j.useEffect(()=>{Ve&&ie&&(Vr!==null&&google.maps.event.removeListener(Vr),rn(google.maps.event.addListener(Ve,"mouseover",ie)))},[ie]),j.useEffect(()=>{Ve&&ce&&($r!==null&&google.maps.event.removeListener($r),Yr(google.maps.event.addListener(Ve,"mouseup",ce)))},[ce]),j.useEffect(()=>{Ve&&be&&(un!==null&&google.maps.event.removeListener(un),Fn(google.maps.event.addListener(Ve,"rightclick",be)))},[be]),j.useEffect(()=>{Ve&&V&&(vi!==null&&google.maps.event.removeListener(vi),xr(google.maps.event.addListener(Ve,"click",V)))},[V]),j.useEffect(()=>{Ve&&Z&&(Hr!==null&&google.maps.event.removeListener(Hr),wn(google.maps.event.addListener(Ve,"drag",Z)))},[Z]),j.useEffect(()=>{Ve&&xe&&(xi!==null&&google.maps.event.removeListener(xi),ms(google.maps.event.addListener(Ve,"clickable_changed",xe)))},[xe]),j.useEffect(()=>{Ve&&Le&&(Ui!==null&&google.maps.event.removeListener(Ui),js(google.maps.event.addListener(Ve,"cursor_changed",Le)))},[Le]),j.useEffect(()=>{Ve&&ze&&(es!==null&&google.maps.event.removeListener(es),Uo(google.maps.event.addListener(Ve,"animation_changed",ze)))},[ze]),j.useEffect(()=>{Ve&&Xe&&(Ys!==null&&google.maps.event.removeListener(Ys),Js(google.maps.event.addListener(Ve,"draggable_changed",Xe)))},[Xe]),j.useEffect(()=>{Ve&&Je&&(bo!==null&&google.maps.event.removeListener(bo),wo(google.maps.event.addListener(Ve,"flat_changed",Je)))},[Je]),j.useEffect(()=>{Ve&&tt&&(So!==null&&google.maps.event.removeListener(So),Jn(google.maps.event.addListener(Ve,"icon_changed",tt)))},[tt]),j.useEffect(()=>{Ve&&st&&(Ds!==null&&google.maps.event.removeListener(Ds),Io(google.maps.event.addListener(Ve,"position_changed",st)))},[st]),j.useEffect(()=>{Ve&&Ne&&(_s!==null&&google.maps.event.removeListener(_s),uo(google.maps.event.addListener(Ve,"shape_changed",Ne)))},[Ne]),j.useEffect(()=>{Ve&&We&&(qo!==null&&google.maps.event.removeListener(qo),oa(google.maps.event.addListener(Ve,"title_changed",We)))},[We]),j.useEffect(()=>{Ve&&Ue&&(Qt!==null&&google.maps.event.removeListener(Qt),Hs(google.maps.event.addListener(Ve,"visible_changed",Ue)))},[Ue]),j.useEffect(()=>{Ve&&De&&(Go!==null&&google.maps.event.removeListener(Go),dt(google.maps.event.addListener(Ve,"zindex_changed",De)))},[De]),j.useEffect(()=>{var oe=$v($v($v({},r||vS),n?vS:{map:Ye}),{},{position:t}),pe=new google.maps.Marker(oe);return n?n.addMarker(pe,!!a):pe.setMap(Ye),t&&pe.setPosition(t),typeof i<"u"&&pe.setVisible(i),typeof f<"u"&&pe.setDraggable(f),typeof w<"u"&&pe.setClickable(w),typeof T=="string"&&pe.setCursor(T),A&&pe.setIcon(A),typeof k<"u"&&pe.setLabel(k),typeof F<"u"&&pe.setOpacity(F),D&&pe.setShape(D),typeof O=="string"&&pe.setTitle(O),typeof N=="number"&&pe.setZIndex(N),H&&Wt(google.maps.event.addListener(pe,"dblclick",H)),J&&Ht(google.maps.event.addListener(pe,"dragend",J)),G&&Jt(google.maps.event.addListener(pe,"dragstart",G)),ge&&Dt(google.maps.event.addListener(pe,"mousedown",ge)),Y&&mr(google.maps.event.addListener(pe,"mouseout",Y)),ie&&rn(google.maps.event.addListener(pe,"mouseover",ie)),ce&&Yr(google.maps.event.addListener(pe,"mouseup",ce)),be&&Fn(google.maps.event.addListener(pe,"rightclick",be)),V&&xr(google.maps.event.addListener(pe,"click",V)),Z&&wn(google.maps.event.addListener(pe,"drag",Z)),xe&&ms(google.maps.event.addListener(pe,"clickable_changed",xe)),Le&&js(google.maps.event.addListener(pe,"cursor_changed",Le)),ze&&Uo(google.maps.event.addListener(pe,"animation_changed",ze)),Xe&&Js(google.maps.event.addListener(pe,"draggable_changed",Xe)),Je&&wo(google.maps.event.addListener(pe,"flat_changed",Je)),tt&&Jn(google.maps.event.addListener(pe,"icon_changed",tt)),st&&Io(google.maps.event.addListener(pe,"position_changed",st)),Ne&&uo(google.maps.event.addListener(pe,"shape_changed",Ne)),We&&oa(google.maps.event.addListener(pe,"title_changed",We)),Ue&&Hs(google.maps.event.addListener(pe,"visible_changed",Ue)),De&&dt(google.maps.event.addListener(pe,"zindex_changed",De)),Et(pe),Ke&&Ke(pe),()=>{kt!==null&&google.maps.event.removeListener(kt),Tt!==null&&google.maps.event.removeListener(Tt),ur!==null&&google.maps.event.removeListener(ur),Rt!==null&&google.maps.event.removeListener(Rt),sr!==null&&google.maps.event.removeListener(sr),Vr!==null&&google.maps.event.removeListener(Vr),$r!==null&&google.maps.event.removeListener($r),un!==null&&google.maps.event.removeListener(un),vi!==null&&google.maps.event.removeListener(vi),xi!==null&&google.maps.event.removeListener(xi),Ui!==null&&google.maps.event.removeListener(Ui),es!==null&&google.maps.event.removeListener(es),Ys!==null&&google.maps.event.removeListener(Ys),bo!==null&&google.maps.event.removeListener(bo),So!==null&&google.maps.event.removeListener(So),Ds!==null&&google.maps.event.removeListener(Ds),qo!==null&&google.maps.event.removeListener(qo),Qt!==null&&google.maps.event.removeListener(Qt),Go!==null&&google.maps.event.removeListener(Go),lt&&lt(pe),n?n.removeMarker(pe,!!a):pe&&pe.setMap(null)}},[]);var ae=j.useMemo(()=>u?j.Children.map(u,oe=>{if(!j.isValidElement(oe))return oe;var pe=oe;return j.cloneElement(pe,{anchor:Ve})}):null,[u,Ve]);return b.jsx(b.Fragment,{children:ae})||null}j.memo(ome);class ame extends j.PureComponent{constructor(){super(...arguments),Sr(this,"registeredEvents",[])}componentDidMount(){var t=this;return WZ(function*(){var r=$v($v($v({},t.props.options||vS),t.props.clusterer?vS:{map:t.context}),{},{position:t.props.position});t.marker=new google.maps.Marker(r),t.props.clusterer?t.props.clusterer.addMarker(t.marker,!!t.props.noClustererRedraw):t.marker.setMap(t.context),t.registeredEvents=Xi({updaterMap:e5,eventMap:Q4,prevProps:{},nextProps:t.props,instance:t.marker}),t.props.onLoad&&t.props.onLoad(t.marker)})()}componentDidUpdate(t){this.marker&&(Qi(this.registeredEvents),this.registeredEvents=Xi({updaterMap:e5,eventMap:Q4,prevProps:t,nextProps:this.props,instance:this.marker}))}componentWillUnmount(){this.marker&&(this.props.onUnmount&&this.props.onUnmount(this.marker),Qi(this.registeredEvents),this.props.clusterer?this.props.clusterer.removeMarker(this.marker,!!this.props.noClustererRedraw):this.marker&&this.marker.setMap(null))}render(){var t=this.props.children?j.Children.map(this.props.children,r=>{if(!j.isValidElement(r))return r;var n=r;return j.cloneElement(n,{anchor:this.marker})}):null;return t||null}}Sr(ame,"contextType",Ri);var lme=function(){function e(t,r){t.getClusterer().extend(e,google.maps.OverlayView),this.cluster=t,this.clusterClassName=this.cluster.getClusterer().getClusterClass(),this.className=this.clusterClassName,this.styles=r,this.center=void 0,this.div=null,this.sums=null,this.visible=!1,this.boundsChangedListener=null,this.url="",this.height=0,this.width=0,this.anchorText=[0,0],this.anchorIcon=[0,0],this.textColor="black",this.textSize=11,this.textDecoration="none",this.fontWeight="bold",this.fontStyle="normal",this.fontFamily="Arial,sans-serif",this.backgroundPosition="0 0",this.cMouseDownInCluster=null,this.cDraggingMapByCluster=null,this.timeOut=null,this.setMap(t.getMap()),this.onBoundsChanged=this.onBoundsChanged.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onClick=this.onClick.bind(this),this.onMouseOver=this.onMouseOver.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onAdd=this.onAdd.bind(this),this.onRemove=this.onRemove.bind(this),this.draw=this.draw.bind(this),this.hide=this.hide.bind(this),this.show=this.show.bind(this),this.useStyle=this.useStyle.bind(this),this.setCenter=this.setCenter.bind(this),this.getPosFromLatLng=this.getPosFromLatLng.bind(this)}return e.prototype.onBoundsChanged=function(){this.cDraggingMapByCluster=this.cMouseDownInCluster},e.prototype.onMouseDown=function(){this.cMouseDownInCluster=!0,this.cDraggingMapByCluster=!1},e.prototype.onClick=function(t){if(this.cMouseDownInCluster=!1,!this.cDraggingMapByCluster){var r=this.cluster.getClusterer();if(google.maps.event.trigger(r,"click",this.cluster),google.maps.event.trigger(r,"clusterclick",this.cluster),r.getZoomOnClick()){var n=r.getMaxZoom(),a=this.cluster.getBounds(),u=r.getMap();u!==null&&"fitBounds"in u&&u.fitBounds(a),this.timeOut=window.setTimeout(function(){var f=r.getMap();if(f!==null){"fitBounds"in f&&f.fitBounds(a);var i=f.getZoom()||0;n!==null&&i>n&&f.setZoom(n+1)}},100)}t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation()}},e.prototype.onMouseOver=function(){google.maps.event.trigger(this.cluster.getClusterer(),"mouseover",this.cluster)},e.prototype.onMouseOut=function(){google.maps.event.trigger(this.cluster.getClusterer(),"mouseout",this.cluster)},e.prototype.onAdd=function(){var t;this.div=document.createElement("div"),this.div.className=this.className,this.visible&&this.show(),(t=this.getPanes())===null||t===void 0||t.overlayMouseTarget.appendChild(this.div);var r=this.getMap();r!==null&&(this.boundsChangedListener=google.maps.event.addListener(r,"bounds_changed",this.onBoundsChanged),this.div.addEventListener("mousedown",this.onMouseDown),this.div.addEventListener("click",this.onClick),this.div.addEventListener("mouseover",this.onMouseOver),this.div.addEventListener("mouseout",this.onMouseOut))},e.prototype.onRemove=function(){this.div&&this.div.parentNode&&(this.hide(),this.boundsChangedListener!==null&&google.maps.event.removeListener(this.boundsChangedListener),this.div.removeEventListener("mousedown",this.onMouseDown),this.div.removeEventListener("click",this.onClick),this.div.removeEventListener("mouseover",this.onMouseOver),this.div.removeEventListener("mouseout",this.onMouseOut),this.div.parentNode.removeChild(this.div),this.timeOut!==null&&(window.clearTimeout(this.timeOut),this.timeOut=null),this.div=null)},e.prototype.draw=function(){if(this.visible&&this.div!==null&&this.center){var t=this.getPosFromLatLng(this.center);this.div.style.top=t!==null?"".concat(t.y,"px"):"0",this.div.style.left=t!==null?"".concat(t.x,"px"):"0"}},e.prototype.hide=function(){this.div&&(this.div.style.display="none"),this.visible=!1},e.prototype.show=function(){var t,r,n,a,u,f;if(this.div&&this.center){var i=this.sums===null||typeof this.sums.title>"u"||this.sums.title===""?this.cluster.getClusterer().getTitle():this.sums.title,y=this.backgroundPosition.split(" "),w=parseInt(((t=y[0])===null||t===void 0?void 0:t.replace(/^\s+|\s+$/g,""))||"0",10),T=parseInt(((r=y[1])===null||r===void 0?void 0:r.replace(/^\s+|\s+$/g,""))||"0",10),A=this.getPosFromLatLng(this.center);this.div.className=this.className,this.div.setAttribute("style","cursor: pointer; position: absolute; top: ".concat(A!==null?"".concat(A.y,"px"):"0","; left: ").concat(A!==null?"".concat(A.x,"px"):"0","; width: ").concat(this.width,"px; height: ").concat(this.height,"px; "));var k=document.createElement("img");k.alt=i,k.src=this.url,k.width=this.width,k.height=this.height,k.setAttribute("style","position: absolute; top: ".concat(T,"px; left: ").concat(w,"px")),this.cluster.getClusterer().enableRetinaIcons||(k.style.clip="rect(-".concat(T,"px, -").concat(w+this.width,"px, -").concat(T+this.height,", -").concat(w,")"));var F=document.createElement("div");F.setAttribute("style","position: absolute; top: ".concat(this.anchorText[0],"px; left: ").concat(this.anchorText[1],"px; color: ").concat(this.textColor,"; font-size: ").concat(this.textSize,"px; font-family: ").concat(this.fontFamily,"; font-weight: ").concat(this.fontWeight,"; fontStyle: ").concat(this.fontStyle,"; text-decoration: ").concat(this.textDecoration,"; text-align: center; width: ").concat(this.width,"px; line-height: ").concat(this.height,"px")),!((n=this.sums)===null||n===void 0)&&n.text&&(F.innerText="".concat((a=this.sums)===null||a===void 0?void 0:a.text)),!((u=this.sums)===null||u===void 0)&&u.html&&(F.innerHTML="".concat((f=this.sums)===null||f===void 0?void 0:f.html)),this.div.innerHTML="",this.div.appendChild(k),this.div.appendChild(F),this.div.title=i,this.div.style.display=""}this.visible=!0},e.prototype.useStyle=function(t){this.sums=t;var r=this.cluster.getClusterer().getStyles(),n=r[Math.min(r.length-1,Math.max(0,t.index-1))];n&&(this.url=n.url,this.height=n.height,this.width=n.width,n.className&&(this.className="".concat(this.clusterClassName," ").concat(n.className)),this.anchorText=n.anchorText||[0,0],this.anchorIcon=n.anchorIcon||[this.height/2,this.width/2],this.textColor=n.textColor||"black",this.textSize=n.textSize||11,this.textDecoration=n.textDecoration||"none",this.fontWeight=n.fontWeight||"bold",this.fontStyle=n.fontStyle||"normal",this.fontFamily=n.fontFamily||"Arial,sans-serif",this.backgroundPosition=n.backgroundPosition||"0 0")},e.prototype.setCenter=function(t){this.center=t},e.prototype.getPosFromLatLng=function(t){var r=this.getProjection().fromLatLngToDivPixel(t);return r!==null&&(r.x-=this.anchorIcon[1],r.y-=this.anchorIcon[0]),r},e}(),cme=function(){function e(t){this.markerClusterer=t,this.map=this.markerClusterer.getMap(),this.gridSize=this.markerClusterer.getGridSize(),this.minClusterSize=this.markerClusterer.getMinimumClusterSize(),this.averageCenter=this.markerClusterer.getAverageCenter(),this.markers=[],this.center=void 0,this.bounds=null,this.clusterIcon=new lme(this,this.markerClusterer.getStyles()),this.getSize=this.getSize.bind(this),this.getMarkers=this.getMarkers.bind(this),this.getCenter=this.getCenter.bind(this),this.getMap=this.getMap.bind(this),this.getClusterer=this.getClusterer.bind(this),this.getBounds=this.getBounds.bind(this),this.remove=this.remove.bind(this),this.addMarker=this.addMarker.bind(this),this.isMarkerInClusterBounds=this.isMarkerInClusterBounds.bind(this),this.calculateBounds=this.calculateBounds.bind(this),this.updateIcon=this.updateIcon.bind(this),this.isMarkerAlreadyAdded=this.isMarkerAlreadyAdded.bind(this)}return e.prototype.getSize=function(){return this.markers.length},e.prototype.getMarkers=function(){return this.markers},e.prototype.getCenter=function(){return this.center},e.prototype.getMap=function(){return this.map},e.prototype.getClusterer=function(){return this.markerClusterer},e.prototype.getBounds=function(){for(var t=new google.maps.LatLngBounds(this.center,this.center),r=this.getMarkers(),n=0,a=r;n<a.length;n++){var u=a[n],f=u.getPosition();f&&t.extend(f)}return t},e.prototype.remove=function(){this.clusterIcon.setMap(null),this.markers=[],delete this.markers},e.prototype.addMarker=function(t){var r;if(this.isMarkerAlreadyAdded(t))return!1;if(this.center){if(this.averageCenter){var n=t.getPosition();if(n){var a=this.markers.length+1;this.center=new google.maps.LatLng((this.center.lat()*(a-1)+n.lat())/a,(this.center.lng()*(a-1)+n.lng())/a),this.calculateBounds()}}}else{var n=t.getPosition();n&&(this.center=n,this.calculateBounds())}t.isAdded=!0,this.markers.push(t);var u=this.markers.length,f=this.markerClusterer.getMaxZoom(),i=(r=this.map)===null||r===void 0?void 0:r.getZoom();if(f!==null&&typeof i<"u"&&i>f)t.getMap()!==this.map&&t.setMap(this.map);else if(u<this.minClusterSize)t.getMap()!==this.map&&t.setMap(this.map);else if(u===this.minClusterSize)for(var y=0,w=this.markers;y<w.length;y++){var T=w[y];T.setMap(null)}else t.setMap(null);return!0},e.prototype.isMarkerInClusterBounds=function(t){if(this.bounds!==null){var r=t.getPosition();if(r)return this.bounds.contains(r)}return!1},e.prototype.calculateBounds=function(){this.bounds=this.markerClusterer.getExtendedBounds(new google.maps.LatLngBounds(this.center,this.center))},e.prototype.updateIcon=function(){var t,r=this.markers.length,n=this.markerClusterer.getMaxZoom(),a=(t=this.map)===null||t===void 0?void 0:t.getZoom();if(n!==null&&typeof a<"u"&&a>n){this.clusterIcon.hide();return}if(r<this.minClusterSize){this.clusterIcon.hide();return}this.center&&this.clusterIcon.setCenter(this.center),this.clusterIcon.useStyle(this.markerClusterer.getCalculator()(this.markers,this.markerClusterer.getStyles().length)),this.clusterIcon.show()},e.prototype.isMarkerAlreadyAdded=function(t){if(this.markers.includes)return this.markers.includes(t);for(var r=0;r<this.markers.length;r++)if(t===this.markers[r])return!0;return!1},e}();function ume(e,t){var r=e.length,n=r.toString().length,a=Math.min(n,t);return{text:r.toString(),index:a,title:""}}var dme=2e3,hme=500,fme="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m",pme="png",mme=[53,56,66,78,90],gme="cluster",YZ=function(){function e(t,r,n){r===void 0&&(r=[]),n===void 0&&(n={}),this.getMinimumClusterSize=this.getMinimumClusterSize.bind(this),this.setMinimumClusterSize=this.setMinimumClusterSize.bind(this),this.getEnableRetinaIcons=this.getEnableRetinaIcons.bind(this),this.setEnableRetinaIcons=this.setEnableRetinaIcons.bind(this),this.addToClosestCluster=this.addToClosestCluster.bind(this),this.getImageExtension=this.getImageExtension.bind(this),this.setImageExtension=this.setImageExtension.bind(this),this.getExtendedBounds=this.getExtendedBounds.bind(this),this.getAverageCenter=this.getAverageCenter.bind(this),this.setAverageCenter=this.setAverageCenter.bind(this),this.getTotalClusters=this.getTotalClusters.bind(this),this.fitMapToMarkers=this.fitMapToMarkers.bind(this),this.getIgnoreHidden=this.getIgnoreHidden.bind(this),this.setIgnoreHidden=this.setIgnoreHidden.bind(this),this.getClusterClass=this.getClusterClass.bind(this),this.setClusterClass=this.setClusterClass.bind(this),this.getTotalMarkers=this.getTotalMarkers.bind(this),this.getZoomOnClick=this.getZoomOnClick.bind(this),this.setZoomOnClick=this.setZoomOnClick.bind(this),this.getBatchSizeIE=this.getBatchSizeIE.bind(this),this.setBatchSizeIE=this.setBatchSizeIE.bind(this),this.createClusters=this.createClusters.bind(this),this.onZoomChanged=this.onZoomChanged.bind(this),this.getImageSizes=this.getImageSizes.bind(this),this.setImageSizes=this.setImageSizes.bind(this),this.getCalculator=this.getCalculator.bind(this),this.setCalculator=this.setCalculator.bind(this),this.removeMarkers=this.removeMarkers.bind(this),this.resetViewport=this.resetViewport.bind(this),this.getImagePath=this.getImagePath.bind(this),this.setImagePath=this.setImagePath.bind(this),this.pushMarkerTo=this.pushMarkerTo.bind(this),this.removeMarker=this.removeMarker.bind(this),this.clearMarkers=this.clearMarkers.bind(this),this.setupStyles=this.setupStyles.bind(this),this.getGridSize=this.getGridSize.bind(this),this.setGridSize=this.setGridSize.bind(this),this.getClusters=this.getClusters.bind(this),this.getMaxZoom=this.getMaxZoom.bind(this),this.setMaxZoom=this.setMaxZoom.bind(this),this.getMarkers=this.getMarkers.bind(this),this.addMarkers=this.addMarkers.bind(this),this.getStyles=this.getStyles.bind(this),this.setStyles=this.setStyles.bind(this),this.addMarker=this.addMarker.bind(this),this.onRemove=this.onRemove.bind(this),this.getTitle=this.getTitle.bind(this),this.setTitle=this.setTitle.bind(this),this.repaint=this.repaint.bind(this),this.onIdle=this.onIdle.bind(this),this.redraw=this.redraw.bind(this),this.onAdd=this.onAdd.bind(this),this.draw=this.draw.bind(this),this.extend=this.extend.bind(this),this.extend(e,google.maps.OverlayView),this.markers=[],this.clusters=[],this.listeners=[],this.activeMap=null,this.ready=!1,this.gridSize=n.gridSize||60,this.minClusterSize=n.minimumClusterSize||2,this.maxZoom=n.maxZoom||null,this.styles=n.styles||[],this.title=n.title||"",this.zoomOnClick=!0,n.zoomOnClick!==void 0&&(this.zoomOnClick=n.zoomOnClick),this.averageCenter=!1,n.averageCenter!==void 0&&(this.averageCenter=n.averageCenter),this.ignoreHidden=!1,n.ignoreHidden!==void 0&&(this.ignoreHidden=n.ignoreHidden),this.enableRetinaIcons=!1,n.enableRetinaIcons!==void 0&&(this.enableRetinaIcons=n.enableRetinaIcons),this.imagePath=n.imagePath||fme,this.imageExtension=n.imageExtension||pme,this.imageSizes=n.imageSizes||mme,this.calculator=n.calculator||ume,this.batchSize=n.batchSize||dme,this.batchSizeIE=n.batchSizeIE||hme,this.clusterClass=n.clusterClass||gme,navigator.userAgent.toLowerCase().indexOf("msie")!==-1&&(this.batchSize=this.batchSizeIE),this.timerRefStatic=null,this.setupStyles(),this.addMarkers(r,!0),this.setMap(t)}return e.prototype.onZoomChanged=function(){var t,r;this.resetViewport(!1),(((t=this.getMap())===null||t===void 0?void 0:t.getZoom())===(this.get("minZoom")||0)||((r=this.getMap())===null||r===void 0?void 0:r.getZoom())===this.get("maxZoom"))&&google.maps.event.trigger(this,"idle")},e.prototype.onIdle=function(){this.redraw()},e.prototype.onAdd=function(){var t=this.getMap();this.activeMap=t,this.ready=!0,this.repaint(),t!==null&&(this.listeners=[google.maps.event.addListener(t,"zoom_changed",this.onZoomChanged),google.maps.event.addListener(t,"idle",this.onIdle)])},e.prototype.onRemove=function(){for(var t=0,r=this.markers;t<r.length;t++){var n=r[t];n.getMap()!==this.activeMap&&n.setMap(this.activeMap)}for(var a=0,u=this.clusters;a<u.length;a++){var f=u[a];f.remove()}this.clusters=[];for(var i=0,y=this.listeners;i<y.length;i++){var w=y[i];google.maps.event.removeListener(w)}this.listeners=[],this.activeMap=null,this.ready=!1},e.prototype.draw=function(){},e.prototype.getMap=function(){return null},e.prototype.getPanes=function(){return null},e.prototype.getProjection=function(){return{fromContainerPixelToLatLng:function(){return null},fromDivPixelToLatLng:function(){return null},fromLatLngToContainerPixel:function(){return null},fromLatLngToDivPixel:function(){return null},getVisibleRegion:function(){return null},getWorldWidth:function(){return 0}}},e.prototype.setMap=function(){},e.prototype.addListener=function(){return{remove:function(){}}},e.prototype.bindTo=function(){},e.prototype.get=function(){},e.prototype.notify=function(){},e.prototype.set=function(){},e.prototype.setValues=function(){},e.prototype.unbind=function(){},e.prototype.unbindAll=function(){},e.prototype.setupStyles=function(){if(!(this.styles.length>0))for(var t=0;t<this.imageSizes.length;t++)this.styles.push({url:"".concat(this.imagePath+(t+1),".").concat(this.imageExtension),height:this.imageSizes[t]||0,width:this.imageSizes[t]||0})},e.prototype.fitMapToMarkers=function(){for(var t=this.getMarkers(),r=new google.maps.LatLngBounds,n=0,a=t;n<a.length;n++){var u=a[n],f=u.getPosition();f&&r.extend(f)}var i=this.getMap();i!==null&&"fitBounds"in i&&i.fitBounds(r)},e.prototype.getGridSize=function(){return this.gridSize},e.prototype.setGridSize=function(t){this.gridSize=t},e.prototype.getMinimumClusterSize=function(){return this.minClusterSize},e.prototype.setMinimumClusterSize=function(t){this.minClusterSize=t},e.prototype.getMaxZoom=function(){return this.maxZoom},e.prototype.setMaxZoom=function(t){this.maxZoom=t},e.prototype.getStyles=function(){return this.styles},e.prototype.setStyles=function(t){this.styles=t},e.prototype.getTitle=function(){return this.title},e.prototype.setTitle=function(t){this.title=t},e.prototype.getZoomOnClick=function(){return this.zoomOnClick},e.prototype.setZoomOnClick=function(t){this.zoomOnClick=t},e.prototype.getAverageCenter=function(){return this.averageCenter},e.prototype.setAverageCenter=function(t){this.averageCenter=t},e.prototype.getIgnoreHidden=function(){return this.ignoreHidden},e.prototype.setIgnoreHidden=function(t){this.ignoreHidden=t},e.prototype.getEnableRetinaIcons=function(){return this.enableRetinaIcons},e.prototype.setEnableRetinaIcons=function(t){this.enableRetinaIcons=t},e.prototype.getImageExtension=function(){return this.imageExtension},e.prototype.setImageExtension=function(t){this.imageExtension=t},e.prototype.getImagePath=function(){return this.imagePath},e.prototype.setImagePath=function(t){this.imagePath=t},e.prototype.getImageSizes=function(){return this.imageSizes},e.prototype.setImageSizes=function(t){this.imageSizes=t},e.prototype.getCalculator=function(){return this.calculator},e.prototype.setCalculator=function(t){this.calculator=t},e.prototype.getBatchSizeIE=function(){return this.batchSizeIE},e.prototype.setBatchSizeIE=function(t){this.batchSizeIE=t},e.prototype.getClusterClass=function(){return this.clusterClass},e.prototype.setClusterClass=function(t){this.clusterClass=t},e.prototype.getMarkers=function(){return this.markers},e.prototype.getTotalMarkers=function(){return this.markers.length},e.prototype.getClusters=function(){return this.clusters},e.prototype.getTotalClusters=function(){return this.clusters.length},e.prototype.addMarker=function(t,r){this.pushMarkerTo(t),r||this.redraw()},e.prototype.addMarkers=function(t,r){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var a=t[n];a&&this.pushMarkerTo(a)}r||this.redraw()},e.prototype.pushMarkerTo=function(t){var r=this;t.getDraggable()&&google.maps.event.addListener(t,"dragend",function(){r.ready&&(t.isAdded=!1,r.repaint())}),t.isAdded=!1,this.markers.push(t)},e.prototype.removeMarker_=function(t){var r=-1;if(this.markers.indexOf)r=this.markers.indexOf(t);else for(var n=0;n<this.markers.length;n++)if(t===this.markers[n]){r=n;break}return r===-1?!1:(t.setMap(null),this.markers.splice(r,1),!0)},e.prototype.removeMarker=function(t,r){var n=this.removeMarker_(t);return!r&&n&&this.repaint(),n},e.prototype.removeMarkers=function(t,r){for(var n=!1,a=0,u=t;a<u.length;a++){var f=u[a];n=n||this.removeMarker_(f)}return!r&&n&&this.repaint(),n},e.prototype.clearMarkers=function(){this.resetViewport(!0),this.markers=[]},e.prototype.repaint=function(){var t=this.clusters.slice();this.clusters=[],this.resetViewport(!1),this.redraw(),setTimeout(function(){for(var n=0,a=t;n<a.length;n++){var u=a[n];u.remove()}},0)},e.prototype.getExtendedBounds=function(t){var r=this.getProjection(),n=r.fromLatLngToDivPixel(new google.maps.LatLng(t.getNorthEast().lat(),t.getNorthEast().lng()));n!==null&&(n.x+=this.gridSize,n.y-=this.gridSize);var a=r.fromLatLngToDivPixel(new google.maps.LatLng(t.getSouthWest().lat(),t.getSouthWest().lng()));if(a!==null&&(a.x-=this.gridSize,a.y+=this.gridSize),n!==null){var u=r.fromDivPixelToLatLng(n);u!==null&&t.extend(u)}if(a!==null){var f=r.fromDivPixelToLatLng(a);f!==null&&t.extend(f)}return t},e.prototype.redraw=function(){this.createClusters(0)},e.prototype.resetViewport=function(t){for(var r=0,n=this.clusters;r<n.length;r++){var a=n[r];a.remove()}this.clusters=[];for(var u=0,f=this.markers;u<f.length;u++){var i=f[u];i.isAdded=!1,t&&i.setMap(null)}},e.prototype.distanceBetweenPoints=function(t,r){var n=6371,a=(r.lat()-t.lat())*Math.PI/180,u=(r.lng()-t.lng())*Math.PI/180,f=Math.sin(a/2)*Math.sin(a/2)+Math.cos(t.lat()*Math.PI/180)*Math.cos(r.lat()*Math.PI/180)*Math.sin(u/2)*Math.sin(u/2);return n*(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)))},e.prototype.isMarkerInBounds=function(t,r){var n=t.getPosition();return n?r.contains(n):!1},e.prototype.addToClosestCluster=function(t){for(var r,n=4e4,a=null,u=0,f=this.clusters;u<f.length;u++){var i=f[u];r=i;var y=r.getCenter(),w=t.getPosition();if(y&&w){var T=this.distanceBetweenPoints(y,w);T<n&&(n=T,a=r)}}a&&a.isMarkerInClusterBounds(t)?a.addMarker(t):(r=new cme(this),r.addMarker(t),this.clusters.push(r))},e.prototype.createClusters=function(t){var r=this;if(this.ready){t===0&&(google.maps.event.trigger(this,"clusteringbegin",this),this.timerRefStatic!==null&&(window.clearTimeout(this.timerRefStatic),delete this.timerRefStatic));for(var n=this.getMap(),a=n!==null&&("getBounds"in n)?n.getBounds():null,u=(n==null?void 0:n.getZoom())||0,f=u>3?new google.maps.LatLngBounds(a==null?void 0:a.getSouthWest(),a==null?void 0:a.getNorthEast()):new google.maps.LatLngBounds(new google.maps.LatLng(85.02070771743472,-178.48388434375),new google.maps.LatLng(-85.08136444384544,178.00048865625)),i=this.getExtendedBounds(f),y=Math.min(t+this.batchSize,this.markers.length),w=t;w<y;w++){var T=this.markers[w];T&&!T.isAdded&&this.isMarkerInBounds(T,i)&&(!this.ignoreHidden||this.ignoreHidden&&T.getVisible())&&this.addToClosestCluster(T)}if(y<this.markers.length)this.timerRefStatic=window.setTimeout(function(){r.createClusters(y)},0);else{this.timerRefStatic=null,google.maps.event.trigger(this,"clusteringend",this);for(var A=0,k=this.clusters;A<k.length;A++){var F=k[A];F.updateIcon()}}}},e.prototype.extend=function(t,r){return(function(a){for(var u in a.prototype){var f=u;this.prototype[f]=a.prototype[f]}return this}).apply(t,[r])},e}();function t5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function yme(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?t5(Object(r),!0).forEach(function(n){Sr(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Hu={onClick:"click",onClusteringBegin:"clusteringbegin",onClusteringEnd:"clusteringend",onMouseOut:"mouseout",onMouseOver:"mouseover"},fs={averageCenter(e,t){e.setAverageCenter(t)},batchSizeIE(e,t){e.setBatchSizeIE(t)},calculator(e,t){e.setCalculator(t)},clusterClass(e,t){e.setClusterClass(t)},enableRetinaIcons(e,t){e.setEnableRetinaIcons(t)},gridSize(e,t){e.setGridSize(t)},ignoreHidden(e,t){e.setIgnoreHidden(t)},imageExtension(e,t){e.setImageExtension(t)},imagePath(e,t){e.setImagePath(t)},imageSizes(e,t){e.setImageSizes(t)},maxZoom(e,t){e.setMaxZoom(t)},minimumClusterSize(e,t){e.setMinimumClusterSize(t)},styles(e,t){e.setStyles(t)},title(e,t){e.setTitle(t)},zoomOnClick(e,t){e.setZoomOnClick(t)}},vme={};function _me(e){var{children:t,options:r,averageCenter:n,batchSizeIE:a,calculator:u,clusterClass:f,enableRetinaIcons:i,gridSize:y,ignoreHidden:w,imageExtension:T,imagePath:A,imageSizes:k,maxZoom:F,minimumClusterSize:D,styles:O,title:N,zoomOnClick:V,onClick:H,onClusteringBegin:Z,onClusteringEnd:J,onMouseOver:G,onMouseOut:Y,onLoad:ie,onUnmount:ce}=e,[ge,be]=j.useState(null),xe=j.useContext(Ri),[Le,ze]=j.useState(null),[Xe,Je]=j.useState(null),[tt,st]=j.useState(null),[Ne,We]=j.useState(null),[Ue,De]=j.useState(null);return j.useEffect(()=>{ge&&Y&&(Ne!==null&&google.maps.event.removeListener(Ne),We(google.maps.event.addListener(ge,Hu.onMouseOut,Y)))},[Y]),j.useEffect(()=>{ge&&G&&(Ue!==null&&google.maps.event.removeListener(Ue),De(google.maps.event.addListener(ge,Hu.onMouseOver,G)))},[G]),j.useEffect(()=>{ge&&H&&(Le!==null&&google.maps.event.removeListener(Le),ze(google.maps.event.addListener(ge,Hu.onClick,H)))},[H]),j.useEffect(()=>{ge&&Z&&(Xe!==null&&google.maps.event.removeListener(Xe),Je(google.maps.event.addListener(ge,Hu.onClusteringBegin,Z)))},[Z]),j.useEffect(()=>{ge&&J&&(tt!==null&&google.maps.event.removeListener(tt),Je(google.maps.event.addListener(ge,Hu.onClusteringEnd,J)))},[J]),j.useEffect(()=>{typeof n<"u"&&ge!==null&&fs.averageCenter(ge,n)},[ge,n]),j.useEffect(()=>{typeof a<"u"&&ge!==null&&fs.batchSizeIE(ge,a)},[ge,a]),j.useEffect(()=>{typeof u<"u"&&ge!==null&&fs.calculator(ge,u)},[ge,u]),j.useEffect(()=>{typeof f<"u"&&ge!==null&&fs.clusterClass(ge,f)},[ge,f]),j.useEffect(()=>{typeof i<"u"&&ge!==null&&fs.enableRetinaIcons(ge,i)},[ge,i]),j.useEffect(()=>{typeof y<"u"&&ge!==null&&fs.gridSize(ge,y)},[ge,y]),j.useEffect(()=>{typeof w<"u"&&ge!==null&&fs.ignoreHidden(ge,w)},[ge,w]),j.useEffect(()=>{typeof T<"u"&&ge!==null&&fs.imageExtension(ge,T)},[ge,T]),j.useEffect(()=>{typeof A<"u"&&ge!==null&&fs.imagePath(ge,A)},[ge,A]),j.useEffect(()=>{typeof k<"u"&&ge!==null&&fs.imageSizes(ge,k)},[ge,k]),j.useEffect(()=>{typeof F<"u"&&ge!==null&&fs.maxZoom(ge,F)},[ge,F]),j.useEffect(()=>{typeof D<"u"&&ge!==null&&fs.minimumClusterSize(ge,D)},[ge,D]),j.useEffect(()=>{typeof O<"u"&&ge!==null&&fs.styles(ge,O)},[ge,O]),j.useEffect(()=>{typeof N<"u"&&ge!==null&&fs.title(ge,N)},[ge,N]),j.useEffect(()=>{typeof V<"u"&&ge!==null&&fs.zoomOnClick(ge,V)},[ge,V]),j.useEffect(()=>{if(xe){var Ke=yme({},r||vme),lt=new YZ(xe,[],Ke);return n&&fs.averageCenter(lt,n),a&&fs.batchSizeIE(lt,a),u&&fs.calculator(lt,u),f&&fs.clusterClass(lt,f),i&&fs.enableRetinaIcons(lt,i),y&&fs.gridSize(lt,y),w&&fs.ignoreHidden(lt,w),T&&fs.imageExtension(lt,T),A&&fs.imagePath(lt,A),k&&fs.imageSizes(lt,k),F&&fs.maxZoom(lt,F),D&&fs.minimumClusterSize(lt,D),O&&fs.styles(lt,O),N&&fs.title(lt,N),V&&fs.zoomOnClick(lt,V),Y&&We(google.maps.event.addListener(lt,Hu.onMouseOut,Y)),G&&De(google.maps.event.addListener(lt,Hu.onMouseOver,G)),H&&ze(google.maps.event.addListener(lt,Hu.onClick,H)),Z&&Je(google.maps.event.addListener(lt,Hu.onClusteringBegin,Z)),J&&st(google.maps.event.addListener(lt,Hu.onClusteringEnd,J)),be(lt),ie&&ie(lt),()=>{Ne!==null&&google.maps.event.removeListener(Ne),Ue!==null&&google.maps.event.removeListener(Ue),Le!==null&&google.maps.event.removeListener(Le),Xe!==null&&google.maps.event.removeListener(Xe),tt!==null&&google.maps.event.removeListener(tt),ce&&ce(lt)}}},[]),ge!==null&&t(ge)||null}j.memo(_me);class xme extends j.PureComponent{constructor(){super(...arguments),Sr(this,"registeredEvents",[]),Sr(this,"state",{markerClusterer:null}),Sr(this,"setClustererCallback",()=>{this.state.markerClusterer!==null&&this.props.onLoad&&this.props.onLoad(this.state.markerClusterer)})}componentDidMount(){if(this.context){var t=new YZ(this.context,[],this.props.options);this.registeredEvents=Xi({updaterMap:fs,eventMap:Hu,prevProps:{},nextProps:this.props,instance:t}),this.setState(()=>({markerClusterer:t}),this.setClustererCallback)}}componentDidUpdate(t){this.state.markerClusterer&&(Qi(this.registeredEvents),this.registeredEvents=Xi({updaterMap:fs,eventMap:Hu,prevProps:t,nextProps:this.props,instance:this.state.markerClusterer}))}componentWillUnmount(){this.state.markerClusterer!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.markerClusterer),Qi(this.registeredEvents),this.state.markerClusterer.setMap(null))}render(){return this.state.markerClusterer!==null?this.props.children(this.state.markerClusterer):null}}Sr(xme,"contextType",Ri);function r5(e){e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()}var JZ=function(){function e(t){t===void 0&&(t={}),this.getCloseClickHandler=this.getCloseClickHandler.bind(this),this.closeClickHandler=this.closeClickHandler.bind(this),this.createInfoBoxDiv=this.createInfoBoxDiv.bind(this),this.addClickHandler=this.addClickHandler.bind(this),this.getCloseBoxImg=this.getCloseBoxImg.bind(this),this.getBoxWidths=this.getBoxWidths.bind(this),this.setBoxStyle=this.setBoxStyle.bind(this),this.setPosition=this.setPosition.bind(this),this.getPosition=this.getPosition.bind(this),this.setOptions=this.setOptions.bind(this),this.setContent=this.setContent.bind(this),this.setVisible=this.setVisible.bind(this),this.getContent=this.getContent.bind(this),this.getVisible=this.getVisible.bind(this),this.setZIndex=this.setZIndex.bind(this),this.getZIndex=this.getZIndex.bind(this),this.onRemove=this.onRemove.bind(this),this.panBox=this.panBox.bind(this),this.extend=this.extend.bind(this),this.close=this.close.bind(this),this.draw=this.draw.bind(this),this.show=this.show.bind(this),this.hide=this.hide.bind(this),this.open=this.open.bind(this),this.extend(e,google.maps.OverlayView),this.content=t.content||"",this.disableAutoPan=t.disableAutoPan||!1,this.maxWidth=t.maxWidth||0,this.pixelOffset=t.pixelOffset||new google.maps.Size(0,0),this.position=t.position||new google.maps.LatLng(0,0),this.zIndex=t.zIndex||null,this.boxClass=t.boxClass||"infoBox",this.boxStyle=t.boxStyle||{},this.closeBoxMargin=t.closeBoxMargin||"2px",this.closeBoxURL=t.closeBoxURL||"http://www.google.com/intl/en_us/mapfiles/close.gif",t.closeBoxURL===""&&(this.closeBoxURL=""),this.infoBoxClearance=t.infoBoxClearance||new google.maps.Size(1,1),typeof t.visible>"u"&&(typeof t.isHidden>"u"?t.visible=!0:t.visible=!t.isHidden),this.isHidden=!t.visible,this.alignBottom=t.alignBottom||!1,this.pane=t.pane||"floatPane",this.enableEventPropagation=t.enableEventPropagation||!1,this.div=null,this.closeListener=null,this.moveListener=null,this.mapListener=null,this.contextListener=null,this.eventListeners=null,this.fixedWidthSet=null}return e.prototype.createInfoBoxDiv=function(){var t=this,r=function(T){T.returnValue=!1,T.preventDefault&&T.preventDefault(),t.enableEventPropagation||r5(T)};if(!this.div){this.div=document.createElement("div"),this.setBoxStyle(),typeof this.content=="string"?this.div.innerHTML=this.getCloseBoxImg()+this.content:(this.div.innerHTML=this.getCloseBoxImg(),this.div.appendChild(this.content));var n=this.getPanes();if(n!==null&&n[this.pane].appendChild(this.div),this.addClickHandler(),this.div.style.width)this.fixedWidthSet=!0;else if(this.maxWidth!==0&&this.div.offsetWidth>this.maxWidth)this.div.style.width=this.maxWidth+"px",this.fixedWidthSet=!0;else{var a=this.getBoxWidths();this.div.style.width=this.div.offsetWidth-a.left-a.right+"px",this.fixedWidthSet=!1}if(this.panBox(this.disableAutoPan),!this.enableEventPropagation){this.eventListeners=[];for(var u=["mousedown","mouseover","mouseout","mouseup","click","dblclick","touchstart","touchend","touchmove"],f=0,i=u;f<i.length;f++){var y=i[f];this.eventListeners.push(google.maps.event.addListener(this.div,y,r5))}this.eventListeners.push(google.maps.event.addListener(this.div,"mouseover",function(){t.div&&(t.div.style.cursor="default")}))}this.contextListener=google.maps.event.addListener(this.div,"contextmenu",r),google.maps.event.trigger(this,"domready")}},e.prototype.getCloseBoxImg=function(){var t="";return this.closeBoxURL!==""&&(t='<img alt=""',t+=' aria-hidden="true"',t+=" src='"+this.closeBoxURL+"'",t+=" align=right",t+=" style='",t+=" position: relative;",t+=" cursor: pointer;",t+=" margin: "+this.closeBoxMargin+";",t+="'>"),t},e.prototype.addClickHandler=function(){this.closeListener=this.div&&this.div.firstChild&&this.closeBoxURL!==""?google.maps.event.addListener(this.div.firstChild,"click",this.getCloseClickHandler()):null},e.prototype.closeClickHandler=function(t){t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation(),google.maps.event.trigger(this,"closeclick"),this.close()},e.prototype.getCloseClickHandler=function(){return this.closeClickHandler},e.prototype.panBox=function(t){if(this.div&&!t){var r=this.getMap();if(r instanceof google.maps.Map){var n=0,a=0,u=r.getBounds();u&&!u.contains(this.position)&&r.setCenter(this.position);var f=r.getDiv(),i=f.offsetWidth,y=f.offsetHeight,w=this.pixelOffset.width,T=this.pixelOffset.height,A=this.div.offsetWidth,k=this.div.offsetHeight,F=this.infoBoxClearance.width,D=this.infoBoxClearance.height,O=this.getProjection(),N=O.fromLatLngToContainerPixel(this.position);N!==null&&(N.x<-w+F?n=N.x+w-F:N.x+A+w+F>i&&(n=N.x+A+w+F-i),this.alignBottom?N.y<-T+D+k?a=N.y+T-D-k:N.y+T+D>y&&(a=N.y+T+D-y):N.y<-T+D?a=N.y+T-D:N.y+k+T+D>y&&(a=N.y+k+T+D-y)),n===0&&a===0||r.panBy(n,a)}}},e.prototype.setBoxStyle=function(){if(this.div){this.div.className=this.boxClass,this.div.style.cssText="";var t=this.boxStyle;for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(this.div.style[r]=t[r]);if(this.div.style.webkitTransform="translateZ(0)",typeof this.div.style.opacity<"u"&&this.div.style.opacity!==""){var n=parseFloat(this.div.style.opacity||"");this.div.style.msFilter='"progid:DXImageTransform.Microsoft.Alpha(Opacity='+n*100+')"',this.div.style.filter="alpha(opacity="+n*100+")"}this.div.style.position="absolute",this.div.style.visibility="hidden",this.zIndex!==null&&(this.div.style.zIndex=this.zIndex+""),this.div.style.overflow||(this.div.style.overflow="auto")}},e.prototype.getBoxWidths=function(){var t={top:0,bottom:0,left:0,right:0};if(!this.div)return t;if(document.defaultView){var r=this.div.ownerDocument,n=r&&r.defaultView?r.defaultView.getComputedStyle(this.div,""):null;n&&(t.top=parseInt(n.borderTopWidth||"",10)||0,t.bottom=parseInt(n.borderBottomWidth||"",10)||0,t.left=parseInt(n.borderLeftWidth||"",10)||0,t.right=parseInt(n.borderRightWidth||"",10)||0)}else if(document.documentElement.currentStyle){var a=this.div.currentStyle;a&&(t.top=parseInt(a.borderTopWidth||"",10)||0,t.bottom=parseInt(a.borderBottomWidth||"",10)||0,t.left=parseInt(a.borderLeftWidth||"",10)||0,t.right=parseInt(a.borderRightWidth||"",10)||0)}return t},e.prototype.onRemove=function(){this.div&&this.div.parentNode&&(this.div.parentNode.removeChild(this.div),this.div=null)},e.prototype.draw=function(){if(this.createInfoBoxDiv(),this.div){var t=this.getProjection(),r=t.fromLatLngToDivPixel(this.position);r!==null&&(this.div.style.left=r.x+this.pixelOffset.width+"px",this.alignBottom?this.div.style.bottom=-(r.y+this.pixelOffset.height)+"px":this.div.style.top=r.y+this.pixelOffset.height+"px"),this.isHidden?this.div.style.visibility="hidden":this.div.style.visibility="visible"}},e.prototype.setOptions=function(t){t===void 0&&(t={}),typeof t.boxClass<"u"&&(this.boxClass=t.boxClass,this.setBoxStyle()),typeof t.boxStyle<"u"&&(this.boxStyle=t.boxStyle,this.setBoxStyle()),typeof t.content<"u"&&this.setContent(t.content),typeof t.disableAutoPan<"u"&&(this.disableAutoPan=t.disableAutoPan),typeof t.maxWidth<"u"&&(this.maxWidth=t.maxWidth),typeof t.pixelOffset<"u"&&(this.pixelOffset=t.pixelOffset),typeof t.alignBottom<"u"&&(this.alignBottom=t.alignBottom),typeof t.position<"u"&&this.setPosition(t.position),typeof t.zIndex<"u"&&this.setZIndex(t.zIndex),typeof t.closeBoxMargin<"u"&&(this.closeBoxMargin=t.closeBoxMargin),typeof t.closeBoxURL<"u"&&(this.closeBoxURL=t.closeBoxURL),typeof t.infoBoxClearance<"u"&&(this.infoBoxClearance=t.infoBoxClearance),typeof t.isHidden<"u"&&(this.isHidden=t.isHidden),typeof t.visible<"u"&&(this.isHidden=!t.visible),typeof t.enableEventPropagation<"u"&&(this.enableEventPropagation=t.enableEventPropagation),this.div&&this.draw()},e.prototype.setContent=function(t){this.content=t,this.div&&(this.closeListener&&(google.maps.event.removeListener(this.closeListener),this.closeListener=null),this.fixedWidthSet||(this.div.style.width=""),typeof t=="string"?this.div.innerHTML=this.getCloseBoxImg()+t:(this.div.innerHTML=this.getCloseBoxImg(),this.div.appendChild(t)),this.fixedWidthSet||(this.div.style.width=this.div.offsetWidth+"px",typeof t=="string"?this.div.innerHTML=this.getCloseBoxImg()+t:(this.div.innerHTML=this.getCloseBoxImg(),this.div.appendChild(t))),this.addClickHandler()),google.maps.event.trigger(this,"content_changed")},e.prototype.setPosition=function(t){this.position=t,this.div&&this.draw(),google.maps.event.trigger(this,"position_changed")},e.prototype.setVisible=function(t){this.isHidden=!t,this.div&&(this.div.style.visibility=this.isHidden?"hidden":"visible")},e.prototype.setZIndex=function(t){this.zIndex=t,this.div&&(this.div.style.zIndex=t+""),google.maps.event.trigger(this,"zindex_changed")},e.prototype.getContent=function(){return this.content},e.prototype.getPosition=function(){return this.position},e.prototype.getZIndex=function(){return this.zIndex},e.prototype.getVisible=function(){var t=this.getMap();return typeof t>"u"||t===null?!1:!this.isHidden},e.prototype.show=function(){this.isHidden=!1,this.div&&(this.div.style.visibility="visible")},e.prototype.hide=function(){this.isHidden=!0,this.div&&(this.div.style.visibility="hidden")},e.prototype.open=function(t,r){var n=this;r&&(this.position=r.getPosition(),this.moveListener=google.maps.event.addListener(r,"position_changed",function(){var a=r.getPosition();n.setPosition(a)}),this.mapListener=google.maps.event.addListener(r,"map_changed",function(){n.setMap(r.map)})),this.setMap(t),this.div&&this.panBox()},e.prototype.close=function(){if(this.closeListener&&(google.maps.event.removeListener(this.closeListener),this.closeListener=null),this.eventListeners){for(var t=0,r=this.eventListeners;t<r.length;t++){var n=r[t];google.maps.event.removeListener(n)}this.eventListeners=null}this.moveListener&&(google.maps.event.removeListener(this.moveListener),this.moveListener=null),this.mapListener&&(google.maps.event.removeListener(this.mapListener),this.mapListener=null),this.contextListener&&(google.maps.event.removeListener(this.contextListener),this.contextListener=null),this.setMap(null)},e.prototype.extend=function(t,r){return(function(a){for(var u in a.prototype)Object.prototype.hasOwnProperty.call(this,u)||(this.prototype[u]=a.prototype[u]);return this}).apply(t,[r])},e}(),bme=["position"],wme=["position"];function n5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function _S(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?n5(Object(r),!0).forEach(function(n){Sr(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var i5={onCloseClick:"closeclick",onContentChanged:"content_changed",onDomReady:"domready",onPositionChanged:"position_changed",onZindexChanged:"zindex_changed"},s5={options(e,t){e.setOptions(t)},position(e,t){t instanceof google.maps.LatLng?e.setPosition(t):e.setPosition(new google.maps.LatLng(t.lat,t.lng))},visible(e,t){e.setVisible(t)},zIndex(e,t){e.setZIndex(t)}},Sme={};function Eme(e){var{children:t,anchor:r,options:n,position:a,zIndex:u,onCloseClick:f,onDomReady:i,onContentChanged:y,onPositionChanged:w,onZindexChanged:T,onLoad:A,onUnmount:k}=e,F=j.useContext(Ri),[D,O]=j.useState(null),[N,V]=j.useState(null),[H,Z]=j.useState(null),[J,G]=j.useState(null),[Y,ie]=j.useState(null),[ce,ge]=j.useState(null),be=j.useRef(null);return j.useEffect(()=>{F&&D!==null&&(D.close(),r?D.open(F,r):D.getPosition()&&D.open(F))},[F,D,r]),j.useEffect(()=>{n&&D!==null&&D.setOptions(n)},[D,n]),j.useEffect(()=>{if(a&&D!==null){var xe=a instanceof google.maps.LatLng?a:new google.maps.LatLng(a.lat,a.lng);D.setPosition(xe)}},[a]),j.useEffect(()=>{typeof u=="number"&&D!==null&&D.setZIndex(u)},[u]),j.useEffect(()=>{D&&f&&(N!==null&&google.maps.event.removeListener(N),V(google.maps.event.addListener(D,"closeclick",f)))},[f]),j.useEffect(()=>{D&&i&&(H!==null&&google.maps.event.removeListener(H),Z(google.maps.event.addListener(D,"domready",i)))},[i]),j.useEffect(()=>{D&&y&&(J!==null&&google.maps.event.removeListener(J),G(google.maps.event.addListener(D,"content_changed",y)))},[y]),j.useEffect(()=>{D&&w&&(Y!==null&&google.maps.event.removeListener(Y),ie(google.maps.event.addListener(D,"position_changed",w)))},[w]),j.useEffect(()=>{D&&T&&(ce!==null&&google.maps.event.removeListener(ce),ge(google.maps.event.addListener(D,"zindex_changed",T)))},[T]),j.useEffect(()=>{if(F){var xe=n||Sme,{position:Le}=xe,ze=Ej(xe,bme),Xe;Le&&!(Le instanceof google.maps.LatLng)&&(Xe=new google.maps.LatLng(Le.lat,Le.lng));var Je=new JZ(_S(_S({},ze),Xe?{position:Xe}:{}));be.current=document.createElement("div"),O(Je),f&&V(google.maps.event.addListener(Je,"closeclick",f)),i&&Z(google.maps.event.addListener(Je,"domready",i)),y&&G(google.maps.event.addListener(Je,"content_changed",y)),w&&ie(google.maps.event.addListener(Je,"position_changed",w)),T&&ge(google.maps.event.addListener(Je,"zindex_changed",T)),Je.setContent(be.current),r?Je.open(F,r):Je.getPosition()?Je.open(F):xa(!1,"You must provide either an anchor or a position prop for <InfoBox>."),A&&A(Je)}return()=>{D!==null&&(N&&google.maps.event.removeListener(N),J&&google.maps.event.removeListener(J),H&&google.maps.event.removeListener(H),Y&&google.maps.event.removeListener(Y),ce&&google.maps.event.removeListener(ce),k&&k(D),D.close())}},[]),be.current?Cp.createPortal(j.Children.only(t),be.current):null}j.memo(Eme);class Tme extends j.PureComponent{constructor(){super(...arguments),Sr(this,"registeredEvents",[]),Sr(this,"containerElement",null),Sr(this,"state",{infoBox:null}),Sr(this,"open",(t,r)=>{r?this.context!==null&&t.open(this.context,r):t.getPosition()?this.context!==null&&t.open(this.context):xa(!1,"You must provide either an anchor or a position prop for <InfoBox>.")}),Sr(this,"setInfoBoxCallback",()=>{this.state.infoBox!==null&&this.containerElement!==null&&(this.state.infoBox.setContent(this.containerElement),this.open(this.state.infoBox,this.props.anchor),this.props.onLoad&&this.props.onLoad(this.state.infoBox))})}componentDidMount(){var t=this.props.options||{},{position:r}=t,n=Ej(t,wme),a;r&&!(r instanceof google.maps.LatLng)&&(a=new google.maps.LatLng(r.lat,r.lng));var u=new JZ(_S(_S({},n),a?{position:a}:{}));this.containerElement=document.createElement("div"),this.registeredEvents=Xi({updaterMap:s5,eventMap:i5,prevProps:{},nextProps:this.props,instance:u}),this.setState({infoBox:u},this.setInfoBoxCallback)}componentDidUpdate(t){var{infoBox:r}=this.state;r!==null&&(Qi(this.registeredEvents),this.registeredEvents=Xi({updaterMap:s5,eventMap:i5,prevProps:t,nextProps:this.props,instance:r}))}componentWillUnmount(){var{onUnmount:t}=this.props,{infoBox:r}=this.state;r!==null&&(t&&t(r),Qi(this.registeredEvents),r.close())}render(){return this.containerElement?Cp.createPortal(j.Children.only(this.props.children),this.containerElement):null}}Sr(Tme,"contextType",Ri);var LC,o5;function Cme(){return o5||(o5=1,LC=function e(t,r){if(t===r)return!0;if(t&&r&&typeof t=="object"&&typeof r=="object"){if(t.constructor!==r.constructor)return!1;var n,a,u;if(Array.isArray(t)){if(n=t.length,n!=r.length)return!1;for(a=n;a--!==0;)if(!e(t[a],r[a]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if(u=Object.keys(t),n=u.length,n!==Object.keys(r).length)return!1;for(a=n;a--!==0;)if(!Object.prototype.hasOwnProperty.call(r,u[a]))return!1;for(a=n;a--!==0;){var f=u[a];if(!e(t[f],r[f]))return!1}return!0}return t!==t&&r!==r}),LC}var Ame=Cme(),a5=HZ(Ame),l5=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],RC=1,F0=8;class Tj{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");var[r,n]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");var a=n>>4;if(a!==RC)throw new Error("Got v".concat(a," data when expected v").concat(RC,"."));var u=l5[n&15];if(!u)throw new Error("Unrecognized array type.");var[f]=new Uint16Array(t,2,1),[i]=new Uint32Array(t,4,1);return new Tj(i,f,u,t)}constructor(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:64,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float64Array,a=arguments.length>3?arguments[3]:void 0;if(isNaN(t)||t<0)throw new Error("Unpexpected numItems value: ".concat(t,"."));this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=n,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;var u=l5.indexOf(this.ArrayType),f=t*2*this.ArrayType.BYTES_PER_ELEMENT,i=t*this.IndexArrayType.BYTES_PER_ELEMENT,y=(8-i%8)%8;if(u<0)throw new Error("Unexpected typed array class: ".concat(n,"."));a&&a instanceof ArrayBuffer?(this.data=a,this.ids=new this.IndexArrayType(this.data,F0,t),this.coords=new this.ArrayType(this.data,F0+i+y,t*2),this._pos=t*2,this._finished=!0):(this.data=new ArrayBuffer(F0+f+i+y),this.ids=new this.IndexArrayType(this.data,F0,t),this.coords=new this.ArrayType(this.data,F0+i+y,t*2),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,(RC<<4)+u]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){var n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=t,this.coords[this._pos++]=r,n}finish(){var t=this._pos>>1;if(t!==this.numItems)throw new Error("Added ".concat(t," items when expected ").concat(this.numItems,"."));return MO(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,n,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");for(var{ids:u,coords:f,nodeSize:i}=this,y=[0,u.length-1,0],w=[];y.length;){var T=y.pop()||0,A=y.pop()||0,k=y.pop()||0;if(A-k<=i){for(var F=k;F<=A;F++){var D=f[2*F],O=f[2*F+1];D>=t&&D<=n&&O>=r&&O<=a&&w.push(u[F])}continue}var N=k+A>>1,V=f[2*N],H=f[2*N+1];V>=t&&V<=n&&H>=r&&H<=a&&w.push(u[N]),(T===0?t<=V:r<=H)&&(y.push(k),y.push(N-1),y.push(1-T)),(T===0?n>=V:a>=H)&&(y.push(N+1),y.push(A),y.push(1-T))}return w}within(t,r,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");for(var{ids:a,coords:u,nodeSize:f}=this,i=[0,a.length-1,0],y=[],w=n*n;i.length;){var T=i.pop()||0,A=i.pop()||0,k=i.pop()||0;if(A-k<=f){for(var F=k;F<=A;F++)c5(u[2*F],u[2*F+1],t,r)<=w&&y.push(a[F]);continue}var D=k+A>>1,O=u[2*D],N=u[2*D+1];c5(O,N,t,r)<=w&&y.push(a[D]),(T===0?t-n<=O:r-n<=N)&&(i.push(k),i.push(D-1),i.push(1-T)),(T===0?t+n>=O:r+n>=N)&&(i.push(D+1),i.push(A),i.push(1-T))}return y}}function MO(e,t,r,n,a,u){if(!(a-n<=r)){var f=n+a>>1;QZ(e,t,f,n,a,u),MO(e,t,r,n,f-1,1-u),MO(e,t,r,f+1,a,1-u)}}function QZ(e,t,r,n,a,u){for(;a>n;){if(a-n>600){var f=a-n+1,i=r-n+1,y=Math.log(f),w=.5*Math.exp(2*y/3),T=.5*Math.sqrt(y*w*(f-w)/f)*(i-f/2<0?-1:1),A=Math.max(n,Math.floor(r-i*w/f+T)),k=Math.min(a,Math.floor(r+(f-i)*w/f+T));QZ(e,t,r,A,k,u)}var F=t[2*r+u],D=n,O=a;for(B0(e,t,n,r),t[2*a+u]>F&&B0(e,t,n,a);D<O;){for(B0(e,t,D,O),D++,O--;t[2*D+u]<F;)D++;for(;t[2*O+u]>F;)O--}t[2*n+u]===F?B0(e,t,n,O):(O++,B0(e,t,O,a)),O<=r&&(n=O+1),r<=O&&(a=O-1)}}function B0(e,t,r,n){jC(e,r,n),jC(t,2*r,2*n),jC(t,2*r+1,2*n+1)}function jC(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function c5(e,t,r,n){var a=e-r,u=t-n;return a*a+u*u}var Pme={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},u5=Math.fround||(e=>t=>(e[0]=+t,e[0]))(new Float32Array(1)),Jg=2,Im=3,DC=4,Pm=5,eX=6;class Mme{constructor(t){this.options=Object.assign(Object.create(Pme),t),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(t){var{log:r,minZoom:n,maxZoom:a}=this.options;r&&console.time("total time");var u="prepare ".concat(t.length," points");r&&console.time(u),this.points=t;for(var f=[],i=0;i<t.length;i++){var y=t[i];if(y.geometry){var[w,T]=y.geometry.coordinates,A=u5(aw(w)),k=u5(lw(T));f.push(A,k,1/0,i,-1,1),this.options.reduce&&f.push(0)}}var F=this.trees[a+1]=this._createTree(f);r&&console.timeEnd(u);for(var D=a;D>=n;D--){var O=+Date.now();F=this.trees[D]=this._createTree(this._cluster(F,D)),r&&console.log("z%d: %d clusters in %dms",D,F.numItems,+Date.now()-O)}return r&&console.timeEnd("total time"),this}getClusters(t,r){var n=((t[0]+180)%360+360)%360-180,a=Math.max(-90,Math.min(90,t[1])),u=t[2]===180?180:((t[2]+180)%360+360)%360-180,f=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)n=-180,u=180;else if(n>u){var i=this.getClusters([n,a,180,f],r),y=this.getClusters([-180,a,u,f],r);return i.concat(y)}var w=this.trees[this._limitZoom(r)],T=w.range(aw(n),lw(f),aw(u),lw(a)),A=w.data,k=[];for(var F of T){var D=this.stride*F;k.push(A[D+Pm]>1?d5(A,D,this.clusterProps):this.points[A[D+Im]])}return k}getChildren(t){var r=this._getOriginId(t),n=this._getOriginZoom(t),a="No cluster with the specified id.",u=this.trees[n];if(!u)throw new Error(a);var f=u.data;if(r*this.stride>=f.length)throw new Error(a);var i=this.options.radius/(this.options.extent*Math.pow(2,n-1)),y=f[r*this.stride],w=f[r*this.stride+1],T=u.within(y,w,i),A=[];for(var k of T){var F=k*this.stride;f[F+DC]===t&&A.push(f[F+Pm]>1?d5(f,F,this.clusterProps):this.points[f[F+Im]])}if(A.length===0)throw new Error(a);return A}getLeaves(t,r,n){r=r||10,n=n||0;var a=[];return this._appendLeaves(a,t,r,n,0),a}getTile(t,r,n){var a=this.trees[this._limitZoom(t)],u=Math.pow(2,t),{extent:f,radius:i}=this.options,y=i/f,w=(n-y)/u,T=(n+1+y)/u,A={features:[]};return this._addTileFeatures(a.range((r-y)/u,w,(r+1+y)/u,T),a.data,r,n,u,A),r===0&&this._addTileFeatures(a.range(1-y/u,w,1,T),a.data,u,n,u,A),r===u-1&&this._addTileFeatures(a.range(0,w,y/u,T),a.data,-1,n,u,A),A.features.length?A:null}getClusterExpansionZoom(t){for(var r=this._getOriginZoom(t)-1;r<=this.options.maxZoom;){var n=this.getChildren(t);if(r++,n.length!==1)break;t=n[0].properties.cluster_id}return r}_appendLeaves(t,r,n,a,u){var f=this.getChildren(r);for(var i of f){var y=i.properties;if(y&&y.cluster?u+y.point_count<=a?u+=y.point_count:u=this._appendLeaves(t,y.cluster_id,n,a,u):u<a?u++:t.push(i),t.length===n)break}return u}_createTree(t){for(var r=new Tj(t.length/this.stride|0,this.options.nodeSize,Float32Array),n=0;n<t.length;n+=this.stride)r.add(t[n],t[n+1]);return r.finish(),r.data=t,r}_addTileFeatures(t,r,n,a,u,f){for(var i of t){var y=i*this.stride,w=r[y+Pm]>1,T=void 0,A=void 0,k=void 0;if(w)T=tX(r,y,this.clusterProps),A=r[y],k=r[y+1];else{var F=this.points[r[y+Im]];T=F.properties;var[D,O]=F.geometry.coordinates;A=aw(D),k=lw(O)}var N={type:1,geometry:[[Math.round(this.options.extent*(A*u-n)),Math.round(this.options.extent*(k*u-a))]],tags:T},V=void 0;w||this.options.generateId?V=r[y+Im]:V=this.points[r[y+Im]].id,V!==void 0&&(N.id=V),f.features.push(N)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(Math.floor(+t),this.options.maxZoom+1))}_cluster(t,r){for(var{radius:n,extent:a,reduce:u,minPoints:f}=this.options,i=n/(a*Math.pow(2,r)),y=t.data,w=[],T=this.stride,A=0;A<y.length;A+=T)if(!(y[A+Jg]<=r)){y[A+Jg]=r;var k=y[A],F=y[A+1],D=t.within(y[A],y[A+1],i),O=y[A+Pm],N=O;for(var V of D){var H=V*T;y[H+Jg]>r&&(N+=y[H+Pm])}if(N>O&&N>=f){var Z=k*O,J=F*O,G=void 0,Y=-1,ie=((A/T|0)<<5)+(r+1)+this.points.length;for(var ce of D){var ge=ce*T;if(!(y[ge+Jg]<=r)){y[ge+Jg]=r;var be=y[ge+Pm];Z+=y[ge]*be,J+=y[ge+1]*be,y[ge+DC]=ie,u&&(G||(G=this._map(y,A,!0),Y=this.clusterProps.length,this.clusterProps.push(G)),u(G,this._map(y,ge)))}}y[A+DC]=ie,w.push(Z/N,J/N,1/0,ie,-1,N),u&&w.push(Y)}else{for(var xe=0;xe<T;xe++)w.push(y[A+xe]);if(N>1)for(var Le of D){var ze=Le*T;if(!(y[ze+Jg]<=r)){y[ze+Jg]=r;for(var Xe=0;Xe<T;Xe++)w.push(y[ze+Xe])}}}}return w}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,r,n){if(t[r+Pm]>1){var a=this.clusterProps[t[r+eX]];return n?Object.assign({},a):a}var u=this.points[t[r+Im]].properties,f=this.options.map(u);return n&&f===u?Object.assign({},f):f}}function d5(e,t,r){return{type:"Feature",id:e[t+Im],properties:tX(e,t,r),geometry:{type:"Point",coordinates:[Ime(e[t]),kme(e[t+1])]}}}function tX(e,t,r){var n=e[t+Pm],a=n>=1e4?"".concat(Math.round(n/1e3),"k"):n>=1e3?"".concat(Math.round(n/100)/10,"k"):n,u=e[t+eX],f=u===-1?{}:Object.assign({},r[u]);return Object.assign(f,{cluster:!0,cluster_id:e[t+Im],point_count:n,point_count_abbreviated:a})}function aw(e){return e/360+.5}function lw(e){var t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function Ime(e){return(e-.5)*360}function kme(e){var t=(180-e*360)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function Ome(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]]);return r}class ru{static isAdvancedMarkerAvailable(t){return google.maps.marker&&t.getMapCapabilities().isAdvancedMarkersAvailable===!0}static isAdvancedMarker(t){return google.maps.marker&&t instanceof google.maps.marker.AdvancedMarkerElement}static setMap(t,r){this.isAdvancedMarker(t)?t.map=r:t.setMap(r)}static getPosition(t){if(this.isAdvancedMarker(t)){if(t.position){if(t.position instanceof google.maps.LatLng)return t.position;if(t.position.lat&&t.position.lng)return new google.maps.LatLng(t.position.lat,t.position.lng)}return new google.maps.LatLng(null)}return t.getPosition()}static getVisible(t){return this.isAdvancedMarker(t)?!0:t.getVisible()}}class IO{constructor(t){var{markers:r,position:n}=t;this.markers=r,n&&(n instanceof google.maps.LatLng?this._position=n:this._position=new google.maps.LatLng(n))}get bounds(){if(!(this.markers.length===0&&!this._position)){var t=new google.maps.LatLngBounds(this._position,this._position);for(var r of this.markers)t.extend(ru.getPosition(r));return t}}get position(){return this._position||this.bounds.getCenter()}get count(){return this.markers.filter(t=>ru.getVisible(t)).length}push(t){this.markers.push(t)}delete(){this.marker&&(ru.setMap(this.marker,null),this.marker=void 0),this.markers.length=0}}class Lme{constructor(t){var{maxZoom:r=16}=t;this.maxZoom=r}noop(t){var{markers:r}=t;return Rme(r)}}var Rme=e=>{var t=e.map(r=>new IO({position:ru.getPosition(r),markers:[r]}));return t};class jme extends Lme{constructor(t){var{maxZoom:r,radius:n=60}=t,a=Ome(t,["maxZoom","radius"]);super({maxZoom:r}),this.state={zoom:-1},this.superCluster=new Mme(Object.assign({maxZoom:this.maxZoom,radius:n},a))}calculate(t){var r=!1,n={zoom:t.map.getZoom()};if(!a5(t.markers,this.markers)){r=!0,this.markers=[...t.markers];var a=this.markers.map(u=>{var f=ru.getPosition(u),i=[f.lng(),f.lat()];return{type:"Feature",geometry:{type:"Point",coordinates:i},properties:{marker:u}}});this.superCluster.load(a)}return r||(this.state.zoom<=this.maxZoom||n.zoom<=this.maxZoom)&&(r=!a5(this.state,n)),this.state=n,r&&(this.clusters=this.cluster(t)),{clusters:this.clusters,changed:r}}cluster(t){var{map:r}=t;return this.superCluster.getClusters([-180,-90,180,90],Math.round(r.getZoom())).map(n=>this.transformCluster(n))}transformCluster(t){var{geometry:{coordinates:[r,n]},properties:a}=t;if(a.cluster)return new IO({markers:this.superCluster.getLeaves(a.cluster_id,1/0).map(f=>f.properties.marker),position:{lat:n,lng:r}});var u=a.marker;return new IO({markers:[u],position:ru.getPosition(u)})}}class Dme{constructor(t,r){this.markers={sum:t.length};var n=r.map(u=>u.count),a=n.reduce((u,f)=>u+f,0);this.clusters={count:r.length,markers:{mean:a/r.length,sum:a,min:Math.min(...n),max:Math.max(...n)}}}}class Nme{render(t,r,n){var{count:a,position:u}=t,f=a>Math.max(10,r.clusters.markers.mean)?"#ff0000":"#0000ff",i='<svg fill="'.concat(f,`" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240 240" width="50" height="50">
<circle cx="120" cy="120" opacity=".6" r="70" />
<circle cx="120" cy="120" opacity=".3" r="90" />
<circle cx="120" cy="120" opacity=".2" r="110" />
<text x="50%" y="50%" style="fill:#fff" text-anchor="middle" font-size="50" dominant-baseline="middle" font-family="roboto,arial,sans-serif">`).concat(a,`</text>
</svg>`),y="Cluster of ".concat(a," markers"),w=Number(google.maps.Marker.MAX_ZINDEX)+a;if(ru.isAdvancedMarkerAvailable(n)){var T=new DOMParser,A=T.parseFromString(i,"image/svg+xml").documentElement;A.setAttribute("transform","translate(0 25)");var k={map:n,position:u,zIndex:w,title:y,content:A};return new google.maps.marker.AdvancedMarkerElement(k)}var F={position:u,zIndex:w,title:y,icon:{url:"data:image/svg+xml;base64,".concat(btoa(i)),anchor:new google.maps.Point(25,25)}};return new google.maps.Marker(F)}}function zme(e,t){for(var r in t.prototype)e.prototype[r]=t.prototype[r]}class Cj{constructor(){zme(Cj,google.maps.OverlayView)}}var _x;(function(e){e.CLUSTERING_BEGIN="clusteringbegin",e.CLUSTERING_END="clusteringend",e.CLUSTER_CLICK="click"})(_x||(_x={}));var Fme=(e,t,r)=>{r.fitBounds(t.bounds)};class Bme extends Cj{constructor(t){var{map:r,markers:n=[],algorithmOptions:a={},algorithm:u=new jme(a),renderer:f=new Nme,onClusterClick:i=Fme}=t;super(),this.markers=[...n],this.clusters=[],this.algorithm=u,this.renderer=f,this.onClusterClick=i,r&&this.setMap(r)}addMarker(t,r){this.markers.includes(t)||(this.markers.push(t),r||this.render())}addMarkers(t,r){t.forEach(n=>{this.addMarker(n,!0)}),r||this.render()}removeMarker(t,r){var n=this.markers.indexOf(t);return n===-1?!1:(ru.setMap(t,null),this.markers.splice(n,1),r||this.render(),!0)}removeMarkers(t,r){var n=!1;return t.forEach(a=>{n=this.removeMarker(a,!0)||n}),n&&!r&&this.render(),n}clearMarkers(t){this.markers.length=0,t||this.render()}render(){var t=this.getMap();if(t instanceof google.maps.Map&&t.getProjection()){google.maps.event.trigger(this,_x.CLUSTERING_BEGIN,this);var{clusters:r,changed:n}=this.algorithm.calculate({markers:this.markers,map:t,mapCanvasProjection:this.getProjection()});if(n||n==null){var a=new Set;for(var u of r)u.markers.length==1&&a.add(u.markers[0]);var f=[];for(var i of this.clusters)i.marker!=null&&(i.markers.length==1?a.has(i.marker)||ru.setMap(i.marker,null):f.push(i.marker));this.clusters=r,this.renderClusters(),requestAnimationFrame(()=>f.forEach(y=>ru.setMap(y,null)))}google.maps.event.trigger(this,_x.CLUSTERING_END,this)}}onAdd(){this.idleListener=this.getMap().addListener("idle",this.render.bind(this)),this.render()}onRemove(){google.maps.event.removeListener(this.idleListener),this.reset()}reset(){this.markers.forEach(t=>ru.setMap(t,null)),this.clusters.forEach(t=>t.delete()),this.clusters=[]}renderClusters(){var t=new Dme(this.markers,this.clusters),r=this.getMap();this.clusters.forEach(n=>{n.markers.length===1?n.marker=n.markers[0]:(n.marker=this.renderer.render(n,t,r),n.markers.forEach(a=>ru.setMap(a,null)),this.onClusterClick&&n.marker.addListener("click",a=>{google.maps.event.trigger(this,_x.CLUSTER_CLICK,n),this.onClusterClick(a,n,r)})),ru.setMap(n.marker,r)})}}function h5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function f5(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?h5(Object(r),!0).forEach(function(n){Sr(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function $me(e){var t=Ope(),[r,n]=j.useState(null);return j.useEffect(()=>{if(t&&r===null){var a=new Bme(f5(f5({},e),{},{map:t}));n(a)}},[t]),r}function Vme(e){var{children:t,options:r}=e,n=$me(r);return n!==null?t(n):null}j.memo(Vme);var p5={onCloseClick:"closeclick",onContentChanged:"content_changed",onDomReady:"domready",onPositionChanged:"position_changed",onZindexChanged:"zindex_changed"},m5={options(e,t){e.setOptions(t)},position(e,t){e.setPosition(t)},zIndex(e,t){e.setZIndex(t)}};function Ume(e){var{children:t,anchor:r,options:n,position:a,zIndex:u,onCloseClick:f,onDomReady:i,onContentChanged:y,onPositionChanged:w,onZindexChanged:T,onLoad:A,onUnmount:k}=e,F=j.useContext(Ri),[D,O]=j.useState(null),[N,V]=j.useState(null),[H,Z]=j.useState(null),[J,G]=j.useState(null),[Y,ie]=j.useState(null),[ce,ge]=j.useState(null),be=j.useRef(null);return j.useEffect(()=>{D!==null&&(D.close(),r?D.open(F,r):D.getPosition()&&D.open(F))},[F,D,r]),j.useEffect(()=>{n&&D!==null&&D.setOptions(n)},[D,n]),j.useEffect(()=>{a&&D!==null&&D.setPosition(a)},[a]),j.useEffect(()=>{typeof u=="number"&&D!==null&&D.setZIndex(u)},[u]),j.useEffect(()=>{D&&f&&(N!==null&&google.maps.event.removeListener(N),V(google.maps.event.addListener(D,"closeclick",f)))},[f]),j.useEffect(()=>{D&&i&&(H!==null&&google.maps.event.removeListener(H),Z(google.maps.event.addListener(D,"domready",i)))},[i]),j.useEffect(()=>{D&&y&&(J!==null&&google.maps.event.removeListener(J),G(google.maps.event.addListener(D,"content_changed",y)))},[y]),j.useEffect(()=>{D&&w&&(Y!==null&&google.maps.event.removeListener(Y),ie(google.maps.event.addListener(D,"position_changed",w)))},[w]),j.useEffect(()=>{D&&T&&(ce!==null&&google.maps.event.removeListener(ce),ge(google.maps.event.addListener(D,"zindex_changed",T)))},[T]),j.useEffect(()=>{var xe=new google.maps.InfoWindow(n);return O(xe),be.current=document.createElement("div"),f&&V(google.maps.event.addListener(xe,"closeclick",f)),i&&Z(google.maps.event.addListener(xe,"domready",i)),y&&G(google.maps.event.addListener(xe,"content_changed",y)),w&&ie(google.maps.event.addListener(xe,"position_changed",w)),T&&ge(google.maps.event.addListener(xe,"zindex_changed",T)),xe.setContent(be.current),a&&xe.setPosition(a),u&&xe.setZIndex(u),r?xe.open(F,r):xe.getPosition()?xe.open(F):xa(!1,"You must provide either an anchor (typically render it inside a <Marker>) or a position props for <InfoWindow>."),A&&A(xe),()=>{N&&google.maps.event.removeListener(N),J&&google.maps.event.removeListener(J),H&&google.maps.event.removeListener(H),Y&&google.maps.event.removeListener(Y),ce&&google.maps.event.removeListener(ce),k&&k(xe),xe.close()}},[]),be.current?Cp.createPortal(j.Children.only(t),be.current):null}j.memo(Ume);class qme extends j.PureComponent{constructor(){super(...arguments),Sr(this,"registeredEvents",[]),Sr(this,"containerElement",null),Sr(this,"state",{infoWindow:null}),Sr(this,"open",(t,r)=>{r?t.open(this.context,r):t.getPosition()?t.open(this.context):xa(!1,"You must provide either an anchor (typically render it inside a <Marker>) or a position props for <InfoWindow>.")}),Sr(this,"setInfoWindowCallback",()=>{this.state.infoWindow!==null&&this.containerElement!==null&&(this.state.infoWindow.setContent(this.containerElement),this.open(this.state.infoWindow,this.props.anchor),this.props.onLoad&&this.props.onLoad(this.state.infoWindow))})}componentDidMount(){var t=new google.maps.InfoWindow(this.props.options);this.containerElement=document.createElement("div"),this.registeredEvents=Xi({updaterMap:m5,eventMap:p5,prevProps:{},nextProps:this.props,instance:t}),this.setState(()=>({infoWindow:t}),this.setInfoWindowCallback)}componentDidUpdate(t){this.state.infoWindow!==null&&(Qi(this.registeredEvents),this.registeredEvents=Xi({updaterMap:m5,eventMap:p5,prevProps:t,nextProps:this.props,instance:this.state.infoWindow}))}componentWillUnmount(){this.state.infoWindow!==null&&(Qi(this.registeredEvents),this.props.onUnmount&&this.props.onUnmount(this.state.infoWindow),this.state.infoWindow.close())}render(){return this.containerElement?Cp.createPortal(j.Children.only(this.props.children),this.containerElement):null}}Sr(qme,"contextType",Ri);function g5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function xS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?g5(Object(r),!0).forEach(function(n){Sr(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var y5={onClick:"click",onDblClick:"dblclick",onDrag:"drag",onDragEnd:"dragend",onDragStart:"dragstart",onMouseDown:"mousedown",onMouseMove:"mousemove",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onRightClick:"rightclick"},v5={draggable(e,t){e.setDraggable(t)},editable(e,t){e.setEditable(t)},map(e,t){e.setMap(t)},options(e,t){e.setOptions(t)},path(e,t){e.setPath(t)},visible(e,t){e.setVisible(t)}},Gme={};function Hme(e){var{options:t,draggable:r,editable:n,visible:a,path:u,onDblClick:f,onDragEnd:i,onDragStart:y,onMouseDown:w,onMouseMove:T,onMouseOut:A,onMouseOver:k,onMouseUp:F,onRightClick:D,onClick:O,onDrag:N,onLoad:V,onUnmount:H}=e,Z=j.useContext(Ri),[J,G]=j.useState(null),[Y,ie]=j.useState(null),[ce,ge]=j.useState(null),[be,xe]=j.useState(null),[Le,ze]=j.useState(null),[Xe,Je]=j.useState(null),[tt,st]=j.useState(null),[Ne,We]=j.useState(null),[Ue,De]=j.useState(null),[Ke,lt]=j.useState(null),[Ye,Ve]=j.useState(null),[Et,kt]=j.useState(null);return j.useEffect(()=>{J!==null&&J.setMap(Z)},[Z]),j.useEffect(()=>{typeof t<"u"&&J!==null&&J.setOptions(t)},[J,t]),j.useEffect(()=>{typeof r<"u"&&J!==null&&J.setDraggable(r)},[J,r]),j.useEffect(()=>{typeof n<"u"&&J!==null&&J.setEditable(n)},[J,n]),j.useEffect(()=>{typeof a<"u"&&J!==null&&J.setVisible(a)},[J,a]),j.useEffect(()=>{typeof u<"u"&&J!==null&&J.setPath(u)},[J,u]),j.useEffect(()=>{J&&f&&(Y!==null&&google.maps.event.removeListener(Y),ie(google.maps.event.addListener(J,"dblclick",f)))},[f]),j.useEffect(()=>{J&&i&&(ce!==null&&google.maps.event.removeListener(ce),ge(google.maps.event.addListener(J,"dragend",i)))},[i]),j.useEffect(()=>{J&&y&&(be!==null&&google.maps.event.removeListener(be),xe(google.maps.event.addListener(J,"dragstart",y)))},[y]),j.useEffect(()=>{J&&w&&(Le!==null&&google.maps.event.removeListener(Le),ze(google.maps.event.addListener(J,"mousedown",w)))},[w]),j.useEffect(()=>{J&&T&&(Xe!==null&&google.maps.event.removeListener(Xe),Je(google.maps.event.addListener(J,"mousemove",T)))},[T]),j.useEffect(()=>{J&&A&&(tt!==null&&google.maps.event.removeListener(tt),st(google.maps.event.addListener(J,"mouseout",A)))},[A]),j.useEffect(()=>{J&&k&&(Ne!==null&&google.maps.event.removeListener(Ne),We(google.maps.event.addListener(J,"mouseover",k)))},[k]),j.useEffect(()=>{J&&F&&(Ue!==null&&google.maps.event.removeListener(Ue),De(google.maps.event.addListener(J,"mouseup",F)))},[F]),j.useEffect(()=>{J&&D&&(Ke!==null&&google.maps.event.removeListener(Ke),lt(google.maps.event.addListener(J,"rightclick",D)))},[D]),j.useEffect(()=>{J&&O&&(Ye!==null&&google.maps.event.removeListener(Ye),Ve(google.maps.event.addListener(J,"click",O)))},[O]),j.useEffect(()=>{J&&N&&(Et!==null&&google.maps.event.removeListener(Et),kt(google.maps.event.addListener(J,"drag",N)))},[N]),j.useEffect(()=>{var Wt=new google.maps.Polyline(xS(xS({},t||Gme),{},{map:Z}));return u&&Wt.setPath(u),typeof a<"u"&&Wt.setVisible(a),typeof n<"u"&&Wt.setEditable(n),typeof r<"u"&&Wt.setDraggable(r),f&&ie(google.maps.event.addListener(Wt,"dblclick",f)),i&&ge(google.maps.event.addListener(Wt,"dragend",i)),y&&xe(google.maps.event.addListener(Wt,"dragstart",y)),w&&ze(google.maps.event.addListener(Wt,"mousedown",w)),T&&Je(google.maps.event.addListener(Wt,"mousemove",T)),A&&st(google.maps.event.addListener(Wt,"mouseout",A)),k&&We(google.maps.event.addListener(Wt,"mouseover",k)),F&&De(google.maps.event.addListener(Wt,"mouseup",F)),D&&lt(google.maps.event.addListener(Wt,"rightclick",D)),O&&Ve(google.maps.event.addListener(Wt,"click",O)),N&&kt(google.maps.event.addListener(Wt,"drag",N)),G(Wt),V&&V(Wt),()=>{Y!==null&&google.maps.event.removeListener(Y),ce!==null&&google.maps.event.removeListener(ce),be!==null&&google.maps.event.removeListener(be),Le!==null&&google.maps.event.removeListener(Le),Xe!==null&&google.maps.event.removeListener(Xe),tt!==null&&google.maps.event.removeListener(tt),Ne!==null&&google.maps.event.removeListener(Ne),Ue!==null&&google.maps.event.removeListener(Ue),Ke!==null&&google.maps.event.removeListener(Ke),Ye!==null&&google.maps.event.removeListener(Ye),H&&H(Wt),Wt.setMap(null)}},[]),null}j.memo(Hme);class Wme extends j.PureComponent{constructor(){super(...arguments),Sr(this,"registeredEvents",[]),Sr(this,"state",{polyline:null}),Sr(this,"setPolylineCallback",()=>{this.state.polyline!==null&&this.props.onLoad&&this.props.onLoad(this.state.polyline)})}componentDidMount(){var t=new google.maps.Polyline(xS(xS({},this.props.options),{},{map:this.context}));this.registeredEvents=Xi({updaterMap:v5,eventMap:y5,prevProps:{},nextProps:this.props,instance:t}),this.setState(function(){return{polyline:t}},this.setPolylineCallback)}componentDidUpdate(t){this.state.polyline!==null&&(Qi(this.registeredEvents),this.registeredEvents=Xi({updaterMap:v5,eventMap:y5,prevProps:t,nextProps:this.props,instance:this.state.polyline}))}componentWillUnmount(){this.state.polyline!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.polyline),Qi(this.registeredEvents),this.state.polyline.setMap(null))}render(){return null}}Sr(Wme,"contextType",Ri);function _5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function x5(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?_5(Object(r),!0).forEach(function(n){Sr(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var b5={onClick:"click",onDblClick:"dblclick",onDrag:"drag",onDragEnd:"dragend",onDragStart:"dragstart",onMouseDown:"mousedown",onMouseMove:"mousemove",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onRightClick:"rightclick"},w5={draggable(e,t){e.setDraggable(t)},editable(e,t){e.setEditable(t)},map(e,t){e.setMap(t)},options(e,t){e.setOptions(t)},path(e,t){e.setPath(t)},paths(e,t){e.setPaths(t)},visible(e,t){e.setVisible(t)}};function Zme(e){var{options:t,draggable:r,editable:n,visible:a,path:u,paths:f,onDblClick:i,onDragEnd:y,onDragStart:w,onMouseDown:T,onMouseMove:A,onMouseOut:k,onMouseOver:F,onMouseUp:D,onRightClick:O,onClick:N,onDrag:V,onLoad:H,onUnmount:Z,onEdit:J}=e,G=j.useContext(Ri),[Y,ie]=j.useState(null),[ce,ge]=j.useState(null),[be,xe]=j.useState(null),[Le,ze]=j.useState(null),[Xe,Je]=j.useState(null),[tt,st]=j.useState(null),[Ne,We]=j.useState(null),[Ue,De]=j.useState(null),[Ke,lt]=j.useState(null),[Ye,Ve]=j.useState(null),[Et,kt]=j.useState(null),[Wt,Tt]=j.useState(null);return j.useEffect(()=>{Y!==null&&Y.setMap(G)},[G]),j.useEffect(()=>{typeof t<"u"&&Y!==null&&Y.setOptions(t)},[Y,t]),j.useEffect(()=>{typeof r<"u"&&Y!==null&&Y.setDraggable(r)},[Y,r]),j.useEffect(()=>{typeof n<"u"&&Y!==null&&Y.setEditable(n)},[Y,n]),j.useEffect(()=>{typeof a<"u"&&Y!==null&&Y.setVisible(a)},[Y,a]),j.useEffect(()=>{typeof u<"u"&&Y!==null&&Y.setPath(u)},[Y,u]),j.useEffect(()=>{typeof f<"u"&&Y!==null&&Y.setPaths(f)},[Y,f]),j.useEffect(()=>{Y&&typeof i=="function"&&(ce!==null&&google.maps.event.removeListener(ce),ge(google.maps.event.addListener(Y,"dblclick",i)))},[i]),j.useEffect(()=>{Y&&(google.maps.event.addListener(Y.getPath(),"insert_at",()=>{J==null||J(Y)}),google.maps.event.addListener(Y.getPath(),"set_at",()=>{J==null||J(Y)}),google.maps.event.addListener(Y.getPath(),"remove_at",()=>{J==null||J(Y)}))},[Y,J]),j.useEffect(()=>{Y&&typeof y=="function"&&(be!==null&&google.maps.event.removeListener(be),xe(google.maps.event.addListener(Y,"dragend",y)))},[y]),j.useEffect(()=>{Y&&typeof w=="function"&&(Le!==null&&google.maps.event.removeListener(Le),ze(google.maps.event.addListener(Y,"dragstart",w)))},[w]),j.useEffect(()=>{Y&&typeof T=="function"&&(Xe!==null&&google.maps.event.removeListener(Xe),Je(google.maps.event.addListener(Y,"mousedown",T)))},[T]),j.useEffect(()=>{Y&&typeof A=="function"&&(tt!==null&&google.maps.event.removeListener(tt),st(google.maps.event.addListener(Y,"mousemove",A)))},[A]),j.useEffect(()=>{Y&&typeof k=="function"&&(Ne!==null&&google.maps.event.removeListener(Ne),We(google.maps.event.addListener(Y,"mouseout",k)))},[k]),j.useEffect(()=>{Y&&typeof F=="function"&&(Ue!==null&&google.maps.event.removeListener(Ue),De(google.maps.event.addListener(Y,"mouseover",F)))},[F]),j.useEffect(()=>{Y&&typeof D=="function"&&(Ke!==null&&google.maps.event.removeListener(Ke),lt(google.maps.event.addListener(Y,"mouseup",D)))},[D]),j.useEffect(()=>{Y&&typeof O=="function"&&(Ye!==null&&google.maps.event.removeListener(Ye),Ve(google.maps.event.addListener(Y,"rightclick",O)))},[O]),j.useEffect(()=>{Y&&typeof N=="function"&&(Et!==null&&google.maps.event.removeListener(Et),kt(google.maps.event.addListener(Y,"click",N)))},[N]),j.useEffect(()=>{Y&&typeof V=="function"&&(Wt!==null&&google.maps.event.removeListener(Wt),Tt(google.maps.event.addListener(Y,"drag",V)))},[V]),j.useEffect(()=>{var Ht=new google.maps.Polygon(x5(x5({},t),{},{map:G}));return u&&Ht.setPath(u),f&&Ht.setPaths(f),typeof a<"u"&&Ht.setVisible(a),typeof n<"u"&&Ht.setEditable(n),typeof r<"u"&&Ht.setDraggable(r),i&&ge(google.maps.event.addListener(Ht,"dblclick",i)),y&&xe(google.maps.event.addListener(Ht,"dragend",y)),w&&ze(google.maps.event.addListener(Ht,"dragstart",w)),T&&Je(google.maps.event.addListener(Ht,"mousedown",T)),A&&st(google.maps.event.addListener(Ht,"mousemove",A)),k&&We(google.maps.event.addListener(Ht,"mouseout",k)),F&&De(google.maps.event.addListener(Ht,"mouseover",F)),D&&lt(google.maps.event.addListener(Ht,"mouseup",D)),O&&Ve(google.maps.event.addListener(Ht,"rightclick",O)),N&&kt(google.maps.event.addListener(Ht,"click",N)),V&&Tt(google.maps.event.addListener(Ht,"drag",V)),ie(Ht),H&&H(Ht),()=>{ce!==null&&google.maps.event.removeListener(ce),be!==null&&google.maps.event.removeListener(be),Le!==null&&google.maps.event.removeListener(Le),Xe!==null&&google.maps.event.removeListener(Xe),tt!==null&&google.maps.event.removeListener(tt),Ne!==null&&google.maps.event.removeListener(Ne),Ue!==null&&google.maps.event.removeListener(Ue),Ke!==null&&google.maps.event.removeListener(Ke),Ye!==null&&google.maps.event.removeListener(Ye),Et!==null&&google.maps.event.removeListener(Et),Z&&Z(Ht),Ht.setMap(null)}},[]),null}j.memo(Zme);class Xme extends j.PureComponent{constructor(){super(...arguments),Sr(this,"registeredEvents",[])}componentDidMount(){var t=this.props.options||{};this.polygon=new google.maps.Polygon(t),this.polygon.setMap(this.context),this.registeredEvents=Xi({updaterMap:w5,eventMap:b5,prevProps:{},nextProps:this.props,instance:this.polygon}),this.props.onLoad&&this.props.onLoad(this.polygon)}componentDidUpdate(t){this.polygon&&(Qi(this.registeredEvents),this.registeredEvents=Xi({updaterMap:w5,eventMap:b5,prevProps:t,nextProps:this.props,instance:this.polygon}))}componentWillUnmount(){this.polygon&&(this.props.onUnmount&&this.props.onUnmount(this.polygon),Qi(this.registeredEvents),this.polygon&&this.polygon.setMap(null))}render(){return null}}Sr(Xme,"contextType",Ri);function S5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function bS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?S5(Object(r),!0).forEach(function(n){Sr(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var E5={onBoundsChanged:"bounds_changed",onClick:"click",onDblClick:"dblclick",onDrag:"drag",onDragEnd:"dragend",onDragStart:"dragstart",onMouseDown:"mousedown",onMouseMove:"mousemove",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onRightClick:"rightclick"},T5={bounds(e,t){e.setBounds(t)},draggable(e,t){e.setDraggable(t)},editable(e,t){e.setEditable(t)},map(e,t){e.setMap(t)},options(e,t){e.setOptions(t)},visible(e,t){e.setVisible(t)}};function Kme(e){var{options:t,bounds:r,draggable:n,editable:a,visible:u,onDblClick:f,onDragEnd:i,onDragStart:y,onMouseDown:w,onMouseMove:T,onMouseOut:A,onMouseOver:k,onMouseUp:F,onRightClick:D,onClick:O,onDrag:N,onBoundsChanged:V,onLoad:H,onUnmount:Z}=e,J=j.useContext(Ri),[G,Y]=j.useState(null),[ie,ce]=j.useState(null),[ge,be]=j.useState(null),[xe,Le]=j.useState(null),[ze,Xe]=j.useState(null),[Je,tt]=j.useState(null),[st,Ne]=j.useState(null),[We,Ue]=j.useState(null),[De,Ke]=j.useState(null),[lt,Ye]=j.useState(null),[Ve,Et]=j.useState(null),[kt,Wt]=j.useState(null),[Tt,Ht]=j.useState(null);return j.useEffect(()=>{G!==null&&G.setMap(J)},[J]),j.useEffect(()=>{typeof t<"u"&&G!==null&&G.setOptions(t)},[G,t]),j.useEffect(()=>{typeof n<"u"&&G!==null&&G.setDraggable(n)},[G,n]),j.useEffect(()=>{typeof a<"u"&&G!==null&&G.setEditable(a)},[G,a]),j.useEffect(()=>{typeof u<"u"&&G!==null&&G.setVisible(u)},[G,u]),j.useEffect(()=>{typeof r<"u"&&G!==null&&G.setBounds(r)},[G,r]),j.useEffect(()=>{G&&f&&(ie!==null&&google.maps.event.removeListener(ie),ce(google.maps.event.addListener(G,"dblclick",f)))},[f]),j.useEffect(()=>{G&&i&&(ge!==null&&google.maps.event.removeListener(ge),be(google.maps.event.addListener(G,"dragend",i)))},[i]),j.useEffect(()=>{G&&y&&(xe!==null&&google.maps.event.removeListener(xe),Le(google.maps.event.addListener(G,"dragstart",y)))},[y]),j.useEffect(()=>{G&&w&&(ze!==null&&google.maps.event.removeListener(ze),Xe(google.maps.event.addListener(G,"mousedown",w)))},[w]),j.useEffect(()=>{G&&T&&(Je!==null&&google.maps.event.removeListener(Je),tt(google.maps.event.addListener(G,"mousemove",T)))},[T]),j.useEffect(()=>{G&&A&&(st!==null&&google.maps.event.removeListener(st),Ne(google.maps.event.addListener(G,"mouseout",A)))},[A]),j.useEffect(()=>{G&&k&&(We!==null&&google.maps.event.removeListener(We),Ue(google.maps.event.addListener(G,"mouseover",k)))},[k]),j.useEffect(()=>{G&&F&&(De!==null&&google.maps.event.removeListener(De),Ke(google.maps.event.addListener(G,"mouseup",F)))},[F]),j.useEffect(()=>{G&&D&&(lt!==null&&google.maps.event.removeListener(lt),Ye(google.maps.event.addListener(G,"rightclick",D)))},[D]),j.useEffect(()=>{G&&O&&(Ve!==null&&google.maps.event.removeListener(Ve),Et(google.maps.event.addListener(G,"click",O)))},[O]),j.useEffect(()=>{G&&N&&(kt!==null&&google.maps.event.removeListener(kt),Wt(google.maps.event.addListener(G,"drag",N)))},[N]),j.useEffect(()=>{G&&V&&(Tt!==null&&google.maps.event.removeListener(Tt),Ht(google.maps.event.addListener(G,"bounds_changed",V)))},[V]),j.useEffect(()=>{var ur=new google.maps.Rectangle(bS(bS({},t),{},{map:J}));return typeof u<"u"&&ur.setVisible(u),typeof a<"u"&&ur.setEditable(a),typeof n<"u"&&ur.setDraggable(n),typeof r<"u"&&ur.setBounds(r),f&&ce(google.maps.event.addListener(ur,"dblclick",f)),i&&be(google.maps.event.addListener(ur,"dragend",i)),y&&Le(google.maps.event.addListener(ur,"dragstart",y)),w&&Xe(google.maps.event.addListener(ur,"mousedown",w)),T&&tt(google.maps.event.addListener(ur,"mousemove",T)),A&&Ne(google.maps.event.addListener(ur,"mouseout",A)),k&&Ue(google.maps.event.addListener(ur,"mouseover",k)),F&&Ke(google.maps.event.addListener(ur,"mouseup",F)),D&&Ye(google.maps.event.addListener(ur,"rightclick",D)),O&&Et(google.maps.event.addListener(ur,"click",O)),N&&Wt(google.maps.event.addListener(ur,"drag",N)),V&&Ht(google.maps.event.addListener(ur,"bounds_changed",V)),Y(ur),H&&H(ur),()=>{ie!==null&&google.maps.event.removeListener(ie),ge!==null&&google.maps.event.removeListener(ge),xe!==null&&google.maps.event.removeListener(xe),ze!==null&&google.maps.event.removeListener(ze),Je!==null&&google.maps.event.removeListener(Je),st!==null&&google.maps.event.removeListener(st),We!==null&&google.maps.event.removeListener(We),De!==null&&google.maps.event.removeListener(De),lt!==null&&google.maps.event.removeListener(lt),Ve!==null&&google.maps.event.removeListener(Ve),kt!==null&&google.maps.event.removeListener(kt),Tt!==null&&google.maps.event.removeListener(Tt),Z&&Z(ur),ur.setMap(null)}},[]),null}j.memo(Kme);let Yme=class extends j.PureComponent{constructor(){super(...arguments),Sr(this,"registeredEvents",[]),Sr(this,"state",{rectangle:null}),Sr(this,"setRectangleCallback",()=>{this.state.rectangle!==null&&this.props.onLoad&&this.props.onLoad(this.state.rectangle)})}componentDidMount(){var t=new google.maps.Rectangle(bS(bS({},this.props.options),{},{map:this.context}));this.registeredEvents=Xi({updaterMap:T5,eventMap:E5,prevProps:{},nextProps:this.props,instance:t}),this.setState(function(){return{rectangle:t}},this.setRectangleCallback)}componentDidUpdate(t){this.state.rectangle!==null&&(Qi(this.registeredEvents),this.registeredEvents=Xi({updaterMap:T5,eventMap:E5,prevProps:t,nextProps:this.props,instance:this.state.rectangle}))}componentWillUnmount(){this.state.rectangle!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.rectangle),Qi(this.registeredEvents),this.state.rectangle.setMap(null))}render(){return null}};Sr(Yme,"contextType",Ri);function C5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function wS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?C5(Object(r),!0).forEach(function(n){Sr(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var A5={onCenterChanged:"center_changed",onRadiusChanged:"radius_changed",onClick:"click",onDblClick:"dblclick",onDrag:"drag",onDragEnd:"dragend",onDragStart:"dragstart",onMouseDown:"mousedown",onMouseMove:"mousemove",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onRightClick:"rightclick"},P5={center(e,t){e.setCenter(t)},draggable(e,t){e.setDraggable(t)},editable(e,t){e.setEditable(t)},map(e,t){e.setMap(t)},options(e,t){e.setOptions(t)},radius(e,t){e.setRadius(t)},visible(e,t){e.setVisible(t)}},Jme={};function Qme(e){var{options:t,center:r,radius:n,draggable:a,editable:u,visible:f,onDblClick:i,onDragEnd:y,onDragStart:w,onMouseDown:T,onMouseMove:A,onMouseOut:k,onMouseOver:F,onMouseUp:D,onRightClick:O,onClick:N,onDrag:V,onCenterChanged:H,onRadiusChanged:Z,onLoad:J,onUnmount:G}=e,Y=j.useContext(Ri),[ie,ce]=j.useState(null),[ge,be]=j.useState(null),[xe,Le]=j.useState(null),[ze,Xe]=j.useState(null),[Je,tt]=j.useState(null),[st,Ne]=j.useState(null),[We,Ue]=j.useState(null),[De,Ke]=j.useState(null),[lt,Ye]=j.useState(null),[Ve,Et]=j.useState(null),[kt,Wt]=j.useState(null),[Tt,Ht]=j.useState(null),[ur,Jt]=j.useState(null),[Rt,Dt]=j.useState(null);return j.useEffect(()=>{ie!==null&&ie.setMap(Y)},[Y]),j.useEffect(()=>{typeof t<"u"&&ie!==null&&ie.setOptions(t)},[ie,t]),j.useEffect(()=>{typeof a<"u"&&ie!==null&&ie.setDraggable(a)},[ie,a]),j.useEffect(()=>{typeof u<"u"&&ie!==null&&ie.setEditable(u)},[ie,u]),j.useEffect(()=>{typeof f<"u"&&ie!==null&&ie.setVisible(f)},[ie,f]),j.useEffect(()=>{typeof n=="number"&&ie!==null&&ie.setRadius(n)},[ie,n]),j.useEffect(()=>{typeof r<"u"&&ie!==null&&ie.setCenter(r)},[ie,r]),j.useEffect(()=>{ie&&i&&(ge!==null&&google.maps.event.removeListener(ge),be(google.maps.event.addListener(ie,"dblclick",i)))},[i]),j.useEffect(()=>{ie&&y&&(xe!==null&&google.maps.event.removeListener(xe),Le(google.maps.event.addListener(ie,"dragend",y)))},[y]),j.useEffect(()=>{ie&&w&&(ze!==null&&google.maps.event.removeListener(ze),Xe(google.maps.event.addListener(ie,"dragstart",w)))},[w]),j.useEffect(()=>{ie&&T&&(Je!==null&&google.maps.event.removeListener(Je),tt(google.maps.event.addListener(ie,"mousedown",T)))},[T]),j.useEffect(()=>{ie&&A&&(st!==null&&google.maps.event.removeListener(st),Ne(google.maps.event.addListener(ie,"mousemove",A)))},[A]),j.useEffect(()=>{ie&&k&&(We!==null&&google.maps.event.removeListener(We),Ue(google.maps.event.addListener(ie,"mouseout",k)))},[k]),j.useEffect(()=>{ie&&F&&(De!==null&&google.maps.event.removeListener(De),Ke(google.maps.event.addListener(ie,"mouseover",F)))},[F]),j.useEffect(()=>{ie&&D&&(lt!==null&&google.maps.event.removeListener(lt),Ye(google.maps.event.addListener(ie,"mouseup",D)))},[D]),j.useEffect(()=>{ie&&O&&(Ve!==null&&google.maps.event.removeListener(Ve),Et(google.maps.event.addListener(ie,"rightclick",O)))},[O]),j.useEffect(()=>{ie&&N&&(kt!==null&&google.maps.event.removeListener(kt),Wt(google.maps.event.addListener(ie,"click",N)))},[N]),j.useEffect(()=>{ie&&V&&(Tt!==null&&google.maps.event.removeListener(Tt),Ht(google.maps.event.addListener(ie,"drag",V)))},[V]),j.useEffect(()=>{ie&&H&&(ur!==null&&google.maps.event.removeListener(ur),Jt(google.maps.event.addListener(ie,"center_changed",H)))},[N]),j.useEffect(()=>{ie&&Z&&(Rt!==null&&google.maps.event.removeListener(Rt),Dt(google.maps.event.addListener(ie,"radius_changed",Z)))},[Z]),j.useEffect(()=>{var sr=new google.maps.Circle(wS(wS({},t||Jme),{},{map:Y}));return typeof n=="number"&&sr.setRadius(n),typeof r<"u"&&sr.setCenter(r),typeof n=="number"&&sr.setRadius(n),typeof f<"u"&&sr.setVisible(f),typeof u<"u"&&sr.setEditable(u),typeof a<"u"&&sr.setDraggable(a),i&&be(google.maps.event.addListener(sr,"dblclick",i)),y&&Le(google.maps.event.addListener(sr,"dragend",y)),w&&Xe(google.maps.event.addListener(sr,"dragstart",w)),T&&tt(google.maps.event.addListener(sr,"mousedown",T)),A&&Ne(google.maps.event.addListener(sr,"mousemove",A)),k&&Ue(google.maps.event.addListener(sr,"mouseout",k)),F&&Ke(google.maps.event.addListener(sr,"mouseover",F)),D&&Ye(google.maps.event.addListener(sr,"mouseup",D)),O&&Et(google.maps.event.addListener(sr,"rightclick",O)),N&&Wt(google.maps.event.addListener(sr,"click",N)),V&&Ht(google.maps.event.addListener(sr,"drag",V)),H&&Jt(google.maps.event.addListener(sr,"center_changed",H)),Z&&Dt(google.maps.event.addListener(sr,"radius_changed",Z)),ce(sr),J&&J(sr),()=>{ge!==null&&google.maps.event.removeListener(ge),xe!==null&&google.maps.event.removeListener(xe),ze!==null&&google.maps.event.removeListener(ze),Je!==null&&google.maps.event.removeListener(Je),st!==null&&google.maps.event.removeListener(st),We!==null&&google.maps.event.removeListener(We),De!==null&&google.maps.event.removeListener(De),lt!==null&&google.maps.event.removeListener(lt),Ve!==null&&google.maps.event.removeListener(Ve),kt!==null&&google.maps.event.removeListener(kt),ur!==null&&google.maps.event.removeListener(ur),Rt!==null&&google.maps.event.removeListener(Rt),G&&G(sr),sr.setMap(null)}},[]),null}j.memo(Qme);class ege extends j.PureComponent{constructor(){super(...arguments),Sr(this,"registeredEvents",[]),Sr(this,"state",{circle:null}),Sr(this,"setCircleCallback",()=>{this.state.circle!==null&&this.props.onLoad&&this.props.onLoad(this.state.circle)})}componentDidMount(){var t=new google.maps.Circle(wS(wS({},this.props.options),{},{map:this.context}));this.registeredEvents=Xi({updaterMap:P5,eventMap:A5,prevProps:{},nextProps:this.props,instance:t}),this.setState(function(){return{circle:t}},this.setCircleCallback)}componentDidUpdate(t){this.state.circle!==null&&(Qi(this.registeredEvents),this.registeredEvents=Xi({updaterMap:P5,eventMap:A5,prevProps:t,nextProps:this.props,instance:this.state.circle}))}componentWillUnmount(){if(this.state.circle!==null){var t;this.props.onUnmount&&this.props.onUnmount(this.state.circle),Qi(this.registeredEvents),(t=this.state.circle)===null||t===void 0||t.setMap(null)}}render(){return null}}Sr(ege,"contextType",Ri);function M5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function SS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?M5(Object(r),!0).forEach(function(n){Sr(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var I5={onClick:"click",onDblClick:"dblclick",onMouseDown:"mousedown",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onRightClick:"rightclick",onAddFeature:"addfeature",onRemoveFeature:"removefeature",onRemoveProperty:"removeproperty",onSetGeometry:"setgeometry",onSetProperty:"setproperty"},k5={add(e,t){e.add(t)},addgeojson(e,t,r){e.addGeoJson(t,r)},contains(e,t){e.contains(t)},foreach(e,t){e.forEach(t)},loadgeojson(e,t,r,n){e.loadGeoJson(t,r,n)},overridestyle(e,t,r){e.overrideStyle(t,r)},remove(e,t){e.remove(t)},revertstyle(e,t){e.revertStyle(t)},controlposition(e,t){e.setControlPosition(t)},controls(e,t){e.setControls(t)},drawingmode(e,t){e.setDrawingMode(t)},map(e,t){e.setMap(t)},style(e,t){e.setStyle(t)},togeojson(e,t){e.toGeoJson(t)}};function tge(e){var{options:t,onClick:r,onDblClick:n,onMouseDown:a,onMouseMove:u,onMouseOut:f,onMouseOver:i,onMouseUp:y,onRightClick:w,onAddFeature:T,onRemoveFeature:A,onRemoveProperty:k,onSetGeometry:F,onSetProperty:D,onLoad:O,onUnmount:N}=e,V=j.useContext(Ri),[H,Z]=j.useState(null),[J,G]=j.useState(null),[Y,ie]=j.useState(null),[ce,ge]=j.useState(null),[be,xe]=j.useState(null),[Le,ze]=j.useState(null),[Xe,Je]=j.useState(null),[tt,st]=j.useState(null),[Ne,We]=j.useState(null),[Ue,De]=j.useState(null),[Ke,lt]=j.useState(null),[Ye,Ve]=j.useState(null),[Et,kt]=j.useState(null),[Wt,Tt]=j.useState(null);return j.useEffect(()=>{H!==null&&H.setMap(V)},[V]),j.useEffect(()=>{H&&n&&(J!==null&&google.maps.event.removeListener(J),G(google.maps.event.addListener(H,"dblclick",n)))},[n]),j.useEffect(()=>{H&&a&&(Y!==null&&google.maps.event.removeListener(Y),ie(google.maps.event.addListener(H,"mousedown",a)))},[a]),j.useEffect(()=>{H&&u&&(ce!==null&&google.maps.event.removeListener(ce),ge(google.maps.event.addListener(H,"mousemove",u)))},[u]),j.useEffect(()=>{H&&f&&(be!==null&&google.maps.event.removeListener(be),xe(google.maps.event.addListener(H,"mouseout",f)))},[f]),j.useEffect(()=>{H&&i&&(Le!==null&&google.maps.event.removeListener(Le),ze(google.maps.event.addListener(H,"mouseover",i)))},[i]),j.useEffect(()=>{H&&y&&(Xe!==null&&google.maps.event.removeListener(Xe),Je(google.maps.event.addListener(H,"mouseup",y)))},[y]),j.useEffect(()=>{H&&w&&(tt!==null&&google.maps.event.removeListener(tt),st(google.maps.event.addListener(H,"rightclick",w)))},[w]),j.useEffect(()=>{H&&r&&(Ne!==null&&google.maps.event.removeListener(Ne),We(google.maps.event.addListener(H,"click",r)))},[r]),j.useEffect(()=>{H&&T&&(Ue!==null&&google.maps.event.removeListener(Ue),De(google.maps.event.addListener(H,"addfeature",T)))},[T]),j.useEffect(()=>{H&&A&&(Ke!==null&&google.maps.event.removeListener(Ke),lt(google.maps.event.addListener(H,"removefeature",A)))},[A]),j.useEffect(()=>{H&&k&&(Ye!==null&&google.maps.event.removeListener(Ye),Ve(google.maps.event.addListener(H,"removeproperty",k)))},[k]),j.useEffect(()=>{H&&F&&(Et!==null&&google.maps.event.removeListener(Et),kt(google.maps.event.addListener(H,"setgeometry",F)))},[F]),j.useEffect(()=>{H&&D&&(Wt!==null&&google.maps.event.removeListener(Wt),Tt(google.maps.event.addListener(H,"setproperty",D)))},[D]),j.useEffect(()=>{if(V!==null){var Ht=new google.maps.Data(SS(SS({},t),{},{map:V}));n&&G(google.maps.event.addListener(Ht,"dblclick",n)),a&&ie(google.maps.event.addListener(Ht,"mousedown",a)),u&&ge(google.maps.event.addListener(Ht,"mousemove",u)),f&&xe(google.maps.event.addListener(Ht,"mouseout",f)),i&&ze(google.maps.event.addListener(Ht,"mouseover",i)),y&&Je(google.maps.event.addListener(Ht,"mouseup",y)),w&&st(google.maps.event.addListener(Ht,"rightclick",w)),r&&We(google.maps.event.addListener(Ht,"click",r)),T&&De(google.maps.event.addListener(Ht,"addfeature",T)),A&&lt(google.maps.event.addListener(Ht,"removefeature",A)),k&&Ve(google.maps.event.addListener(Ht,"removeproperty",k)),F&&kt(google.maps.event.addListener(Ht,"setgeometry",F)),D&&Tt(google.maps.event.addListener(Ht,"setproperty",D)),Z(Ht),O&&O(Ht)}return()=>{H&&(J!==null&&google.maps.event.removeListener(J),Y!==null&&google.maps.event.removeListener(Y),ce!==null&&google.maps.event.removeListener(ce),be!==null&&google.maps.event.removeListener(be),Le!==null&&google.maps.event.removeListener(Le),Xe!==null&&google.maps.event.removeListener(Xe),tt!==null&&google.maps.event.removeListener(tt),Ne!==null&&google.maps.event.removeListener(Ne),Ue!==null&&google.maps.event.removeListener(Ue),Ke!==null&&google.maps.event.removeListener(Ke),Ye!==null&&google.maps.event.removeListener(Ye),Et!==null&&google.maps.event.removeListener(Et),Wt!==null&&google.maps.event.removeListener(Wt),N&&N(H),H.setMap(null))}},[]),null}j.memo(tge);class rge extends j.PureComponent{constructor(){super(...arguments),Sr(this,"registeredEvents",[]),Sr(this,"state",{data:null}),Sr(this,"setDataCallback",()=>{this.state.data!==null&&this.props.onLoad&&this.props.onLoad(this.state.data)})}componentDidMount(){if(this.context!==null){var t=new google.maps.Data(SS(SS({},this.props.options),{},{map:this.context}));this.registeredEvents=Xi({updaterMap:k5,eventMap:I5,prevProps:{},nextProps:this.props,instance:t}),this.setState(()=>({data:t}),this.setDataCallback)}}componentDidUpdate(t){this.state.data!==null&&(Qi(this.registeredEvents),this.registeredEvents=Xi({updaterMap:k5,eventMap:I5,prevProps:t,nextProps:this.props,instance:this.state.data}))}componentWillUnmount(){this.state.data!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.data),Qi(this.registeredEvents),this.state.data&&this.state.data.setMap(null))}render(){return null}}Sr(rge,"contextType",Ri);function O5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function L5(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?O5(Object(r),!0).forEach(function(n){Sr(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var R5={onClick:"click",onDefaultViewportChanged:"defaultviewport_changed",onStatusChanged:"status_changed"},j5={options(e,t){e.setOptions(t)},url(e,t){e.setUrl(t)},zIndex(e,t){e.setZIndex(t)}};class nge extends j.PureComponent{constructor(){super(...arguments),Sr(this,"registeredEvents",[]),Sr(this,"state",{kmlLayer:null}),Sr(this,"setKmlLayerCallback",()=>{this.state.kmlLayer!==null&&this.props.onLoad&&this.props.onLoad(this.state.kmlLayer)})}componentDidMount(){var t=new google.maps.KmlLayer(L5(L5({},this.props.options),{},{map:this.context}));this.registeredEvents=Xi({updaterMap:j5,eventMap:R5,prevProps:{},nextProps:this.props,instance:t}),this.setState(function(){return{kmlLayer:t}},this.setKmlLayerCallback)}componentDidUpdate(t){this.state.kmlLayer!==null&&(Qi(this.registeredEvents),this.registeredEvents=Xi({updaterMap:j5,eventMap:R5,prevProps:t,nextProps:this.props,instance:this.state.kmlLayer}))}componentWillUnmount(){this.state.kmlLayer!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.kmlLayer),Qi(this.registeredEvents),this.state.kmlLayer.setMap(null))}render(){return null}}Sr(nge,"contextType",Ri);function rX(e,t){return typeof t=="function"?t(e.offsetWidth,e.offsetHeight):{x:0,y:0}}function ige(e,t){return new t(e.lat,e.lng)}function sge(e,t){return new t(new google.maps.LatLng(e.ne.lat,e.ne.lng),new google.maps.LatLng(e.sw.lat,e.sw.lng))}function oge(e,t,r){return e instanceof t?e:r(e,t)}function age(e,t,r){return e instanceof t?e:r(e,t)}function lge(e,t,r){var n=e&&e.fromLatLngToDivPixel(r.getNorthEast()),a=e&&e.fromLatLngToDivPixel(r.getSouthWest());return n&&a?{left:"".concat(a.x+t.x,"px"),top:"".concat(n.y+t.y,"px"),width:"".concat(n.x-a.x-t.x,"px"),height:"".concat(a.y-n.y-t.y,"px")}:{left:"-9999px",top:"-9999px"}}function cge(e,t,r){var n=e&&e.fromLatLngToDivPixel(r);if(n){var{x:a,y:u}=n;return{left:"".concat(a+t.x,"px"),top:"".concat(u+t.y,"px")}}return{left:"-9999px",top:"-9999px"}}function nX(e,t,r,n){return r!==void 0?lge(e,t,age(r,google.maps.LatLngBounds,sge)):cge(e,t,oge(n,google.maps.LatLng,ige))}function uge(e,t){return e.left===t.left&&e.top===t.top&&e.width===t.height&&e.height===t.height}function D5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function dge(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?D5(Object(r),!0).forEach(function(n){Sr(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function hge(e,t,r,n,a){class u extends google.maps.OverlayView{constructor(i,y,w,T){super(),this.container=i,this.pane=y,this.position=w,this.bounds=T}onAdd(){var i,y=(i=this.getPanes())===null||i===void 0?void 0:i[this.pane];y==null||y.appendChild(this.container)}draw(){var i=this.getProjection(),y=dge({},this.container?rX(this.container,a):{x:0,y:0}),w=nX(i,y,this.bounds,this.position);for(var[T,A]of Object.entries(w))this.container.style[T]=A}onRemove(){this.container.parentNode!==null&&this.container.parentNode.removeChild(this.container)}}return new u(e,t,r,n)}function N5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function fge(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?N5(Object(r),!0).forEach(function(n){Sr(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function z5(e){if(!e)return"";var t=e instanceof google.maps.LatLng?e:new google.maps.LatLng(e.lat,e.lng);return t+""}function F5(e){if(!e)return"";var t=e instanceof google.maps.LatLngBounds?e:new google.maps.LatLngBounds(new google.maps.LatLng(e.south,e.east),new google.maps.LatLng(e.north,e.west));return t+""}function pge(e){var{position:t,bounds:r,mapPaneName:n,zIndex:a,onLoad:u,onUnmount:f,getPixelPositionOffset:i,children:y}=e,w=j.useContext(Ri),T=j.useMemo(()=>{var k=document.createElement("div");return k.style.position="absolute",k},[]),A=j.useMemo(()=>hge(T,n,t,r,i),[T,n,t,r]);return j.useEffect(()=>(u==null||u(A),A==null||A.setMap(w),()=>{f==null||f(A),A==null||A.setMap(null)}),[w,A]),j.useEffect(()=>{T.style.zIndex="".concat(a)},[a,T]),Cp.createPortal(y,T)}j.memo(pge);class k_ extends j.PureComponent{constructor(t){super(t),Sr(this,"state",{paneEl:null,containerStyle:{position:"absolute"}}),Sr(this,"updatePane",()=>{var n=this.props.mapPaneName,a=this.overlayView.getPanes();xa(!!n,"OverlayView requires props.mapPaneName but got %s",n),a?this.setState({paneEl:a[n]}):this.setState({paneEl:null})}),Sr(this,"onAdd",()=>{var n,a;this.updatePane(),(n=(a=this.props).onLoad)===null||n===void 0||n.call(a,this.overlayView)}),Sr(this,"onPositionElement",()=>{var n=this.overlayView.getProjection(),a=fge({x:0,y:0},this.containerRef.current?rX(this.containerRef.current,this.props.getPixelPositionOffset):{}),u=nX(n,a,this.props.bounds,this.props.position);if(!uge(u,{left:this.state.containerStyle.left,top:this.state.containerStyle.top,width:this.state.containerStyle.width,height:this.state.containerStyle.height})){var f,i,y,w;this.setState({containerStyle:{top:(f=u.top)!==null&&f!==void 0?f:0,left:(i=u.left)!==null&&i!==void 0?i:0,width:(y=u.width)!==null&&y!==void 0?y:0,height:(w=u.height)!==null&&w!==void 0?w:0,position:"absolute"}})}}),Sr(this,"draw",()=>{this.onPositionElement()}),Sr(this,"onRemove",()=>{var n,a;this.setState(()=>({paneEl:null})),(n=(a=this.props).onUnmount)===null||n===void 0||n.call(a,this.overlayView)}),this.containerRef=j.createRef();var r=new google.maps.OverlayView;r.onAdd=this.onAdd,r.draw=this.draw,r.onRemove=this.onRemove,this.overlayView=r}componentDidMount(){this.overlayView.setMap(this.context)}componentDidUpdate(t){var r=z5(t.position),n=z5(this.props.position),a=F5(t.bounds),u=F5(this.props.bounds);(r!==n||a!==u)&&this.overlayView.draw(),t.mapPaneName!==this.props.mapPaneName&&this.updatePane()}componentWillUnmount(){this.overlayView.setMap(null)}render(){var t=this.state.paneEl;return t?Cp.createPortal(b.jsx("div",{ref:this.containerRef,style:this.state.containerStyle,children:j.Children.only(this.props.children)}),t):null}}Sr(k_,"FLOAT_PANE","floatPane");Sr(k_,"MAP_PANE","mapPane");Sr(k_,"MARKER_LAYER","markerLayer");Sr(k_,"OVERLAY_LAYER","overlayLayer");Sr(k_,"OVERLAY_MOUSE_TARGET","overlayMouseTarget");Sr(k_,"contextType",Ri);function mge(){}function B5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function $5(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?B5(Object(r),!0).forEach(function(n){Sr(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var V5={onDblClick:"dblclick",onClick:"click"},U5={opacity(e,t){e.setOpacity(t)}};function gge(e){var{url:t,bounds:r,options:n,visible:a}=e,u=j.useContext(Ri),f=new google.maps.LatLngBounds(new google.maps.LatLng(r.south,r.west),new google.maps.LatLng(r.north,r.east)),i=j.useMemo(()=>new google.maps.GroundOverlay(t,f,n),[]);return j.useEffect(()=>{i!==null&&i.setMap(u)},[u]),j.useEffect(()=>{typeof t<"u"&&i!==null&&(i.set("url",t),i.setMap(u))},[i,t]),j.useEffect(()=>{typeof a<"u"&&i!==null&&i.setOpacity(a?1:0)},[i,a]),j.useEffect(()=>{var y=new google.maps.LatLngBounds(new google.maps.LatLng(r.south,r.west),new google.maps.LatLng(r.north,r.east));typeof r<"u"&&i!==null&&(i.set("bounds",y),i.setMap(u))},[i,r]),null}j.memo(gge);class iX extends j.PureComponent{constructor(){super(...arguments),Sr(this,"registeredEvents",[]),Sr(this,"state",{groundOverlay:null}),Sr(this,"setGroundOverlayCallback",()=>{this.state.groundOverlay!==null&&this.props.onLoad&&this.props.onLoad(this.state.groundOverlay)})}componentDidMount(){xa(!!this.props.url||!!this.props.bounds,"For GroundOverlay, url and bounds are passed in to constructor and are immutable after instantiated. This is the behavior of Google Maps JavaScript API v3 ( See https://developers.google.com/maps/documentation/javascript/reference#GroundOverlay) Hence, use the corresponding two props provided by `react-google-maps-api`, url and bounds. In some cases, you'll need the GroundOverlay component to reflect the changes of url and bounds. You can leverage the React's key property to remount the component. Typically, just `key={url}` would serve your need. See https://github.com/tomchentw/react-google-maps/issues/655");var t=new google.maps.GroundOverlay(this.props.url,this.props.bounds,$5($5({},this.props.options),{},{map:this.context}));this.registeredEvents=Xi({updaterMap:U5,eventMap:V5,prevProps:{},nextProps:this.props,instance:t}),this.setState(function(){return{groundOverlay:t}},this.setGroundOverlayCallback)}componentDidUpdate(t){this.state.groundOverlay!==null&&(Qi(this.registeredEvents),this.registeredEvents=Xi({updaterMap:U5,eventMap:V5,prevProps:t,nextProps:this.props,instance:this.state.groundOverlay}))}componentWillUnmount(){this.state.groundOverlay&&(this.props.onUnmount&&this.props.onUnmount(this.state.groundOverlay),this.state.groundOverlay.setMap(null))}render(){return null}}Sr(iX,"defaultProps",{onLoad:mge});Sr(iX,"contextType",Ri);function q5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ES(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?q5(Object(r),!0).forEach(function(n){Sr(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var G5={},H5={data(e,t){e.setData(t)},map(e,t){e.setMap(t)},options(e,t){e.setOptions(t)}};function yge(e){var{data:t,onLoad:r,onUnmount:n,options:a}=e,u=j.useContext(Ri),[f,i]=j.useState(null);return j.useEffect(()=>{google.maps.visualization||xa(!!google.maps.visualization,'Did you include prop libraries={["visualization"]} in useJsApiScript? %s',google.maps.visualization)},[]),j.useEffect(()=>{xa(!!t,"data property is required in HeatmapLayer %s",t)},[t]),j.useEffect(()=>{f!==null&&f.setMap(u)},[u]),j.useEffect(()=>{a&&f!==null&&f.setOptions(a)},[f,a]),j.useEffect(()=>{var y=new google.maps.visualization.HeatmapLayer(ES(ES({},a),{},{data:t,map:u}));return i(y),r&&r(y),()=>{f!==null&&(n&&n(f),f.setMap(null))}},[]),null}j.memo(yge);class vge extends j.PureComponent{constructor(){super(...arguments),Sr(this,"registeredEvents",[]),Sr(this,"state",{heatmapLayer:null}),Sr(this,"setHeatmapLayerCallback",()=>{this.state.heatmapLayer!==null&&this.props.onLoad&&this.props.onLoad(this.state.heatmapLayer)})}componentDidMount(){xa(!!google.maps.visualization,'Did you include prop libraries={["visualization"]} to <LoadScript />? %s',google.maps.visualization),xa(!!this.props.data,"data property is required in HeatmapLayer %s",this.props.data);var t=new google.maps.visualization.HeatmapLayer(ES(ES({},this.props.options),{},{data:this.props.data,map:this.context}));this.registeredEvents=Xi({updaterMap:H5,eventMap:G5,prevProps:{},nextProps:this.props,instance:t}),this.setState(function(){return{heatmapLayer:t}},this.setHeatmapLayerCallback)}componentDidUpdate(t){Qi(this.registeredEvents),this.registeredEvents=Xi({updaterMap:H5,eventMap:G5,prevProps:t,nextProps:this.props,instance:this.state.heatmapLayer})}componentWillUnmount(){this.state.heatmapLayer!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.heatmapLayer),Qi(this.registeredEvents),this.state.heatmapLayer.setMap(null))}render(){return null}}Sr(vge,"contextType",Ri);var W5={onCloseClick:"closeclick",onPanoChanged:"pano_changed",onPositionChanged:"position_changed",onPovChanged:"pov_changed",onResize:"resize",onStatusChanged:"status_changed",onVisibleChanged:"visible_changed",onZoomChanged:"zoom_changed"},Z5={register(e,t,r){e.registerPanoProvider(t,r)},links(e,t){e.setLinks(t)},motionTracking(e,t){e.setMotionTracking(t)},options(e,t){e.setOptions(t)},pano(e,t){e.setPano(t)},position(e,t){e.setPosition(t)},pov(e,t){e.setPov(t)},visible(e,t){e.setVisible(t)},zoom(e,t){e.setZoom(t)}};class _ge extends j.PureComponent{constructor(){super(...arguments),Sr(this,"registeredEvents",[]),Sr(this,"state",{streetViewPanorama:null}),Sr(this,"setStreetViewPanoramaCallback",()=>{this.state.streetViewPanorama!==null&&this.props.onLoad&&this.props.onLoad(this.state.streetViewPanorama)})}componentDidMount(){var t,r,n=(t=(r=this.context)===null||r===void 0?void 0:r.getStreetView())!==null&&t!==void 0?t:null;this.registeredEvents=Xi({updaterMap:Z5,eventMap:W5,prevProps:{},nextProps:this.props,instance:n}),this.setState(()=>({streetViewPanorama:n}),this.setStreetViewPanoramaCallback)}componentDidUpdate(t){this.state.streetViewPanorama!==null&&(Qi(this.registeredEvents),this.registeredEvents=Xi({updaterMap:Z5,eventMap:W5,prevProps:t,nextProps:this.props,instance:this.state.streetViewPanorama}))}componentWillUnmount(){this.state.streetViewPanorama!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.streetViewPanorama),Qi(this.registeredEvents),this.state.streetViewPanorama.setVisible(!1))}render(){return null}}Sr(_ge,"contextType",Ri);class xge extends j.PureComponent{constructor(){super(...arguments),Sr(this,"state",{streetViewService:null}),Sr(this,"setStreetViewServiceCallback",()=>{this.state.streetViewService!==null&&this.props.onLoad&&this.props.onLoad(this.state.streetViewService)})}componentDidMount(){var t=new google.maps.StreetViewService;this.setState(function(){return{streetViewService:t}},this.setStreetViewServiceCallback)}componentWillUnmount(){this.state.streetViewService!==null&&this.props.onUnmount&&this.props.onUnmount(this.state.streetViewService)}render(){return null}}Sr(xge,"contextType",Ri);var X5={onDirectionsChanged:"directions_changed"},K5={directions(e,t){e.setDirections(t)},map(e,t){e.setMap(t)},options(e,t){e.setOptions(t)},panel(e,t){e.setPanel(t)},routeIndex(e,t){e.setRouteIndex(t)}};class bge extends j.PureComponent{constructor(){super(...arguments),Sr(this,"registeredEvents",[]),Sr(this,"state",{directionsRenderer:null}),Sr(this,"setDirectionsRendererCallback",()=>{this.state.directionsRenderer!==null&&(this.state.directionsRenderer.setMap(this.context),this.props.onLoad&&this.props.onLoad(this.state.directionsRenderer))})}componentDidMount(){var t=new google.maps.DirectionsRenderer(this.props.options);this.registeredEvents=Xi({updaterMap:K5,eventMap:X5,prevProps:{},nextProps:this.props,instance:t}),this.setState(function(){return{directionsRenderer:t}},this.setDirectionsRendererCallback)}componentDidUpdate(t){this.state.directionsRenderer!==null&&(Qi(this.registeredEvents),this.registeredEvents=Xi({updaterMap:K5,eventMap:X5,prevProps:t,nextProps:this.props,instance:this.state.directionsRenderer}))}componentWillUnmount(){this.state.directionsRenderer!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.directionsRenderer),Qi(this.registeredEvents),this.state.directionsRenderer&&this.state.directionsRenderer.setMap(null))}render(){return null}}Sr(bge,"contextType",Ri);var Y5={onPlacesChanged:"places_changed"},J5={bounds(e,t){e.setBounds(t)}};class wge extends j.PureComponent{constructor(){super(...arguments),Sr(this,"registeredEvents",[]),Sr(this,"containerElement",j.createRef()),Sr(this,"state",{searchBox:null}),Sr(this,"setSearchBoxCallback",()=>{this.state.searchBox!==null&&this.props.onLoad&&this.props.onLoad(this.state.searchBox)})}componentDidMount(){if(xa(!!google.maps.places,'You need to provide libraries={["places"]} prop to <LoadScript /> component %s',google.maps.places),this.containerElement!==null&&this.containerElement.current!==null){var t=this.containerElement.current.querySelector("input");if(t!==null){var r=new google.maps.places.SearchBox(t,this.props.options);this.registeredEvents=Xi({updaterMap:J5,eventMap:Y5,prevProps:{},nextProps:this.props,instance:r}),this.setState(function(){return{searchBox:r}},this.setSearchBoxCallback)}}}componentDidUpdate(t){this.state.searchBox!==null&&(Qi(this.registeredEvents),this.registeredEvents=Xi({updaterMap:J5,eventMap:Y5,prevProps:t,nextProps:this.props,instance:this.state.searchBox}))}componentWillUnmount(){this.state.searchBox!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.searchBox),Qi(this.registeredEvents))}render(){return b.jsx("div",{ref:this.containerElement,children:j.Children.only(this.props.children)})}}Sr(wge,"contextType",Ri);var Q5={onPlaceChanged:"place_changed"},e6={bounds(e,t){e.setBounds(t)},restrictions(e,t){e.setComponentRestrictions(t)},fields(e,t){e.setFields(t)},options(e,t){e.setOptions(t)},types(e,t){e.setTypes(t)}};class sX extends j.PureComponent{constructor(){super(...arguments),Sr(this,"registeredEvents",[]),Sr(this,"containerElement",j.createRef()),Sr(this,"state",{autocomplete:null}),Sr(this,"setAutocompleteCallback",()=>{this.state.autocomplete!==null&&this.props.onLoad&&this.props.onLoad(this.state.autocomplete)})}componentDidMount(){var t;xa(!!google.maps.places,'You need to provide libraries={["places"]} prop to <LoadScript /> component %s',google.maps.places);var r=(t=this.containerElement.current)===null||t===void 0?void 0:t.querySelector("input");if(r){var n=new google.maps.places.Autocomplete(r,this.props.options);this.registeredEvents=Xi({updaterMap:e6,eventMap:Q5,prevProps:{},nextProps:this.props,instance:n}),this.setState(()=>({autocomplete:n}),this.setAutocompleteCallback)}}componentDidUpdate(t){Qi(this.registeredEvents),this.registeredEvents=Xi({updaterMap:e6,eventMap:Q5,prevProps:t,nextProps:this.props,instance:this.state.autocomplete})}componentWillUnmount(){this.state.autocomplete!==null&&Qi(this.registeredEvents)}render(){return b.jsx("div",{ref:this.containerElement,className:this.props.className,children:j.Children.only(this.props.children)})}}Sr(sX,"defaultProps",{className:""});Sr(sX,"contextType",Ri);const t6=["drawing","places"],Sge={width:"100%",height:"400px"},Ege={lat:4.05,lng:9.7},Aj=({onClose:e,onSelect:t})=>{const[r,n]=j.useState(null),[a,u]=j.useState(!1),[f,i]=j.useState(""),[y,w]=j.useState(!1),T=j.useRef(null),A=j.useRef(null),k=j.useRef(null),F=j.useRef(null),D=j.useRef(null),O=j.useRef(null),N=j.useRef(null),V=j.useCallback(be=>{console.log("[MapModal] Polygon completé!",be);const xe=be.getPath().getArray().map(Le=>({lat:Le.lat(),lng:Le.lng()}));console.log("[MapModal] Points du polygone:",xe),n(xe),w(!0),u(!1),be.setMap(null),k.current&&k.current.setDrawingMode(null)},[]),H=()=>{if(r){if(r.length===1){const{lat:be,lng:xe}=r[0],Le=`${be},${xe}`;console.log("[MapModal] Coordonnées sélectionnées (point):",Le),t(Le),e()}else if(r.length>1){const be=r.map(xe=>`${xe.lat},${xe.lng}`).join("|");console.log("[MapModal] Coordonnées sélectionnées (zone):",be),t(be),e()}}},Z=()=>{n(null),w(!1),F.current&&F.current.setMap(null),N.current&&N.current.setMap(null),k.current&&k.current.setDrawingMode(google.maps.drawing.OverlayType.POLYGON)},J=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(be=>{const xe={lat:be.coords.latitude,lng:be.coords.longitude};A.current&&(A.current.setCenter(xe),A.current.setZoom(15),n([xe]),w(!0))},be=>{console.error("Erreur de géolocalisation:",be),alert("Impossible d'accéder à votre position. Veuillez vérifier les autorisations de votre navigateur.")}):alert("La géolocalisation n'est pas supportée par ce navigateur.")},G=be=>{var xe;if(be.preventDefault(),f.trim()&&O.current){const Le=new Event("input",{bubbles:!0});(xe=D.current)==null||xe.dispatchEvent(Le)}},Y="AIzaSyDFfWEq1Umm06SNTbR-cRhRQ5Sq_taEAWQ";console.log("[DEBUG] Clé Google Maps lue depuis .env :",Y);const{isLoaded:ie,loadError:ce}=Ype({googleMapsApiKey:Y,libraries:t6});console.log("[MapModal] Bibliothèques chargées:",t6),console.log("[MapModal] isLoaded:",ie),console.log("[MapModal] loadError:",ce);const ge=j.useCallback(()=>{var xe,Le,ze;const be=(xe=O.current)==null?void 0:xe.getPlaces();if(be&&be.length>0&&be[0].geometry){const{location:Xe}=be[0].geometry;if(Xe){const Je={lat:Xe.lat(),lng:Xe.lng()};(Le=A.current)==null||Le.setCenter(Je),(ze=A.current)==null||ze.setZoom(15),n([Je]),w(!0)}}},[]);return j.useEffect(()=>{if(ie&&T.current&&!A.current){A.current=new window.google.maps.Map(T.current,{center:Ege,zoom:10,mapTypeId:"hybrid",mapTypeControl:!1,streetViewControl:!1,gestureHandling:"greedy",zoomControl:!0,clickableIcons:!0}),A.current&&A.current.addListener("click",xe=>{if(xe.latLng){const Le={lat:xe.latLng.lat(),lng:xe.latLng.lng()};n([Le]),w(!0),N.current&&N.current.setMap(null),N.current=new window.google.maps.Marker({position:Le,map:A.current,icon:{url:"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent(`
                  <svg width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="16" cy="16" r="12" fill="#2196F3" stroke="white" stroke-width="2"/>
                    <circle cx="16" cy="16" r="4" fill="white"/>
                  </svg>
                `),scaledSize:new window.google.maps.Size(32,32),anchor:new window.google.maps.Point(16,16)}})}}),D.current&&(O.current=new window.google.maps.places.SearchBox(D.current),A.current&&A.current.addListener("bounds_changed",()=>{var Le,ze;const xe=(Le=A.current)==null?void 0:Le.getBounds();xe&&((ze=O.current)==null||ze.setBounds(xe))}),O.current&&O.current.addListener("places_changed",ge)),console.log("[MapModal] Création du DrawingManager...");const be=new window.google.maps.drawing.DrawingManager({drawingControl:!0,drawingControlOptions:{position:window.google.maps.ControlPosition.TOP_CENTER,drawingModes:[window.google.maps.drawing.OverlayType.POLYGON]},polygonOptions:{fillColor:"#10B981",fillOpacity:.5,strokeWeight:2,clickable:!1,editable:!0,zIndex:1}});console.log("[MapModal] DrawingManager créé:",be),be.setMap(A.current),be.addListener("polygoncomplete",V),console.log("[MapModal] Listener polygoncomplete ajouté"),k.current=be,console.log("[MapModal] DrawingManager configuré et assigné")}},[ie,V,ge]),j.useEffect(()=>{A.current&&(F.current&&F.current.setMap(null),N.current&&N.current.setMap(null),r&&(r.length===1?N.current=new window.google.maps.Marker({position:r[0],map:A.current,icon:{url:"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent(`
                <svg width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
                  <circle cx="16" cy="16" r="12" fill="#10B981" stroke="white" stroke-width="2"/>
                  <circle cx="16" cy="16" r="4" fill="white"/>
                </svg>
              `),scaledSize:new window.google.maps.Size(32,32),anchor:new window.google.maps.Point(16,16)}}):r.length>1&&(F.current=new window.google.maps.Polygon({paths:r,fillColor:"#10B981",fillOpacity:.5,strokeWeight:2,clickable:!1,editable:!0,zIndex:1}),F.current&&F.current.setMap(A.current))))},[r]),ce?b.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-[9999]",children:b.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-xl max-w-md mx-4",children:[b.jsx("h2",{className:"text-lg font-bold mb-4 text-red-600",children:"❌ Erreur de chargement"}),b.jsx("p",{className:"text-gray-700 mb-4",children:"Impossible de charger Google Maps. Veuillez vérifier votre connexion Internet et votre clé API."}),b.jsx("button",{onClick:e,className:"w-full bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition-colors",children:"Fermer"})]})}):ie?b.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-[9999]",children:b.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-xl w-full max-w-6xl max-h-[90vh] overflow-hidden mx-4",children:[b.jsxs("div",{className:"flex justify-between items-center mb-4",children:[b.jsxs("h2",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:[b.jsx(ou,{className:"w-6 h-6 text-green-600"}),"🗺️ Sélection de localisation GPS"]}),b.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700 transition-colors p-2 hover:bg-gray-100 rounded-full",children:b.jsx(Os,{size:24})})]}),b.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 h-[70vh]",children:[b.jsxs("div",{className:"lg:col-span-1 space-y-4 overflow-y-auto",children:[b.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[b.jsxs("h3",{className:"font-semibold text-blue-800 mb-2 flex items-center gap-2",children:[b.jsx(oy,{className:"w-5 h-5"}),"📋 Instructions"]}),b.jsxs("ul",{className:"text-sm text-blue-700 space-y-2",children:[b.jsxs("li",{className:"flex items-start gap-2",children:[b.jsx("span",{className:"text-blue-600 font-bold",children:"•"}),b.jsxs("span",{children:[b.jsx("strong",{children:"Cliquez"})," sur la carte pour sélectionner un point"]})]}),b.jsxs("li",{className:"flex items-start gap-2",children:[b.jsx("span",{className:"text-blue-600 font-bold",children:"•"}),b.jsxs("span",{children:[b.jsx("strong",{children:"Dessinez"})," une zone avec l'outil polygone (icône crayon)"]})]}),b.jsxs("li",{className:"flex items-start gap-2",children:[b.jsx("span",{className:"text-blue-600 font-bold",children:"•"}),b.jsxs("span",{children:[b.jsx("strong",{children:"Recherchez"})," une adresse dans la barre de recherche"]})]}),b.jsxs("li",{className:"flex items-start gap-2",children:[b.jsx("span",{className:"text-blue-600 font-bold",children:"•"}),b.jsxs("span",{children:[b.jsx("strong",{children:"Utilisez"}),' "Ma Position" pour votre GPS actuel']})]})]})]}),b.jsxs("div",{className:"space-y-3",children:[b.jsxs("button",{onClick:J,className:"w-full flex items-center justify-center gap-2 px-4 py-3 rounded-lg bg-green-500 text-white hover:bg-green-600 transition-colors shadow-md hover:shadow-lg",children:[b.jsx(Gce,{size:18}),"📍 Ma Position GPS"]}),b.jsxs("form",{onSubmit:G,className:"relative",children:[b.jsx(Gue,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:20}),b.jsx("input",{ref:D,type:"text",value:f,onChange:be=>i(be.target.value),placeholder:"🔍 Rechercher une adresse...",className:"w-full pl-10 pr-4 py-3 rounded-lg border border-gray-300 shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),b.jsx("button",{type:"submit",className:"absolute right-2 top-1/2 -translate-y-1/2 bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600 transition-colors",children:"OK"})]})]}),b.jsxs("div",{className:`bg-gray-50 p-4 rounded-lg border transition-all duration-300 ${r?"border-green-300 bg-green-50":"border-gray-200"}`,children:[b.jsx("h3",{className:`font-semibold mb-2 flex items-center gap-2 ${r?"text-green-800":"text-gray-600"}`,children:r?b.jsxs(b.Fragment,{children:[b.jsx(oy,{className:"w-5 h-5 text-green-600"}),"✅ Coordonnées sélectionnées"]}):b.jsxs(b.Fragment,{children:[b.jsx(gx,{className:"w-5 h-5 text-gray-500"}),"📍 Aucune position sélectionnée"]})}),r?b.jsx("div",{className:"text-sm space-y-2",children:r.length===1?b.jsxs("div",{children:[b.jsx("div",{className:"font-medium text-green-700 mb-2",children:"📍 Point unique :"}),b.jsxs("div",{className:"bg-white p-3 rounded border-2 border-green-200 font-mono text-xs bg-green-50",children:[b.jsx("div",{className:"font-semibold text-green-800",children:"Latitude:"}),b.jsx("div",{className:"text-green-700",children:r[0].lat.toFixed(6)}),b.jsx("div",{className:"font-semibold text-green-800 mt-2",children:"Longitude:"}),b.jsx("div",{className:"text-green-700",children:r[0].lng.toFixed(6)})]})]}):b.jsxs("div",{children:[b.jsxs("div",{className:"font-medium text-green-700 mb-2",children:["🎯 Zone avec ",r.length," points :"]}),b.jsx("div",{className:"bg-white p-3 rounded border-2 border-green-200 max-h-32 overflow-y-auto bg-green-50",children:r.map((be,xe)=>b.jsxs("div",{className:"font-mono text-xs mb-2 p-2 bg-white rounded border",children:[b.jsxs("div",{className:"font-semibold text-green-800",children:["Point ",xe+1,":"]}),b.jsxs("div",{className:"text-green-700",children:["Lat: ",be.lat.toFixed(6)]}),b.jsxs("div",{className:"text-green-700",children:["Lng: ",be.lng.toFixed(6)]})]},xe))})]})}):b.jsx("div",{className:"text-sm text-gray-600 bg-white p-3 rounded border",children:"Cliquez sur la carte ou utilisez la recherche pour sélectionner une position"})]}),b.jsxs("div",{className:"flex gap-2 bg-white p-3 rounded-lg border border-gray-200 shadow-sm",children:[b.jsx("button",{onClick:Z,disabled:!r,className:"flex-1 px-4 py-3 rounded-lg bg-yellow-500 text-white hover:bg-yellow-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:"🗑️ Effacer"}),b.jsxs("button",{onClick:H,disabled:!r,className:"flex-1 px-4 py-3 rounded-lg bg-green-600 text-white hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2 shadow-md",children:[b.jsx(oy,{className:"w-5 h-5"}),"✅ Confirmer"]})]})]}),b.jsxs("div",{className:"lg:col-span-2 relative",children:[b.jsx("div",{ref:T,style:{...Sge,height:"100%"},className:"rounded-lg border-2 border-gray-200 shadow-lg"}),b.jsx("div",{className:"absolute top-4 left-4 bg-white p-3 rounded-lg shadow-lg border border-gray-200",children:b.jsx("div",{className:"text-sm font-medium text-gray-700",children:r&&r.length>1?b.jsx("span",{className:"text-blue-600 flex items-center gap-2",children:"🎯 Mode: Zone"}):b.jsx("span",{className:"text-green-600 flex items-center gap-2",children:"📍 Mode: Point"})})}),r&&b.jsx("div",{className:"absolute bottom-4 left-4 bg-green-500 text-white p-3 rounded-lg shadow-lg",children:b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx(oy,{className:"w-5 h-5"}),b.jsx("span",{className:"font-medium",children:r.length===1?"Point sélectionné":"Zone sélectionnée"})]})})]})]})]})}):b.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-[9999]",children:b.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-xl max-w-md mx-4",children:[b.jsx("div",{className:"flex items-center justify-center mb-4",children:b.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}),b.jsx("h2",{className:"text-lg font-bold mb-2 text-blue-600",children:"🗺️ Chargement de la carte..."}),b.jsx("p",{className:"text-gray-600 text-center",children:"Initialisation de Google Maps en cours..."})]})})},Tge=({onClose:e,onConfirm:t})=>{const[r,n]=j.useState(!1),[a,u]=j.useState(null),[f,i]=j.useState(null),y=j.useRef(null),w=j.useRef([]),T=j.useRef(null),A=j.useRef(null),k=j.useRef(null),F=V=>{const H=new(window.AudioContext||window.webkitAudioContext);k.current=H;const Z=H.createMediaStreamSource(V),J=H.createAnalyser();J.fftSize=2048;const G=J.frequencyBinCount,Y=new Uint8Array(G);Z.connect(J);const ie=T.current;if(!ie)return;const ce=ie.getContext("2d");if(!ce)return;const ge=()=>{A.current=requestAnimationFrame(ge),J.getByteTimeDomainData(Y);let be=0;for(let st=0;st<G;st++)be+=Y[st];const Le=(be/G-128)/10;ce.fillStyle="#f8fafc",ce.fillRect(0,0,ie.width,ie.height);const ze=Math.max(0,255-Le*25),Xe=Math.min(255,Le*25);ce.strokeStyle=`rgb(${Xe}, 80, ${ze})`,ce.lineWidth=2,ce.beginPath();const Je=ie.width*1/G;let tt=0;for(let st=0;st<G;st++){const We=Y[st]/128*ie.height/2;st===0?ce.moveTo(tt,We):ce.lineTo(tt,We),tt+=Je}ce.lineTo(ie.width,ie.height/2),ce.stroke()};ge()},D=async()=>{try{const V=await navigator.mediaDevices.getUserMedia({audio:!0});F(V),y.current=new MediaRecorder(V),y.current.ondataavailable=H=>{w.current.push(H.data)},y.current.onstop=()=>{const H=new Blob(w.current,{type:"audio/wav"});i(H);const Z=URL.createObjectURL(H);u(Z),w.current=[],V.getTracks().forEach(J=>J.stop()),A.current&&cancelAnimationFrame(A.current),k.current&&k.current.state!=="closed"&&k.current.close()},w.current=[],y.current.start(),n(!0),u(null),i(null)}catch(V){console.error("Erreur d'accès au microphone:",V),alert("Impossible d'accéder au microphone. Veuillez vérifier les autorisations de votre navigateur.")}},O=()=>{y.current&&(y.current.stop(),n(!1))},N=()=>{if(f){const V=new FileReader;V.onload=()=>{const H=V.result,Z={name:`enregistrement-${Date.now()}.wav`,data:H,type:"audio/wav"};t(Z),e()},V.readAsDataURL(f)}};return j.useEffect(()=>()=>{y.current&&y.current.stream&&y.current.stream.getTracks().forEach(V=>V.stop()),A.current&&cancelAnimationFrame(A.current),k.current&&k.current.state!=="closed"&&k.current.close()},[]),b.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:b.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-md",children:[b.jsx("h2",{className:"text-lg font-bold mb-4",children:"Enregistreur Audio"}),b.jsxs("div",{className:"flex flex-col items-center gap-4",children:[!r&&!a&&b.jsx("button",{onClick:D,className:"px-4 py-2 rounded bg-green-500 text-white hover:bg-green-600",children:"Démarrer l'enregistrement"}),r&&b.jsxs("div",{className:"flex flex-col items-center w-full gap-2",children:[b.jsx("p",{className:"text-red-500 animate-pulse font-semibold",children:"Enregistrement..."}),b.jsx("canvas",{ref:T,className:"w-full h-24 bg-slate-50 rounded-md border"}),b.jsx("button",{onClick:O,className:"w-full px-4 py-2 rounded bg-red-500 text-white hover:bg-red-600",children:"Arrêter l'enregistrement"})]}),a&&!r&&b.jsxs("div",{className:"w-full",children:[b.jsx("p",{className:"text-center mb-2",children:"Aperçu :"}),b.jsx("audio",{src:a,controls:!0,className:"w-full"})]})]}),b.jsxs("div",{className:"flex justify-end gap-4 mt-6",children:[b.jsx("button",{onClick:e,className:"px-4 py-2 rounded bg-gray-300 hover:bg-gray-400",children:"Annuler"}),b.jsx("button",{onClick:N,disabled:!f,className:"px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700 disabled:bg-gray-400",children:"Confirmer et Utiliser"})]})]})})};function oX(e,t){return function(){return e.apply(t,arguments)}}const{toString:Cge}=Object.prototype,{getPrototypeOf:Pj}=Object,{iterator:KE,toStringTag:aX}=Symbol,YE=(e=>t=>{const r=Cge.call(t);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),eh=e=>(e=e.toLowerCase(),t=>YE(t)===e),JE=e=>t=>typeof t===e,{isArray:O_}=Array,$x=JE("undefined");function Age(e){return e!==null&&!$x(e)&&e.constructor!==null&&!$x(e.constructor)&&bc(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const lX=eh("ArrayBuffer");function Pge(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&lX(e.buffer),t}const Mge=JE("string"),bc=JE("function"),cX=JE("number"),QE=e=>e!==null&&typeof e=="object",Ige=e=>e===!0||e===!1,Hw=e=>{if(YE(e)!=="object")return!1;const t=Pj(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(aX in e)&&!(KE in e)},kge=eh("Date"),Oge=eh("File"),Lge=eh("Blob"),Rge=eh("FileList"),jge=e=>QE(e)&&bc(e.pipe),Dge=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||bc(e.append)&&((t=YE(e))==="formdata"||t==="object"&&bc(e.toString)&&e.toString()==="[object FormData]"))},Nge=eh("URLSearchParams"),[zge,Fge,Bge,$ge]=["ReadableStream","Request","Response","Headers"].map(eh),Vge=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Fb(e,t,{allOwnKeys:r=!1}={}){if(e===null||typeof e>"u")return;let n,a;if(typeof e!="object"&&(e=[e]),O_(e))for(n=0,a=e.length;n<a;n++)t.call(null,e[n],n,e);else{const u=r?Object.getOwnPropertyNames(e):Object.keys(e),f=u.length;let i;for(n=0;n<f;n++)i=u[n],t.call(null,e[i],i,e)}}function uX(e,t){t=t.toLowerCase();const r=Object.keys(e);let n=r.length,a;for(;n-- >0;)if(a=r[n],t===a.toLowerCase())return a;return null}const ly=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,dX=e=>!$x(e)&&e!==ly;function kO(){const{caseless:e}=dX(this)&&this||{},t={},r=(n,a)=>{const u=e&&uX(t,a)||a;Hw(t[u])&&Hw(n)?t[u]=kO(t[u],n):Hw(n)?t[u]=kO({},n):O_(n)?t[u]=n.slice():t[u]=n};for(let n=0,a=arguments.length;n<a;n++)arguments[n]&&Fb(arguments[n],r);return t}const Uge=(e,t,r,{allOwnKeys:n}={})=>(Fb(t,(a,u)=>{r&&bc(a)?e[u]=oX(a,r):e[u]=a},{allOwnKeys:n}),e),qge=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),Gge=(e,t,r,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},Hge=(e,t,r,n)=>{let a,u,f;const i={};if(t=t||{},e==null)return t;do{for(a=Object.getOwnPropertyNames(e),u=a.length;u-- >0;)f=a[u],(!n||n(f,e,t))&&!i[f]&&(t[f]=e[f],i[f]=!0);e=r!==!1&&Pj(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},Wge=(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;const n=e.indexOf(t,r);return n!==-1&&n===r},Zge=e=>{if(!e)return null;if(O_(e))return e;let t=e.length;if(!cX(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},Xge=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&Pj(Uint8Array)),Kge=(e,t)=>{const n=(e&&e[KE]).call(e);let a;for(;(a=n.next())&&!a.done;){const u=a.value;t.call(e,u[0],u[1])}},Yge=(e,t)=>{let r;const n=[];for(;(r=e.exec(t))!==null;)n.push(r);return n},Jge=eh("HTMLFormElement"),Qge=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,n,a){return n.toUpperCase()+a}),r6=(({hasOwnProperty:e})=>(t,r)=>e.call(t,r))(Object.prototype),eye=eh("RegExp"),hX=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),n={};Fb(r,(a,u)=>{let f;(f=t(a,u,e))!==!1&&(n[u]=f||a)}),Object.defineProperties(e,n)},tye=e=>{hX(e,(t,r)=>{if(bc(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const n=e[r];if(bc(n)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},rye=(e,t)=>{const r={},n=a=>{a.forEach(u=>{r[u]=!0})};return O_(e)?n(e):n(String(e).split(t)),r},nye=()=>{},iye=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function sye(e){return!!(e&&bc(e.append)&&e[aX]==="FormData"&&e[KE])}const oye=e=>{const t=new Array(10),r=(n,a)=>{if(QE(n)){if(t.indexOf(n)>=0)return;if(!("toJSON"in n)){t[a]=n;const u=O_(n)?[]:{};return Fb(n,(f,i)=>{const y=r(f,a+1);!$x(y)&&(u[i]=y)}),t[a]=void 0,u}}return n};return r(e,0)},aye=eh("AsyncFunction"),lye=e=>e&&(QE(e)||bc(e))&&bc(e.then)&&bc(e.catch),fX=((e,t)=>e?setImmediate:t?((r,n)=>(ly.addEventListener("message",({source:a,data:u})=>{a===ly&&u===r&&n.length&&n.shift()()},!1),a=>{n.push(a),ly.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",bc(ly.postMessage)),cye=typeof queueMicrotask<"u"?queueMicrotask.bind(ly):typeof process<"u"&&process.nextTick||fX,uye=e=>e!=null&&bc(e[KE]),lr={isArray:O_,isArrayBuffer:lX,isBuffer:Age,isFormData:Dge,isArrayBufferView:Pge,isString:Mge,isNumber:cX,isBoolean:Ige,isObject:QE,isPlainObject:Hw,isReadableStream:zge,isRequest:Fge,isResponse:Bge,isHeaders:$ge,isUndefined:$x,isDate:kge,isFile:Oge,isBlob:Lge,isRegExp:eye,isFunction:bc,isStream:jge,isURLSearchParams:Nge,isTypedArray:Xge,isFileList:Rge,forEach:Fb,merge:kO,extend:Uge,trim:Vge,stripBOM:qge,inherits:Gge,toFlatObject:Hge,kindOf:YE,kindOfTest:eh,endsWith:Wge,toArray:Zge,forEachEntry:Kge,matchAll:Yge,isHTMLForm:Jge,hasOwnProperty:r6,hasOwnProp:r6,reduceDescriptors:hX,freezeMethods:tye,toObjectSet:rye,toCamelCase:Qge,noop:nye,toFiniteNumber:iye,findKey:uX,global:ly,isContextDefined:dX,isSpecCompliantForm:sye,toJSONObject:oye,isAsyncFn:aye,isThenable:lye,setImmediate:fX,asap:cye,isIterable:uye};function _i(e,t,r,n,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),a&&(this.response=a,this.status=a.status?a.status:null)}lr.inherits(_i,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:lr.toJSONObject(this.config),code:this.code,status:this.status}}});const pX=_i.prototype,mX={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{mX[e]={value:e}});Object.defineProperties(_i,mX);Object.defineProperty(pX,"isAxiosError",{value:!0});_i.from=(e,t,r,n,a,u)=>{const f=Object.create(pX);return lr.toFlatObject(e,f,function(y){return y!==Error.prototype},i=>i!=="isAxiosError"),_i.call(f,e.message,t,r,n,a),f.cause=e,f.name=e.name,u&&Object.assign(f,u),f};const dye=null;function OO(e){return lr.isPlainObject(e)||lr.isArray(e)}function gX(e){return lr.endsWith(e,"[]")?e.slice(0,-2):e}function n6(e,t,r){return e?e.concat(t).map(function(a,u){return a=gX(a),!r&&u?"["+a+"]":a}).join(r?".":""):t}function hye(e){return lr.isArray(e)&&!e.some(OO)}const fye=lr.toFlatObject(lr,{},null,function(t){return/^is[A-Z]/.test(t)});function e2(e,t,r){if(!lr.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,r=lr.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(O,N){return!lr.isUndefined(N[O])});const n=r.metaTokens,a=r.visitor||T,u=r.dots,f=r.indexes,y=(r.Blob||typeof Blob<"u"&&Blob)&&lr.isSpecCompliantForm(t);if(!lr.isFunction(a))throw new TypeError("visitor must be a function");function w(D){if(D===null)return"";if(lr.isDate(D))return D.toISOString();if(!y&&lr.isBlob(D))throw new _i("Blob is not supported. Use a Buffer instead.");return lr.isArrayBuffer(D)||lr.isTypedArray(D)?y&&typeof Blob=="function"?new Blob([D]):Buffer.from(D):D}function T(D,O,N){let V=D;if(D&&!N&&typeof D=="object"){if(lr.endsWith(O,"{}"))O=n?O:O.slice(0,-2),D=JSON.stringify(D);else if(lr.isArray(D)&&hye(D)||(lr.isFileList(D)||lr.endsWith(O,"[]"))&&(V=lr.toArray(D)))return O=gX(O),V.forEach(function(Z,J){!(lr.isUndefined(Z)||Z===null)&&t.append(f===!0?n6([O],J,u):f===null?O:O+"[]",w(Z))}),!1}return OO(D)?!0:(t.append(n6(N,O,u),w(D)),!1)}const A=[],k=Object.assign(fye,{defaultVisitor:T,convertValue:w,isVisitable:OO});function F(D,O){if(!lr.isUndefined(D)){if(A.indexOf(D)!==-1)throw Error("Circular reference detected in "+O.join("."));A.push(D),lr.forEach(D,function(V,H){(!(lr.isUndefined(V)||V===null)&&a.call(t,V,lr.isString(H)?H.trim():H,O,k))===!0&&F(V,O?O.concat(H):[H])}),A.pop()}}if(!lr.isObject(e))throw new TypeError("data must be an object");return F(e),t}function i6(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function Mj(e,t){this._pairs=[],e&&e2(e,this,t)}const yX=Mj.prototype;yX.append=function(t,r){this._pairs.push([t,r])};yX.toString=function(t){const r=t?function(n){return t.call(this,n,i6)}:i6;return this._pairs.map(function(a){return r(a[0])+"="+r(a[1])},"").join("&")};function pye(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function vX(e,t,r){if(!t)return e;const n=r&&r.encode||pye;lr.isFunction(r)&&(r={serialize:r});const a=r&&r.serialize;let u;if(a?u=a(t,r):u=lr.isURLSearchParams(t)?t.toString():new Mj(t,r).toString(n),u){const f=e.indexOf("#");f!==-1&&(e=e.slice(0,f)),e+=(e.indexOf("?")===-1?"?":"&")+u}return e}class s6{constructor(){this.handlers=[]}use(t,r,n){return this.handlers.push({fulfilled:t,rejected:r,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){lr.forEach(this.handlers,function(n){n!==null&&t(n)})}}const _X={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},mye=typeof URLSearchParams<"u"?URLSearchParams:Mj,gye=typeof FormData<"u"?FormData:null,yye=typeof Blob<"u"?Blob:null,vye={isBrowser:!0,classes:{URLSearchParams:mye,FormData:gye,Blob:yye},protocols:["http","https","file","blob","url","data"]},Ij=typeof window<"u"&&typeof document<"u",LO=typeof navigator=="object"&&navigator||void 0,_ye=Ij&&(!LO||["ReactNative","NativeScript","NS"].indexOf(LO.product)<0),xye=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",bye=Ij&&window.location.href||"http://localhost",wye=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ij,hasStandardBrowserEnv:_ye,hasStandardBrowserWebWorkerEnv:xye,navigator:LO,origin:bye},Symbol.toStringTag,{value:"Module"})),vl={...wye,...vye};function Sye(e,t){return e2(e,new vl.classes.URLSearchParams,Object.assign({visitor:function(r,n,a,u){return vl.isNode&&lr.isBuffer(r)?(this.append(n,r.toString("base64")),!1):u.defaultVisitor.apply(this,arguments)}},t))}function Eye(e){return lr.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function Tye(e){const t={},r=Object.keys(e);let n;const a=r.length;let u;for(n=0;n<a;n++)u=r[n],t[u]=e[u];return t}function xX(e){function t(r,n,a,u){let f=r[u++];if(f==="__proto__")return!0;const i=Number.isFinite(+f),y=u>=r.length;return f=!f&&lr.isArray(a)?a.length:f,y?(lr.hasOwnProp(a,f)?a[f]=[a[f],n]:a[f]=n,!i):((!a[f]||!lr.isObject(a[f]))&&(a[f]=[]),t(r,n,a[f],u)&&lr.isArray(a[f])&&(a[f]=Tye(a[f])),!i)}if(lr.isFormData(e)&&lr.isFunction(e.entries)){const r={};return lr.forEachEntry(e,(n,a)=>{t(Eye(n),a,r,0)}),r}return null}function Cye(e,t,r){if(lr.isString(e))try{return(t||JSON.parse)(e),lr.trim(e)}catch(n){if(n.name!=="SyntaxError")throw n}return(r||JSON.stringify)(e)}const Bb={transitional:_X,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const n=r.getContentType()||"",a=n.indexOf("application/json")>-1,u=lr.isObject(t);if(u&&lr.isHTMLForm(t)&&(t=new FormData(t)),lr.isFormData(t))return a?JSON.stringify(xX(t)):t;if(lr.isArrayBuffer(t)||lr.isBuffer(t)||lr.isStream(t)||lr.isFile(t)||lr.isBlob(t)||lr.isReadableStream(t))return t;if(lr.isArrayBufferView(t))return t.buffer;if(lr.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let i;if(u){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Sye(t,this.formSerializer).toString();if((i=lr.isFileList(t))||n.indexOf("multipart/form-data")>-1){const y=this.env&&this.env.FormData;return e2(i?{"files[]":t}:t,y&&new y,this.formSerializer)}}return u||a?(r.setContentType("application/json",!1),Cye(t)):t}],transformResponse:[function(t){const r=this.transitional||Bb.transitional,n=r&&r.forcedJSONParsing,a=this.responseType==="json";if(lr.isResponse(t)||lr.isReadableStream(t))return t;if(t&&lr.isString(t)&&(n&&!this.responseType||a)){const f=!(r&&r.silentJSONParsing)&&a;try{return JSON.parse(t)}catch(i){if(f)throw i.name==="SyntaxError"?_i.from(i,_i.ERR_BAD_RESPONSE,this,null,this.response):i}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:vl.classes.FormData,Blob:vl.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};lr.forEach(["delete","get","head","post","put","patch"],e=>{Bb.headers[e]={}});const Aye=lr.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Pye=e=>{const t={};let r,n,a;return e&&e.split(`
`).forEach(function(f){a=f.indexOf(":"),r=f.substring(0,a).trim().toLowerCase(),n=f.substring(a+1).trim(),!(!r||t[r]&&Aye[r])&&(r==="set-cookie"?t[r]?t[r].push(n):t[r]=[n]:t[r]=t[r]?t[r]+", "+n:n)}),t},o6=Symbol("internals");function $0(e){return e&&String(e).trim().toLowerCase()}function Ww(e){return e===!1||e==null?e:lr.isArray(e)?e.map(Ww):String(e)}function Mye(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(e);)t[n[1]]=n[2];return t}const Iye=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function NC(e,t,r,n,a){if(lr.isFunction(n))return n.call(this,t,r);if(a&&(t=r),!!lr.isString(t)){if(lr.isString(n))return t.indexOf(n)!==-1;if(lr.isRegExp(n))return n.test(t)}}function kye(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,r,n)=>r.toUpperCase()+n)}function Oye(e,t){const r=lr.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+r,{value:function(a,u,f){return this[n].call(this,t,a,u,f)},configurable:!0})})}let wc=class{constructor(t){t&&this.set(t)}set(t,r,n){const a=this;function u(i,y,w){const T=$0(y);if(!T)throw new Error("header name must be a non-empty string");const A=lr.findKey(a,T);(!A||a[A]===void 0||w===!0||w===void 0&&a[A]!==!1)&&(a[A||y]=Ww(i))}const f=(i,y)=>lr.forEach(i,(w,T)=>u(w,T,y));if(lr.isPlainObject(t)||t instanceof this.constructor)f(t,r);else if(lr.isString(t)&&(t=t.trim())&&!Iye(t))f(Pye(t),r);else if(lr.isObject(t)&&lr.isIterable(t)){let i={},y,w;for(const T of t){if(!lr.isArray(T))throw TypeError("Object iterator must return a key-value pair");i[w=T[0]]=(y=i[w])?lr.isArray(y)?[...y,T[1]]:[y,T[1]]:T[1]}f(i,r)}else t!=null&&u(r,t,n);return this}get(t,r){if(t=$0(t),t){const n=lr.findKey(this,t);if(n){const a=this[n];if(!r)return a;if(r===!0)return Mye(a);if(lr.isFunction(r))return r.call(this,a,n);if(lr.isRegExp(r))return r.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=$0(t),t){const n=lr.findKey(this,t);return!!(n&&this[n]!==void 0&&(!r||NC(this,this[n],n,r)))}return!1}delete(t,r){const n=this;let a=!1;function u(f){if(f=$0(f),f){const i=lr.findKey(n,f);i&&(!r||NC(n,n[i],i,r))&&(delete n[i],a=!0)}}return lr.isArray(t)?t.forEach(u):u(t),a}clear(t){const r=Object.keys(this);let n=r.length,a=!1;for(;n--;){const u=r[n];(!t||NC(this,this[u],u,t,!0))&&(delete this[u],a=!0)}return a}normalize(t){const r=this,n={};return lr.forEach(this,(a,u)=>{const f=lr.findKey(n,u);if(f){r[f]=Ww(a),delete r[u];return}const i=t?kye(u):String(u).trim();i!==u&&delete r[u],r[i]=Ww(a),n[i]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const r=Object.create(null);return lr.forEach(this,(n,a)=>{n!=null&&n!==!1&&(r[a]=t&&lr.isArray(n)?n.join(", "):n)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,r])=>t+": "+r).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...r){const n=new this(t);return r.forEach(a=>n.set(a)),n}static accessor(t){const n=(this[o6]=this[o6]={accessors:{}}).accessors,a=this.prototype;function u(f){const i=$0(f);n[i]||(Oye(a,f),n[i]=!0)}return lr.isArray(t)?t.forEach(u):u(t),this}};wc.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);lr.reduceDescriptors(wc.prototype,({value:e},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(n){this[r]=n}}});lr.freezeMethods(wc);function zC(e,t){const r=this||Bb,n=t||r,a=wc.from(n.headers);let u=n.data;return lr.forEach(e,function(i){u=i.call(r,u,a.normalize(),t?t.status:void 0)}),a.normalize(),u}function bX(e){return!!(e&&e.__CANCEL__)}function L_(e,t,r){_i.call(this,e??"canceled",_i.ERR_CANCELED,t,r),this.name="CanceledError"}lr.inherits(L_,_i,{__CANCEL__:!0});function wX(e,t,r){const n=r.config.validateStatus;!r.status||!n||n(r.status)?e(r):t(new _i("Request failed with status code "+r.status,[_i.ERR_BAD_REQUEST,_i.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function Lye(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function Rye(e,t){e=e||10;const r=new Array(e),n=new Array(e);let a=0,u=0,f;return t=t!==void 0?t:1e3,function(y){const w=Date.now(),T=n[u];f||(f=w),r[a]=y,n[a]=w;let A=u,k=0;for(;A!==a;)k+=r[A++],A=A%e;if(a=(a+1)%e,a===u&&(u=(u+1)%e),w-f<t)return;const F=T&&w-T;return F?Math.round(k*1e3/F):void 0}}function jye(e,t){let r=0,n=1e3/t,a,u;const f=(w,T=Date.now())=>{r=T,a=null,u&&(clearTimeout(u),u=null),e.apply(null,w)};return[(...w)=>{const T=Date.now(),A=T-r;A>=n?f(w,T):(a=w,u||(u=setTimeout(()=>{u=null,f(a)},n-A)))},()=>a&&f(a)]}const TS=(e,t,r=3)=>{let n=0;const a=Rye(50,250);return jye(u=>{const f=u.loaded,i=u.lengthComputable?u.total:void 0,y=f-n,w=a(y),T=f<=i;n=f;const A={loaded:f,total:i,progress:i?f/i:void 0,bytes:y,rate:w||void 0,estimated:w&&i&&T?(i-f)/w:void 0,event:u,lengthComputable:i!=null,[t?"download":"upload"]:!0};e(A)},r)},a6=(e,t)=>{const r=e!=null;return[n=>t[0]({lengthComputable:r,total:e,loaded:n}),t[1]]},l6=e=>(...t)=>lr.asap(()=>e(...t)),Dye=vl.hasStandardBrowserEnv?((e,t)=>r=>(r=new URL(r,vl.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new URL(vl.origin),vl.navigator&&/(msie|trident)/i.test(vl.navigator.userAgent)):()=>!0,Nye=vl.hasStandardBrowserEnv?{write(e,t,r,n,a,u){const f=[e+"="+encodeURIComponent(t)];lr.isNumber(r)&&f.push("expires="+new Date(r).toGMTString()),lr.isString(n)&&f.push("path="+n),lr.isString(a)&&f.push("domain="+a),u===!0&&f.push("secure"),document.cookie=f.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function zye(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function Fye(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function SX(e,t,r){let n=!zye(t);return e&&(n||r==!1)?Fye(e,t):t}const c6=e=>e instanceof wc?{...e}:e;function wy(e,t){t=t||{};const r={};function n(w,T,A,k){return lr.isPlainObject(w)&&lr.isPlainObject(T)?lr.merge.call({caseless:k},w,T):lr.isPlainObject(T)?lr.merge({},T):lr.isArray(T)?T.slice():T}function a(w,T,A,k){if(lr.isUndefined(T)){if(!lr.isUndefined(w))return n(void 0,w,A,k)}else return n(w,T,A,k)}function u(w,T){if(!lr.isUndefined(T))return n(void 0,T)}function f(w,T){if(lr.isUndefined(T)){if(!lr.isUndefined(w))return n(void 0,w)}else return n(void 0,T)}function i(w,T,A){if(A in t)return n(w,T);if(A in e)return n(void 0,w)}const y={url:u,method:u,data:u,baseURL:f,transformRequest:f,transformResponse:f,paramsSerializer:f,timeout:f,timeoutMessage:f,withCredentials:f,withXSRFToken:f,adapter:f,responseType:f,xsrfCookieName:f,xsrfHeaderName:f,onUploadProgress:f,onDownloadProgress:f,decompress:f,maxContentLength:f,maxBodyLength:f,beforeRedirect:f,transport:f,httpAgent:f,httpsAgent:f,cancelToken:f,socketPath:f,responseEncoding:f,validateStatus:i,headers:(w,T,A)=>a(c6(w),c6(T),A,!0)};return lr.forEach(Object.keys(Object.assign({},e,t)),function(T){const A=y[T]||a,k=A(e[T],t[T],T);lr.isUndefined(k)&&A!==i||(r[T]=k)}),r}const EX=e=>{const t=wy({},e);let{data:r,withXSRFToken:n,xsrfHeaderName:a,xsrfCookieName:u,headers:f,auth:i}=t;t.headers=f=wc.from(f),t.url=vX(SX(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),i&&f.set("Authorization","Basic "+btoa((i.username||"")+":"+(i.password?unescape(encodeURIComponent(i.password)):"")));let y;if(lr.isFormData(r)){if(vl.hasStandardBrowserEnv||vl.hasStandardBrowserWebWorkerEnv)f.setContentType(void 0);else if((y=f.getContentType())!==!1){const[w,...T]=y?y.split(";").map(A=>A.trim()).filter(Boolean):[];f.setContentType([w||"multipart/form-data",...T].join("; "))}}if(vl.hasStandardBrowserEnv&&(n&&lr.isFunction(n)&&(n=n(t)),n||n!==!1&&Dye(t.url))){const w=a&&u&&Nye.read(u);w&&f.set(a,w)}return t},Bye=typeof XMLHttpRequest<"u",$ye=Bye&&function(e){return new Promise(function(r,n){const a=EX(e);let u=a.data;const f=wc.from(a.headers).normalize();let{responseType:i,onUploadProgress:y,onDownloadProgress:w}=a,T,A,k,F,D;function O(){F&&F(),D&&D(),a.cancelToken&&a.cancelToken.unsubscribe(T),a.signal&&a.signal.removeEventListener("abort",T)}let N=new XMLHttpRequest;N.open(a.method.toUpperCase(),a.url,!0),N.timeout=a.timeout;function V(){if(!N)return;const Z=wc.from("getAllResponseHeaders"in N&&N.getAllResponseHeaders()),G={data:!i||i==="text"||i==="json"?N.responseText:N.response,status:N.status,statusText:N.statusText,headers:Z,config:e,request:N};wX(function(ie){r(ie),O()},function(ie){n(ie),O()},G),N=null}"onloadend"in N?N.onloadend=V:N.onreadystatechange=function(){!N||N.readyState!==4||N.status===0&&!(N.responseURL&&N.responseURL.indexOf("file:")===0)||setTimeout(V)},N.onabort=function(){N&&(n(new _i("Request aborted",_i.ECONNABORTED,e,N)),N=null)},N.onerror=function(){n(new _i("Network Error",_i.ERR_NETWORK,e,N)),N=null},N.ontimeout=function(){let J=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const G=a.transitional||_X;a.timeoutErrorMessage&&(J=a.timeoutErrorMessage),n(new _i(J,G.clarifyTimeoutError?_i.ETIMEDOUT:_i.ECONNABORTED,e,N)),N=null},u===void 0&&f.setContentType(null),"setRequestHeader"in N&&lr.forEach(f.toJSON(),function(J,G){N.setRequestHeader(G,J)}),lr.isUndefined(a.withCredentials)||(N.withCredentials=!!a.withCredentials),i&&i!=="json"&&(N.responseType=a.responseType),w&&([k,D]=TS(w,!0),N.addEventListener("progress",k)),y&&N.upload&&([A,F]=TS(y),N.upload.addEventListener("progress",A),N.upload.addEventListener("loadend",F)),(a.cancelToken||a.signal)&&(T=Z=>{N&&(n(!Z||Z.type?new L_(null,e,N):Z),N.abort(),N=null)},a.cancelToken&&a.cancelToken.subscribe(T),a.signal&&(a.signal.aborted?T():a.signal.addEventListener("abort",T)));const H=Lye(a.url);if(H&&vl.protocols.indexOf(H)===-1){n(new _i("Unsupported protocol "+H+":",_i.ERR_BAD_REQUEST,e));return}N.send(u||null)})},Vye=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let n=new AbortController,a;const u=function(w){if(!a){a=!0,i();const T=w instanceof Error?w:this.reason;n.abort(T instanceof _i?T:new L_(T instanceof Error?T.message:T))}};let f=t&&setTimeout(()=>{f=null,u(new _i(`timeout ${t} of ms exceeded`,_i.ETIMEDOUT))},t);const i=()=>{e&&(f&&clearTimeout(f),f=null,e.forEach(w=>{w.unsubscribe?w.unsubscribe(u):w.removeEventListener("abort",u)}),e=null)};e.forEach(w=>w.addEventListener("abort",u));const{signal:y}=n;return y.unsubscribe=()=>lr.asap(i),y}},Uye=function*(e,t){let r=e.byteLength;if(r<t){yield e;return}let n=0,a;for(;n<r;)a=n+t,yield e.slice(n,a),n=a},qye=async function*(e,t){for await(const r of Gye(e))yield*Uye(r,t)},Gye=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:r,value:n}=await t.read();if(r)break;yield n}}finally{await t.cancel()}},u6=(e,t,r,n)=>{const a=qye(e,t);let u=0,f,i=y=>{f||(f=!0,n&&n(y))};return new ReadableStream({async pull(y){try{const{done:w,value:T}=await a.next();if(w){i(),y.close();return}let A=T.byteLength;if(r){let k=u+=A;r(k)}y.enqueue(new Uint8Array(T))}catch(w){throw i(w),w}},cancel(y){return i(y),a.return()}},{highWaterMark:2})},t2=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",TX=t2&&typeof ReadableStream=="function",Hye=t2&&(typeof TextEncoder=="function"?(e=>t=>e.encode(t))(new TextEncoder):async e=>new Uint8Array(await new Response(e).arrayBuffer())),CX=(e,...t)=>{try{return!!e(...t)}catch{return!1}},Wye=TX&&CX(()=>{let e=!1;const t=new Request(vl.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),d6=64*1024,RO=TX&&CX(()=>lr.isReadableStream(new Response("").body)),CS={stream:RO&&(e=>e.body)};t2&&(e=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!CS[t]&&(CS[t]=lr.isFunction(e[t])?r=>r[t]():(r,n)=>{throw new _i(`Response type '${t}' is not supported`,_i.ERR_NOT_SUPPORT,n)})})})(new Response);const Zye=async e=>{if(e==null)return 0;if(lr.isBlob(e))return e.size;if(lr.isSpecCompliantForm(e))return(await new Request(vl.origin,{method:"POST",body:e}).arrayBuffer()).byteLength;if(lr.isArrayBufferView(e)||lr.isArrayBuffer(e))return e.byteLength;if(lr.isURLSearchParams(e)&&(e=e+""),lr.isString(e))return(await Hye(e)).byteLength},Xye=async(e,t)=>{const r=lr.toFiniteNumber(e.getContentLength());return r??Zye(t)},Kye=t2&&(async e=>{let{url:t,method:r,data:n,signal:a,cancelToken:u,timeout:f,onDownloadProgress:i,onUploadProgress:y,responseType:w,headers:T,withCredentials:A="same-origin",fetchOptions:k}=EX(e);w=w?(w+"").toLowerCase():"text";let F=Vye([a,u&&u.toAbortSignal()],f),D;const O=F&&F.unsubscribe&&(()=>{F.unsubscribe()});let N;try{if(y&&Wye&&r!=="get"&&r!=="head"&&(N=await Xye(T,n))!==0){let G=new Request(t,{method:"POST",body:n,duplex:"half"}),Y;if(lr.isFormData(n)&&(Y=G.headers.get("content-type"))&&T.setContentType(Y),G.body){const[ie,ce]=a6(N,TS(l6(y)));n=u6(G.body,d6,ie,ce)}}lr.isString(A)||(A=A?"include":"omit");const V="credentials"in Request.prototype;D=new Request(t,{...k,signal:F,method:r.toUpperCase(),headers:T.normalize().toJSON(),body:n,duplex:"half",credentials:V?A:void 0});let H=await fetch(D);const Z=RO&&(w==="stream"||w==="response");if(RO&&(i||Z&&O)){const G={};["status","statusText","headers"].forEach(ge=>{G[ge]=H[ge]});const Y=lr.toFiniteNumber(H.headers.get("content-length")),[ie,ce]=i&&a6(Y,TS(l6(i),!0))||[];H=new Response(u6(H.body,d6,ie,()=>{ce&&ce(),O&&O()}),G)}w=w||"text";let J=await CS[lr.findKey(CS,w)||"text"](H,e);return!Z&&O&&O(),await new Promise((G,Y)=>{wX(G,Y,{data:J,headers:wc.from(H.headers),status:H.status,statusText:H.statusText,config:e,request:D})})}catch(V){throw O&&O(),V&&V.name==="TypeError"&&/Load failed|fetch/i.test(V.message)?Object.assign(new _i("Network Error",_i.ERR_NETWORK,e,D),{cause:V.cause||V}):_i.from(V,V&&V.code,e,D)}}),jO={http:dye,xhr:$ye,fetch:Kye};lr.forEach(jO,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const h6=e=>`- ${e}`,Yye=e=>lr.isFunction(e)||e===null||e===!1,AX={getAdapter:e=>{e=lr.isArray(e)?e:[e];const{length:t}=e;let r,n;const a={};for(let u=0;u<t;u++){r=e[u];let f;if(n=r,!Yye(r)&&(n=jO[(f=String(r)).toLowerCase()],n===void 0))throw new _i(`Unknown adapter '${f}'`);if(n)break;a[f||"#"+u]=n}if(!n){const u=Object.entries(a).map(([i,y])=>`adapter ${i} `+(y===!1?"is not supported by the environment":"is not available in the build"));let f=t?u.length>1?`since :
`+u.map(h6).join(`
`):" "+h6(u[0]):"as no adapter specified";throw new _i("There is no suitable adapter to dispatch the request "+f,"ERR_NOT_SUPPORT")}return n},adapters:jO};function FC(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new L_(null,e)}function f6(e){return FC(e),e.headers=wc.from(e.headers),e.data=zC.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),AX.getAdapter(e.adapter||Bb.adapter)(e).then(function(n){return FC(e),n.data=zC.call(e,e.transformResponse,n),n.headers=wc.from(n.headers),n},function(n){return bX(n)||(FC(e),n&&n.response&&(n.response.data=zC.call(e,e.transformResponse,n.response),n.response.headers=wc.from(n.response.headers))),Promise.reject(n)})}const PX="1.9.0",r2={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{r2[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const p6={};r2.transitional=function(t,r,n){function a(u,f){return"[Axios v"+PX+"] Transitional option '"+u+"'"+f+(n?". "+n:"")}return(u,f,i)=>{if(t===!1)throw new _i(a(f," has been removed"+(r?" in "+r:"")),_i.ERR_DEPRECATED);return r&&!p6[f]&&(p6[f]=!0,console.warn(a(f," has been deprecated since v"+r+" and will be removed in the near future"))),t?t(u,f,i):!0}};r2.spelling=function(t){return(r,n)=>(console.warn(`${n} is likely a misspelling of ${t}`),!0)};function Jye(e,t,r){if(typeof e!="object")throw new _i("options must be an object",_i.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let a=n.length;for(;a-- >0;){const u=n[a],f=t[u];if(f){const i=e[u],y=i===void 0||f(i,u,e);if(y!==!0)throw new _i("option "+u+" must be "+y,_i.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new _i("Unknown option "+u,_i.ERR_BAD_OPTION)}}const Zw={assertOptions:Jye,validators:r2},Jh=Zw.validators;let py=class{constructor(t){this.defaults=t||{},this.interceptors={request:new s6,response:new s6}}async request(t,r){try{return await this._request(t,r)}catch(n){if(n instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const u=a.stack?a.stack.replace(/^.+\n/,""):"";try{n.stack?u&&!String(n.stack).endsWith(u.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+u):n.stack=u}catch{}}throw n}}_request(t,r){typeof t=="string"?(r=r||{},r.url=t):r=t||{},r=wy(this.defaults,r);const{transitional:n,paramsSerializer:a,headers:u}=r;n!==void 0&&Zw.assertOptions(n,{silentJSONParsing:Jh.transitional(Jh.boolean),forcedJSONParsing:Jh.transitional(Jh.boolean),clarifyTimeoutError:Jh.transitional(Jh.boolean)},!1),a!=null&&(lr.isFunction(a)?r.paramsSerializer={serialize:a}:Zw.assertOptions(a,{encode:Jh.function,serialize:Jh.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),Zw.assertOptions(r,{baseUrl:Jh.spelling("baseURL"),withXsrfToken:Jh.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let f=u&&lr.merge(u.common,u[r.method]);u&&lr.forEach(["delete","get","head","post","put","patch","common"],D=>{delete u[D]}),r.headers=wc.concat(f,u);const i=[];let y=!0;this.interceptors.request.forEach(function(O){typeof O.runWhen=="function"&&O.runWhen(r)===!1||(y=y&&O.synchronous,i.unshift(O.fulfilled,O.rejected))});const w=[];this.interceptors.response.forEach(function(O){w.push(O.fulfilled,O.rejected)});let T,A=0,k;if(!y){const D=[f6.bind(this),void 0];for(D.unshift.apply(D,i),D.push.apply(D,w),k=D.length,T=Promise.resolve(r);A<k;)T=T.then(D[A++],D[A++]);return T}k=i.length;let F=r;for(A=0;A<k;){const D=i[A++],O=i[A++];try{F=D(F)}catch(N){O.call(this,N);break}}try{T=f6.call(this,F)}catch(D){return Promise.reject(D)}for(A=0,k=w.length;A<k;)T=T.then(w[A++],w[A++]);return T}getUri(t){t=wy(this.defaults,t);const r=SX(t.baseURL,t.url,t.allowAbsoluteUrls);return vX(r,t.params,t.paramsSerializer)}};lr.forEach(["delete","get","head","options"],function(t){py.prototype[t]=function(r,n){return this.request(wy(n||{},{method:t,url:r,data:(n||{}).data}))}});lr.forEach(["post","put","patch"],function(t){function r(n){return function(u,f,i){return this.request(wy(i||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:u,data:f}))}}py.prototype[t]=r(),py.prototype[t+"Form"]=r(!0)});let Qye=class MX{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(u){r=u});const n=this;this.promise.then(a=>{if(!n._listeners)return;let u=n._listeners.length;for(;u-- >0;)n._listeners[u](a);n._listeners=null}),this.promise.then=a=>{let u;const f=new Promise(i=>{n.subscribe(i),u=i}).then(a);return f.cancel=function(){n.unsubscribe(u)},f},t(function(u,f,i){n.reason||(n.reason=new L_(u,f,i),r(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=n=>{t.abort(n)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new MX(function(a){t=a}),cancel:t}}};function eve(e){return function(r){return e.apply(null,r)}}function tve(e){return lr.isObject(e)&&e.isAxiosError===!0}const DO={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(DO).forEach(([e,t])=>{DO[t]=e});function IX(e){const t=new py(e),r=oX(py.prototype.request,t);return lr.extend(r,py.prototype,t,{allOwnKeys:!0}),lr.extend(r,t,null,{allOwnKeys:!0}),r.create=function(a){return IX(wy(e,a))},r}const Wn=IX(Bb);Wn.Axios=py;Wn.CanceledError=L_;Wn.CancelToken=Qye;Wn.isCancel=bX;Wn.VERSION=PX;Wn.toFormData=e2;Wn.AxiosError=_i;Wn.Cancel=Wn.CanceledError;Wn.all=function(t){return Promise.all(t)};Wn.spread=eve;Wn.isAxiosError=tve;Wn.mergeConfig=wy;Wn.AxiosHeaders=wc;Wn.formToJSON=e=>xX(lr.isHTMLForm(e)?new FormData(e):e);Wn.getAdapter=AX.getAdapter;Wn.HttpStatusCode=DO;Wn.default=Wn;const{Axios:DFe,AxiosError:NFe,CanceledError:zFe,isCancel:FFe,CancelToken:BFe,VERSION:$Fe,all:VFe,Cancel:UFe,isAxiosError:qFe,spread:GFe,toFormData:HFe,AxiosHeaders:WFe,HttpStatusCode:ZFe,formToJSON:XFe,getAdapter:KFe,mergeConfig:YFe}=Wn,Lv=new Map,rve=()=>{const e=Date.now();for(const[t,r]of Lv.entries())e-r.timestamp>r.ttl&&Lv.delete(t)};setInterval(rve,5*60*1e3);const m6=(e,t,r,n)=>{const a=r?JSON.stringify(r):"",u=n?JSON.stringify(n):"";return`${t}:${e}:${a}:${u}`},nve=e=>new Promise(t=>setTimeout(t,e));function g6(e){const{url:t,method:r="GET",data:n,params:a,headers:u,cache:f={enabled:!1,ttl:5*60*1e3},retry:i={enabled:!1,maxRetries:3,delay:1e3},debounce:y={enabled:!1,delay:300},onSuccess:w,onError:T,onFinally:A}=e,[k,F]=j.useState(null),[D,O]=j.useState(!1),[N,V]=j.useState(null),H=j.useRef(null),Z=j.useRef(null),J=j.useCallback(async(ge={})=>{var Ue;const{url:be=t,method:xe=r,data:Le=n,params:ze=a,headers:Xe=u,cache:Je=f,retry:tt=i}=ge,st=Je.key||m6(be,xe,ze,Le);if(Je.enabled){const De=Lv.get(st);if(De&&Date.now()-De.timestamp<De.ttl)return F(De.data),V(null),w==null||w(De.data),De.data}Z.current&&Z.current.abort(),Z.current=new AbortController,O(!0),V(null);let Ne=null;const We=tt.enabled?tt.maxRetries||3:0;for(let De=0;De<=We;De++)try{const Ke={method:xe,url:be,data:Le,params:ze,headers:Xe,signal:Z.current.signal,timeout:be.includes("/api/ia/")?6e4:3e4},Ye=(await Wn(Ke)).data;return Je.enabled&&Lv.set(st,{data:Ye,timestamp:Date.now(),ttl:Je.ttl||5*60*1e3}),F(Ye),V(null),w==null||w(Ye),Ye}catch(Ke){const lt=Ke;if(Ne=lt,lt.name==="AbortError"||(Ue=lt.response)!=null&&Ue.status&&lt.response.status>=400&&lt.response.status<500&&lt.response.status!==429)break;De<We&&await nve(tt.delay||1e3)}return V(Ne),T==null||T(Ne),null},[t,r,n,a,u,f,i,w,T]),G=j.useCallback(async ge=>y.enabled?new Promise(be=>{H.current&&clearTimeout(H.current),H.current=setTimeout(async()=>{const xe=await J(ge);be(xe)},y.delay||300)}):J(ge),[J,y]),Y=j.useCallback(async()=>{const ge={...e,cache:{...f,enabled:!1}};return J(ge)},[J,e,f]),ie=j.useCallback(()=>{if(f.key)Lv.delete(f.key);else{const ge=m6(t,r,a,n);Lv.delete(ge)}},[f.key,t,r,a,n]),ce=j.useCallback(()=>{V(null)},[]);return j.useEffect(()=>()=>{Z.current&&Z.current.abort(),H.current&&clearTimeout(H.current)},[]),{data:k,loading:D,error:N,execute:G,refetch:Y,clearCache:ie,clearError:ce}}const ive=50*1024*1024,sve=10,ove=(e={})=>{const{maxFileSize:t=ive,maxFiles:r=sve,allowedTypes:n=[],onError:a}=e,[u,f]=j.useState([]),[i,y]=j.useState(!1),[w,T]=j.useState([]),A=j.useCallback(async H=>new Promise((Z,J)=>{const G=new FileReader;G.onload=()=>{const Y={name:H.name,data:G.result,type:H.type,size:H.size,id:`${H.name}-${Date.now()}-${Math.random()}`};Z(Y)},G.onerror=J,G.readAsDataURL(H)}),[]),k=j.useCallback(H=>H.size>t?`Le fichier ${H.name} est trop volumineux (max: ${Math.round(t/1024/1024)}MB)`:n.length>0&&!n.includes(H.type)?`Le type de fichier ${H.type} n'est pas autorisé`:null,[t,n]),F=j.useCallback(async H=>{y(!0),T([]);try{const Z=[],J=[];for(const Y of H){const ie=k(Y);ie?(J.push(ie),a==null||a(ie)):Z.push(Y)}if(u.length+Z.length>r){const Y=`Nombre maximum de fichiers dépassé (max: ${r})`;J.push(Y),a==null||a(Y)}if(J.length>0){T(J);return}const G=await Promise.all(Z.map(A));f(Y=>[...Y,...G])}catch(Z){const J=`Erreur lors de l'upload: ${Z}`;T(G=>[...G,J]),a==null||a(J)}finally{y(!1)}},[u.length,r,k,A,a]),D=j.useCallback(H=>{f(Z=>Z.filter(J=>J.id!==H))},[]),O=j.useCallback(()=>{f([]),T([])},[]),N=j.useMemo(()=>u.reduce((H,Z)=>H+Z.size,0),[u]),V=j.useMemo(()=>u.length,[u]);return{files:u,addFiles:F,removeFile:D,clearFiles:O,totalSize:N,fileCount:V,isLoading:i,errors:w}},kj=({className:e=""})=>b.jsxs("span",{className:"font-bold "+e,children:[b.jsx("span",{className:"text-yellow-500",children:"Yuk"}),b.jsx("span",{className:"text-red-600",children:"po"})]}),ave=[{path:"/mentions-legales",label:"Mentions légales"},{path:"/confidentialite",label:"Confidentialité"},{path:"/cookies",label:"Cookies"},{path:"/a-propos",label:"À propos"}],lve=ave.filter((e,t,r)=>r.findIndex(n=>n.path===e.path)===t),cve=()=>b.jsx("footer",{className:"w-full border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-600 dark:text-gray-400 text-sm py-10 px-6",children:b.jsxs("div",{className:"max-w-7xl mx-auto grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8",children:[b.jsxs("div",{className:"flex flex-col gap-2",children:[b.jsx("div",{className:"text-lg font-bold text-gray-800 dark:text-white",children:b.jsx(kj,{})}),b.jsx("p",{className:"text-sm leading-relaxed",children:"L’assistant intelligent qui transforme vos besoins en solutions."}),b.jsxs("p",{className:"text-xs mt-1 text-gray-400",children:["© ",new Date().getFullYear()," — Tous droits réservés."]})]}),b.jsxs("div",{className:"flex flex-col gap-2",children:[b.jsx("h3",{className:"text-md font-semibold text-gray-800 dark:text-gray-200",children:"Liens utiles"}),b.jsx("nav",{className:"flex flex-col gap-1 text-sm",children:lve.map(({path:e,label:t})=>b.jsx(Bo,{to:e,className:"hover:underline hover:text-primary transition",children:t},e+"-"+t))})]}),b.jsxs("div",{className:"flex flex-col gap-2",children:[b.jsx("h3",{className:"text-md font-semibold text-gray-800 dark:text-gray-200",children:"Contact"}),b.jsx("p",{className:"text-sm",children:"📞 +237 6 90 00 00 00"}),b.jsx("p",{className:"text-sm",children:"📧 contact@yukpo.app"}),b.jsx("p",{className:"text-sm",children:"💬 WhatsApp : +237 6 70 00 00 00"})]})]})}),y6=e=>new Promise((t,r)=>{const n=new FileReader;n.onload=()=>t({name:e.name,data:n.result,type:e.type}),n.onerror=r,n.readAsDataURL(e)}),kX=jt.memo(({onSubmit:e,loading:t,onInputChange:r,showIASuggestion:n})=>{var vi;const[a,u]=j.useState(""),[f,i]=j.useState(""),[y,w]=j.useState(!1),[T,A]=j.useState([]),[k,F]=j.useState([]),[D,O]=j.useState([]),[N,V]=j.useState([]),[H,Z]=j.useState([]),[J,G]=j.useState([]),[Y,ie]=j.useState([]),[ce,ge]=j.useState(null),[be,xe]=j.useState(!1),[Le,ze]=j.useState(null);j.useEffect(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(xr=>{const Hr={lat:xr.coords.latitude,lng:xr.coords.longitude};console.log("[ChatInputPanel] Position GPS récupérée:",Hr),ge([Hr])},xr=>{console.warn("[ChatInputPanel] Impossible d'obtenir la position GPS:",xr)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})},[]);const[Xe,Je]=j.useState(!1),[tt,st]=j.useState(null),[Ne,We]=j.useState(!1),[Ue,De]=j.useState("auto"),[Ke,lt]=j.useState(.7),[Ye,Ve]=j.useState(4e3);ove();const{loading:Et}=g6({url:"/api/ia/auto",method:"POST",cache:{enabled:!1},headers:{Authorization:`Bearer ${localStorage.getItem("token")||""}`,"Content-Type":"application/json"}}),{execute:kt}=g6({url:"/api/ia/analyze",method:"POST",cache:{enabled:!0,ttl:3e5},headers:{Authorization:`Bearer ${localStorage.getItem("token")||""}`,"Content-Type":"application/json"}}),Wt=!1,Tt=j.useRef({image:null,video:null,doc:null,excel:null}),Ht=j.useCallback(async(xr,Hr)=>{const wn=xr.target.files;if(!wn||wn.length===0)return;const xi=await Promise.all(Array.from(wn).map(y6));Hr(ms=>[...ms,...xi])},[]),ur=j.useCallback(async xr=>{if(xr.length<10){st(null);return}if(!localStorage.getItem("token")){st(null);return}{console.log("[ChatInputPanel] Feedback UX désactivé en production");return}},[kt,Wt]);j.useEffect(()=>{const xr=setTimeout(()=>{a.trim()?ur(a):st(null)},1e3);return()=>clearTimeout(xr)},[a,ur]);const Jt=j.useCallback(async()=>{const xr=document.createElement("input");xr.type="file",xr.accept="image/*",xr.capture="environment",xr.onchange=async Hr=>{const wn=Hr.target.files[0];if(wn){const xi=await y6(wn);xi.name.startsWith("image.")&&(xi.name=`photo-${Date.now()}.jpg`),A(ms=>[...ms,xi])}},xr.click()},[]),Rt=j.useCallback((xr,Hr)=>{Hr(wn=>wn.filter((xi,ms)=>ms!==xr))},[]),Dt=j.useCallback(xr=>{F(Hr=>[...Hr,xr])},[]),sr=j.useCallback((xr,Hr)=>{ge(xr),ze(Hr)},[]),mr=j.useCallback(async()=>{const xr=wn=>{if(!wn.startsWith("data:"))return wn;const xi=wn.indexOf("base64,");return xi!==-1?wn.substring(xi+7):wn},Hr={texte:a.trim()||void 0,site_web:f||void 0,base64_image:T.map(wn=>xr(wn.data)),audio_base64:k.length>0?k.map(wn=>xr(wn.data)):void 0,video_base64:D.length>0?D.map(wn=>xr(wn.data)):void 0,doc_base64:N.map(wn=>xr(wn.data)),excel_base64:H.map(wn=>xr(wn.data)),logo:J.map(wn=>xr(wn.data)),banner:Y.map(wn=>xr(wn.data)),gps_mobile:ce?JSON.stringify(ce):void 0,gps_fixe:ce?!0:void 0,gps_fixe_coords:ce?JSON.stringify(ce):void 0};console.log("[ChatInputPanel] Appel onSubmit avec images:",T.length),e(Hr)},[a,f,T,k,D,N,H,ce,e]),Vr=j.useCallback(()=>{w(xr=>!xr)},[]),rn=j.useCallback(()=>{xe(!0)},[]),$r=j.useCallback(()=>{Je(!0)},[]),Yr=j.useMemo(()=>T.length>0||N.length>0||k.length>0||D.length>0||H.length>0||J.length>0||Y.length>0||f||ce,[T.length,N.length,k.length,D.length,H.length,J.length,Y.length,f,ce]),un=j.useMemo(()=>T.length+N.length+k.length+D.length+H.length+J.length+Y.length,[T.length,N.length,k.length,D.length,H.length,J.length,Y.length]),Fn=n&&tt&&tt.suggestions&&tt.suggestions.length>0;return b.jsxs("div",{className:"w-full max-w-4xl mx-auto p-4 bg-white dark:bg-gray-900 rounded-xl shadow-md space-y-4",children:[Fn&&b.jsxs("div",{className:"mb-2 p-2 bg-blue-50 border border-blue-200 rounded text-xs text-blue-800 flex items-center gap-2",children:[b.jsx(gO,{className:"w-4 h-4 text-blue-600"}),b.jsxs("div",{children:[b.jsxs("b",{children:[b.jsx(kj,{className:"inline"})," IA"]}),b.jsx("ul",{className:"mt-1 list-disc list-inside text-blue-700",children:(vi=tt==null?void 0:tt.suggestions)==null?void 0:vi.map((xr,Hr)=>b.jsx("li",{children:xr},Hr))})]})]}),!1,Ne&&b.jsx("div",{className:"bg-gray-50 p-3 rounded-lg space-y-3",children:b.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[b.jsxs("div",{children:[b.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Modèle IA"}),b.jsxs("select",{value:Ue,onChange:xr=>De(xr.target.value),className:"w-full text-xs p-2 border rounded",children:[b.jsx("option",{value:"auto",children:"Auto (recommandé)"}),b.jsx("option",{value:"gpt4",children:"GPT-4 Turbo"}),b.jsx("option",{value:"gpt35",children:"GPT-3.5 Turbo"}),b.jsx("option",{value:"claude",children:"Claude 3"}),b.jsx("option",{value:"mistral",children:"Mistral Large"})]})]}),b.jsxs("div",{children:[b.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:["Créativité: ",Ke]}),b.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:Ke,onChange:xr=>lt(parseFloat(xr.target.value)),className:"w-full"})]}),b.jsxs("div",{children:[b.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:["Tokens max: ",Ye]}),b.jsx("input",{type:"range",min:"1000",max:"8000",step:"500",value:Ye,onChange:xr=>Ve(parseInt(xr.target.value)),className:"w-full"})]})]})}),b.jsx("textarea",{className:"w-full p-3 border border-gray-300 rounded-md text-sm",placeholder:"Décrivez votre besoin ici…",value:a,onChange:xr=>{u(xr.target.value),r&&r(xr.target.value.length)},rows:3,disabled:t||Et,onKeyDown:xr=>{xr.key==="Enter"&&!xr.shiftKey&&(xr.preventDefault(),!t&&!Et&&(a.trim()||un>0)&&mr())}}),b.jsxs("div",{className:"flex items-center gap-4 flex-wrap justify-start",children:[b.jsx(Cm,{content:"Ajouter des images",children:b.jsxs("label",{className:"cursor-pointer",children:[b.jsx(Fv,{className:"w-6 h-6 text-blue-600 hover:text-blue-800"}),b.jsx("input",{ref:xr=>Tt.current.image=xr,type:"file",accept:"image/*",multiple:!0,hidden:!0,onChange:xr=>Ht(xr,A)})]})}),b.jsx(Cm,{content:"Prendre une photo (caméra)",children:b.jsx("button",{type:"button",onClick:Jt,children:b.jsx(ZW,{className:"w-6 h-6 text-green-600 hover:text-green-800"})})}),b.jsx(Cm,{content:"Enregistrer un mémo vocal",children:b.jsx("button",{type:"button",onClick:$r,children:b.jsx(Rm,{className:"w-6 h-6 text-purple-600 hover:text-purple-800"})})}),b.jsx(Cm,{content:"Ajouter une vidéo explicative",children:b.jsxs("label",{className:"cursor-pointer",children:[b.jsx(qm,{className:"w-6 h-6 text-pink-600 hover:text-pink-800"}),b.jsx("input",{ref:xr=>Tt.current.video=xr,type:"file",accept:"video/*",multiple:!0,hidden:!0,onChange:xr=>Ht(xr,O)})]})}),b.jsx(Cm,{content:"Ajouter des documents",children:b.jsxs("label",{className:"cursor-pointer",children:[b.jsx(aS,{className:"w-6 h-6 text-orange-600 hover:text-orange-800"}),b.jsx("input",{ref:xr=>Tt.current.doc=xr,type:"file",accept:".pdf,.doc,.docx",multiple:!0,hidden:!0,onChange:xr=>Ht(xr,V)})]})}),b.jsx(Cm,{content:"Ajouter un fichier Excel",children:b.jsxs("label",{className:"cursor-pointer",children:[b.jsx(E4,{className:"w-6 h-6 text-yellow-500 hover:text-yellow-700"}),b.jsx("input",{ref:xr=>Tt.current.excel=xr,type:"file",accept:".xlsx,.xls",multiple:!0,hidden:!0,onChange:xr=>Ht(xr,Z)})]})}),b.jsx(Cm,{content:"Ajouter un lien à analyser",children:b.jsx("button",{type:"button",onClick:Vr,children:b.jsx(lS,{className:"w-6 h-6 text-gray-600 hover:text-blue-600"})})}),b.jsx(Cm,{content:"Définir une zone GPS",children:b.jsx("button",{type:"button",onClick:rn,children:b.jsx(ou,{className:"w-6 h-6 text-green-600 hover:text-green-800"})})}),b.jsxs(cr,{onClick:mr,disabled:t||Et||!a.trim()&&un===0,className:"ml-auto bg-gradient-to-r from-blue-700 via-blue-600 to-blue-500 text-white hover:from-blue-800 hover:to-blue-600 hover:bg-blue-700 px-4 py-2 rounded flex items-center gap-2 disabled:cursor-not-allowed disabled:bg-blue-400 shadow-lg",children:[(t||Et)&&b.jsx(wue,{className:"animate-spin",size:18}),t||Et?"Analyse...":"Envoyer à Yukpo"]})]}),y&&b.jsx("div",{className:"pt-2",children:b.jsx("input",{type:"url",placeholder:"Coller un lien (URL) à analyser...",className:"w-full p-2 border rounded-md text-sm",value:f,onChange:xr=>i(xr.target.value)})}),Yr&&b.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[b.jsxs("h3",{className:"text-sm font-semibold text-gray-600 dark:text-gray-400 mb-3",children:["Éléments ajoutés (",un," fichier",un>1?"s":"",") :"]}),b.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:[T.map((xr,Hr)=>b.jsxs("div",{className:"relative group",children:[b.jsx("img",{src:xr.data,alt:xr.name,className:"w-full h-20 object-cover rounded border"}),b.jsx("button",{onClick:()=>Rt(Hr,A),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:b.jsx(Os,{size:12})}),b.jsx("p",{className:"text-xs text-gray-500 mt-1 truncate",children:xr.name})]},`img-${Hr}`)),N.map((xr,Hr)=>b.jsxs("div",{className:"relative group",children:[b.jsx("div",{className:"w-full h-20 bg-gray-100 rounded border flex items-center justify-center",children:b.jsx(aS,{className:"w-8 h-8 text-gray-400"})}),b.jsx("button",{onClick:()=>Rt(Hr,V),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:b.jsx(Os,{size:12})}),b.jsx("p",{className:"text-xs text-gray-500 mt-1 truncate",children:xr.name})]},`doc-${Hr}`)),k.map((xr,Hr)=>b.jsxs("div",{className:"relative group",children:[b.jsx("div",{className:"w-full h-20 bg-purple-100 rounded border flex items-center justify-center",children:b.jsx(Rm,{className:"w-8 h-8 text-purple-400"})}),b.jsx("button",{onClick:()=>Rt(Hr,F),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:b.jsx(Os,{size:12})}),b.jsx("p",{className:"text-xs text-gray-500 mt-1 truncate",children:xr.name})]},`audio-${Hr}`)),D.map((xr,Hr)=>b.jsxs("div",{className:"relative group",children:[b.jsx("div",{className:"w-full h-20 bg-pink-100 rounded border flex items-center justify-center",children:b.jsx(qm,{className:"w-8 h-8 text-pink-400"})}),b.jsx("button",{onClick:()=>Rt(Hr,O),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:b.jsx(Os,{size:12})}),b.jsx("p",{className:"text-xs text-gray-500 mt-1 truncate",children:xr.name})]},`video-${Hr}`)),H.map((xr,Hr)=>b.jsxs("div",{className:"relative group",children:[b.jsx("div",{className:"w-full h-20 bg-yellow-100 rounded border flex items-center justify-center",children:b.jsx(E4,{className:"w-8 h-8 text-yellow-400"})}),b.jsx("button",{onClick:()=>Rt(Hr,Z),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:b.jsx(Os,{size:12})}),b.jsx("p",{className:"text-xs text-gray-500 mt-1 truncate",children:xr.name})]},`excel-${Hr}`)),f&&b.jsxs("div",{className:"relative group",children:[b.jsx("div",{className:"w-full h-20 bg-blue-100 rounded border flex items-center justify-center",children:b.jsx(lS,{className:"w-8 h-8 text-blue-400"})}),b.jsx("button",{onClick:()=>i(""),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:b.jsx(Os,{size:12})}),b.jsx("p",{className:"text-xs text-gray-500 mt-1 truncate",children:f})]}),ce&&b.jsxs("div",{className:"relative group",children:[b.jsx("div",{className:"w-full h-20 bg-green-100 rounded border flex items-center justify-center",children:b.jsx(ou,{className:"w-8 h-8 text-green-400"})}),b.jsx("button",{onClick:()=>{ge(null),ze(null)},className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:b.jsx(Os,{size:12})}),b.jsx("p",{className:"text-xs text-gray-500 mt-1 truncate",children:"Zone GPS définie"})]})]})]}),be&&b.jsx(Aj,{onClose:()=>xe(!1),onSelect:sr}),Xe&&b.jsx(Tge,{onClose:()=>Je(!1),onConfirm:Dt})]})});kX.displayName="ChatInputPanel";const uve="/assets/logo-KW_Y9lXb.png",dve=(e,t,r,n)=>{var u,f,i,y;const a=[r,{code:t,...n||{}}];if((f=(u=e==null?void 0:e.services)==null?void 0:u.logger)!=null&&f.forward)return e.services.logger.forward(a,"warn","react-i18next::",!0);my(a[0])&&(a[0]=`react-i18next:: ${a[0]}`),(y=(i=e==null?void 0:e.services)==null?void 0:i.logger)!=null&&y.warn?e.services.logger.warn(...a):console!=null&&console.warn&&console.warn(...a)},v6={},NO=(e,t,r,n)=>{my(r)&&v6[r]||(my(r)&&(v6[r]=new Date),dve(e,t,r,n))},OX=(e,t)=>()=>{if(e.isInitialized)t();else{const r=()=>{setTimeout(()=>{e.off("initialized",r)},0),t()};e.on("initialized",r)}},zO=(e,t,r)=>{e.loadNamespaces(t,OX(e,r))},_6=(e,t,r,n)=>{if(my(r)&&(r=[r]),e.options.preload&&e.options.preload.indexOf(t)>-1)return zO(e,r,n);r.forEach(a=>{e.options.ns.indexOf(a)<0&&e.options.ns.push(a)}),e.loadLanguages(t,OX(e,n))},hve=(e,t,r={})=>!t.languages||!t.languages.length?(NO(t,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:t.languages}),!0):t.hasLoadedNamespace(e,{lng:r.lng,precheck:(n,a)=>{var u;if(((u=r.bindI18n)==null?void 0:u.indexOf("languageChanging"))>-1&&n.services.backendConnector.backend&&n.isLanguageChangingTo&&!a(n.isLanguageChangingTo,e))return!1}}),my=e=>typeof e=="string",fve=e=>typeof e=="object"&&e!==null,pve=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,mve={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},gve=e=>mve[e],yve=e=>e.replace(pve,gve);let FO={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:yve};const vve=(e={})=>{FO={...FO,...e}},_ve=()=>FO;let LX;const xve=e=>{LX=e},bve=()=>LX,wve={type:"3rdParty",init(e){vve(e.options.react),xve(e)}},Sve=j.createContext();class Eve{constructor(){this.usedNamespaces={}}addUsedNamespaces(t){t.forEach(r=>{this.usedNamespaces[r]||(this.usedNamespaces[r]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const Tve=(e,t)=>{const r=j.useRef();return j.useEffect(()=>{r.current=e},[e,t]),r.current},RX=(e,t,r,n)=>e.getFixedT(t,r,n),Cve=(e,t,r,n)=>j.useCallback(RX(e,t,r,n),[e,t,r,n]),R_=(e,t={})=>{var J,G,Y,ie;const{i18n:r}=t,{i18n:n,defaultNS:a}=j.useContext(Sve)||{},u=r||n||bve();if(u&&!u.reportNamespaces&&(u.reportNamespaces=new Eve),!u){NO(u,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const ce=(be,xe)=>my(xe)?xe:fve(xe)&&my(xe.defaultValue)?xe.defaultValue:Array.isArray(be)?be[be.length-1]:be,ge=[ce,{},!1];return ge.t=ce,ge.i18n={},ge.ready=!1,ge}(J=u.options.react)!=null&&J.wait&&NO(u,"DEPRECATED_OPTION","useTranslation: It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const f={..._ve(),...u.options.react,...t},{useSuspense:i,keyPrefix:y}=f;let w=a||((G=u.options)==null?void 0:G.defaultNS);w=my(w)?[w]:w||["translation"],(ie=(Y=u.reportNamespaces).addUsedNamespaces)==null||ie.call(Y,w);const T=(u.isInitialized||u.initializedStoreOnce)&&w.every(ce=>hve(ce,u,f)),A=Cve(u,t.lng||null,f.nsMode==="fallback"?w:w[0],y),k=()=>A,F=()=>RX(u,t.lng||null,f.nsMode==="fallback"?w:w[0],y),[D,O]=j.useState(k);let N=w.join();t.lng&&(N=`${t.lng}${N}`);const V=Tve(N),H=j.useRef(!0);j.useEffect(()=>{const{bindI18n:ce,bindI18nStore:ge}=f;H.current=!0,!T&&!i&&(t.lng?_6(u,t.lng,w,()=>{H.current&&O(F)}):zO(u,w,()=>{H.current&&O(F)})),T&&V&&V!==N&&H.current&&O(F);const be=()=>{H.current&&O(F)};return ce&&(u==null||u.on(ce,be)),ge&&(u==null||u.store.on(ge,be)),()=>{H.current=!1,u&&(ce==null||ce.split(" ").forEach(xe=>u.off(xe,be))),ge&&u&&ge.split(" ").forEach(xe=>u.store.off(xe,be))}},[u,N]),j.useEffect(()=>{H.current&&T&&O(k)},[u,y,T]);const Z=[D,u,T];if(Z.t=D,Z.i18n=u,Z.ready=T,T||!T&&!i)return Z;throw new Promise(ce=>{t.lng?_6(u,t.lng,w,()=>ce()):zO(u,w,()=>ce())})},Ave=()=>{const[e,t]=j.useState(!1),r=j.useRef(null),{user:n,logout:a}=Rs(),{i18n:u,t:f}=R_(),i=()=>t(F=>!F),y=()=>{confirm("🔒 Voulez-vous vous déconnecter ?")&&(a(),t(!1))};j.useEffect(()=>{const F=D=>{r.current&&!r.current.contains(D.target)&&t(!1)};return e&&document.addEventListener("mousedown",F),()=>document.removeEventListener("mousedown",F)},[e]);const w=[{to:$n.HOME,label:"Accueil"},{to:$n.SERVICES,label:"Services"},{to:$n.CATALOGUE,label:"Catalogue"},{to:$n.CONTACT,label:"Contact"},{to:$n.ABOUT,label:"À propos"}],T=[];n&&(T.push({to:$n.ESPACE,label:"Mon Espace"}),n.role==="admin"&&T.push({to:$n.DASHBOARD_ADMIN_AUDIT,label:"Audit sécurité"}));const k=[...w,...T].filter((F,D,O)=>D===O.findIndex(N=>N.to===F.to));return b.jsxs("div",{className:"md:hidden relative z-50",ref:r,children:[b.jsx("button",{onClick:i,className:"p-2 text-xl text-primary","aria-label":"Menu mobile",children:"☰"}),e&&b.jsx("div",{className:"absolute top-14 right-0 bg-white dark:bg-gray-800 w-72 max-h-[85vh] overflow-y-auto rounded shadow-lg p-4 text-sm border dark:border-gray-700",children:b.jsxs("nav",{className:"flex flex-col gap-3",children:[k.map(({to:F,label:D})=>b.jsx(Bo,{to:F,onClick:()=>t(!1),className:"hover:text-primary",children:D},F)),b.jsx("div",{className:"border-t border-gray-300 dark:border-gray-600 pt-3 mt-2 text-xs text-gray-600 dark:text-gray-300",children:n?b.jsxs(b.Fragment,{children:[b.jsxs("div",{children:["Rôle : ",b.jsx("strong",{children:n.role})]}),b.jsxs("button",{onClick:y,className:"text-red-600 hover:underline mt-2",children:["🚪 ",f("Déconnexion")]})]}):b.jsxs(b.Fragment,{children:[b.jsx(Bo,{to:$n.LOGIN,onClick:()=>t(!1),className:"text-blue-600 hover:underline",children:"Connexion"}),b.jsx(Bo,{to:$n.REGISTER,onClick:()=>t(!1),className:"text-yellow-600 hover:underline",children:"Inscription"})]})}),b.jsxs("select",{className:"mt-4 border px-2 py-1 rounded bg-white dark:bg-gray-700 dark:text-white",value:u.language,onChange:F=>u.changeLanguage(F.target.value),children:[b.jsx("option",{value:"fr",children:"🇫🇷 Français"}),b.jsx("option",{value:"en",children:"🇬🇧 English"}),b.jsx("option",{value:"pt",children:"🇵🇹 Português"}),b.jsx("option",{value:"ar",children:"🇸🇦 العربية"}),b.jsx("option",{value:"ff",children:"🌍 Fula"})]})]})})]})},Pve=[{code:"fr",label:"🇫🇷 Français"},{code:"en",label:"🇬🇧 English"},{code:"pt",label:"🇵🇹 Português"},{code:"ar",label:"🇸🇦 العربية"},{code:"ff",label:"🌍 Fula"}],Mve=()=>{const{i18n:e}=R_(),[t,r]=j.useState(()=>localStorage.getItem("preferred_lang")||e.language);return j.useEffect(()=>{e.changeLanguage(t),localStorage.setItem("preferred_lang",t)},[t,e]),b.jsx("select",{value:t,onChange:n=>r(n.target.value),className:"border text-sm rounded px-2 py-1 bg-white focus:outline-none focus:ring-2 focus:ring-primary","aria-label":"Sélecteur de langue",children:Pve.map(({code:n,label:a})=>b.jsx("option",{value:n,children:a},n))})},Ive=()=>{const{user:e,logout:t}=Rs(),[r,n]=j.useState("light"),[a,u]=j.useState(!1),[f,i]=j.useState(null),[y,w]=j.useState(!1),[T,A]=j.useState(!1);j.useEffect(()=>{console.log("[HeaderController] user from useUser:",e),console.log("[HeaderController] user.credits:",e==null?void 0:e.credits),e!=null&&e.id&&A(!1);const D=localStorage.getItem("tokens_balance");if(D){const O=parseInt(D,10);isNaN(O)||(console.log("[HeaderController] Solde initial depuis localStorage:",O),i(O))}},[e==null?void 0:e.id]),j.useEffect(()=>{const D=async()=>{if(!(e!=null&&e.id)){i(null);return}const N=localStorage.getItem("token");if(N&&!y){w(!0);try{const V=await fetch("/api/users/balance",{headers:{Authorization:`Bearer ${N}`,"Content-Type":"application/json"}});if(V.ok){const H=await V.json();console.log("[HeaderController] Solde récupéré:",H.tokens_balance),i(H.tokens_balance),localStorage.setItem("tokens_balance",H.tokens_balance.toString()),window.dispatchEvent(new CustomEvent("tokens_updated"))}else console.error("[HeaderController] Erreur récupération solde:",V.status),e.credits!==void 0&&i(e.credits)}catch(V){console.error("[HeaderController] Erreur réseau:",V),e.credits!==void 0&&i(e.credits)}finally{w(!1)}}};e!=null&&e.id&&!y&&!T&&(D(),A(!0));const O=setInterval(()=>{e!=null&&e.id&&!y&&D()},6e4);return()=>clearInterval(O)},[e==null?void 0:e.id]),j.useEffect(()=>{const D=N=>{const V=N.headers.get("x-tokens-remaining");if(V){const Z=parseInt(V,10);isNaN(Z)||(console.log("[HeaderController] Mise à jour solde depuis header:",Z),i(Z),localStorage.setItem("tokens_balance",Z.toString()),window.dispatchEvent(new CustomEvent("tokens_updated")))}const H=N.headers.get("x-new-jwt");return H&&(console.log("[HeaderController] Nouveau JWT reçu, mise à jour du token"),localStorage.setItem("token",H),window.dispatchEvent(new CustomEvent("tokens_updated"))),N},O=window.fetch;return window.fetch=async(...N)=>{const V=await O(...N);return D(V.clone())},()=>{window.fetch=O}},[]),j.useEffect(()=>{const D=localStorage.getItem("theme"),O=window.matchMedia("(prefers-color-scheme: dark)").matches,N=D||(O?"dark":"light");n(N),document.documentElement.classList.toggle("dark",N==="dark")},[]);const k=()=>{const D=r==="dark"?"light":"dark";n(D),localStorage.setItem("theme",D),document.documentElement.classList.toggle("dark",D==="dark")},F=()=>y?"⏳":f===null?`${((e==null?void 0:e.credits)??0).toLocaleString()} XAF`:`${f.toLocaleString()} XAF`;return b.jsx("header",{className:"fixed top-0 left-0 w-full z-50 bg-white dark:bg-gray-900 shadow-sm border-b dark:border-gray-700",children:b.jsxs("div",{className:"max-w-screen-2xl mx-auto px-6 h-24 flex items-center justify-between",children:[b.jsx("div",{className:"flex items-center gap-4 min-w-[140px]",children:b.jsx(Bo,{to:$n.HOME,className:"flex items-center gap-2",children:b.jsx("img",{src:uve,alt:"Yukpo",className:"h-14 w-auto object-contain"})})}),b.jsxs("div",{className:"hidden md:flex items-center gap-4 min-w-[300px] justify-end text-sm text-gray-700 dark:text-gray-200 relative",children:[e!=null&&e.id?b.jsxs(b.Fragment,{children:[b.jsxs("div",{className:"flex items-center space-x-2",children:[b.jsx(Bo,{to:$n.MES_SERVICES,className:"text-blue-600 hover:text-blue-700 text-xs font-medium",title:"Voir mes services",children:"📋 Mes Services"}),b.jsx("span",{className:"text-gray-400",children:"|"}),b.jsxs(Bo,{to:$n.MON_SOLDE,className:"text-green-600 font-bold hover:underline text-xs",title:"Voir mon historique IA",children:["💰 ",F()]})]}),b.jsxs("div",{className:"relative",children:[e.photo?b.jsx("img",{src:e.photo,alt:"profil",className:"w-10 h-10 rounded-full object-cover cursor-pointer border-2 border-[#0F52BA]",onClick:()=>u(!a)}):b.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center text-white font-bold text-lg cursor-pointer border-2 border-[#0F52BA] select-none",onClick:()=>u(!a),children:e.name&&e.name.trim()!==""?e.name.replace(/[^\p{L}\p{N}]/gu,"").slice(0,2).toUpperCase():e.email?e.email[0].toUpperCase():"?"}),a&&b.jsxs("div",{className:"absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded shadow text-sm z-50 p-3",children:[b.jsxs("p",{className:"text-gray-800 dark:text-gray-100 font-semibold mb-2",children:["👤 ",e.name||"Utilisateur"]}),b.jsxs("p",{className:"text-gray-500 dark:text-gray-300",children:["🛡 Rôle : ",b.jsx("strong",{children:e.role})]}),b.jsx("hr",{className:"my-2 border-gray-200 dark:border-gray-700"}),b.jsx(Bo,{to:"/mon-compte",className:"block px-3 py-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:"⚙️ Paramètres"}),b.jsx(Bo,{to:$n.MON_SOLDE,className:"block px-3 py-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:"🧾 Historique IA"}),b.jsx(Bo,{to:$n.RECHARGE_TOKENS,className:"block px-3 py-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-green-600",children:"💳 Recharger tokens"}),b.jsx("button",{onClick:t,className:"w-full text-left px-3 py-1 text-red-600 hover:underline mt-2",children:"🚪 Déconnexion"})]})]})]}):b.jsxs(b.Fragment,{children:[b.jsx(Bo,{to:$n.LOGIN,className:"text-blue-600 hover:underline",children:"Connexion"}),b.jsx(Bo,{to:$n.REGISTER,className:"text-yellow-600 hover:underline",children:"Inscription"})]}),b.jsx(Mve,{}),b.jsx("button",{onClick:k,title:"Changer le thème",className:"text-xl hover:text-yellow-500",children:r==="dark"?"☽":"☀"})]}),b.jsx("div",{className:"md:hidden",children:b.jsx(Ave,{})})]})})},x6=[{code:"fr",label:"🇫🇷"},{code:"en",label:"🇬🇧"},{code:"pt",label:"🇵🇹"},{code:"ar",label:"🇸🇦"},{code:"ff",label:"🌍"}],kve=()=>{const{i18n:e}=R_(),t=x6.some(a=>a.code===navigator.language.split("-")[0])?navigator.language.split("-")[0]:"fr",[r,n]=j.useState(()=>localStorage.getItem("preferred_lang")||t);return j.useEffect(()=>{e.changeLanguage(r),localStorage.setItem("preferred_lang",r)},[r,e]),b.jsx(va.select,{value:r,onChange:a=>n(a.target.value),className:"text-sm bg-white dark:bg-gray-900 border rounded px-2 py-1 focus:outline-none focus:ring ring-blue-400","aria-label":"Choisir une langue",whileTap:{scale:.95},children:x6.map(({code:a,label:u})=>b.jsx("option",{value:a,children:u},a))})};function jX(e){var t,r,n="";if(typeof e=="string"||typeof e=="number")n+=e;else if(typeof e=="object")if(Array.isArray(e)){var a=e.length;for(t=0;t<a;t++)e[t]&&(r=jX(e[t]))&&(n&&(n+=" "),n+=r)}else for(r in e)e[r]&&(n&&(n+=" "),n+=r);return n}function Li(){for(var e,t,r=0,n="",a=arguments.length;r<a;r++)(e=arguments[r])&&(t=jX(e))&&(n&&(n+=" "),n+=t);return n}function Ove(e){if(typeof document>"u")return;let t=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",t.firstChild?t.insertBefore(r,t.firstChild):t.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}Ove(`:root{--toastify-color-light: #fff;--toastify-color-dark: #121212;--toastify-color-info: #3498db;--toastify-color-success: #07bc0c;--toastify-color-warning: #f1c40f;--toastify-color-error: hsl(6, 78%, 57%);--toastify-color-transparent: rgba(255, 255, 255, .7);--toastify-icon-color-info: var(--toastify-color-info);--toastify-icon-color-success: var(--toastify-color-success);--toastify-icon-color-warning: var(--toastify-color-warning);--toastify-icon-color-error: var(--toastify-color-error);--toastify-container-width: fit-content;--toastify-toast-width: 320px;--toastify-toast-offset: 16px;--toastify-toast-top: max(var(--toastify-toast-offset), env(safe-area-inset-top));--toastify-toast-right: max(var(--toastify-toast-offset), env(safe-area-inset-right));--toastify-toast-left: max(var(--toastify-toast-offset), env(safe-area-inset-left));--toastify-toast-bottom: max(var(--toastify-toast-offset), env(safe-area-inset-bottom));--toastify-toast-background: #fff;--toastify-toast-padding: 14px;--toastify-toast-min-height: 64px;--toastify-toast-max-height: 800px;--toastify-toast-bd-radius: 6px;--toastify-toast-shadow: 0px 4px 12px rgba(0, 0, 0, .1);--toastify-font-family: sans-serif;--toastify-z-index: 9999;--toastify-text-color-light: #757575;--toastify-text-color-dark: #fff;--toastify-text-color-info: #fff;--toastify-text-color-success: #fff;--toastify-text-color-warning: #fff;--toastify-text-color-error: #fff;--toastify-spinner-color: #616161;--toastify-spinner-color-empty-area: #e0e0e0;--toastify-color-progress-light: linear-gradient(to right, #4cd964, #5ac8fa, #007aff, #34aadc, #5856d6, #ff2d55);--toastify-color-progress-dark: #bb86fc;--toastify-color-progress-info: var(--toastify-color-info);--toastify-color-progress-success: var(--toastify-color-success);--toastify-color-progress-warning: var(--toastify-color-warning);--toastify-color-progress-error: var(--toastify-color-error);--toastify-color-progress-bgo: .2}.Toastify__toast-container{z-index:var(--toastify-z-index);-webkit-transform:translate3d(0,0,var(--toastify-z-index));position:fixed;width:var(--toastify-container-width);box-sizing:border-box;color:#fff;display:flex;flex-direction:column}.Toastify__toast-container--top-left{top:var(--toastify-toast-top);left:var(--toastify-toast-left)}.Toastify__toast-container--top-center{top:var(--toastify-toast-top);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--top-right{top:var(--toastify-toast-top);right:var(--toastify-toast-right);align-items:end}.Toastify__toast-container--bottom-left{bottom:var(--toastify-toast-bottom);left:var(--toastify-toast-left)}.Toastify__toast-container--bottom-center{bottom:var(--toastify-toast-bottom);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--bottom-right{bottom:var(--toastify-toast-bottom);right:var(--toastify-toast-right);align-items:end}.Toastify__toast{--y: 0;position:relative;touch-action:none;width:var(--toastify-toast-width);min-height:var(--toastify-toast-min-height);box-sizing:border-box;margin-bottom:1rem;padding:var(--toastify-toast-padding);border-radius:var(--toastify-toast-bd-radius);box-shadow:var(--toastify-toast-shadow);max-height:var(--toastify-toast-max-height);font-family:var(--toastify-font-family);z-index:0;display:flex;flex:1 auto;align-items:center;word-break:break-word}@media only screen and (max-width: 480px){.Toastify__toast-container{width:100vw;left:env(safe-area-inset-left);margin:0}.Toastify__toast-container--top-left,.Toastify__toast-container--top-center,.Toastify__toast-container--top-right{top:env(safe-area-inset-top);transform:translate(0)}.Toastify__toast-container--bottom-left,.Toastify__toast-container--bottom-center,.Toastify__toast-container--bottom-right{bottom:env(safe-area-inset-bottom);transform:translate(0)}.Toastify__toast-container--rtl{right:env(safe-area-inset-right);left:initial}.Toastify__toast{--toastify-toast-width: 100%;margin-bottom:0;border-radius:0}}.Toastify__toast-container[data-stacked=true]{width:var(--toastify-toast-width)}.Toastify__toast--stacked{position:absolute;width:100%;transform:translate3d(0,var(--y),0) scale(var(--s));transition:transform .3s}.Toastify__toast--stacked[data-collapsed] .Toastify__toast-body,.Toastify__toast--stacked[data-collapsed] .Toastify__close-button{transition:opacity .1s}.Toastify__toast--stacked[data-collapsed=false]{overflow:visible}.Toastify__toast--stacked[data-collapsed=true]:not(:last-child)>*{opacity:0}.Toastify__toast--stacked:after{content:"";position:absolute;left:0;right:0;height:calc(var(--g) * 1px);bottom:100%}.Toastify__toast--stacked[data-pos=top]{top:0}.Toastify__toast--stacked[data-pos=bot]{bottom:0}.Toastify__toast--stacked[data-pos=bot].Toastify__toast--stacked:before{transform-origin:top}.Toastify__toast--stacked[data-pos=top].Toastify__toast--stacked:before{transform-origin:bottom}.Toastify__toast--stacked:before{content:"";position:absolute;left:0;right:0;bottom:0;height:100%;transform:scaleY(3);z-index:-1}.Toastify__toast--rtl{direction:rtl}.Toastify__toast--close-on-click{cursor:pointer}.Toastify__toast-icon{margin-inline-end:10px;width:22px;flex-shrink:0;display:flex}.Toastify--animate{animation-fill-mode:both;animation-duration:.5s}.Toastify--animate-icon{animation-fill-mode:both;animation-duration:.3s}.Toastify__toast-theme--dark{background:var(--toastify-color-dark);color:var(--toastify-text-color-dark)}.Toastify__toast-theme--light,.Toastify__toast-theme--colored.Toastify__toast--default{background:var(--toastify-color-light);color:var(--toastify-text-color-light)}.Toastify__toast-theme--colored.Toastify__toast--info{color:var(--toastify-text-color-info);background:var(--toastify-color-info)}.Toastify__toast-theme--colored.Toastify__toast--success{color:var(--toastify-text-color-success);background:var(--toastify-color-success)}.Toastify__toast-theme--colored.Toastify__toast--warning{color:var(--toastify-text-color-warning);background:var(--toastify-color-warning)}.Toastify__toast-theme--colored.Toastify__toast--error{color:var(--toastify-text-color-error);background:var(--toastify-color-error)}.Toastify__progress-bar-theme--light{background:var(--toastify-color-progress-light)}.Toastify__progress-bar-theme--dark{background:var(--toastify-color-progress-dark)}.Toastify__progress-bar--info{background:var(--toastify-color-progress-info)}.Toastify__progress-bar--success{background:var(--toastify-color-progress-success)}.Toastify__progress-bar--warning{background:var(--toastify-color-progress-warning)}.Toastify__progress-bar--error{background:var(--toastify-color-progress-error)}.Toastify__progress-bar-theme--colored.Toastify__progress-bar--info,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--success,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--warning,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--error{background:var(--toastify-color-transparent)}.Toastify__close-button{color:#fff;position:absolute;top:6px;right:6px;background:transparent;outline:none;border:none;padding:0;cursor:pointer;opacity:.7;transition:.3s ease;z-index:1}.Toastify__toast--rtl .Toastify__close-button{left:6px;right:unset}.Toastify__close-button--light{color:#000;opacity:.3}.Toastify__close-button>svg{fill:currentColor;height:16px;width:14px}.Toastify__close-button:hover,.Toastify__close-button:focus{opacity:1}@keyframes Toastify__trackProgress{0%{transform:scaleX(1)}to{transform:scaleX(0)}}.Toastify__progress-bar{position:absolute;bottom:0;left:0;width:100%;height:100%;z-index:1;opacity:.7;transform-origin:left}.Toastify__progress-bar--animated{animation:Toastify__trackProgress linear 1 forwards}.Toastify__progress-bar--controlled{transition:transform .2s}.Toastify__progress-bar--rtl{right:0;left:initial;transform-origin:right;border-bottom-left-radius:initial}.Toastify__progress-bar--wrp{position:absolute;overflow:hidden;bottom:0;left:0;width:100%;height:5px;border-bottom-left-radius:var(--toastify-toast-bd-radius);border-bottom-right-radius:var(--toastify-toast-bd-radius)}.Toastify__progress-bar--wrp[data-hidden=true]{opacity:0}.Toastify__progress-bar--bg{opacity:var(--toastify-color-progress-bgo);width:100%;height:100%}.Toastify__spinner{width:20px;height:20px;box-sizing:border-box;border:2px solid;border-radius:100%;border-color:var(--toastify-spinner-color-empty-area);border-right-color:var(--toastify-spinner-color);animation:Toastify__spin .65s linear infinite}@keyframes Toastify__bounceInRight{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(3000px,0,0)}60%{opacity:1;transform:translate3d(-25px,0,0)}75%{transform:translate3d(10px,0,0)}90%{transform:translate3d(-5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutRight{20%{opacity:1;transform:translate3d(-20px,var(--y),0)}to{opacity:0;transform:translate3d(2000px,var(--y),0)}}@keyframes Toastify__bounceInLeft{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(-3000px,0,0)}60%{opacity:1;transform:translate3d(25px,0,0)}75%{transform:translate3d(-10px,0,0)}90%{transform:translate3d(5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutLeft{20%{opacity:1;transform:translate3d(20px,var(--y),0)}to{opacity:0;transform:translate3d(-2000px,var(--y),0)}}@keyframes Toastify__bounceInUp{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,3000px,0)}60%{opacity:1;transform:translate3d(0,-20px,0)}75%{transform:translate3d(0,10px,0)}90%{transform:translate3d(0,-5px,0)}to{transform:translateZ(0)}}@keyframes Toastify__bounceOutUp{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,-2000px,0)}}@keyframes Toastify__bounceInDown{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,-3000px,0)}60%{opacity:1;transform:translate3d(0,25px,0)}75%{transform:translate3d(0,-10px,0)}90%{transform:translate3d(0,5px,0)}to{transform:none}}@keyframes Toastify__bounceOutDown{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,2000px,0)}}.Toastify__bounce-enter--top-left,.Toastify__bounce-enter--bottom-left{animation-name:Toastify__bounceInLeft}.Toastify__bounce-enter--top-right,.Toastify__bounce-enter--bottom-right{animation-name:Toastify__bounceInRight}.Toastify__bounce-enter--top-center{animation-name:Toastify__bounceInDown}.Toastify__bounce-enter--bottom-center{animation-name:Toastify__bounceInUp}.Toastify__bounce-exit--top-left,.Toastify__bounce-exit--bottom-left{animation-name:Toastify__bounceOutLeft}.Toastify__bounce-exit--top-right,.Toastify__bounce-exit--bottom-right{animation-name:Toastify__bounceOutRight}.Toastify__bounce-exit--top-center{animation-name:Toastify__bounceOutUp}.Toastify__bounce-exit--bottom-center{animation-name:Toastify__bounceOutDown}@keyframes Toastify__zoomIn{0%{opacity:0;transform:scale3d(.3,.3,.3)}50%{opacity:1}}@keyframes Toastify__zoomOut{0%{opacity:1}50%{opacity:0;transform:translate3d(0,var(--y),0) scale3d(.3,.3,.3)}to{opacity:0}}.Toastify__zoom-enter{animation-name:Toastify__zoomIn}.Toastify__zoom-exit{animation-name:Toastify__zoomOut}@keyframes Toastify__flipIn{0%{transform:perspective(400px) rotateX(90deg);animation-timing-function:ease-in;opacity:0}40%{transform:perspective(400px) rotateX(-20deg);animation-timing-function:ease-in}60%{transform:perspective(400px) rotateX(10deg);opacity:1}80%{transform:perspective(400px) rotateX(-5deg)}to{transform:perspective(400px)}}@keyframes Toastify__flipOut{0%{transform:translate3d(0,var(--y),0) perspective(400px)}30%{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(-20deg);opacity:1}to{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(90deg);opacity:0}}.Toastify__flip-enter{animation-name:Toastify__flipIn}.Toastify__flip-exit{animation-name:Toastify__flipOut}@keyframes Toastify__slideInRight{0%{transform:translate3d(110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInLeft{0%{transform:translate3d(-110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInUp{0%{transform:translate3d(0,110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInDown{0%{transform:translate3d(0,-110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideOutRight{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(110%,var(--y),0)}}@keyframes Toastify__slideOutLeft{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(-110%,var(--y),0)}}@keyframes Toastify__slideOutDown{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,500px,0)}}@keyframes Toastify__slideOutUp{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,-500px,0)}}.Toastify__slide-enter--top-left,.Toastify__slide-enter--bottom-left{animation-name:Toastify__slideInLeft}.Toastify__slide-enter--top-right,.Toastify__slide-enter--bottom-right{animation-name:Toastify__slideInRight}.Toastify__slide-enter--top-center{animation-name:Toastify__slideInDown}.Toastify__slide-enter--bottom-center{animation-name:Toastify__slideInUp}.Toastify__slide-exit--top-left,.Toastify__slide-exit--bottom-left{animation-name:Toastify__slideOutLeft;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-right,.Toastify__slide-exit--bottom-right{animation-name:Toastify__slideOutRight;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-center{animation-name:Toastify__slideOutUp;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--bottom-center{animation-name:Toastify__slideOutDown;animation-timing-function:ease-in;animation-duration:.3s}@keyframes Toastify__spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}
`);var Oj=e=>typeof e=="number"&&!isNaN(e),Vx=e=>typeof e=="string",DX=e=>typeof e=="function",Lve=e=>Vx(e)||Oj(e),Rve=e=>j.isValidElement(e)||Vx(e)||DX(e)||Oj(e),jve=1,NX=()=>`${jve++}`,lf=new Map,BO=[],b6=new Set,zX=()=>lf.size>0,Dve=(e,{containerId:t})=>{var r;return(r=lf.get(t||1))==null?void 0:r.toasts.get(e)};function Nve(e,t){var r;if(t)return!!((r=lf.get(t))!=null&&r.isToastActive(e));let n=!1;return lf.forEach(a=>{a.isToastActive(e)&&(n=!0)}),n}function zve(e){if(!zX()){BO=BO.filter(t=>e!=null&&t.options.toastId!==e);return}if(e==null||Lve(e))lf.forEach(t=>{t.removeToast(e)});else if(e&&("containerId"in e||"id"in e)){let t=lf.get(e.containerId);t?t.removeToast(e.id):lf.forEach(r=>{r.removeToast(e.id)})}}var Fve=(e={})=>{lf.forEach(t=>{t.props.limit&&(!e.containerId||t.id===e.containerId)&&t.clearQueue()})};function Bve(e,t){Rve(e)&&(zX()||BO.push({content:e,options:t}),lf.forEach(r=>{r.buildToast(e,t)}))}function FX(e,t){lf.forEach(r=>{(t==null||!(t!=null&&t.containerId)||(t==null?void 0:t.containerId)===r.id)&&r.toggle(e,t==null?void 0:t.id)})}function $ve(e){return b6.add(e),()=>{b6.delete(e)}}function Vve(e){return e&&(Vx(e.toastId)||Oj(e.toastId))?e.toastId:NX()}function $b(e,t){return Bve(e,t),t.toastId}function n2(e,t){return{...t,type:t&&t.type||e,toastId:Vve(t)}}function i2(e){return(t,r)=>$b(t,n2(e,r))}function Ls(e,t){return $b(e,n2("default",t))}Ls.loading=(e,t)=>$b(e,n2("default",{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1,...t}));function Uve(e,{pending:t,error:r,success:n},a){let u;t&&(u=Vx(t)?Ls.loading(t,a):Ls.loading(t.render,{...a,...t}));let f={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},i=(w,T,A)=>{if(T==null){Ls.dismiss(u);return}let k={type:w,...f,...a,data:A},F=Vx(T)?{render:T}:T;return u?Ls.update(u,{...k,...F}):Ls(F.render,{...k,...F}),A},y=DX(e)?e():e;return y.then(w=>i("success",n,w)).catch(w=>i("error",r,w)),y}Ls.promise=Uve;Ls.success=i2("success");Ls.info=i2("info");Ls.error=i2("error");Ls.warning=i2("warning");Ls.warn=Ls.warning;Ls.dark=(e,t)=>$b(e,n2("default",{theme:"dark",...t}));function qve(e){zve(e)}Ls.dismiss=qve;Ls.clearWaitingQueue=Fve;Ls.isActive=Nve;Ls.update=(e,t={})=>{let r=Dve(e,t);if(r){let{props:n,content:a}=r,u={delay:100,...n,...t,toastId:t.toastId||e,updateId:NX()};u.toastId!==e&&(u.staleId=e);let f=u.render||a;delete u.render,$b(f,u)}};Ls.done=e=>{Ls.update(e,{progress:1})};Ls.onChange=$ve;Ls.play=e=>FX(!0,e);Ls.pause=e=>FX(!1,e);const Gve=({userId:e})=>{const[t,r]=j.useState([]),[n,a]=j.useState(!1),[u,f]=j.useState(0),i=j.useRef(null);j.useEffect(()=>{(async()=>{try{const O=await fetch(`/api/notifications/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(O.ok){const N=await O.json();r(N),f(N.filter(V=>!V.read).length)}else r([]),f(0)}catch(O){console.error("❌ [ChatNotifications] Erreur chargement notifications:",O),r([]),f(0)}})()},[e]),j.useEffect(()=>{const D=new WebSocket(`ws://${window.location.host}/ws/notifications/${e}`);return i.current=D,D.onopen=()=>{console.log("WebSocket notifications connecté")},D.onmessage=O=>{try{const N=JSON.parse(O.data);y(N)}catch(N){console.error("Erreur parsing notification:",N)}},D.onclose=()=>{console.log("WebSocket notifications déconnecté")},()=>{D.close()}},[e]);const y=D=>{const O={id:Date.now().toString(),type:D.type||"message",sender:{id:D.sender_id,name:D.sender_name,avatar:D.sender_avatar},content:D.content,timestamp:new Date,read:!1,serviceId:D.service_id};r(N=>[O,...N]),f(N=>N+1),Yn.success(`Nouveau message de ${O.sender.name}`,{duration:4e3,icon:"💬"})},w=D=>{r(O=>O.map(N=>N.id===D?{...N,read:!0}:N)),f(O=>Math.max(0,O-1))},T=()=>{r(D=>D.map(O=>({...O,read:!0}))),f(0)},A=D=>{r(O=>O.filter(N=>N.id!==D)),f(O=>{const N=t.find(V=>V.id===D);return N&&!N.read?Math.max(0,O-1):O})},k=D=>{const N=new Date().getTime()-D.getTime(),V=Math.floor(N/(1e3*60)),H=Math.floor(N/(1e3*60*60)),Z=Math.floor(N/(1e3*60*60*24));return V<1?"À l'instant":V<60?`Il y a ${V}min`:H<24?`Il y a ${H}h`:Z<7?`Il y a ${Z}j`:D.toLocaleDateString()},F=D=>{switch(D){case"message":return b.jsx(xy,{className:"h-4 w-4 text-blue-500"});case"call":return b.jsx(MC,{className:"h-4 w-4 text-green-500"});case"mention":return b.jsx(xy,{className:"h-4 w-4 text-purple-500"});default:return b.jsx(MC,{className:"h-4 w-4 text-gray-500"})}};return b.jsxs("div",{className:"relative",children:[b.jsxs(cr,{variant:"ghost",size:"sm",onClick:()=>a(!n),className:"relative p-2",children:[b.jsx(MC,{className:"h-5 w-5"}),u>0&&b.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:u>9?"9+":u})]}),n&&b.jsxs("div",{className:"absolute right-0 top-full mt-2 w-80 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-50",children:[b.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[b.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Notifications"}),b.jsxs("div",{className:"flex items-center space-x-2",children:[u>0&&b.jsx(cr,{variant:"ghost",size:"sm",onClick:T,className:"text-xs",children:"Tout marquer comme lu"}),b.jsx(cr,{variant:"ghost",size:"sm",onClick:()=>a(!1),children:b.jsx(Os,{className:"h-4 w-4"})})]})]}),b.jsx("div",{className:"max-h-96 overflow-y-auto",children:t.length===0?b.jsx("div",{className:"p-4 text-center text-gray-500 dark:text-gray-400",children:"Aucune notification"}):t.map(D=>b.jsx("div",{className:`p-4 border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors ${D.read?"":"bg-blue-50 dark:bg-blue-900/20"}`,onClick:()=>w(D.id),children:b.jsxs("div",{className:"flex items-start space-x-3",children:[b.jsx("div",{className:"flex-shrink-0",children:D.sender.avatar?b.jsx("img",{src:D.sender.avatar,alt:D.sender.name,className:"h-8 w-8 rounded-full"}):b.jsx("div",{className:"h-8 w-8 bg-gray-300 dark:bg-gray-600 rounded-full flex items-center justify-center",children:F(D.type)})}),b.jsxs("div",{className:"flex-1 min-w-0",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:D.sender.name}),b.jsxs("div",{className:"flex items-center space-x-2",children:[b.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:k(D.timestamp)}),b.jsx(cr,{variant:"ghost",size:"sm",onClick:O=>{O.stopPropagation(),A(D.id)},className:"h-4 w-4 p-0 text-gray-400 hover:text-red-500",children:b.jsx(Os,{className:"h-3 w-3"})})]})]}),b.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[F(D.type),b.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 truncate",children:D.content})]}),!D.read&&b.jsx("div",{className:"mt-2",children:b.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"})})]})]})},D.id))}),t.length>0&&b.jsx("div",{className:"p-3 border-t border-gray-200 dark:border-gray-700",children:b.jsx(cr,{variant:"ghost",size:"sm",className:"w-full text-sm",onClick:()=>{window.location.href="/notifications"},children:"Voir toutes les notifications"})})]})]})},Hve=({onClick:e,unreadCount:t=0})=>b.jsxs(cr,{onClick:e,className:"fixed bottom-6 right-6 z-50 w-14 h-14 rounded-full bg-blue-600 hover:bg-blue-700 text-white shadow-lg hover:shadow-xl transition-all duration-200 flex items-center justify-center",title:"Ouvrir le chat",children:[b.jsx(xy,{className:"w-6 h-6"}),t>0&&b.jsx("div",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:t>9?"9+":t})]});function Oy(){const e=j.useContext(iZ);if(!e)throw new Error("useToast must be used within a ToasterProvider");return e}const e_=j.forwardRef(({className:e,size:t="md",children:r,...n},a)=>{const u={sm:"h-8 w-8",md:"h-10 w-10",lg:"h-12 w-12"};return b.jsx("div",{ref:a,className:Ec("relative flex shrink-0 overflow-hidden rounded-full",u[t],e),...n,children:r})});e_.displayName="Avatar";const Ux=j.forwardRef(({className:e,...t},r)=>b.jsx("img",{ref:r,className:Ec("aspect-square h-full w-full object-cover",e),...t}));Ux.displayName="AvatarImage";const t_=j.forwardRef(({className:e,...t},r)=>b.jsx("div",{ref:r,className:Ec("flex h-full w-full items-center justify-center rounded-full bg-gray-200 text-gray-600 font-medium",e),...t}));t_.displayName="AvatarFallback";const Wve=({isOpen:e,onClose:t,onChatSelect:r,chats:n,loading:a})=>{Rs();const{toast:u}=Oy(),f=i=>{const y=new Date(i),T=new Date().getTime()-y.getTime(),A=Math.floor(T/(1e3*60)),k=Math.floor(T/(1e3*60*60)),F=Math.floor(T/(1e3*60*60*24));return A<1?"À l'instant":A<60?`Il y a ${A}min`:k<24?`Il y a ${k}h`:F<7?`Il y a ${F}j`:y.toLocaleDateString()};return e?b.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:b.jsxs("div",{className:"bg-white rounded-lg w-full max-w-md h-96 flex flex-col",children:[b.jsxs("div",{className:"flex justify-between items-center p-4 border-b bg-gray-50",children:[b.jsx("h2",{className:"text-lg font-semibold",children:"💬 Mes chats"}),b.jsx(cr,{variant:"ghost",size:"sm",onClick:t,className:"text-gray-500 hover:text-gray-700",children:b.jsx(Os,{className:"w-4 h-4"})})]}),b.jsx("div",{className:"flex-1 overflow-y-auto",children:a?b.jsx("div",{className:"flex items-center justify-center py-8",children:b.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):n.length===0?b.jsxs("div",{className:"text-center text-gray-500 py-8",children:[b.jsx(xy,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),b.jsx("p",{children:"Aucun chat pour le moment"}),b.jsx("p",{className:"text-sm",children:"Vos conversations apparaîtront ici"})]}):b.jsx("div",{className:"divide-y",children:n.map(i=>b.jsx("div",{className:"p-4 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>r(i),children:b.jsxs("div",{className:"flex items-center gap-3",children:[b.jsxs("div",{className:"relative",children:[b.jsx(e_,{className:"w-10 h-10",children:b.jsx(t_,{className:"bg-blue-500 text-white text-sm",children:i.nom.charAt(0).toUpperCase()})}),i.isOnline&&b.jsx("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white"})]}),b.jsxs("div",{className:"flex-1 min-w-0",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsx("h3",{className:"font-medium truncate",children:i.nom}),b.jsx("span",{className:"text-xs text-gray-500",children:f(i.lastMessageTime)})]}),b.jsx("p",{className:"text-sm text-gray-600 truncate",children:i.lastMessage}),b.jsxs("p",{className:"text-xs text-blue-600",children:["Service #",i.serviceId]})]}),i.unreadCount>0&&b.jsx("div",{className:"bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:i.unreadCount>9?"9+":i.unreadCount})]})},i.id))})}),b.jsx("div",{className:"p-4 border-t bg-gray-50",children:b.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Cliquez sur un chat pour ouvrir la conversation"})})]})}):null},Zve=()=>{const e=Mo(),[t,r]=j.useState(null),[n,a]=j.useState(!1),u=j.useCallback(A=>{r(A),a(!1),e("/resultat-besoin",{state:{openChat:!0,serviceId:A.serviceId,prestataireId:A.prestataireId,chatId:A.id}})},[e]),f=j.useCallback(()=>{r(null)},[]),i=j.useCallback(()=>{a(!0)},[]),y=j.useCallback(()=>{a(!1)},[]),w=j.useCallback(async(A,k)=>{try{return(await fetch("/api/chat/edit-message",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({messageId:A,newContent:k})})).ok?!0:(console.error("Erreur modification message"),!1)}catch(F){return console.error("Erreur modification message:",F),!1}},[]),T=j.useCallback(async A=>{try{return(await fetch("/api/chat/delete-message",{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({messageId:A})})).ok?!0:(console.error("Erreur suppression message"),!1)}catch(k){return console.error("Erreur suppression message:",k),!1}},[]);return{activeChat:t,showChatList:n,openChat:u,closeChat:f,openChatList:i,closeChatList:y,editMessage:w,deleteMessage:T}},Ka=({children:e,padding:t=!0})=>{const{user:r}=Rs(),{showChatList:n,openChatList:a,closeChatList:u,openChat:f}=Zve();return j.useEffect(()=>{const i=window.matchMedia("(prefers-color-scheme: dark)").matches,y=localStorage.getItem("theme"),w=y==="dark"||!y&&i;document.documentElement.classList.toggle("dark",w)},[]),b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-white/80 dark:bg-gray-950/80 backdrop-blur-md shadow-sm border-b border-gray-200 dark:border-gray-800",children:b.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-16",children:[b.jsx(Ive,{}),b.jsxs("div",{className:"flex items-center space-x-4",children:[r&&b.jsx(Gve,{userId:parseInt(r.id)}),b.jsx(kve,{})]})]})}),b.jsx(nZ,{}),b.jsx("main",{className:`pt-24 min-h-screen transition-all duration-300 bg-gradient-to-br from-yellow-50 via-white to-pink-50 dark:from-gray-900 dark:via-gray-950 dark:to-gray-900 ${t?"px-4 sm:px-6 lg:px-8":""}`,children:b.jsx("div",{className:"max-w-7xl mx-auto relative",children:e})}),b.jsx(cve,{}),(r==null?void 0:r.role)==="admin"&&!1,r&&b.jsxs(b.Fragment,{children:[b.jsx(Hve,{onClick:a,unreadCount:0}),b.jsx(Wve,{isOpen:n,onClose:u,onChatSelect:f,chats:[],loading:!1})]})]})};Wn.defaults.maxContentLength=200*1024*1024;Wn.defaults.maxBodyLength=200*1024*1024;function BX(){return"dev-bypass-token"}async function Xve(e,t){var u;const r=localStorage.getItem("token"),n=localStorage.getItem("__DEV_FAKE_USER__")==="true",a={"Content-Type":"application/json"};if(r)a.Authorization=`Bearer ${r}`;else if(n){const f=BX();a.Authorization=`Bearer ${f}`,console.warn("🧪 Mode développement : utilisation d'un token JWT de développement")}else console.warn("⚠️ Aucun token d'authentification trouvé");try{const f=await fetch("/api/ia/creation-service",{method:"POST",headers:a,body:JSON.stringify(e)});if(!f.ok)throw new Error(`HTTP ${f.status}: ${f.statusText}`);const i=await f.json();console.log("[yukpoaclient] IA response payload:",i);const y=f.headers.get("x-tokens-remaining");return y&&(localStorage.setItem("tokens_balance",y),console.log("[yukpoaclient] Solde tokens mis à jour:",y)),{data:i,headers:f.headers}}catch(f){throw console.error("❌ Erreur lors de l'appel à l'API IA:",f),(u=f.message)!=null&&u.includes("401")&&console.error("🔐 Erreur d'authentification. Activez le mode développeur ou connectez-vous."),f}}async function Kve(e){const t=localStorage.getItem("token"),r=localStorage.getItem("__DEV_FAKE_USER__")==="true";if(!t&&!r)throw new Error("Token d'authentification manquant");const n={"Content-Type":"application/json"};if(t)n.Authorization=`Bearer ${t}`;else if(r){const i=BX();n.Authorization=`Bearer ${i}`,console.warn("🧪 Mode développement : utilisation d'un token JWT de développement")}const a={texte:e.texte||e.description||"",base64_image:e.base64_image||[],audio_base64:e.audio_base64||[],video_base64:e.video_base64||[],doc_base64:e.doc_base64||[],excel_base64:e.excel_base64||[],pdf_base64:e.pdf_base64||[]},u=new AbortController,f=setTimeout(()=>u.abort(),5*60*1e3);try{const i=await fetch("/api/ia/creation-service",{method:"POST",headers:n,body:JSON.stringify(a),signal:u.signal});if(clearTimeout(f),!i.ok){const w=await i.json().catch(()=>({}));throw new Error(w.message||`Erreur IA: ${i.status}: ${i.statusText}`)}const y=await i.json();return console.log("[genererSuggestionsService] Suggestions générées par l'IA:",y),{data:{...y,suggestions:y.data||y},headers:i.headers}}catch(i){throw clearTimeout(f),i.name==="AbortError"?new Error("Timeout: La génération des suggestions a pris trop de temps (5 minutes)"):i}}async function $X(e,t){const r=localStorage.getItem("token");if(!r)throw new Error("Token d'authentification manquant");let n=e.user_id;if(!n)try{n=JSON.parse(atob(r.split(".")[1])).sub}catch{throw new Error("Impossible de déterminer l'ID utilisateur")}const a=new AbortController,u=setTimeout(()=>a.abort(),5*60*1e3);try{const f=await fetch("/api/services/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({user_id:n,...e,...t&&{tokens_ia_externe:t}}),signal:a.signal});if(clearTimeout(u),!f.ok){const y=await f.json().catch(()=>({}));throw new Error(y.message||`Erreur HTTP ${f.status}: ${f.statusText}`)}const i=await f.json();return console.log("[creerService] Service créé avec succès:",i),{data:i,headers:f.headers}}catch(f){throw clearTimeout(u),f.name==="AbortError"?new Error("Timeout: La création du service a pris trop de temps (5 minutes)"):f}}async function Yve(e){const t=localStorage.getItem("token");if(!t)throw new Error("Token manquant");return(await Wn.post("/api/services/vectorize",e,{headers:{Authorization:`Bearer ${t}`}})).data}const Jve=()=>{const e=Mo(),[t,r]=j.useState(!1),[n,a]=j.useState(0),[u,f]=j.useState(0),[i,y]=j.useState(0),[w,T]=j.useState(!1),[A,k]=j.useState(!1),[F,D]=j.useState(null);Rs();const{setStats:O}=j.useContext(VE),N=async Y=>{var ie;try{r(!0);const ce=((ie=Y.text)==null?void 0:ie.length)||0,ge=Y.images&&Y.images.length>0,be=Y.audio?1:0,xe=Y.files&&Y.files.length>0,Le=ce+(ge?100:0)+(be?150:0)+(xe?200:0);if(y(Le),O({confidence:0,tokensUsed:0,isProcessing:!0,inputLength:Le}),console.log("[HomePage] Données envoyées à Yukpo:",Y),w){D(Y),k(!0),r(!1);return}await V(Y)}catch(ce){O({confidence:0,tokensUsed:0,isProcessing:!1,inputLength:0}),console.error("❌ Erreur Yukpo détaillée:",ce),ce.response?(console.error("Réponse du serveur:",ce.response.data),console.error("Status:",ce.response.status),console.error("Headers:",ce.response.headers)):ce.request?console.error("Aucune réponse reçue, la requête était:",ce.request):console.error("Erreur de configuration de la requête:",ce.message)}finally{r(!1)}},V=async Y=>{var ie;try{const ce=await fetch("/api/search/direct",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(Y)});if(!ce.ok)throw new Error(`Erreur HTTP: ${ce.status}`);const ge=await ce.json(),be=0;a(be),f(ge.tokens_consumed||0),O({confidence:be,tokensUsed:ge.tokens_consumed||0,isProcessing:!1,inputLength:i});const xe=((ie=ge==null?void 0:ge.resultats)==null?void 0:ie.resultats)||(ge==null?void 0:ge.resultats)||[];e("/resultat-besoin",{state:{results:xe,type:"recherche_besoin",suggestion:ge}})}catch(ce){console.error("Erreur lors de la recherche:",ce),O({confidence:0,tokensUsed:0,isProcessing:!1,inputLength:0})}finally{r(!1)}},H=async Y=>{var ie,ce,ge,be,xe,Le;try{const ze=await Kve(Y),Xe={base64_image:((ie=ze.data.service_data)==null?void 0:ie.base64_image)||Y.base64_image,audio_base64:((ce=ze.data.service_data)==null?void 0:ce.audio_base64)||Y.audio_base64,video_base64:((ge=ze.data.service_data)==null?void 0:ge.video_base64)||Y.video_base64,doc_base64:((be=ze.data.service_data)==null?void 0:be.doc_base64)||Y.doc_base64,excel_base64:((xe=ze.data.service_data)==null?void 0:xe.excel_base64)||Y.excel_base64,pdf_base64:((Le=ze.data.service_data)==null?void 0:Le.pdf_base64)||Y.pdf_base64},Je={gps_mobile:Y.gps_mobile,gps_zone:Y.gps_zone,gps_fixe:Y.gps_fixe,gps_fixe_coords:Y.gps_fixe_coords};console.log("[HomePage] Données GPS extraites:",Je),e("/formulaire-yukpo-intelligent",{state:{suggestion:{...ze.data,intention:"creation_service",data:ze.data.suggestions||ze.data.data||ze.data},type:"creation_service",mediaData:Xe,gpsData:Je}})}catch(ze){console.error("Erreur lors de la génération des suggestions:",ze),Ls.error("Erreur lors de la génération des suggestions")}},Z=()=>{F&&(r(!0),H(F),k(!1),D(null))},J=()=>{F&&(V(F),k(!1),D(null))},G=Y=>{y(Y)};return b.jsxs(Ka,{padding:!1,children:[b.jsx("main",{className:"flex flex-col items-center justify-center px-4 sm:px-6 py-20 text-center min-h-[calc(100vh-4rem)]",children:b.jsxs(va.div,{className:"space-y-8 max-w-4xl w-full",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:[b.jsxs("div",{className:"space-y-4",children:[b.jsx("h1",{className:"text-4xl sm:text-5xl font-bold",children:b.jsx(kj,{})}),b.jsxs("p",{className:"text-gray-700 dark:text-gray-300 text-lg sm:text-xl font-medium max-w-2xl mx-auto",children:["Créez ou trouvez un service en un instant.",b.jsx("br",{className:"hidden sm:block"}),b.jsx("span",{className:"text-sm sm:text-base text-gray-600 dark:text-gray-400",children:"Une description, une image, un audio ou un fichier suffit."})]})]}),b.jsx("div",{className:"mt-8 flex items-center justify-center",children:b.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[b.jsx("input",{type:"checkbox",checked:w,onChange:Y=>T(Y.target.checked),className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"}),b.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Je souhaite créer un service/prestation"})]})}),b.jsx("div",{className:"mt-8",children:b.jsx(kX,{onSubmit:N,loading:t,onInputChange:G,showIASuggestion:!0})}),b.jsxs(va.div,{className:"flex justify-center gap-8 mt-8",initial:{opacity:0},animate:{opacity:1},transition:{delay:.8,duration:.6},children:[b.jsxs("div",{className:"text-center",children:[b.jsx("div",{className:"text-2xl mb-1",children:"🎯"}),b.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Détection intelligente"})]}),b.jsxs("div",{className:"text-center",children:[b.jsx("div",{className:"text-2xl mb-1",children:"⚡"}),b.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Traitement rapide"})]}),b.jsxs("div",{className:"text-center",children:[b.jsx("div",{className:"text-2xl mb-1",children:"🔐"}),b.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"100% sécurisé"})]})]})]})}),A&&b.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:b.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md mx-4",children:[b.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:"Confirmation de création de service"}),b.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-6",children:"Êtes-vous sûr de vouloir créer un service/prestation sur la plateforme ?"}),b.jsxs("div",{className:"flex space-x-3",children:[b.jsx("button",{onClick:Z,disabled:t,className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors disabled:opacity-70 disabled:cursor-not-allowed",children:t?"Ouverture…":"Oui, créer un service"}),b.jsx("button",{onClick:J,disabled:t,className:"flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400 transition-colors disabled:opacity-70 disabled:cursor-not-allowed",children:"Non, rechercher"})]})]})})]})},AS=({provider:e})=>{const t=e==="google"?"Google":"Facebook",r=e==="google"?"bg-red-500":"bg-blue-600",n=async()=>{const a=prompt(`Simuler un token OAuth ${t}`);if(!a)return alert("Aucun token fourni.");try{const u=await fetch("/auth/oauth",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token_id:a,provider:e})});if(!u.ok)throw new Error("Erreur OAuth");const f=await u.json();alert(`Bienvenue ${f.email} ! Vous êtes connecté.`)}catch(u){console.error(u),alert("Connexion échouée.")}};return b.jsxs("button",{onClick:n,className:`w-full ${r} text-white py-2 rounded hover:opacity-90 transition`,children:["Continuer avec ",t]})},Qve=()=>{const e=Mo();Rs();const[t,r]=j.useState({nom:"",prenom:"",email:"",password:"",confirmPassword:""}),[n,a]=j.useState(""),[u,f]=j.useState(!1),[i,y]=j.useState(!1),w=k=>{r({...t,[k.target.name]:k.target.value})},T=async k=>{if(k.preventDefault(),a(""),f(!0),!/^(?=.*[A-Z])(?=.*\d).{8,}$/.test(t.password)){a("Mot de passe trop faible : 8 caractères, 1 majuscule, 1 chiffre minimum."),f(!1);return}if(t.password!==t.confirmPassword){a("Les mots de passe ne correspondent pas."),f(!1);return}try{const D=await fetch("/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nom:t.nom,prenom:t.prenom,email:t.email,password:t.password,lang:"fr"})});if(D.ok)y(!0),Yn.success("Compte créé avec succès ! 🎉");else{const O=await D.json();a(O.message||"Erreur d'inscription"),Yn.error(O.message||"Erreur d'inscription")}}catch{a("Échec de la connexion au serveur."),Yn.error("Échec de la connexion au serveur.")}finally{f(!1)}},A=()=>{e($n.LOGIN,{state:{fromRegistration:!0,email:t.email,message:"Veuillez vous connecter avec vos identifiants."}})};return i?b.jsx("main",{className:"min-h-screen bg-yellow-50 pt-24",children:b.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8 max-w-lg mx-auto text-center",children:[b.jsxs("div",{className:"mb-6",children:[b.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:b.jsx("svg",{className:"w-10 h-10 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),b.jsx("h1",{className:"text-3xl font-bold mb-4 text-gray-900",children:"Inscription réussie ! 🎉"}),b.jsxs("p",{className:"text-gray-600 mb-6",children:["Votre compte ",b.jsx("span",{className:"font-semibold",children:t.email})," a été créé avec succès."]}),b.jsx("p",{className:"text-sm text-gray-500 mb-8",children:"Vous pouvez maintenant vous connecter pour accéder à toutes les fonctionnalités de Yukpo."})]}),b.jsxs("div",{className:"space-y-3",children:[b.jsx("button",{onClick:A,className:"block w-full bg-yellow-500 text-black py-3 px-6 rounded-lg font-semibold hover:bg-yellow-600 transition-colors",children:"Se connecter maintenant →"}),b.jsx(Bo,{to:$n.HOME,className:"block w-full bg-gray-100 text-gray-700 py-3 px-6 rounded-lg font-medium hover:bg-gray-200 transition-colors",children:"Retour à l'accueil"})]}),b.jsx("p",{className:"text-xs text-gray-500 mt-6",children:"En cas de problème, contactez notre support à support@yukpo.com"})]})}):b.jsx("main",{className:"min-h-screen bg-yellow-50 pt-24",children:b.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8 max-w-lg mx-auto",children:[b.jsxs("h1",{className:"text-3xl font-bold mb-6 text-center text-gray-900",children:["Créer un compte"," ",b.jsx("span",{className:"bg-gradient-to-r from-yellow-500 via-orange-500 to-red-500 bg-clip-text text-transparent",children:"Yukpo"})]}),b.jsxs("p",{className:"text-center text-gray-600 mb-4",children:["Utilisez votre compte ",b.jsx("strong",{children:"Google"})," ou ",b.jsx("strong",{children:"Facebook"})," pour vous inscrire rapidement :"]}),b.jsxs("div",{className:"flex justify-center gap-4 mb-6",children:[b.jsx(AS,{provider:"google"}),b.jsx(AS,{provider:"facebook"})]}),b.jsxs("div",{className:"relative mb-6",children:[b.jsx("div",{className:"absolute inset-0 flex items-center",children:b.jsx("div",{className:"w-full border-t border-gray-300"})}),b.jsx("div",{className:"relative flex justify-center text-sm",children:b.jsx("span",{className:"px-2 bg-white text-gray-500",children:"ou créez un compte manuellement"})})]}),b.jsxs("form",{onSubmit:T,className:"space-y-4",children:[b.jsx("input",{type:"text",name:"nom",placeholder:"Nom de famille",value:t.nom,onChange:w,className:"w-full border px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent",required:!0,disabled:u}),b.jsx("input",{type:"text",name:"prenom",placeholder:"Prénom",value:t.prenom,onChange:w,className:"w-full border px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent",required:!0,disabled:u}),b.jsx("input",{type:"email",name:"email",placeholder:"Adresse email",value:t.email,onChange:w,className:"w-full border px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent",required:!0,disabled:u}),b.jsx("input",{type:"password",name:"password",placeholder:"Mot de passe",value:t.password,onChange:w,className:"w-full border px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent",required:!0,disabled:u}),b.jsx("input",{type:"password",name:"confirmPassword",placeholder:"Confirmer le mot de passe",value:t.confirmPassword,onChange:w,className:"w-full border px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent",required:!0,disabled:u}),b.jsx("p",{className:"text-xs text-gray-500 italic",children:"Mot de passe requis : 8 caractères, 1 majuscule, 1 chiffre."}),n&&b.jsx("div",{className:"bg-red-50 border border-red-200 text-red-600 text-sm p-3 rounded-lg text-center",children:n}),b.jsx("button",{type:"submit",className:"w-full bg-yellow-500 text-black py-3 rounded-lg font-semibold hover:bg-yellow-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",disabled:u,children:u?b.jsxs(b.Fragment,{children:[b.jsx("span",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-black mr-2"}),"Création du compte..."]}):"Créer mon compte"})]}),b.jsx("div",{className:"mt-6 text-center",children:b.jsxs("p",{className:"text-sm text-gray-600",children:["Vous avez déjà un compte ?"," ",b.jsx(Bo,{to:$n.LOGIN,className:"text-yellow-600 hover:text-yellow-700 font-medium",children:"Connectez-vous"})]})})]})})},e_e=()=>{const e=Sc(),t=Mo(),{login:r}=Rs(),[n,a]=j.useState(!1),[u,f]=j.useState(""),[i,y]=j.useState(""),[w,T]=j.useState(null),[A,k]=j.useState(!1),F=j.useRef(null);j.useEffect(()=>{var O;(O=e.state)!=null&&O.loggedOut&&(a(!0),window.history.replaceState({},document.title))},[e.state]),j.useEffect(()=>{var O;(O=e.state)!=null&&O.fromRegistration&&(e.state.email&&(f(e.state.email),setTimeout(()=>{var N;(N=F.current)==null||N.focus()},100)),e.state.message&&Yn.success(e.state.message),window.history.replaceState({},document.title))},[e]);const D=async O=>{O&&O.preventDefault(),T(null),k(!0),console.log("[LoginPage] Tentative de connexion pour:",u);try{const N={email:u,password:i};console.log("[LoginPage] Données de connexion:",{email:u,password:"***"});const V=await fetch("/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(N)});if(console.log("[LoginPage] Réponse du serveur:",V.status,V.statusText),V.ok){const H=await V.json();console.log("[LoginPage] Données reçues:",{token:!!H.token,tokens_balance:H.tokens_balance}),H.token?(console.log("[LoginPage] Token reçu, connexion..."),H.tokens_balance!==void 0&&(localStorage.setItem("tokens_balance",H.tokens_balance.toString()),window.dispatchEvent(new CustomEvent("tokens_updated")),console.log("[LoginPage] Solde initial sauvegardé:",H.tokens_balance)),r(H.token),t($n.HOME),window.location.reload()):(console.error("[LoginPage] Pas de token dans la réponse"),T("Réponse inattendue du serveur: pas de token."))}else{const H=await V.text();console.error("[LoginPage] Erreur serveur:",V.status,H);let Z="Erreur de connexion";try{const J=JSON.parse(H);Z=J.message||J.error||Z}catch{Z=`Erreur ${V.status}: ${H}`}T(Z)}}catch(N){console.error("[LoginPage] Erreur réseau:",N),T("Erreur réseau ou serveur inaccessible.")}finally{k(!1)}};return b.jsx("main",{className:"min-h-screen pt-28 bg-gradient-to-br from-yellow-50 via-white to-red-50 dark:from-gray-900 dark:via-gray-950 dark:to-gray-900",children:b.jsxs("div",{className:"max-w-md mx-auto bg-white dark:bg-gray-900 shadow-xl rounded-xl p-8",children:[n&&b.jsx("div",{className:"mb-4 bg-green-100 text-green-800 px-4 py-2 rounded shadow text-center",children:"✅ Vous êtes bien déconnecté."}),w&&b.jsxs("div",{className:"mb-4 bg-red-100 text-red-800 px-4 py-2 rounded shadow text-center",children:["❌ ",w]}),b.jsxs("h1",{className:"text-3xl font-bold text-center mb-4",children:["Connexion à"," ",b.jsx("span",{className:"bg-gradient-to-r from-yellow-500 via-orange-500 to-red-500 bg-clip-text text-transparent",children:"Yukpo"})]}),b.jsxs("p",{className:"text-center text-gray-600 dark:text-gray-300 mb-6",children:["Connectez-vous avec votre compte ",b.jsx("strong",{children:"Google"})," ou ",b.jsx("strong",{children:"Facebook"})]}),b.jsxs("div",{className:"flex flex-col sm:flex-row justify-center gap-4 mb-6",children:[b.jsx(AS,{provider:"google"}),b.jsx(AS,{provider:"facebook"})]}),b.jsx("p",{className:"text-center text-sm text-gray-500 dark:text-gray-400 mb-4",children:"ou utilisez vos identifiants :"}),b.jsxs("form",{className:"flex flex-col gap-4 mt-2",onSubmit:D,children:[b.jsx("input",{type:"email",placeholder:"Adresse email",className:"p-3 rounded-md border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-primary",required:!0,value:u,onChange:O=>f(O.target.value),autoComplete:"username",disabled:A}),b.jsx("input",{type:"password",placeholder:"Mot de passe",className:"p-3 rounded-md border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-primary",required:!0,value:i,onChange:O=>y(O.target.value),autoComplete:"current-password",disabled:A,ref:F}),b.jsx("button",{type:"submit",className:"bg-green-600 hover:bg-green-700 text-white py-2 rounded-md transition font-semibold disabled:opacity-50",disabled:A,children:A?"Connexion...":"Se connecter"})]}),b.jsxs("p",{className:"text-center text-sm mt-6 text-gray-700 dark:text-gray-300",children:["Pas encore inscrit ?"," ",b.jsx(Bo,{to:$n.REGISTER,className:"text-primary underline font-medium",children:"Créer un compte"})]})]})})},t_e=({children:e})=>b.jsx("div",{className:"min-h-screen bg-[#fffbea] pt-24 px-4 flex justify-center items-start",children:b.jsx("div",{className:"w-full max-w-3xl",children:e})}),r_e=()=>b.jsx(t_e,{children:b.jsxs("div",{className:"bg-white rounded-lg shadow p-6 text-center",children:[b.jsxs("h2",{className:"text-2xl font-bold text-green-700 mb-4",children:["📧 Vérification requise pour"," ",b.jsx("span",{className:"bg-gradient-to-r from-yellow-500 via-orange-500 to-red-500 bg-clip-text text-transparent",children:"Yukpo"})]}),b.jsx("p",{className:"text-gray-700 mb-6",children:"Un lien de confirmation vous a été envoyé par email. Veuillez vérifier votre boîte de réception pour activer votre compte."}),b.jsx(Bo,{to:$n.HOME,className:"text-primary font-semibold hover:underline",children:"⬅ Retour à l'accueil"})]})}),n_e=()=>{const{t:e}=R_(),t=Mo();return b.jsx("div",{className:"",children:b.jsxs(va.div,{className:"",initial:{opacity:0,y:50},animate:{opacity:1,y:0},transition:{duration:.5},children:[b.jsx(va.h1,{className:"text-6xl font-extrabold text-primary mb-4",initial:{scale:.8},animate:{scale:1},transition:{delay:.2},children:"404"}),b.jsx("p",{className:"text-xl font-semibold text-gray-800 mb-2",children:e("notfound.title","Page introuvable")}),b.jsx("p",{className:"text-gray-600 mb-6",children:e("notfound.subtitle","La page demandée n'existe pas ou a été déplacée.")}),b.jsxs(cr,{onClick:()=>t($n.HOME),className:"flex items-center gap-2",children:[b.jsx(BE,{size:18})," ",e("notfound.back","Retour à l’accueil")]})]})})},$i=j.forwardRef(({className:e,type:t="text",...r},n)=>b.jsx("input",{type:t,className:Ec("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm shadow-sm","placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary","disabled:cursor-not-allowed disabled:opacity-50",e),ref:n,...r}));$i.displayName="Input";const Sy=j.forwardRef(({className:e,...t},r)=>b.jsx("textarea",{className:Ec("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm shadow-sm","placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary","disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...t}));Sy.displayName="Textarea";var BC="focusScope.autoFocusOnMount",$C="focusScope.autoFocusOnUnmount",w6={bubbles:!1,cancelable:!0},i_e="FocusScope",VX=j.forwardRef((e,t)=>{const{loop:r=!1,trapped:n=!1,onMountAutoFocus:a,onUnmountAutoFocus:u,...f}=e,[i,y]=j.useState(null),w=Yv(a),T=Yv(u),A=j.useRef(null),k=Qu(t,O=>y(O)),F=j.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;j.useEffect(()=>{if(n){let O=function(Z){if(F.paused||!i)return;const J=Z.target;i.contains(J)?A.current=J:Mm(A.current,{select:!0})},N=function(Z){if(F.paused||!i)return;const J=Z.relatedTarget;J!==null&&(i.contains(J)||Mm(A.current,{select:!0}))},V=function(Z){if(document.activeElement===document.body)for(const G of Z)G.removedNodes.length>0&&Mm(i)};document.addEventListener("focusin",O),document.addEventListener("focusout",N);const H=new MutationObserver(V);return i&&H.observe(i,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",O),document.removeEventListener("focusout",N),H.disconnect()}}},[n,i,F.paused]),j.useEffect(()=>{if(i){E6.add(F);const O=document.activeElement;if(!i.contains(O)){const V=new CustomEvent(BC,w6);i.addEventListener(BC,w),i.dispatchEvent(V),V.defaultPrevented||(s_e(u_e(UX(i)),{select:!0}),document.activeElement===O&&Mm(i))}return()=>{i.removeEventListener(BC,w),setTimeout(()=>{const V=new CustomEvent($C,w6);i.addEventListener($C,T),i.dispatchEvent(V),V.defaultPrevented||Mm(O??document.body,{select:!0}),i.removeEventListener($C,T),E6.remove(F)},0)}}},[i,w,T,F]);const D=j.useCallback(O=>{if(!r&&!n||F.paused)return;const N=O.key==="Tab"&&!O.altKey&&!O.ctrlKey&&!O.metaKey,V=document.activeElement;if(N&&V){const H=O.currentTarget,[Z,J]=o_e(H);Z&&J?!O.shiftKey&&V===J?(O.preventDefault(),r&&Mm(Z,{select:!0})):O.shiftKey&&V===Z&&(O.preventDefault(),r&&Mm(J,{select:!0})):V===H&&O.preventDefault()}},[r,n,F.paused]);return b.jsx(Tc.div,{tabIndex:-1,...f,ref:k,onKeyDown:D})});VX.displayName=i_e;function s_e(e,{select:t=!1}={}){const r=document.activeElement;for(const n of e)if(Mm(n,{select:t}),document.activeElement!==r)return}function o_e(e){const t=UX(e),r=S6(t,e),n=S6(t.reverse(),e);return[r,n]}function UX(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const a=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||a?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function S6(e,t){for(const r of e)if(!a_e(r,{upTo:t}))return r}function a_e(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function l_e(e){return e instanceof HTMLInputElement&&"select"in e}function Mm(e,{select:t=!1}={}){if(e&&e.focus){const r=document.activeElement;e.focus({preventScroll:!0}),e!==r&&l_e(e)&&t&&e.select()}}var E6=c_e();function c_e(){let e=[];return{add(t){const r=e[0];t!==r&&(r==null||r.pause()),e=T6(e,t),e.unshift(t)},remove(t){var r;e=T6(e,t),(r=e[0])==null||r.resume()}}}function T6(e,t){const r=[...e],n=r.indexOf(t);return n!==-1&&r.splice(n,1),r}function u_e(e){return e.filter(t=>t.tagName!=="A")}var VC=0;function d_e(){j.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??C6()),document.body.insertAdjacentElement("beforeend",e[1]??C6()),VC++,()=>{VC===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),VC--}},[])}function C6(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var ef=function(){return ef=Object.assign||function(t){for(var r,n=1,a=arguments.length;n<a;n++){r=arguments[n];for(var u in r)Object.prototype.hasOwnProperty.call(r,u)&&(t[u]=r[u])}return t},ef.apply(this,arguments)};function qX(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]]);return r}function h_e(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,u;n<a;n++)(u||!(n in t))&&(u||(u=Array.prototype.slice.call(t,0,n)),u[n]=t[n]);return e.concat(u||Array.prototype.slice.call(t))}var Xw="right-scroll-bar-position",Kw="width-before-scroll-bar",f_e="with-scroll-bars-hidden",p_e="--removed-body-scroll-bar-size";function UC(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function m_e(e,t){var r=j.useState(function(){return{value:e,callback:t,facade:{get current(){return r.value},set current(n){var a=r.value;a!==n&&(r.value=n,r.callback(n,a))}}}})[0];return r.callback=t,r.facade}var g_e=typeof window<"u"?j.useLayoutEffect:j.useEffect,A6=new WeakMap;function y_e(e,t){var r=m_e(null,function(n){return e.forEach(function(a){return UC(a,n)})});return g_e(function(){var n=A6.get(r);if(n){var a=new Set(n),u=new Set(e),f=r.current;a.forEach(function(i){u.has(i)||UC(i,null)}),u.forEach(function(i){a.has(i)||UC(i,f)})}A6.set(r,e)},[e]),r}function v_e(e){return e}function __e(e,t){t===void 0&&(t=v_e);var r=[],n=!1,a={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:e},useMedium:function(u){var f=t(u,n);return r.push(f),function(){r=r.filter(function(i){return i!==f})}},assignSyncMedium:function(u){for(n=!0;r.length;){var f=r;r=[],f.forEach(u)}r={push:function(i){return u(i)},filter:function(){return r}}},assignMedium:function(u){n=!0;var f=[];if(r.length){var i=r;r=[],i.forEach(u),f=r}var y=function(){var T=f;f=[],T.forEach(u)},w=function(){return Promise.resolve().then(y)};w(),r={push:function(T){f.push(T),w()},filter:function(T){return f=f.filter(T),r}}}};return a}function x_e(e){e===void 0&&(e={});var t=__e(null);return t.options=ef({async:!0,ssr:!1},e),t}var GX=function(e){var t=e.sideCar,r=qX(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=t.read();if(!n)throw new Error("Sidecar medium not found");return j.createElement(n,ef({},r))};GX.isSideCarExport=!0;function b_e(e,t){return e.useMedium(t),GX}var HX=x_e(),qC=function(){},s2=j.forwardRef(function(e,t){var r=j.useRef(null),n=j.useState({onScrollCapture:qC,onWheelCapture:qC,onTouchMoveCapture:qC}),a=n[0],u=n[1],f=e.forwardProps,i=e.children,y=e.className,w=e.removeScrollBar,T=e.enabled,A=e.shards,k=e.sideCar,F=e.noIsolation,D=e.inert,O=e.allowPinchZoom,N=e.as,V=N===void 0?"div":N,H=e.gapMode,Z=qX(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),J=k,G=y_e([r,t]),Y=ef(ef({},Z),a);return j.createElement(j.Fragment,null,T&&j.createElement(J,{sideCar:HX,removeScrollBar:w,shards:A,noIsolation:F,inert:D,setCallbacks:u,allowPinchZoom:!!O,lockRef:r,gapMode:H}),f?j.cloneElement(j.Children.only(i),ef(ef({},Y),{ref:G})):j.createElement(V,ef({},Y,{className:y,ref:G}),i))});s2.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};s2.classNames={fullWidth:Kw,zeroRight:Xw};var w_e=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function S_e(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=w_e();return t&&e.setAttribute("nonce",t),e}function E_e(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function T_e(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var C_e=function(){var e=0,t=null;return{add:function(r){e==0&&(t=S_e())&&(E_e(t,r),T_e(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},A_e=function(){var e=C_e();return function(t,r){j.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&r])}},WX=function(){var e=A_e(),t=function(r){var n=r.styles,a=r.dynamic;return e(n,a),null};return t},P_e={left:0,top:0,right:0,gap:0},GC=function(e){return parseInt(e||"",10)||0},M_e=function(e){var t=window.getComputedStyle(document.body),r=t[e==="padding"?"paddingLeft":"marginLeft"],n=t[e==="padding"?"paddingTop":"marginTop"],a=t[e==="padding"?"paddingRight":"marginRight"];return[GC(r),GC(n),GC(a)]},I_e=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return P_e;var t=M_e(e),r=document.documentElement.clientWidth,n=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,n-r+t[2]-t[0])}},k_e=WX(),Vv="data-scroll-locked",O_e=function(e,t,r,n){var a=e.left,u=e.top,f=e.right,i=e.gap;return r===void 0&&(r="margin"),`
  .`.concat(f_e,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(i,"px ").concat(n,`;
  }
  body[`).concat(Vv,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(n,";"),r==="margin"&&`
    padding-left: `.concat(a,`px;
    padding-top: `).concat(u,`px;
    padding-right: `).concat(f,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(i,"px ").concat(n,`;
    `),r==="padding"&&"padding-right: ".concat(i,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Xw,` {
    right: `).concat(i,"px ").concat(n,`;
  }
  
  .`).concat(Kw,` {
    margin-right: `).concat(i,"px ").concat(n,`;
  }
  
  .`).concat(Xw," .").concat(Xw,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(Kw," .").concat(Kw,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(Vv,`] {
    `).concat(p_e,": ").concat(i,`px;
  }
`)},P6=function(){var e=parseInt(document.body.getAttribute(Vv)||"0",10);return isFinite(e)?e:0},L_e=function(){j.useEffect(function(){return document.body.setAttribute(Vv,(P6()+1).toString()),function(){var e=P6()-1;e<=0?document.body.removeAttribute(Vv):document.body.setAttribute(Vv,e.toString())}},[])},R_e=function(e){var t=e.noRelative,r=e.noImportant,n=e.gapMode,a=n===void 0?"margin":n;L_e();var u=j.useMemo(function(){return I_e(a)},[a]);return j.createElement(k_e,{styles:O_e(u,!t,a,r?"":"!important")})},$O=!1;if(typeof window<"u")try{var cw=Object.defineProperty({},"passive",{get:function(){return $O=!0,!0}});window.addEventListener("test",cw,cw),window.removeEventListener("test",cw,cw)}catch{$O=!1}var hv=$O?{passive:!1}:!1,j_e=function(e){return e.tagName==="TEXTAREA"},ZX=function(e,t){if(!(e instanceof Element))return!1;var r=window.getComputedStyle(e);return r[t]!=="hidden"&&!(r.overflowY===r.overflowX&&!j_e(e)&&r[t]==="visible")},D_e=function(e){return ZX(e,"overflowY")},N_e=function(e){return ZX(e,"overflowX")},M6=function(e,t){var r=t.ownerDocument,n=t;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var a=XX(e,n);if(a){var u=KX(e,n),f=u[1],i=u[2];if(f>i)return!0}n=n.parentNode}while(n&&n!==r.body);return!1},z_e=function(e){var t=e.scrollTop,r=e.scrollHeight,n=e.clientHeight;return[t,r,n]},F_e=function(e){var t=e.scrollLeft,r=e.scrollWidth,n=e.clientWidth;return[t,r,n]},XX=function(e,t){return e==="v"?D_e(t):N_e(t)},KX=function(e,t){return e==="v"?z_e(t):F_e(t)},B_e=function(e,t){return e==="h"&&t==="rtl"?-1:1},$_e=function(e,t,r,n,a){var u=B_e(e,window.getComputedStyle(t).direction),f=u*n,i=r.target,y=t.contains(i),w=!1,T=f>0,A=0,k=0;do{var F=KX(e,i),D=F[0],O=F[1],N=F[2],V=O-N-u*D;(D||V)&&XX(e,i)&&(A+=V,k+=D),i instanceof ShadowRoot?i=i.host:i=i.parentNode}while(!y&&i!==document.body||y&&(t.contains(i)||t===i));return(T&&Math.abs(A)<1||!T&&Math.abs(k)<1)&&(w=!0),w},uw=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},I6=function(e){return[e.deltaX,e.deltaY]},k6=function(e){return e&&"current"in e?e.current:e},V_e=function(e,t){return e[0]===t[0]&&e[1]===t[1]},U_e=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},q_e=0,fv=[];function G_e(e){var t=j.useRef([]),r=j.useRef([0,0]),n=j.useRef(),a=j.useState(q_e++)[0],u=j.useState(WX)[0],f=j.useRef(e);j.useEffect(function(){f.current=e},[e]),j.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(a));var O=h_e([e.lockRef.current],(e.shards||[]).map(k6),!0).filter(Boolean);return O.forEach(function(N){return N.classList.add("allow-interactivity-".concat(a))}),function(){document.body.classList.remove("block-interactivity-".concat(a)),O.forEach(function(N){return N.classList.remove("allow-interactivity-".concat(a))})}}},[e.inert,e.lockRef.current,e.shards]);var i=j.useCallback(function(O,N){if("touches"in O&&O.touches.length===2||O.type==="wheel"&&O.ctrlKey)return!f.current.allowPinchZoom;var V=uw(O),H=r.current,Z="deltaX"in O?O.deltaX:H[0]-V[0],J="deltaY"in O?O.deltaY:H[1]-V[1],G,Y=O.target,ie=Math.abs(Z)>Math.abs(J)?"h":"v";if("touches"in O&&ie==="h"&&Y.type==="range")return!1;var ce=M6(ie,Y);if(!ce)return!0;if(ce?G=ie:(G=ie==="v"?"h":"v",ce=M6(ie,Y)),!ce)return!1;if(!n.current&&"changedTouches"in O&&(Z||J)&&(n.current=G),!G)return!0;var ge=n.current||G;return $_e(ge,N,O,ge==="h"?Z:J)},[]),y=j.useCallback(function(O){var N=O;if(!(!fv.length||fv[fv.length-1]!==u)){var V="deltaY"in N?I6(N):uw(N),H=t.current.filter(function(G){return G.name===N.type&&(G.target===N.target||N.target===G.shadowParent)&&V_e(G.delta,V)})[0];if(H&&H.should){N.cancelable&&N.preventDefault();return}if(!H){var Z=(f.current.shards||[]).map(k6).filter(Boolean).filter(function(G){return G.contains(N.target)}),J=Z.length>0?i(N,Z[0]):!f.current.noIsolation;J&&N.cancelable&&N.preventDefault()}}},[]),w=j.useCallback(function(O,N,V,H){var Z={name:O,delta:N,target:V,should:H,shadowParent:H_e(V)};t.current.push(Z),setTimeout(function(){t.current=t.current.filter(function(J){return J!==Z})},1)},[]),T=j.useCallback(function(O){r.current=uw(O),n.current=void 0},[]),A=j.useCallback(function(O){w(O.type,I6(O),O.target,i(O,e.lockRef.current))},[]),k=j.useCallback(function(O){w(O.type,uw(O),O.target,i(O,e.lockRef.current))},[]);j.useEffect(function(){return fv.push(u),e.setCallbacks({onScrollCapture:A,onWheelCapture:A,onTouchMoveCapture:k}),document.addEventListener("wheel",y,hv),document.addEventListener("touchmove",y,hv),document.addEventListener("touchstart",T,hv),function(){fv=fv.filter(function(O){return O!==u}),document.removeEventListener("wheel",y,hv),document.removeEventListener("touchmove",y,hv),document.removeEventListener("touchstart",T,hv)}},[]);var F=e.removeScrollBar,D=e.inert;return j.createElement(j.Fragment,null,D?j.createElement(u,{styles:U_e(a)}):null,F?j.createElement(R_e,{gapMode:e.gapMode}):null)}function H_e(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const W_e=b_e(HX,G_e);var YX=j.forwardRef(function(e,t){return j.createElement(s2,ef({},e,{ref:t,sideCar:W_e}))});YX.classNames=s2.classNames;var Z_e=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},pv=new WeakMap,dw=new WeakMap,hw={},HC=0,JX=function(e){return e&&(e.host||JX(e.parentNode))},X_e=function(e,t){return t.map(function(r){if(e.contains(r))return r;var n=JX(r);return n&&e.contains(n)?n:(console.error("aria-hidden",r,"in not contained inside",e,". Doing nothing"),null)}).filter(function(r){return!!r})},K_e=function(e,t,r,n){var a=X_e(t,Array.isArray(e)?e:[e]);hw[r]||(hw[r]=new WeakMap);var u=hw[r],f=[],i=new Set,y=new Set(a),w=function(A){!A||i.has(A)||(i.add(A),w(A.parentNode))};a.forEach(w);var T=function(A){!A||y.has(A)||Array.prototype.forEach.call(A.children,function(k){if(i.has(k))T(k);else try{var F=k.getAttribute(n),D=F!==null&&F!=="false",O=(pv.get(k)||0)+1,N=(u.get(k)||0)+1;pv.set(k,O),u.set(k,N),f.push(k),O===1&&D&&dw.set(k,!0),N===1&&k.setAttribute(r,"true"),D||k.setAttribute(n,"true")}catch(V){console.error("aria-hidden: cannot operate on ",k,V)}})};return T(t),i.clear(),HC++,function(){f.forEach(function(A){var k=pv.get(A)-1,F=u.get(A)-1;pv.set(A,k),u.set(A,F),k||(dw.has(A)||A.removeAttribute(n),dw.delete(A)),F||A.removeAttribute(r)}),HC--,HC||(pv=new WeakMap,pv=new WeakMap,dw=new WeakMap,hw={})}},Y_e=function(e,t,r){r===void 0&&(r="data-aria-hidden");var n=Array.from(Array.isArray(e)?e:[e]),a=Z_e(e);return a?(n.push.apply(n,Array.from(a.querySelectorAll("[aria-live]"))),K_e(n,a,r,"aria-hidden")):function(){return null}},o2="Dialog",[QX,JFe]=dj(o2),[J_e,th]=QX(o2),eK=e=>{const{__scopeDialog:t,children:r,open:n,defaultOpen:a,onOpenChange:u,modal:f=!0}=e,i=j.useRef(null),y=j.useRef(null),[w,T]=DZ({prop:n,defaultProp:a??!1,onChange:u,caller:o2});return b.jsx(J_e,{scope:t,triggerRef:i,contentRef:y,contentId:qw(),titleId:qw(),descriptionId:qw(),open:w,onOpenChange:T,onOpenToggle:j.useCallback(()=>T(A=>!A),[T]),modal:f,children:r})};eK.displayName=o2;var tK="DialogTrigger",rK=j.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,a=th(tK,r),u=Qu(t,a.triggerRef);return b.jsx(Tc.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":jj(a.open),...n,ref:u,onClick:_c(e.onClick,a.onOpenToggle)})});rK.displayName=tK;var Lj="DialogPortal",[Q_e,nK]=QX(Lj,{forceMount:void 0}),iK=e=>{const{__scopeDialog:t,forceMount:r,children:n,container:a}=e,u=th(Lj,t);return b.jsx(Q_e,{scope:t,forceMount:r,children:j.Children.map(n,f=>b.jsx(zb,{present:r||u.open,children:b.jsx(jZ,{asChild:!0,container:a,children:f})}))})};iK.displayName=Lj;var PS="DialogOverlay",sK=j.forwardRef((e,t)=>{const r=nK(PS,e.__scopeDialog),{forceMount:n=r.forceMount,...a}=e,u=th(PS,e.__scopeDialog);return u.modal?b.jsx(zb,{present:n||u.open,children:b.jsx(t0e,{...a,ref:t})}):null});sK.displayName=PS;var e0e=uZ("DialogOverlay.RemoveScroll"),t0e=j.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,a=th(PS,r);return b.jsx(YX,{as:e0e,allowPinchZoom:!0,shards:[a.contentRef],children:b.jsx(Tc.div,{"data-state":jj(a.open),...n,ref:t,style:{pointerEvents:"auto",...n.style}})})}),Ey="DialogContent",oK=j.forwardRef((e,t)=>{const r=nK(Ey,e.__scopeDialog),{forceMount:n=r.forceMount,...a}=e,u=th(Ey,e.__scopeDialog);return b.jsx(zb,{present:n||u.open,children:u.modal?b.jsx(r0e,{...a,ref:t}):b.jsx(n0e,{...a,ref:t})})});oK.displayName=Ey;var r0e=j.forwardRef((e,t)=>{const r=th(Ey,e.__scopeDialog),n=j.useRef(null),a=Qu(t,r.contentRef,n);return j.useEffect(()=>{const u=n.current;if(u)return Y_e(u)},[]),b.jsx(aK,{...e,ref:a,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:_c(e.onCloseAutoFocus,u=>{var f;u.preventDefault(),(f=r.triggerRef.current)==null||f.focus()}),onPointerDownOutside:_c(e.onPointerDownOutside,u=>{const f=u.detail.originalEvent,i=f.button===0&&f.ctrlKey===!0;(f.button===2||i)&&u.preventDefault()}),onFocusOutside:_c(e.onFocusOutside,u=>u.preventDefault())})}),n0e=j.forwardRef((e,t)=>{const r=th(Ey,e.__scopeDialog),n=j.useRef(!1),a=j.useRef(!1);return b.jsx(aK,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:u=>{var f,i;(f=e.onCloseAutoFocus)==null||f.call(e,u),u.defaultPrevented||(n.current||(i=r.triggerRef.current)==null||i.focus(),u.preventDefault()),n.current=!1,a.current=!1},onInteractOutside:u=>{var y,w;(y=e.onInteractOutside)==null||y.call(e,u),u.defaultPrevented||(n.current=!0,u.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const f=u.target;((w=r.triggerRef.current)==null?void 0:w.contains(f))&&u.preventDefault(),u.detail.originalEvent.type==="focusin"&&a.current&&u.preventDefault()}})}),aK=j.forwardRef((e,t)=>{const{__scopeDialog:r,trapFocus:n,onOpenAutoFocus:a,onCloseAutoFocus:u,...f}=e,i=th(Ey,r),y=j.useRef(null),w=Qu(t,y);return d_e(),b.jsxs(b.Fragment,{children:[b.jsx(VX,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:a,onUnmountAutoFocus:u,children:b.jsx(hj,{role:"dialog",id:i.contentId,"aria-describedby":i.descriptionId,"aria-labelledby":i.titleId,"data-state":jj(i.open),...f,ref:w,onDismiss:()=>i.onOpenChange(!1)})}),b.jsxs(b.Fragment,{children:[b.jsx(o0e,{titleId:i.titleId}),b.jsx(l0e,{contentRef:y,descriptionId:i.descriptionId})]})]})}),Rj="DialogTitle",i0e=j.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,a=th(Rj,r);return b.jsx(Tc.h2,{id:a.titleId,...n,ref:t})});i0e.displayName=Rj;var lK="DialogDescription",s0e=j.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,a=th(lK,r);return b.jsx(Tc.p,{id:a.descriptionId,...n,ref:t})});s0e.displayName=lK;var cK="DialogClose",uK=j.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,a=th(cK,r);return b.jsx(Tc.button,{type:"button",...n,ref:t,onClick:_c(e.onClick,()=>a.onOpenChange(!1))})});uK.displayName=cK;function jj(e){return e?"open":"closed"}var dK="DialogTitleWarning",[QFe,hK]=whe(dK,{contentName:Ey,titleName:Rj,docsSlug:"dialog"}),o0e=({titleId:e})=>{const t=hK(dK),r=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return j.useEffect(()=>{e&&(document.getElementById(e)||console.error(r))},[r,e]),null},a0e="DialogDescriptionWarning",l0e=({contentRef:e,descriptionId:t})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${hK(a0e).contentName}}.`;return j.useEffect(()=>{var u;const a=(u=e.current)==null?void 0:u.getAttribute("aria-describedby");t&&a&&(document.getElementById(t)||console.warn(n))},[n,e,t]),null},c0e=eK,u0e=rK,d0e=iK,h0e=sK,f0e=oK,p0e=uK;const m0e=c0e,g0e=u0e,fK=j.forwardRef(({className:e,children:t,side:r="right",...n},a)=>{const u=r==="left"?"left-0 border-r slide-in-from-left":r==="top"?"top-0 h-[50%] border-b slide-in-from-top":r==="bottom"?"bottom-0 h-[50%] border-t slide-in-from-bottom":"right-0 border-l slide-in-from-right";return b.jsxs(d0e,{children:[b.jsx(h0e,{className:"fixed inset-0 bg-black/30 z-40"}),b.jsxs(f0e,{ref:a,className:Ec(`fixed z-50 w-full max-w-sm bg-white shadow-lg h-full p-6 animate-in ${u}`,e),...n,children:[t,b.jsx(p0e,{className:"absolute top-4 right-4 text-gray-600 hover:text-black",children:b.jsx(Os,{className:"h-5 w-5"})})]})]})});fK.displayName="SheetContent";const y0e=()=>{const e=Mo(),{state:t}=Sc(),{texte:r=""}=t||{},[n,a]=j.useState(r),[u,f]=j.useState(!1),[i,y]=j.useState([]),[w,T]=j.useState({}),[A,k]=j.useState(""),[F,D]=j.useState(""),[O,N]=j.useState(""),[V,H]=j.useState(!1);j.useEffect(()=>{r&&Wn.post("/api/match/blueprint",{texte:r}).then(G=>{var Y;y(((Y=G.data)==null?void 0:Y.champs_specifiques)||[])}).catch(()=>{console.warn("🔍 Aucun modèle Yukpo détecté.")})},[r]);const Z=async()=>{var Y;f(!0);const G=new FormData;G.append("texte",n),G.append("localisation",A),G.append("budget",F),G.append("frequence",O),Object.entries(w).forEach(([ie,ce])=>{G.append(ie,ce)});try{const ie=await Wn.post("/api/analyse-visuelle",G);e("/resultats-besoin",{state:{resultats:((Y=ie.data)==null?void 0:Y.correspondances)||[],type:"affinage"}})}catch{alert("❌ Erreur lors de l’analyse Yukpo.")}finally{f(!1)}},J=(G,Y)=>{T(ie=>({...ie,[G]:Y}))};return b.jsx(Ka,{padding:!0,children:b.jsxs("div",{className:"relative max-w-3xl mx-auto py-10 space-y-6 px-4 sm:px-6 lg:px-8 bg-white rounded shadow",children:[b.jsxs(m0e,{open:V,onOpenChange:H,children:[b.jsx(g0e,{asChild:!0,children:b.jsx("button",{className:"absolute top-4 right-4 text-gray-600 hover:text-primary focus:outline-none",onClick:()=>H(!0),children:b.jsx(Cue,{className:"w-6 h-6"})})}),b.jsxs(fK,{side:"right",className:"w-64 p-4 bg-white border-l border-gray-200",children:[b.jsx("h2",{className:"text-lg font-semibold mb-4 text-primary",children:"⚙️ Options"}),b.jsxs("ul",{className:"space-y-2 text-sm",children:[b.jsx("li",{children:b.jsx(cr,{variant:"ghost",className:"w-full",children:"📋 Mes besoins"})}),b.jsx("li",{children:b.jsx(cr,{variant:"ghost",className:"w-full",children:"🧪 Tester un autre besoin"})})]})]})]}),b.jsx("h1",{className:"text-2xl font-bold text-center text-primary",children:"🛠️ Yukpo affine votre besoin"}),b.jsx("p",{className:"text-sm text-gray-600 text-center",children:"Quelques précisions supplémentaires aideront Yukpo à mieux répondre à votre demande."}),b.jsx(Sy,{value:n,onChange:G=>a(G.target.value),placeholder:"Affinez votre description ici..."}),b.jsx($i,{placeholder:"📍 Ville / Quartier",value:A,onChange:G=>k(G.target.value)}),b.jsx($i,{placeholder:"💰 Budget maximum (FCFA)",type:"number",value:F,onChange:G=>D(G.target.value)}),b.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:O,onChange:G=>N(G.target.value),children:[b.jsx("option",{value:"",children:"📆 Fréquence souhaitée"}),b.jsx("option",{value:"ponctuel",children:"Ponctuel"}),b.jsx("option",{value:"hebdomadaire",children:"Hebdomadaire"}),b.jsx("option",{value:"mensuel",children:"Mensuel"})]}),i.length>0&&b.jsxs("div",{className:"space-y-3",children:[b.jsx("h2",{className:"text-lg font-semibold mt-6",children:"🔎 Détails spécifiques Yukpo"}),i.map((G,Y)=>b.jsx($i,{placeholder:G,value:w[G]||"",onChange:ie=>J(G,ie.target.value)},Y))]}),b.jsx("div",{className:"text-center mt-6",children:b.jsx(cr,{onClick:Z,disabled:u,children:u?"Chargement...":"📤 Relancer l’analyse Yukpo"})})]})})},v0e=()=>{const{user:e}=Rs(),t=Mo(),r=(e==null?void 0:e.plan)||"free";e!=null&&e.username;const{state:n}=Sc(),a=(n==null?void 0:n.suggestion)||{},u=(n==null?void 0:n.type)||"general",[f,i]=j.useState({titre:a.titre||"",description:a.description||"",prix:a.prix||"",categorie:a.categorie||u,localisation:a.localisation||"",nature_service:"service"}),[y,w]=j.useState({}),[T,A]=j.useState([]),[k,F]=j.useState([]),[D,O]=j.useState(null),[N,V]=j.useState(null),[H,Z]=j.useState(!1),[J,G]=j.useState(null),[Y,ie]=j.useState(!1),[ce,ge]=j.useState(""),[be,xe]=j.useState(!1),[Le,ze]=j.useState(!1),[Xe,Je]=j.useState({localisation:"",frequence:"",budget:""}),[tt,st]=j.useState(!1),[Ne,We]=j.useState(null);j.useEffect(()=>{ce.length>10&&Wn.post("/api/match/blueprint",{texte:ce,plan:r}).then(Ye=>{var Ve,Et,kt,Wt;G(Ye.data),((Ve=Ye.data)==null?void 0:Ve.decision)==="affiner"?(ze(!0),Tm("🧪 Yukpo a besoin de quelques précisions…")):(xe(!0),Tm.success("✨ Yukpo a détecté un service compatible.")),(Et=Ye.data)!=null&&Et.services&&Ye.data.services.length>1&&Tm.success("🧠 Plusieurs services détectés. Segmentation activée."),(Wt=(kt=Ye.data)==null?void 0:kt.model)!=null&&Wt.nature_service&&(st(Ye.data.model.nature_service==="tarissable"),i(Tt=>({...Tt,nature_service:Ye.data.model.nature_service})))}).catch(()=>Tm.error("❌ Yukpo n'a pas pu identifier ce service."))},[ce]),j.useEffect(()=>{Wn.get(`/api/service-fields/${u}`).then(Ye=>{A(Ye.data.fields||[]),Ye.data.nature_service&&i(Ve=>({...Ve,nature_service:Ye.data.nature_service}))}).catch(()=>console.warn("Aucun blueprint détecté"))},[u]);const Ue=Ye=>i({...f,[Ye.target.name]:Ye.target.value}),De=Ye=>w({...y,[Ye.target.name]:Ye.target.value}),Ke=async()=>{const Ye=`Image d'illustration simple pour un produit agricole : ${f.titre||f.categorie}`,Ve=await Wn.post("/api/image/generate",{prompt:Ye}),Et=await fetch(Ve.data.url).then(Wt=>Wt.blob()),kt=new File([Et],"auto-image.png",{type:Et.type});We(kt)},lt=async()=>{const Ye=ce.toLowerCase();if(/sexe|porno|violence|criminel/.test(Ye)){Tm.error("🚫 Contenu interdit détecté. Merci de modifier votre description.");return}if(f.nature_service==="tarissable"&&k.length===0&&!Ne){await Ke(),Tm("📷 Une image générée automatiquement a été ajoutée pour un produit tarrissable.");return}try{Z(!0);const Et=(await Wn.post("/api/prestataire/valider-service",{...f,details:y})).data.id,kt=new FormData;(k.length>0?k:[Ne]).forEach(Wt=>Wt&&kt.append("media",Wt)),D&&kt.append("audio",D),N&&kt.append("video",N),await Wn.post(`/api/prestataire/upload/${Et}`,kt),window.dispatchEvent(new CustomEvent("service_created")),Tm.success("🎉 Votre service est en ligne sur Yukpo !"),t("/prestataire/services",{state:{justCreatedId:Et}})}catch{Tm.error("❌ Une erreur est survenue lors de la publication.")}finally{Z(!1)}};return b.jsx(Ka,{padding:!0,children:b.jsxs("div",{className:"w-full max-w-4xl mx-auto",children:[!be&&!Le&&b.jsxs(b.Fragment,{children:[b.jsx(Sy,{value:ce,onChange:Ye=>ge(Ye.target.value),placeholder:"Décrivez brièvement votre service…",className:"mb-4"}),b.jsx($i,{type:"file",accept:"image/*",capture:"environment",multiple:!0,onChange:Ye=>F(Array.from(Ye.target.files||[]))})]}),Le&&b.jsx(y0e,{data:Xe,onDone:()=>{ze(!1),xe(!0)}}),be&&b.jsxs(b.Fragment,{children:[b.jsxs("div",{className:"bg-white rounded-md border p-4 space-y-4 shadow-sm mt-6",children:[b.jsx("h2",{className:"text-lg font-semibold text-primary",children:"🧾 Informations générales"}),b.jsx($i,{name:"titre",value:f.titre,onChange:Ue,placeholder:"Titre du service"}),b.jsx(Sy,{name:"description",value:f.description,onChange:Ue,placeholder:"Description du service"}),b.jsx($i,{name:"prix",value:f.prix,onChange:Ue,placeholder:"Prix (FCFA)",type:"number"}),b.jsx($i,{name:"categorie",value:f.categorie,onChange:Ue,placeholder:"Catégorie"}),b.jsx($i,{name:"localisation",value:f.localisation,onChange:Ue,placeholder:"Ville / Quartier"})]}),T.length>0&&b.jsxs("div",{className:"bg-white rounded-md border p-4 space-y-4 shadow-sm",children:[b.jsx("h2",{className:"text-lg font-semibold text-primary",children:"🧩 Spécificités de votre service"}),T.map((Ye,Ve)=>b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx($i,{name:Ye.name,type:Ye.type,placeholder:Ye.name,onChange:De}),y[Ye.name]&&b.jsx(oy,{className:"text-green-500 w-5 h-5"})]},Ve))]}),b.jsxs("div",{className:"text-center mt-6",children:[b.jsx(cr,{onClick:lt,disabled:H,className:"w-full",children:H?"⏳ Publication en cours...":"📤 Publier mon service Yukpo"}),b.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"🔗 Une fois publié, vous pourrez le partager ou générer votre vitrine pro Yukpo selon votre plan."})]})]})]})})};async function _0e(){const e=["immobilier","livre","transport","autre"],t=Math.floor(Math.random()*e.length);return e[t]}const x0e=()=>b.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"}),b0e=()=>{const e=Mo();return j.useEffect(()=>{(async()=>{const r=await _0e();e(r==="immobilier"?"/create/immobilier":r==="livre"?"/create/livre":r==="transport"?"/create/transport":"/create/autre")})()},[e]),b.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen",children:[b.jsx(x0e,{}),b.jsx("p",{className:"mt-4 text-gray-600",children:"Analyse du type de service en cours…"})]})},di=e=>typeof e=="string",V0=()=>{let e,t;const r=new Promise((n,a)=>{e=n,t=a});return r.resolve=e,r.reject=t,r},O6=e=>e==null?"":""+e,w0e=(e,t,r)=>{e.forEach(n=>{t[n]&&(r[n]=t[n])})},S0e=/###/g,L6=e=>e&&e.indexOf("###")>-1?e.replace(S0e,"."):e,R6=e=>!e||di(e),xx=(e,t,r)=>{const n=di(t)?t.split("."):t;let a=0;for(;a<n.length-1;){if(R6(e))return{};const u=L6(n[a]);!e[u]&&r&&(e[u]=new r),Object.prototype.hasOwnProperty.call(e,u)?e=e[u]:e={},++a}return R6(e)?{}:{obj:e,k:L6(n[a])}},j6=(e,t,r)=>{const{obj:n,k:a}=xx(e,t,Object);if(n!==void 0||t.length===1){n[a]=r;return}let u=t[t.length-1],f=t.slice(0,t.length-1),i=xx(e,f,Object);for(;i.obj===void 0&&f.length;)u=`${f[f.length-1]}.${u}`,f=f.slice(0,f.length-1),i=xx(e,f,Object),i!=null&&i.obj&&typeof i.obj[`${i.k}.${u}`]<"u"&&(i.obj=void 0);i.obj[`${i.k}.${u}`]=r},E0e=(e,t,r,n)=>{const{obj:a,k:u}=xx(e,t,Object);a[u]=a[u]||[],a[u].push(r)},MS=(e,t)=>{const{obj:r,k:n}=xx(e,t);if(r&&Object.prototype.hasOwnProperty.call(r,n))return r[n]},T0e=(e,t,r)=>{const n=MS(e,r);return n!==void 0?n:MS(t,r)},pK=(e,t,r)=>{for(const n in t)n!=="__proto__"&&n!=="constructor"&&(n in e?di(e[n])||e[n]instanceof String||di(t[n])||t[n]instanceof String?r&&(e[n]=t[n]):pK(e[n],t[n],r):e[n]=t[n]);return e},mv=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var C0e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const A0e=e=>di(e)?e.replace(/[&<>"'\/]/g,t=>C0e[t]):e;class P0e{constructor(t){this.capacity=t,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(t){const r=this.regExpMap.get(t);if(r!==void 0)return r;const n=new RegExp(t);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(t,n),this.regExpQueue.push(t),n}}const M0e=[" ",",","?","!",";"],I0e=new P0e(20),k0e=(e,t,r)=>{t=t||"",r=r||"";const n=M0e.filter(f=>t.indexOf(f)<0&&r.indexOf(f)<0);if(n.length===0)return!0;const a=I0e.getRegExp(`(${n.map(f=>f==="?"?"\\?":f).join("|")})`);let u=!a.test(e);if(!u){const f=e.indexOf(r);f>0&&!a.test(e.substring(0,f))&&(u=!0)}return u},VO=function(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:".";if(!e)return;if(e[t])return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0;const n=t.split(r);let a=e;for(let u=0;u<n.length;){if(!a||typeof a!="object")return;let f,i="";for(let y=u;y<n.length;++y)if(y!==u&&(i+=r),i+=n[y],f=a[i],f!==void 0){if(["string","number","boolean"].indexOf(typeof f)>-1&&y<n.length-1)continue;u+=y-u+1;break}a=f}return a},IS=e=>e==null?void 0:e.replace("_","-"),O0e={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){var r,n;(n=(r=console==null?void 0:console[e])==null?void 0:r.apply)==null||n.call(r,console,t)}};class kS{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.init(t,r)}init(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.prefix=r.prefix||"i18next:",this.logger=t||O0e,this.options=r,this.debug=r.debug}log(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return this.forward(r,"log","",!0)}warn(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return this.forward(r,"warn","",!0)}error(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return this.forward(r,"error","")}deprecate(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return this.forward(r,"warn","WARNING DEPRECATED: ",!0)}forward(t,r,n,a){return a&&!this.debug?null:(di(t[0])&&(t[0]=`${n}${this.prefix} ${t[0]}`),this.logger[r](t))}create(t){return new kS(this.logger,{prefix:`${this.prefix}:${t}:`,...this.options})}clone(t){return t=t||this.options,t.prefix=t.prefix||this.prefix,new kS(this.logger,t)}}var rf=new kS;let a2=class{constructor(){this.observers={}}on(t,r){return t.split(" ").forEach(n=>{this.observers[n]||(this.observers[n]=new Map);const a=this.observers[n].get(r)||0;this.observers[n].set(r,a+1)}),this}off(t,r){if(this.observers[t]){if(!r){delete this.observers[t];return}this.observers[t].delete(r)}}emit(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];this.observers[t]&&Array.from(this.observers[t].entries()).forEach(f=>{let[i,y]=f;for(let w=0;w<y;w++)i(...n)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(f=>{let[i,y]=f;for(let w=0;w<y;w++)i.apply(i,[t,...n])})}};class D6 extends a2{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=t||{},this.options=r,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(t){this.options.ns.indexOf(t)<0&&this.options.ns.push(t)}removeNamespaces(t){const r=this.options.ns.indexOf(t);r>-1&&this.options.ns.splice(r,1)}getResource(t,r,n){var w,T;let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const u=a.keySeparator!==void 0?a.keySeparator:this.options.keySeparator,f=a.ignoreJSONStructure!==void 0?a.ignoreJSONStructure:this.options.ignoreJSONStructure;let i;t.indexOf(".")>-1?i=t.split("."):(i=[t,r],n&&(Array.isArray(n)?i.push(...n):di(n)&&u?i.push(...n.split(u)):i.push(n)));const y=MS(this.data,i);return!y&&!r&&!n&&t.indexOf(".")>-1&&(t=i[0],r=i[1],n=i.slice(2).join(".")),y||!f||!di(n)?y:VO((T=(w=this.data)==null?void 0:w[t])==null?void 0:T[r],n,u)}addResource(t,r,n,a){let u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{silent:!1};const f=u.keySeparator!==void 0?u.keySeparator:this.options.keySeparator;let i=[t,r];n&&(i=i.concat(f?n.split(f):n)),t.indexOf(".")>-1&&(i=t.split("."),a=r,r=i[1]),this.addNamespaces(r),j6(this.data,i,a),u.silent||this.emit("added",t,r,n,a)}addResources(t,r,n){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{silent:!1};for(const u in n)(di(n[u])||Array.isArray(n[u]))&&this.addResource(t,r,u,n[u],{silent:!0});a.silent||this.emit("added",t,r,n)}addResourceBundle(t,r,n,a,u){let f=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{silent:!1,skipCopy:!1},i=[t,r];t.indexOf(".")>-1&&(i=t.split("."),a=n,n=r,r=i[1]),this.addNamespaces(r);let y=MS(this.data,i)||{};f.skipCopy||(n=JSON.parse(JSON.stringify(n))),a?pK(y,n,u):y={...y,...n},j6(this.data,i,y),f.silent||this.emit("added",t,r,n)}removeResourceBundle(t,r){this.hasResourceBundle(t,r)&&delete this.data[t][r],this.removeNamespaces(r),this.emit("removed",t,r)}hasResourceBundle(t,r){return this.getResource(t,r)!==void 0}getResourceBundle(t,r){return r||(r=this.options.defaultNS),this.getResource(t,r)}getDataByLanguage(t){return this.data[t]}hasLanguageSomeTranslations(t){const r=this.getDataByLanguage(t);return!!(r&&Object.keys(r)||[]).find(a=>r[a]&&Object.keys(r[a]).length>0)}toJSON(){return this.data}}var mK={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,r,n,a){return e.forEach(u=>{var f;t=((f=this.processors[u])==null?void 0:f.process(t,r,n,a))??t}),t}};const N6={},z6=e=>!di(e)&&typeof e!="boolean"&&typeof e!="number";class OS extends a2{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),w0e(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],t,this),this.options=r,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=rf.create("translator")}changeLanguage(t){t&&(this.language=t)}exists(t){const n={...arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}}};if(t==null)return!1;const a=this.resolve(t,n);return(a==null?void 0:a.res)!==void 0}extractFromKey(t,r){let n=r.nsSeparator!==void 0?r.nsSeparator:this.options.nsSeparator;n===void 0&&(n=":");const a=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator;let u=r.ns||this.options.defaultNS||[];const f=n&&t.indexOf(n)>-1,i=!this.options.userDefinedKeySeparator&&!r.keySeparator&&!this.options.userDefinedNsSeparator&&!r.nsSeparator&&!k0e(t,n,a);if(f&&!i){const y=t.match(this.interpolator.nestingRegexp);if(y&&y.length>0)return{key:t,namespaces:di(u)?[u]:u};const w=t.split(n);(n!==a||n===a&&this.options.ns.indexOf(w[0])>-1)&&(u=w.shift()),t=w.join(a)}return{key:t,namespaces:di(u)?[u]:u}}translate(t,r,n){let a=typeof r=="object"?{...r}:r;if(typeof a!="object"&&this.options.overloadTranslationOptionHandler&&(a=this.options.overloadTranslationOptionHandler(arguments)),typeof options=="object"&&(a={...a}),a||(a={}),t==null)return"";Array.isArray(t)||(t=[String(t)]);const u=a.returnDetails!==void 0?a.returnDetails:this.options.returnDetails,f=a.keySeparator!==void 0?a.keySeparator:this.options.keySeparator,{key:i,namespaces:y}=this.extractFromKey(t[t.length-1],a),w=y[y.length-1],T=a.lng||this.language,A=a.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if((T==null?void 0:T.toLowerCase())==="cimode"){if(A){const Le=a.nsSeparator||this.options.nsSeparator;return u?{res:`${w}${Le}${i}`,usedKey:i,exactUsedKey:i,usedLng:T,usedNS:w,usedParams:this.getUsedParamsDetails(a)}:`${w}${Le}${i}`}return u?{res:i,usedKey:i,exactUsedKey:i,usedLng:T,usedNS:w,usedParams:this.getUsedParamsDetails(a)}:i}const k=this.resolve(t,a);let F=k==null?void 0:k.res;const D=(k==null?void 0:k.usedKey)||i,O=(k==null?void 0:k.exactUsedKey)||i,N=["[object Number]","[object Function]","[object RegExp]"],V=a.joinArrays!==void 0?a.joinArrays:this.options.joinArrays,H=!this.i18nFormat||this.i18nFormat.handleAsObject,Z=a.count!==void 0&&!di(a.count),J=OS.hasDefaultValue(a),G=Z?this.pluralResolver.getSuffix(T,a.count,a):"",Y=a.ordinal&&Z?this.pluralResolver.getSuffix(T,a.count,{ordinal:!1}):"",ie=Z&&!a.ordinal&&a.count===0,ce=ie&&a[`defaultValue${this.options.pluralSeparator}zero`]||a[`defaultValue${G}`]||a[`defaultValue${Y}`]||a.defaultValue;let ge=F;H&&!F&&J&&(ge=ce);const be=z6(ge),xe=Object.prototype.toString.apply(ge);if(H&&ge&&be&&N.indexOf(xe)<0&&!(di(V)&&Array.isArray(ge))){if(!a.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const Le=this.options.returnedObjectHandler?this.options.returnedObjectHandler(D,ge,{...a,ns:y}):`key '${i} (${this.language})' returned an object instead of string.`;return u?(k.res=Le,k.usedParams=this.getUsedParamsDetails(a),k):Le}if(f){const Le=Array.isArray(ge),ze=Le?[]:{},Xe=Le?O:D;for(const Je in ge)if(Object.prototype.hasOwnProperty.call(ge,Je)){const tt=`${Xe}${f}${Je}`;J&&!F?ze[Je]=this.translate(tt,{...a,defaultValue:z6(ce)?ce[Je]:void 0,joinArrays:!1,ns:y}):ze[Je]=this.translate(tt,{...a,joinArrays:!1,ns:y}),ze[Je]===tt&&(ze[Je]=ge[Je])}F=ze}}else if(H&&di(V)&&Array.isArray(F))F=F.join(V),F&&(F=this.extendTranslation(F,t,a,n));else{let Le=!1,ze=!1;!this.isValidLookup(F)&&J&&(Le=!0,F=ce),this.isValidLookup(F)||(ze=!0,F=i);const Je=(a.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&ze?void 0:F,tt=J&&ce!==F&&this.options.updateMissing;if(ze||Le||tt){if(this.logger.log(tt?"updateKey":"missingKey",T,w,i,tt?ce:F),f){const Ue=this.resolve(i,{...a,keySeparator:!1});Ue&&Ue.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let st=[];const Ne=this.languageUtils.getFallbackCodes(this.options.fallbackLng,a.lng||this.language);if(this.options.saveMissingTo==="fallback"&&Ne&&Ne[0])for(let Ue=0;Ue<Ne.length;Ue++)st.push(Ne[Ue]);else this.options.saveMissingTo==="all"?st=this.languageUtils.toResolveHierarchy(a.lng||this.language):st.push(a.lng||this.language);const We=(Ue,De,Ke)=>{var Ye;const lt=J&&Ke!==F?Ke:Je;this.options.missingKeyHandler?this.options.missingKeyHandler(Ue,w,De,lt,tt,a):(Ye=this.backendConnector)!=null&&Ye.saveMissing&&this.backendConnector.saveMissing(Ue,w,De,lt,tt,a),this.emit("missingKey",Ue,w,De,F)};this.options.saveMissing&&(this.options.saveMissingPlurals&&Z?st.forEach(Ue=>{const De=this.pluralResolver.getSuffixes(Ue,a);ie&&a[`defaultValue${this.options.pluralSeparator}zero`]&&De.indexOf(`${this.options.pluralSeparator}zero`)<0&&De.push(`${this.options.pluralSeparator}zero`),De.forEach(Ke=>{We([Ue],i+Ke,a[`defaultValue${Ke}`]||ce)})}):We(st,i,ce))}F=this.extendTranslation(F,t,a,k,n),ze&&F===i&&this.options.appendNamespaceToMissingKey&&(F=`${w}:${i}`),(ze||Le)&&this.options.parseMissingKeyHandler&&(F=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${w}:${i}`:i,Le?F:void 0,a))}return u?(k.res=F,k.usedParams=this.getUsedParamsDetails(a),k):F}extendTranslation(t,r,n,a,u){var w,T;var f=this;if((w=this.i18nFormat)!=null&&w.parse)t=this.i18nFormat.parse(t,{...this.options.interpolation.defaultVariables,...n},n.lng||this.language||a.usedLng,a.usedNS,a.usedKey,{resolved:a});else if(!n.skipInterpolation){n.interpolation&&this.interpolator.init({...n,interpolation:{...this.options.interpolation,...n.interpolation}});const A=di(t)&&(((T=n==null?void 0:n.interpolation)==null?void 0:T.skipOnVariables)!==void 0?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let k;if(A){const D=t.match(this.interpolator.nestingRegexp);k=D&&D.length}let F=n.replace&&!di(n.replace)?n.replace:n;if(this.options.interpolation.defaultVariables&&(F={...this.options.interpolation.defaultVariables,...F}),t=this.interpolator.interpolate(t,F,n.lng||this.language||a.usedLng,n),A){const D=t.match(this.interpolator.nestingRegexp),O=D&&D.length;k<O&&(n.nest=!1)}!n.lng&&a&&a.res&&(n.lng=this.language||a.usedLng),n.nest!==!1&&(t=this.interpolator.nest(t,function(){for(var D=arguments.length,O=new Array(D),N=0;N<D;N++)O[N]=arguments[N];return(u==null?void 0:u[0])===O[0]&&!n.context?(f.logger.warn(`It seems you are nesting recursively key: ${O[0]} in key: ${r[0]}`),null):f.translate(...O,r)},n)),n.interpolation&&this.interpolator.reset()}const i=n.postProcess||this.options.postProcess,y=di(i)?[i]:i;return t!=null&&(y!=null&&y.length)&&n.applyPostProcessor!==!1&&(t=mK.handle(y,t,r,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...a,usedParams:this.getUsedParamsDetails(n)},...n}:n,this)),t}resolve(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n,a,u,f,i;return di(t)&&(t=[t]),t.forEach(y=>{if(this.isValidLookup(n))return;const w=this.extractFromKey(y,r),T=w.key;a=T;let A=w.namespaces;this.options.fallbackNS&&(A=A.concat(this.options.fallbackNS));const k=r.count!==void 0&&!di(r.count),F=k&&!r.ordinal&&r.count===0,D=r.context!==void 0&&(di(r.context)||typeof r.context=="number")&&r.context!=="",O=r.lngs?r.lngs:this.languageUtils.toResolveHierarchy(r.lng||this.language,r.fallbackLng);A.forEach(N=>{var V,H;this.isValidLookup(n)||(i=N,!N6[`${O[0]}-${N}`]&&((V=this.utils)!=null&&V.hasLoadedNamespace)&&!((H=this.utils)!=null&&H.hasLoadedNamespace(i))&&(N6[`${O[0]}-${N}`]=!0,this.logger.warn(`key "${a}" for languages "${O.join(", ")}" won't get resolved as namespace "${i}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),O.forEach(Z=>{var Y;if(this.isValidLookup(n))return;f=Z;const J=[T];if((Y=this.i18nFormat)!=null&&Y.addLookupKeys)this.i18nFormat.addLookupKeys(J,T,Z,N,r);else{let ie;k&&(ie=this.pluralResolver.getSuffix(Z,r.count,r));const ce=`${this.options.pluralSeparator}zero`,ge=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(k&&(J.push(T+ie),r.ordinal&&ie.indexOf(ge)===0&&J.push(T+ie.replace(ge,this.options.pluralSeparator)),F&&J.push(T+ce)),D){const be=`${T}${this.options.contextSeparator}${r.context}`;J.push(be),k&&(J.push(be+ie),r.ordinal&&ie.indexOf(ge)===0&&J.push(be+ie.replace(ge,this.options.pluralSeparator)),F&&J.push(be+ce))}}let G;for(;G=J.pop();)this.isValidLookup(n)||(u=G,n=this.getResource(Z,N,G,r))}))})}),{res:n,usedKey:a,exactUsedKey:u,usedLng:f,usedNS:i}}isValidLookup(t){return t!==void 0&&!(!this.options.returnNull&&t===null)&&!(!this.options.returnEmptyString&&t==="")}getResource(t,r,n){var u;let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return(u=this.i18nFormat)!=null&&u.getResource?this.i18nFormat.getResource(t,r,n,a):this.resourceStore.getResource(t,r,n,a)}getUsedParamsDetails(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],n=t.replace&&!di(t.replace);let a=n?t.replace:t;if(n&&typeof t.count<"u"&&(a.count=t.count),this.options.interpolation.defaultVariables&&(a={...this.options.interpolation.defaultVariables,...a}),!n){a={...a};for(const u of r)delete a[u]}return a}static hasDefaultValue(t){const r="defaultValue";for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&r===n.substring(0,r.length)&&t[n]!==void 0)return!0;return!1}}class F6{constructor(t){this.options=t,this.supportedLngs=this.options.supportedLngs||!1,this.logger=rf.create("languageUtils")}getScriptPartFromCode(t){if(t=IS(t),!t||t.indexOf("-")<0)return null;const r=t.split("-");return r.length===2||(r.pop(),r[r.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(r.join("-"))}getLanguagePartFromCode(t){if(t=IS(t),!t||t.indexOf("-")<0)return t;const r=t.split("-");return this.formatLanguageCode(r[0])}formatLanguageCode(t){if(di(t)&&t.indexOf("-")>-1){let r;try{r=Intl.getCanonicalLocales(t)[0]}catch{}return r&&this.options.lowerCaseLng&&(r=r.toLowerCase()),r||(this.options.lowerCaseLng?t.toLowerCase():t)}return this.options.cleanCode||this.options.lowerCaseLng?t.toLowerCase():t}isSupportedCode(t){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(t=this.getLanguagePartFromCode(t)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(t)>-1}getBestMatchFromCodes(t){if(!t)return null;let r;return t.forEach(n=>{if(r)return;const a=this.formatLanguageCode(n);(!this.options.supportedLngs||this.isSupportedCode(a))&&(r=a)}),!r&&this.options.supportedLngs&&t.forEach(n=>{if(r)return;const a=this.getScriptPartFromCode(n);if(this.isSupportedCode(a))return r=a;const u=this.getLanguagePartFromCode(n);if(this.isSupportedCode(u))return r=u;r=this.options.supportedLngs.find(f=>{if(f===u)return f;if(!(f.indexOf("-")<0&&u.indexOf("-")<0)&&(f.indexOf("-")>0&&u.indexOf("-")<0&&f.substring(0,f.indexOf("-"))===u||f.indexOf(u)===0&&u.length>1))return f})}),r||(r=this.getFallbackCodes(this.options.fallbackLng)[0]),r}getFallbackCodes(t,r){if(!t)return[];if(typeof t=="function"&&(t=t(r)),di(t)&&(t=[t]),Array.isArray(t))return t;if(!r)return t.default||[];let n=t[r];return n||(n=t[this.getScriptPartFromCode(r)]),n||(n=t[this.formatLanguageCode(r)]),n||(n=t[this.getLanguagePartFromCode(r)]),n||(n=t.default),n||[]}toResolveHierarchy(t,r){const n=this.getFallbackCodes(r||this.options.fallbackLng||[],t),a=[],u=f=>{f&&(this.isSupportedCode(f)?a.push(f):this.logger.warn(`rejecting language code not found in supportedLngs: ${f}`))};return di(t)&&(t.indexOf("-")>-1||t.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&u(this.formatLanguageCode(t)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&u(this.getScriptPartFromCode(t)),this.options.load!=="currentOnly"&&u(this.getLanguagePartFromCode(t))):di(t)&&u(this.formatLanguageCode(t)),n.forEach(f=>{a.indexOf(f)<0&&u(this.formatLanguageCode(f))}),a}}const B6={zero:0,one:1,two:2,few:3,many:4,other:5},$6={select:e=>e===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class L0e{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.languageUtils=t,this.options=r,this.logger=rf.create("pluralResolver"),this.pluralRulesCache={}}addRule(t,r){this.rules[t]=r}clearCache(){this.pluralRulesCache={}}getRule(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=IS(t==="dev"?"en":t),a=r.ordinal?"ordinal":"cardinal",u=JSON.stringify({cleanedCode:n,type:a});if(u in this.pluralRulesCache)return this.pluralRulesCache[u];let f;try{f=new Intl.PluralRules(n,{type:a})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),$6;if(!t.match(/-|_/))return $6;const y=this.languageUtils.getLanguagePartFromCode(t);f=this.getRule(y,r)}return this.pluralRulesCache[u]=f,f}needsPlural(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=this.getRule(t,r);return n||(n=this.getRule("dev",r)),(n==null?void 0:n.resolvedOptions().pluralCategories.length)>1}getPluralFormsOfKey(t,r){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.getSuffixes(t,n).map(a=>`${r}${a}`)}getSuffixes(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=this.getRule(t,r);return n||(n=this.getRule("dev",r)),n?n.resolvedOptions().pluralCategories.sort((a,u)=>B6[a]-B6[u]).map(a=>`${this.options.prepend}${r.ordinal?`ordinal${this.options.prepend}`:""}${a}`):[]}getSuffix(t,r){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const a=this.getRule(t,n);return a?`${this.options.prepend}${n.ordinal?`ordinal${this.options.prepend}`:""}${a.select(r)}`:(this.logger.warn(`no plural rule found for: ${t}`),this.getSuffix("dev",r,n))}}const V6=function(e,t,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:".",a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,u=T0e(e,t,r);return!u&&a&&di(r)&&(u=VO(e,r,n),u===void 0&&(u=VO(t,r,n))),u},WC=e=>e.replace(/\$/g,"$$$$");class R0e{constructor(){var r;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=rf.create("interpolator"),this.options=t,this.format=((r=t==null?void 0:t.interpolation)==null?void 0:r.format)||(n=>n),this.init(t)}init(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};t.interpolation||(t.interpolation={escapeValue:!0});const{escape:r,escapeValue:n,useRawValueToEscape:a,prefix:u,prefixEscaped:f,suffix:i,suffixEscaped:y,formatSeparator:w,unescapeSuffix:T,unescapePrefix:A,nestingPrefix:k,nestingPrefixEscaped:F,nestingSuffix:D,nestingSuffixEscaped:O,nestingOptionsSeparator:N,maxReplaces:V,alwaysFormat:H}=t.interpolation;this.escape=r!==void 0?r:A0e,this.escapeValue=n!==void 0?n:!0,this.useRawValueToEscape=a!==void 0?a:!1,this.prefix=u?mv(u):f||"{{",this.suffix=i?mv(i):y||"}}",this.formatSeparator=w||",",this.unescapePrefix=T?"":A||"-",this.unescapeSuffix=this.unescapePrefix?"":T||"",this.nestingPrefix=k?mv(k):F||mv("$t("),this.nestingSuffix=D?mv(D):O||mv(")"),this.nestingOptionsSeparator=N||",",this.maxReplaces=V||1e3,this.alwaysFormat=H!==void 0?H:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const t=(r,n)=>(r==null?void 0:r.source)===n?(r.lastIndex=0,r):new RegExp(n,"g");this.regexp=t(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=t(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=t(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(t,r,n,a){var F;let u,f,i;const y=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},w=D=>{if(D.indexOf(this.formatSeparator)<0){const H=V6(r,y,D,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(H,void 0,n,{...a,...r,interpolationkey:D}):H}const O=D.split(this.formatSeparator),N=O.shift().trim(),V=O.join(this.formatSeparator).trim();return this.format(V6(r,y,N,this.options.keySeparator,this.options.ignoreJSONStructure),V,n,{...a,...r,interpolationkey:N})};this.resetRegExp();const T=(a==null?void 0:a.missingInterpolationHandler)||this.options.missingInterpolationHandler,A=((F=a==null?void 0:a.interpolation)==null?void 0:F.skipOnVariables)!==void 0?a.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:D=>WC(D)},{regex:this.regexp,safeValue:D=>this.escapeValue?WC(this.escape(D)):WC(D)}].forEach(D=>{for(i=0;u=D.regex.exec(t);){const O=u[1].trim();if(f=w(O),f===void 0)if(typeof T=="function"){const V=T(t,u,a);f=di(V)?V:""}else if(a&&Object.prototype.hasOwnProperty.call(a,O))f="";else if(A){f=u[0];continue}else this.logger.warn(`missed to pass in variable ${O} for interpolating ${t}`),f="";else!di(f)&&!this.useRawValueToEscape&&(f=O6(f));const N=D.safeValue(f);if(t=t.replace(u[0],N),A?(D.regex.lastIndex+=f.length,D.regex.lastIndex-=u[0].length):D.regex.lastIndex=0,i++,i>=this.maxReplaces)break}}),t}nest(t,r){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a,u,f;const i=(y,w)=>{const T=this.nestingOptionsSeparator;if(y.indexOf(T)<0)return y;const A=y.split(new RegExp(`${T}[ ]*{`));let k=`{${A[1]}`;y=A[0],k=this.interpolate(k,f);const F=k.match(/'/g),D=k.match(/"/g);(((F==null?void 0:F.length)??0)%2===0&&!D||D.length%2!==0)&&(k=k.replace(/'/g,'"'));try{f=JSON.parse(k),w&&(f={...w,...f})}catch(O){return this.logger.warn(`failed parsing options string in nesting for key ${y}`,O),`${y}${T}${k}`}return f.defaultValue&&f.defaultValue.indexOf(this.prefix)>-1&&delete f.defaultValue,y};for(;a=this.nestingRegexp.exec(t);){let y=[];f={...n},f=f.replace&&!di(f.replace)?f.replace:f,f.applyPostProcessor=!1,delete f.defaultValue;let w=!1;if(a[0].indexOf(this.formatSeparator)!==-1&&!/{.*}/.test(a[1])){const T=a[1].split(this.formatSeparator).map(A=>A.trim());a[1]=T.shift(),y=T,w=!0}if(u=r(i.call(this,a[1].trim(),f),f),u&&a[0]===t&&!di(u))return u;di(u)||(u=O6(u)),u||(this.logger.warn(`missed to resolve ${a[1]} for nesting ${t}`),u=""),w&&(u=y.reduce((T,A)=>this.format(T,A,n.lng,{...n,interpolationkey:a[1].trim()}),u.trim())),t=t.replace(a[0],u),this.regexp.lastIndex=0}return t}}const j0e=e=>{let t=e.toLowerCase().trim();const r={};if(e.indexOf("(")>-1){const n=e.split("(");t=n[0].toLowerCase().trim();const a=n[1].substring(0,n[1].length-1);t==="currency"&&a.indexOf(":")<0?r.currency||(r.currency=a.trim()):t==="relativetime"&&a.indexOf(":")<0?r.range||(r.range=a.trim()):a.split(";").forEach(f=>{if(f){const[i,...y]=f.split(":"),w=y.join(":").trim().replace(/^'+|'+$/g,""),T=i.trim();r[T]||(r[T]=w),w==="false"&&(r[T]=!1),w==="true"&&(r[T]=!0),isNaN(w)||(r[T]=parseInt(w,10))}})}return{formatName:t,formatOptions:r}},gv=e=>{const t={};return(r,n,a)=>{let u=a;a&&a.interpolationkey&&a.formatParams&&a.formatParams[a.interpolationkey]&&a[a.interpolationkey]&&(u={...u,[a.interpolationkey]:void 0});const f=n+JSON.stringify(u);let i=t[f];return i||(i=e(IS(n),a),t[f]=i),i(r)}};class D0e{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=rf.create("formatter"),this.options=t,this.formats={number:gv((r,n)=>{const a=new Intl.NumberFormat(r,{...n});return u=>a.format(u)}),currency:gv((r,n)=>{const a=new Intl.NumberFormat(r,{...n,style:"currency"});return u=>a.format(u)}),datetime:gv((r,n)=>{const a=new Intl.DateTimeFormat(r,{...n});return u=>a.format(u)}),relativetime:gv((r,n)=>{const a=new Intl.RelativeTimeFormat(r,{...n});return u=>a.format(u,n.range||"day")}),list:gv((r,n)=>{const a=new Intl.ListFormat(r,{...n});return u=>a.format(u)})},this.init(t)}init(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};this.formatSeparator=r.interpolation.formatSeparator||","}add(t,r){this.formats[t.toLowerCase().trim()]=r}addCached(t,r){this.formats[t.toLowerCase().trim()]=gv(r)}format(t,r,n){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const u=r.split(this.formatSeparator);if(u.length>1&&u[0].indexOf("(")>1&&u[0].indexOf(")")<0&&u.find(i=>i.indexOf(")")>-1)){const i=u.findIndex(y=>y.indexOf(")")>-1);u[0]=[u[0],...u.splice(1,i)].join(this.formatSeparator)}return u.reduce((i,y)=>{var A;const{formatName:w,formatOptions:T}=j0e(y);if(this.formats[w]){let k=i;try{const F=((A=a==null?void 0:a.formatParams)==null?void 0:A[a.interpolationkey])||{},D=F.locale||F.lng||a.locale||a.lng||n;k=this.formats[w](i,D,{...T,...a,...F})}catch(F){this.logger.warn(F)}return k}else this.logger.warn(`there was no format function for ${w}`);return i},t)}}const N0e=(e,t)=>{e.pending[t]!==void 0&&(delete e.pending[t],e.pendingCount--)};class z0e extends a2{constructor(t,r,n){var u,f;let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};super(),this.backend=t,this.store=r,this.services=n,this.languageUtils=n.languageUtils,this.options=a,this.logger=rf.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=a.maxParallelReads||10,this.readingCalls=0,this.maxRetries=a.maxRetries>=0?a.maxRetries:5,this.retryTimeout=a.retryTimeout>=1?a.retryTimeout:350,this.state={},this.queue=[],(f=(u=this.backend)==null?void 0:u.init)==null||f.call(u,n,a.backend,a)}queueLoad(t,r,n,a){const u={},f={},i={},y={};return t.forEach(w=>{let T=!0;r.forEach(A=>{const k=`${w}|${A}`;!n.reload&&this.store.hasResourceBundle(w,A)?this.state[k]=2:this.state[k]<0||(this.state[k]===1?f[k]===void 0&&(f[k]=!0):(this.state[k]=1,T=!1,f[k]===void 0&&(f[k]=!0),u[k]===void 0&&(u[k]=!0),y[A]===void 0&&(y[A]=!0)))}),T||(i[w]=!0)}),(Object.keys(u).length||Object.keys(f).length)&&this.queue.push({pending:f,pendingCount:Object.keys(f).length,loaded:{},errors:[],callback:a}),{toLoad:Object.keys(u),pending:Object.keys(f),toLoadLanguages:Object.keys(i),toLoadNamespaces:Object.keys(y)}}loaded(t,r,n){const a=t.split("|"),u=a[0],f=a[1];r&&this.emit("failedLoading",u,f,r),!r&&n&&this.store.addResourceBundle(u,f,n,void 0,void 0,{skipCopy:!0}),this.state[t]=r?-1:2,r&&n&&(this.state[t]=0);const i={};this.queue.forEach(y=>{E0e(y.loaded,[u],f),N0e(y,t),r&&y.errors.push(r),y.pendingCount===0&&!y.done&&(Object.keys(y.loaded).forEach(w=>{i[w]||(i[w]={});const T=y.loaded[w];T.length&&T.forEach(A=>{i[w][A]===void 0&&(i[w][A]=!0)})}),y.done=!0,y.errors.length?y.callback(y.errors):y.callback())}),this.emit("loaded",i),this.queue=this.queue.filter(y=>!y.done)}read(t,r,n){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.retryTimeout,f=arguments.length>5?arguments[5]:void 0;if(!t.length)return f(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:t,ns:r,fcName:n,tried:a,wait:u,callback:f});return}this.readingCalls++;const i=(w,T)=>{if(this.readingCalls--,this.waitingReads.length>0){const A=this.waitingReads.shift();this.read(A.lng,A.ns,A.fcName,A.tried,A.wait,A.callback)}if(w&&T&&a<this.maxRetries){setTimeout(()=>{this.read.call(this,t,r,n,a+1,u*2,f)},u);return}f(w,T)},y=this.backend[n].bind(this.backend);if(y.length===2){try{const w=y(t,r);w&&typeof w.then=="function"?w.then(T=>i(null,T)).catch(i):i(null,w)}catch(w){i(w)}return}return y(t,r,i)}prepareLoading(t,r){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),a&&a();di(t)&&(t=this.languageUtils.toResolveHierarchy(t)),di(r)&&(r=[r]);const u=this.queueLoad(t,r,n,a);if(!u.toLoad.length)return u.pending.length||a(),null;u.toLoad.forEach(f=>{this.loadOne(f)})}load(t,r,n){this.prepareLoading(t,r,{},n)}reload(t,r,n){this.prepareLoading(t,r,{reload:!0},n)}loadOne(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const n=t.split("|"),a=n[0],u=n[1];this.read(a,u,"read",void 0,void 0,(f,i)=>{f&&this.logger.warn(`${r}loading namespace ${u} for language ${a} failed`,f),!f&&i&&this.logger.log(`${r}loaded namespace ${u} for language ${a}`,i),this.loaded(t,f,i)})}saveMissing(t,r,n,a,u){var y,w,T,A,k;let f=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},i=arguments.length>6&&arguments[6]!==void 0?arguments[6]:()=>{};if((w=(y=this.services)==null?void 0:y.utils)!=null&&w.hasLoadedNamespace&&!((A=(T=this.services)==null?void 0:T.utils)!=null&&A.hasLoadedNamespace(r))){this.logger.warn(`did not save key "${n}" as the namespace "${r}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(n==null||n==="")){if((k=this.backend)!=null&&k.create){const F={...f,isUpdate:u},D=this.backend.create.bind(this.backend);if(D.length<6)try{let O;D.length===5?O=D(t,r,n,a,F):O=D(t,r,n,a),O&&typeof O.then=="function"?O.then(N=>i(null,N)).catch(i):i(null,O)}catch(O){i(O)}else D(t,r,n,a,i,F)}!t||!t[0]||this.store.addResource(t[0],r,n,a)}}}const U6=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if(typeof e[1]=="object"&&(t=e[1]),di(e[1])&&(t.defaultValue=e[1]),di(e[2])&&(t.tDescription=e[2]),typeof e[2]=="object"||typeof e[3]=="object"){const r=e[3]||e[2];Object.keys(r).forEach(n=>{t[n]=r[n]})}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),q6=e=>{var t,r;return di(e.ns)&&(e.ns=[e.ns]),di(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),di(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),((r=(t=e.supportedLngs)==null?void 0:t.indexOf)==null?void 0:r.call(t,"cimode"))<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),typeof e.initImmediate=="boolean"&&(e.initAsync=e.initImmediate),e},fw=()=>{},F0e=e=>{Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach(r=>{typeof e[r]=="function"&&(e[r]=e[r].bind(e))})};class qx extends a2{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;if(super(),this.options=q6(t),this.services={},this.logger=rf,this.modules={external:[]},F0e(this),r&&!this.isInitialized&&!t.isClone){if(!this.options.initAsync)return this.init(t,r),this;setTimeout(()=>{this.init(t,r)},0)}}init(){var t=this;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,typeof r=="function"&&(n=r,r={}),r.defaultNS==null&&r.ns&&(di(r.ns)?r.defaultNS=r.ns:r.ns.indexOf("translation")<0&&(r.defaultNS=r.ns[0]));const a=U6();this.options={...a,...this.options,...q6(r)},this.options.interpolation={...a.interpolation,...this.options.interpolation},r.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=r.keySeparator),r.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=r.nsSeparator);const u=T=>T?typeof T=="function"?new T:T:null;if(!this.options.isClone){this.modules.logger?rf.init(u(this.modules.logger),this.options):rf.init(null,this.options);let T;this.modules.formatter?T=this.modules.formatter:T=D0e;const A=new F6(this.options);this.store=new D6(this.options.resources,this.options);const k=this.services;k.logger=rf,k.resourceStore=this.store,k.languageUtils=A,k.pluralResolver=new L0e(A,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),T&&(!this.options.interpolation.format||this.options.interpolation.format===a.interpolation.format)&&(k.formatter=u(T),k.formatter.init(k,this.options),this.options.interpolation.format=k.formatter.format.bind(k.formatter)),k.interpolator=new R0e(this.options),k.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},k.backendConnector=new z0e(u(this.modules.backend),k.resourceStore,k,this.options),k.backendConnector.on("*",function(F){for(var D=arguments.length,O=new Array(D>1?D-1:0),N=1;N<D;N++)O[N-1]=arguments[N];t.emit(F,...O)}),this.modules.languageDetector&&(k.languageDetector=u(this.modules.languageDetector),k.languageDetector.init&&k.languageDetector.init(k,this.options.detection,this.options)),this.modules.i18nFormat&&(k.i18nFormat=u(this.modules.i18nFormat),k.i18nFormat.init&&k.i18nFormat.init(this)),this.translator=new OS(this.services,this.options),this.translator.on("*",function(F){for(var D=arguments.length,O=new Array(D>1?D-1:0),N=1;N<D;N++)O[N-1]=arguments[N];t.emit(F,...O)}),this.modules.external.forEach(F=>{F.init&&F.init(this)})}if(this.format=this.options.interpolation.format,n||(n=fw),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const T=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);T.length>0&&T[0]!=="dev"&&(this.options.lng=T[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(T=>{this[T]=function(){return t.store[T](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(T=>{this[T]=function(){return t.store[T](...arguments),t}});const y=V0(),w=()=>{const T=(A,k)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),y.resolve(k),n(A,k)};if(this.languages&&!this.isInitialized)return T(null,this.t.bind(this));this.changeLanguage(this.options.lng,T)};return this.options.resources||!this.options.initAsync?w():setTimeout(w,0),y}loadResources(t){var u,f;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:fw;const a=di(t)?t:this.language;if(typeof t=="function"&&(n=t),!this.options.resources||this.options.partialBundledLanguages){if((a==null?void 0:a.toLowerCase())==="cimode"&&(!this.options.preload||this.options.preload.length===0))return n();const i=[],y=w=>{if(!w||w==="cimode")return;this.services.languageUtils.toResolveHierarchy(w).forEach(A=>{A!=="cimode"&&i.indexOf(A)<0&&i.push(A)})};a?y(a):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(T=>y(T)),(f=(u=this.options.preload)==null?void 0:u.forEach)==null||f.call(u,w=>y(w)),this.services.backendConnector.load(i,this.options.ns,w=>{!w&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),n(w)})}else n(null)}reloadResources(t,r,n){const a=V0();return typeof t=="function"&&(n=t,t=void 0),typeof r=="function"&&(n=r,r=void 0),t||(t=this.languages),r||(r=this.options.ns),n||(n=fw),this.services.backendConnector.reload(t,r,u=>{a.resolve(),n(u)}),a}use(t){if(!t)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!t.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return t.type==="backend"&&(this.modules.backend=t),(t.type==="logger"||t.log&&t.warn&&t.error)&&(this.modules.logger=t),t.type==="languageDetector"&&(this.modules.languageDetector=t),t.type==="i18nFormat"&&(this.modules.i18nFormat=t),t.type==="postProcessor"&&mK.addPostProcessor(t),t.type==="formatter"&&(this.modules.formatter=t),t.type==="3rdParty"&&this.modules.external.push(t),this}setResolvedLanguage(t){if(!(!t||!this.languages)&&!(["cimode","dev"].indexOf(t)>-1)){for(let r=0;r<this.languages.length;r++){const n=this.languages[r];if(!(["cimode","dev"].indexOf(n)>-1)&&this.store.hasLanguageSomeTranslations(n)){this.resolvedLanguage=n;break}}!this.resolvedLanguage&&this.languages.indexOf(t)<0&&this.store.hasLanguageSomeTranslations(t)&&(this.resolvedLanguage=t,this.languages.unshift(t))}}changeLanguage(t,r){var n=this;this.isLanguageChangingTo=t;const a=V0();this.emit("languageChanging",t);const u=y=>{this.language=y,this.languages=this.services.languageUtils.toResolveHierarchy(y),this.resolvedLanguage=void 0,this.setResolvedLanguage(y)},f=(y,w)=>{w?this.isLanguageChangingTo===t&&(u(w),this.translator.changeLanguage(w),this.isLanguageChangingTo=void 0,this.emit("languageChanged",w),this.logger.log("languageChanged",w)):this.isLanguageChangingTo=void 0,a.resolve(function(){return n.t(...arguments)}),r&&r(y,function(){return n.t(...arguments)})},i=y=>{var A,k;!t&&!y&&this.services.languageDetector&&(y=[]);const w=di(y)?y:y&&y[0],T=this.store.hasLanguageSomeTranslations(w)?w:this.services.languageUtils.getBestMatchFromCodes(di(y)?[y]:y);T&&(this.language||u(T),this.translator.language||this.translator.changeLanguage(T),(k=(A=this.services.languageDetector)==null?void 0:A.cacheUserLanguage)==null||k.call(A,T)),this.loadResources(T,F=>{f(F,T)})};return!t&&this.services.languageDetector&&!this.services.languageDetector.async?i(this.services.languageDetector.detect()):!t&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(i):this.services.languageDetector.detect(i):i(t),a}getFixedT(t,r,n){var a=this;const u=function(f,i){let y;if(typeof i!="object"){for(var w=arguments.length,T=new Array(w>2?w-2:0),A=2;A<w;A++)T[A-2]=arguments[A];y=a.options.overloadTranslationOptionHandler([f,i].concat(T))}else y={...i};y.lng=y.lng||u.lng,y.lngs=y.lngs||u.lngs,y.ns=y.ns||u.ns,y.keyPrefix!==""&&(y.keyPrefix=y.keyPrefix||n||u.keyPrefix);const k=a.options.keySeparator||".";let F;return y.keyPrefix&&Array.isArray(f)?F=f.map(D=>`${y.keyPrefix}${k}${D}`):F=y.keyPrefix?`${y.keyPrefix}${k}${f}`:f,a.t(F,y)};return di(t)?u.lng=t:u.lngs=t,u.ns=r,u.keyPrefix=n,u}t(){var a;for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(a=this.translator)==null?void 0:a.translate(...r)}exists(){var a;for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(a=this.translator)==null?void 0:a.exists(...r)}setDefaultNamespace(t){this.options.defaultNS=t}hasLoadedNamespace(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const n=r.lng||this.resolvedLanguage||this.languages[0],a=this.options?this.options.fallbackLng:!1,u=this.languages[this.languages.length-1];if(n.toLowerCase()==="cimode")return!0;const f=(i,y)=>{const w=this.services.backendConnector.state[`${i}|${y}`];return w===-1||w===0||w===2};if(r.precheck){const i=r.precheck(this,f);if(i!==void 0)return i}return!!(this.hasResourceBundle(n,t)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||f(n,t)&&(!a||f(u,t)))}loadNamespaces(t,r){const n=V0();return this.options.ns?(di(t)&&(t=[t]),t.forEach(a=>{this.options.ns.indexOf(a)<0&&this.options.ns.push(a)}),this.loadResources(a=>{n.resolve(),r&&r(a)}),n):(r&&r(),Promise.resolve())}loadLanguages(t,r){const n=V0();di(t)&&(t=[t]);const a=this.options.preload||[],u=t.filter(f=>a.indexOf(f)<0&&this.services.languageUtils.isSupportedCode(f));return u.length?(this.options.preload=a.concat(u),this.loadResources(f=>{n.resolve(),r&&r(f)}),n):(r&&r(),Promise.resolve())}dir(t){var a,u;if(t||(t=this.resolvedLanguage||(((a=this.languages)==null?void 0:a.length)>0?this.languages[0]:this.language)),!t)return"rtl";const r=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],n=((u=this.services)==null?void 0:u.languageUtils)||new F6(U6());return r.indexOf(n.getLanguagePartFromCode(t))>-1||t.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;return new qx(t,r)}cloneInstance(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:fw;const n=t.forkResourceStore;n&&delete t.forkResourceStore;const a={...this.options,...t,isClone:!0},u=new qx(a);if((t.debug!==void 0||t.prefix!==void 0)&&(u.logger=u.logger.clone(t)),["store","services","language"].forEach(i=>{u[i]=this[i]}),u.services={...this.services},u.services.utils={hasLoadedNamespace:u.hasLoadedNamespace.bind(u)},n){const i=Object.keys(this.store.data).reduce((y,w)=>(y[w]={...this.store.data[w]},y[w]=Object.keys(y[w]).reduce((T,A)=>(T[A]={...y[w][A]},T),y[w]),y),{});u.store=new D6(i,a),u.services.resourceStore=u.store}return u.translator=new OS(u.services,a),u.translator.on("*",function(i){for(var y=arguments.length,w=new Array(y>1?y-1:0),T=1;T<y;T++)w[T-1]=arguments[T];u.emit(i,...w)}),u.init(a,r),u.translator.options=a,u.translator.backendConnector.services.utils={hasLoadedNamespace:u.hasLoadedNamespace.bind(u)},u}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const Ya=qx.createInstance();Ya.createInstance=qx.createInstance;Ya.createInstance;Ya.dir;Ya.init;Ya.loadResources;Ya.reloadResources;Ya.use;Ya.changeLanguage;Ya.getFixedT;Ya.t;Ya.exists;Ya.setDefaultNamespace;Ya.hasLoadedNamespace;Ya.loadNamespaces;Ya.loadLanguages;const B0e=()=>{const[e,t]=j.useState(""),[r,n]=j.useState([]),[a,u]=j.useState([]),[f,i]=j.useState([]),[y,w]=j.useState([]),[T,A]=j.useState(null),[k,F]=j.useState(""),[D,O]=j.useState(!1),[N,V]=j.useState(!1),[H,Z]=j.useState(""),{user:J}=Rs(),G=Mo();J!=null&&J.plan;const{t:Y}=R_();j.useEffect(()=>{J!=null&&J.lang&&Ya.changeLanguage(J.lang)},[J]),j.useEffect(()=>{const ge=setTimeout(async()=>{if(e.length>5)try{const be=await Wn.post("/api/suggest-keywords",{texte:e});n(be.data.suggestions||[])}catch{n([])}},600);return()=>clearTimeout(ge)},[e]);const ie=async()=>{if(f[0])try{const ge=new FormData;ge.append("audio",f[0]);const be=await Wn.post("/api/transcribe-audio",ge);Z(be.data.text)}catch{alert("Transcription audio impossible.")}},ce=async()=>{var ge;O(!0);try{const be={texte:e||H||""},xe=await fetch("/api/search/direct",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(be)});if(!xe.ok)throw new Error(`Erreur HTTP: ${xe.status}`);const Le=await xe.json(),ze=((ge=Le==null?void 0:Le.resultats)==null?void 0:ge.resultats)||(Le==null?void 0:Le.resultats)||[];G("/resultat-besoin",{state:{results:ze,type:"recherche_besoin"}})}catch{alert("Erreur lors de la recherche.")}finally{O(!1)}};return b.jsx(Ka,{padding:!0,children:b.jsxs("div",{className:"max-w-5xl mx-auto py-10 space-y-6",children:[b.jsx("h1",{className:"text-3xl font-bold text-center text-primary",children:"🧠 Décrivez votre besoin"}),b.jsx(Sy,{placeholder:"Que cherchez-vous ? Ex. Je veux une nounou à Douala bilingue...",value:e,onChange:ge=>t(ge.target.value)}),r.length>0&&b.jsx("ul",{className:"text-sm text-gray-600 pl-4",children:r.map((ge,be)=>b.jsxs("li",{children:["🔎 ",ge]},be))}),b.jsx($i,{type:"file",accept:"image/*,video/*",multiple:!0,onChange:ge=>u(Array.from(ge.target.files||[]))}),b.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[b.jsx($i,{type:"file",accept:"audio/*",multiple:!0,onChange:ge=>i(Array.from(ge.target.files||[]))}),b.jsx(cr,{variant:"outline",onClick:ie,disabled:!f.length,children:"🎙️ Transcrire audio"})]}),H&&b.jsxs("div",{className:"text-sm text-gray-500 bg-gray-50 border rounded p-3",children:[b.jsx("strong",{children:"Transcription IA :"})," ",H]}),b.jsx($i,{type:"url",placeholder:"🔗 Lien d’un bien/service externe (facultatif)",value:k,onChange:ge=>F(ge.target.value)}),b.jsx($i,{type:"file",accept:".xlsx,.xls",onChange:ge=>{var be;return A(((be=ge.target.files)==null?void 0:be[0])||null)}}),b.jsx("div",{className:"text-center",children:b.jsx(cr,{onClick:()=>V(!0),children:"Prévisualiser"})}),N&&b.jsxs("div",{className:"border bg-white p-4 rounded shadow space-y-2",children:[b.jsx("h2",{className:"font-semibold text-lg text-center",children:"📝 Vérification"}),b.jsxs("p",{children:[b.jsx("strong",{children:"Description :"})," ",e||H]}),b.jsxs("p",{children:[b.jsx("strong",{children:"Images/Vidéos :"})," ",a.length]}),b.jsxs("p",{children:[b.jsx("strong",{children:"Audios :"})," ",f.length]}),b.jsxs("p",{children:[b.jsx("strong",{children:"Site Web :"})," ",k||"N/A"]}),b.jsxs("p",{children:[b.jsx("strong",{children:"Excel :"})," ",(T==null?void 0:T.name)||"Aucun"]}),b.jsx(cr,{onClick:ce,disabled:D,children:D?"Chargement...":"📤 Analyser maintenant"})]})]})})},nu=j.forwardRef(({className:e,...t},r)=>b.jsx("div",{ref:r,className:Ec("rounded-xl border bg-white p-6 shadow-sm",e),...t}));nu.displayName="Card";const Dj=j.forwardRef(({className:e,...t},r)=>b.jsx("div",{ref:r,className:Ec("mb-4 text-lg font-semibold",e),...t}));Dj.displayName="CardHeader";const iu=j.forwardRef(({className:e,...t},r)=>b.jsx("div",{ref:r,className:Ec("text-sm text-muted-foreground",e),...t}));iu.displayName="CardContent";const Nj=j.forwardRef(({className:e,...t},r)=>b.jsx("h3",{ref:r,className:Ec("text-lg font-semibold leading-none tracking-tight",e),...t}));Nj.displayName="CardTitle";const $0e=()=>{const e=Mo();return b.jsxs("div",{className:"min-h-screen p-8 bg-white",children:[b.jsx("h1",{className:"text-3xl font-bold text-center text-gray-800 mb-8",children:"Centre de solutions Yukpo"}),b.jsx("p",{className:"text-center text-gray-600 mb-6",children:"Yukpo met à votre disposition des outils puissants pour analyser, générer, orienter ou anticiper vos besoins."}),b.jsxs("div",{className:"grid gap-6 max-w-4xl mx-auto",children:[b.jsx(nu,{children:b.jsxs(iu,{className:"p-6 flex flex-col gap-4",children:[b.jsx("h2",{className:"text-xl font-semibold",children:"🔎 Générateur de contenu intelligent"}),b.jsx("p",{children:"Rédigez des descriptions, des annonces ou des publications automatiquement grâce à Yukpo."}),b.jsx(cr,{onClick:()=>e("/outil/contenu"),children:"Accéder"})]})}),b.jsx(nu,{children:b.jsxs(iu,{className:"p-6 flex flex-col gap-4",children:[b.jsx("h2",{className:"text-xl font-semibold",children:"📊 Analyse de vos services"}),b.jsx("p",{children:"Comprenez l’impact de vos services grâce aux analyses avancées de Yukpo."}),b.jsx(cr,{onClick:()=>e("/dashboardia"),children:"Explorer"})]})}),b.jsx(nu,{children:b.jsxs(iu,{className:"p-6 flex flex-col gap-4",children:[b.jsx("h2",{className:"text-xl font-semibold",children:"🎙️ Assistant vocal Yukpo"}),b.jsx("p",{children:"Exprimez vos demandes oralement, Yukpo les comprend et vous guide."}),b.jsx(cr,{onClick:()=>e("/vocal-assistant"),children:"Lancer"})]})})]})]})},G6=()=>{var Ne;const{prestataireId:e}=IR(),{user:t}=Rs(),r=Mo(),a=Sc().state;a==null||a.serviceId,a!=null&&a.serviceTitle;const u=((Ne=t==null?void 0:t.id)==null?void 0:Ne.toString())||"unknown",f=e||"unknown",[i,y]=j.useState([]),[w,T]=j.useState(""),[A,k]=j.useState(!1),[F,D]=j.useState(null),[O,N]=j.useState(!1),[V,H]=j.useState(!1),[Z,J]=j.useState(!1),[G,Y]=j.useState(0),ie=j.useRef(null),ce=j.useRef(null),ge=j.useRef(null);j.useRef(null);const be=j.useCallback(()=>{var We;(We=ce.current)==null||We.scrollIntoView({behavior:"smooth"})},[]);j.useEffect(()=>{be()},[i,be]),j.useEffect(()=>{(async()=>{try{D({id:parseInt(f),name:`Prestataire ${f}`,avatar:"https://ui-avatars.com/api/?name=Prestataire&background=random",isOnline:Math.random()>.5,lastSeen:new Date}),N(Math.random()>.5)}catch(Ue){console.error("Erreur chargement prestataire:",Ue)}})()},[f]),j.useEffect(()=>{const We=new WebSocket(`wss://localhost:3000/ws/chat/${u}`);return ie.current=We,We.onopen=()=>{console.log("WebSocket connecté");const Ue={id:Date.now().toString(),from:"prestataire",content:"Bonjour 👋, je suis votre prestataire Yukpo. Que puis-je faire pour vous ?",timestamp:new Date,status:"read",type:"text"};y([Ue])},We.onmessage=Ue=>{const De=JSON.parse(Ue.data),Ke={id:Date.now().toString(),from:De.from,content:De.content,timestamp:new Date,status:"delivered",type:De.type||"text",fileUrl:De.fileUrl,fileName:De.fileName};y(lt=>[...lt,Ke]),Y(lt=>lt+1),De.from==="prestataire"&&Yn.success(`Nouveau message de ${(F==null?void 0:F.name)||"Prestataire"}`)},We.onclose=()=>{console.log("WebSocket déconnecté")},()=>{We.close()}},[u,F==null?void 0:F.name]);const xe=j.useCallback(()=>{if(ie.current&&w.trim()){const We={id:Date.now().toString(),from:"client",content:w,timestamp:new Date,status:"sent",type:"text"};ie.current.send(JSON.stringify({content:w,type:"text"})),y(Ue=>[...Ue,We]),T(""),Y(0)}},[w]),Le=We=>{var Ke;const Ue=(Ke=We.target.files)==null?void 0:Ke[0];if(!Ue)return;const De={id:Date.now().toString(),from:"client",content:`Fichier: ${Ue.name}`,timestamp:new Date,status:"sent",type:Ue.type.startsWith("image/")?"image":"file",fileUrl:URL.createObjectURL(Ue),fileName:Ue.name};y(lt=>[...lt,De]),Yn.success(`Fichier "${Ue.name}" envoyé`)},ze=()=>{Z?(J(!1),Yn.success("Enregistrement audio terminé")):(J(!0),Yn.success("Enregistrement audio démarré"))},Xe=We=>{We.key==="Enter"&&!We.shiftKey&&(We.preventDefault(),xe())},Je=We=>We.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),tt=We=>{switch(We){case"sent":return b.jsx(yO,{className:"h-3 w-3 text-gray-400"});case"delivered":return b.jsx(y4,{className:"h-3 w-3 text-gray-400"});case"read":return b.jsx(y4,{className:"h-3 w-3 text-blue-500"});default:return null}},st=We=>{const Ue=We.from==="client";return b.jsx("div",{className:`flex ${Ue?"justify-end":"justify-start"} mb-3`,children:b.jsxs("div",{className:`max-w-xs lg:max-w-md ${Ue?"order-2":"order-1"}`,children:[!Ue&&b.jsxs("div",{className:"flex items-center mb-1",children:[b.jsx("img",{src:F==null?void 0:F.avatar,alt:F==null?void 0:F.name,className:"w-6 h-6 rounded-full mr-2"}),b.jsx("span",{className:"text-xs text-gray-500",children:F==null?void 0:F.name})]}),b.jsxs("div",{className:`rounded-lg px-3 py-2 ${Ue?"bg-blue-500 text-white":"bg-gray-200 text-gray-800"}`,children:[We.type==="image"&&We.fileUrl&&b.jsx("img",{src:We.fileUrl,alt:"Image",className:"max-w-full rounded mb-1"}),We.type==="file"&&b.jsxs("div",{className:"flex items-center mb-1",children:[b.jsx(sue,{className:"h-4 w-4 mr-1"}),b.jsx("span",{className:"text-sm",children:We.fileName})]}),b.jsx("p",{className:"text-sm",children:We.content}),b.jsxs("div",{className:`flex items-center justify-between mt-1 ${Ue?"text-blue-100":"text-gray-500"}`,children:[b.jsx("span",{className:"text-xs",children:Je(We.timestamp)}),Ue&&tt(We.status)]})]})]})},We.id)};return b.jsx(Ka,{children:b.jsxs("div",{className:"flex flex-col h-screen max-w-4xl mx-auto",children:[b.jsxs("div",{className:"bg-white border-b px-4 py-3 flex items-center justify-between",children:[b.jsxs("div",{className:"flex items-center",children:[b.jsx("button",{onClick:()=>r(-1),className:"mr-3 text-gray-500 hover:text-gray-700",children:b.jsx(Os,{className:"h-5 w-5"})}),b.jsxs("div",{className:"flex items-center",children:[b.jsx("img",{src:F==null?void 0:F.avatar,alt:F==null?void 0:F.name,className:"w-10 h-10 rounded-full mr-3"}),b.jsxs("div",{children:[b.jsx("h2",{className:"font-semibold",children:(F==null?void 0:F.name)||"Prestataire"}),b.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[b.jsx("div",{className:`w-2 h-2 rounded-full mr-1 ${O?"bg-green-500":"bg-gray-400"}`}),O?"En ligne":"Hors ligne"]})]})]})]}),b.jsxs("div",{className:"flex items-center space-x-2",children:[b.jsx(cr,{variant:"outline",size:"sm",children:b.jsx(jb,{className:"h-4 w-4"})}),b.jsx(cr,{variant:"outline",size:"sm",children:b.jsx(qm,{className:"h-4 w-4"})}),b.jsx(cr,{variant:"outline",size:"sm",children:b.jsx(Kce,{className:"h-4 w-4"})})]})]}),b.jsxs("div",{className:"flex-1 overflow-y-auto p-4 bg-gray-50",children:[b.jsxs("div",{className:"space-y-2",children:[i.map(st),b.jsx("div",{ref:ce})]}),A&&b.jsx("div",{className:"flex justify-start mb-3",children:b.jsx("div",{className:"bg-gray-200 rounded-lg px-3 py-2",children:b.jsxs("div",{className:"flex space-x-1",children:[b.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce"}),b.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),b.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})})]}),b.jsxs("div",{className:"bg-white border-t p-4",children:[b.jsxs("div",{className:"flex items-center space-x-2",children:[b.jsx(cr,{variant:"outline",size:"sm",onClick:()=>{var We;return(We=ge.current)==null?void 0:We.click()},children:b.jsx(YW,{className:"h-4 w-4"})}),b.jsx(cr,{variant:"outline",size:"sm",onClick:()=>H(!V),children:b.jsx(eZ,{className:"h-4 w-4"})}),b.jsxs("div",{className:"flex-1 relative",children:[b.jsx($i,{value:w,onChange:We=>T(We.target.value),onKeyPress:Xe,placeholder:"Tapez votre message...",className:"pr-12"}),b.jsx(cr,{onClick:ze,variant:"outline",size:"sm",className:`absolute right-2 top-1/2 transform -translate-y-1/2 ${Z?"text-red-500":""}`,children:b.jsx(Rm,{className:"h-4 w-4"})})]}),b.jsx(cr,{onClick:xe,disabled:!w.trim(),className:"bg-blue-500 hover:bg-blue-600 text-white",children:b.jsx(Wue,{className:"h-4 w-4"})})]}),V&&b.jsx("div",{className:"mt-2 p-2 bg-gray-100 rounded",children:b.jsx("p",{className:"text-sm text-gray-600",children:"Emoji picker à implémenter"})})]}),b.jsx("input",{ref:ge,type:"file",onChange:Le,accept:"image/*,.pdf,.doc,.docx",className:"hidden"})]})})},V0e=()=>{const{t:e}=R_(),{type:t}=IR(),r=Mo(),[n,a]=j.useState(null),[u,f]=j.useState({}),[i,y]=j.useState("XAF"),[w,T]=j.useState([]),[A,k]=j.useState(null),[F,D]=j.useState(null),[O,N]=j.useState(!1);j.useEffect(()=>{(async()=>{try{const J=await Wn.get(`/api/blueprints/${t}`);a(J.data.data)}catch{Ls.error("❌ Impossible de charger le modèle Yukpo")}})()},[t]),j.useEffect(()=>{n!=null&&n.gps_required&&navigator.geolocation.getCurrentPosition(async Z=>{try{const J=await Wn.post("/api/geoloc/country",{lat:Z.coords.latitude,lng:Z.coords.longitude});y(J.data.currency||"XAF")}catch{y("XAF")}})},[n]);const V=(Z,J)=>{f(G=>({...G,[Z]:J}))},H=async()=>{var G,Y;if(!((n==null?void 0:n.champs_specifiques)||[]).every(ie=>{var ce;return(ce=u[ie])==null?void 0:ce.trim()})){Ls.warning("Veuillez remplir tous les champs obligatoires.");return}N(!0);try{const ce=((Y=(G=(await Wn.post("/api/services/create",{type:t,data:u,currency:i})).data)==null?void 0:G.data)==null?void 0:Y.id)||null;if(ce){const ge=new FormData;w.forEach(be=>ge.append("media",be)),A&&ge.append("audio",A),F&&ge.append("video",F),await Wn.post(`/api/prestataire/upload/${ce}`,ge)}window.dispatchEvent(new CustomEvent("service_created")),Ls.success("✅ Service Yukpo enregistré avec succès !"),r($n.MES_SERVICES)}catch{Ls.error("❌ Erreur pendant l’enregistrement")}finally{N(!1)}};return b.jsx(Ka,{padding:!0,children:b.jsxs("div",{className:"max-w-3xl mx-auto py-10 px-4 space-y-6",children:[b.jsx("h1",{className:"text-2xl font-bold text-primary text-center",children:"Créer un service avec Yukpo"}),n==null?void 0:n.champs_specifiques.map(Z=>b.jsxs("div",{children:[b.jsx("label",{className:"text-sm font-medium",children:e(`fields.${Z}`)||Z}),Z.includes("description")||Z.includes("detail")?b.jsx(Sy,{value:u[Z]||"",onChange:J=>V(Z,J.target.value)}):b.jsx($i,{value:u[Z]||"",onChange:J=>V(Z,J.target.value)}),Z==="prix"&&i&&b.jsxs("p",{className:"text-sm text-gray-500",children:["Devise : ",i]})]},Z)),b.jsxs("div",{children:[b.jsx("label",{className:"text-sm font-medium",children:"📷 Images"}),b.jsx($i,{type:"file",accept:"image/*",multiple:!0,onChange:Z=>T(Array.from(Z.target.files||[]))})]}),b.jsxs("div",{children:[b.jsx("label",{className:"text-sm font-medium",children:"🎤 Audio"}),b.jsx($i,{type:"file",accept:"audio/*",onChange:Z=>{var J;return k(((J=Z.target.files)==null?void 0:J[0])||null)}})]}),b.jsxs("div",{children:[b.jsx("label",{className:"text-sm font-medium",children:"🎥 Vidéo"}),b.jsx($i,{type:"file",accept:"video/*",onChange:Z=>{var J;return D(((J=Z.target.files)==null?void 0:J[0])||null)}})]}),b.jsx("div",{className:"text-center pt-6",children:b.jsx(cr,{onClick:H,disabled:O,children:O?"🔁 Enregistrement...":"🚀 Enregistrer le service Yukpo"})})]})})};var ZC={exports:{}},XC={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var H6;function U0e(){if(H6)return XC;H6=1;var e=OE();function t(A,k){return A===k&&(A!==0||1/A===1/k)||A!==A&&k!==k}var r=typeof Object.is=="function"?Object.is:t,n=e.useState,a=e.useEffect,u=e.useLayoutEffect,f=e.useDebugValue;function i(A,k){var F=k(),D=n({inst:{value:F,getSnapshot:k}}),O=D[0].inst,N=D[1];return u(function(){O.value=F,O.getSnapshot=k,y(O)&&N({inst:O})},[A,F,k]),a(function(){return y(O)&&N({inst:O}),A(function(){y(O)&&N({inst:O})})},[A]),f(F),F}function y(A){var k=A.getSnapshot;A=A.value;try{var F=k();return!r(A,F)}catch{return!0}}function w(A,k){return k()}var T=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?w:i;return XC.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:T,XC}var W6;function q0e(){return W6||(W6=1,ZC.exports=U0e()),ZC.exports}var G0e=q0e();const gK=0,yK=1,vK=2,Z6=3;var X6=Object.prototype.hasOwnProperty;function UO(e,t){var r,n;if(e===t)return!0;if(e&&t&&(r=e.constructor)===t.constructor){if(r===Date)return e.getTime()===t.getTime();if(r===RegExp)return e.toString()===t.toString();if(r===Array){if((n=e.length)===t.length)for(;n--&&UO(e[n],t[n]););return n===-1}if(!r||typeof e=="object"){n=0;for(r in e)if(X6.call(e,r)&&++n&&!X6.call(t,r)||!(r in t)||!UO(e[r],t[r]))return!1;return Object.keys(t).length===n}}return e!==e&&t!==t}const up=new WeakMap,Dm=()=>{},Fl=Dm(),qO=Object,ls=e=>e===Fl,tf=e=>typeof e=="function",Zm=(e,t)=>({...e,...t}),_K=e=>tf(e.then),KC={},pw={},zj="undefined",Vb=typeof window!=zj,GO=typeof document!=zj,H0e=Vb&&"Deno"in window,W0e=()=>Vb&&typeof window.requestAnimationFrame!=zj,xK=(e,t)=>{const r=up.get(e);return[()=>!ls(t)&&e.get(t)||KC,n=>{if(!ls(t)){const a=e.get(t);t in pw||(pw[t]=a),r[5](t,Zm(a,n),a||KC)}},r[6],()=>!ls(t)&&t in pw?pw[t]:!ls(t)&&e.get(t)||KC]};let HO=!0;const Z0e=()=>HO,[WO,ZO]=Vb&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[Dm,Dm],X0e=()=>{const e=GO&&document.visibilityState;return ls(e)||e!=="hidden"},K0e=e=>(GO&&document.addEventListener("visibilitychange",e),WO("focus",e),()=>{GO&&document.removeEventListener("visibilitychange",e),ZO("focus",e)}),Y0e=e=>{const t=()=>{HO=!0,e()},r=()=>{HO=!1};return WO("online",t),WO("offline",r),()=>{ZO("online",t),ZO("offline",r)}},J0e={isOnline:Z0e,isVisible:X0e},Q0e={initFocus:K0e,initReconnect:Y0e},K6=!jt.useId,Gx=!Vb||H0e,exe=e=>W0e()?window.requestAnimationFrame(e):setTimeout(e,1),YC=Gx?j.useEffect:j.useLayoutEffect,JC=typeof navigator<"u"&&navigator.connection,Y6=!Gx&&JC&&(["slow-2g","2g"].includes(JC.effectiveType)||JC.saveData),mw=new WeakMap,QC=(e,t)=>qO.prototype.toString.call(e)===`[object ${t}]`;let txe=0;const XO=e=>{const t=typeof e,r=QC(e,"Date"),n=QC(e,"RegExp"),a=QC(e,"Object");let u,f;if(qO(e)===e&&!r&&!n){if(u=mw.get(e),u)return u;if(u=++txe+"~",mw.set(e,u),Array.isArray(e)){for(u="@",f=0;f<e.length;f++)u+=XO(e[f])+",";mw.set(e,u)}if(a){u="#";const i=qO.keys(e).sort();for(;!ls(f=i.pop());)ls(e[f])||(u+=f+":"+XO(e[f])+",");mw.set(e,u)}}else u=r?e.toJSON():t=="symbol"?e.toString():t=="string"?JSON.stringify(e):""+e;return u},Fj=e=>{if(tf(e))try{e=e()}catch{e=""}const t=e;return e=typeof e=="string"?e:(Array.isArray(e)?e.length:e)?XO(e):"",[e,t]};let rxe=0;const KO=()=>++rxe;async function bK(...e){const[t,r,n,a]=e,u=Zm({populateCache:!0,throwOnError:!0},typeof a=="boolean"?{revalidate:a}:a||{});let f=u.populateCache;const i=u.rollbackOnError;let y=u.optimisticData;const w=k=>typeof i=="function"?i(k):i!==!1,T=u.throwOnError;if(tf(r)){const k=r,F=[],D=t.keys();for(const O of D)!/^\$(inf|sub)\$/.test(O)&&k(t.get(O)._k)&&F.push(O);return Promise.all(F.map(A))}return A(r);async function A(k){const[F]=Fj(k);if(!F)return;const[D,O]=xK(t,F),[N,V,H,Z]=up.get(t),J=()=>{const ze=N[F];return(tf(u.revalidate)?u.revalidate(D().data,k):u.revalidate!==!1)&&(delete H[F],delete Z[F],ze&&ze[0])?ze[0](vK).then(()=>D().data):D().data};if(e.length<3)return J();let G=n,Y;const ie=KO();V[F]=[ie,0];const ce=!ls(y),ge=D(),be=ge.data,xe=ge._c,Le=ls(xe)?be:xe;if(ce&&(y=tf(y)?y(Le,be):y,O({data:y,_c:Le})),tf(G))try{G=G(Le)}catch(ze){Y=ze}if(G&&_K(G))if(G=await G.catch(ze=>{Y=ze}),ie!==V[F][0]){if(Y)throw Y;return G}else Y&&ce&&w(Y)&&(f=!0,O({data:Le,_c:Fl}));if(f&&!Y)if(tf(f)){const ze=f(G,Le);O({data:ze,error:Fl,_c:Fl})}else O({data:G,error:Fl,_c:Fl});if(V[F][1]=KO(),Promise.resolve(J()).then(()=>{O({_c:Fl})}),Y){if(T)throw Y;return}return G}}const J6=(e,t)=>{for(const r in e)e[r][0]&&e[r][0](t)},nxe=(e,t)=>{if(!up.has(e)){const r=Zm(Q0e,t),n=Object.create(null),a=bK.bind(Fl,e);let u=Dm;const f=Object.create(null),i=(T,A)=>{const k=f[T]||[];return f[T]=k,k.push(A),()=>k.splice(k.indexOf(A),1)},y=(T,A,k)=>{e.set(T,A);const F=f[T];if(F)for(const D of F)D(A,k)},w=()=>{if(!up.has(e)&&(up.set(e,[n,Object.create(null),Object.create(null),Object.create(null),a,y,i]),!Gx)){const T=r.initFocus(setTimeout.bind(Fl,J6.bind(Fl,n,gK))),A=r.initReconnect(setTimeout.bind(Fl,J6.bind(Fl,n,yK)));u=()=>{T&&T(),A&&A(),up.delete(e)}}};return w(),[e,a,w,u]}return[e,up.get(e)[4]]},ixe=(e,t,r,n,a)=>{const u=r.errorRetryCount,f=a.retryCount,i=~~((Math.random()+.5)*(1<<(f<8?f:8)))*r.errorRetryInterval;!ls(u)&&f>u||setTimeout(n,i,a)},sxe=UO,[wK,oxe]=nxe(new Map),axe=Zm({onLoadingSlow:Dm,onSuccess:Dm,onError:Dm,onErrorRetry:ixe,onDiscarded:Dm,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:Y6?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:Y6?5e3:3e3,compare:sxe,isPaused:()=>!1,cache:wK,mutate:oxe,fallback:{}},J0e),lxe=(e,t)=>{const r=Zm(e,t);if(t){const{use:n,fallback:a}=e,{use:u,fallback:f}=t;n&&u&&(r.use=n.concat(u)),a&&f&&(r.fallback=Zm(a,f))}return r},cxe=j.createContext({}),uxe="$inf$",SK=Vb&&window.__SWR_DEVTOOLS_USE__,dxe=SK?window.__SWR_DEVTOOLS_USE__:[],hxe=()=>{SK&&(window.__SWR_DEVTOOLS_REACT__=jt)},fxe=e=>tf(e[1])?[e[0],e[1],e[2]||{}]:[e[0],null,(e[1]===null?e[2]:e[1])||{}],pxe=()=>Zm(axe,j.useContext(cxe)),mxe=e=>(t,r,n)=>e(t,r&&((...u)=>{const[f]=Fj(t),[,,,i]=up.get(wK);if(f.startsWith(uxe))return r(...u);const y=i[f];return ls(y)?r(...u):(delete i[f],y)}),n),gxe=dxe.concat(mxe),yxe=e=>function(...r){const n=pxe(),[a,u,f]=fxe(r),i=lxe(n,f);let y=e;const{use:w}=i,T=(w||[]).concat(gxe);for(let A=T.length;A--;)y=T[A](y);return y(a,u||i.fetcher||null,i)},vxe=(e,t,r)=>{const n=t[e]||(t[e]=[]);return n.push(r),()=>{const a=n.indexOf(r);a>=0&&(n[a]=n[n.length-1],n.pop())}};hxe();const eA=jt.use||(e=>{switch(e.status){case"pending":throw e;case"fulfilled":return e.value;case"rejected":throw e.reason;default:throw e.status="pending",e.then(t=>{e.status="fulfilled",e.value=t},t=>{e.status="rejected",e.reason=t}),e}}),tA={dedupe:!0},_xe=(e,t,r)=>{const{cache:n,compare:a,suspense:u,fallbackData:f,revalidateOnMount:i,revalidateIfStale:y,refreshInterval:w,refreshWhenHidden:T,refreshWhenOffline:A,keepPreviousData:k}=r,[F,D,O,N]=up.get(n),[V,H]=Fj(e),Z=j.useRef(!1),J=j.useRef(!1),G=j.useRef(V),Y=j.useRef(t),ie=j.useRef(r),ce=()=>ie.current,ge=()=>ce().isVisible()&&ce().isOnline(),[be,xe,Le,ze]=xK(n,V),Xe=j.useRef({}).current,Je=ls(f)?ls(r.fallback)?Fl:r.fallback[V]:f,tt=(Rt,Dt)=>{for(const sr in Xe){const mr=sr;if(mr==="data"){if(!a(Rt[mr],Dt[mr])&&(!ls(Rt[mr])||!a(Ve,Dt[mr])))return!1}else if(Dt[mr]!==Rt[mr])return!1}return!0},st=j.useMemo(()=>{const Rt=!V||!t?!1:ls(i)?ce().isPaused()||u?!1:y!==!1:i,Dt=Yr=>{const un=Zm(Yr);return delete un._k,Rt?{isValidating:!0,isLoading:!0,...un}:un},sr=be(),mr=ze(),Vr=Dt(sr),rn=sr===mr?Vr:Dt(mr);let $r=Vr;return[()=>{const Yr=Dt(be());return tt(Yr,$r)?($r.data=Yr.data,$r.isLoading=Yr.isLoading,$r.isValidating=Yr.isValidating,$r.error=Yr.error,$r):($r=Yr,Yr)},()=>rn]},[n,V]),Ne=G0e.useSyncExternalStore(j.useCallback(Rt=>Le(V,(Dt,sr)=>{tt(sr,Dt)||Rt()}),[n,V]),st[0],st[1]),We=!Z.current,Ue=F[V]&&F[V].length>0,De=Ne.data,Ke=ls(De)?Je&&_K(Je)?eA(Je):Je:De,lt=Ne.error,Ye=j.useRef(Ke),Ve=k?ls(De)?ls(Ye.current)?Ke:Ye.current:De:Ke,Et=Ue&&!ls(lt)?!1:We&&!ls(i)?i:ce().isPaused()?!1:u?ls(Ke)?!1:y:ls(Ke)||y,kt=!!(V&&t&&We&&Et),Wt=ls(Ne.isValidating)?kt:Ne.isValidating,Tt=ls(Ne.isLoading)?kt:Ne.isLoading,Ht=j.useCallback(async Rt=>{const Dt=Y.current;if(!V||!Dt||J.current||ce().isPaused())return!1;let sr,mr,Vr=!0;const rn=Rt||{},$r=!O[V]||!rn.dedupe,Yr=()=>K6?!J.current&&V===G.current&&Z.current:V===G.current,un={isValidating:!1,isLoading:!1},Fn=()=>{xe(un)},vi=()=>{const Hr=O[V];Hr&&Hr[1]===mr&&delete O[V]},xr={isValidating:!0};ls(be().data)&&(xr.isLoading=!0);try{if($r&&(xe(xr),r.loadingTimeout&&ls(be().data)&&setTimeout(()=>{Vr&&Yr()&&ce().onLoadingSlow(V,r)},r.loadingTimeout),O[V]=[Dt(H),KO()]),[sr,mr]=O[V],sr=await sr,$r&&setTimeout(vi,r.dedupingInterval),!O[V]||O[V][1]!==mr)return $r&&Yr()&&ce().onDiscarded(V),!1;un.error=Fl;const Hr=D[V];if(!ls(Hr)&&(mr<=Hr[0]||mr<=Hr[1]||Hr[1]===0))return Fn(),$r&&Yr()&&ce().onDiscarded(V),!1;const wn=be().data;un.data=a(wn,sr)?wn:sr,$r&&Yr()&&ce().onSuccess(sr,V,r)}catch(Hr){vi();const wn=ce(),{shouldRetryOnError:xi}=wn;wn.isPaused()||(un.error=Hr,$r&&Yr()&&(wn.onError(Hr,V,wn),(xi===!0||tf(xi)&&xi(Hr))&&(!ce().revalidateOnFocus||!ce().revalidateOnReconnect||ge())&&wn.onErrorRetry(Hr,V,wn,ms=>{const Ui=F[V];Ui&&Ui[0]&&Ui[0](Z6,ms)},{retryCount:(rn.retryCount||0)+1,dedupe:!0})))}return Vr=!1,Fn(),!0},[V,n]),ur=j.useCallback((...Rt)=>bK(n,G.current,...Rt),[]);if(YC(()=>{Y.current=t,ie.current=r,ls(De)||(Ye.current=De)}),YC(()=>{if(!V)return;const Rt=Ht.bind(Fl,tA);let Dt=0;ce().revalidateOnFocus&&(Dt=Date.now()+ce().focusThrottleInterval);const mr=vxe(V,F,(Vr,rn={})=>{if(Vr==gK){const $r=Date.now();ce().revalidateOnFocus&&$r>Dt&&ge()&&(Dt=$r+ce().focusThrottleInterval,Rt())}else if(Vr==yK)ce().revalidateOnReconnect&&ge()&&Rt();else{if(Vr==vK)return Ht();if(Vr==Z6)return Ht(rn)}});return J.current=!1,G.current=V,Z.current=!0,xe({_k:H}),Et&&(ls(Ke)||Gx?Rt():exe(Rt)),()=>{J.current=!0,mr()}},[V]),YC(()=>{let Rt;function Dt(){const mr=tf(w)?w(be().data):w;mr&&Rt!==-1&&(Rt=setTimeout(sr,mr))}function sr(){!be().error&&(T||ce().isVisible())&&(A||ce().isOnline())?Ht(tA).then(Dt):Dt()}return Dt(),()=>{Rt&&(clearTimeout(Rt),Rt=-1)}},[w,T,A,V]),j.useDebugValue(Ve),u&&ls(Ke)&&V){if(!K6&&Gx)throw new Error("Fallback data is required when using Suspense in SSR.");Y.current=t,ie.current=r,J.current=!1;const Rt=N[V];if(!ls(Rt)){const Dt=ur(Rt);eA(Dt)}if(ls(lt)){const Dt=Ht(tA);ls(Ve)||(Dt.status="fulfilled",Dt.value=!0),eA(Dt)}else throw lt}return{mutate:ur,get data(){return Xe.data=!0,Ve},get error(){return Xe.error=!0,lt},get isValidating(){return Xe.isValidating=!0,Wt},get isLoading(){return Xe.isLoading=!0,Tt}}},xxe=yxe(_xe);function bxe(){const{data:e,mutate:t,isLoading:r}=xxe("/user/me",async n=>{const a=localStorage.getItem("token");return(await Wn.get(n,{headers:a?{Authorization:`Bearer ${a}`}:{}})).data},{refreshInterval:6e4});return{user:e,mutate:t,isLoading:r}}const wxe=()=>{const e=navigator.language,t=Intl.DateTimeFormat().resolvedOptions().timeZone;return t.includes("Africa")||e.includes("fr")&&(t.includes("Dakar")||t.includes("Abidjan")||t.includes("Douala"))?"XAF":t.includes("Johannesburg")||t.includes("Cape_Town")?"ZAR":t.includes("Lagos")?"NGN":t.includes("Europe")&&(t.includes("Paris")||t.includes("Berlin")||t.includes("Madrid"))?"EUR":t.includes("America")&&(t.includes("New_York")||t.includes("Chicago")||t.includes("Toronto"))?"USD":t.includes("London")?"GBP":"XAF"};function EK(e=!0){const{user:t}=Rs(),[r,n]=j.useState(null),[a,u]=j.useState(wxe()),f=async()=>{var i,y,w,T;if(t!=null&&t.id){if((t==null?void 0:t.credits)!==void 0){const A=t.credits;if(a==="XAF")n(A/10);else try{const k=A/10,D=((y=(i=(await Wn.get(`https://api.exchangerate.host/latest?base=XAF&symbols=${a}`)).data)==null?void 0:i.rates)==null?void 0:y[a])||1;n(k*D)}catch{n(A/10)}return}try{const A=localStorage.getItem("token"),F=(await Wn.get("/api/users/balance",{headers:A?{Authorization:`Bearer ${A}`}:{}})).data.tokens_balance||0;if(a==="XAF")n(F/10);else{const D=F/10,N=((T=(w=(await Wn.get(`https://api.exchangerate.host/latest?base=XAF&symbols=${a}`)).data)==null?void 0:w.rates)==null?void 0:T[a])||1;n(D*N)}}catch(A){console.error("Erreur de mise à jour solde",A)}}};return j.useEffect(()=>{if(f(),!e||!(t!=null&&t.id))return;const i=setInterval(()=>{f()},15e3);return()=>clearInterval(i)},[t,a,e]),{creditDevise:r,devise:a}}var rA,Q6;function Cc(){if(Q6)return rA;Q6=1;var e=Array.isArray;return rA=e,rA}var nA,e$;function TK(){if(e$)return nA;e$=1;var e=typeof Wu=="object"&&Wu&&Wu.Object===Object&&Wu;return nA=e,nA}var iA,t$;function pf(){if(t$)return iA;t$=1;var e=TK(),t=typeof self=="object"&&self&&self.Object===Object&&self,r=e||t||Function("return this")();return iA=r,iA}var sA,r$;function Ub(){if(r$)return sA;r$=1;var e=pf(),t=e.Symbol;return sA=t,sA}var oA,n$;function Sxe(){if(n$)return oA;n$=1;var e=Ub(),t=Object.prototype,r=t.hasOwnProperty,n=t.toString,a=e?e.toStringTag:void 0;function u(f){var i=r.call(f,a),y=f[a];try{f[a]=void 0;var w=!0}catch{}var T=n.call(f);return w&&(i?f[a]=y:delete f[a]),T}return oA=u,oA}var aA,i$;function Exe(){if(i$)return aA;i$=1;var e=Object.prototype,t=e.toString;function r(n){return t.call(n)}return aA=r,aA}var lA,s$;function Pp(){if(s$)return lA;s$=1;var e=Ub(),t=Sxe(),r=Exe(),n="[object Null]",a="[object Undefined]",u=e?e.toStringTag:void 0;function f(i){return i==null?i===void 0?a:n:u&&u in Object(i)?t(i):r(i)}return lA=f,lA}var cA,o$;function Mp(){if(o$)return cA;o$=1;function e(t){return t!=null&&typeof t=="object"}return cA=e,cA}var uA,a$;function j_(){if(a$)return uA;a$=1;var e=Pp(),t=Mp(),r="[object Symbol]";function n(a){return typeof a=="symbol"||t(a)&&e(a)==r}return uA=n,uA}var dA,l$;function Bj(){if(l$)return dA;l$=1;var e=Cc(),t=j_(),r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,n=/^\w*$/;function a(u,f){if(e(u))return!1;var i=typeof u;return i=="number"||i=="symbol"||i=="boolean"||u==null||t(u)?!0:n.test(u)||!r.test(u)||f!=null&&u in Object(f)}return dA=a,dA}var hA,c$;function Jm(){if(c$)return hA;c$=1;function e(t){var r=typeof t;return t!=null&&(r=="object"||r=="function")}return hA=e,hA}var fA,u$;function $j(){if(u$)return fA;u$=1;var e=Pp(),t=Jm(),r="[object AsyncFunction]",n="[object Function]",a="[object GeneratorFunction]",u="[object Proxy]";function f(i){if(!t(i))return!1;var y=e(i);return y==n||y==a||y==r||y==u}return fA=f,fA}var pA,d$;function Txe(){if(d$)return pA;d$=1;var e=pf(),t=e["__core-js_shared__"];return pA=t,pA}var mA,h$;function Cxe(){if(h$)return mA;h$=1;var e=Txe(),t=function(){var n=/[^.]+$/.exec(e&&e.keys&&e.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}();function r(n){return!!t&&t in n}return mA=r,mA}var gA,f$;function CK(){if(f$)return gA;f$=1;var e=Function.prototype,t=e.toString;function r(n){if(n!=null){try{return t.call(n)}catch{}try{return n+""}catch{}}return""}return gA=r,gA}var yA,p$;function Axe(){if(p$)return yA;p$=1;var e=$j(),t=Cxe(),r=Jm(),n=CK(),a=/[\\^$.*+?()[\]{}|]/g,u=/^\[object .+?Constructor\]$/,f=Function.prototype,i=Object.prototype,y=f.toString,w=i.hasOwnProperty,T=RegExp("^"+y.call(w).replace(a,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function A(k){if(!r(k)||t(k))return!1;var F=e(k)?T:u;return F.test(n(k))}return yA=A,yA}var vA,m$;function Pxe(){if(m$)return vA;m$=1;function e(t,r){return t==null?void 0:t[r]}return vA=e,vA}var _A,g$;function Ly(){if(g$)return _A;g$=1;var e=Axe(),t=Pxe();function r(n,a){var u=t(n,a);return e(u)?u:void 0}return _A=r,_A}var xA,y$;function l2(){if(y$)return xA;y$=1;var e=Ly(),t=e(Object,"create");return xA=t,xA}var bA,v$;function Mxe(){if(v$)return bA;v$=1;var e=l2();function t(){this.__data__=e?e(null):{},this.size=0}return bA=t,bA}var wA,_$;function Ixe(){if(_$)return wA;_$=1;function e(t){var r=this.has(t)&&delete this.__data__[t];return this.size-=r?1:0,r}return wA=e,wA}var SA,x$;function kxe(){if(x$)return SA;x$=1;var e=l2(),t="__lodash_hash_undefined__",r=Object.prototype,n=r.hasOwnProperty;function a(u){var f=this.__data__;if(e){var i=f[u];return i===t?void 0:i}return n.call(f,u)?f[u]:void 0}return SA=a,SA}var EA,b$;function Oxe(){if(b$)return EA;b$=1;var e=l2(),t=Object.prototype,r=t.hasOwnProperty;function n(a){var u=this.__data__;return e?u[a]!==void 0:r.call(u,a)}return EA=n,EA}var TA,w$;function Lxe(){if(w$)return TA;w$=1;var e=l2(),t="__lodash_hash_undefined__";function r(n,a){var u=this.__data__;return this.size+=this.has(n)?0:1,u[n]=e&&a===void 0?t:a,this}return TA=r,TA}var CA,S$;function Rxe(){if(S$)return CA;S$=1;var e=Mxe(),t=Ixe(),r=kxe(),n=Oxe(),a=Lxe();function u(f){var i=-1,y=f==null?0:f.length;for(this.clear();++i<y;){var w=f[i];this.set(w[0],w[1])}}return u.prototype.clear=e,u.prototype.delete=t,u.prototype.get=r,u.prototype.has=n,u.prototype.set=a,CA=u,CA}var AA,E$;function jxe(){if(E$)return AA;E$=1;function e(){this.__data__=[],this.size=0}return AA=e,AA}var PA,T$;function Vj(){if(T$)return PA;T$=1;function e(t,r){return t===r||t!==t&&r!==r}return PA=e,PA}var MA,C$;function c2(){if(C$)return MA;C$=1;var e=Vj();function t(r,n){for(var a=r.length;a--;)if(e(r[a][0],n))return a;return-1}return MA=t,MA}var IA,A$;function Dxe(){if(A$)return IA;A$=1;var e=c2(),t=Array.prototype,r=t.splice;function n(a){var u=this.__data__,f=e(u,a);if(f<0)return!1;var i=u.length-1;return f==i?u.pop():r.call(u,f,1),--this.size,!0}return IA=n,IA}var kA,P$;function Nxe(){if(P$)return kA;P$=1;var e=c2();function t(r){var n=this.__data__,a=e(n,r);return a<0?void 0:n[a][1]}return kA=t,kA}var OA,M$;function zxe(){if(M$)return OA;M$=1;var e=c2();function t(r){return e(this.__data__,r)>-1}return OA=t,OA}var LA,I$;function Fxe(){if(I$)return LA;I$=1;var e=c2();function t(r,n){var a=this.__data__,u=e(a,r);return u<0?(++this.size,a.push([r,n])):a[u][1]=n,this}return LA=t,LA}var RA,k$;function u2(){if(k$)return RA;k$=1;var e=jxe(),t=Dxe(),r=Nxe(),n=zxe(),a=Fxe();function u(f){var i=-1,y=f==null?0:f.length;for(this.clear();++i<y;){var w=f[i];this.set(w[0],w[1])}}return u.prototype.clear=e,u.prototype.delete=t,u.prototype.get=r,u.prototype.has=n,u.prototype.set=a,RA=u,RA}var jA,O$;function Uj(){if(O$)return jA;O$=1;var e=Ly(),t=pf(),r=e(t,"Map");return jA=r,jA}var DA,L$;function Bxe(){if(L$)return DA;L$=1;var e=Rxe(),t=u2(),r=Uj();function n(){this.size=0,this.__data__={hash:new e,map:new(r||t),string:new e}}return DA=n,DA}var NA,R$;function $xe(){if(R$)return NA;R$=1;function e(t){var r=typeof t;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?t!=="__proto__":t===null}return NA=e,NA}var zA,j$;function d2(){if(j$)return zA;j$=1;var e=$xe();function t(r,n){var a=r.__data__;return e(n)?a[typeof n=="string"?"string":"hash"]:a.map}return zA=t,zA}var FA,D$;function Vxe(){if(D$)return FA;D$=1;var e=d2();function t(r){var n=e(this,r).delete(r);return this.size-=n?1:0,n}return FA=t,FA}var BA,N$;function Uxe(){if(N$)return BA;N$=1;var e=d2();function t(r){return e(this,r).get(r)}return BA=t,BA}var $A,z$;function qxe(){if(z$)return $A;z$=1;var e=d2();function t(r){return e(this,r).has(r)}return $A=t,$A}var VA,F$;function Gxe(){if(F$)return VA;F$=1;var e=d2();function t(r,n){var a=e(this,r),u=a.size;return a.set(r,n),this.size+=a.size==u?0:1,this}return VA=t,VA}var UA,B$;function qj(){if(B$)return UA;B$=1;var e=Bxe(),t=Vxe(),r=Uxe(),n=qxe(),a=Gxe();function u(f){var i=-1,y=f==null?0:f.length;for(this.clear();++i<y;){var w=f[i];this.set(w[0],w[1])}}return u.prototype.clear=e,u.prototype.delete=t,u.prototype.get=r,u.prototype.has=n,u.prototype.set=a,UA=u,UA}var qA,$$;function AK(){if($$)return qA;$$=1;var e=qj(),t="Expected a function";function r(n,a){if(typeof n!="function"||a!=null&&typeof a!="function")throw new TypeError(t);var u=function(){var f=arguments,i=a?a.apply(this,f):f[0],y=u.cache;if(y.has(i))return y.get(i);var w=n.apply(this,f);return u.cache=y.set(i,w)||y,w};return u.cache=new(r.Cache||e),u}return r.Cache=e,qA=r,qA}var GA,V$;function Hxe(){if(V$)return GA;V$=1;var e=AK(),t=500;function r(n){var a=e(n,function(f){return u.size===t&&u.clear(),f}),u=a.cache;return a}return GA=r,GA}var HA,U$;function Wxe(){if(U$)return HA;U$=1;var e=Hxe(),t=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,r=/\\(\\)?/g,n=e(function(a){var u=[];return a.charCodeAt(0)===46&&u.push(""),a.replace(t,function(f,i,y,w){u.push(y?w.replace(r,"$1"):i||f)}),u});return HA=n,HA}var WA,q$;function Gj(){if(q$)return WA;q$=1;function e(t,r){for(var n=-1,a=t==null?0:t.length,u=Array(a);++n<a;)u[n]=r(t[n],n,t);return u}return WA=e,WA}var ZA,G$;function Zxe(){if(G$)return ZA;G$=1;var e=Ub(),t=Gj(),r=Cc(),n=j_(),a=e?e.prototype:void 0,u=a?a.toString:void 0;function f(i){if(typeof i=="string")return i;if(r(i))return t(i,f)+"";if(n(i))return u?u.call(i):"";var y=i+"";return y=="0"&&1/i==-1/0?"-0":y}return ZA=f,ZA}var XA,H$;function PK(){if(H$)return XA;H$=1;var e=Zxe();function t(r){return r==null?"":e(r)}return XA=t,XA}var KA,W$;function MK(){if(W$)return KA;W$=1;var e=Cc(),t=Bj(),r=Wxe(),n=PK();function a(u,f){return e(u)?u:t(u,f)?[u]:r(n(u))}return KA=a,KA}var YA,Z$;function h2(){if(Z$)return YA;Z$=1;var e=j_();function t(r){if(typeof r=="string"||e(r))return r;var n=r+"";return n=="0"&&1/r==-1/0?"-0":n}return YA=t,YA}var JA,X$;function Hj(){if(X$)return JA;X$=1;var e=MK(),t=h2();function r(n,a){a=e(a,n);for(var u=0,f=a.length;n!=null&&u<f;)n=n[t(a[u++])];return u&&u==f?n:void 0}return JA=r,JA}var QA,K$;function IK(){if(K$)return QA;K$=1;var e=Hj();function t(r,n,a){var u=r==null?void 0:e(r,n);return u===void 0?a:u}return QA=t,QA}var Xxe=IK();const Xu=vs(Xxe);var eP,Y$;function Kxe(){if(Y$)return eP;Y$=1;function e(t){return t==null}return eP=e,eP}var Yxe=Kxe();const Zi=vs(Yxe);var tP,J$;function Jxe(){if(J$)return tP;J$=1;var e=Pp(),t=Cc(),r=Mp(),n="[object String]";function a(u){return typeof u=="string"||!t(u)&&r(u)&&e(u)==n}return tP=a,tP}var Qxe=Jxe();const Ty=vs(Qxe);var ebe=$j();const Wi=vs(ebe);var tbe=Jm();const D_=vs(tbe);var rP={exports:{}},Es={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Q$;function rbe(){if(Q$)return Es;Q$=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),u=Symbol.for("react.provider"),f=Symbol.for("react.context"),i=Symbol.for("react.server_context"),y=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),T=Symbol.for("react.suspense_list"),A=Symbol.for("react.memo"),k=Symbol.for("react.lazy"),F=Symbol.for("react.offscreen"),D;D=Symbol.for("react.module.reference");function O(N){if(typeof N=="object"&&N!==null){var V=N.$$typeof;switch(V){case e:switch(N=N.type,N){case r:case a:case n:case w:case T:return N;default:switch(N=N&&N.$$typeof,N){case i:case f:case y:case k:case A:case u:return N;default:return V}}case t:return V}}}return Es.ContextConsumer=f,Es.ContextProvider=u,Es.Element=e,Es.ForwardRef=y,Es.Fragment=r,Es.Lazy=k,Es.Memo=A,Es.Portal=t,Es.Profiler=a,Es.StrictMode=n,Es.Suspense=w,Es.SuspenseList=T,Es.isAsyncMode=function(){return!1},Es.isConcurrentMode=function(){return!1},Es.isContextConsumer=function(N){return O(N)===f},Es.isContextProvider=function(N){return O(N)===u},Es.isElement=function(N){return typeof N=="object"&&N!==null&&N.$$typeof===e},Es.isForwardRef=function(N){return O(N)===y},Es.isFragment=function(N){return O(N)===r},Es.isLazy=function(N){return O(N)===k},Es.isMemo=function(N){return O(N)===A},Es.isPortal=function(N){return O(N)===t},Es.isProfiler=function(N){return O(N)===a},Es.isStrictMode=function(N){return O(N)===n},Es.isSuspense=function(N){return O(N)===w},Es.isSuspenseList=function(N){return O(N)===T},Es.isValidElementType=function(N){return typeof N=="string"||typeof N=="function"||N===r||N===a||N===n||N===w||N===T||N===F||typeof N=="object"&&N!==null&&(N.$$typeof===k||N.$$typeof===A||N.$$typeof===u||N.$$typeof===f||N.$$typeof===y||N.$$typeof===D||N.getModuleId!==void 0)},Es.typeOf=O,Es}var eV;function nbe(){return eV||(eV=1,rP.exports=rbe()),rP.exports}var ibe=nbe(),nP,tV;function kK(){if(tV)return nP;tV=1;var e=Pp(),t=Mp(),r="[object Number]";function n(a){return typeof a=="number"||t(a)&&e(a)==r}return nP=n,nP}var iP,rV;function sbe(){if(rV)return iP;rV=1;var e=kK();function t(r){return e(r)&&r!=+r}return iP=t,iP}var obe=sbe();const qb=vs(obe);var abe=kK();const lbe=vs(abe);var Xd=function(t){return t===0?0:t>0?1:-1},cy=function(t){return Ty(t)&&t.indexOf("%")===t.length-1},cn=function(t){return lbe(t)&&!qb(t)},_a=function(t){return cn(t)||Ty(t)},cbe=0,Gb=function(t){var r=++cbe;return"".concat(t||"").concat(r)},Cy=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!cn(t)&&!Ty(t))return n;var u;if(cy(t)){var f=t.indexOf("%");u=r*parseFloat(t.slice(0,f))/100}else u=+t;return qb(u)&&(u=n),a&&u>r&&(u=r),u},Cv=function(t){if(!t)return null;var r=Object.keys(t);return r&&r.length?t[r[0]]:null},ube=function(t){if(!Array.isArray(t))return!1;for(var r=t.length,n={},a=0;a<r;a++)if(!n[t[a]])n[t[a]]=!0;else return!0;return!1},Wd=function(t,r){return cn(t)&&cn(r)?function(n){return t+n*(r-t)}:function(){return r}};function LS(e,t,r){return!e||!e.length?null:e.find(function(n){return n&&(typeof t=="function"?t(n):Xu(n,t))===r})}var dbe=function(t,r){return cn(t)&&cn(r)?t-r:Ty(t)&&Ty(r)?t.localeCompare(r):t instanceof Date&&r instanceof Date?t.getTime()-r.getTime():String(t).localeCompare(String(r))};function Uv(e,t){for(var r in e)if({}.hasOwnProperty.call(e,r)&&(!{}.hasOwnProperty.call(t,r)||e[r]!==t[r]))return!1;for(var n in t)if({}.hasOwnProperty.call(t,n)&&!{}.hasOwnProperty.call(e,n))return!1;return!0}function YO(e){"@babel/helpers - typeof";return YO=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},YO(e)}var hbe=["viewBox","children"],fbe=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],nV=["points","pathLength"],sP={svg:hbe,polygon:nV,polyline:nV},Wj=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],RS=function(t,r){if(!t||typeof t=="function"||typeof t=="boolean")return null;var n=t;if(j.isValidElement(t)&&(n=t.props),!D_(n))return null;var a={};return Object.keys(n).forEach(function(u){Wj.includes(u)&&(a[u]=r||function(f){return n[u](n,f)})}),a},pbe=function(t,r,n){return function(a){return t(r,n,a),null}},jS=function(t,r,n){if(!D_(t)||YO(t)!=="object")return null;var a=null;return Object.keys(t).forEach(function(u){var f=t[u];Wj.includes(u)&&typeof f=="function"&&(a||(a={}),a[u]=pbe(f,r,n))}),a},mbe=["children"],gbe=["children"];function iV(e,t){if(e==null)return{};var r=ybe(e,t),n,a;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(a=0;a<u.length;a++)n=u[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function ybe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function JO(e){"@babel/helpers - typeof";return JO=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},JO(e)}var sV={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},gp=function(t){return typeof t=="string"?t:t?t.displayName||t.name||"Component":""},oV=null,oP=null,Zj=function e(t){if(t===oV&&Array.isArray(oP))return oP;var r=[];return j.Children.forEach(t,function(n){Zi(n)||(ibe.isFragment(n)?r=r.concat(e(n.props.children)):r.push(n))}),oP=r,oV=t,r};function Ku(e,t){var r=[],n=[];return Array.isArray(t)?n=t.map(function(a){return gp(a)}):n=[gp(t)],Zj(e).forEach(function(a){var u=Xu(a,"type.displayName")||Xu(a,"type.name");n.indexOf(u)!==-1&&r.push(a)}),r}function eu(e,t){var r=Ku(e,t);return r&&r[0]}var aV=function(t){if(!t||!t.props)return!1;var r=t.props,n=r.width,a=r.height;return!(!cn(n)||n<=0||!cn(a)||a<=0)},vbe=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],_be=function(t){return t&&t.type&&Ty(t.type)&&vbe.indexOf(t.type)>=0},xbe=function(t){return t&&JO(t)==="object"&&"clipDot"in t},bbe=function(t,r,n,a){var u,f=(u=sP==null?void 0:sP[a])!==null&&u!==void 0?u:[];return r.startsWith("data-")||!Wi(t)&&(a&&f.includes(r)||fbe.includes(r))||n&&Wj.includes(r)},ns=function(t,r,n){if(!t||typeof t=="function"||typeof t=="boolean")return null;var a=t;if(j.isValidElement(t)&&(a=t.props),!D_(a))return null;var u={};return Object.keys(a).forEach(function(f){var i;bbe((i=a)===null||i===void 0?void 0:i[f],f,r,n)&&(u[f]=a[f])}),u},QO=function e(t,r){if(t===r)return!0;var n=j.Children.count(t);if(n!==j.Children.count(r))return!1;if(n===0)return!0;if(n===1)return lV(Array.isArray(t)?t[0]:t,Array.isArray(r)?r[0]:r);for(var a=0;a<n;a++){var u=t[a],f=r[a];if(Array.isArray(u)||Array.isArray(f)){if(!e(u,f))return!1}else if(!lV(u,f))return!1}return!0},lV=function(t,r){if(Zi(t)&&Zi(r))return!0;if(!Zi(t)&&!Zi(r)){var n=t.props||{},a=n.children,u=iV(n,mbe),f=r.props||{},i=f.children,y=iV(f,gbe);return a&&i?Uv(u,y)&&QO(a,i):!a&&!i?Uv(u,y):!1}return!1},cV=function(t,r){var n=[],a={};return Zj(t).forEach(function(u,f){if(_be(u))n.push(u);else if(u){var i=gp(u.type),y=r[i]||{},w=y.handler,T=y.once;if(w&&(!T||!a[i])){var A=w(u,i,f);n.push(A),a[i]=!0}}}),n},wbe=function(t){var r=t&&t.type;return r&&sV[r]?sV[r]:null},Sbe=function(t,r){return Zj(r).indexOf(t)},Ebe=["children","width","height","viewBox","className","style","title","desc"];function eL(){return eL=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},eL.apply(this,arguments)}function Tbe(e,t){if(e==null)return{};var r=Cbe(e,t),n,a;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(a=0;a<u.length;a++)n=u[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Cbe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function tL(e){var t=e.children,r=e.width,n=e.height,a=e.viewBox,u=e.className,f=e.style,i=e.title,y=e.desc,w=Tbe(e,Ebe),T=a||{width:r,height:n,x:0,y:0},A=Li("recharts-surface",u);return jt.createElement("svg",eL({},ns(w,!0,"svg"),{className:A,width:r,height:n,style:f,viewBox:"".concat(T.x," ").concat(T.y," ").concat(T.width," ").concat(T.height)}),jt.createElement("title",null,i),jt.createElement("desc",null,y),t)}var Abe=["children","className"];function rL(){return rL=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},rL.apply(this,arguments)}function Pbe(e,t){if(e==null)return{};var r=Mbe(e,t),n,a;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(a=0;a<u.length;a++)n=u[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Mbe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var $o=jt.forwardRef(function(e,t){var r=e.children,n=e.className,a=Pbe(e,Abe),u=Li("recharts-layer",n);return jt.createElement("g",rL({className:u},ns(a,!0),{ref:t}),r)}),gy=function(t,r){for(var n=arguments.length,a=new Array(n>2?n-2:0),u=2;u<n;u++)a[u-2]=arguments[u]},aP,uV;function Ibe(){if(uV)return aP;uV=1;function e(t,r,n){var a=-1,u=t.length;r<0&&(r=-r>u?0:u+r),n=n>u?u:n,n<0&&(n+=u),u=r>n?0:n-r>>>0,r>>>=0;for(var f=Array(u);++a<u;)f[a]=t[a+r];return f}return aP=e,aP}var lP,dV;function kbe(){if(dV)return lP;dV=1;var e=Ibe();function t(r,n,a){var u=r.length;return a=a===void 0?u:a,!n&&a>=u?r:e(r,n,a)}return lP=t,lP}var cP,hV;function OK(){if(hV)return cP;hV=1;var e="\\ud800-\\udfff",t="\\u0300-\\u036f",r="\\ufe20-\\ufe2f",n="\\u20d0-\\u20ff",a=t+r+n,u="\\ufe0e\\ufe0f",f="\\u200d",i=RegExp("["+f+e+a+u+"]");function y(w){return i.test(w)}return cP=y,cP}var uP,fV;function Obe(){if(fV)return uP;fV=1;function e(t){return t.split("")}return uP=e,uP}var dP,pV;function Lbe(){if(pV)return dP;pV=1;var e="\\ud800-\\udfff",t="\\u0300-\\u036f",r="\\ufe20-\\ufe2f",n="\\u20d0-\\u20ff",a=t+r+n,u="\\ufe0e\\ufe0f",f="["+e+"]",i="["+a+"]",y="\\ud83c[\\udffb-\\udfff]",w="(?:"+i+"|"+y+")",T="[^"+e+"]",A="(?:\\ud83c[\\udde6-\\uddff]){2}",k="[\\ud800-\\udbff][\\udc00-\\udfff]",F="\\u200d",D=w+"?",O="["+u+"]?",N="(?:"+F+"(?:"+[T,A,k].join("|")+")"+O+D+")*",V=O+D+N,H="(?:"+[T+i+"?",i,A,k,f].join("|")+")",Z=RegExp(y+"(?="+y+")|"+H+V,"g");function J(G){return G.match(Z)||[]}return dP=J,dP}var hP,mV;function Rbe(){if(mV)return hP;mV=1;var e=Obe(),t=OK(),r=Lbe();function n(a){return t(a)?r(a):e(a)}return hP=n,hP}var fP,gV;function jbe(){if(gV)return fP;gV=1;var e=kbe(),t=OK(),r=Rbe(),n=PK();function a(u){return function(f){f=n(f);var i=t(f)?r(f):void 0,y=i?i[0]:f.charAt(0),w=i?e(i,1).join(""):f.slice(1);return y[u]()+w}}return fP=a,fP}var pP,yV;function Dbe(){if(yV)return pP;yV=1;var e=jbe(),t=e("toUpperCase");return pP=t,pP}var Nbe=Dbe();const f2=vs(Nbe);function Gs(e){return function(){return e}}const LK=Math.cos,DS=Math.sin,rh=Math.sqrt,NS=Math.PI,p2=2*NS,nL=Math.PI,iL=2*nL,ny=1e-6,zbe=iL-ny;function RK(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function Fbe(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return RK;const r=10**t;return function(n){this._+=n[0];for(let a=1,u=n.length;a<u;++a)this._+=Math.round(arguments[a]*r)/r+n[a]}}class Bbe{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?RK:Fbe(t)}moveTo(t,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,r){this._append`L${this._x1=+t},${this._y1=+r}`}quadraticCurveTo(t,r,n,a){this._append`Q${+t},${+r},${this._x1=+n},${this._y1=+a}`}bezierCurveTo(t,r,n,a,u,f){this._append`C${+t},${+r},${+n},${+a},${this._x1=+u},${this._y1=+f}`}arcTo(t,r,n,a,u){if(t=+t,r=+r,n=+n,a=+a,u=+u,u<0)throw new Error(`negative radius: ${u}`);let f=this._x1,i=this._y1,y=n-t,w=a-r,T=f-t,A=i-r,k=T*T+A*A;if(this._x1===null)this._append`M${this._x1=t},${this._y1=r}`;else if(k>ny)if(!(Math.abs(A*y-w*T)>ny)||!u)this._append`L${this._x1=t},${this._y1=r}`;else{let F=n-f,D=a-i,O=y*y+w*w,N=F*F+D*D,V=Math.sqrt(O),H=Math.sqrt(k),Z=u*Math.tan((nL-Math.acos((O+k-N)/(2*V*H)))/2),J=Z/H,G=Z/V;Math.abs(J-1)>ny&&this._append`L${t+J*T},${r+J*A}`,this._append`A${u},${u},0,0,${+(A*F>T*D)},${this._x1=t+G*y},${this._y1=r+G*w}`}}arc(t,r,n,a,u,f){if(t=+t,r=+r,n=+n,f=!!f,n<0)throw new Error(`negative radius: ${n}`);let i=n*Math.cos(a),y=n*Math.sin(a),w=t+i,T=r+y,A=1^f,k=f?a-u:u-a;this._x1===null?this._append`M${w},${T}`:(Math.abs(this._x1-w)>ny||Math.abs(this._y1-T)>ny)&&this._append`L${w},${T}`,n&&(k<0&&(k=k%iL+iL),k>zbe?this._append`A${n},${n},0,1,${A},${t-i},${r-y}A${n},${n},0,1,${A},${this._x1=w},${this._y1=T}`:k>ny&&this._append`A${n},${n},0,${+(k>=nL)},${A},${this._x1=t+n*Math.cos(u)},${this._y1=r+n*Math.sin(u)}`)}rect(t,r,n,a){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}h${n=+n}v${+a}h${-n}Z`}toString(){return this._}}function Xj(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(r==null)t=null;else{const n=Math.floor(r);if(!(n>=0))throw new RangeError(`invalid digits: ${r}`);t=n}return e},()=>new Bbe(t)}function Kj(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function jK(e){this._context=e}jK.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function m2(e){return new jK(e)}function DK(e){return e[0]}function NK(e){return e[1]}function zK(e,t){var r=Gs(!0),n=null,a=m2,u=null,f=Xj(i);e=typeof e=="function"?e:e===void 0?DK:Gs(e),t=typeof t=="function"?t:t===void 0?NK:Gs(t);function i(y){var w,T=(y=Kj(y)).length,A,k=!1,F;for(n==null&&(u=a(F=f())),w=0;w<=T;++w)!(w<T&&r(A=y[w],w,y))===k&&((k=!k)?u.lineStart():u.lineEnd()),k&&u.point(+e(A,w,y),+t(A,w,y));if(F)return u=null,F+""||null}return i.x=function(y){return arguments.length?(e=typeof y=="function"?y:Gs(+y),i):e},i.y=function(y){return arguments.length?(t=typeof y=="function"?y:Gs(+y),i):t},i.defined=function(y){return arguments.length?(r=typeof y=="function"?y:Gs(!!y),i):r},i.curve=function(y){return arguments.length?(a=y,n!=null&&(u=a(n)),i):a},i.context=function(y){return arguments.length?(y==null?n=u=null:u=a(n=y),i):n},i}function gw(e,t,r){var n=null,a=Gs(!0),u=null,f=m2,i=null,y=Xj(w);e=typeof e=="function"?e:e===void 0?DK:Gs(+e),t=typeof t=="function"?t:Gs(t===void 0?0:+t),r=typeof r=="function"?r:r===void 0?NK:Gs(+r);function w(A){var k,F,D,O=(A=Kj(A)).length,N,V=!1,H,Z=new Array(O),J=new Array(O);for(u==null&&(i=f(H=y())),k=0;k<=O;++k){if(!(k<O&&a(N=A[k],k,A))===V)if(V=!V)F=k,i.areaStart(),i.lineStart();else{for(i.lineEnd(),i.lineStart(),D=k-1;D>=F;--D)i.point(Z[D],J[D]);i.lineEnd(),i.areaEnd()}V&&(Z[k]=+e(N,k,A),J[k]=+t(N,k,A),i.point(n?+n(N,k,A):Z[k],r?+r(N,k,A):J[k]))}if(H)return i=null,H+""||null}function T(){return zK().defined(a).curve(f).context(u)}return w.x=function(A){return arguments.length?(e=typeof A=="function"?A:Gs(+A),n=null,w):e},w.x0=function(A){return arguments.length?(e=typeof A=="function"?A:Gs(+A),w):e},w.x1=function(A){return arguments.length?(n=A==null?null:typeof A=="function"?A:Gs(+A),w):n},w.y=function(A){return arguments.length?(t=typeof A=="function"?A:Gs(+A),r=null,w):t},w.y0=function(A){return arguments.length?(t=typeof A=="function"?A:Gs(+A),w):t},w.y1=function(A){return arguments.length?(r=A==null?null:typeof A=="function"?A:Gs(+A),w):r},w.lineX0=w.lineY0=function(){return T().x(e).y(t)},w.lineY1=function(){return T().x(e).y(r)},w.lineX1=function(){return T().x(n).y(t)},w.defined=function(A){return arguments.length?(a=typeof A=="function"?A:Gs(!!A),w):a},w.curve=function(A){return arguments.length?(f=A,u!=null&&(i=f(u)),w):f},w.context=function(A){return arguments.length?(A==null?u=i=null:i=f(u=A),w):u},w}class FK{constructor(t,r){this._context=t,this._x=r}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,r){switch(t=+t,r=+r,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,r,t,r):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+r)/2,t,this._y0,t,r);break}}this._x0=t,this._y0=r}}function $be(e){return new FK(e,!0)}function Vbe(e){return new FK(e,!1)}const Yj={draw(e,t){const r=rh(t/NS);e.moveTo(r,0),e.arc(0,0,r,0,p2)}},Ube={draw(e,t){const r=rh(t/5)/2;e.moveTo(-3*r,-r),e.lineTo(-r,-r),e.lineTo(-r,-3*r),e.lineTo(r,-3*r),e.lineTo(r,-r),e.lineTo(3*r,-r),e.lineTo(3*r,r),e.lineTo(r,r),e.lineTo(r,3*r),e.lineTo(-r,3*r),e.lineTo(-r,r),e.lineTo(-3*r,r),e.closePath()}},BK=rh(1/3),qbe=BK*2,Gbe={draw(e,t){const r=rh(t/qbe),n=r*BK;e.moveTo(0,-r),e.lineTo(n,0),e.lineTo(0,r),e.lineTo(-n,0),e.closePath()}},Hbe={draw(e,t){const r=rh(t),n=-r/2;e.rect(n,n,r,r)}},Wbe=.8908130915292852,$K=DS(NS/10)/DS(7*NS/10),Zbe=DS(p2/10)*$K,Xbe=-LK(p2/10)*$K,Kbe={draw(e,t){const r=rh(t*Wbe),n=Zbe*r,a=Xbe*r;e.moveTo(0,-r),e.lineTo(n,a);for(let u=1;u<5;++u){const f=p2*u/5,i=LK(f),y=DS(f);e.lineTo(y*r,-i*r),e.lineTo(i*n-y*a,y*n+i*a)}e.closePath()}},mP=rh(3),Ybe={draw(e,t){const r=-rh(t/(mP*3));e.moveTo(0,r*2),e.lineTo(-mP*r,-r),e.lineTo(mP*r,-r),e.closePath()}},Uu=-.5,qu=rh(3)/2,sL=1/rh(12),Jbe=(sL/2+1)*3,Qbe={draw(e,t){const r=rh(t/Jbe),n=r/2,a=r*sL,u=n,f=r*sL+r,i=-u,y=f;e.moveTo(n,a),e.lineTo(u,f),e.lineTo(i,y),e.lineTo(Uu*n-qu*a,qu*n+Uu*a),e.lineTo(Uu*u-qu*f,qu*u+Uu*f),e.lineTo(Uu*i-qu*y,qu*i+Uu*y),e.lineTo(Uu*n+qu*a,Uu*a-qu*n),e.lineTo(Uu*u+qu*f,Uu*f-qu*u),e.lineTo(Uu*i+qu*y,Uu*y-qu*i),e.closePath()}};function e1e(e,t){let r=null,n=Xj(a);e=typeof e=="function"?e:Gs(e||Yj),t=typeof t=="function"?t:Gs(t===void 0?64:+t);function a(){let u;if(r||(r=u=n()),e.apply(this,arguments).draw(r,+t.apply(this,arguments)),u)return r=null,u+""||null}return a.type=function(u){return arguments.length?(e=typeof u=="function"?u:Gs(u),a):e},a.size=function(u){return arguments.length?(t=typeof u=="function"?u:Gs(+u),a):t},a.context=function(u){return arguments.length?(r=u??null,a):r},a}function zS(){}function FS(e,t,r){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+r)/6)}function VK(e){this._context=e}VK.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:FS(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:FS(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function t1e(e){return new VK(e)}function UK(e){this._context=e}UK.prototype={areaStart:zS,areaEnd:zS,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:FS(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function r1e(e){return new UK(e)}function qK(e){this._context=e}qK.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var r=(this._x0+4*this._x1+e)/6,n=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(r,n):this._context.moveTo(r,n);break;case 3:this._point=4;default:FS(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function n1e(e){return new qK(e)}function GK(e){this._context=e}GK.prototype={areaStart:zS,areaEnd:zS,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function i1e(e){return new GK(e)}function vV(e){return e<0?-1:1}function _V(e,t,r){var n=e._x1-e._x0,a=t-e._x1,u=(e._y1-e._y0)/(n||a<0&&-0),f=(r-e._y1)/(a||n<0&&-0),i=(u*a+f*n)/(n+a);return(vV(u)+vV(f))*Math.min(Math.abs(u),Math.abs(f),.5*Math.abs(i))||0}function xV(e,t){var r=e._x1-e._x0;return r?(3*(e._y1-e._y0)/r-t)/2:t}function gP(e,t,r){var n=e._x0,a=e._y0,u=e._x1,f=e._y1,i=(u-n)/3;e._context.bezierCurveTo(n+i,a+i*t,u-i,f-i*r,u,f)}function BS(e){this._context=e}BS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:gP(this,this._t0,xV(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var r=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,gP(this,xV(this,r=_V(this,e,t)),r);break;default:gP(this,this._t0,r=_V(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=r}}};function HK(e){this._context=new WK(e)}(HK.prototype=Object.create(BS.prototype)).point=function(e,t){BS.prototype.point.call(this,t,e)};function WK(e){this._context=e}WK.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,r,n,a,u){this._context.bezierCurveTo(t,e,n,r,u,a)}};function s1e(e){return new BS(e)}function o1e(e){return new HK(e)}function ZK(e){this._context=e}ZK.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,r=e.length;if(r)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),r===2)this._context.lineTo(e[1],t[1]);else for(var n=bV(e),a=bV(t),u=0,f=1;f<r;++u,++f)this._context.bezierCurveTo(n[0][u],a[0][u],n[1][u],a[1][u],e[f],t[f]);(this._line||this._line!==0&&r===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function bV(e){var t,r=e.length-1,n,a=new Array(r),u=new Array(r),f=new Array(r);for(a[0]=0,u[0]=2,f[0]=e[0]+2*e[1],t=1;t<r-1;++t)a[t]=1,u[t]=4,f[t]=4*e[t]+2*e[t+1];for(a[r-1]=2,u[r-1]=7,f[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=a[t]/u[t-1],u[t]-=n,f[t]-=n*f[t-1];for(a[r-1]=f[r-1]/u[r-1],t=r-2;t>=0;--t)a[t]=(f[t]-a[t+1])/u[t];for(u[r-1]=(e[r]+a[r-1])/2,t=0;t<r-1;++t)u[t]=2*e[t+1]-a[t+1];return[a,u]}function a1e(e){return new ZK(e)}function g2(e,t){this._context=e,this._t=t}g2.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var r=this._x*(1-this._t)+e*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,t)}break}}this._x=e,this._y=t}};function l1e(e){return new g2(e,.5)}function c1e(e){return new g2(e,0)}function u1e(e){return new g2(e,1)}function r_(e,t){if((f=e.length)>1)for(var r=1,n,a,u=e[t[0]],f,i=u.length;r<f;++r)for(a=u,u=e[t[r]],n=0;n<i;++n)u[n][1]+=u[n][0]=isNaN(a[n][1])?a[n][0]:a[n][1]}function oL(e){for(var t=e.length,r=new Array(t);--t>=0;)r[t]=t;return r}function d1e(e,t){return e[t]}function h1e(e){const t=[];return t.key=e,t}function f1e(){var e=Gs([]),t=oL,r=r_,n=d1e;function a(u){var f=Array.from(e.apply(this,arguments),h1e),i,y=f.length,w=-1,T;for(const A of u)for(i=0,++w;i<y;++i)(f[i][w]=[0,+n(A,f[i].key,w,u)]).data=A;for(i=0,T=Kj(t(f));i<y;++i)f[T[i]].index=i;return r(f,T),f}return a.keys=function(u){return arguments.length?(e=typeof u=="function"?u:Gs(Array.from(u)),a):e},a.value=function(u){return arguments.length?(n=typeof u=="function"?u:Gs(+u),a):n},a.order=function(u){return arguments.length?(t=u==null?oL:typeof u=="function"?u:Gs(Array.from(u)),a):t},a.offset=function(u){return arguments.length?(r=u??r_,a):r},a}function p1e(e,t){if((n=e.length)>0){for(var r,n,a=0,u=e[0].length,f;a<u;++a){for(f=r=0;r<n;++r)f+=e[r][a][1]||0;if(f)for(r=0;r<n;++r)e[r][a][1]/=f}r_(e,t)}}function m1e(e,t){if((a=e.length)>0){for(var r=0,n=e[t[0]],a,u=n.length;r<u;++r){for(var f=0,i=0;f<a;++f)i+=e[f][r][1]||0;n[r][1]+=n[r][0]=-i/2}r_(e,t)}}function g1e(e,t){if(!(!((f=e.length)>0)||!((u=(a=e[t[0]]).length)>0))){for(var r=0,n=1,a,u,f;n<u;++n){for(var i=0,y=0,w=0;i<f;++i){for(var T=e[t[i]],A=T[n][1]||0,k=T[n-1][1]||0,F=(A-k)/2,D=0;D<i;++D){var O=e[t[D]],N=O[n][1]||0,V=O[n-1][1]||0;F+=N-V}y+=A,w+=F*A}a[n-1][1]+=a[n-1][0]=r,y&&(r-=w/y)}a[n-1][1]+=a[n-1][0]=r,r_(e,t)}}function Hx(e){"@babel/helpers - typeof";return Hx=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hx(e)}var y1e=["type","size","sizeType"];function aL(){return aL=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},aL.apply(this,arguments)}function wV(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function SV(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?wV(Object(r),!0).forEach(function(n){v1e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wV(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function v1e(e,t,r){return t=_1e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _1e(e){var t=x1e(e,"string");return Hx(t)=="symbol"?t:t+""}function x1e(e,t){if(Hx(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Hx(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function b1e(e,t){if(e==null)return{};var r=w1e(e,t),n,a;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(a=0;a<u.length;a++)n=u[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function w1e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var XK={symbolCircle:Yj,symbolCross:Ube,symbolDiamond:Gbe,symbolSquare:Hbe,symbolStar:Kbe,symbolTriangle:Ybe,symbolWye:Qbe},S1e=Math.PI/180,E1e=function(t){var r="symbol".concat(f2(t));return XK[r]||Yj},T1e=function(t,r,n){if(r==="area")return t;switch(n){case"cross":return 5*t*t/9;case"diamond":return .5*t*t/Math.sqrt(3);case"square":return t*t;case"star":{var a=18*S1e;return 1.25*t*t*(Math.tan(a)-Math.tan(a*2)*Math.pow(Math.tan(a),2))}case"triangle":return Math.sqrt(3)*t*t/4;case"wye":return(21-10*Math.sqrt(3))*t*t/8;default:return Math.PI*t*t/4}},C1e=function(t,r){XK["symbol".concat(f2(t))]=r},Jj=function(t){var r=t.type,n=r===void 0?"circle":r,a=t.size,u=a===void 0?64:a,f=t.sizeType,i=f===void 0?"area":f,y=b1e(t,y1e),w=SV(SV({},y),{},{type:n,size:u,sizeType:i}),T=function(){var N=E1e(n),V=e1e().type(N).size(T1e(u,i,n));return V()},A=w.className,k=w.cx,F=w.cy,D=ns(w,!0);return k===+k&&F===+F&&u===+u?jt.createElement("path",aL({},D,{className:Li("recharts-symbols",A),transform:"translate(".concat(k,", ").concat(F,")"),d:T()})):null};Jj.registerSymbol=C1e;function n_(e){"@babel/helpers - typeof";return n_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n_(e)}function lL(){return lL=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},lL.apply(this,arguments)}function EV(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function A1e(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?EV(Object(r),!0).forEach(function(n){Wx(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):EV(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function P1e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function M1e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,YK(n.key),n)}}function I1e(e,t,r){return t&&M1e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function k1e(e,t,r){return t=$S(t),O1e(e,KK()?Reflect.construct(t,r||[],$S(e).constructor):t.apply(e,r))}function O1e(e,t){if(t&&(n_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return L1e(e)}function L1e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function KK(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(KK=function(){return!!e})()}function $S(e){return $S=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},$S(e)}function R1e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&cL(e,t)}function cL(e,t){return cL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},cL(e,t)}function Wx(e,t,r){return t=YK(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function YK(e){var t=j1e(e,"string");return n_(t)=="symbol"?t:t+""}function j1e(e,t){if(n_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(n_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Vd=32,Qj=function(e){function t(){return P1e(this,t),k1e(this,t,arguments)}return R1e(t,e),I1e(t,[{key:"renderIcon",value:function(n){var a=this.props.inactiveColor,u=Vd/2,f=Vd/6,i=Vd/3,y=n.inactive?a:n.color;if(n.type==="plainline")return jt.createElement("line",{strokeWidth:4,fill:"none",stroke:y,strokeDasharray:n.payload.strokeDasharray,x1:0,y1:u,x2:Vd,y2:u,className:"recharts-legend-icon"});if(n.type==="line")return jt.createElement("path",{strokeWidth:4,fill:"none",stroke:y,d:"M0,".concat(u,"h").concat(i,`
            A`).concat(f,",").concat(f,",0,1,1,").concat(2*i,",").concat(u,`
            H`).concat(Vd,"M").concat(2*i,",").concat(u,`
            A`).concat(f,",").concat(f,",0,1,1,").concat(i,",").concat(u),className:"recharts-legend-icon"});if(n.type==="rect")return jt.createElement("path",{stroke:"none",fill:y,d:"M0,".concat(Vd/8,"h").concat(Vd,"v").concat(Vd*3/4,"h").concat(-32,"z"),className:"recharts-legend-icon"});if(jt.isValidElement(n.legendIcon)){var w=A1e({},n);return delete w.legendIcon,jt.cloneElement(n.legendIcon,w)}return jt.createElement(Jj,{fill:y,cx:u,cy:u,size:Vd,sizeType:"diameter",type:n.type})}},{key:"renderItems",value:function(){var n=this,a=this.props,u=a.payload,f=a.iconSize,i=a.layout,y=a.formatter,w=a.inactiveColor,T={x:0,y:0,width:Vd,height:Vd},A={display:i==="horizontal"?"inline-block":"block",marginRight:10},k={display:"inline-block",verticalAlign:"middle",marginRight:4};return u.map(function(F,D){var O=F.formatter||y,N=Li(Wx(Wx({"recharts-legend-item":!0},"legend-item-".concat(D),!0),"inactive",F.inactive));if(F.type==="none")return null;var V=Wi(F.value)?null:F.value;gy(!Wi(F.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var H=F.inactive?w:F.color;return jt.createElement("li",lL({className:N,style:A,key:"legend-item-".concat(D)},jS(n.props,F,D)),jt.createElement(tL,{width:f,height:f,viewBox:T,style:k},n.renderIcon(F)),jt.createElement("span",{className:"recharts-legend-item-text",style:{color:H}},O?O(V,F,D):V))})}},{key:"render",value:function(){var n=this.props,a=n.payload,u=n.layout,f=n.align;if(!a||!a.length)return null;var i={padding:0,margin:0,textAlign:u==="horizontal"?f:"left"};return jt.createElement("ul",{className:"recharts-default-legend",style:i},this.renderItems())}}])}(j.PureComponent);Wx(Qj,"displayName","Legend");Wx(Qj,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var yP,TV;function D1e(){if(TV)return yP;TV=1;var e=u2();function t(){this.__data__=new e,this.size=0}return yP=t,yP}var vP,CV;function N1e(){if(CV)return vP;CV=1;function e(t){var r=this.__data__,n=r.delete(t);return this.size=r.size,n}return vP=e,vP}var _P,AV;function z1e(){if(AV)return _P;AV=1;function e(t){return this.__data__.get(t)}return _P=e,_P}var xP,PV;function F1e(){if(PV)return xP;PV=1;function e(t){return this.__data__.has(t)}return xP=e,xP}var bP,MV;function B1e(){if(MV)return bP;MV=1;var e=u2(),t=Uj(),r=qj(),n=200;function a(u,f){var i=this.__data__;if(i instanceof e){var y=i.__data__;if(!t||y.length<n-1)return y.push([u,f]),this.size=++i.size,this;i=this.__data__=new r(y)}return i.set(u,f),this.size=i.size,this}return bP=a,bP}var wP,IV;function JK(){if(IV)return wP;IV=1;var e=u2(),t=D1e(),r=N1e(),n=z1e(),a=F1e(),u=B1e();function f(i){var y=this.__data__=new e(i);this.size=y.size}return f.prototype.clear=t,f.prototype.delete=r,f.prototype.get=n,f.prototype.has=a,f.prototype.set=u,wP=f,wP}var SP,kV;function $1e(){if(kV)return SP;kV=1;var e="__lodash_hash_undefined__";function t(r){return this.__data__.set(r,e),this}return SP=t,SP}var EP,OV;function V1e(){if(OV)return EP;OV=1;function e(t){return this.__data__.has(t)}return EP=e,EP}var TP,LV;function QK(){if(LV)return TP;LV=1;var e=qj(),t=$1e(),r=V1e();function n(a){var u=-1,f=a==null?0:a.length;for(this.__data__=new e;++u<f;)this.add(a[u])}return n.prototype.add=n.prototype.push=t,n.prototype.has=r,TP=n,TP}var CP,RV;function eY(){if(RV)return CP;RV=1;function e(t,r){for(var n=-1,a=t==null?0:t.length;++n<a;)if(r(t[n],n,t))return!0;return!1}return CP=e,CP}var AP,jV;function tY(){if(jV)return AP;jV=1;function e(t,r){return t.has(r)}return AP=e,AP}var PP,DV;function rY(){if(DV)return PP;DV=1;var e=QK(),t=eY(),r=tY(),n=1,a=2;function u(f,i,y,w,T,A){var k=y&n,F=f.length,D=i.length;if(F!=D&&!(k&&D>F))return!1;var O=A.get(f),N=A.get(i);if(O&&N)return O==i&&N==f;var V=-1,H=!0,Z=y&a?new e:void 0;for(A.set(f,i),A.set(i,f);++V<F;){var J=f[V],G=i[V];if(w)var Y=k?w(G,J,V,i,f,A):w(J,G,V,f,i,A);if(Y!==void 0){if(Y)continue;H=!1;break}if(Z){if(!t(i,function(ie,ce){if(!r(Z,ce)&&(J===ie||T(J,ie,y,w,A)))return Z.push(ce)})){H=!1;break}}else if(!(J===G||T(J,G,y,w,A))){H=!1;break}}return A.delete(f),A.delete(i),H}return PP=u,PP}var MP,NV;function U1e(){if(NV)return MP;NV=1;var e=pf(),t=e.Uint8Array;return MP=t,MP}var IP,zV;function q1e(){if(zV)return IP;zV=1;function e(t){var r=-1,n=Array(t.size);return t.forEach(function(a,u){n[++r]=[u,a]}),n}return IP=e,IP}var kP,FV;function eD(){if(FV)return kP;FV=1;function e(t){var r=-1,n=Array(t.size);return t.forEach(function(a){n[++r]=a}),n}return kP=e,kP}var OP,BV;function G1e(){if(BV)return OP;BV=1;var e=Ub(),t=U1e(),r=Vj(),n=rY(),a=q1e(),u=eD(),f=1,i=2,y="[object Boolean]",w="[object Date]",T="[object Error]",A="[object Map]",k="[object Number]",F="[object RegExp]",D="[object Set]",O="[object String]",N="[object Symbol]",V="[object ArrayBuffer]",H="[object DataView]",Z=e?e.prototype:void 0,J=Z?Z.valueOf:void 0;function G(Y,ie,ce,ge,be,xe,Le){switch(ce){case H:if(Y.byteLength!=ie.byteLength||Y.byteOffset!=ie.byteOffset)return!1;Y=Y.buffer,ie=ie.buffer;case V:return!(Y.byteLength!=ie.byteLength||!xe(new t(Y),new t(ie)));case y:case w:case k:return r(+Y,+ie);case T:return Y.name==ie.name&&Y.message==ie.message;case F:case O:return Y==ie+"";case A:var ze=a;case D:var Xe=ge&f;if(ze||(ze=u),Y.size!=ie.size&&!Xe)return!1;var Je=Le.get(Y);if(Je)return Je==ie;ge|=i,Le.set(Y,ie);var tt=n(ze(Y),ze(ie),ge,be,xe,Le);return Le.delete(Y),tt;case N:if(J)return J.call(Y)==J.call(ie)}return!1}return OP=G,OP}var LP,$V;function nY(){if($V)return LP;$V=1;function e(t,r){for(var n=-1,a=r.length,u=t.length;++n<a;)t[u+n]=r[n];return t}return LP=e,LP}var RP,VV;function H1e(){if(VV)return RP;VV=1;var e=nY(),t=Cc();function r(n,a,u){var f=a(n);return t(n)?f:e(f,u(n))}return RP=r,RP}var jP,UV;function W1e(){if(UV)return jP;UV=1;function e(t,r){for(var n=-1,a=t==null?0:t.length,u=0,f=[];++n<a;){var i=t[n];r(i,n,t)&&(f[u++]=i)}return f}return jP=e,jP}var DP,qV;function Z1e(){if(qV)return DP;qV=1;function e(){return[]}return DP=e,DP}var NP,GV;function X1e(){if(GV)return NP;GV=1;var e=W1e(),t=Z1e(),r=Object.prototype,n=r.propertyIsEnumerable,a=Object.getOwnPropertySymbols,u=a?function(f){return f==null?[]:(f=Object(f),e(a(f),function(i){return n.call(f,i)}))}:t;return NP=u,NP}var zP,HV;function K1e(){if(HV)return zP;HV=1;function e(t,r){for(var n=-1,a=Array(t);++n<t;)a[n]=r(n);return a}return zP=e,zP}var FP,WV;function Y1e(){if(WV)return FP;WV=1;var e=Pp(),t=Mp(),r="[object Arguments]";function n(a){return t(a)&&e(a)==r}return FP=n,FP}var BP,ZV;function tD(){if(ZV)return BP;ZV=1;var e=Y1e(),t=Mp(),r=Object.prototype,n=r.hasOwnProperty,a=r.propertyIsEnumerable,u=e(function(){return arguments}())?e:function(f){return t(f)&&n.call(f,"callee")&&!a.call(f,"callee")};return BP=u,BP}var lx={exports:{}},$P,XV;function J1e(){if(XV)return $P;XV=1;function e(){return!1}return $P=e,$P}lx.exports;var KV;function iY(){return KV||(KV=1,function(e,t){var r=pf(),n=J1e(),a=t&&!t.nodeType&&t,u=a&&!0&&e&&!e.nodeType&&e,f=u&&u.exports===a,i=f?r.Buffer:void 0,y=i?i.isBuffer:void 0,w=y||n;e.exports=w}(lx,lx.exports)),lx.exports}var VP,YV;function rD(){if(YV)return VP;YV=1;var e=9007199254740991,t=/^(?:0|[1-9]\d*)$/;function r(n,a){var u=typeof n;return a=a??e,!!a&&(u=="number"||u!="symbol"&&t.test(n))&&n>-1&&n%1==0&&n<a}return VP=r,VP}var UP,JV;function nD(){if(JV)return UP;JV=1;var e=9007199254740991;function t(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=e}return UP=t,UP}var qP,QV;function Q1e(){if(QV)return qP;QV=1;var e=Pp(),t=nD(),r=Mp(),n="[object Arguments]",a="[object Array]",u="[object Boolean]",f="[object Date]",i="[object Error]",y="[object Function]",w="[object Map]",T="[object Number]",A="[object Object]",k="[object RegExp]",F="[object Set]",D="[object String]",O="[object WeakMap]",N="[object ArrayBuffer]",V="[object DataView]",H="[object Float32Array]",Z="[object Float64Array]",J="[object Int8Array]",G="[object Int16Array]",Y="[object Int32Array]",ie="[object Uint8Array]",ce="[object Uint8ClampedArray]",ge="[object Uint16Array]",be="[object Uint32Array]",xe={};xe[H]=xe[Z]=xe[J]=xe[G]=xe[Y]=xe[ie]=xe[ce]=xe[ge]=xe[be]=!0,xe[n]=xe[a]=xe[N]=xe[u]=xe[V]=xe[f]=xe[i]=xe[y]=xe[w]=xe[T]=xe[A]=xe[k]=xe[F]=xe[D]=xe[O]=!1;function Le(ze){return r(ze)&&t(ze.length)&&!!xe[e(ze)]}return qP=Le,qP}var GP,eU;function sY(){if(eU)return GP;eU=1;function e(t){return function(r){return t(r)}}return GP=e,GP}var cx={exports:{}};cx.exports;var tU;function ewe(){return tU||(tU=1,function(e,t){var r=TK(),n=t&&!t.nodeType&&t,a=n&&!0&&e&&!e.nodeType&&e,u=a&&a.exports===n,f=u&&r.process,i=function(){try{var y=a&&a.require&&a.require("util").types;return y||f&&f.binding&&f.binding("util")}catch{}}();e.exports=i}(cx,cx.exports)),cx.exports}var HP,rU;function oY(){if(rU)return HP;rU=1;var e=Q1e(),t=sY(),r=ewe(),n=r&&r.isTypedArray,a=n?t(n):e;return HP=a,HP}var WP,nU;function twe(){if(nU)return WP;nU=1;var e=K1e(),t=tD(),r=Cc(),n=iY(),a=rD(),u=oY(),f=Object.prototype,i=f.hasOwnProperty;function y(w,T){var A=r(w),k=!A&&t(w),F=!A&&!k&&n(w),D=!A&&!k&&!F&&u(w),O=A||k||F||D,N=O?e(w.length,String):[],V=N.length;for(var H in w)(T||i.call(w,H))&&!(O&&(H=="length"||F&&(H=="offset"||H=="parent")||D&&(H=="buffer"||H=="byteLength"||H=="byteOffset")||a(H,V)))&&N.push(H);return N}return WP=y,WP}var ZP,iU;function rwe(){if(iU)return ZP;iU=1;var e=Object.prototype;function t(r){var n=r&&r.constructor,a=typeof n=="function"&&n.prototype||e;return r===a}return ZP=t,ZP}var XP,sU;function aY(){if(sU)return XP;sU=1;function e(t,r){return function(n){return t(r(n))}}return XP=e,XP}var KP,oU;function nwe(){if(oU)return KP;oU=1;var e=aY(),t=e(Object.keys,Object);return KP=t,KP}var YP,aU;function iwe(){if(aU)return YP;aU=1;var e=rwe(),t=nwe(),r=Object.prototype,n=r.hasOwnProperty;function a(u){if(!e(u))return t(u);var f=[];for(var i in Object(u))n.call(u,i)&&i!="constructor"&&f.push(i);return f}return YP=a,YP}var JP,lU;function Hb(){if(lU)return JP;lU=1;var e=$j(),t=nD();function r(n){return n!=null&&t(n.length)&&!e(n)}return JP=r,JP}var QP,cU;function y2(){if(cU)return QP;cU=1;var e=twe(),t=iwe(),r=Hb();function n(a){return r(a)?e(a):t(a)}return QP=n,QP}var eM,uU;function swe(){if(uU)return eM;uU=1;var e=H1e(),t=X1e(),r=y2();function n(a){return e(a,r,t)}return eM=n,eM}var tM,dU;function owe(){if(dU)return tM;dU=1;var e=swe(),t=1,r=Object.prototype,n=r.hasOwnProperty;function a(u,f,i,y,w,T){var A=i&t,k=e(u),F=k.length,D=e(f),O=D.length;if(F!=O&&!A)return!1;for(var N=F;N--;){var V=k[N];if(!(A?V in f:n.call(f,V)))return!1}var H=T.get(u),Z=T.get(f);if(H&&Z)return H==f&&Z==u;var J=!0;T.set(u,f),T.set(f,u);for(var G=A;++N<F;){V=k[N];var Y=u[V],ie=f[V];if(y)var ce=A?y(ie,Y,V,f,u,T):y(Y,ie,V,u,f,T);if(!(ce===void 0?Y===ie||w(Y,ie,i,y,T):ce)){J=!1;break}G||(G=V=="constructor")}if(J&&!G){var ge=u.constructor,be=f.constructor;ge!=be&&"constructor"in u&&"constructor"in f&&!(typeof ge=="function"&&ge instanceof ge&&typeof be=="function"&&be instanceof be)&&(J=!1)}return T.delete(u),T.delete(f),J}return tM=a,tM}var rM,hU;function awe(){if(hU)return rM;hU=1;var e=Ly(),t=pf(),r=e(t,"DataView");return rM=r,rM}var nM,fU;function lwe(){if(fU)return nM;fU=1;var e=Ly(),t=pf(),r=e(t,"Promise");return nM=r,nM}var iM,pU;function lY(){if(pU)return iM;pU=1;var e=Ly(),t=pf(),r=e(t,"Set");return iM=r,iM}var sM,mU;function cwe(){if(mU)return sM;mU=1;var e=Ly(),t=pf(),r=e(t,"WeakMap");return sM=r,sM}var oM,gU;function uwe(){if(gU)return oM;gU=1;var e=awe(),t=Uj(),r=lwe(),n=lY(),a=cwe(),u=Pp(),f=CK(),i="[object Map]",y="[object Object]",w="[object Promise]",T="[object Set]",A="[object WeakMap]",k="[object DataView]",F=f(e),D=f(t),O=f(r),N=f(n),V=f(a),H=u;return(e&&H(new e(new ArrayBuffer(1)))!=k||t&&H(new t)!=i||r&&H(r.resolve())!=w||n&&H(new n)!=T||a&&H(new a)!=A)&&(H=function(Z){var J=u(Z),G=J==y?Z.constructor:void 0,Y=G?f(G):"";if(Y)switch(Y){case F:return k;case D:return i;case O:return w;case N:return T;case V:return A}return J}),oM=H,oM}var aM,yU;function dwe(){if(yU)return aM;yU=1;var e=JK(),t=rY(),r=G1e(),n=owe(),a=uwe(),u=Cc(),f=iY(),i=oY(),y=1,w="[object Arguments]",T="[object Array]",A="[object Object]",k=Object.prototype,F=k.hasOwnProperty;function D(O,N,V,H,Z,J){var G=u(O),Y=u(N),ie=G?T:a(O),ce=Y?T:a(N);ie=ie==w?A:ie,ce=ce==w?A:ce;var ge=ie==A,be=ce==A,xe=ie==ce;if(xe&&f(O)){if(!f(N))return!1;G=!0,ge=!1}if(xe&&!ge)return J||(J=new e),G||i(O)?t(O,N,V,H,Z,J):r(O,N,ie,V,H,Z,J);if(!(V&y)){var Le=ge&&F.call(O,"__wrapped__"),ze=be&&F.call(N,"__wrapped__");if(Le||ze){var Xe=Le?O.value():O,Je=ze?N.value():N;return J||(J=new e),Z(Xe,Je,V,H,J)}}return xe?(J||(J=new e),n(O,N,V,H,Z,J)):!1}return aM=D,aM}var lM,vU;function iD(){if(vU)return lM;vU=1;var e=dwe(),t=Mp();function r(n,a,u,f,i){return n===a?!0:n==null||a==null||!t(n)&&!t(a)?n!==n&&a!==a:e(n,a,u,f,r,i)}return lM=r,lM}var cM,_U;function hwe(){if(_U)return cM;_U=1;var e=JK(),t=iD(),r=1,n=2;function a(u,f,i,y){var w=i.length,T=w,A=!y;if(u==null)return!T;for(u=Object(u);w--;){var k=i[w];if(A&&k[2]?k[1]!==u[k[0]]:!(k[0]in u))return!1}for(;++w<T;){k=i[w];var F=k[0],D=u[F],O=k[1];if(A&&k[2]){if(D===void 0&&!(F in u))return!1}else{var N=new e;if(y)var V=y(D,O,F,u,f,N);if(!(V===void 0?t(O,D,r|n,y,N):V))return!1}}return!0}return cM=a,cM}var uM,xU;function cY(){if(xU)return uM;xU=1;var e=Jm();function t(r){return r===r&&!e(r)}return uM=t,uM}var dM,bU;function fwe(){if(bU)return dM;bU=1;var e=cY(),t=y2();function r(n){for(var a=t(n),u=a.length;u--;){var f=a[u],i=n[f];a[u]=[f,i,e(i)]}return a}return dM=r,dM}var hM,wU;function uY(){if(wU)return hM;wU=1;function e(t,r){return function(n){return n==null?!1:n[t]===r&&(r!==void 0||t in Object(n))}}return hM=e,hM}var fM,SU;function pwe(){if(SU)return fM;SU=1;var e=hwe(),t=fwe(),r=uY();function n(a){var u=t(a);return u.length==1&&u[0][2]?r(u[0][0],u[0][1]):function(f){return f===a||e(f,a,u)}}return fM=n,fM}var pM,EU;function mwe(){if(EU)return pM;EU=1;function e(t,r){return t!=null&&r in Object(t)}return pM=e,pM}var mM,TU;function gwe(){if(TU)return mM;TU=1;var e=MK(),t=tD(),r=Cc(),n=rD(),a=nD(),u=h2();function f(i,y,w){y=e(y,i);for(var T=-1,A=y.length,k=!1;++T<A;){var F=u(y[T]);if(!(k=i!=null&&w(i,F)))break;i=i[F]}return k||++T!=A?k:(A=i==null?0:i.length,!!A&&a(A)&&n(F,A)&&(r(i)||t(i)))}return mM=f,mM}var gM,CU;function ywe(){if(CU)return gM;CU=1;var e=mwe(),t=gwe();function r(n,a){return n!=null&&t(n,a,e)}return gM=r,gM}var yM,AU;function vwe(){if(AU)return yM;AU=1;var e=iD(),t=IK(),r=ywe(),n=Bj(),a=cY(),u=uY(),f=h2(),i=1,y=2;function w(T,A){return n(T)&&a(A)?u(f(T),A):function(k){var F=t(k,T);return F===void 0&&F===A?r(k,T):e(A,F,i|y)}}return yM=w,yM}var vM,PU;function N_(){if(PU)return vM;PU=1;function e(t){return t}return vM=e,vM}var _M,MU;function _we(){if(MU)return _M;MU=1;function e(t){return function(r){return r==null?void 0:r[t]}}return _M=e,_M}var xM,IU;function xwe(){if(IU)return xM;IU=1;var e=Hj();function t(r){return function(n){return e(n,r)}}return xM=t,xM}var bM,kU;function bwe(){if(kU)return bM;kU=1;var e=_we(),t=xwe(),r=Bj(),n=h2();function a(u){return r(u)?e(n(u)):t(u)}return bM=a,bM}var wM,OU;function Qm(){if(OU)return wM;OU=1;var e=pwe(),t=vwe(),r=N_(),n=Cc(),a=bwe();function u(f){return typeof f=="function"?f:f==null?r:typeof f=="object"?n(f)?t(f[0],f[1]):e(f):a(f)}return wM=u,wM}var SM,LU;function dY(){if(LU)return SM;LU=1;function e(t,r,n,a){for(var u=t.length,f=n+(a?1:-1);a?f--:++f<u;)if(r(t[f],f,t))return f;return-1}return SM=e,SM}var EM,RU;function wwe(){if(RU)return EM;RU=1;function e(t){return t!==t}return EM=e,EM}var TM,jU;function Swe(){if(jU)return TM;jU=1;function e(t,r,n){for(var a=n-1,u=t.length;++a<u;)if(t[a]===r)return a;return-1}return TM=e,TM}var CM,DU;function Ewe(){if(DU)return CM;DU=1;var e=dY(),t=wwe(),r=Swe();function n(a,u,f){return u===u?r(a,u,f):e(a,t,f)}return CM=n,CM}var AM,NU;function Twe(){if(NU)return AM;NU=1;var e=Ewe();function t(r,n){var a=r==null?0:r.length;return!!a&&e(r,n,0)>-1}return AM=t,AM}var PM,zU;function Cwe(){if(zU)return PM;zU=1;function e(t,r,n){for(var a=-1,u=t==null?0:t.length;++a<u;)if(n(r,t[a]))return!0;return!1}return PM=e,PM}var MM,FU;function Awe(){if(FU)return MM;FU=1;function e(){}return MM=e,MM}var IM,BU;function Pwe(){if(BU)return IM;BU=1;var e=lY(),t=Awe(),r=eD(),n=1/0,a=e&&1/r(new e([,-0]))[1]==n?function(u){return new e(u)}:t;return IM=a,IM}var kM,$U;function Mwe(){if($U)return kM;$U=1;var e=QK(),t=Twe(),r=Cwe(),n=tY(),a=Pwe(),u=eD(),f=200;function i(y,w,T){var A=-1,k=t,F=y.length,D=!0,O=[],N=O;if(T)D=!1,k=r;else if(F>=f){var V=w?null:a(y);if(V)return u(V);D=!1,k=n,N=new e}else N=w?[]:O;e:for(;++A<F;){var H=y[A],Z=w?w(H):H;if(H=T||H!==0?H:0,D&&Z===Z){for(var J=N.length;J--;)if(N[J]===Z)continue e;w&&N.push(Z),O.push(H)}else k(N,Z,T)||(N!==O&&N.push(Z),O.push(H))}return O}return kM=i,kM}var OM,VU;function Iwe(){if(VU)return OM;VU=1;var e=Qm(),t=Mwe();function r(n,a){return n&&n.length?t(n,e(a,2)):[]}return OM=r,OM}var kwe=Iwe();const UU=vs(kwe);function hY(e,t,r){return t===!0?UU(e,r):Wi(t)?UU(e,t):e}function i_(e){"@babel/helpers - typeof";return i_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i_(e)}var Owe=["ref"];function qU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function op(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?qU(Object(r),!0).forEach(function(n){v2(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qU(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Lwe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function GU(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,pY(n.key),n)}}function Rwe(e,t,r){return t&&GU(e.prototype,t),r&&GU(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function jwe(e,t,r){return t=VS(t),Dwe(e,fY()?Reflect.construct(t,r||[],VS(e).constructor):t.apply(e,r))}function Dwe(e,t){if(t&&(i_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Nwe(e)}function Nwe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fY(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(fY=function(){return!!e})()}function VS(e){return VS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},VS(e)}function zwe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&uL(e,t)}function uL(e,t){return uL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},uL(e,t)}function v2(e,t,r){return t=pY(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function pY(e){var t=Fwe(e,"string");return i_(t)=="symbol"?t:t+""}function Fwe(e,t){if(i_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(i_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function Bwe(e,t){if(e==null)return{};var r=$we(e,t),n,a;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(a=0;a<u.length;a++)n=u[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function $we(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Vwe(e){return e.value}function Uwe(e,t){if(jt.isValidElement(e))return jt.cloneElement(e,t);if(typeof e=="function")return jt.createElement(e,t);t.ref;var r=Bwe(t,Owe);return jt.createElement(Qj,r)}var HU=1,qv=function(e){function t(){var r;Lwe(this,t);for(var n=arguments.length,a=new Array(n),u=0;u<n;u++)a[u]=arguments[u];return r=jwe(this,t,[].concat(a)),v2(r,"lastBoundingBox",{width:-1,height:-1}),r}return zwe(t,e),Rwe(t,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();return n.height=this.wrapperNode.offsetHeight,n.width=this.wrapperNode.offsetWidth,n}return null}},{key:"updateBBox",value:function(){var n=this.props.onBBoxUpdate,a=this.getBBox();a?(Math.abs(a.width-this.lastBoundingBox.width)>HU||Math.abs(a.height-this.lastBoundingBox.height)>HU)&&(this.lastBoundingBox.width=a.width,this.lastBoundingBox.height=a.height,n&&n(a)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,n&&n(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?op({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(n){var a=this.props,u=a.layout,f=a.align,i=a.verticalAlign,y=a.margin,w=a.chartWidth,T=a.chartHeight,A,k;if(!n||(n.left===void 0||n.left===null)&&(n.right===void 0||n.right===null))if(f==="center"&&u==="vertical"){var F=this.getBBoxSnapshot();A={left:((w||0)-F.width)/2}}else A=f==="right"?{right:y&&y.right||0}:{left:y&&y.left||0};if(!n||(n.top===void 0||n.top===null)&&(n.bottom===void 0||n.bottom===null))if(i==="middle"){var D=this.getBBoxSnapshot();k={top:((T||0)-D.height)/2}}else k=i==="bottom"?{bottom:y&&y.bottom||0}:{top:y&&y.top||0};return op(op({},A),k)}},{key:"render",value:function(){var n=this,a=this.props,u=a.content,f=a.width,i=a.height,y=a.wrapperStyle,w=a.payloadUniqBy,T=a.payload,A=op(op({position:"absolute",width:f||"auto",height:i||"auto"},this.getDefaultPosition(y)),y);return jt.createElement("div",{className:"recharts-legend-wrapper",style:A,ref:function(F){n.wrapperNode=F}},Uwe(u,op(op({},this.props),{},{payload:hY(T,w,Vwe)})))}}],[{key:"getWithHeight",value:function(n,a){var u=op(op({},this.defaultProps),n.props),f=u.layout;return f==="vertical"&&cn(n.props.height)?{height:n.props.height}:f==="horizontal"?{width:n.props.width||a}:null}}])}(j.PureComponent);v2(qv,"displayName","Legend");v2(qv,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var LM,WU;function qwe(){if(WU)return LM;WU=1;var e=Ub(),t=tD(),r=Cc(),n=e?e.isConcatSpreadable:void 0;function a(u){return r(u)||t(u)||!!(n&&u&&u[n])}return LM=a,LM}var RM,ZU;function mY(){if(ZU)return RM;ZU=1;var e=nY(),t=qwe();function r(n,a,u,f,i){var y=-1,w=n.length;for(u||(u=t),i||(i=[]);++y<w;){var T=n[y];a>0&&u(T)?a>1?r(T,a-1,u,f,i):e(i,T):f||(i[i.length]=T)}return i}return RM=r,RM}var jM,XU;function Gwe(){if(XU)return jM;XU=1;function e(t){return function(r,n,a){for(var u=-1,f=Object(r),i=a(r),y=i.length;y--;){var w=i[t?y:++u];if(n(f[w],w,f)===!1)break}return r}}return jM=e,jM}var DM,KU;function Hwe(){if(KU)return DM;KU=1;var e=Gwe(),t=e();return DM=t,DM}var NM,YU;function gY(){if(YU)return NM;YU=1;var e=Hwe(),t=y2();function r(n,a){return n&&e(n,a,t)}return NM=r,NM}var zM,JU;function Wwe(){if(JU)return zM;JU=1;var e=Hb();function t(r,n){return function(a,u){if(a==null)return a;if(!e(a))return r(a,u);for(var f=a.length,i=n?f:-1,y=Object(a);(n?i--:++i<f)&&u(y[i],i,y)!==!1;);return a}}return zM=t,zM}var FM,QU;function sD(){if(QU)return FM;QU=1;var e=gY(),t=Wwe(),r=t(e);return FM=r,FM}var BM,e8;function yY(){if(e8)return BM;e8=1;var e=sD(),t=Hb();function r(n,a){var u=-1,f=t(n)?Array(n.length):[];return e(n,function(i,y,w){f[++u]=a(i,y,w)}),f}return BM=r,BM}var $M,t8;function Zwe(){if(t8)return $M;t8=1;function e(t,r){var n=t.length;for(t.sort(r);n--;)t[n]=t[n].value;return t}return $M=e,$M}var VM,r8;function Xwe(){if(r8)return VM;r8=1;var e=j_();function t(r,n){if(r!==n){var a=r!==void 0,u=r===null,f=r===r,i=e(r),y=n!==void 0,w=n===null,T=n===n,A=e(n);if(!w&&!A&&!i&&r>n||i&&y&&T&&!w&&!A||u&&y&&T||!a&&T||!f)return 1;if(!u&&!i&&!A&&r<n||A&&a&&f&&!u&&!i||w&&a&&f||!y&&f||!T)return-1}return 0}return VM=t,VM}var UM,n8;function Kwe(){if(n8)return UM;n8=1;var e=Xwe();function t(r,n,a){for(var u=-1,f=r.criteria,i=n.criteria,y=f.length,w=a.length;++u<y;){var T=e(f[u],i[u]);if(T){if(u>=w)return T;var A=a[u];return T*(A=="desc"?-1:1)}}return r.index-n.index}return UM=t,UM}var qM,i8;function Ywe(){if(i8)return qM;i8=1;var e=Gj(),t=Hj(),r=Qm(),n=yY(),a=Zwe(),u=sY(),f=Kwe(),i=N_(),y=Cc();function w(T,A,k){A.length?A=e(A,function(O){return y(O)?function(N){return t(N,O.length===1?O[0]:O)}:O}):A=[i];var F=-1;A=e(A,u(r));var D=n(T,function(O,N,V){var H=e(A,function(Z){return Z(O)});return{criteria:H,index:++F,value:O}});return a(D,function(O,N){return f(O,N,k)})}return qM=w,qM}var GM,s8;function Jwe(){if(s8)return GM;s8=1;function e(t,r,n){switch(n.length){case 0:return t.call(r);case 1:return t.call(r,n[0]);case 2:return t.call(r,n[0],n[1]);case 3:return t.call(r,n[0],n[1],n[2])}return t.apply(r,n)}return GM=e,GM}var HM,o8;function Qwe(){if(o8)return HM;o8=1;var e=Jwe(),t=Math.max;function r(n,a,u){return a=t(a===void 0?n.length-1:a,0),function(){for(var f=arguments,i=-1,y=t(f.length-a,0),w=Array(y);++i<y;)w[i]=f[a+i];i=-1;for(var T=Array(a+1);++i<a;)T[i]=f[i];return T[a]=u(w),e(n,this,T)}}return HM=r,HM}var WM,a8;function eSe(){if(a8)return WM;a8=1;function e(t){return function(){return t}}return WM=e,WM}var ZM,l8;function vY(){if(l8)return ZM;l8=1;var e=Ly(),t=function(){try{var r=e(Object,"defineProperty");return r({},"",{}),r}catch{}}();return ZM=t,ZM}var XM,c8;function tSe(){if(c8)return XM;c8=1;var e=eSe(),t=vY(),r=N_(),n=t?function(a,u){return t(a,"toString",{configurable:!0,enumerable:!1,value:e(u),writable:!0})}:r;return XM=n,XM}var KM,u8;function rSe(){if(u8)return KM;u8=1;var e=800,t=16,r=Date.now;function n(a){var u=0,f=0;return function(){var i=r(),y=t-(i-f);if(f=i,y>0){if(++u>=e)return arguments[0]}else u=0;return a.apply(void 0,arguments)}}return KM=n,KM}var YM,d8;function nSe(){if(d8)return YM;d8=1;var e=tSe(),t=rSe(),r=t(e);return YM=r,YM}var JM,h8;function iSe(){if(h8)return JM;h8=1;var e=N_(),t=Qwe(),r=nSe();function n(a,u){return r(t(a,u,e),a+"")}return JM=n,JM}var QM,f8;function _2(){if(f8)return QM;f8=1;var e=Vj(),t=Hb(),r=rD(),n=Jm();function a(u,f,i){if(!n(i))return!1;var y=typeof f;return(y=="number"?t(i)&&r(f,i.length):y=="string"&&f in i)?e(i[f],u):!1}return QM=a,QM}var eI,p8;function sSe(){if(p8)return eI;p8=1;var e=mY(),t=Ywe(),r=iSe(),n=_2(),a=r(function(u,f){if(u==null)return[];var i=f.length;return i>1&&n(u,f[0],f[1])?f=[]:i>2&&n(f[0],f[1],f[2])&&(f=[f[0]]),t(u,e(f,1),[])});return eI=a,eI}var oSe=sSe();const oD=vs(oSe);function Zx(e){"@babel/helpers - typeof";return Zx=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zx(e)}function dL(){return dL=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},dL.apply(this,arguments)}function aSe(e,t){return dSe(e)||uSe(e,t)||cSe(e,t)||lSe()}function lSe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cSe(e,t){if(e){if(typeof e=="string")return m8(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return m8(e,t)}}function m8(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function uSe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,u,f,i=[],y=!0,w=!1;try{if(u=(r=r.call(e)).next,t!==0)for(;!(y=(n=u.call(r)).done)&&(i.push(n.value),i.length!==t);y=!0);}catch(T){w=!0,a=T}finally{try{if(!y&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(w)throw a}}return i}}function dSe(e){if(Array.isArray(e))return e}function g8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function tI(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?g8(Object(r),!0).forEach(function(n){hSe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g8(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function hSe(e,t,r){return t=fSe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fSe(e){var t=pSe(e,"string");return Zx(t)=="symbol"?t:t+""}function pSe(e,t){if(Zx(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Zx(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function mSe(e){return Array.isArray(e)&&_a(e[0])&&_a(e[1])?e.join(" ~ "):e}var gSe=function(t){var r=t.separator,n=r===void 0?" : ":r,a=t.contentStyle,u=a===void 0?{}:a,f=t.itemStyle,i=f===void 0?{}:f,y=t.labelStyle,w=y===void 0?{}:y,T=t.payload,A=t.formatter,k=t.itemSorter,F=t.wrapperClassName,D=t.labelClassName,O=t.label,N=t.labelFormatter,V=t.accessibilityLayer,H=V===void 0?!1:V,Z=function(){if(T&&T.length){var Le={padding:0,margin:0},ze=(k?oD(T,k):T).map(function(Xe,Je){if(Xe.type==="none")return null;var tt=tI({display:"block",paddingTop:4,paddingBottom:4,color:Xe.color||"#000"},i),st=Xe.formatter||A||mSe,Ne=Xe.value,We=Xe.name,Ue=Ne,De=We;if(st&&Ue!=null&&De!=null){var Ke=st(Ne,We,Xe,Je,T);if(Array.isArray(Ke)){var lt=aSe(Ke,2);Ue=lt[0],De=lt[1]}else Ue=Ke}return jt.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(Je),style:tt},_a(De)?jt.createElement("span",{className:"recharts-tooltip-item-name"},De):null,_a(De)?jt.createElement("span",{className:"recharts-tooltip-item-separator"},n):null,jt.createElement("span",{className:"recharts-tooltip-item-value"},Ue),jt.createElement("span",{className:"recharts-tooltip-item-unit"},Xe.unit||""))});return jt.createElement("ul",{className:"recharts-tooltip-item-list",style:Le},ze)}return null},J=tI({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},u),G=tI({margin:0},w),Y=!Zi(O),ie=Y?O:"",ce=Li("recharts-default-tooltip",F),ge=Li("recharts-tooltip-label",D);Y&&N&&T!==void 0&&T!==null&&(ie=N(O,T));var be=H?{role:"status","aria-live":"assertive"}:{};return jt.createElement("div",dL({className:ce,style:J},be),jt.createElement("p",{className:ge,style:G},jt.isValidElement(ie)?ie:"".concat(ie)),Z())};function Xx(e){"@babel/helpers - typeof";return Xx=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xx(e)}function yw(e,t,r){return t=ySe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ySe(e){var t=vSe(e,"string");return Xx(t)=="symbol"?t:t+""}function vSe(e,t){if(Xx(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Xx(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var U0="recharts-tooltip-wrapper",_Se={visibility:"hidden"};function xSe(e){var t=e.coordinate,r=e.translateX,n=e.translateY;return Li(U0,yw(yw(yw(yw({},"".concat(U0,"-right"),cn(r)&&t&&cn(t.x)&&r>=t.x),"".concat(U0,"-left"),cn(r)&&t&&cn(t.x)&&r<t.x),"".concat(U0,"-bottom"),cn(n)&&t&&cn(t.y)&&n>=t.y),"".concat(U0,"-top"),cn(n)&&t&&cn(t.y)&&n<t.y))}function y8(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.key,a=e.offsetTopLeft,u=e.position,f=e.reverseDirection,i=e.tooltipDimension,y=e.viewBox,w=e.viewBoxDimension;if(u&&cn(u[n]))return u[n];var T=r[n]-i-a,A=r[n]+a;if(t[n])return f[n]?T:A;if(f[n]){var k=T,F=y[n];return k<F?Math.max(A,y[n]):Math.max(T,y[n])}var D=A+i,O=y[n]+w;return D>O?Math.max(T,y[n]):Math.max(A,y[n])}function bSe(e){var t=e.translateX,r=e.translateY,n=e.useTranslate3d;return{transform:n?"translate3d(".concat(t,"px, ").concat(r,"px, 0)"):"translate(".concat(t,"px, ").concat(r,"px)")}}function wSe(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.offsetTopLeft,a=e.position,u=e.reverseDirection,f=e.tooltipBox,i=e.useTranslate3d,y=e.viewBox,w,T,A;return f.height>0&&f.width>0&&r?(T=y8({allowEscapeViewBox:t,coordinate:r,key:"x",offsetTopLeft:n,position:a,reverseDirection:u,tooltipDimension:f.width,viewBox:y,viewBoxDimension:y.width}),A=y8({allowEscapeViewBox:t,coordinate:r,key:"y",offsetTopLeft:n,position:a,reverseDirection:u,tooltipDimension:f.height,viewBox:y,viewBoxDimension:y.height}),w=bSe({translateX:T,translateY:A,useTranslate3d:i})):w=_Se,{cssProperties:w,cssClasses:xSe({translateX:T,translateY:A,coordinate:r})}}function s_(e){"@babel/helpers - typeof";return s_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s_(e)}function v8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function _8(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?v8(Object(r),!0).forEach(function(n){fL(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v8(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function SSe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ESe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,xY(n.key),n)}}function TSe(e,t,r){return t&&ESe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function CSe(e,t,r){return t=US(t),ASe(e,_Y()?Reflect.construct(t,r||[],US(e).constructor):t.apply(e,r))}function ASe(e,t){if(t&&(s_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return PSe(e)}function PSe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _Y(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(_Y=function(){return!!e})()}function US(e){return US=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},US(e)}function MSe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&hL(e,t)}function hL(e,t){return hL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},hL(e,t)}function fL(e,t,r){return t=xY(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function xY(e){var t=ISe(e,"string");return s_(t)=="symbol"?t:t+""}function ISe(e,t){if(s_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(s_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var x8=1,kSe=function(e){function t(){var r;SSe(this,t);for(var n=arguments.length,a=new Array(n),u=0;u<n;u++)a[u]=arguments[u];return r=CSe(this,t,[].concat(a)),fL(r,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),fL(r,"handleKeyDown",function(f){if(f.key==="Escape"){var i,y,w,T;r.setState({dismissed:!0,dismissedAtCoordinate:{x:(i=(y=r.props.coordinate)===null||y===void 0?void 0:y.x)!==null&&i!==void 0?i:0,y:(w=(T=r.props.coordinate)===null||T===void 0?void 0:T.y)!==null&&w!==void 0?w:0}})}}),r}return MSe(t,e),TSe(t,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();(Math.abs(n.width-this.state.lastBoundingBox.width)>x8||Math.abs(n.height-this.state.lastBoundingBox.height)>x8)&&this.setState({lastBoundingBox:{width:n.width,height:n.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var n,a;this.props.active&&this.updateBBox(),this.state.dismissed&&(((n=this.props.coordinate)===null||n===void 0?void 0:n.x)!==this.state.dismissedAtCoordinate.x||((a=this.props.coordinate)===null||a===void 0?void 0:a.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var n=this,a=this.props,u=a.active,f=a.allowEscapeViewBox,i=a.animationDuration,y=a.animationEasing,w=a.children,T=a.coordinate,A=a.hasPayload,k=a.isAnimationActive,F=a.offset,D=a.position,O=a.reverseDirection,N=a.useTranslate3d,V=a.viewBox,H=a.wrapperStyle,Z=wSe({allowEscapeViewBox:f,coordinate:T,offsetTopLeft:F,position:D,reverseDirection:O,tooltipBox:this.state.lastBoundingBox,useTranslate3d:N,viewBox:V}),J=Z.cssClasses,G=Z.cssProperties,Y=_8(_8({transition:k&&u?"transform ".concat(i,"ms ").concat(y):void 0},G),{},{pointerEvents:"none",visibility:!this.state.dismissed&&u&&A?"visible":"hidden",position:"absolute",top:0,left:0},H);return jt.createElement("div",{tabIndex:-1,className:J,style:Y,ref:function(ce){n.wrapperNode=ce}},w)}}])}(j.PureComponent),OSe=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},z_={isSsr:OSe()};function o_(e){"@babel/helpers - typeof";return o_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o_(e)}function b8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function w8(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?b8(Object(r),!0).forEach(function(n){aD(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b8(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function LSe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function RSe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,wY(n.key),n)}}function jSe(e,t,r){return t&&RSe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function DSe(e,t,r){return t=qS(t),NSe(e,bY()?Reflect.construct(t,r||[],qS(e).constructor):t.apply(e,r))}function NSe(e,t){if(t&&(o_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return zSe(e)}function zSe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function bY(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(bY=function(){return!!e})()}function qS(e){return qS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},qS(e)}function FSe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&pL(e,t)}function pL(e,t){return pL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},pL(e,t)}function aD(e,t,r){return t=wY(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function wY(e){var t=BSe(e,"string");return o_(t)=="symbol"?t:t+""}function BSe(e,t){if(o_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(o_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function $Se(e){return e.dataKey}function VSe(e,t){return jt.isValidElement(e)?jt.cloneElement(e,t):typeof e=="function"?jt.createElement(e,t):jt.createElement(gSe,t)}var Qh=function(e){function t(){return LSe(this,t),DSe(this,t,arguments)}return FSe(t,e),jSe(t,[{key:"render",value:function(){var n=this,a=this.props,u=a.active,f=a.allowEscapeViewBox,i=a.animationDuration,y=a.animationEasing,w=a.content,T=a.coordinate,A=a.filterNull,k=a.isAnimationActive,F=a.offset,D=a.payload,O=a.payloadUniqBy,N=a.position,V=a.reverseDirection,H=a.useTranslate3d,Z=a.viewBox,J=a.wrapperStyle,G=D??[];A&&G.length&&(G=hY(D.filter(function(ie){return ie.value!=null&&(ie.hide!==!0||n.props.includeHidden)}),O,$Se));var Y=G.length>0;return jt.createElement(kSe,{allowEscapeViewBox:f,animationDuration:i,animationEasing:y,isAnimationActive:k,active:u,coordinate:T,hasPayload:Y,offset:F,position:N,reverseDirection:V,useTranslate3d:H,viewBox:Z,wrapperStyle:J},VSe(w,w8(w8({},this.props),{},{payload:G})))}}])}(j.PureComponent);aD(Qh,"displayName","Tooltip");aD(Qh,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!z_.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var rI,S8;function USe(){if(S8)return rI;S8=1;var e=pf(),t=function(){return e.Date.now()};return rI=t,rI}var nI,E8;function qSe(){if(E8)return nI;E8=1;var e=/\s/;function t(r){for(var n=r.length;n--&&e.test(r.charAt(n)););return n}return nI=t,nI}var iI,T8;function GSe(){if(T8)return iI;T8=1;var e=qSe(),t=/^\s+/;function r(n){return n&&n.slice(0,e(n)+1).replace(t,"")}return iI=r,iI}var sI,C8;function SY(){if(C8)return sI;C8=1;var e=GSe(),t=Jm(),r=j_(),n=NaN,a=/^[-+]0x[0-9a-f]+$/i,u=/^0b[01]+$/i,f=/^0o[0-7]+$/i,i=parseInt;function y(w){if(typeof w=="number")return w;if(r(w))return n;if(t(w)){var T=typeof w.valueOf=="function"?w.valueOf():w;w=t(T)?T+"":T}if(typeof w!="string")return w===0?w:+w;w=e(w);var A=u.test(w);return A||f.test(w)?i(w.slice(2),A?2:8):a.test(w)?n:+w}return sI=y,sI}var oI,A8;function HSe(){if(A8)return oI;A8=1;var e=Jm(),t=USe(),r=SY(),n="Expected a function",a=Math.max,u=Math.min;function f(i,y,w){var T,A,k,F,D,O,N=0,V=!1,H=!1,Z=!0;if(typeof i!="function")throw new TypeError(n);y=r(y)||0,e(w)&&(V=!!w.leading,H="maxWait"in w,k=H?a(r(w.maxWait)||0,y):k,Z="trailing"in w?!!w.trailing:Z);function J(ze){var Xe=T,Je=A;return T=A=void 0,N=ze,F=i.apply(Je,Xe),F}function G(ze){return N=ze,D=setTimeout(ce,y),V?J(ze):F}function Y(ze){var Xe=ze-O,Je=ze-N,tt=y-Xe;return H?u(tt,k-Je):tt}function ie(ze){var Xe=ze-O,Je=ze-N;return O===void 0||Xe>=y||Xe<0||H&&Je>=k}function ce(){var ze=t();if(ie(ze))return ge(ze);D=setTimeout(ce,Y(ze))}function ge(ze){return D=void 0,Z&&T?J(ze):(T=A=void 0,F)}function be(){D!==void 0&&clearTimeout(D),N=0,T=O=A=D=void 0}function xe(){return D===void 0?F:ge(t())}function Le(){var ze=t(),Xe=ie(ze);if(T=arguments,A=this,O=ze,Xe){if(D===void 0)return G(O);if(H)return clearTimeout(D),D=setTimeout(ce,y),J(O)}return D===void 0&&(D=setTimeout(ce,y)),F}return Le.cancel=be,Le.flush=xe,Le}return oI=f,oI}var aI,P8;function WSe(){if(P8)return aI;P8=1;var e=HSe(),t=Jm(),r="Expected a function";function n(a,u,f){var i=!0,y=!0;if(typeof a!="function")throw new TypeError(r);return t(f)&&(i="leading"in f?!!f.leading:i,y="trailing"in f?!!f.trailing:y),e(a,u,{leading:i,maxWait:u,trailing:y})}return aI=n,aI}var ZSe=WSe();const EY=vs(ZSe);function Kx(e){"@babel/helpers - typeof";return Kx=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kx(e)}function M8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function vw(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?M8(Object(r),!0).forEach(function(n){XSe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M8(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function XSe(e,t,r){return t=KSe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function KSe(e){var t=YSe(e,"string");return Kx(t)=="symbol"?t:t+""}function YSe(e,t){if(Kx(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Kx(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function JSe(e,t){return rEe(e)||tEe(e,t)||eEe(e,t)||QSe()}function QSe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function eEe(e,t){if(e){if(typeof e=="string")return I8(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return I8(e,t)}}function I8(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function tEe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,u,f,i=[],y=!0,w=!1;try{if(u=(r=r.call(e)).next,t!==0)for(;!(y=(n=u.call(r)).done)&&(i.push(n.value),i.length!==t);y=!0);}catch(T){w=!0,a=T}finally{try{if(!y&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(w)throw a}}return i}}function rEe(e){if(Array.isArray(e))return e}var nEe=j.forwardRef(function(e,t){var r=e.aspect,n=e.initialDimension,a=n===void 0?{width:-1,height:-1}:n,u=e.width,f=u===void 0?"100%":u,i=e.height,y=i===void 0?"100%":i,w=e.minWidth,T=w===void 0?0:w,A=e.minHeight,k=e.maxHeight,F=e.children,D=e.debounce,O=D===void 0?0:D,N=e.id,V=e.className,H=e.onResize,Z=e.style,J=Z===void 0?{}:Z,G=j.useRef(null),Y=j.useRef();Y.current=H,j.useImperativeHandle(t,function(){return Object.defineProperty(G.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),G.current},configurable:!0})});var ie=j.useState({containerWidth:a.width,containerHeight:a.height}),ce=JSe(ie,2),ge=ce[0],be=ce[1],xe=j.useCallback(function(ze,Xe){be(function(Je){var tt=Math.round(ze),st=Math.round(Xe);return Je.containerWidth===tt&&Je.containerHeight===st?Je:{containerWidth:tt,containerHeight:st}})},[]);j.useEffect(function(){var ze=function(We){var Ue,De=We[0].contentRect,Ke=De.width,lt=De.height;xe(Ke,lt),(Ue=Y.current)===null||Ue===void 0||Ue.call(Y,Ke,lt)};O>0&&(ze=EY(ze,O,{trailing:!0,leading:!1}));var Xe=new ResizeObserver(ze),Je=G.current.getBoundingClientRect(),tt=Je.width,st=Je.height;return xe(tt,st),Xe.observe(G.current),function(){Xe.disconnect()}},[xe,O]);var Le=j.useMemo(function(){var ze=ge.containerWidth,Xe=ge.containerHeight;if(ze<0||Xe<0)return null;gy(cy(f)||cy(y),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,f,y),gy(!r||r>0,"The aspect(%s) must be greater than zero.",r);var Je=cy(f)?ze:f,tt=cy(y)?Xe:y;r&&r>0&&(Je?tt=Je/r:tt&&(Je=tt*r),k&&tt>k&&(tt=k)),gy(Je>0||tt>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,Je,tt,f,y,T,A,r);var st=!Array.isArray(F)&&gp(F.type).endsWith("Chart");return jt.Children.map(F,function(Ne){return jt.isValidElement(Ne)?j.cloneElement(Ne,vw({width:Je,height:tt},st?{style:vw({height:"100%",width:"100%",maxHeight:tt,maxWidth:Je},Ne.props.style)}:{})):Ne})},[r,F,y,k,A,T,ge,f]);return jt.createElement("div",{id:N?"".concat(N):void 0,className:Li("recharts-responsive-container",V),style:vw(vw({},J),{},{width:f,height:y,minWidth:T,minHeight:A,maxHeight:k}),ref:G},Le)}),TY=function(t){return null};TY.displayName="Cell";function Yx(e){"@babel/helpers - typeof";return Yx=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yx(e)}function k8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function mL(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?k8(Object(r),!0).forEach(function(n){iEe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k8(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function iEe(e,t,r){return t=sEe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function sEe(e){var t=oEe(e,"string");return Yx(t)=="symbol"?t:t+""}function oEe(e,t){if(Yx(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Yx(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var yv={widthCache:{},cacheCount:0},aEe=2e3,lEe={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},O8="recharts_measurement_span";function cEe(e){var t=mL({},e);return Object.keys(t).forEach(function(r){t[r]||delete t[r]}),t}var bx=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t==null||z_.isSsr)return{width:0,height:0};var n=cEe(r),a=JSON.stringify({text:t,copyStyle:n});if(yv.widthCache[a])return yv.widthCache[a];try{var u=document.getElementById(O8);u||(u=document.createElement("span"),u.setAttribute("id",O8),u.setAttribute("aria-hidden","true"),document.body.appendChild(u));var f=mL(mL({},lEe),n);Object.assign(u.style,f),u.textContent="".concat(t);var i=u.getBoundingClientRect(),y={width:i.width,height:i.height};return yv.widthCache[a]=y,++yv.cacheCount>aEe&&(yv.cacheCount=0,yv.widthCache={}),y}catch{return{width:0,height:0}}},uEe=function(t){return{top:t.top+window.scrollY-document.documentElement.clientTop,left:t.left+window.scrollX-document.documentElement.clientLeft}};function Jx(e){"@babel/helpers - typeof";return Jx=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jx(e)}function GS(e,t){return pEe(e)||fEe(e,t)||hEe(e,t)||dEe()}function dEe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hEe(e,t){if(e){if(typeof e=="string")return L8(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return L8(e,t)}}function L8(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function fEe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,u,f,i=[],y=!0,w=!1;try{if(u=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;y=!1}else for(;!(y=(n=u.call(r)).done)&&(i.push(n.value),i.length!==t);y=!0);}catch(T){w=!0,a=T}finally{try{if(!y&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(w)throw a}}return i}}function pEe(e){if(Array.isArray(e))return e}function mEe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function R8(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,yEe(n.key),n)}}function gEe(e,t,r){return t&&R8(e.prototype,t),r&&R8(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function yEe(e){var t=vEe(e,"string");return Jx(t)=="symbol"?t:t+""}function vEe(e,t){if(Jx(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Jx(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var j8=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,D8=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,_Ee=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,xEe=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,CY={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},bEe=Object.keys(CY),Rv="NaN";function wEe(e,t){return e*CY[t]}var _w=function(){function e(t,r){mEe(this,e),this.num=t,this.unit=r,this.num=t,this.unit=r,Number.isNaN(t)&&(this.unit=""),r!==""&&!_Ee.test(r)&&(this.num=NaN,this.unit=""),bEe.includes(r)&&(this.num=wEe(t,r),this.unit="px")}return gEe(e,[{key:"add",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num+r.num,this.unit)}},{key:"subtract",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num-r.num,this.unit)}},{key:"multiply",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num*r.num,this.unit||r.unit)}},{key:"divide",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num/r.num,this.unit||r.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(r){var n,a=(n=xEe.exec(r))!==null&&n!==void 0?n:[],u=GS(a,3),f=u[1],i=u[2];return new e(parseFloat(f),i??"")}}])}();function AY(e){if(e.includes(Rv))return Rv;for(var t=e;t.includes("*")||t.includes("/");){var r,n=(r=j8.exec(t))!==null&&r!==void 0?r:[],a=GS(n,4),u=a[1],f=a[2],i=a[3],y=_w.parse(u??""),w=_w.parse(i??""),T=f==="*"?y.multiply(w):y.divide(w);if(T.isNaN())return Rv;t=t.replace(j8,T.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var A,k=(A=D8.exec(t))!==null&&A!==void 0?A:[],F=GS(k,4),D=F[1],O=F[2],N=F[3],V=_w.parse(D??""),H=_w.parse(N??""),Z=O==="+"?V.add(H):V.subtract(H);if(Z.isNaN())return Rv;t=t.replace(D8,Z.toString())}return t}var N8=/\(([^()]*)\)/;function SEe(e){for(var t=e;t.includes("(");){var r=N8.exec(t),n=GS(r,2),a=n[1];t=t.replace(N8,AY(a))}return t}function EEe(e){var t=e.replace(/\s+/g,"");return t=SEe(t),t=AY(t),t}function TEe(e){try{return EEe(e)}catch{return Rv}}function lI(e){var t=TEe(e.slice(5,-1));return t===Rv?"":t}var CEe=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],AEe=["dx","dy","angle","className","breakAll"];function gL(){return gL=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},gL.apply(this,arguments)}function z8(e,t){if(e==null)return{};var r=PEe(e,t),n,a;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(a=0;a<u.length;a++)n=u[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function PEe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function F8(e,t){return OEe(e)||kEe(e,t)||IEe(e,t)||MEe()}function MEe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function IEe(e,t){if(e){if(typeof e=="string")return B8(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return B8(e,t)}}function B8(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function kEe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,u,f,i=[],y=!0,w=!1;try{if(u=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;y=!1}else for(;!(y=(n=u.call(r)).done)&&(i.push(n.value),i.length!==t);y=!0);}catch(T){w=!0,a=T}finally{try{if(!y&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(w)throw a}}return i}}function OEe(e){if(Array.isArray(e))return e}var PY=/[ \f\n\r\t\v\u2028\u2029]+/,MY=function(t){var r=t.children,n=t.breakAll,a=t.style;try{var u=[];Zi(r)||(n?u=r.toString().split(""):u=r.toString().split(PY));var f=u.map(function(y){return{word:y,width:bx(y,a).width}}),i=n?0:bx(" ",a).width;return{wordsWithComputedWidth:f,spaceWidth:i}}catch{return null}},LEe=function(t,r,n,a,u){var f=t.maxLines,i=t.children,y=t.style,w=t.breakAll,T=cn(f),A=i,k=function(){var Je=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return Je.reduce(function(tt,st){var Ne=st.word,We=st.width,Ue=tt[tt.length-1];if(Ue&&(a==null||u||Ue.width+We+n<Number(a)))Ue.words.push(Ne),Ue.width+=We+n;else{var De={words:[Ne],width:We};tt.push(De)}return tt},[])},F=k(r),D=function(Je){return Je.reduce(function(tt,st){return tt.width>st.width?tt:st})};if(!T)return F;for(var O="…",N=function(Je){var tt=A.slice(0,Je),st=MY({breakAll:w,style:y,children:tt+O}).wordsWithComputedWidth,Ne=k(st),We=Ne.length>f||D(Ne).width>Number(a);return[We,Ne]},V=0,H=A.length-1,Z=0,J;V<=H&&Z<=A.length-1;){var G=Math.floor((V+H)/2),Y=G-1,ie=N(Y),ce=F8(ie,2),ge=ce[0],be=ce[1],xe=N(G),Le=F8(xe,1),ze=Le[0];if(!ge&&!ze&&(V=G+1),ge&&ze&&(H=G-1),!ge&&ze){J=be;break}Z++}return J||F},$8=function(t){var r=Zi(t)?[]:t.toString().split(PY);return[{words:r}]},REe=function(t){var r=t.width,n=t.scaleToFit,a=t.children,u=t.style,f=t.breakAll,i=t.maxLines;if((r||n)&&!z_.isSsr){var y,w,T=MY({breakAll:f,children:a,style:u});if(T){var A=T.wordsWithComputedWidth,k=T.spaceWidth;y=A,w=k}else return $8(a);return LEe({breakAll:f,children:a,maxLines:i,style:u},y,w,r,n)}return $8(a)},V8="#808080",HS=function(t){var r=t.x,n=r===void 0?0:r,a=t.y,u=a===void 0?0:a,f=t.lineHeight,i=f===void 0?"1em":f,y=t.capHeight,w=y===void 0?"0.71em":y,T=t.scaleToFit,A=T===void 0?!1:T,k=t.textAnchor,F=k===void 0?"start":k,D=t.verticalAnchor,O=D===void 0?"end":D,N=t.fill,V=N===void 0?V8:N,H=z8(t,CEe),Z=j.useMemo(function(){return REe({breakAll:H.breakAll,children:H.children,maxLines:H.maxLines,scaleToFit:A,style:H.style,width:H.width})},[H.breakAll,H.children,H.maxLines,A,H.style,H.width]),J=H.dx,G=H.dy,Y=H.angle,ie=H.className,ce=H.breakAll,ge=z8(H,AEe);if(!_a(n)||!_a(u))return null;var be=n+(cn(J)?J:0),xe=u+(cn(G)?G:0),Le;switch(O){case"start":Le=lI("calc(".concat(w,")"));break;case"middle":Le=lI("calc(".concat((Z.length-1)/2," * -").concat(i," + (").concat(w," / 2))"));break;default:Le=lI("calc(".concat(Z.length-1," * -").concat(i,")"));break}var ze=[];if(A){var Xe=Z[0].width,Je=H.width;ze.push("scale(".concat((cn(Je)?Je/Xe:1)/Xe,")"))}return Y&&ze.push("rotate(".concat(Y,", ").concat(be,", ").concat(xe,")")),ze.length&&(ge.transform=ze.join(" ")),jt.createElement("text",gL({},ns(ge,!0),{x:be,y:xe,className:Li("recharts-text",ie),textAnchor:F,fill:V.includes("url")?V8:V}),Z.map(function(tt,st){var Ne=tt.words.join(ce?"":" ");return jt.createElement("tspan",{x:be,dy:st===0?Le:i,key:"".concat(Ne,"-").concat(st)},Ne)}))};function Bm(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function jEe(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function lD(e){let t,r,n;e.length!==2?(t=Bm,r=(i,y)=>Bm(e(i),y),n=(i,y)=>e(i)-y):(t=e===Bm||e===jEe?e:DEe,r=e,n=e);function a(i,y,w=0,T=i.length){if(w<T){if(t(y,y)!==0)return T;do{const A=w+T>>>1;r(i[A],y)<0?w=A+1:T=A}while(w<T)}return w}function u(i,y,w=0,T=i.length){if(w<T){if(t(y,y)!==0)return T;do{const A=w+T>>>1;r(i[A],y)<=0?w=A+1:T=A}while(w<T)}return w}function f(i,y,w=0,T=i.length){const A=a(i,y,w,T-1);return A>w&&n(i[A-1],y)>-n(i[A],y)?A-1:A}return{left:a,center:f,right:u}}function DEe(){return 0}function IY(e){return e===null?NaN:+e}function*NEe(e,t){for(let r of e)r!=null&&(r=+r)>=r&&(yield r)}const zEe=lD(Bm),Wb=zEe.right;lD(IY).center;class U8 extends Map{constructor(t,r=$Ee){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),t!=null)for(const[n,a]of t)this.set(n,a)}get(t){return super.get(q8(this,t))}has(t){return super.has(q8(this,t))}set(t,r){return super.set(FEe(this,t),r)}delete(t){return super.delete(BEe(this,t))}}function q8({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):r}function FEe({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):(e.set(n,r),r)}function BEe({_intern:e,_key:t},r){const n=t(r);return e.has(n)&&(r=e.get(n),e.delete(n)),r}function $Ee(e){return e!==null&&typeof e=="object"?e.valueOf():e}function VEe(e=Bm){if(e===Bm)return kY;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,r)=>{const n=e(t,r);return n||n===0?n:(e(r,r)===0)-(e(t,t)===0)}}function kY(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const UEe=Math.sqrt(50),qEe=Math.sqrt(10),GEe=Math.sqrt(2);function WS(e,t,r){const n=(t-e)/Math.max(0,r),a=Math.floor(Math.log10(n)),u=n/Math.pow(10,a),f=u>=UEe?10:u>=qEe?5:u>=GEe?2:1;let i,y,w;return a<0?(w=Math.pow(10,-a)/f,i=Math.round(e*w),y=Math.round(t*w),i/w<e&&++i,y/w>t&&--y,w=-w):(w=Math.pow(10,a)*f,i=Math.round(e/w),y=Math.round(t/w),i*w<e&&++i,y*w>t&&--y),y<i&&.5<=r&&r<2?WS(e,t,r*2):[i,y,w]}function yL(e,t,r){if(t=+t,e=+e,r=+r,!(r>0))return[];if(e===t)return[e];const n=t<e,[a,u,f]=n?WS(t,e,r):WS(e,t,r);if(!(u>=a))return[];const i=u-a+1,y=new Array(i);if(n)if(f<0)for(let w=0;w<i;++w)y[w]=(u-w)/-f;else for(let w=0;w<i;++w)y[w]=(u-w)*f;else if(f<0)for(let w=0;w<i;++w)y[w]=(a+w)/-f;else for(let w=0;w<i;++w)y[w]=(a+w)*f;return y}function vL(e,t,r){return t=+t,e=+e,r=+r,WS(e,t,r)[2]}function _L(e,t,r){t=+t,e=+e,r=+r;const n=t<e,a=n?vL(t,e,r):vL(e,t,r);return(n?-1:1)*(a<0?1/-a:a)}function G8(e,t){let r;for(const n of e)n!=null&&(r<n||r===void 0&&n>=n)&&(r=n);return r}function H8(e,t){let r;for(const n of e)n!=null&&(r>n||r===void 0&&n>=n)&&(r=n);return r}function OY(e,t,r=0,n=1/0,a){if(t=Math.floor(t),r=Math.floor(Math.max(0,r)),n=Math.floor(Math.min(e.length-1,n)),!(r<=t&&t<=n))return e;for(a=a===void 0?kY:VEe(a);n>r;){if(n-r>600){const y=n-r+1,w=t-r+1,T=Math.log(y),A=.5*Math.exp(2*T/3),k=.5*Math.sqrt(T*A*(y-A)/y)*(w-y/2<0?-1:1),F=Math.max(r,Math.floor(t-w*A/y+k)),D=Math.min(n,Math.floor(t+(y-w)*A/y+k));OY(e,t,F,D,a)}const u=e[t];let f=r,i=n;for(q0(e,r,t),a(e[n],u)>0&&q0(e,r,n);f<i;){for(q0(e,f,i),++f,--i;a(e[f],u)<0;)++f;for(;a(e[i],u)>0;)--i}a(e[r],u)===0?q0(e,r,i):(++i,q0(e,i,n)),i<=t&&(r=i+1),t<=i&&(n=i-1)}return e}function q0(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function HEe(e,t,r){if(e=Float64Array.from(NEe(e)),!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return H8(e);if(t>=1)return G8(e);var n,a=(n-1)*t,u=Math.floor(a),f=G8(OY(e,u).subarray(0,u+1)),i=H8(e.subarray(u+1));return f+(i-f)*(a-u)}}function WEe(e,t,r=IY){if(!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return+r(e[0],0,e);if(t>=1)return+r(e[n-1],n-1,e);var n,a=(n-1)*t,u=Math.floor(a),f=+r(e[u],u,e),i=+r(e[u+1],u+1,e);return f+(i-f)*(a-u)}}function ZEe(e,t,r){e=+e,t=+t,r=(a=arguments.length)<2?(t=e,e=0,1):a<3?1:+r;for(var n=-1,a=Math.max(0,Math.ceil((t-e)/r))|0,u=new Array(a);++n<a;)u[n]=e+n*r;return u}function ed(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Ip(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const xL=Symbol("implicit");function cD(){var e=new U8,t=[],r=[],n=xL;function a(u){let f=e.get(u);if(f===void 0){if(n!==xL)return n;e.set(u,f=t.push(u)-1)}return r[f%r.length]}return a.domain=function(u){if(!arguments.length)return t.slice();t=[],e=new U8;for(const f of u)e.has(f)||e.set(f,t.push(f)-1);return a},a.range=function(u){return arguments.length?(r=Array.from(u),a):r.slice()},a.unknown=function(u){return arguments.length?(n=u,a):n},a.copy=function(){return cD(t,r).unknown(n)},ed.apply(a,arguments),a}function Qx(){var e=cD().unknown(void 0),t=e.domain,r=e.range,n=0,a=1,u,f,i=!1,y=0,w=0,T=.5;delete e.unknown;function A(){var k=t().length,F=a<n,D=F?a:n,O=F?n:a;u=(O-D)/Math.max(1,k-y+w*2),i&&(u=Math.floor(u)),D+=(O-D-u*(k-y))*T,f=u*(1-y),i&&(D=Math.round(D),f=Math.round(f));var N=ZEe(k).map(function(V){return D+u*V});return r(F?N.reverse():N)}return e.domain=function(k){return arguments.length?(t(k),A()):t()},e.range=function(k){return arguments.length?([n,a]=k,n=+n,a=+a,A()):[n,a]},e.rangeRound=function(k){return[n,a]=k,n=+n,a=+a,i=!0,A()},e.bandwidth=function(){return f},e.step=function(){return u},e.round=function(k){return arguments.length?(i=!!k,A()):i},e.padding=function(k){return arguments.length?(y=Math.min(1,w=+k),A()):y},e.paddingInner=function(k){return arguments.length?(y=Math.min(1,k),A()):y},e.paddingOuter=function(k){return arguments.length?(w=+k,A()):w},e.align=function(k){return arguments.length?(T=Math.max(0,Math.min(1,k)),A()):T},e.copy=function(){return Qx(t(),[n,a]).round(i).paddingInner(y).paddingOuter(w).align(T)},ed.apply(A(),arguments)}function LY(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return LY(t())},e}function wx(){return LY(Qx.apply(null,arguments).paddingInner(1))}function uD(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function RY(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function Zb(){}var eb=.7,ZS=1/eb,Gv="\\s*([+-]?\\d+)\\s*",tb="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",cf="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",XEe=/^#([0-9a-f]{3,8})$/,KEe=new RegExp(`^rgb\\(${Gv},${Gv},${Gv}\\)$`),YEe=new RegExp(`^rgb\\(${cf},${cf},${cf}\\)$`),JEe=new RegExp(`^rgba\\(${Gv},${Gv},${Gv},${tb}\\)$`),QEe=new RegExp(`^rgba\\(${cf},${cf},${cf},${tb}\\)$`),e2e=new RegExp(`^hsl\\(${tb},${cf},${cf}\\)$`),t2e=new RegExp(`^hsla\\(${tb},${cf},${cf},${tb}\\)$`),W8={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};uD(Zb,rb,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Z8,formatHex:Z8,formatHex8:r2e,formatHsl:n2e,formatRgb:X8,toString:X8});function Z8(){return this.rgb().formatHex()}function r2e(){return this.rgb().formatHex8()}function n2e(){return jY(this).formatHsl()}function X8(){return this.rgb().formatRgb()}function rb(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=XEe.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?K8(t):r===3?new xc(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?xw(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?xw(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=KEe.exec(e))?new xc(t[1],t[2],t[3],1):(t=YEe.exec(e))?new xc(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=JEe.exec(e))?xw(t[1],t[2],t[3],t[4]):(t=QEe.exec(e))?xw(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=e2e.exec(e))?Q8(t[1],t[2]/100,t[3]/100,1):(t=t2e.exec(e))?Q8(t[1],t[2]/100,t[3]/100,t[4]):W8.hasOwnProperty(e)?K8(W8[e]):e==="transparent"?new xc(NaN,NaN,NaN,0):null}function K8(e){return new xc(e>>16&255,e>>8&255,e&255,1)}function xw(e,t,r,n){return n<=0&&(e=t=r=NaN),new xc(e,t,r,n)}function i2e(e){return e instanceof Zb||(e=rb(e)),e?(e=e.rgb(),new xc(e.r,e.g,e.b,e.opacity)):new xc}function bL(e,t,r,n){return arguments.length===1?i2e(e):new xc(e,t,r,n??1)}function xc(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}uD(xc,bL,RY(Zb,{brighter(e){return e=e==null?ZS:Math.pow(ZS,e),new xc(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?eb:Math.pow(eb,e),new xc(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new xc(yy(this.r),yy(this.g),yy(this.b),XS(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Y8,formatHex:Y8,formatHex8:s2e,formatRgb:J8,toString:J8}));function Y8(){return`#${uy(this.r)}${uy(this.g)}${uy(this.b)}`}function s2e(){return`#${uy(this.r)}${uy(this.g)}${uy(this.b)}${uy((isNaN(this.opacity)?1:this.opacity)*255)}`}function J8(){const e=XS(this.opacity);return`${e===1?"rgb(":"rgba("}${yy(this.r)}, ${yy(this.g)}, ${yy(this.b)}${e===1?")":`, ${e})`}`}function XS(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function yy(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function uy(e){return e=yy(e),(e<16?"0":"")+e.toString(16)}function Q8(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new Zd(e,t,r,n)}function jY(e){if(e instanceof Zd)return new Zd(e.h,e.s,e.l,e.opacity);if(e instanceof Zb||(e=rb(e)),!e)return new Zd;if(e instanceof Zd)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,a=Math.min(t,r,n),u=Math.max(t,r,n),f=NaN,i=u-a,y=(u+a)/2;return i?(t===u?f=(r-n)/i+(r<n)*6:r===u?f=(n-t)/i+2:f=(t-r)/i+4,i/=y<.5?u+a:2-u-a,f*=60):i=y>0&&y<1?0:f,new Zd(f,i,y,e.opacity)}function o2e(e,t,r,n){return arguments.length===1?jY(e):new Zd(e,t,r,n??1)}function Zd(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}uD(Zd,o2e,RY(Zb,{brighter(e){return e=e==null?ZS:Math.pow(ZS,e),new Zd(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?eb:Math.pow(eb,e),new Zd(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,a=2*r-n;return new xc(cI(e>=240?e-240:e+120,a,n),cI(e,a,n),cI(e<120?e+240:e-120,a,n),this.opacity)},clamp(){return new Zd(eq(this.h),bw(this.s),bw(this.l),XS(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=XS(this.opacity);return`${e===1?"hsl(":"hsla("}${eq(this.h)}, ${bw(this.s)*100}%, ${bw(this.l)*100}%${e===1?")":`, ${e})`}`}}));function eq(e){return e=(e||0)%360,e<0?e+360:e}function bw(e){return Math.max(0,Math.min(1,e||0))}function cI(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}const dD=e=>()=>e;function a2e(e,t){return function(r){return e+r*t}}function l2e(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function c2e(e){return(e=+e)==1?DY:function(t,r){return r-t?l2e(t,r,e):dD(isNaN(t)?r:t)}}function DY(e,t){var r=t-e;return r?a2e(e,r):dD(isNaN(e)?t:e)}const tq=function e(t){var r=c2e(t);function n(a,u){var f=r((a=bL(a)).r,(u=bL(u)).r),i=r(a.g,u.g),y=r(a.b,u.b),w=DY(a.opacity,u.opacity);return function(T){return a.r=f(T),a.g=i(T),a.b=y(T),a.opacity=w(T),a+""}}return n.gamma=e,n}(1);function u2e(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),a;return function(u){for(a=0;a<r;++a)n[a]=e[a]*(1-u)+t[a]*u;return n}}function d2e(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function h2e(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,a=new Array(n),u=new Array(r),f;for(f=0;f<n;++f)a[f]=F_(e[f],t[f]);for(;f<r;++f)u[f]=t[f];return function(i){for(f=0;f<n;++f)u[f]=a[f](i);return u}}function f2e(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function KS(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function p2e(e,t){var r={},n={},a;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(a in t)a in e?r[a]=F_(e[a],t[a]):n[a]=t[a];return function(u){for(a in r)n[a]=r[a](u);return n}}var wL=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,uI=new RegExp(wL.source,"g");function m2e(e){return function(){return e}}function g2e(e){return function(t){return e(t)+""}}function y2e(e,t){var r=wL.lastIndex=uI.lastIndex=0,n,a,u,f=-1,i=[],y=[];for(e=e+"",t=t+"";(n=wL.exec(e))&&(a=uI.exec(t));)(u=a.index)>r&&(u=t.slice(r,u),i[f]?i[f]+=u:i[++f]=u),(n=n[0])===(a=a[0])?i[f]?i[f]+=a:i[++f]=a:(i[++f]=null,y.push({i:f,x:KS(n,a)})),r=uI.lastIndex;return r<t.length&&(u=t.slice(r),i[f]?i[f]+=u:i[++f]=u),i.length<2?y[0]?g2e(y[0].x):m2e(t):(t=y.length,function(w){for(var T=0,A;T<t;++T)i[(A=y[T]).i]=A.x(w);return i.join("")})}function F_(e,t){var r=typeof t,n;return t==null||r==="boolean"?dD(t):(r==="number"?KS:r==="string"?(n=rb(t))?(t=n,tq):y2e:t instanceof rb?tq:t instanceof Date?f2e:d2e(t)?u2e:Array.isArray(t)?h2e:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?p2e:KS)(e,t)}function hD(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function v2e(e,t){t===void 0&&(t=e,e=F_);for(var r=0,n=t.length-1,a=t[0],u=new Array(n<0?0:n);r<n;)u[r]=e(a,a=t[++r]);return function(f){var i=Math.max(0,Math.min(n-1,Math.floor(f*=n)));return u[i](f-i)}}function _2e(e){return function(){return e}}function YS(e){return+e}var rq=[0,1];function Bl(e){return e}function SL(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:_2e(isNaN(t)?NaN:.5)}function x2e(e,t){var r;return e>t&&(r=e,e=t,t=r),function(n){return Math.max(e,Math.min(t,n))}}function b2e(e,t,r){var n=e[0],a=e[1],u=t[0],f=t[1];return a<n?(n=SL(a,n),u=r(f,u)):(n=SL(n,a),u=r(u,f)),function(i){return u(n(i))}}function w2e(e,t,r){var n=Math.min(e.length,t.length)-1,a=new Array(n),u=new Array(n),f=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++f<n;)a[f]=SL(e[f],e[f+1]),u[f]=r(t[f],t[f+1]);return function(i){var y=Wb(e,i,1,n)-1;return u[y](a[y](i))}}function Xb(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function x2(){var e=rq,t=rq,r=F_,n,a,u,f=Bl,i,y,w;function T(){var k=Math.min(e.length,t.length);return f!==Bl&&(f=x2e(e[0],e[k-1])),i=k>2?w2e:b2e,y=w=null,A}function A(k){return k==null||isNaN(k=+k)?u:(y||(y=i(e.map(n),t,r)))(n(f(k)))}return A.invert=function(k){return f(a((w||(w=i(t,e.map(n),KS)))(k)))},A.domain=function(k){return arguments.length?(e=Array.from(k,YS),T()):e.slice()},A.range=function(k){return arguments.length?(t=Array.from(k),T()):t.slice()},A.rangeRound=function(k){return t=Array.from(k),r=hD,T()},A.clamp=function(k){return arguments.length?(f=k?!0:Bl,T()):f!==Bl},A.interpolate=function(k){return arguments.length?(r=k,T()):r},A.unknown=function(k){return arguments.length?(u=k,A):u},function(k,F){return n=k,a=F,T()}}function fD(){return x2()(Bl,Bl)}function S2e(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function JS(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function a_(e){return e=JS(Math.abs(e)),e?e[1]:NaN}function E2e(e,t){return function(r,n){for(var a=r.length,u=[],f=0,i=e[0],y=0;a>0&&i>0&&(y+i+1>n&&(i=Math.max(1,n-y)),u.push(r.substring(a-=i,a+i)),!((y+=i+1)>n));)i=e[f=(f+1)%e.length];return u.reverse().join(t)}}function T2e(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var C2e=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function nb(e){if(!(t=C2e.exec(e)))throw new Error("invalid format: "+e);var t;return new pD({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}nb.prototype=pD.prototype;function pD(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}pD.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function A2e(e){e:for(var t=e.length,r=1,n=-1,a;r<t;++r)switch(e[r]){case".":n=a=r;break;case"0":n===0&&(n=r),a=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(a+1):e}var NY;function P2e(e,t){var r=JS(e,t);if(!r)return e+"";var n=r[0],a=r[1],u=a-(NY=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,f=n.length;return u===f?n:u>f?n+new Array(u-f+1).join("0"):u>0?n.slice(0,u)+"."+n.slice(u):"0."+new Array(1-u).join("0")+JS(e,Math.max(0,t+u-1))[0]}function nq(e,t){var r=JS(e,t);if(!r)return e+"";var n=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+n:n.length>a+1?n.slice(0,a+1)+"."+n.slice(a+1):n+new Array(a-n.length+2).join("0")}const iq={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:S2e,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>nq(e*100,t),r:nq,s:P2e,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function sq(e){return e}var oq=Array.prototype.map,aq=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function M2e(e){var t=e.grouping===void 0||e.thousands===void 0?sq:E2e(oq.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",a=e.decimal===void 0?".":e.decimal+"",u=e.numerals===void 0?sq:T2e(oq.call(e.numerals,String)),f=e.percent===void 0?"%":e.percent+"",i=e.minus===void 0?"−":e.minus+"",y=e.nan===void 0?"NaN":e.nan+"";function w(A){A=nb(A);var k=A.fill,F=A.align,D=A.sign,O=A.symbol,N=A.zero,V=A.width,H=A.comma,Z=A.precision,J=A.trim,G=A.type;G==="n"?(H=!0,G="g"):iq[G]||(Z===void 0&&(Z=12),J=!0,G="g"),(N||k==="0"&&F==="=")&&(N=!0,k="0",F="=");var Y=O==="$"?r:O==="#"&&/[boxX]/.test(G)?"0"+G.toLowerCase():"",ie=O==="$"?n:/[%p]/.test(G)?f:"",ce=iq[G],ge=/[defgprs%]/.test(G);Z=Z===void 0?6:/[gprs]/.test(G)?Math.max(1,Math.min(21,Z)):Math.max(0,Math.min(20,Z));function be(xe){var Le=Y,ze=ie,Xe,Je,tt;if(G==="c")ze=ce(xe)+ze,xe="";else{xe=+xe;var st=xe<0||1/xe<0;if(xe=isNaN(xe)?y:ce(Math.abs(xe),Z),J&&(xe=A2e(xe)),st&&+xe==0&&D!=="+"&&(st=!1),Le=(st?D==="("?D:i:D==="-"||D==="("?"":D)+Le,ze=(G==="s"?aq[8+NY/3]:"")+ze+(st&&D==="("?")":""),ge){for(Xe=-1,Je=xe.length;++Xe<Je;)if(tt=xe.charCodeAt(Xe),48>tt||tt>57){ze=(tt===46?a+xe.slice(Xe+1):xe.slice(Xe))+ze,xe=xe.slice(0,Xe);break}}}H&&!N&&(xe=t(xe,1/0));var Ne=Le.length+xe.length+ze.length,We=Ne<V?new Array(V-Ne+1).join(k):"";switch(H&&N&&(xe=t(We+xe,We.length?V-ze.length:1/0),We=""),F){case"<":xe=Le+xe+ze+We;break;case"=":xe=Le+We+xe+ze;break;case"^":xe=We.slice(0,Ne=We.length>>1)+Le+xe+ze+We.slice(Ne);break;default:xe=We+Le+xe+ze;break}return u(xe)}return be.toString=function(){return A+""},be}function T(A,k){var F=w((A=nb(A),A.type="f",A)),D=Math.max(-8,Math.min(8,Math.floor(a_(k)/3)))*3,O=Math.pow(10,-D),N=aq[8+D/3];return function(V){return F(O*V)+N}}return{format:w,formatPrefix:T}}var ww,mD,zY;I2e({thousands:",",grouping:[3],currency:["$",""]});function I2e(e){return ww=M2e(e),mD=ww.format,zY=ww.formatPrefix,ww}function k2e(e){return Math.max(0,-a_(Math.abs(e)))}function O2e(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(a_(t)/3)))*3-a_(Math.abs(e)))}function L2e(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,a_(t)-a_(e))+1}function FY(e,t,r,n){var a=_L(e,t,r),u;switch(n=nb(n??",f"),n.type){case"s":{var f=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(u=O2e(a,f))&&(n.precision=u),zY(n,f)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(u=L2e(a,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=u-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(u=k2e(a))&&(n.precision=u-(n.type==="%")*2);break}}return mD(n)}function eg(e){var t=e.domain;return e.ticks=function(r){var n=t();return yL(n[0],n[n.length-1],r??10)},e.tickFormat=function(r,n){var a=t();return FY(a[0],a[a.length-1],r??10,n)},e.nice=function(r){r==null&&(r=10);var n=t(),a=0,u=n.length-1,f=n[a],i=n[u],y,w,T=10;for(i<f&&(w=f,f=i,i=w,w=a,a=u,u=w);T-- >0;){if(w=vL(f,i,r),w===y)return n[a]=f,n[u]=i,t(n);if(w>0)f=Math.floor(f/w)*w,i=Math.ceil(i/w)*w;else if(w<0)f=Math.ceil(f*w)/w,i=Math.floor(i*w)/w;else break;y=w}return e},e}function QS(){var e=fD();return e.copy=function(){return Xb(e,QS())},ed.apply(e,arguments),eg(e)}function BY(e){var t;function r(n){return n==null||isNaN(n=+n)?t:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Array.from(n,YS),r):e.slice()},r.unknown=function(n){return arguments.length?(t=n,r):t},r.copy=function(){return BY(e).unknown(t)},e=arguments.length?Array.from(e,YS):[0,1],eg(r)}function $Y(e,t){e=e.slice();var r=0,n=e.length-1,a=e[r],u=e[n],f;return u<a&&(f=r,r=n,n=f,f=a,a=u,u=f),e[r]=t.floor(a),e[n]=t.ceil(u),e}function lq(e){return Math.log(e)}function cq(e){return Math.exp(e)}function R2e(e){return-Math.log(-e)}function j2e(e){return-Math.exp(-e)}function D2e(e){return isFinite(e)?+("1e"+e):e<0?0:e}function N2e(e){return e===10?D2e:e===Math.E?Math.exp:t=>Math.pow(e,t)}function z2e(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function uq(e){return(t,r)=>-e(-t,r)}function gD(e){const t=e(lq,cq),r=t.domain;let n=10,a,u;function f(){return a=z2e(n),u=N2e(n),r()[0]<0?(a=uq(a),u=uq(u),e(R2e,j2e)):e(lq,cq),t}return t.base=function(i){return arguments.length?(n=+i,f()):n},t.domain=function(i){return arguments.length?(r(i),f()):r()},t.ticks=i=>{const y=r();let w=y[0],T=y[y.length-1];const A=T<w;A&&([w,T]=[T,w]);let k=a(w),F=a(T),D,O;const N=i==null?10:+i;let V=[];if(!(n%1)&&F-k<N){if(k=Math.floor(k),F=Math.ceil(F),w>0){for(;k<=F;++k)for(D=1;D<n;++D)if(O=k<0?D/u(-k):D*u(k),!(O<w)){if(O>T)break;V.push(O)}}else for(;k<=F;++k)for(D=n-1;D>=1;--D)if(O=k>0?D/u(-k):D*u(k),!(O<w)){if(O>T)break;V.push(O)}V.length*2<N&&(V=yL(w,T,N))}else V=yL(k,F,Math.min(F-k,N)).map(u);return A?V.reverse():V},t.tickFormat=(i,y)=>{if(i==null&&(i=10),y==null&&(y=n===10?"s":","),typeof y!="function"&&(!(n%1)&&(y=nb(y)).precision==null&&(y.trim=!0),y=mD(y)),i===1/0)return y;const w=Math.max(1,n*i/t.ticks().length);return T=>{let A=T/u(Math.round(a(T)));return A*n<n-.5&&(A*=n),A<=w?y(T):""}},t.nice=()=>r($Y(r(),{floor:i=>u(Math.floor(a(i))),ceil:i=>u(Math.ceil(a(i)))})),t}function VY(){const e=gD(x2()).domain([1,10]);return e.copy=()=>Xb(e,VY()).base(e.base()),ed.apply(e,arguments),e}function dq(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function hq(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function yD(e){var t=1,r=e(dq(t),hq(t));return r.constant=function(n){return arguments.length?e(dq(t=+n),hq(t)):t},eg(r)}function UY(){var e=yD(x2());return e.copy=function(){return Xb(e,UY()).constant(e.constant())},ed.apply(e,arguments)}function fq(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function F2e(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function B2e(e){return e<0?-e*e:e*e}function vD(e){var t=e(Bl,Bl),r=1;function n(){return r===1?e(Bl,Bl):r===.5?e(F2e,B2e):e(fq(r),fq(1/r))}return t.exponent=function(a){return arguments.length?(r=+a,n()):r},eg(t)}function _D(){var e=vD(x2());return e.copy=function(){return Xb(e,_D()).exponent(e.exponent())},ed.apply(e,arguments),e}function $2e(){return _D.apply(null,arguments).exponent(.5)}function pq(e){return Math.sign(e)*e*e}function V2e(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function qY(){var e=fD(),t=[0,1],r=!1,n;function a(u){var f=V2e(e(u));return isNaN(f)?n:r?Math.round(f):f}return a.invert=function(u){return e.invert(pq(u))},a.domain=function(u){return arguments.length?(e.domain(u),a):e.domain()},a.range=function(u){return arguments.length?(e.range((t=Array.from(u,YS)).map(pq)),a):t.slice()},a.rangeRound=function(u){return a.range(u).round(!0)},a.round=function(u){return arguments.length?(r=!!u,a):r},a.clamp=function(u){return arguments.length?(e.clamp(u),a):e.clamp()},a.unknown=function(u){return arguments.length?(n=u,a):n},a.copy=function(){return qY(e.domain(),t).round(r).clamp(e.clamp()).unknown(n)},ed.apply(a,arguments),eg(a)}function GY(){var e=[],t=[],r=[],n;function a(){var f=0,i=Math.max(1,t.length);for(r=new Array(i-1);++f<i;)r[f-1]=WEe(e,f/i);return u}function u(f){return f==null||isNaN(f=+f)?n:t[Wb(r,f)]}return u.invertExtent=function(f){var i=t.indexOf(f);return i<0?[NaN,NaN]:[i>0?r[i-1]:e[0],i<r.length?r[i]:e[e.length-1]]},u.domain=function(f){if(!arguments.length)return e.slice();e=[];for(let i of f)i!=null&&!isNaN(i=+i)&&e.push(i);return e.sort(Bm),a()},u.range=function(f){return arguments.length?(t=Array.from(f),a()):t.slice()},u.unknown=function(f){return arguments.length?(n=f,u):n},u.quantiles=function(){return r.slice()},u.copy=function(){return GY().domain(e).range(t).unknown(n)},ed.apply(u,arguments)}function HY(){var e=0,t=1,r=1,n=[.5],a=[0,1],u;function f(y){return y!=null&&y<=y?a[Wb(n,y,0,r)]:u}function i(){var y=-1;for(n=new Array(r);++y<r;)n[y]=((y+1)*t-(y-r)*e)/(r+1);return f}return f.domain=function(y){return arguments.length?([e,t]=y,e=+e,t=+t,i()):[e,t]},f.range=function(y){return arguments.length?(r=(a=Array.from(y)).length-1,i()):a.slice()},f.invertExtent=function(y){var w=a.indexOf(y);return w<0?[NaN,NaN]:w<1?[e,n[0]]:w>=r?[n[r-1],t]:[n[w-1],n[w]]},f.unknown=function(y){return arguments.length&&(u=y),f},f.thresholds=function(){return n.slice()},f.copy=function(){return HY().domain([e,t]).range(a).unknown(u)},ed.apply(eg(f),arguments)}function WY(){var e=[.5],t=[0,1],r,n=1;function a(u){return u!=null&&u<=u?t[Wb(e,u,0,n)]:r}return a.domain=function(u){return arguments.length?(e=Array.from(u),n=Math.min(e.length,t.length-1),a):e.slice()},a.range=function(u){return arguments.length?(t=Array.from(u),n=Math.min(e.length,t.length-1),a):t.slice()},a.invertExtent=function(u){var f=t.indexOf(u);return[e[f-1],e[f]]},a.unknown=function(u){return arguments.length?(r=u,a):r},a.copy=function(){return WY().domain(e).range(t).unknown(r)},ed.apply(a,arguments)}const dI=new Date,hI=new Date;function ba(e,t,r,n){function a(u){return e(u=arguments.length===0?new Date:new Date(+u)),u}return a.floor=u=>(e(u=new Date(+u)),u),a.ceil=u=>(e(u=new Date(u-1)),t(u,1),e(u),u),a.round=u=>{const f=a(u),i=a.ceil(u);return u-f<i-u?f:i},a.offset=(u,f)=>(t(u=new Date(+u),f==null?1:Math.floor(f)),u),a.range=(u,f,i)=>{const y=[];if(u=a.ceil(u),i=i==null?1:Math.floor(i),!(u<f)||!(i>0))return y;let w;do y.push(w=new Date(+u)),t(u,i),e(u);while(w<u&&u<f);return y},a.filter=u=>ba(f=>{if(f>=f)for(;e(f),!u(f);)f.setTime(f-1)},(f,i)=>{if(f>=f)if(i<0)for(;++i<=0;)for(;t(f,-1),!u(f););else for(;--i>=0;)for(;t(f,1),!u(f););}),r&&(a.count=(u,f)=>(dI.setTime(+u),hI.setTime(+f),e(dI),e(hI),Math.floor(r(dI,hI))),a.every=u=>(u=Math.floor(u),!isFinite(u)||!(u>0)?null:u>1?a.filter(n?f=>n(f)%u===0:f=>a.count(0,f)%u===0):a)),a}const eE=ba(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);eE.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?ba(t=>{t.setTime(Math.floor(t/e)*e)},(t,r)=>{t.setTime(+t+r*e)},(t,r)=>(r-t)/e):eE);eE.range;const dp=1e3,Zu=dp*60,hp=Zu*60,wp=hp*24,xD=wp*7,mq=wp*30,fI=wp*365,dy=ba(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*dp)},(e,t)=>(t-e)/dp,e=>e.getUTCSeconds());dy.range;const bD=ba(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*dp)},(e,t)=>{e.setTime(+e+t*Zu)},(e,t)=>(t-e)/Zu,e=>e.getMinutes());bD.range;const wD=ba(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*Zu)},(e,t)=>(t-e)/Zu,e=>e.getUTCMinutes());wD.range;const SD=ba(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*dp-e.getMinutes()*Zu)},(e,t)=>{e.setTime(+e+t*hp)},(e,t)=>(t-e)/hp,e=>e.getHours());SD.range;const ED=ba(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*hp)},(e,t)=>(t-e)/hp,e=>e.getUTCHours());ED.range;const Kb=ba(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Zu)/wp,e=>e.getDate()-1);Kb.range;const b2=ba(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/wp,e=>e.getUTCDate()-1);b2.range;const ZY=ba(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/wp,e=>Math.floor(e/wp));ZY.range;function Ry(e){return ba(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,r)=>{t.setDate(t.getDate()+r*7)},(t,r)=>(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*Zu)/xD)}const w2=Ry(0),tE=Ry(1),U2e=Ry(2),q2e=Ry(3),l_=Ry(4),G2e=Ry(5),H2e=Ry(6);w2.range;tE.range;U2e.range;q2e.range;l_.range;G2e.range;H2e.range;function jy(e){return ba(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCDate(t.getUTCDate()+r*7)},(t,r)=>(r-t)/xD)}const S2=jy(0),rE=jy(1),W2e=jy(2),Z2e=jy(3),c_=jy(4),X2e=jy(5),K2e=jy(6);S2.range;rE.range;W2e.range;Z2e.range;c_.range;X2e.range;K2e.range;const TD=ba(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());TD.range;const CD=ba(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());CD.range;const Sp=ba(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());Sp.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:ba(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,r)=>{t.setFullYear(t.getFullYear()+r*e)});Sp.range;const Ep=ba(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());Ep.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:ba(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCFullYear(t.getUTCFullYear()+r*e)});Ep.range;function XY(e,t,r,n,a,u){const f=[[dy,1,dp],[dy,5,5*dp],[dy,15,15*dp],[dy,30,30*dp],[u,1,Zu],[u,5,5*Zu],[u,15,15*Zu],[u,30,30*Zu],[a,1,hp],[a,3,3*hp],[a,6,6*hp],[a,12,12*hp],[n,1,wp],[n,2,2*wp],[r,1,xD],[t,1,mq],[t,3,3*mq],[e,1,fI]];function i(w,T,A){const k=T<w;k&&([w,T]=[T,w]);const F=A&&typeof A.range=="function"?A:y(w,T,A),D=F?F.range(w,+T+1):[];return k?D.reverse():D}function y(w,T,A){const k=Math.abs(T-w)/A,F=lD(([,,N])=>N).right(f,k);if(F===f.length)return e.every(_L(w/fI,T/fI,A));if(F===0)return eE.every(Math.max(_L(w,T,A),1));const[D,O]=f[k/f[F-1][2]<f[F][2]/k?F-1:F];return D.every(O)}return[i,y]}const[Y2e,J2e]=XY(Ep,CD,S2,ZY,ED,wD),[Q2e,eTe]=XY(Sp,TD,w2,Kb,SD,bD);function pI(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function mI(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function G0(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function tTe(e){var t=e.dateTime,r=e.date,n=e.time,a=e.periods,u=e.days,f=e.shortDays,i=e.months,y=e.shortMonths,w=H0(a),T=W0(a),A=H0(u),k=W0(u),F=H0(f),D=W0(f),O=H0(i),N=W0(i),V=H0(y),H=W0(y),Z={a:st,A:Ne,b:We,B:Ue,c:null,d:bq,e:bq,f:ETe,g:RTe,G:DTe,H:bTe,I:wTe,j:STe,L:KY,m:TTe,M:CTe,p:De,q:Ke,Q:Eq,s:Tq,S:ATe,u:PTe,U:MTe,V:ITe,w:kTe,W:OTe,x:null,X:null,y:LTe,Y:jTe,Z:NTe,"%":Sq},J={a:lt,A:Ye,b:Ve,B:Et,c:null,d:wq,e:wq,f:$Te,g:YTe,G:QTe,H:zTe,I:FTe,j:BTe,L:JY,m:VTe,M:UTe,p:kt,q:Wt,Q:Eq,s:Tq,S:qTe,u:GTe,U:HTe,V:WTe,w:ZTe,W:XTe,x:null,X:null,y:KTe,Y:JTe,Z:eCe,"%":Sq},G={a:be,A:xe,b:Le,B:ze,c:Xe,d:_q,e:_q,f:yTe,g:vq,G:yq,H:xq,I:xq,j:fTe,L:gTe,m:hTe,M:pTe,p:ge,q:dTe,Q:_Te,s:xTe,S:mTe,u:oTe,U:aTe,V:lTe,w:sTe,W:cTe,x:Je,X:tt,y:vq,Y:yq,Z:uTe,"%":vTe};Z.x=Y(r,Z),Z.X=Y(n,Z),Z.c=Y(t,Z),J.x=Y(r,J),J.X=Y(n,J),J.c=Y(t,J);function Y(Tt,Ht){return function(ur){var Jt=[],Rt=-1,Dt=0,sr=Tt.length,mr,Vr,rn;for(ur instanceof Date||(ur=new Date(+ur));++Rt<sr;)Tt.charCodeAt(Rt)===37&&(Jt.push(Tt.slice(Dt,Rt)),(Vr=gq[mr=Tt.charAt(++Rt)])!=null?mr=Tt.charAt(++Rt):Vr=mr==="e"?" ":"0",(rn=Ht[mr])&&(mr=rn(ur,Vr)),Jt.push(mr),Dt=Rt+1);return Jt.push(Tt.slice(Dt,Rt)),Jt.join("")}}function ie(Tt,Ht){return function(ur){var Jt=G0(1900,void 0,1),Rt=ce(Jt,Tt,ur+="",0),Dt,sr;if(Rt!=ur.length)return null;if("Q"in Jt)return new Date(Jt.Q);if("s"in Jt)return new Date(Jt.s*1e3+("L"in Jt?Jt.L:0));if(Ht&&!("Z"in Jt)&&(Jt.Z=0),"p"in Jt&&(Jt.H=Jt.H%12+Jt.p*12),Jt.m===void 0&&(Jt.m="q"in Jt?Jt.q:0),"V"in Jt){if(Jt.V<1||Jt.V>53)return null;"w"in Jt||(Jt.w=1),"Z"in Jt?(Dt=mI(G0(Jt.y,0,1)),sr=Dt.getUTCDay(),Dt=sr>4||sr===0?rE.ceil(Dt):rE(Dt),Dt=b2.offset(Dt,(Jt.V-1)*7),Jt.y=Dt.getUTCFullYear(),Jt.m=Dt.getUTCMonth(),Jt.d=Dt.getUTCDate()+(Jt.w+6)%7):(Dt=pI(G0(Jt.y,0,1)),sr=Dt.getDay(),Dt=sr>4||sr===0?tE.ceil(Dt):tE(Dt),Dt=Kb.offset(Dt,(Jt.V-1)*7),Jt.y=Dt.getFullYear(),Jt.m=Dt.getMonth(),Jt.d=Dt.getDate()+(Jt.w+6)%7)}else("W"in Jt||"U"in Jt)&&("w"in Jt||(Jt.w="u"in Jt?Jt.u%7:"W"in Jt?1:0),sr="Z"in Jt?mI(G0(Jt.y,0,1)).getUTCDay():pI(G0(Jt.y,0,1)).getDay(),Jt.m=0,Jt.d="W"in Jt?(Jt.w+6)%7+Jt.W*7-(sr+5)%7:Jt.w+Jt.U*7-(sr+6)%7);return"Z"in Jt?(Jt.H+=Jt.Z/100|0,Jt.M+=Jt.Z%100,mI(Jt)):pI(Jt)}}function ce(Tt,Ht,ur,Jt){for(var Rt=0,Dt=Ht.length,sr=ur.length,mr,Vr;Rt<Dt;){if(Jt>=sr)return-1;if(mr=Ht.charCodeAt(Rt++),mr===37){if(mr=Ht.charAt(Rt++),Vr=G[mr in gq?Ht.charAt(Rt++):mr],!Vr||(Jt=Vr(Tt,ur,Jt))<0)return-1}else if(mr!=ur.charCodeAt(Jt++))return-1}return Jt}function ge(Tt,Ht,ur){var Jt=w.exec(Ht.slice(ur));return Jt?(Tt.p=T.get(Jt[0].toLowerCase()),ur+Jt[0].length):-1}function be(Tt,Ht,ur){var Jt=F.exec(Ht.slice(ur));return Jt?(Tt.w=D.get(Jt[0].toLowerCase()),ur+Jt[0].length):-1}function xe(Tt,Ht,ur){var Jt=A.exec(Ht.slice(ur));return Jt?(Tt.w=k.get(Jt[0].toLowerCase()),ur+Jt[0].length):-1}function Le(Tt,Ht,ur){var Jt=V.exec(Ht.slice(ur));return Jt?(Tt.m=H.get(Jt[0].toLowerCase()),ur+Jt[0].length):-1}function ze(Tt,Ht,ur){var Jt=O.exec(Ht.slice(ur));return Jt?(Tt.m=N.get(Jt[0].toLowerCase()),ur+Jt[0].length):-1}function Xe(Tt,Ht,ur){return ce(Tt,t,Ht,ur)}function Je(Tt,Ht,ur){return ce(Tt,r,Ht,ur)}function tt(Tt,Ht,ur){return ce(Tt,n,Ht,ur)}function st(Tt){return f[Tt.getDay()]}function Ne(Tt){return u[Tt.getDay()]}function We(Tt){return y[Tt.getMonth()]}function Ue(Tt){return i[Tt.getMonth()]}function De(Tt){return a[+(Tt.getHours()>=12)]}function Ke(Tt){return 1+~~(Tt.getMonth()/3)}function lt(Tt){return f[Tt.getUTCDay()]}function Ye(Tt){return u[Tt.getUTCDay()]}function Ve(Tt){return y[Tt.getUTCMonth()]}function Et(Tt){return i[Tt.getUTCMonth()]}function kt(Tt){return a[+(Tt.getUTCHours()>=12)]}function Wt(Tt){return 1+~~(Tt.getUTCMonth()/3)}return{format:function(Tt){var Ht=Y(Tt+="",Z);return Ht.toString=function(){return Tt},Ht},parse:function(Tt){var Ht=ie(Tt+="",!1);return Ht.toString=function(){return Tt},Ht},utcFormat:function(Tt){var Ht=Y(Tt+="",J);return Ht.toString=function(){return Tt},Ht},utcParse:function(Tt){var Ht=ie(Tt+="",!0);return Ht.toString=function(){return Tt},Ht}}}var gq={"-":"",_:" ",0:"0"},Ma=/^\s*\d+/,rTe=/^%/,nTe=/[\\^$*+?|[\]().{}]/g;function ps(e,t,r){var n=e<0?"-":"",a=(n?-e:e)+"",u=a.length;return n+(u<r?new Array(r-u+1).join(t)+a:a)}function iTe(e){return e.replace(nTe,"\\$&")}function H0(e){return new RegExp("^(?:"+e.map(iTe).join("|")+")","i")}function W0(e){return new Map(e.map((t,r)=>[t.toLowerCase(),r]))}function sTe(e,t,r){var n=Ma.exec(t.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function oTe(e,t,r){var n=Ma.exec(t.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function aTe(e,t,r){var n=Ma.exec(t.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function lTe(e,t,r){var n=Ma.exec(t.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function cTe(e,t,r){var n=Ma.exec(t.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function yq(e,t,r){var n=Ma.exec(t.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function vq(e,t,r){var n=Ma.exec(t.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function uTe(e,t,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function dTe(e,t,r){var n=Ma.exec(t.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function hTe(e,t,r){var n=Ma.exec(t.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function _q(e,t,r){var n=Ma.exec(t.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function fTe(e,t,r){var n=Ma.exec(t.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function xq(e,t,r){var n=Ma.exec(t.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function pTe(e,t,r){var n=Ma.exec(t.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function mTe(e,t,r){var n=Ma.exec(t.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function gTe(e,t,r){var n=Ma.exec(t.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function yTe(e,t,r){var n=Ma.exec(t.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function vTe(e,t,r){var n=rTe.exec(t.slice(r,r+1));return n?r+n[0].length:-1}function _Te(e,t,r){var n=Ma.exec(t.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function xTe(e,t,r){var n=Ma.exec(t.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function bq(e,t){return ps(e.getDate(),t,2)}function bTe(e,t){return ps(e.getHours(),t,2)}function wTe(e,t){return ps(e.getHours()%12||12,t,2)}function STe(e,t){return ps(1+Kb.count(Sp(e),e),t,3)}function KY(e,t){return ps(e.getMilliseconds(),t,3)}function ETe(e,t){return KY(e,t)+"000"}function TTe(e,t){return ps(e.getMonth()+1,t,2)}function CTe(e,t){return ps(e.getMinutes(),t,2)}function ATe(e,t){return ps(e.getSeconds(),t,2)}function PTe(e){var t=e.getDay();return t===0?7:t}function MTe(e,t){return ps(w2.count(Sp(e)-1,e),t,2)}function YY(e){var t=e.getDay();return t>=4||t===0?l_(e):l_.ceil(e)}function ITe(e,t){return e=YY(e),ps(l_.count(Sp(e),e)+(Sp(e).getDay()===4),t,2)}function kTe(e){return e.getDay()}function OTe(e,t){return ps(tE.count(Sp(e)-1,e),t,2)}function LTe(e,t){return ps(e.getFullYear()%100,t,2)}function RTe(e,t){return e=YY(e),ps(e.getFullYear()%100,t,2)}function jTe(e,t){return ps(e.getFullYear()%1e4,t,4)}function DTe(e,t){var r=e.getDay();return e=r>=4||r===0?l_(e):l_.ceil(e),ps(e.getFullYear()%1e4,t,4)}function NTe(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+ps(t/60|0,"0",2)+ps(t%60,"0",2)}function wq(e,t){return ps(e.getUTCDate(),t,2)}function zTe(e,t){return ps(e.getUTCHours(),t,2)}function FTe(e,t){return ps(e.getUTCHours()%12||12,t,2)}function BTe(e,t){return ps(1+b2.count(Ep(e),e),t,3)}function JY(e,t){return ps(e.getUTCMilliseconds(),t,3)}function $Te(e,t){return JY(e,t)+"000"}function VTe(e,t){return ps(e.getUTCMonth()+1,t,2)}function UTe(e,t){return ps(e.getUTCMinutes(),t,2)}function qTe(e,t){return ps(e.getUTCSeconds(),t,2)}function GTe(e){var t=e.getUTCDay();return t===0?7:t}function HTe(e,t){return ps(S2.count(Ep(e)-1,e),t,2)}function QY(e){var t=e.getUTCDay();return t>=4||t===0?c_(e):c_.ceil(e)}function WTe(e,t){return e=QY(e),ps(c_.count(Ep(e),e)+(Ep(e).getUTCDay()===4),t,2)}function ZTe(e){return e.getUTCDay()}function XTe(e,t){return ps(rE.count(Ep(e)-1,e),t,2)}function KTe(e,t){return ps(e.getUTCFullYear()%100,t,2)}function YTe(e,t){return e=QY(e),ps(e.getUTCFullYear()%100,t,2)}function JTe(e,t){return ps(e.getUTCFullYear()%1e4,t,4)}function QTe(e,t){var r=e.getUTCDay();return e=r>=4||r===0?c_(e):c_.ceil(e),ps(e.getUTCFullYear()%1e4,t,4)}function eCe(){return"+0000"}function Sq(){return"%"}function Eq(e){return+e}function Tq(e){return Math.floor(+e/1e3)}var vv,eJ,tJ;tCe({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function tCe(e){return vv=tTe(e),eJ=vv.format,vv.parse,tJ=vv.utcFormat,vv.utcParse,vv}function rCe(e){return new Date(e)}function nCe(e){return e instanceof Date?+e:+new Date(+e)}function AD(e,t,r,n,a,u,f,i,y,w){var T=fD(),A=T.invert,k=T.domain,F=w(".%L"),D=w(":%S"),O=w("%I:%M"),N=w("%I %p"),V=w("%a %d"),H=w("%b %d"),Z=w("%B"),J=w("%Y");function G(Y){return(y(Y)<Y?F:i(Y)<Y?D:f(Y)<Y?O:u(Y)<Y?N:n(Y)<Y?a(Y)<Y?V:H:r(Y)<Y?Z:J)(Y)}return T.invert=function(Y){return new Date(A(Y))},T.domain=function(Y){return arguments.length?k(Array.from(Y,nCe)):k().map(rCe)},T.ticks=function(Y){var ie=k();return e(ie[0],ie[ie.length-1],Y??10)},T.tickFormat=function(Y,ie){return ie==null?G:w(ie)},T.nice=function(Y){var ie=k();return(!Y||typeof Y.range!="function")&&(Y=t(ie[0],ie[ie.length-1],Y??10)),Y?k($Y(ie,Y)):T},T.copy=function(){return Xb(T,AD(e,t,r,n,a,u,f,i,y,w))},T}function iCe(){return ed.apply(AD(Q2e,eTe,Sp,TD,w2,Kb,SD,bD,dy,eJ).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function sCe(){return ed.apply(AD(Y2e,J2e,Ep,CD,S2,b2,ED,wD,dy,tJ).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function E2(){var e=0,t=1,r,n,a,u,f=Bl,i=!1,y;function w(A){return A==null||isNaN(A=+A)?y:f(a===0?.5:(A=(u(A)-r)*a,i?Math.max(0,Math.min(1,A)):A))}w.domain=function(A){return arguments.length?([e,t]=A,r=u(e=+e),n=u(t=+t),a=r===n?0:1/(n-r),w):[e,t]},w.clamp=function(A){return arguments.length?(i=!!A,w):i},w.interpolator=function(A){return arguments.length?(f=A,w):f};function T(A){return function(k){var F,D;return arguments.length?([F,D]=k,f=A(F,D),w):[f(0),f(1)]}}return w.range=T(F_),w.rangeRound=T(hD),w.unknown=function(A){return arguments.length?(y=A,w):y},function(A){return u=A,r=A(e),n=A(t),a=r===n?0:1/(n-r),w}}function tg(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function rJ(){var e=eg(E2()(Bl));return e.copy=function(){return tg(e,rJ())},Ip.apply(e,arguments)}function nJ(){var e=gD(E2()).domain([1,10]);return e.copy=function(){return tg(e,nJ()).base(e.base())},Ip.apply(e,arguments)}function iJ(){var e=yD(E2());return e.copy=function(){return tg(e,iJ()).constant(e.constant())},Ip.apply(e,arguments)}function PD(){var e=vD(E2());return e.copy=function(){return tg(e,PD()).exponent(e.exponent())},Ip.apply(e,arguments)}function oCe(){return PD.apply(null,arguments).exponent(.5)}function sJ(){var e=[],t=Bl;function r(n){if(n!=null&&!isNaN(n=+n))return t((Wb(e,n,1)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(let a of n)a!=null&&!isNaN(a=+a)&&e.push(a);return e.sort(Bm),r},r.interpolator=function(n){return arguments.length?(t=n,r):t},r.range=function(){return e.map((n,a)=>t(a/(e.length-1)))},r.quantiles=function(n){return Array.from({length:n+1},(a,u)=>HEe(e,u/n))},r.copy=function(){return sJ(t).domain(e)},Ip.apply(r,arguments)}function T2(){var e=0,t=.5,r=1,n=1,a,u,f,i,y,w=Bl,T,A=!1,k;function F(O){return isNaN(O=+O)?k:(O=.5+((O=+T(O))-u)*(n*O<n*u?i:y),w(A?Math.max(0,Math.min(1,O)):O))}F.domain=function(O){return arguments.length?([e,t,r]=O,a=T(e=+e),u=T(t=+t),f=T(r=+r),i=a===u?0:.5/(u-a),y=u===f?0:.5/(f-u),n=u<a?-1:1,F):[e,t,r]},F.clamp=function(O){return arguments.length?(A=!!O,F):A},F.interpolator=function(O){return arguments.length?(w=O,F):w};function D(O){return function(N){var V,H,Z;return arguments.length?([V,H,Z]=N,w=v2e(O,[V,H,Z]),F):[w(0),w(.5),w(1)]}}return F.range=D(F_),F.rangeRound=D(hD),F.unknown=function(O){return arguments.length?(k=O,F):k},function(O){return T=O,a=O(e),u=O(t),f=O(r),i=a===u?0:.5/(u-a),y=u===f?0:.5/(f-u),n=u<a?-1:1,F}}function oJ(){var e=eg(T2()(Bl));return e.copy=function(){return tg(e,oJ())},Ip.apply(e,arguments)}function aJ(){var e=gD(T2()).domain([.1,1,10]);return e.copy=function(){return tg(e,aJ()).base(e.base())},Ip.apply(e,arguments)}function lJ(){var e=yD(T2());return e.copy=function(){return tg(e,lJ()).constant(e.constant())},Ip.apply(e,arguments)}function MD(){var e=vD(T2());return e.copy=function(){return tg(e,MD()).exponent(e.exponent())},Ip.apply(e,arguments)}function aCe(){return MD.apply(null,arguments).exponent(.5)}const Cq=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:Qx,scaleDiverging:oJ,scaleDivergingLog:aJ,scaleDivergingPow:MD,scaleDivergingSqrt:aCe,scaleDivergingSymlog:lJ,scaleIdentity:BY,scaleImplicit:xL,scaleLinear:QS,scaleLog:VY,scaleOrdinal:cD,scalePoint:wx,scalePow:_D,scaleQuantile:GY,scaleQuantize:HY,scaleRadial:qY,scaleSequential:rJ,scaleSequentialLog:nJ,scaleSequentialPow:PD,scaleSequentialQuantile:sJ,scaleSequentialSqrt:oCe,scaleSequentialSymlog:iJ,scaleSqrt:$2e,scaleSymlog:UY,scaleThreshold:WY,scaleTime:iCe,scaleUtc:sCe,tickFormat:FY},Symbol.toStringTag,{value:"Module"}));var gI,Aq;function cJ(){if(Aq)return gI;Aq=1;var e=j_();function t(r,n,a){for(var u=-1,f=r.length;++u<f;){var i=r[u],y=n(i);if(y!=null&&(w===void 0?y===y&&!e(y):a(y,w)))var w=y,T=i}return T}return gI=t,gI}var yI,Pq;function lCe(){if(Pq)return yI;Pq=1;function e(t,r){return t>r}return yI=e,yI}var vI,Mq;function cCe(){if(Mq)return vI;Mq=1;var e=cJ(),t=lCe(),r=N_();function n(a){return a&&a.length?e(a,r,t):void 0}return vI=n,vI}var uCe=cCe();const C2=vs(uCe);var _I,Iq;function dCe(){if(Iq)return _I;Iq=1;function e(t,r){return t<r}return _I=e,_I}var xI,kq;function hCe(){if(kq)return xI;kq=1;var e=cJ(),t=dCe(),r=N_();function n(a){return a&&a.length?e(a,r,t):void 0}return xI=n,xI}var fCe=hCe();const A2=vs(fCe);var bI,Oq;function pCe(){if(Oq)return bI;Oq=1;var e=Gj(),t=Qm(),r=yY(),n=Cc();function a(u,f){var i=n(u)?e:r;return i(u,t(f,3))}return bI=a,bI}var wI,Lq;function mCe(){if(Lq)return wI;Lq=1;var e=mY(),t=pCe();function r(n,a){return e(t(n,a),1)}return wI=r,wI}var gCe=mCe();const yCe=vs(gCe);var SI,Rq;function vCe(){if(Rq)return SI;Rq=1;var e=iD();function t(r,n){return e(r,n)}return SI=t,SI}var _Ce=vCe();const P2=vs(_Ce);var B_=1e9,xCe={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},kD,co=!0,Yu="[DecimalError] ",vy=Yu+"Invalid argument: ",ID=Yu+"Exponent out of range: ",$_=Math.floor,iy=Math.pow,bCe=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,su,Aa=1e7,Xs=7,uJ=9007199254740991,nE=$_(uJ/Xs),En={};En.absoluteValue=En.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};En.comparedTo=En.cmp=function(e){var t,r,n,a,u=this;if(e=new u.constructor(e),u.s!==e.s)return u.s||-e.s;if(u.e!==e.e)return u.e>e.e^u.s<0?1:-1;for(n=u.d.length,a=e.d.length,t=0,r=n<a?n:a;t<r;++t)if(u.d[t]!==e.d[t])return u.d[t]>e.d[t]^u.s<0?1:-1;return n===a?0:n>a^u.s<0?1:-1};En.decimalPlaces=En.dp=function(){var e=this,t=e.d.length-1,r=(t-e.e)*Xs;if(t=e.d[t],t)for(;t%10==0;t/=10)r--;return r<0?0:r};En.dividedBy=En.div=function(e){return yp(this,new this.constructor(e))};En.dividedToIntegerBy=En.idiv=function(e){var t=this,r=t.constructor;return zs(yp(t,new r(e),0,1),r.precision)};En.equals=En.eq=function(e){return!this.cmp(e)};En.exponent=function(){return ia(this)};En.greaterThan=En.gt=function(e){return this.cmp(e)>0};En.greaterThanOrEqualTo=En.gte=function(e){return this.cmp(e)>=0};En.isInteger=En.isint=function(){return this.e>this.d.length-2};En.isNegative=En.isneg=function(){return this.s<0};En.isPositive=En.ispos=function(){return this.s>0};En.isZero=function(){return this.s===0};En.lessThan=En.lt=function(e){return this.cmp(e)<0};En.lessThanOrEqualTo=En.lte=function(e){return this.cmp(e)<1};En.logarithm=En.log=function(e){var t,r=this,n=r.constructor,a=n.precision,u=a+5;if(e===void 0)e=new n(10);else if(e=new n(e),e.s<1||e.eq(su))throw Error(Yu+"NaN");if(r.s<1)throw Error(Yu+(r.s?"NaN":"-Infinity"));return r.eq(su)?new n(0):(co=!1,t=yp(ib(r,u),ib(e,u),u),co=!0,zs(t,a))};En.minus=En.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?fJ(t,e):dJ(t,(e.s=-e.s,e))};En.modulo=En.mod=function(e){var t,r=this,n=r.constructor,a=n.precision;if(e=new n(e),!e.s)throw Error(Yu+"NaN");return r.s?(co=!1,t=yp(r,e,0,1).times(e),co=!0,r.minus(t)):zs(new n(r),a)};En.naturalExponential=En.exp=function(){return hJ(this)};En.naturalLogarithm=En.ln=function(){return ib(this)};En.negated=En.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};En.plus=En.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?dJ(t,e):fJ(t,(e.s=-e.s,e))};En.precision=En.sd=function(e){var t,r,n,a=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(vy+e);if(t=ia(a)+1,n=a.d.length-1,r=n*Xs+1,n=a.d[n],n){for(;n%10==0;n/=10)r--;for(n=a.d[0];n>=10;n/=10)r++}return e&&t>r?t:r};En.squareRoot=En.sqrt=function(){var e,t,r,n,a,u,f,i=this,y=i.constructor;if(i.s<1){if(!i.s)return new y(0);throw Error(Yu+"NaN")}for(e=ia(i),co=!1,a=Math.sqrt(+i),a==0||a==1/0?(t=nf(i.d),(t.length+e)%2==0&&(t+="0"),a=Math.sqrt(t),e=$_((e+1)/2)-(e<0||e%2),a==1/0?t="5e"+e:(t=a.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),n=new y(t)):n=new y(a.toString()),r=y.precision,a=f=r+3;;)if(u=n,n=u.plus(yp(i,u,f+2)).times(.5),nf(u.d).slice(0,f)===(t=nf(n.d)).slice(0,f)){if(t=t.slice(f-3,f+1),a==f&&t=="4999"){if(zs(u,r+1,0),u.times(u).eq(i)){n=u;break}}else if(t!="9999")break;f+=4}return co=!0,zs(n,r)};En.times=En.mul=function(e){var t,r,n,a,u,f,i,y,w,T=this,A=T.constructor,k=T.d,F=(e=new A(e)).d;if(!T.s||!e.s)return new A(0);for(e.s*=T.s,r=T.e+e.e,y=k.length,w=F.length,y<w&&(u=k,k=F,F=u,f=y,y=w,w=f),u=[],f=y+w,n=f;n--;)u.push(0);for(n=w;--n>=0;){for(t=0,a=y+n;a>n;)i=u[a]+F[n]*k[a-n-1]+t,u[a--]=i%Aa|0,t=i/Aa|0;u[a]=(u[a]+t)%Aa|0}for(;!u[--f];)u.pop();return t?++r:u.shift(),e.d=u,e.e=r,co?zs(e,A.precision):e};En.toDecimalPlaces=En.todp=function(e,t){var r=this,n=r.constructor;return r=new n(r),e===void 0?r:(hf(e,0,B_),t===void 0?t=n.rounding:hf(t,0,8),zs(r,e+ia(r)+1,t))};En.toExponential=function(e,t){var r,n=this,a=n.constructor;return e===void 0?r=Ay(n,!0):(hf(e,0,B_),t===void 0?t=a.rounding:hf(t,0,8),n=zs(new a(n),e+1,t),r=Ay(n,!0,e+1)),r};En.toFixed=function(e,t){var r,n,a=this,u=a.constructor;return e===void 0?Ay(a):(hf(e,0,B_),t===void 0?t=u.rounding:hf(t,0,8),n=zs(new u(a),e+ia(a)+1,t),r=Ay(n.abs(),!1,e+ia(n)+1),a.isneg()&&!a.isZero()?"-"+r:r)};En.toInteger=En.toint=function(){var e=this,t=e.constructor;return zs(new t(e),ia(e)+1,t.rounding)};En.toNumber=function(){return+this};En.toPower=En.pow=function(e){var t,r,n,a,u,f,i=this,y=i.constructor,w=12,T=+(e=new y(e));if(!e.s)return new y(su);if(i=new y(i),!i.s){if(e.s<1)throw Error(Yu+"Infinity");return i}if(i.eq(su))return i;if(n=y.precision,e.eq(su))return zs(i,n);if(t=e.e,r=e.d.length-1,f=t>=r,u=i.s,f){if((r=T<0?-T:T)<=uJ){for(a=new y(su),t=Math.ceil(n/Xs+4),co=!1;r%2&&(a=a.times(i),Dq(a.d,t)),r=$_(r/2),r!==0;)i=i.times(i),Dq(i.d,t);return co=!0,e.s<0?new y(su).div(a):zs(a,n)}}else if(u<0)throw Error(Yu+"NaN");return u=u<0&&e.d[Math.max(t,r)]&1?-1:1,i.s=1,co=!1,a=e.times(ib(i,n+w)),co=!0,a=hJ(a),a.s=u,a};En.toPrecision=function(e,t){var r,n,a=this,u=a.constructor;return e===void 0?(r=ia(a),n=Ay(a,r<=u.toExpNeg||r>=u.toExpPos)):(hf(e,1,B_),t===void 0?t=u.rounding:hf(t,0,8),a=zs(new u(a),e,t),r=ia(a),n=Ay(a,e<=r||r<=u.toExpNeg,e)),n};En.toSignificantDigits=En.tosd=function(e,t){var r=this,n=r.constructor;return e===void 0?(e=n.precision,t=n.rounding):(hf(e,1,B_),t===void 0?t=n.rounding:hf(t,0,8)),zs(new n(r),e,t)};En.toString=En.valueOf=En.val=En.toJSON=En[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=ia(e),r=e.constructor;return Ay(e,t<=r.toExpNeg||t>=r.toExpPos)};function dJ(e,t){var r,n,a,u,f,i,y,w,T=e.constructor,A=T.precision;if(!e.s||!t.s)return t.s||(t=new T(e)),co?zs(t,A):t;if(y=e.d,w=t.d,f=e.e,a=t.e,y=y.slice(),u=f-a,u){for(u<0?(n=y,u=-u,i=w.length):(n=w,a=f,i=y.length),f=Math.ceil(A/Xs),i=f>i?f+1:i+1,u>i&&(u=i,n.length=1),n.reverse();u--;)n.push(0);n.reverse()}for(i=y.length,u=w.length,i-u<0&&(u=i,n=w,w=y,y=n),r=0;u;)r=(y[--u]=y[u]+w[u]+r)/Aa|0,y[u]%=Aa;for(r&&(y.unshift(r),++a),i=y.length;y[--i]==0;)y.pop();return t.d=y,t.e=a,co?zs(t,A):t}function hf(e,t,r){if(e!==~~e||e<t||e>r)throw Error(vy+e)}function nf(e){var t,r,n,a=e.length-1,u="",f=e[0];if(a>0){for(u+=f,t=1;t<a;t++)n=e[t]+"",r=Xs-n.length,r&&(u+=km(r)),u+=n;f=e[t],n=f+"",r=Xs-n.length,r&&(u+=km(r))}else if(f===0)return"0";for(;f%10===0;)f/=10;return u+f}var yp=function(){function e(n,a){var u,f=0,i=n.length;for(n=n.slice();i--;)u=n[i]*a+f,n[i]=u%Aa|0,f=u/Aa|0;return f&&n.unshift(f),n}function t(n,a,u,f){var i,y;if(u!=f)y=u>f?1:-1;else for(i=y=0;i<u;i++)if(n[i]!=a[i]){y=n[i]>a[i]?1:-1;break}return y}function r(n,a,u){for(var f=0;u--;)n[u]-=f,f=n[u]<a[u]?1:0,n[u]=f*Aa+n[u]-a[u];for(;!n[0]&&n.length>1;)n.shift()}return function(n,a,u,f){var i,y,w,T,A,k,F,D,O,N,V,H,Z,J,G,Y,ie,ce,ge=n.constructor,be=n.s==a.s?1:-1,xe=n.d,Le=a.d;if(!n.s)return new ge(n);if(!a.s)throw Error(Yu+"Division by zero");for(y=n.e-a.e,ie=Le.length,G=xe.length,F=new ge(be),D=F.d=[],w=0;Le[w]==(xe[w]||0);)++w;if(Le[w]>(xe[w]||0)&&--y,u==null?H=u=ge.precision:f?H=u+(ia(n)-ia(a))+1:H=u,H<0)return new ge(0);if(H=H/Xs+2|0,w=0,ie==1)for(T=0,Le=Le[0],H++;(w<G||T)&&H--;w++)Z=T*Aa+(xe[w]||0),D[w]=Z/Le|0,T=Z%Le|0;else{for(T=Aa/(Le[0]+1)|0,T>1&&(Le=e(Le,T),xe=e(xe,T),ie=Le.length,G=xe.length),J=ie,O=xe.slice(0,ie),N=O.length;N<ie;)O[N++]=0;ce=Le.slice(),ce.unshift(0),Y=Le[0],Le[1]>=Aa/2&&++Y;do T=0,i=t(Le,O,ie,N),i<0?(V=O[0],ie!=N&&(V=V*Aa+(O[1]||0)),T=V/Y|0,T>1?(T>=Aa&&(T=Aa-1),A=e(Le,T),k=A.length,N=O.length,i=t(A,O,k,N),i==1&&(T--,r(A,ie<k?ce:Le,k))):(T==0&&(i=T=1),A=Le.slice()),k=A.length,k<N&&A.unshift(0),r(O,A,N),i==-1&&(N=O.length,i=t(Le,O,ie,N),i<1&&(T++,r(O,ie<N?ce:Le,N))),N=O.length):i===0&&(T++,O=[0]),D[w++]=T,i&&O[0]?O[N++]=xe[J]||0:(O=[xe[J]],N=1);while((J++<G||O[0]!==void 0)&&H--)}return D[0]||D.shift(),F.e=y,zs(F,f?u+ia(F)+1:u)}}();function hJ(e,t){var r,n,a,u,f,i,y=0,w=0,T=e.constructor,A=T.precision;if(ia(e)>16)throw Error(ID+ia(e));if(!e.s)return new T(su);for(co=!1,i=A,f=new T(.03125);e.abs().gte(.1);)e=e.times(f),w+=5;for(n=Math.log(iy(2,w))/Math.LN10*2+5|0,i+=n,r=a=u=new T(su),T.precision=i;;){if(a=zs(a.times(e),i),r=r.times(++y),f=u.plus(yp(a,r,i)),nf(f.d).slice(0,i)===nf(u.d).slice(0,i)){for(;w--;)u=zs(u.times(u),i);return T.precision=A,t==null?(co=!0,zs(u,A)):u}u=f}}function ia(e){for(var t=e.e*Xs,r=e.d[0];r>=10;r/=10)t++;return t}function EI(e,t,r){if(t>e.LN10.sd())throw co=!0,r&&(e.precision=r),Error(Yu+"LN10 precision limit exceeded");return zs(new e(e.LN10),t)}function km(e){for(var t="";e--;)t+="0";return t}function ib(e,t){var r,n,a,u,f,i,y,w,T,A=1,k=10,F=e,D=F.d,O=F.constructor,N=O.precision;if(F.s<1)throw Error(Yu+(F.s?"NaN":"-Infinity"));if(F.eq(su))return new O(0);if(t==null?(co=!1,w=N):w=t,F.eq(10))return t==null&&(co=!0),EI(O,w);if(w+=k,O.precision=w,r=nf(D),n=r.charAt(0),u=ia(F),Math.abs(u)<15e14){for(;n<7&&n!=1||n==1&&r.charAt(1)>3;)F=F.times(e),r=nf(F.d),n=r.charAt(0),A++;u=ia(F),n>1?(F=new O("0."+r),u++):F=new O(n+"."+r.slice(1))}else return y=EI(O,w+2,N).times(u+""),F=ib(new O(n+"."+r.slice(1)),w-k).plus(y),O.precision=N,t==null?(co=!0,zs(F,N)):F;for(i=f=F=yp(F.minus(su),F.plus(su),w),T=zs(F.times(F),w),a=3;;){if(f=zs(f.times(T),w),y=i.plus(yp(f,new O(a),w)),nf(y.d).slice(0,w)===nf(i.d).slice(0,w))return i=i.times(2),u!==0&&(i=i.plus(EI(O,w+2,N).times(u+""))),i=yp(i,new O(A),w),O.precision=N,t==null?(co=!0,zs(i,N)):i;i=y,a+=2}}function jq(e,t){var r,n,a;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),n=0;t.charCodeAt(n)===48;)++n;for(a=t.length;t.charCodeAt(a-1)===48;)--a;if(t=t.slice(n,a),t){if(a-=n,r=r-n-1,e.e=$_(r/Xs),e.d=[],n=(r+1)%Xs,r<0&&(n+=Xs),n<a){for(n&&e.d.push(+t.slice(0,n)),a-=Xs;n<a;)e.d.push(+t.slice(n,n+=Xs));t=t.slice(n),n=Xs-t.length}else n-=a;for(;n--;)t+="0";if(e.d.push(+t),co&&(e.e>nE||e.e<-nE))throw Error(ID+r)}else e.s=0,e.e=0,e.d=[0];return e}function zs(e,t,r){var n,a,u,f,i,y,w,T,A=e.d;for(f=1,u=A[0];u>=10;u/=10)f++;if(n=t-f,n<0)n+=Xs,a=t,w=A[T=0];else{if(T=Math.ceil((n+1)/Xs),u=A.length,T>=u)return e;for(w=u=A[T],f=1;u>=10;u/=10)f++;n%=Xs,a=n-Xs+f}if(r!==void 0&&(u=iy(10,f-a-1),i=w/u%10|0,y=t<0||A[T+1]!==void 0||w%u,y=r<4?(i||y)&&(r==0||r==(e.s<0?3:2)):i>5||i==5&&(r==4||y||r==6&&(n>0?a>0?w/iy(10,f-a):0:A[T-1])%10&1||r==(e.s<0?8:7))),t<1||!A[0])return y?(u=ia(e),A.length=1,t=t-u-1,A[0]=iy(10,(Xs-t%Xs)%Xs),e.e=$_(-t/Xs)||0):(A.length=1,A[0]=e.e=e.s=0),e;if(n==0?(A.length=T,u=1,T--):(A.length=T+1,u=iy(10,Xs-n),A[T]=a>0?(w/iy(10,f-a)%iy(10,a)|0)*u:0),y)for(;;)if(T==0){(A[0]+=u)==Aa&&(A[0]=1,++e.e);break}else{if(A[T]+=u,A[T]!=Aa)break;A[T--]=0,u=1}for(n=A.length;A[--n]===0;)A.pop();if(co&&(e.e>nE||e.e<-nE))throw Error(ID+ia(e));return e}function fJ(e,t){var r,n,a,u,f,i,y,w,T,A,k=e.constructor,F=k.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new k(e),co?zs(t,F):t;if(y=e.d,A=t.d,n=t.e,w=e.e,y=y.slice(),f=w-n,f){for(T=f<0,T?(r=y,f=-f,i=A.length):(r=A,n=w,i=y.length),a=Math.max(Math.ceil(F/Xs),i)+2,f>a&&(f=a,r.length=1),r.reverse(),a=f;a--;)r.push(0);r.reverse()}else{for(a=y.length,i=A.length,T=a<i,T&&(i=a),a=0;a<i;a++)if(y[a]!=A[a]){T=y[a]<A[a];break}f=0}for(T&&(r=y,y=A,A=r,t.s=-t.s),i=y.length,a=A.length-i;a>0;--a)y[i++]=0;for(a=A.length;a>f;){if(y[--a]<A[a]){for(u=a;u&&y[--u]===0;)y[u]=Aa-1;--y[u],y[a]+=Aa}y[a]-=A[a]}for(;y[--i]===0;)y.pop();for(;y[0]===0;y.shift())--n;return y[0]?(t.d=y,t.e=n,co?zs(t,F):t):new k(0)}function Ay(e,t,r){var n,a=ia(e),u=nf(e.d),f=u.length;return t?(r&&(n=r-f)>0?u=u.charAt(0)+"."+u.slice(1)+km(n):f>1&&(u=u.charAt(0)+"."+u.slice(1)),u=u+(a<0?"e":"e+")+a):a<0?(u="0."+km(-a-1)+u,r&&(n=r-f)>0&&(u+=km(n))):a>=f?(u+=km(a+1-f),r&&(n=r-a-1)>0&&(u=u+"."+km(n))):((n=a+1)<f&&(u=u.slice(0,n)+"."+u.slice(n)),r&&(n=r-f)>0&&(a+1===f&&(u+="."),u+=km(n))),e.s<0?"-"+u:u}function Dq(e,t){if(e.length>t)return e.length=t,!0}function pJ(e){var t,r,n;function a(u){var f=this;if(!(f instanceof a))return new a(u);if(f.constructor=a,u instanceof a){f.s=u.s,f.e=u.e,f.d=(u=u.d)?u.slice():u;return}if(typeof u=="number"){if(u*0!==0)throw Error(vy+u);if(u>0)f.s=1;else if(u<0)u=-u,f.s=-1;else{f.s=0,f.e=0,f.d=[0];return}if(u===~~u&&u<1e7){f.e=0,f.d=[u];return}return jq(f,u.toString())}else if(typeof u!="string")throw Error(vy+u);if(u.charCodeAt(0)===45?(u=u.slice(1),f.s=-1):f.s=1,bCe.test(u))jq(f,u);else throw Error(vy+u)}if(a.prototype=En,a.ROUND_UP=0,a.ROUND_DOWN=1,a.ROUND_CEIL=2,a.ROUND_FLOOR=3,a.ROUND_HALF_UP=4,a.ROUND_HALF_DOWN=5,a.ROUND_HALF_EVEN=6,a.ROUND_HALF_CEIL=7,a.ROUND_HALF_FLOOR=8,a.clone=pJ,a.config=a.set=wCe,e===void 0&&(e={}),e)for(n=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<n.length;)e.hasOwnProperty(r=n[t++])||(e[r]=this[r]);return a.config(e),a}function wCe(e){if(!e||typeof e!="object")throw Error(Yu+"Object expected");var t,r,n,a=["precision",1,B_,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<a.length;t+=3)if((n=e[r=a[t]])!==void 0)if($_(n)===n&&n>=a[t+1]&&n<=a[t+2])this[r]=n;else throw Error(vy+r+": "+n);if((n=e[r="LN10"])!==void 0)if(n==Math.LN10)this[r]=new this(n);else throw Error(vy+r+": "+n);return this}var kD=pJ(xCe);su=new kD(1);const ks=kD;function SCe(e){return ACe(e)||CCe(e)||TCe(e)||ECe()}function ECe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function TCe(e,t){if(e){if(typeof e=="string")return EL(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return EL(e,t)}}function CCe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function ACe(e){if(Array.isArray(e))return EL(e)}function EL(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var PCe=function(t){return t},mJ={},gJ=function(t){return t===mJ},Nq=function(t){return function r(){return arguments.length===0||arguments.length===1&&gJ(arguments.length<=0?void 0:arguments[0])?r:t.apply(void 0,arguments)}},MCe=function e(t,r){return t===1?r:Nq(function(){for(var n=arguments.length,a=new Array(n),u=0;u<n;u++)a[u]=arguments[u];var f=a.filter(function(i){return i!==mJ}).length;return f>=t?r.apply(void 0,a):e(t-f,Nq(function(){for(var i=arguments.length,y=new Array(i),w=0;w<i;w++)y[w]=arguments[w];var T=a.map(function(A){return gJ(A)?y.shift():A});return r.apply(void 0,SCe(T).concat(y))}))})},M2=function(t){return MCe(t.length,t)},TL=function(t,r){for(var n=[],a=t;a<r;++a)n[a-t]=a;return n},ICe=M2(function(e,t){return Array.isArray(t)?t.map(e):Object.keys(t).map(function(r){return t[r]}).map(e)}),kCe=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];if(!r.length)return PCe;var a=r.reverse(),u=a[0],f=a.slice(1);return function(){return f.reduce(function(i,y){return y(i)},u.apply(void 0,arguments))}},CL=function(t){return Array.isArray(t)?t.reverse():t.split("").reverse.join("")},yJ=function(t){var r=null,n=null;return function(){for(var a=arguments.length,u=new Array(a),f=0;f<a;f++)u[f]=arguments[f];return r&&u.every(function(i,y){return i===r[y]})||(r=u,n=t.apply(void 0,u)),n}};function OCe(e){var t;return e===0?t=1:t=Math.floor(new ks(e).abs().log(10).toNumber())+1,t}function LCe(e,t,r){for(var n=new ks(e),a=0,u=[];n.lt(t)&&a<1e5;)u.push(n.toNumber()),n=n.add(r),a++;return u}var RCe=M2(function(e,t,r){var n=+e,a=+t;return n+r*(a-n)}),jCe=M2(function(e,t,r){var n=t-+e;return n=n||1/0,(r-e)/n}),DCe=M2(function(e,t,r){var n=t-+e;return n=n||1/0,Math.max(0,Math.min(1,(r-e)/n))});const I2={rangeStep:LCe,getDigitCount:OCe,interpolateNumber:RCe,uninterpolateNumber:jCe,uninterpolateTruncation:DCe};function AL(e){return FCe(e)||zCe(e)||vJ(e)||NCe()}function NCe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zCe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function FCe(e){if(Array.isArray(e))return PL(e)}function sb(e,t){return VCe(e)||$Ce(e,t)||vJ(e,t)||BCe()}function BCe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vJ(e,t){if(e){if(typeof e=="string")return PL(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return PL(e,t)}}function PL(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function $Ce(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var r=[],n=!0,a=!1,u=void 0;try{for(var f=e[Symbol.iterator](),i;!(n=(i=f.next()).done)&&(r.push(i.value),!(t&&r.length===t));n=!0);}catch(y){a=!0,u=y}finally{try{!n&&f.return!=null&&f.return()}finally{if(a)throw u}}return r}}function VCe(e){if(Array.isArray(e))return e}function _J(e){var t=sb(e,2),r=t[0],n=t[1],a=r,u=n;return r>n&&(a=n,u=r),[a,u]}function xJ(e,t,r){if(e.lte(0))return new ks(0);var n=I2.getDigitCount(e.toNumber()),a=new ks(10).pow(n),u=e.div(a),f=n!==1?.05:.1,i=new ks(Math.ceil(u.div(f).toNumber())).add(r).mul(f),y=i.mul(a);return t?y:new ks(Math.ceil(y))}function UCe(e,t,r){var n=1,a=new ks(e);if(!a.isint()&&r){var u=Math.abs(e);u<1?(n=new ks(10).pow(I2.getDigitCount(e)-1),a=new ks(Math.floor(a.div(n).toNumber())).mul(n)):u>1&&(a=new ks(Math.floor(e)))}else e===0?a=new ks(Math.floor((t-1)/2)):r||(a=new ks(Math.floor(e)));var f=Math.floor((t-1)/2),i=kCe(ICe(function(y){return a.add(new ks(y-f).mul(n)).toNumber()}),TL);return i(0,t)}function bJ(e,t,r,n){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((t-e)/(r-1)))return{step:new ks(0),tickMin:new ks(0),tickMax:new ks(0)};var u=xJ(new ks(t).sub(e).div(r-1),n,a),f;e<=0&&t>=0?f=new ks(0):(f=new ks(e).add(t).div(2),f=f.sub(new ks(f).mod(u)));var i=Math.ceil(f.sub(e).div(u).toNumber()),y=Math.ceil(new ks(t).sub(f).div(u).toNumber()),w=i+y+1;return w>r?bJ(e,t,r,n,a+1):(w<r&&(y=t>0?y+(r-w):y,i=t>0?i:i+(r-w)),{step:u,tickMin:f.sub(new ks(i).mul(u)),tickMax:f.add(new ks(y).mul(u))})}function qCe(e){var t=sb(e,2),r=t[0],n=t[1],a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,f=Math.max(a,2),i=_J([r,n]),y=sb(i,2),w=y[0],T=y[1];if(w===-1/0||T===1/0){var A=T===1/0?[w].concat(AL(TL(0,a-1).map(function(){return 1/0}))):[].concat(AL(TL(0,a-1).map(function(){return-1/0})),[T]);return r>n?CL(A):A}if(w===T)return UCe(w,a,u);var k=bJ(w,T,f,u),F=k.step,D=k.tickMin,O=k.tickMax,N=I2.rangeStep(D,O.add(new ks(.1).mul(F)),F);return r>n?CL(N):N}function GCe(e,t){var r=sb(e,2),n=r[0],a=r[1],u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,f=_J([n,a]),i=sb(f,2),y=i[0],w=i[1];if(y===-1/0||w===1/0)return[n,a];if(y===w)return[y];var T=Math.max(t,2),A=xJ(new ks(w).sub(y).div(T-1),u,0),k=[].concat(AL(I2.rangeStep(new ks(y),new ks(w).sub(new ks(.99).mul(A)),A)),[w]);return n>a?CL(k):k}var HCe=yJ(qCe),WCe=yJ(GCe),ZCe="Invariant failed";function Py(e,t){throw new Error(ZCe)}var XCe=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function u_(e){"@babel/helpers - typeof";return u_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u_(e)}function iE(){return iE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},iE.apply(this,arguments)}function KCe(e,t){return eAe(e)||QCe(e,t)||JCe(e,t)||YCe()}function YCe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function JCe(e,t){if(e){if(typeof e=="string")return zq(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zq(e,t)}}function zq(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function QCe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,u,f,i=[],y=!0,w=!1;try{if(u=(r=r.call(e)).next,t!==0)for(;!(y=(n=u.call(r)).done)&&(i.push(n.value),i.length!==t);y=!0);}catch(T){w=!0,a=T}finally{try{if(!y&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(w)throw a}}return i}}function eAe(e){if(Array.isArray(e))return e}function tAe(e,t){if(e==null)return{};var r=rAe(e,t),n,a;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(a=0;a<u.length;a++)n=u[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function rAe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function nAe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function iAe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,EJ(n.key),n)}}function sAe(e,t,r){return t&&iAe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function oAe(e,t,r){return t=sE(t),aAe(e,wJ()?Reflect.construct(t,r||[],sE(e).constructor):t.apply(e,r))}function aAe(e,t){if(t&&(u_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return lAe(e)}function lAe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function wJ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(wJ=function(){return!!e})()}function sE(e){return sE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},sE(e)}function cAe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ML(e,t)}function ML(e,t){return ML=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},ML(e,t)}function SJ(e,t,r){return t=EJ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function EJ(e){var t=uAe(e,"string");return u_(t)=="symbol"?t:t+""}function uAe(e,t){if(u_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(u_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Yb=function(e){function t(){return nAe(this,t),oAe(this,t,arguments)}return cAe(t,e),sAe(t,[{key:"render",value:function(){var n=this.props,a=n.offset,u=n.layout,f=n.width,i=n.dataKey,y=n.data,w=n.dataPointFormatter,T=n.xAxis,A=n.yAxis,k=tAe(n,XCe),F=ns(k,!1);this.props.direction==="x"&&T.type!=="number"&&Py();var D=y.map(function(O){var N=w(O,i),V=N.x,H=N.y,Z=N.value,J=N.errorVal;if(!J)return null;var G=[],Y,ie;if(Array.isArray(J)){var ce=KCe(J,2);Y=ce[0],ie=ce[1]}else Y=ie=J;if(u==="vertical"){var ge=T.scale,be=H+a,xe=be+f,Le=be-f,ze=ge(Z-Y),Xe=ge(Z+ie);G.push({x1:Xe,y1:xe,x2:Xe,y2:Le}),G.push({x1:ze,y1:be,x2:Xe,y2:be}),G.push({x1:ze,y1:xe,x2:ze,y2:Le})}else if(u==="horizontal"){var Je=A.scale,tt=V+a,st=tt-f,Ne=tt+f,We=Je(Z-Y),Ue=Je(Z+ie);G.push({x1:st,y1:Ue,x2:Ne,y2:Ue}),G.push({x1:tt,y1:We,x2:tt,y2:Ue}),G.push({x1:st,y1:We,x2:Ne,y2:We})}return jt.createElement($o,iE({className:"recharts-errorBar",key:"bar-".concat(G.map(function(De){return"".concat(De.x1,"-").concat(De.x2,"-").concat(De.y1,"-").concat(De.y2)}))},F),G.map(function(De){return jt.createElement("line",iE({},De,{key:"line-".concat(De.x1,"-").concat(De.x2,"-").concat(De.y1,"-").concat(De.y2)}))}))});return jt.createElement($o,{className:"recharts-errorBars"},D)}}])}(jt.Component);SJ(Yb,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});SJ(Yb,"displayName","ErrorBar");function ob(e){"@babel/helpers - typeof";return ob=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ob(e)}function Fq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Qg(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Fq(Object(r),!0).forEach(function(n){dAe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function dAe(e,t,r){return t=hAe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function hAe(e){var t=fAe(e,"string");return ob(t)=="symbol"?t:t+""}function fAe(e,t){if(ob(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(ob(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var TJ=function(t){var r=t.children,n=t.formattedGraphicalItems,a=t.legendWidth,u=t.legendContent,f=eu(r,qv);if(!f)return null;var i=qv.defaultProps,y=i!==void 0?Qg(Qg({},i),f.props):{},w;return f.props&&f.props.payload?w=f.props&&f.props.payload:u==="children"?w=(n||[]).reduce(function(T,A){var k=A.item,F=A.props,D=F.sectors||F.data||[];return T.concat(D.map(function(O){return{type:f.props.iconType||k.props.legendType,value:O.name,color:O.fill,payload:O}}))},[]):w=(n||[]).map(function(T){var A=T.item,k=A.type.defaultProps,F=k!==void 0?Qg(Qg({},k),A.props):{},D=F.dataKey,O=F.name,N=F.legendType,V=F.hide;return{inactive:V,dataKey:D,type:y.iconType||N||"square",color:OD(A),value:O||D,payload:F}}),Qg(Qg(Qg({},y),qv.getWithHeight(f,a)),{},{payload:w,item:f})};function ab(e){"@babel/helpers - typeof";return ab=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ab(e)}function Bq(e){return yAe(e)||gAe(e)||mAe(e)||pAe()}function pAe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mAe(e,t){if(e){if(typeof e=="string")return IL(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return IL(e,t)}}function gAe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function yAe(e){if(Array.isArray(e))return IL(e)}function IL(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function $q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Po(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$q(Object(r),!0).forEach(function(n){Hv(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$q(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Hv(e,t,r){return t=vAe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function vAe(e){var t=_Ae(e,"string");return ab(t)=="symbol"?t:t+""}function _Ae(e,t){if(ab(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(ab(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function du(e,t,r){return Zi(e)||Zi(t)?r:_a(t)?Xu(e,t,r):Wi(t)?t(e):r}function Sx(e,t,r,n){var a=yCe(e,function(i){return du(i,t)});if(r==="number"){var u=a.filter(function(i){return cn(i)||parseFloat(i)});return u.length?[A2(u),C2(u)]:[1/0,-1/0]}var f=n?a.filter(function(i){return!Zi(i)}):a;return f.map(function(i){return _a(i)||i instanceof Date?i:""})}var xAe=function(t){var r,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],a=arguments.length>2?arguments[2]:void 0,u=arguments.length>3?arguments[3]:void 0,f=-1,i=(r=n==null?void 0:n.length)!==null&&r!==void 0?r:0;if(i<=1)return 0;if(u&&u.axisType==="angleAxis"&&Math.abs(Math.abs(u.range[1]-u.range[0])-360)<=1e-6)for(var y=u.range,w=0;w<i;w++){var T=w>0?a[w-1].coordinate:a[i-1].coordinate,A=a[w].coordinate,k=w>=i-1?a[0].coordinate:a[w+1].coordinate,F=void 0;if(Xd(A-T)!==Xd(k-A)){var D=[];if(Xd(k-A)===Xd(y[1]-y[0])){F=k;var O=A+y[1]-y[0];D[0]=Math.min(O,(O+T)/2),D[1]=Math.max(O,(O+T)/2)}else{F=T;var N=k+y[1]-y[0];D[0]=Math.min(A,(N+A)/2),D[1]=Math.max(A,(N+A)/2)}var V=[Math.min(A,(F+A)/2),Math.max(A,(F+A)/2)];if(t>V[0]&&t<=V[1]||t>=D[0]&&t<=D[1]){f=a[w].index;break}}else{var H=Math.min(T,k),Z=Math.max(T,k);if(t>(H+A)/2&&t<=(Z+A)/2){f=a[w].index;break}}}else for(var J=0;J<i;J++)if(J===0&&t<=(n[J].coordinate+n[J+1].coordinate)/2||J>0&&J<i-1&&t>(n[J].coordinate+n[J-1].coordinate)/2&&t<=(n[J].coordinate+n[J+1].coordinate)/2||J===i-1&&t>(n[J].coordinate+n[J-1].coordinate)/2){f=n[J].index;break}return f},OD=function(t){var r,n=t,a=n.type.displayName,u=(r=t.type)!==null&&r!==void 0&&r.defaultProps?Po(Po({},t.type.defaultProps),t.props):t.props,f=u.stroke,i=u.fill,y;switch(a){case"Line":y=f;break;case"Area":case"Radar":y=f&&f!=="none"?f:i;break;default:y=i;break}return y},bAe=function(t){var r=t.barSize,n=t.totalSize,a=t.stackGroups,u=a===void 0?{}:a;if(!u)return{};for(var f={},i=Object.keys(u),y=0,w=i.length;y<w;y++)for(var T=u[i[y]].stackGroups,A=Object.keys(T),k=0,F=A.length;k<F;k++){var D=T[A[k]],O=D.items,N=D.cateAxisId,V=O.filter(function(ie){return gp(ie.type).indexOf("Bar")>=0});if(V&&V.length){var H=V[0].type.defaultProps,Z=H!==void 0?Po(Po({},H),V[0].props):V[0].props,J=Z.barSize,G=Z[N];f[G]||(f[G]=[]);var Y=Zi(J)?r:J;f[G].push({item:V[0],stackList:V.slice(1),barSize:Zi(Y)?void 0:Cy(Y,n,0)})}}return f},wAe=function(t){var r=t.barGap,n=t.barCategoryGap,a=t.bandSize,u=t.sizeList,f=u===void 0?[]:u,i=t.maxBarSize,y=f.length;if(y<1)return null;var w=Cy(r,a,0,!0),T,A=[];if(f[0].barSize===+f[0].barSize){var k=!1,F=a/y,D=f.reduce(function(J,G){return J+G.barSize||0},0);D+=(y-1)*w,D>=a&&(D-=(y-1)*w,w=0),D>=a&&F>0&&(k=!0,F*=.9,D=y*F);var O=(a-D)/2>>0,N={offset:O-w,size:0};T=f.reduce(function(J,G){var Y={item:G.item,position:{offset:N.offset+N.size+w,size:k?F:G.barSize}},ie=[].concat(Bq(J),[Y]);return N=ie[ie.length-1].position,G.stackList&&G.stackList.length&&G.stackList.forEach(function(ce){ie.push({item:ce,position:N})}),ie},A)}else{var V=Cy(n,a,0,!0);a-2*V-(y-1)*w<=0&&(w=0);var H=(a-2*V-(y-1)*w)/y;H>1&&(H>>=0);var Z=i===+i?Math.min(H,i):H;T=f.reduce(function(J,G,Y){var ie=[].concat(Bq(J),[{item:G.item,position:{offset:V+(H+w)*Y+(H-Z)/2,size:Z}}]);return G.stackList&&G.stackList.length&&G.stackList.forEach(function(ce){ie.push({item:ce,position:ie[ie.length-1].position})}),ie},A)}return T},SAe=function(t,r,n,a){var u=n.children,f=n.width,i=n.margin,y=f-(i.left||0)-(i.right||0),w=TJ({children:u,legendWidth:y});if(w){var T=a||{},A=T.width,k=T.height,F=w.align,D=w.verticalAlign,O=w.layout;if((O==="vertical"||O==="horizontal"&&D==="middle")&&F!=="center"&&cn(t[F]))return Po(Po({},t),{},Hv({},F,t[F]+(A||0)));if((O==="horizontal"||O==="vertical"&&F==="center")&&D!=="middle"&&cn(t[D]))return Po(Po({},t),{},Hv({},D,t[D]+(k||0)))}return t},EAe=function(t,r,n){return Zi(r)?!0:t==="horizontal"?r==="yAxis":t==="vertical"||n==="x"?r==="xAxis":n==="y"?r==="yAxis":!0},CJ=function(t,r,n,a,u){var f=r.props.children,i=Ku(f,Yb).filter(function(w){return EAe(a,u,w.props.direction)});if(i&&i.length){var y=i.map(function(w){return w.props.dataKey});return t.reduce(function(w,T){var A=du(T,n);if(Zi(A))return w;var k=Array.isArray(A)?[A2(A),C2(A)]:[A,A],F=y.reduce(function(D,O){var N=du(T,O,0),V=k[0]-Math.abs(Array.isArray(N)?N[0]:N),H=k[1]+Math.abs(Array.isArray(N)?N[1]:N);return[Math.min(V,D[0]),Math.max(H,D[1])]},[1/0,-1/0]);return[Math.min(F[0],w[0]),Math.max(F[1],w[1])]},[1/0,-1/0])}return null},TAe=function(t,r,n,a,u){var f=r.map(function(i){return CJ(t,i,n,u,a)}).filter(function(i){return!Zi(i)});return f&&f.length?f.reduce(function(i,y){return[Math.min(i[0],y[0]),Math.max(i[1],y[1])]},[1/0,-1/0]):null},AJ=function(t,r,n,a,u){var f=r.map(function(y){var w=y.props.dataKey;return n==="number"&&w&&CJ(t,y,w,a)||Sx(t,w,n,u)});if(n==="number")return f.reduce(function(y,w){return[Math.min(y[0],w[0]),Math.max(y[1],w[1])]},[1/0,-1/0]);var i={};return f.reduce(function(y,w){for(var T=0,A=w.length;T<A;T++)i[w[T]]||(i[w[T]]=!0,y.push(w[T]));return y},[])},PJ=function(t,r){return t==="horizontal"&&r==="xAxis"||t==="vertical"&&r==="yAxis"||t==="centric"&&r==="angleAxis"||t==="radial"&&r==="radiusAxis"},hy=function(t,r,n){if(!t)return null;var a=t.scale,u=t.duplicateDomain,f=t.type,i=t.range,y=t.realScaleType==="scaleBand"?a.bandwidth()/2:2,w=(r||n)&&f==="category"&&a.bandwidth?a.bandwidth()/y:0;if(w=t.axisType==="angleAxis"&&(i==null?void 0:i.length)>=2?Xd(i[0]-i[1])*2*w:w,r&&(t.ticks||t.niceTicks)){var T=(t.ticks||t.niceTicks).map(function(A){var k=u?u.indexOf(A):A;return{coordinate:a(k)+w,value:A,offset:w}});return T.filter(function(A){return!qb(A.coordinate)})}return t.isCategorical&&t.categoricalDomain?t.categoricalDomain.map(function(A,k){return{coordinate:a(A)+w,value:A,index:k,offset:w}}):a.ticks&&!n?a.ticks(t.tickCount).map(function(A){return{coordinate:a(A)+w,value:A,offset:w}}):a.domain().map(function(A,k){return{coordinate:a(A)+w,value:u?u[A]:A,index:k,offset:w}})},TI=new WeakMap,Sw=function(t,r){if(typeof r!="function")return t;TI.has(t)||TI.set(t,new WeakMap);var n=TI.get(t);if(n.has(r))return n.get(r);var a=function(){t.apply(void 0,arguments),r.apply(void 0,arguments)};return n.set(r,a),a},CAe=function(t,r,n){var a=t.scale,u=t.type,f=t.layout,i=t.axisType;if(a==="auto")return f==="radial"&&i==="radiusAxis"?{scale:Qx(),realScaleType:"band"}:f==="radial"&&i==="angleAxis"?{scale:QS(),realScaleType:"linear"}:u==="category"&&r&&(r.indexOf("LineChart")>=0||r.indexOf("AreaChart")>=0||r.indexOf("ComposedChart")>=0&&!n)?{scale:wx(),realScaleType:"point"}:u==="category"?{scale:Qx(),realScaleType:"band"}:{scale:QS(),realScaleType:"linear"};if(Ty(a)){var y="scale".concat(f2(a));return{scale:(Cq[y]||wx)(),realScaleType:Cq[y]?y:"point"}}return Wi(a)?{scale:a}:{scale:wx(),realScaleType:"point"}},Vq=1e-4,AAe=function(t){var r=t.domain();if(!(!r||r.length<=2)){var n=r.length,a=t.range(),u=Math.min(a[0],a[1])-Vq,f=Math.max(a[0],a[1])+Vq,i=t(r[0]),y=t(r[n-1]);(i<u||i>f||y<u||y>f)&&t.domain([r[0],r[n-1]])}},PAe=function(t,r){if(!t)return null;for(var n=0,a=t.length;n<a;n++)if(t[n].item===r)return t[n].position;return null},MAe=function(t,r){if(!r||r.length!==2||!cn(r[0])||!cn(r[1]))return t;var n=Math.min(r[0],r[1]),a=Math.max(r[0],r[1]),u=[t[0],t[1]];return(!cn(t[0])||t[0]<n)&&(u[0]=n),(!cn(t[1])||t[1]>a)&&(u[1]=a),u[0]>a&&(u[0]=a),u[1]<n&&(u[1]=n),u},IAe=function(t){var r=t.length;if(!(r<=0))for(var n=0,a=t[0].length;n<a;++n)for(var u=0,f=0,i=0;i<r;++i){var y=qb(t[i][n][1])?t[i][n][0]:t[i][n][1];y>=0?(t[i][n][0]=u,t[i][n][1]=u+y,u=t[i][n][1]):(t[i][n][0]=f,t[i][n][1]=f+y,f=t[i][n][1])}},kAe=function(t){var r=t.length;if(!(r<=0))for(var n=0,a=t[0].length;n<a;++n)for(var u=0,f=0;f<r;++f){var i=qb(t[f][n][1])?t[f][n][0]:t[f][n][1];i>=0?(t[f][n][0]=u,t[f][n][1]=u+i,u=t[f][n][1]):(t[f][n][0]=0,t[f][n][1]=0)}},OAe={sign:IAe,expand:p1e,none:r_,silhouette:m1e,wiggle:g1e,positive:kAe},LAe=function(t,r,n){var a=r.map(function(i){return i.props.dataKey}),u=OAe[n],f=f1e().keys(a).value(function(i,y){return+du(i,y,0)}).order(oL).offset(u);return f(t)},RAe=function(t,r,n,a,u,f){if(!t)return null;var i=f?r.reverse():r,y={},w=i.reduce(function(A,k){var F,D=(F=k.type)!==null&&F!==void 0&&F.defaultProps?Po(Po({},k.type.defaultProps),k.props):k.props,O=D.stackId,N=D.hide;if(N)return A;var V=D[n],H=A[V]||{hasStack:!1,stackGroups:{}};if(_a(O)){var Z=H.stackGroups[O]||{numericAxisId:n,cateAxisId:a,items:[]};Z.items.push(k),H.hasStack=!0,H.stackGroups[O]=Z}else H.stackGroups[Gb("_stackId_")]={numericAxisId:n,cateAxisId:a,items:[k]};return Po(Po({},A),{},Hv({},V,H))},y),T={};return Object.keys(w).reduce(function(A,k){var F=w[k];if(F.hasStack){var D={};F.stackGroups=Object.keys(F.stackGroups).reduce(function(O,N){var V=F.stackGroups[N];return Po(Po({},O),{},Hv({},N,{numericAxisId:n,cateAxisId:a,items:V.items,stackedData:LAe(t,V.items,u)}))},D)}return Po(Po({},A),{},Hv({},k,F))},T)},jAe=function(t,r){var n=r.realScaleType,a=r.type,u=r.tickCount,f=r.originalDomain,i=r.allowDecimals,y=n||r.scale;if(y!=="auto"&&y!=="linear")return null;if(u&&a==="number"&&f&&(f[0]==="auto"||f[1]==="auto")){var w=t.domain();if(!w.length)return null;var T=HCe(w,u,i);return t.domain([A2(T),C2(T)]),{niceTicks:T}}if(u&&a==="number"){var A=t.domain(),k=WCe(A,u,i);return{niceTicks:k}}return null};function Uq(e){var t=e.axis,r=e.ticks,n=e.bandSize,a=e.entry,u=e.index,f=e.dataKey;if(t.type==="category"){if(!t.allowDuplicatedCategory&&t.dataKey&&!Zi(a[t.dataKey])){var i=LS(r,"value",a[t.dataKey]);if(i)return i.coordinate+n/2}return r[u]?r[u].coordinate+n/2:null}var y=du(a,Zi(f)?t.dataKey:f);return Zi(y)?null:t.scale(y)}var qq=function(t){var r=t.axis,n=t.ticks,a=t.offset,u=t.bandSize,f=t.entry,i=t.index;if(r.type==="category")return n[i]?n[i].coordinate+a:null;var y=du(f,r.dataKey,r.domain[i]);return Zi(y)?null:r.scale(y)-u/2+a},DAe=function(t){var r=t.numericAxis,n=r.scale.domain();if(r.type==="number"){var a=Math.min(n[0],n[1]),u=Math.max(n[0],n[1]);return a<=0&&u>=0?0:u<0?u:a}return n[0]},NAe=function(t,r){var n,a=(n=t.type)!==null&&n!==void 0&&n.defaultProps?Po(Po({},t.type.defaultProps),t.props):t.props,u=a.stackId;if(_a(u)){var f=r[u];if(f){var i=f.items.indexOf(t);return i>=0?f.stackedData[i]:null}}return null},zAe=function(t){return t.reduce(function(r,n){return[A2(n.concat([r[0]]).filter(cn)),C2(n.concat([r[1]]).filter(cn))]},[1/0,-1/0])},MJ=function(t,r,n){return Object.keys(t).reduce(function(a,u){var f=t[u],i=f.stackedData,y=i.reduce(function(w,T){var A=zAe(T.slice(r,n+1));return[Math.min(w[0],A[0]),Math.max(w[1],A[1])]},[1/0,-1/0]);return[Math.min(y[0],a[0]),Math.max(y[1],a[1])]},[1/0,-1/0]).map(function(a){return a===1/0||a===-1/0?0:a})},Gq=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,Hq=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,kL=function(t,r,n){if(Wi(t))return t(r,n);if(!Array.isArray(t))return r;var a=[];if(cn(t[0]))a[0]=n?t[0]:Math.min(t[0],r[0]);else if(Gq.test(t[0])){var u=+Gq.exec(t[0])[1];a[0]=r[0]-u}else Wi(t[0])?a[0]=t[0](r[0]):a[0]=r[0];if(cn(t[1]))a[1]=n?t[1]:Math.max(t[1],r[1]);else if(Hq.test(t[1])){var f=+Hq.exec(t[1])[1];a[1]=r[1]+f}else Wi(t[1])?a[1]=t[1](r[1]):a[1]=r[1];return a},oE=function(t,r,n){if(t&&t.scale&&t.scale.bandwidth){var a=t.scale.bandwidth();if(!n||a>0)return a}if(t&&r&&r.length>=2){for(var u=oD(r,function(A){return A.coordinate}),f=1/0,i=1,y=u.length;i<y;i++){var w=u[i],T=u[i-1];f=Math.min((w.coordinate||0)-(T.coordinate||0),f)}return f===1/0?0:f}return n?void 0:0},Wq=function(t,r,n){return!t||!t.length||P2(t,Xu(n,"type.defaultProps.domain"))?r:t},IJ=function(t,r){var n=t.type.defaultProps?Po(Po({},t.type.defaultProps),t.props):t.props,a=n.dataKey,u=n.name,f=n.unit,i=n.formatter,y=n.tooltipType,w=n.chartType,T=n.hide;return Po(Po({},ns(t,!1)),{},{dataKey:a,unit:f,formatter:i,name:u||a,color:OD(t),value:du(r,a),type:y,payload:r,chartType:w,hide:T})};function lb(e){"@babel/helpers - typeof";return lb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lb(e)}function Zq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Xq(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Zq(Object(r),!0).forEach(function(n){FAe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function FAe(e,t,r){return t=BAe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function BAe(e){var t=$Ae(e,"string");return lb(t)=="symbol"?t:t+""}function $Ae(e,t){if(lb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(lb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var aE=Math.PI/180,VAe=function(t){return t*180/Math.PI},Za=function(t,r,n,a){return{x:t+Math.cos(-aE*a)*n,y:r+Math.sin(-aE*a)*n}},UAe=function(t,r){var n=t.x,a=t.y,u=r.x,f=r.y;return Math.sqrt(Math.pow(n-u,2)+Math.pow(a-f,2))},qAe=function(t,r){var n=t.x,a=t.y,u=r.cx,f=r.cy,i=UAe({x:n,y:a},{x:u,y:f});if(i<=0)return{radius:i};var y=(n-u)/i,w=Math.acos(y);return a>f&&(w=2*Math.PI-w),{radius:i,angle:VAe(w),angleInRadian:w}},GAe=function(t){var r=t.startAngle,n=t.endAngle,a=Math.floor(r/360),u=Math.floor(n/360),f=Math.min(a,u);return{startAngle:r-f*360,endAngle:n-f*360}},HAe=function(t,r){var n=r.startAngle,a=r.endAngle,u=Math.floor(n/360),f=Math.floor(a/360),i=Math.min(u,f);return t+i*360},Kq=function(t,r){var n=t.x,a=t.y,u=qAe({x:n,y:a},r),f=u.radius,i=u.angle,y=r.innerRadius,w=r.outerRadius;if(f<y||f>w)return!1;if(f===0)return!0;var T=GAe(r),A=T.startAngle,k=T.endAngle,F=i,D;if(A<=k){for(;F>k;)F-=360;for(;F<A;)F+=360;D=F>=A&&F<=k}else{for(;F>A;)F-=360;for(;F<k;)F+=360;D=F>=k&&F<=A}return D?Xq(Xq({},r),{},{radius:f,angle:HAe(F,r)}):null};function cb(e){"@babel/helpers - typeof";return cb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cb(e)}var WAe=["offset"];function ZAe(e){return JAe(e)||YAe(e)||KAe(e)||XAe()}function XAe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function KAe(e,t){if(e){if(typeof e=="string")return OL(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return OL(e,t)}}function YAe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function JAe(e){if(Array.isArray(e))return OL(e)}function OL(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function QAe(e,t){if(e==null)return{};var r=ePe(e,t),n,a;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(a=0;a<u.length;a++)n=u[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function ePe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Yq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ya(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Yq(Object(r),!0).forEach(function(n){tPe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Yq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function tPe(e,t,r){return t=rPe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function rPe(e){var t=nPe(e,"string");return cb(t)=="symbol"?t:t+""}function nPe(e,t){if(cb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(cb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ub(){return ub=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ub.apply(this,arguments)}var iPe=function(t){var r=t.value,n=t.formatter,a=Zi(t.children)?r:t.children;return Wi(n)?n(a):a},sPe=function(t,r){var n=Xd(r-t),a=Math.min(Math.abs(r-t),360);return n*a},oPe=function(t,r,n){var a=t.position,u=t.viewBox,f=t.offset,i=t.className,y=u,w=y.cx,T=y.cy,A=y.innerRadius,k=y.outerRadius,F=y.startAngle,D=y.endAngle,O=y.clockWise,N=(A+k)/2,V=sPe(F,D),H=V>=0?1:-1,Z,J;a==="insideStart"?(Z=F+H*f,J=O):a==="insideEnd"?(Z=D-H*f,J=!O):a==="end"&&(Z=D+H*f,J=O),J=V<=0?J:!J;var G=Za(w,T,N,Z),Y=Za(w,T,N,Z+(J?1:-1)*359),ie="M".concat(G.x,",").concat(G.y,`
    A`).concat(N,",").concat(N,",0,1,").concat(J?0:1,`,
    `).concat(Y.x,",").concat(Y.y),ce=Zi(t.id)?Gb("recharts-radial-line-"):t.id;return jt.createElement("text",ub({},n,{dominantBaseline:"central",className:Li("recharts-radial-bar-label",i)}),jt.createElement("defs",null,jt.createElement("path",{id:ce,d:ie})),jt.createElement("textPath",{xlinkHref:"#".concat(ce)},r))},aPe=function(t){var r=t.viewBox,n=t.offset,a=t.position,u=r,f=u.cx,i=u.cy,y=u.innerRadius,w=u.outerRadius,T=u.startAngle,A=u.endAngle,k=(T+A)/2;if(a==="outside"){var F=Za(f,i,w+n,k),D=F.x,O=F.y;return{x:D,y:O,textAnchor:D>=f?"start":"end",verticalAnchor:"middle"}}if(a==="center")return{x:f,y:i,textAnchor:"middle",verticalAnchor:"middle"};if(a==="centerTop")return{x:f,y:i,textAnchor:"middle",verticalAnchor:"start"};if(a==="centerBottom")return{x:f,y:i,textAnchor:"middle",verticalAnchor:"end"};var N=(y+w)/2,V=Za(f,i,N,k),H=V.x,Z=V.y;return{x:H,y:Z,textAnchor:"middle",verticalAnchor:"middle"}},lPe=function(t){var r=t.viewBox,n=t.parentViewBox,a=t.offset,u=t.position,f=r,i=f.x,y=f.y,w=f.width,T=f.height,A=T>=0?1:-1,k=A*a,F=A>0?"end":"start",D=A>0?"start":"end",O=w>=0?1:-1,N=O*a,V=O>0?"end":"start",H=O>0?"start":"end";if(u==="top"){var Z={x:i+w/2,y:y-A*a,textAnchor:"middle",verticalAnchor:F};return ya(ya({},Z),n?{height:Math.max(y-n.y,0),width:w}:{})}if(u==="bottom"){var J={x:i+w/2,y:y+T+k,textAnchor:"middle",verticalAnchor:D};return ya(ya({},J),n?{height:Math.max(n.y+n.height-(y+T),0),width:w}:{})}if(u==="left"){var G={x:i-N,y:y+T/2,textAnchor:V,verticalAnchor:"middle"};return ya(ya({},G),n?{width:Math.max(G.x-n.x,0),height:T}:{})}if(u==="right"){var Y={x:i+w+N,y:y+T/2,textAnchor:H,verticalAnchor:"middle"};return ya(ya({},Y),n?{width:Math.max(n.x+n.width-Y.x,0),height:T}:{})}var ie=n?{width:w,height:T}:{};return u==="insideLeft"?ya({x:i+N,y:y+T/2,textAnchor:H,verticalAnchor:"middle"},ie):u==="insideRight"?ya({x:i+w-N,y:y+T/2,textAnchor:V,verticalAnchor:"middle"},ie):u==="insideTop"?ya({x:i+w/2,y:y+k,textAnchor:"middle",verticalAnchor:D},ie):u==="insideBottom"?ya({x:i+w/2,y:y+T-k,textAnchor:"middle",verticalAnchor:F},ie):u==="insideTopLeft"?ya({x:i+N,y:y+k,textAnchor:H,verticalAnchor:D},ie):u==="insideTopRight"?ya({x:i+w-N,y:y+k,textAnchor:V,verticalAnchor:D},ie):u==="insideBottomLeft"?ya({x:i+N,y:y+T-k,textAnchor:H,verticalAnchor:F},ie):u==="insideBottomRight"?ya({x:i+w-N,y:y+T-k,textAnchor:V,verticalAnchor:F},ie):D_(u)&&(cn(u.x)||cy(u.x))&&(cn(u.y)||cy(u.y))?ya({x:i+Cy(u.x,w),y:y+Cy(u.y,T),textAnchor:"end",verticalAnchor:"end"},ie):ya({x:i+w/2,y:y+T/2,textAnchor:"middle",verticalAnchor:"middle"},ie)},cPe=function(t){return"cx"in t&&cn(t.cx)};function yl(e){var t=e.offset,r=t===void 0?5:t,n=QAe(e,WAe),a=ya({offset:r},n),u=a.viewBox,f=a.position,i=a.value,y=a.children,w=a.content,T=a.className,A=T===void 0?"":T,k=a.textBreakAll;if(!u||Zi(i)&&Zi(y)&&!j.isValidElement(w)&&!Wi(w))return null;if(j.isValidElement(w))return j.cloneElement(w,a);var F;if(Wi(w)){if(F=j.createElement(w,a),j.isValidElement(F))return F}else F=iPe(a);var D=cPe(u),O=ns(a,!0);if(D&&(f==="insideStart"||f==="insideEnd"||f==="end"))return oPe(a,F,O);var N=D?aPe(a):lPe(a);return jt.createElement(HS,ub({className:Li("recharts-label",A)},O,N,{breakAll:k}),F)}yl.displayName="Label";var kJ=function(t){var r=t.cx,n=t.cy,a=t.angle,u=t.startAngle,f=t.endAngle,i=t.r,y=t.radius,w=t.innerRadius,T=t.outerRadius,A=t.x,k=t.y,F=t.top,D=t.left,O=t.width,N=t.height,V=t.clockWise,H=t.labelViewBox;if(H)return H;if(cn(O)&&cn(N)){if(cn(A)&&cn(k))return{x:A,y:k,width:O,height:N};if(cn(F)&&cn(D))return{x:F,y:D,width:O,height:N}}return cn(A)&&cn(k)?{x:A,y:k,width:0,height:0}:cn(r)&&cn(n)?{cx:r,cy:n,startAngle:u||a||0,endAngle:f||a||0,innerRadius:w||0,outerRadius:T||y||i||0,clockWise:V}:t.viewBox?t.viewBox:{}},uPe=function(t,r){return t?t===!0?jt.createElement(yl,{key:"label-implicit",viewBox:r}):_a(t)?jt.createElement(yl,{key:"label-implicit",viewBox:r,value:t}):j.isValidElement(t)?t.type===yl?j.cloneElement(t,{key:"label-implicit",viewBox:r}):jt.createElement(yl,{key:"label-implicit",content:t,viewBox:r}):Wi(t)?jt.createElement(yl,{key:"label-implicit",content:t,viewBox:r}):D_(t)?jt.createElement(yl,ub({viewBox:r},t,{key:"label-implicit"})):null:null},dPe=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!t||!t.children&&n&&!t.label)return null;var a=t.children,u=kJ(t),f=Ku(a,yl).map(function(y,w){return j.cloneElement(y,{viewBox:r||u,key:"label-".concat(w)})});if(!n)return f;var i=uPe(t.label,r||u);return[i].concat(ZAe(f))};yl.parseViewBox=kJ;yl.renderCallByParent=dPe;var CI,Jq;function hPe(){if(Jq)return CI;Jq=1;function e(t){var r=t==null?0:t.length;return r?t[r-1]:void 0}return CI=e,CI}var fPe=hPe();const pPe=vs(fPe);function db(e){"@babel/helpers - typeof";return db=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},db(e)}var mPe=["valueAccessor"],gPe=["data","dataKey","clockWise","id","textBreakAll"];function yPe(e){return bPe(e)||xPe(e)||_Pe(e)||vPe()}function vPe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _Pe(e,t){if(e){if(typeof e=="string")return LL(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return LL(e,t)}}function xPe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function bPe(e){if(Array.isArray(e))return LL(e)}function LL(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function lE(){return lE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},lE.apply(this,arguments)}function Qq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function eG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Qq(Object(r),!0).forEach(function(n){wPe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function wPe(e,t,r){return t=SPe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function SPe(e){var t=EPe(e,"string");return db(t)=="symbol"?t:t+""}function EPe(e,t){if(db(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(db(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function tG(e,t){if(e==null)return{};var r=TPe(e,t),n,a;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(a=0;a<u.length;a++)n=u[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function TPe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var CPe=function(t){return Array.isArray(t.value)?pPe(t.value):t.value};function $m(e){var t=e.valueAccessor,r=t===void 0?CPe:t,n=tG(e,mPe),a=n.data,u=n.dataKey,f=n.clockWise,i=n.id,y=n.textBreakAll,w=tG(n,gPe);return!a||!a.length?null:jt.createElement($o,{className:"recharts-label-list"},a.map(function(T,A){var k=Zi(u)?r(T,A):du(T&&T.payload,u),F=Zi(i)?{}:{id:"".concat(i,"-").concat(A)};return jt.createElement(yl,lE({},ns(T,!0),w,F,{parentViewBox:T.parentViewBox,value:k,textBreakAll:y,viewBox:yl.parseViewBox(Zi(f)?T:eG(eG({},T),{},{clockWise:f})),key:"label-".concat(A),index:A}))}))}$m.displayName="LabelList";function APe(e,t){return e?e===!0?jt.createElement($m,{key:"labelList-implicit",data:t}):jt.isValidElement(e)||Wi(e)?jt.createElement($m,{key:"labelList-implicit",data:t,content:e}):D_(e)?jt.createElement($m,lE({data:t},e,{key:"labelList-implicit"})):null:null}function PPe(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&r&&!e.label)return null;var n=e.children,a=Ku(n,$m).map(function(f,i){return j.cloneElement(f,{data:t,key:"labelList-".concat(i)})});if(!r)return a;var u=APe(e.label,t);return[u].concat(yPe(a))}$m.renderCallByParent=PPe;function hb(e){"@babel/helpers - typeof";return hb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hb(e)}function RL(){return RL=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},RL.apply(this,arguments)}function rG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function nG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?rG(Object(r),!0).forEach(function(n){MPe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function MPe(e,t,r){return t=IPe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function IPe(e){var t=kPe(e,"string");return hb(t)=="symbol"?t:t+""}function kPe(e,t){if(hb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(hb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var OPe=function(t,r){var n=Xd(r-t),a=Math.min(Math.abs(r-t),359.999);return n*a},Ew=function(t){var r=t.cx,n=t.cy,a=t.radius,u=t.angle,f=t.sign,i=t.isExternal,y=t.cornerRadius,w=t.cornerIsExternal,T=y*(i?1:-1)+a,A=Math.asin(y/T)/aE,k=w?u:u+f*A,F=Za(r,n,T,k),D=Za(r,n,a,k),O=w?u-f*A:u,N=Za(r,n,T*Math.cos(A*aE),O);return{center:F,circleTangency:D,lineTangency:N,theta:A}},OJ=function(t){var r=t.cx,n=t.cy,a=t.innerRadius,u=t.outerRadius,f=t.startAngle,i=t.endAngle,y=OPe(f,i),w=f+y,T=Za(r,n,u,f),A=Za(r,n,u,w),k="M ".concat(T.x,",").concat(T.y,`
    A `).concat(u,",").concat(u,`,0,
    `).concat(+(Math.abs(y)>180),",").concat(+(f>w),`,
    `).concat(A.x,",").concat(A.y,`
  `);if(a>0){var F=Za(r,n,a,f),D=Za(r,n,a,w);k+="L ".concat(D.x,",").concat(D.y,`
            A `).concat(a,",").concat(a,`,0,
            `).concat(+(Math.abs(y)>180),",").concat(+(f<=w),`,
            `).concat(F.x,",").concat(F.y," Z")}else k+="L ".concat(r,",").concat(n," Z");return k},LPe=function(t){var r=t.cx,n=t.cy,a=t.innerRadius,u=t.outerRadius,f=t.cornerRadius,i=t.forceCornerRadius,y=t.cornerIsExternal,w=t.startAngle,T=t.endAngle,A=Xd(T-w),k=Ew({cx:r,cy:n,radius:u,angle:w,sign:A,cornerRadius:f,cornerIsExternal:y}),F=k.circleTangency,D=k.lineTangency,O=k.theta,N=Ew({cx:r,cy:n,radius:u,angle:T,sign:-A,cornerRadius:f,cornerIsExternal:y}),V=N.circleTangency,H=N.lineTangency,Z=N.theta,J=y?Math.abs(w-T):Math.abs(w-T)-O-Z;if(J<0)return i?"M ".concat(D.x,",").concat(D.y,`
        a`).concat(f,",").concat(f,",0,0,1,").concat(f*2,`,0
        a`).concat(f,",").concat(f,",0,0,1,").concat(-f*2,`,0
      `):OJ({cx:r,cy:n,innerRadius:a,outerRadius:u,startAngle:w,endAngle:T});var G="M ".concat(D.x,",").concat(D.y,`
    A`).concat(f,",").concat(f,",0,0,").concat(+(A<0),",").concat(F.x,",").concat(F.y,`
    A`).concat(u,",").concat(u,",0,").concat(+(J>180),",").concat(+(A<0),",").concat(V.x,",").concat(V.y,`
    A`).concat(f,",").concat(f,",0,0,").concat(+(A<0),",").concat(H.x,",").concat(H.y,`
  `);if(a>0){var Y=Ew({cx:r,cy:n,radius:a,angle:w,sign:A,isExternal:!0,cornerRadius:f,cornerIsExternal:y}),ie=Y.circleTangency,ce=Y.lineTangency,ge=Y.theta,be=Ew({cx:r,cy:n,radius:a,angle:T,sign:-A,isExternal:!0,cornerRadius:f,cornerIsExternal:y}),xe=be.circleTangency,Le=be.lineTangency,ze=be.theta,Xe=y?Math.abs(w-T):Math.abs(w-T)-ge-ze;if(Xe<0&&f===0)return"".concat(G,"L").concat(r,",").concat(n,"Z");G+="L".concat(Le.x,",").concat(Le.y,`
      A`).concat(f,",").concat(f,",0,0,").concat(+(A<0),",").concat(xe.x,",").concat(xe.y,`
      A`).concat(a,",").concat(a,",0,").concat(+(Xe>180),",").concat(+(A>0),",").concat(ie.x,",").concat(ie.y,`
      A`).concat(f,",").concat(f,",0,0,").concat(+(A<0),",").concat(ce.x,",").concat(ce.y,"Z")}else G+="L".concat(r,",").concat(n,"Z");return G},RPe={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},LJ=function(t){var r=nG(nG({},RPe),t),n=r.cx,a=r.cy,u=r.innerRadius,f=r.outerRadius,i=r.cornerRadius,y=r.forceCornerRadius,w=r.cornerIsExternal,T=r.startAngle,A=r.endAngle,k=r.className;if(f<u||T===A)return null;var F=Li("recharts-sector",k),D=f-u,O=Cy(i,D,0,!0),N;return O>0&&Math.abs(T-A)<360?N=LPe({cx:n,cy:a,innerRadius:u,outerRadius:f,cornerRadius:Math.min(O,D/2),forceCornerRadius:y,cornerIsExternal:w,startAngle:T,endAngle:A}):N=OJ({cx:n,cy:a,innerRadius:u,outerRadius:f,startAngle:T,endAngle:A}),jt.createElement("path",RL({},ns(r,!0),{className:F,d:N,role:"img"}))};function fb(e){"@babel/helpers - typeof";return fb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fb(e)}function jL(){return jL=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},jL.apply(this,arguments)}function iG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function sG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?iG(Object(r),!0).forEach(function(n){jPe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):iG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function jPe(e,t,r){return t=DPe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function DPe(e){var t=NPe(e,"string");return fb(t)=="symbol"?t:t+""}function NPe(e,t){if(fb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(fb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var oG={curveBasisClosed:r1e,curveBasisOpen:n1e,curveBasis:t1e,curveBumpX:$be,curveBumpY:Vbe,curveLinearClosed:i1e,curveLinear:m2,curveMonotoneX:s1e,curveMonotoneY:o1e,curveNatural:a1e,curveStep:l1e,curveStepAfter:u1e,curveStepBefore:c1e},Tw=function(t){return t.x===+t.x&&t.y===+t.y},Z0=function(t){return t.x},X0=function(t){return t.y},zPe=function(t,r){if(Wi(t))return t;var n="curve".concat(f2(t));return(n==="curveMonotone"||n==="curveBump")&&r?oG["".concat(n).concat(r==="vertical"?"Y":"X")]:oG[n]||m2},FPe=function(t){var r=t.type,n=r===void 0?"linear":r,a=t.points,u=a===void 0?[]:a,f=t.baseLine,i=t.layout,y=t.connectNulls,w=y===void 0?!1:y,T=zPe(n,i),A=w?u.filter(function(O){return Tw(O)}):u,k;if(Array.isArray(f)){var F=w?f.filter(function(O){return Tw(O)}):f,D=A.map(function(O,N){return sG(sG({},O),{},{base:F[N]})});return i==="vertical"?k=gw().y(X0).x1(Z0).x0(function(O){return O.base.x}):k=gw().x(Z0).y1(X0).y0(function(O){return O.base.y}),k.defined(Tw).curve(T),k(D)}return i==="vertical"&&cn(f)?k=gw().y(X0).x1(Z0).x0(f):cn(f)?k=gw().x(Z0).y1(X0).y0(f):k=zK().x(Z0).y(X0),k.defined(Tw).curve(T),k(A)},DL=function(t){var r=t.className,n=t.points,a=t.path,u=t.pathRef;if((!n||!n.length)&&!a)return null;var f=n&&n.length?FPe(t):a;return jt.createElement("path",jL({},ns(t,!1),RS(t),{className:Li("recharts-curve",r),d:f,ref:u}))},AI={exports:{}},PI,aG;function BPe(){if(aG)return PI;aG=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return PI=e,PI}var MI,lG;function $Pe(){if(lG)return MI;lG=1;var e=BPe();function t(){}function r(){}return r.resetWarningCache=t,MI=function(){function n(f,i,y,w,T,A){if(A!==e){var k=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw k.name="Invariant Violation",k}}n.isRequired=n;function a(){return n}var u={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:a,element:n,elementType:n,instanceOf:a,node:n,objectOf:a,oneOf:a,oneOfType:a,shape:a,exact:a,checkPropTypes:r,resetWarningCache:t};return u.PropTypes=u,u},MI}var cG;function VPe(){return cG||(cG=1,AI.exports=$Pe()()),AI.exports}var UPe=VPe();const Ts=vs(UPe);var qPe=Object.getOwnPropertyNames,GPe=Object.getOwnPropertySymbols,HPe=Object.prototype.hasOwnProperty;function uG(e,t){return function(n,a,u){return e(n,a,u)&&t(n,a,u)}}function Cw(e){return function(r,n,a){if(!r||!n||typeof r!="object"||typeof n!="object")return e(r,n,a);var u=a.cache,f=u.get(r),i=u.get(n);if(f&&i)return f===n&&i===r;u.set(r,n),u.set(n,r);var y=e(r,n,a);return u.delete(r),u.delete(n),y}}function dG(e){return qPe(e).concat(GPe(e))}var WPe=Object.hasOwn||function(e,t){return HPe.call(e,t)};function Dy(e,t){return e===t||!e&&!t&&e!==e&&t!==t}var ZPe="__v",XPe="__o",KPe="_owner",hG=Object.getOwnPropertyDescriptor,fG=Object.keys;function YPe(e,t,r){var n=e.length;if(t.length!==n)return!1;for(;n-- >0;)if(!r.equals(e[n],t[n],n,n,e,t,r))return!1;return!0}function JPe(e,t){return Dy(e.getTime(),t.getTime())}function QPe(e,t){return e.name===t.name&&e.message===t.message&&e.cause===t.cause&&e.stack===t.stack}function eMe(e,t){return e===t}function pG(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var a=new Array(n),u=e.entries(),f,i,y=0;(f=u.next())&&!f.done;){for(var w=t.entries(),T=!1,A=0;(i=w.next())&&!i.done;){if(a[A]){A++;continue}var k=f.value,F=i.value;if(r.equals(k[0],F[0],y,A,e,t,r)&&r.equals(k[1],F[1],k[0],F[0],e,t,r)){T=a[A]=!0;break}A++}if(!T)return!1;y++}return!0}var tMe=Dy;function rMe(e,t,r){var n=fG(e),a=n.length;if(fG(t).length!==a)return!1;for(;a-- >0;)if(!RJ(e,t,r,n[a]))return!1;return!0}function K0(e,t,r){var n=dG(e),a=n.length;if(dG(t).length!==a)return!1;for(var u,f,i;a-- >0;)if(u=n[a],!RJ(e,t,r,u)||(f=hG(e,u),i=hG(t,u),(f||i)&&(!f||!i||f.configurable!==i.configurable||f.enumerable!==i.enumerable||f.writable!==i.writable)))return!1;return!0}function nMe(e,t){return Dy(e.valueOf(),t.valueOf())}function iMe(e,t){return e.source===t.source&&e.flags===t.flags}function mG(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var a=new Array(n),u=e.values(),f,i;(f=u.next())&&!f.done;){for(var y=t.values(),w=!1,T=0;(i=y.next())&&!i.done;){if(!a[T]&&r.equals(f.value,i.value,f.value,i.value,e,t,r)){w=a[T]=!0;break}T++}if(!w)return!1}return!0}function sMe(e,t){var r=e.length;if(t.length!==r)return!1;for(;r-- >0;)if(e[r]!==t[r])return!1;return!0}function oMe(e,t){return e.hostname===t.hostname&&e.pathname===t.pathname&&e.protocol===t.protocol&&e.port===t.port&&e.hash===t.hash&&e.username===t.username&&e.password===t.password}function RJ(e,t,r,n){return(n===KPe||n===XPe||n===ZPe)&&(e.$$typeof||t.$$typeof)?!0:WPe(t,n)&&r.equals(e[n],t[n],n,n,e,t,r)}var aMe="[object Arguments]",lMe="[object Boolean]",cMe="[object Date]",uMe="[object Error]",dMe="[object Map]",hMe="[object Number]",fMe="[object Object]",pMe="[object RegExp]",mMe="[object Set]",gMe="[object String]",yMe="[object URL]",vMe=Array.isArray,gG=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,yG=Object.assign,_Me=Object.prototype.toString.call.bind(Object.prototype.toString);function xMe(e){var t=e.areArraysEqual,r=e.areDatesEqual,n=e.areErrorsEqual,a=e.areFunctionsEqual,u=e.areMapsEqual,f=e.areNumbersEqual,i=e.areObjectsEqual,y=e.arePrimitiveWrappersEqual,w=e.areRegExpsEqual,T=e.areSetsEqual,A=e.areTypedArraysEqual,k=e.areUrlsEqual;return function(D,O,N){if(D===O)return!0;if(D==null||O==null)return!1;var V=typeof D;if(V!==typeof O)return!1;if(V!=="object")return V==="number"?f(D,O,N):V==="function"?a(D,O,N):!1;var H=D.constructor;if(H!==O.constructor)return!1;if(H===Object)return i(D,O,N);if(vMe(D))return t(D,O,N);if(gG!=null&&gG(D))return A(D,O,N);if(H===Date)return r(D,O,N);if(H===RegExp)return w(D,O,N);if(H===Map)return u(D,O,N);if(H===Set)return T(D,O,N);var Z=_Me(D);return Z===cMe?r(D,O,N):Z===pMe?w(D,O,N):Z===dMe?u(D,O,N):Z===mMe?T(D,O,N):Z===fMe?typeof D.then!="function"&&typeof O.then!="function"&&i(D,O,N):Z===yMe?k(D,O,N):Z===uMe?n(D,O,N):Z===aMe?i(D,O,N):Z===lMe||Z===hMe||Z===gMe?y(D,O,N):!1}}function bMe(e){var t=e.circular,r=e.createCustomConfig,n=e.strict,a={areArraysEqual:n?K0:YPe,areDatesEqual:JPe,areErrorsEqual:QPe,areFunctionsEqual:eMe,areMapsEqual:n?uG(pG,K0):pG,areNumbersEqual:tMe,areObjectsEqual:n?K0:rMe,arePrimitiveWrappersEqual:nMe,areRegExpsEqual:iMe,areSetsEqual:n?uG(mG,K0):mG,areTypedArraysEqual:n?K0:sMe,areUrlsEqual:oMe};if(r&&(a=yG({},a,r(a))),t){var u=Cw(a.areArraysEqual),f=Cw(a.areMapsEqual),i=Cw(a.areObjectsEqual),y=Cw(a.areSetsEqual);a=yG({},a,{areArraysEqual:u,areMapsEqual:f,areObjectsEqual:i,areSetsEqual:y})}return a}function wMe(e){return function(t,r,n,a,u,f,i){return e(t,r,i)}}function SMe(e){var t=e.circular,r=e.comparator,n=e.createState,a=e.equals,u=e.strict;if(n)return function(y,w){var T=n(),A=T.cache,k=A===void 0?t?new WeakMap:void 0:A,F=T.meta;return r(y,w,{cache:k,equals:a,meta:F,strict:u})};if(t)return function(y,w){return r(y,w,{cache:new WeakMap,equals:a,meta:void 0,strict:u})};var f={cache:void 0,equals:a,meta:void 0,strict:u};return function(y,w){return r(y,w,f)}}var EMe=rg();rg({strict:!0});rg({circular:!0});rg({circular:!0,strict:!0});rg({createInternalComparator:function(){return Dy}});rg({strict:!0,createInternalComparator:function(){return Dy}});rg({circular:!0,createInternalComparator:function(){return Dy}});rg({circular:!0,createInternalComparator:function(){return Dy},strict:!0});function rg(e){e===void 0&&(e={});var t=e.circular,r=t===void 0?!1:t,n=e.createInternalComparator,a=e.createState,u=e.strict,f=u===void 0?!1:u,i=bMe(e),y=xMe(i),w=n?n(y):wMe(y);return SMe({circular:r,comparator:y,createState:a,equals:w,strict:f})}function TMe(e){typeof requestAnimationFrame<"u"&&requestAnimationFrame(e)}function vG(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=-1,n=function a(u){r<0&&(r=u),u-r>t?(e(u),r=-1):TMe(a)};requestAnimationFrame(n)}function NL(e){"@babel/helpers - typeof";return NL=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},NL(e)}function CMe(e){return IMe(e)||MMe(e)||PMe(e)||AMe()}function AMe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function PMe(e,t){if(e){if(typeof e=="string")return _G(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _G(e,t)}}function _G(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function MMe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function IMe(e){if(Array.isArray(e))return e}function kMe(){var e={},t=function(){return null},r=!1,n=function a(u){if(!r){if(Array.isArray(u)){if(!u.length)return;var f=u,i=CMe(f),y=i[0],w=i.slice(1);if(typeof y=="number"){vG(a.bind(null,w),y);return}a(y),vG(a.bind(null,w));return}NL(u)==="object"&&(e=u,t(e)),typeof u=="function"&&u()}};return{stop:function(){r=!0},start:function(u){r=!1,n(u)},subscribe:function(u){return t=u,function(){t=function(){return null}}}}}function pb(e){"@babel/helpers - typeof";return pb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pb(e)}function xG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function bG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?xG(Object(r),!0).forEach(function(n){jJ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function jJ(e,t,r){return t=OMe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function OMe(e){var t=LMe(e,"string");return pb(t)==="symbol"?t:String(t)}function LMe(e,t){if(pb(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(pb(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var RMe=function(t,r){return[Object.keys(t),Object.keys(r)].reduce(function(n,a){return n.filter(function(u){return a.includes(u)})})},jMe=function(t){return t},DMe=function(t){return t.replace(/([A-Z])/g,function(r){return"-".concat(r.toLowerCase())})},Ex=function(t,r){return Object.keys(r).reduce(function(n,a){return bG(bG({},n),{},jJ({},a,t(a,r[a])))},{})},wG=function(t,r,n){return t.map(function(a){return"".concat(DMe(a)," ").concat(r,"ms ").concat(n)}).join(",")};function NMe(e,t){return BMe(e)||FMe(e,t)||DJ(e,t)||zMe()}function zMe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function FMe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,u,f,i=[],y=!0,w=!1;try{if(u=(r=r.call(e)).next,t!==0)for(;!(y=(n=u.call(r)).done)&&(i.push(n.value),i.length!==t);y=!0);}catch(T){w=!0,a=T}finally{try{if(!y&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(w)throw a}}return i}}function BMe(e){if(Array.isArray(e))return e}function $Me(e){return qMe(e)||UMe(e)||DJ(e)||VMe()}function VMe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function DJ(e,t){if(e){if(typeof e=="string")return zL(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zL(e,t)}}function UMe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function qMe(e){if(Array.isArray(e))return zL(e)}function zL(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var cE=1e-4,NJ=function(t,r){return[0,3*t,3*r-6*t,3*t-3*r+1]},zJ=function(t,r){return t.map(function(n,a){return n*Math.pow(r,a)}).reduce(function(n,a){return n+a})},SG=function(t,r){return function(n){var a=NJ(t,r);return zJ(a,n)}},GMe=function(t,r){return function(n){var a=NJ(t,r),u=[].concat($Me(a.map(function(f,i){return f*i}).slice(1)),[0]);return zJ(u,n)}},EG=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var a=r[0],u=r[1],f=r[2],i=r[3];if(r.length===1)switch(r[0]){case"linear":a=0,u=0,f=1,i=1;break;case"ease":a=.25,u=.1,f=.25,i=1;break;case"ease-in":a=.42,u=0,f=1,i=1;break;case"ease-out":a=.42,u=0,f=.58,i=1;break;case"ease-in-out":a=0,u=0,f=.58,i=1;break;default:{var y=r[0].split("(");if(y[0]==="cubic-bezier"&&y[1].split(")")[0].split(",").length===4){var w=y[1].split(")")[0].split(",").map(function(N){return parseFloat(N)}),T=NMe(w,4);a=T[0],u=T[1],f=T[2],i=T[3]}}}var A=SG(a,f),k=SG(u,i),F=GMe(a,f),D=function(V){return V>1?1:V<0?0:V},O=function(V){for(var H=V>1?1:V,Z=H,J=0;J<8;++J){var G=A(Z)-H,Y=F(Z);if(Math.abs(G-H)<cE||Y<cE)return k(Z);Z=D(Z-G/Y)}return k(Z)};return O.isStepper=!1,O},HMe=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.stiff,n=r===void 0?100:r,a=t.damping,u=a===void 0?8:a,f=t.dt,i=f===void 0?17:f,y=function(T,A,k){var F=-(T-A)*n,D=k*u,O=k+(F-D)*i/1e3,N=k*i/1e3+T;return Math.abs(N-A)<cE&&Math.abs(O)<cE?[A,0]:[N,O]};return y.isStepper=!0,y.dt=i,y},WMe=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var a=r[0];if(typeof a=="string")switch(a){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return EG(a);case"spring":return HMe();default:if(a.split("(")[0]==="cubic-bezier")return EG(a)}return typeof a=="function"?a:null};function mb(e){"@babel/helpers - typeof";return mb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mb(e)}function TG(e){return KMe(e)||XMe(e)||FJ(e)||ZMe()}function ZMe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function XMe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function KMe(e){if(Array.isArray(e))return BL(e)}function CG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ha(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?CG(Object(r),!0).forEach(function(n){FL(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):CG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function FL(e,t,r){return t=YMe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function YMe(e){var t=JMe(e,"string");return mb(t)==="symbol"?t:String(t)}function JMe(e,t){if(mb(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(mb(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function QMe(e,t){return rIe(e)||tIe(e,t)||FJ(e,t)||eIe()}function eIe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function FJ(e,t){if(e){if(typeof e=="string")return BL(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return BL(e,t)}}function BL(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function tIe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,u,f,i=[],y=!0,w=!1;try{if(u=(r=r.call(e)).next,t!==0)for(;!(y=(n=u.call(r)).done)&&(i.push(n.value),i.length!==t);y=!0);}catch(T){w=!0,a=T}finally{try{if(!y&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(w)throw a}}return i}}function rIe(e){if(Array.isArray(e))return e}var uE=function(t,r,n){return t+(r-t)*n},$L=function(t){var r=t.from,n=t.to;return r!==n},nIe=function e(t,r,n){var a=Ex(function(u,f){if($L(f)){var i=t(f.from,f.to,f.velocity),y=QMe(i,2),w=y[0],T=y[1];return Ha(Ha({},f),{},{from:w,velocity:T})}return f},r);return n<1?Ex(function(u,f){return $L(f)?Ha(Ha({},f),{},{velocity:uE(f.velocity,a[u].velocity,n),from:uE(f.from,a[u].from,n)}):f},r):e(t,a,n-1)};const iIe=function(e,t,r,n,a){var u=RMe(e,t),f=u.reduce(function(N,V){return Ha(Ha({},N),{},FL({},V,[e[V],t[V]]))},{}),i=u.reduce(function(N,V){return Ha(Ha({},N),{},FL({},V,{from:e[V],velocity:0,to:t[V]}))},{}),y=-1,w,T,A=function(){return null},k=function(){return Ex(function(V,H){return H.from},i)},F=function(){return!Object.values(i).filter($L).length},D=function(V){w||(w=V);var H=V-w,Z=H/r.dt;i=nIe(r,i,Z),a(Ha(Ha(Ha({},e),t),k())),w=V,F()||(y=requestAnimationFrame(A))},O=function(V){T||(T=V);var H=(V-T)/n,Z=Ex(function(G,Y){return uE.apply(void 0,TG(Y).concat([r(H)]))},f);if(a(Ha(Ha(Ha({},e),t),Z)),H<1)y=requestAnimationFrame(A);else{var J=Ex(function(G,Y){return uE.apply(void 0,TG(Y).concat([r(1)]))},f);a(Ha(Ha(Ha({},e),t),J))}};return A=r.isStepper?D:O,function(){return requestAnimationFrame(A),function(){cancelAnimationFrame(y)}}};function d_(e){"@babel/helpers - typeof";return d_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d_(e)}var sIe=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function oIe(e,t){if(e==null)return{};var r=aIe(e,t),n,a;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(a=0;a<u.length;a++)n=u[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function aIe(e,t){if(e==null)return{};var r={},n=Object.keys(e),a,u;for(u=0;u<n.length;u++)a=n[u],!(t.indexOf(a)>=0)&&(r[a]=e[a]);return r}function II(e){return dIe(e)||uIe(e)||cIe(e)||lIe()}function lIe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cIe(e,t){if(e){if(typeof e=="string")return VL(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return VL(e,t)}}function uIe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function dIe(e){if(Array.isArray(e))return VL(e)}function VL(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function AG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ud(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?AG(Object(r),!0).forEach(function(n){ux(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):AG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ux(e,t,r){return t=BJ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function hIe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function fIe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,BJ(n.key),n)}}function pIe(e,t,r){return t&&fIe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function BJ(e){var t=mIe(e,"string");return d_(t)==="symbol"?t:String(t)}function mIe(e,t){if(d_(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(d_(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function gIe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&UL(e,t)}function UL(e,t){return UL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},UL(e,t)}function yIe(e){var t=vIe();return function(){var n=dE(e),a;if(t){var u=dE(this).constructor;a=Reflect.construct(n,arguments,u)}else a=n.apply(this,arguments);return qL(this,a)}}function qL(e,t){if(t&&(d_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return GL(e)}function GL(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function vIe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function dE(e){return dE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},dE(e)}var Tp=function(e){gIe(r,e);var t=yIe(r);function r(n,a){var u;hIe(this,r),u=t.call(this,n,a);var f=u.props,i=f.isActive,y=f.attributeName,w=f.from,T=f.to,A=f.steps,k=f.children,F=f.duration;if(u.handleStyleChange=u.handleStyleChange.bind(GL(u)),u.changeStyle=u.changeStyle.bind(GL(u)),!i||F<=0)return u.state={style:{}},typeof k=="function"&&(u.state={style:T}),qL(u);if(A&&A.length)u.state={style:A[0].style};else if(w){if(typeof k=="function")return u.state={style:w},qL(u);u.state={style:y?ux({},y,w):w}}else u.state={style:{}};return u}return pIe(r,[{key:"componentDidMount",value:function(){var a=this.props,u=a.isActive,f=a.canBegin;this.mounted=!0,!(!u||!f)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(a){var u=this.props,f=u.isActive,i=u.canBegin,y=u.attributeName,w=u.shouldReAnimate,T=u.to,A=u.from,k=this.state.style;if(i){if(!f){var F={style:y?ux({},y,T):T};this.state&&k&&(y&&k[y]!==T||!y&&k!==T)&&this.setState(F);return}if(!(EMe(a.to,T)&&a.canBegin&&a.isActive)){var D=!a.canBegin||!a.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var O=D||w?A:a.to;if(this.state&&k){var N={style:y?ux({},y,O):O};(y&&k[y]!==O||!y&&k!==O)&&this.setState(N)}this.runAnimation(Ud(Ud({},this.props),{},{from:O,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var a=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),a&&a()}},{key:"handleStyleChange",value:function(a){this.changeStyle(a)}},{key:"changeStyle",value:function(a){this.mounted&&this.setState({style:a})}},{key:"runJSAnimation",value:function(a){var u=this,f=a.from,i=a.to,y=a.duration,w=a.easing,T=a.begin,A=a.onAnimationEnd,k=a.onAnimationStart,F=iIe(f,i,WMe(w),y,this.changeStyle),D=function(){u.stopJSAnimation=F()};this.manager.start([k,T,D,y,A])}},{key:"runStepAnimation",value:function(a){var u=this,f=a.steps,i=a.begin,y=a.onAnimationStart,w=f[0],T=w.style,A=w.duration,k=A===void 0?0:A,F=function(O,N,V){if(V===0)return O;var H=N.duration,Z=N.easing,J=Z===void 0?"ease":Z,G=N.style,Y=N.properties,ie=N.onAnimationEnd,ce=V>0?f[V-1]:N,ge=Y||Object.keys(G);if(typeof J=="function"||J==="spring")return[].concat(II(O),[u.runJSAnimation.bind(u,{from:ce.style,to:G,duration:H,easing:J}),H]);var be=wG(ge,H,J),xe=Ud(Ud(Ud({},ce.style),G),{},{transition:be});return[].concat(II(O),[xe,H,ie]).filter(jMe)};return this.manager.start([y].concat(II(f.reduce(F,[T,Math.max(k,i)])),[a.onAnimationEnd]))}},{key:"runAnimation",value:function(a){this.manager||(this.manager=kMe());var u=a.begin,f=a.duration,i=a.attributeName,y=a.to,w=a.easing,T=a.onAnimationStart,A=a.onAnimationEnd,k=a.steps,F=a.children,D=this.manager;if(this.unSubscribe=D.subscribe(this.handleStyleChange),typeof w=="function"||typeof F=="function"||w==="spring"){this.runJSAnimation(a);return}if(k.length>1){this.runStepAnimation(a);return}var O=i?ux({},i,y):y,N=wG(Object.keys(O),f,w);D.start([T,u,Ud(Ud({},O),{},{transition:N}),f,A])}},{key:"render",value:function(){var a=this.props,u=a.children;a.begin;var f=a.duration;a.attributeName,a.easing;var i=a.isActive;a.steps,a.from,a.to,a.canBegin,a.onAnimationEnd,a.shouldReAnimate,a.onAnimationReStart;var y=oIe(a,sIe),w=j.Children.count(u),T=this.state.style;if(typeof u=="function")return u(T);if(!i||w===0||f<=0)return u;var A=function(F){var D=F.props,O=D.style,N=O===void 0?{}:O,V=D.className,H=j.cloneElement(F,Ud(Ud({},y),{},{style:Ud(Ud({},N),T),className:V}));return H};return w===1?A(j.Children.only(u)):jt.createElement("div",null,j.Children.map(u,function(k){return A(k)}))}}]),r}(j.PureComponent);Tp.displayName="Animate";Tp.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};Tp.propTypes={from:Ts.oneOfType([Ts.object,Ts.string]),to:Ts.oneOfType([Ts.object,Ts.string]),attributeName:Ts.string,duration:Ts.number,begin:Ts.number,easing:Ts.oneOfType([Ts.string,Ts.func]),steps:Ts.arrayOf(Ts.shape({duration:Ts.number.isRequired,style:Ts.object.isRequired,easing:Ts.oneOfType([Ts.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),Ts.func]),properties:Ts.arrayOf("string"),onAnimationEnd:Ts.func})),children:Ts.oneOfType([Ts.node,Ts.func]),isActive:Ts.bool,canBegin:Ts.bool,onAnimationEnd:Ts.func,shouldReAnimate:Ts.bool,onAnimationStart:Ts.func,onAnimationReStart:Ts.func};function gb(e){"@babel/helpers - typeof";return gb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gb(e)}function hE(){return hE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},hE.apply(this,arguments)}function _Ie(e,t){return SIe(e)||wIe(e,t)||bIe(e,t)||xIe()}function xIe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bIe(e,t){if(e){if(typeof e=="string")return PG(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return PG(e,t)}}function PG(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function wIe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,u,f,i=[],y=!0,w=!1;try{if(u=(r=r.call(e)).next,t!==0)for(;!(y=(n=u.call(r)).done)&&(i.push(n.value),i.length!==t);y=!0);}catch(T){w=!0,a=T}finally{try{if(!y&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(w)throw a}}return i}}function SIe(e){if(Array.isArray(e))return e}function MG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function IG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?MG(Object(r),!0).forEach(function(n){EIe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):MG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function EIe(e,t,r){return t=TIe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function TIe(e){var t=CIe(e,"string");return gb(t)=="symbol"?t:t+""}function CIe(e,t){if(gb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(gb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var kG=function(t,r,n,a,u){var f=Math.min(Math.abs(n)/2,Math.abs(a)/2),i=a>=0?1:-1,y=n>=0?1:-1,w=a>=0&&n>=0||a<0&&n<0?1:0,T;if(f>0&&u instanceof Array){for(var A=[0,0,0,0],k=0,F=4;k<F;k++)A[k]=u[k]>f?f:u[k];T="M".concat(t,",").concat(r+i*A[0]),A[0]>0&&(T+="A ".concat(A[0],",").concat(A[0],",0,0,").concat(w,",").concat(t+y*A[0],",").concat(r)),T+="L ".concat(t+n-y*A[1],",").concat(r),A[1]>0&&(T+="A ".concat(A[1],",").concat(A[1],",0,0,").concat(w,`,
        `).concat(t+n,",").concat(r+i*A[1])),T+="L ".concat(t+n,",").concat(r+a-i*A[2]),A[2]>0&&(T+="A ".concat(A[2],",").concat(A[2],",0,0,").concat(w,`,
        `).concat(t+n-y*A[2],",").concat(r+a)),T+="L ".concat(t+y*A[3],",").concat(r+a),A[3]>0&&(T+="A ".concat(A[3],",").concat(A[3],",0,0,").concat(w,`,
        `).concat(t,",").concat(r+a-i*A[3])),T+="Z"}else if(f>0&&u===+u&&u>0){var D=Math.min(f,u);T="M ".concat(t,",").concat(r+i*D,`
            A `).concat(D,",").concat(D,",0,0,").concat(w,",").concat(t+y*D,",").concat(r,`
            L `).concat(t+n-y*D,",").concat(r,`
            A `).concat(D,",").concat(D,",0,0,").concat(w,",").concat(t+n,",").concat(r+i*D,`
            L `).concat(t+n,",").concat(r+a-i*D,`
            A `).concat(D,",").concat(D,",0,0,").concat(w,",").concat(t+n-y*D,",").concat(r+a,`
            L `).concat(t+y*D,",").concat(r+a,`
            A `).concat(D,",").concat(D,",0,0,").concat(w,",").concat(t,",").concat(r+a-i*D," Z")}else T="M ".concat(t,",").concat(r," h ").concat(n," v ").concat(a," h ").concat(-n," Z");return T},AIe=function(t,r){if(!t||!r)return!1;var n=t.x,a=t.y,u=r.x,f=r.y,i=r.width,y=r.height;if(Math.abs(i)>0&&Math.abs(y)>0){var w=Math.min(u,u+i),T=Math.max(u,u+i),A=Math.min(f,f+y),k=Math.max(f,f+y);return n>=w&&n<=T&&a>=A&&a<=k}return!1},PIe={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},LD=function(t){var r=IG(IG({},PIe),t),n=j.useRef(),a=j.useState(-1),u=_Ie(a,2),f=u[0],i=u[1];j.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var J=n.current.getTotalLength();J&&i(J)}catch{}},[]);var y=r.x,w=r.y,T=r.width,A=r.height,k=r.radius,F=r.className,D=r.animationEasing,O=r.animationDuration,N=r.animationBegin,V=r.isAnimationActive,H=r.isUpdateAnimationActive;if(y!==+y||w!==+w||T!==+T||A!==+A||T===0||A===0)return null;var Z=Li("recharts-rectangle",F);return H?jt.createElement(Tp,{canBegin:f>0,from:{width:T,height:A,x:y,y:w},to:{width:T,height:A,x:y,y:w},duration:O,animationEasing:D,isActive:H},function(J){var G=J.width,Y=J.height,ie=J.x,ce=J.y;return jt.createElement(Tp,{canBegin:f>0,from:"0px ".concat(f===-1?1:f,"px"),to:"".concat(f,"px 0px"),attributeName:"strokeDasharray",begin:N,duration:O,isActive:V,easing:D},jt.createElement("path",hE({},ns(r,!0),{className:Z,d:kG(ie,ce,G,Y,k),ref:n})))}):jt.createElement("path",hE({},ns(r,!0),{className:Z,d:kG(y,w,T,A,k)}))};function HL(){return HL=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},HL.apply(this,arguments)}var RD=function(t){var r=t.cx,n=t.cy,a=t.r,u=t.className,f=Li("recharts-dot",u);return r===+r&&n===+n&&a===+a?jt.createElement("circle",HL({},ns(t,!1),RS(t),{className:f,cx:r,cy:n,r:a})):null};function yb(e){"@babel/helpers - typeof";return yb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yb(e)}var MIe=["x","y","top","left","width","height","className"];function WL(){return WL=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},WL.apply(this,arguments)}function OG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function IIe(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?OG(Object(r),!0).forEach(function(n){kIe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):OG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function kIe(e,t,r){return t=OIe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function OIe(e){var t=LIe(e,"string");return yb(t)=="symbol"?t:t+""}function LIe(e,t){if(yb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(yb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function RIe(e,t){if(e==null)return{};var r=jIe(e,t),n,a;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(a=0;a<u.length;a++)n=u[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function jIe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var DIe=function(t,r,n,a,u,f){return"M".concat(t,",").concat(u,"v").concat(a,"M").concat(f,",").concat(r,"h").concat(n)},NIe=function(t){var r=t.x,n=r===void 0?0:r,a=t.y,u=a===void 0?0:a,f=t.top,i=f===void 0?0:f,y=t.left,w=y===void 0?0:y,T=t.width,A=T===void 0?0:T,k=t.height,F=k===void 0?0:k,D=t.className,O=RIe(t,MIe),N=IIe({x:n,y:u,top:i,left:w,width:A,height:F},O);return!cn(n)||!cn(u)||!cn(A)||!cn(F)||!cn(i)||!cn(w)?null:jt.createElement("path",WL({},ns(N,!0),{className:Li("recharts-cross",D),d:DIe(n,u,A,F,i,w)}))},kI,LG;function zIe(){if(LG)return kI;LG=1;var e=aY(),t=e(Object.getPrototypeOf,Object);return kI=t,kI}var OI,RG;function FIe(){if(RG)return OI;RG=1;var e=Pp(),t=zIe(),r=Mp(),n="[object Object]",a=Function.prototype,u=Object.prototype,f=a.toString,i=u.hasOwnProperty,y=f.call(Object);function w(T){if(!r(T)||e(T)!=n)return!1;var A=t(T);if(A===null)return!0;var k=i.call(A,"constructor")&&A.constructor;return typeof k=="function"&&k instanceof k&&f.call(k)==y}return OI=w,OI}var BIe=FIe();const $Ie=vs(BIe);var LI,jG;function VIe(){if(jG)return LI;jG=1;var e=Pp(),t=Mp(),r="[object Boolean]";function n(a){return a===!0||a===!1||t(a)&&e(a)==r}return LI=n,LI}var UIe=VIe();const qIe=vs(UIe);function vb(e){"@babel/helpers - typeof";return vb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vb(e)}function fE(){return fE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},fE.apply(this,arguments)}function GIe(e,t){return XIe(e)||ZIe(e,t)||WIe(e,t)||HIe()}function HIe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function WIe(e,t){if(e){if(typeof e=="string")return DG(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return DG(e,t)}}function DG(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ZIe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,u,f,i=[],y=!0,w=!1;try{if(u=(r=r.call(e)).next,t!==0)for(;!(y=(n=u.call(r)).done)&&(i.push(n.value),i.length!==t);y=!0);}catch(T){w=!0,a=T}finally{try{if(!y&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(w)throw a}}return i}}function XIe(e){if(Array.isArray(e))return e}function NG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function zG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?NG(Object(r),!0).forEach(function(n){KIe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):NG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function KIe(e,t,r){return t=YIe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function YIe(e){var t=JIe(e,"string");return vb(t)=="symbol"?t:t+""}function JIe(e,t){if(vb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(vb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var FG=function(t,r,n,a,u){var f=n-a,i;return i="M ".concat(t,",").concat(r),i+="L ".concat(t+n,",").concat(r),i+="L ".concat(t+n-f/2,",").concat(r+u),i+="L ".concat(t+n-f/2-a,",").concat(r+u),i+="L ".concat(t,",").concat(r," Z"),i},QIe={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},eke=function(t){var r=zG(zG({},QIe),t),n=j.useRef(),a=j.useState(-1),u=GIe(a,2),f=u[0],i=u[1];j.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var Z=n.current.getTotalLength();Z&&i(Z)}catch{}},[]);var y=r.x,w=r.y,T=r.upperWidth,A=r.lowerWidth,k=r.height,F=r.className,D=r.animationEasing,O=r.animationDuration,N=r.animationBegin,V=r.isUpdateAnimationActive;if(y!==+y||w!==+w||T!==+T||A!==+A||k!==+k||T===0&&A===0||k===0)return null;var H=Li("recharts-trapezoid",F);return V?jt.createElement(Tp,{canBegin:f>0,from:{upperWidth:0,lowerWidth:0,height:k,x:y,y:w},to:{upperWidth:T,lowerWidth:A,height:k,x:y,y:w},duration:O,animationEasing:D,isActive:V},function(Z){var J=Z.upperWidth,G=Z.lowerWidth,Y=Z.height,ie=Z.x,ce=Z.y;return jt.createElement(Tp,{canBegin:f>0,from:"0px ".concat(f===-1?1:f,"px"),to:"".concat(f,"px 0px"),attributeName:"strokeDasharray",begin:N,duration:O,easing:D},jt.createElement("path",fE({},ns(r,!0),{className:H,d:FG(ie,ce,J,G,Y),ref:n})))}):jt.createElement("g",null,jt.createElement("path",fE({},ns(r,!0),{className:H,d:FG(y,w,T,A,k)})))},tke=["option","shapeType","propTransformer","activeClassName","isActive"];function _b(e){"@babel/helpers - typeof";return _b=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_b(e)}function rke(e,t){if(e==null)return{};var r=nke(e,t),n,a;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(a=0;a<u.length;a++)n=u[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function nke(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function BG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function pE(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?BG(Object(r),!0).forEach(function(n){ike(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):BG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ike(e,t,r){return t=ske(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ske(e){var t=oke(e,"string");return _b(t)=="symbol"?t:t+""}function oke(e,t){if(_b(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(_b(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ake(e,t){return pE(pE({},t),e)}function lke(e,t){return e==="symbols"}function $G(e){var t=e.shapeType,r=e.elementProps;switch(t){case"rectangle":return jt.createElement(LD,r);case"trapezoid":return jt.createElement(eke,r);case"sector":return jt.createElement(LJ,r);case"symbols":if(lke(t))return jt.createElement(Jj,r);break;default:return null}}function cke(e){return j.isValidElement(e)?e.props:e}function uke(e){var t=e.option,r=e.shapeType,n=e.propTransformer,a=n===void 0?ake:n,u=e.activeClassName,f=u===void 0?"recharts-active-shape":u,i=e.isActive,y=rke(e,tke),w;if(j.isValidElement(t))w=j.cloneElement(t,pE(pE({},y),cke(t)));else if(Wi(t))w=t(y);else if($Ie(t)&&!qIe(t)){var T=a(t,y);w=jt.createElement($G,{shapeType:r,elementProps:T})}else{var A=y;w=jt.createElement($G,{shapeType:r,elementProps:A})}return i?jt.createElement($o,{className:f},w):w}function k2(e,t){return t!=null&&"trapezoids"in e.props}function O2(e,t){return t!=null&&"sectors"in e.props}function xb(e,t){return t!=null&&"points"in e.props}function dke(e,t){var r,n,a=e.x===(t==null||(r=t.labelViewBox)===null||r===void 0?void 0:r.x)||e.x===t.x,u=e.y===(t==null||(n=t.labelViewBox)===null||n===void 0?void 0:n.y)||e.y===t.y;return a&&u}function hke(e,t){var r=e.endAngle===t.endAngle,n=e.startAngle===t.startAngle;return r&&n}function fke(e,t){var r=e.x===t.x,n=e.y===t.y,a=e.z===t.z;return r&&n&&a}function pke(e,t){var r;return k2(e,t)?r=dke:O2(e,t)?r=hke:xb(e,t)&&(r=fke),r}function mke(e,t){var r;return k2(e,t)?r="trapezoids":O2(e,t)?r="sectors":xb(e,t)&&(r="points"),r}function gke(e,t){if(k2(e,t)){var r;return(r=t.tooltipPayload)===null||r===void 0||(r=r[0])===null||r===void 0||(r=r.payload)===null||r===void 0?void 0:r.payload}if(O2(e,t)){var n;return(n=t.tooltipPayload)===null||n===void 0||(n=n[0])===null||n===void 0||(n=n.payload)===null||n===void 0?void 0:n.payload}return xb(e,t)?t.payload:{}}function yke(e){var t=e.activeTooltipItem,r=e.graphicalItem,n=e.itemData,a=mke(r,t),u=gke(r,t),f=n.filter(function(y,w){var T=P2(u,y),A=r.props[a].filter(function(D){var O=pke(r,t);return O(D,t)}),k=r.props[a].indexOf(A[A.length-1]),F=w===k;return T&&F}),i=n.indexOf(f[f.length-1]);return i}var RI,VG;function vke(){if(VG)return RI;VG=1;var e=Math.ceil,t=Math.max;function r(n,a,u,f){for(var i=-1,y=t(e((a-n)/(u||1)),0),w=Array(y);y--;)w[f?y:++i]=n,n+=u;return w}return RI=r,RI}var jI,UG;function $J(){if(UG)return jI;UG=1;var e=SY(),t=1/0,r=17976931348623157e292;function n(a){if(!a)return a===0?a:0;if(a=e(a),a===t||a===-1/0){var u=a<0?-1:1;return u*r}return a===a?a:0}return jI=n,jI}var DI,qG;function _ke(){if(qG)return DI;qG=1;var e=vke(),t=_2(),r=$J();function n(a){return function(u,f,i){return i&&typeof i!="number"&&t(u,f,i)&&(f=i=void 0),u=r(u),f===void 0?(f=u,u=0):f=r(f),i=i===void 0?u<f?1:-1:r(i),e(u,f,i,a)}}return DI=n,DI}var NI,GG;function xke(){if(GG)return NI;GG=1;var e=_ke(),t=e();return NI=t,NI}var bke=xke();const mE=vs(bke);function bb(e){"@babel/helpers - typeof";return bb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bb(e)}function HG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function WG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?HG(Object(r),!0).forEach(function(n){VJ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):HG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function VJ(e,t,r){return t=wke(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function wke(e){var t=Ske(e,"string");return bb(t)=="symbol"?t:t+""}function Ske(e,t){if(bb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(bb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Eke=["Webkit","Moz","O","ms"],Tke=function(t,r){var n=t.replace(/(\w)/,function(u){return u.toUpperCase()}),a=Eke.reduce(function(u,f){return WG(WG({},u),{},VJ({},f+n,r))},{});return a[t]=r,a};function h_(e){"@babel/helpers - typeof";return h_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h_(e)}function gE(){return gE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},gE.apply(this,arguments)}function ZG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function zI(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?ZG(Object(r),!0).forEach(function(n){Qc(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ZG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Cke(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function XG(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,qJ(n.key),n)}}function Ake(e,t,r){return t&&XG(e.prototype,t),r&&XG(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Pke(e,t,r){return t=yE(t),Mke(e,UJ()?Reflect.construct(t,r||[],yE(e).constructor):t.apply(e,r))}function Mke(e,t){if(t&&(h_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ike(e)}function Ike(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function UJ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(UJ=function(){return!!e})()}function yE(e){return yE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},yE(e)}function kke(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ZL(e,t)}function ZL(e,t){return ZL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},ZL(e,t)}function Qc(e,t,r){return t=qJ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function qJ(e){var t=Oke(e,"string");return h_(t)=="symbol"?t:t+""}function Oke(e,t){if(h_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(h_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Lke=function(t){var r=t.data,n=t.startIndex,a=t.endIndex,u=t.x,f=t.width,i=t.travellerWidth;if(!r||!r.length)return{};var y=r.length,w=wx().domain(mE(0,y)).range([u,u+f-i]),T=w.domain().map(function(A){return w(A)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:w(n),endX:w(a),scale:w,scaleValues:T}},KG=function(t){return t.changedTouches&&!!t.changedTouches.length},f_=function(e){function t(r){var n;return Cke(this,t),n=Pke(this,t,[r]),Qc(n,"handleDrag",function(a){n.leaveTimer&&(clearTimeout(n.leaveTimer),n.leaveTimer=null),n.state.isTravellerMoving?n.handleTravellerMove(a):n.state.isSlideMoving&&n.handleSlideDrag(a)}),Qc(n,"handleTouchMove",function(a){a.changedTouches!=null&&a.changedTouches.length>0&&n.handleDrag(a.changedTouches[0])}),Qc(n,"handleDragEnd",function(){n.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var a=n.props,u=a.endIndex,f=a.onDragEnd,i=a.startIndex;f==null||f({endIndex:u,startIndex:i})}),n.detachDragEndListener()}),Qc(n,"handleLeaveWrapper",function(){(n.state.isTravellerMoving||n.state.isSlideMoving)&&(n.leaveTimer=window.setTimeout(n.handleDragEnd,n.props.leaveTimeOut))}),Qc(n,"handleEnterSlideOrTraveller",function(){n.setState({isTextActive:!0})}),Qc(n,"handleLeaveSlideOrTraveller",function(){n.setState({isTextActive:!1})}),Qc(n,"handleSlideDragStart",function(a){var u=KG(a)?a.changedTouches[0]:a;n.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:u.pageX}),n.attachDragEndListener()}),n.travellerDragStartHandlers={startX:n.handleTravellerDragStart.bind(n,"startX"),endX:n.handleTravellerDragStart.bind(n,"endX")},n.state={},n}return kke(t,e),Ake(t,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(n){var a=n.startX,u=n.endX,f=this.state.scaleValues,i=this.props,y=i.gap,w=i.data,T=w.length-1,A=Math.min(a,u),k=Math.max(a,u),F=t.getIndexInRange(f,A),D=t.getIndexInRange(f,k);return{startIndex:F-F%y,endIndex:D===T?T:D-D%y}}},{key:"getTextOfTick",value:function(n){var a=this.props,u=a.data,f=a.tickFormatter,i=a.dataKey,y=du(u[n],i,n);return Wi(f)?f(y,n):y}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(n){var a=this.state,u=a.slideMoveStartX,f=a.startX,i=a.endX,y=this.props,w=y.x,T=y.width,A=y.travellerWidth,k=y.startIndex,F=y.endIndex,D=y.onChange,O=n.pageX-u;O>0?O=Math.min(O,w+T-A-i,w+T-A-f):O<0&&(O=Math.max(O,w-f,w-i));var N=this.getIndex({startX:f+O,endX:i+O});(N.startIndex!==k||N.endIndex!==F)&&D&&D(N),this.setState({startX:f+O,endX:i+O,slideMoveStartX:n.pageX})}},{key:"handleTravellerDragStart",value:function(n,a){var u=KG(a)?a.changedTouches[0]:a;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:n,brushMoveStartX:u.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(n){var a=this.state,u=a.brushMoveStartX,f=a.movingTravellerId,i=a.endX,y=a.startX,w=this.state[f],T=this.props,A=T.x,k=T.width,F=T.travellerWidth,D=T.onChange,O=T.gap,N=T.data,V={startX:this.state.startX,endX:this.state.endX},H=n.pageX-u;H>0?H=Math.min(H,A+k-F-w):H<0&&(H=Math.max(H,A-w)),V[f]=w+H;var Z=this.getIndex(V),J=Z.startIndex,G=Z.endIndex,Y=function(){var ce=N.length-1;return f==="startX"&&(i>y?J%O===0:G%O===0)||i<y&&G===ce||f==="endX"&&(i>y?G%O===0:J%O===0)||i>y&&G===ce};this.setState(Qc(Qc({},f,w+H),"brushMoveStartX",n.pageX),function(){D&&Y()&&D(Z)})}},{key:"handleTravellerMoveKeyboard",value:function(n,a){var u=this,f=this.state,i=f.scaleValues,y=f.startX,w=f.endX,T=this.state[a],A=i.indexOf(T);if(A!==-1){var k=A+n;if(!(k===-1||k>=i.length)){var F=i[k];a==="startX"&&F>=w||a==="endX"&&F<=y||this.setState(Qc({},a,F),function(){u.props.onChange(u.getIndex({startX:u.state.startX,endX:u.state.endX}))})}}}},{key:"renderBackground",value:function(){var n=this.props,a=n.x,u=n.y,f=n.width,i=n.height,y=n.fill,w=n.stroke;return jt.createElement("rect",{stroke:w,fill:y,x:a,y:u,width:f,height:i})}},{key:"renderPanorama",value:function(){var n=this.props,a=n.x,u=n.y,f=n.width,i=n.height,y=n.data,w=n.children,T=n.padding,A=j.Children.only(w);return A?jt.cloneElement(A,{x:a,y:u,width:f,height:i,margin:T,compact:!0,data:y}):null}},{key:"renderTravellerLayer",value:function(n,a){var u,f,i=this,y=this.props,w=y.y,T=y.travellerWidth,A=y.height,k=y.traveller,F=y.ariaLabel,D=y.data,O=y.startIndex,N=y.endIndex,V=Math.max(n,this.props.x),H=zI(zI({},ns(this.props,!1)),{},{x:V,y:w,width:T,height:A}),Z=F||"Min value: ".concat((u=D[O])===null||u===void 0?void 0:u.name,", Max value: ").concat((f=D[N])===null||f===void 0?void 0:f.name);return jt.createElement($o,{tabIndex:0,role:"slider","aria-label":Z,"aria-valuenow":n,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[a],onTouchStart:this.travellerDragStartHandlers[a],onKeyDown:function(G){["ArrowLeft","ArrowRight"].includes(G.key)&&(G.preventDefault(),G.stopPropagation(),i.handleTravellerMoveKeyboard(G.key==="ArrowRight"?1:-1,a))},onFocus:function(){i.setState({isTravellerFocused:!0})},onBlur:function(){i.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},t.renderTraveller(k,H))}},{key:"renderSlide",value:function(n,a){var u=this.props,f=u.y,i=u.height,y=u.stroke,w=u.travellerWidth,T=Math.min(n,a)+w,A=Math.max(Math.abs(a-n)-w,0);return jt.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:y,fillOpacity:.2,x:T,y:f,width:A,height:i})}},{key:"renderText",value:function(){var n=this.props,a=n.startIndex,u=n.endIndex,f=n.y,i=n.height,y=n.travellerWidth,w=n.stroke,T=this.state,A=T.startX,k=T.endX,F=5,D={pointerEvents:"none",fill:w};return jt.createElement($o,{className:"recharts-brush-texts"},jt.createElement(HS,gE({textAnchor:"end",verticalAnchor:"middle",x:Math.min(A,k)-F,y:f+i/2},D),this.getTextOfTick(a)),jt.createElement(HS,gE({textAnchor:"start",verticalAnchor:"middle",x:Math.max(A,k)+y+F,y:f+i/2},D),this.getTextOfTick(u)))}},{key:"render",value:function(){var n=this.props,a=n.data,u=n.className,f=n.children,i=n.x,y=n.y,w=n.width,T=n.height,A=n.alwaysShowText,k=this.state,F=k.startX,D=k.endX,O=k.isTextActive,N=k.isSlideMoving,V=k.isTravellerMoving,H=k.isTravellerFocused;if(!a||!a.length||!cn(i)||!cn(y)||!cn(w)||!cn(T)||w<=0||T<=0)return null;var Z=Li("recharts-brush",u),J=jt.Children.count(f)===1,G=Tke("userSelect","none");return jt.createElement($o,{className:Z,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:G},this.renderBackground(),J&&this.renderPanorama(),this.renderSlide(F,D),this.renderTravellerLayer(F,"startX"),this.renderTravellerLayer(D,"endX"),(O||N||V||H||A)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(n){var a=n.x,u=n.y,f=n.width,i=n.height,y=n.stroke,w=Math.floor(u+i/2)-1;return jt.createElement(jt.Fragment,null,jt.createElement("rect",{x:a,y:u,width:f,height:i,fill:y,stroke:"none"}),jt.createElement("line",{x1:a+1,y1:w,x2:a+f-1,y2:w,fill:"none",stroke:"#fff"}),jt.createElement("line",{x1:a+1,y1:w+2,x2:a+f-1,y2:w+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(n,a){var u;return jt.isValidElement(n)?u=jt.cloneElement(n,a):Wi(n)?u=n(a):u=t.renderDefaultTraveller(a),u}},{key:"getDerivedStateFromProps",value:function(n,a){var u=n.data,f=n.width,i=n.x,y=n.travellerWidth,w=n.updateId,T=n.startIndex,A=n.endIndex;if(u!==a.prevData||w!==a.prevUpdateId)return zI({prevData:u,prevTravellerWidth:y,prevUpdateId:w,prevX:i,prevWidth:f},u&&u.length?Lke({data:u,width:f,x:i,travellerWidth:y,startIndex:T,endIndex:A}):{scale:null,scaleValues:null});if(a.scale&&(f!==a.prevWidth||i!==a.prevX||y!==a.prevTravellerWidth)){a.scale.range([i,i+f-y]);var k=a.scale.domain().map(function(F){return a.scale(F)});return{prevData:u,prevTravellerWidth:y,prevUpdateId:w,prevX:i,prevWidth:f,startX:a.scale(n.startIndex),endX:a.scale(n.endIndex),scaleValues:k}}return null}},{key:"getIndexInRange",value:function(n,a){for(var u=n.length,f=0,i=u-1;i-f>1;){var y=Math.floor((f+i)/2);n[y]>a?i=y:f=y}return a>=n[i]?i:f}}])}(j.PureComponent);Qc(f_,"displayName","Brush");Qc(f_,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var FI,YG;function Rke(){if(YG)return FI;YG=1;var e=sD();function t(r,n){var a;return e(r,function(u,f,i){return a=n(u,f,i),!a}),!!a}return FI=t,FI}var BI,JG;function jke(){if(JG)return BI;JG=1;var e=eY(),t=Qm(),r=Rke(),n=Cc(),a=_2();function u(f,i,y){var w=n(f)?e:r;return y&&a(f,i,y)&&(i=void 0),w(f,t(i,3))}return BI=u,BI}var Dke=jke();const Nke=vs(Dke);var uf=function(t,r){var n=t.alwaysShow,a=t.ifOverflow;return n&&(a="extendDomain"),a===r},$I,QG;function zke(){if(QG)return $I;QG=1;var e=vY();function t(r,n,a){n=="__proto__"&&e?e(r,n,{configurable:!0,enumerable:!0,value:a,writable:!0}):r[n]=a}return $I=t,$I}var VI,e9;function Fke(){if(e9)return VI;e9=1;var e=zke(),t=gY(),r=Qm();function n(a,u){var f={};return u=r(u,3),t(a,function(i,y,w){e(f,y,u(i,y,w))}),f}return VI=n,VI}var Bke=Fke();const $ke=vs(Bke);var UI,t9;function Vke(){if(t9)return UI;t9=1;function e(t,r){for(var n=-1,a=t==null?0:t.length;++n<a;)if(!r(t[n],n,t))return!1;return!0}return UI=e,UI}var qI,r9;function Uke(){if(r9)return qI;r9=1;var e=sD();function t(r,n){var a=!0;return e(r,function(u,f,i){return a=!!n(u,f,i),a}),a}return qI=t,qI}var GI,n9;function qke(){if(n9)return GI;n9=1;var e=Vke(),t=Uke(),r=Qm(),n=Cc(),a=_2();function u(f,i,y){var w=n(f)?e:t;return y&&a(f,i,y)&&(i=void 0),w(f,r(i,3))}return GI=u,GI}var Gke=qke();const Hke=vs(Gke);var Wke=["x","y"];function wb(e){"@babel/helpers - typeof";return wb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wb(e)}function XL(){return XL=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},XL.apply(this,arguments)}function i9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Y0(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?i9(Object(r),!0).forEach(function(n){Zke(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i9(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Zke(e,t,r){return t=Xke(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Xke(e){var t=Kke(e,"string");return wb(t)=="symbol"?t:t+""}function Kke(e,t){if(wb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(wb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Yke(e,t){if(e==null)return{};var r=Jke(e,t),n,a;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(a=0;a<u.length;a++)n=u[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Jke(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Qke(e,t){var r=e.x,n=e.y,a=Yke(e,Wke),u="".concat(r),f=parseInt(u,10),i="".concat(n),y=parseInt(i,10),w="".concat(t.height||a.height),T=parseInt(w,10),A="".concat(t.width||a.width),k=parseInt(A,10);return Y0(Y0(Y0(Y0(Y0({},t),a),f?{x:f}:{}),y?{y}:{}),{},{height:T,width:k,name:t.name,radius:t.radius})}function s9(e){return jt.createElement(uke,XL({shapeType:"rectangle",propTransformer:Qke,activeClassName:"recharts-active-bar"},e))}var eOe=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(n,a){if(typeof t=="number")return t;var u=typeof n=="number";return u?t(n,a):(u||Py(),r)}},tOe=["value","background"],GJ;function p_(e){"@babel/helpers - typeof";return p_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p_(e)}function rOe(e,t){if(e==null)return{};var r=nOe(e,t),n,a;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(a=0;a<u.length;a++)n=u[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function nOe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function vE(){return vE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},vE.apply(this,arguments)}function o9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function na(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?o9(Object(r),!0).forEach(function(n){Nm(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o9(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function iOe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a9(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,WJ(n.key),n)}}function sOe(e,t,r){return t&&a9(e.prototype,t),r&&a9(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function oOe(e,t,r){return t=_E(t),aOe(e,HJ()?Reflect.construct(t,r||[],_E(e).constructor):t.apply(e,r))}function aOe(e,t){if(t&&(p_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return lOe(e)}function lOe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function HJ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(HJ=function(){return!!e})()}function _E(e){return _E=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},_E(e)}function cOe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&KL(e,t)}function KL(e,t){return KL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},KL(e,t)}function Nm(e,t,r){return t=WJ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function WJ(e){var t=uOe(e,"string");return p_(t)=="symbol"?t:t+""}function uOe(e,t){if(p_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(p_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Jb=function(e){function t(){var r;iOe(this,t);for(var n=arguments.length,a=new Array(n),u=0;u<n;u++)a[u]=arguments[u];return r=oOe(this,t,[].concat(a)),Nm(r,"state",{isAnimationFinished:!1}),Nm(r,"id",Gb("recharts-bar-")),Nm(r,"handleAnimationEnd",function(){var f=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),f&&f()}),Nm(r,"handleAnimationStart",function(){var f=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),f&&f()}),r}return cOe(t,e),sOe(t,[{key:"renderRectanglesStatically",value:function(n){var a=this,u=this.props,f=u.shape,i=u.dataKey,y=u.activeIndex,w=u.activeBar,T=ns(this.props,!1);return n&&n.map(function(A,k){var F=k===y,D=F?w:f,O=na(na(na({},T),A),{},{isActive:F,option:D,index:k,dataKey:i,onAnimationStart:a.handleAnimationStart,onAnimationEnd:a.handleAnimationEnd});return jt.createElement($o,vE({className:"recharts-bar-rectangle"},jS(a.props,A,k),{key:"rectangle-".concat(A==null?void 0:A.x,"-").concat(A==null?void 0:A.y,"-").concat(A==null?void 0:A.value,"-").concat(k)}),jt.createElement(s9,O))})}},{key:"renderRectanglesWithAnimation",value:function(){var n=this,a=this.props,u=a.data,f=a.layout,i=a.isAnimationActive,y=a.animationBegin,w=a.animationDuration,T=a.animationEasing,A=a.animationId,k=this.state.prevData;return jt.createElement(Tp,{begin:y,duration:w,isActive:i,easing:T,from:{t:0},to:{t:1},key:"bar-".concat(A),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(F){var D=F.t,O=u.map(function(N,V){var H=k&&k[V];if(H){var Z=Wd(H.x,N.x),J=Wd(H.y,N.y),G=Wd(H.width,N.width),Y=Wd(H.height,N.height);return na(na({},N),{},{x:Z(D),y:J(D),width:G(D),height:Y(D)})}if(f==="horizontal"){var ie=Wd(0,N.height),ce=ie(D);return na(na({},N),{},{y:N.y+N.height-ce,height:ce})}var ge=Wd(0,N.width),be=ge(D);return na(na({},N),{},{width:be})});return jt.createElement($o,null,n.renderRectanglesStatically(O))})}},{key:"renderRectangles",value:function(){var n=this.props,a=n.data,u=n.isAnimationActive,f=this.state.prevData;return u&&a&&a.length&&(!f||!P2(f,a))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(a)}},{key:"renderBackground",value:function(){var n=this,a=this.props,u=a.data,f=a.dataKey,i=a.activeIndex,y=ns(this.props.background,!1);return u.map(function(w,T){w.value;var A=w.background,k=rOe(w,tOe);if(!A)return null;var F=na(na(na(na(na({},k),{},{fill:"#eee"},A),y),jS(n.props,w,T)),{},{onAnimationStart:n.handleAnimationStart,onAnimationEnd:n.handleAnimationEnd,dataKey:f,index:T,className:"recharts-bar-background-rectangle"});return jt.createElement(s9,vE({key:"background-bar-".concat(T),option:n.props.background,isActive:T===i},F))})}},{key:"renderErrorBar",value:function(n,a){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var u=this.props,f=u.data,i=u.xAxis,y=u.yAxis,w=u.layout,T=u.children,A=Ku(T,Yb);if(!A)return null;var k=w==="vertical"?f[0].height/2:f[0].width/2,F=function(N,V){var H=Array.isArray(N.value)?N.value[1]:N.value;return{x:N.x,y:N.y,value:H,errorVal:du(N,V)}},D={clipPath:n?"url(#clipPath-".concat(a,")"):null};return jt.createElement($o,D,A.map(function(O){return jt.cloneElement(O,{key:"error-bar-".concat(a,"-").concat(O.props.dataKey),data:f,xAxis:i,yAxis:y,layout:w,offset:k,dataPointFormatter:F})}))}},{key:"render",value:function(){var n=this.props,a=n.hide,u=n.data,f=n.className,i=n.xAxis,y=n.yAxis,w=n.left,T=n.top,A=n.width,k=n.height,F=n.isAnimationActive,D=n.background,O=n.id;if(a||!u||!u.length)return null;var N=this.state.isAnimationFinished,V=Li("recharts-bar",f),H=i&&i.allowDataOverflow,Z=y&&y.allowDataOverflow,J=H||Z,G=Zi(O)?this.id:O;return jt.createElement($o,{className:V},H||Z?jt.createElement("defs",null,jt.createElement("clipPath",{id:"clipPath-".concat(G)},jt.createElement("rect",{x:H?w:w-A/2,y:Z?T:T-k/2,width:H?A:A*2,height:Z?k:k*2}))):null,jt.createElement($o,{className:"recharts-bar-rectangles",clipPath:J?"url(#clipPath-".concat(G,")"):null},D?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(J,G),(!F||N)&&$m.renderCallByParent(this.props,u))}}],[{key:"getDerivedStateFromProps",value:function(n,a){return n.animationId!==a.prevAnimationId?{prevAnimationId:n.animationId,curData:n.data,prevData:a.curData}:n.data!==a.curData?{curData:n.data}:null}}])}(j.PureComponent);GJ=Jb;Nm(Jb,"displayName","Bar");Nm(Jb,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!z_.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});Nm(Jb,"getComposedData",function(e){var t=e.props,r=e.item,n=e.barPosition,a=e.bandSize,u=e.xAxis,f=e.yAxis,i=e.xAxisTicks,y=e.yAxisTicks,w=e.stackedData,T=e.dataStartIndex,A=e.displayedData,k=e.offset,F=PAe(n,r);if(!F)return null;var D=t.layout,O=r.type.defaultProps,N=O!==void 0?na(na({},O),r.props):r.props,V=N.dataKey,H=N.children,Z=N.minPointSize,J=D==="horizontal"?f:u,G=w?J.scale.domain():null,Y=DAe({numericAxis:J}),ie=Ku(H,TY),ce=A.map(function(ge,be){var xe,Le,ze,Xe,Je,tt;w?xe=MAe(w[T+be],G):(xe=du(ge,V),Array.isArray(xe)||(xe=[Y,xe]));var st=eOe(Z,GJ.defaultProps.minPointSize)(xe[1],be);if(D==="horizontal"){var Ne,We=[f.scale(xe[0]),f.scale(xe[1])],Ue=We[0],De=We[1];Le=qq({axis:u,ticks:i,bandSize:a,offset:F.offset,entry:ge,index:be}),ze=(Ne=De??Ue)!==null&&Ne!==void 0?Ne:void 0,Xe=F.size;var Ke=Ue-De;if(Je=Number.isNaN(Ke)?0:Ke,tt={x:Le,y:f.y,width:Xe,height:f.height},Math.abs(st)>0&&Math.abs(Je)<Math.abs(st)){var lt=Xd(Je||st)*(Math.abs(st)-Math.abs(Je));ze-=lt,Je+=lt}}else{var Ye=[u.scale(xe[0]),u.scale(xe[1])],Ve=Ye[0],Et=Ye[1];if(Le=Ve,ze=qq({axis:f,ticks:y,bandSize:a,offset:F.offset,entry:ge,index:be}),Xe=Et-Ve,Je=F.size,tt={x:u.x,y:ze,width:u.width,height:Je},Math.abs(st)>0&&Math.abs(Xe)<Math.abs(st)){var kt=Xd(Xe||st)*(Math.abs(st)-Math.abs(Xe));Xe+=kt}}return na(na(na({},ge),{},{x:Le,y:ze,width:Xe,height:Je,value:w?xe:xe[1],payload:ge,background:tt},ie&&ie[be]&&ie[be].props),{},{tooltipPayload:[IJ(r,ge)],tooltipPosition:{x:Le+Xe/2,y:ze+Je/2}})});return na({data:ce,layout:D},k)});function Sb(e){"@babel/helpers - typeof";return Sb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Sb(e)}function dOe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l9(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ZJ(n.key),n)}}function hOe(e,t,r){return t&&l9(e.prototype,t),r&&l9(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function c9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Gd(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?c9(Object(r),!0).forEach(function(n){L2(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c9(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function L2(e,t,r){return t=ZJ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ZJ(e){var t=fOe(e,"string");return Sb(t)=="symbol"?t:t+""}function fOe(e,t){if(Sb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Sb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var pOe=function(t,r,n,a,u){var f=t.width,i=t.height,y=t.layout,w=t.children,T=Object.keys(r),A={left:n.left,leftMirror:n.left,right:f-n.right,rightMirror:f-n.right,top:n.top,topMirror:n.top,bottom:i-n.bottom,bottomMirror:i-n.bottom},k=!!eu(w,Jb);return T.reduce(function(F,D){var O=r[D],N=O.orientation,V=O.domain,H=O.padding,Z=H===void 0?{}:H,J=O.mirror,G=O.reversed,Y="".concat(N).concat(J?"Mirror":""),ie,ce,ge,be,xe;if(O.type==="number"&&(O.padding==="gap"||O.padding==="no-gap")){var Le=V[1]-V[0],ze=1/0,Xe=O.categoricalDomain.sort(dbe);if(Xe.forEach(function(Ye,Ve){Ve>0&&(ze=Math.min((Ye||0)-(Xe[Ve-1]||0),ze))}),Number.isFinite(ze)){var Je=ze/Le,tt=O.layout==="vertical"?n.height:n.width;if(O.padding==="gap"&&(ie=Je*tt/2),O.padding==="no-gap"){var st=Cy(t.barCategoryGap,Je*tt),Ne=Je*tt/2;ie=Ne-st-(Ne-st)/tt*st}}}a==="xAxis"?ce=[n.left+(Z.left||0)+(ie||0),n.left+n.width-(Z.right||0)-(ie||0)]:a==="yAxis"?ce=y==="horizontal"?[n.top+n.height-(Z.bottom||0),n.top+(Z.top||0)]:[n.top+(Z.top||0)+(ie||0),n.top+n.height-(Z.bottom||0)-(ie||0)]:ce=O.range,G&&(ce=[ce[1],ce[0]]);var We=CAe(O,u,k),Ue=We.scale,De=We.realScaleType;Ue.domain(V).range(ce),AAe(Ue);var Ke=jAe(Ue,Gd(Gd({},O),{},{realScaleType:De}));a==="xAxis"?(xe=N==="top"&&!J||N==="bottom"&&J,ge=n.left,be=A[Y]-xe*O.height):a==="yAxis"&&(xe=N==="left"&&!J||N==="right"&&J,ge=A[Y]-xe*O.width,be=n.top);var lt=Gd(Gd(Gd({},O),Ke),{},{realScaleType:De,x:ge,y:be,scale:Ue,width:a==="xAxis"?n.width:O.width,height:a==="yAxis"?n.height:O.height});return lt.bandSize=oE(lt,Ke),!O.hide&&a==="xAxis"?A[Y]+=(xe?-1:1)*lt.height:O.hide||(A[Y]+=(xe?-1:1)*lt.width),Gd(Gd({},F),{},L2({},D,lt))},{})},XJ=function(t,r){var n=t.x,a=t.y,u=r.x,f=r.y;return{x:Math.min(n,u),y:Math.min(a,f),width:Math.abs(u-n),height:Math.abs(f-a)}},mOe=function(t){var r=t.x1,n=t.y1,a=t.x2,u=t.y2;return XJ({x:r,y:n},{x:a,y:u})},KJ=function(){function e(t){dOe(this,e),this.scale=t}return hOe(e,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.bandAware,u=n.position;if(r!==void 0){if(u)switch(u){case"start":return this.scale(r);case"middle":{var f=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+f}case"end":{var i=this.bandwidth?this.bandwidth():0;return this.scale(r)+i}default:return this.scale(r)}if(a){var y=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+y}return this.scale(r)}}},{key:"isInRange",value:function(r){var n=this.range(),a=n[0],u=n[n.length-1];return a<=u?r>=a&&r<=u:r>=u&&r<=a}}],[{key:"create",value:function(r){return new e(r)}}])}();L2(KJ,"EPS",1e-4);var jD=function(t){var r=Object.keys(t).reduce(function(n,a){return Gd(Gd({},n),{},L2({},a,KJ.create(t[a])))},{});return Gd(Gd({},r),{},{apply:function(a){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f=u.bandAware,i=u.position;return $ke(a,function(y,w){return r[w].apply(y,{bandAware:f,position:i})})},isInRange:function(a){return Hke(a,function(u,f){return r[f].isInRange(u)})}})};function gOe(e){return(e%180+180)%180}var yOe=function(t){var r=t.width,n=t.height,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,u=gOe(a),f=u*Math.PI/180,i=Math.atan(n/r),y=f>i&&f<Math.PI-i?n/Math.sin(f):r/Math.cos(f);return Math.abs(y)},HI,u9;function vOe(){if(u9)return HI;u9=1;var e=Qm(),t=Hb(),r=y2();function n(a){return function(u,f,i){var y=Object(u);if(!t(u)){var w=e(f,3);u=r(u),f=function(A){return w(y[A],A,y)}}var T=a(u,f,i);return T>-1?y[w?u[T]:T]:void 0}}return HI=n,HI}var WI,d9;function _Oe(){if(d9)return WI;d9=1;var e=$J();function t(r){var n=e(r),a=n%1;return n===n?a?n-a:n:0}return WI=t,WI}var ZI,h9;function xOe(){if(h9)return ZI;h9=1;var e=dY(),t=Qm(),r=_Oe(),n=Math.max;function a(u,f,i){var y=u==null?0:u.length;if(!y)return-1;var w=i==null?0:r(i);return w<0&&(w=n(y+w,0)),e(u,t(f,3),w)}return ZI=a,ZI}var XI,f9;function bOe(){if(f9)return XI;f9=1;var e=vOe(),t=xOe(),r=e(t);return XI=r,XI}bOe();var wOe=AK();const SOe=vs(wOe);var EOe=SOe(function(e){return{x:e.left,y:e.top,width:e.width,height:e.height}},function(e){return["l",e.left,"t",e.top,"w",e.width,"h",e.height].join("")}),YJ=j.createContext(void 0),JJ=j.createContext(void 0),QJ=j.createContext(void 0),TOe=j.createContext({}),eQ=j.createContext(void 0),tQ=j.createContext(0),rQ=j.createContext(0),p9=function(t){var r=t.state,n=r.xAxisMap,a=r.yAxisMap,u=r.offset,f=t.clipPathId,i=t.children,y=t.width,w=t.height,T=EOe(u);return jt.createElement(YJ.Provider,{value:n},jt.createElement(JJ.Provider,{value:a},jt.createElement(TOe.Provider,{value:u},jt.createElement(QJ.Provider,{value:T},jt.createElement(eQ.Provider,{value:f},jt.createElement(tQ.Provider,{value:w},jt.createElement(rQ.Provider,{value:y},i)))))))},COe=function(){return j.useContext(eQ)},nQ=function(t){var r=j.useContext(YJ);r==null&&Py();var n=r[t];return n==null&&Py(),n},iQ=function(t){var r=j.useContext(JJ);r==null&&Py();var n=r[t];return n==null&&Py(),n},AOe=function(){var t=j.useContext(QJ);return t},sQ=function(){return j.useContext(rQ)},oQ=function(){return j.useContext(tQ)};function m_(e){"@babel/helpers - typeof";return m_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m_(e)}function POe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function MOe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,lQ(n.key),n)}}function IOe(e,t,r){return t&&MOe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function kOe(e,t,r){return t=xE(t),OOe(e,aQ()?Reflect.construct(t,r||[],xE(e).constructor):t.apply(e,r))}function OOe(e,t){if(t&&(m_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return LOe(e)}function LOe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function aQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(aQ=function(){return!!e})()}function xE(e){return xE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},xE(e)}function ROe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&YL(e,t)}function YL(e,t){return YL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},YL(e,t)}function m9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function g9(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?m9(Object(r),!0).forEach(function(n){DD(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m9(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function DD(e,t,r){return t=lQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function lQ(e){var t=jOe(e,"string");return m_(t)=="symbol"?t:t+""}function jOe(e,t){if(m_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(m_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function DOe(e,t){return BOe(e)||FOe(e,t)||zOe(e,t)||NOe()}function NOe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zOe(e,t){if(e){if(typeof e=="string")return y9(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return y9(e,t)}}function y9(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function FOe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,u,f,i=[],y=!0,w=!1;try{if(u=(r=r.call(e)).next,t!==0)for(;!(y=(n=u.call(r)).done)&&(i.push(n.value),i.length!==t);y=!0);}catch(T){w=!0,a=T}finally{try{if(!y&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(w)throw a}}return i}}function BOe(e){if(Array.isArray(e))return e}function JL(){return JL=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},JL.apply(this,arguments)}var $Oe=function(t,r){var n;return jt.isValidElement(t)?n=jt.cloneElement(t,r):Wi(t)?n=t(r):n=jt.createElement("line",JL({},r,{className:"recharts-reference-line-line"})),n},VOe=function(t,r,n,a,u,f,i,y,w){var T=u.x,A=u.y,k=u.width,F=u.height;if(n){var D=w.y,O=t.y.apply(D,{position:f});if(uf(w,"discard")&&!t.y.isInRange(O))return null;var N=[{x:T+k,y:O},{x:T,y:O}];return y==="left"?N.reverse():N}if(r){var V=w.x,H=t.x.apply(V,{position:f});if(uf(w,"discard")&&!t.x.isInRange(H))return null;var Z=[{x:H,y:A+F},{x:H,y:A}];return i==="top"?Z.reverse():Z}if(a){var J=w.segment,G=J.map(function(Y){return t.apply(Y,{position:f})});return uf(w,"discard")&&Nke(G,function(Y){return!t.isInRange(Y)})?null:G}return null};function UOe(e){var t=e.x,r=e.y,n=e.segment,a=e.xAxisId,u=e.yAxisId,f=e.shape,i=e.className,y=e.alwaysShow,w=COe(),T=nQ(a),A=iQ(u),k=AOe();if(!w||!k)return null;gy(y===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var F=jD({x:T.scale,y:A.scale}),D=_a(t),O=_a(r),N=n&&n.length===2,V=VOe(F,D,O,N,k,e.position,T.orientation,A.orientation,e);if(!V)return null;var H=DOe(V,2),Z=H[0],J=Z.x,G=Z.y,Y=H[1],ie=Y.x,ce=Y.y,ge=uf(e,"hidden")?"url(#".concat(w,")"):void 0,be=g9(g9({clipPath:ge},ns(e,!0)),{},{x1:J,y1:G,x2:ie,y2:ce});return jt.createElement($o,{className:Li("recharts-reference-line",i)},$Oe(f,be),yl.renderCallByParent(e,mOe({x1:J,y1:G,x2:ie,y2:ce})))}var ND=function(e){function t(){return POe(this,t),kOe(this,t,arguments)}return ROe(t,e),IOe(t,[{key:"render",value:function(){return jt.createElement(UOe,this.props)}}])}(jt.Component);DD(ND,"displayName","ReferenceLine");DD(ND,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function QL(){return QL=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},QL.apply(this,arguments)}function g_(e){"@babel/helpers - typeof";return g_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g_(e)}function v9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function _9(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?v9(Object(r),!0).forEach(function(n){R2(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v9(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function qOe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function GOe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,uQ(n.key),n)}}function HOe(e,t,r){return t&&GOe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function WOe(e,t,r){return t=bE(t),ZOe(e,cQ()?Reflect.construct(t,r||[],bE(e).constructor):t.apply(e,r))}function ZOe(e,t){if(t&&(g_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return XOe(e)}function XOe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function cQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(cQ=function(){return!!e})()}function bE(e){return bE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},bE(e)}function KOe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&eR(e,t)}function eR(e,t){return eR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},eR(e,t)}function R2(e,t,r){return t=uQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function uQ(e){var t=YOe(e,"string");return g_(t)=="symbol"?t:t+""}function YOe(e,t){if(g_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(g_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var JOe=function(t){var r=t.x,n=t.y,a=t.xAxis,u=t.yAxis,f=jD({x:a.scale,y:u.scale}),i=f.apply({x:r,y:n},{bandAware:!0});return uf(t,"discard")&&!f.isInRange(i)?null:i},j2=function(e){function t(){return qOe(this,t),WOe(this,t,arguments)}return KOe(t,e),HOe(t,[{key:"render",value:function(){var n=this.props,a=n.x,u=n.y,f=n.r,i=n.alwaysShow,y=n.clipPathId,w=_a(a),T=_a(u);if(gy(i===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!w||!T)return null;var A=JOe(this.props);if(!A)return null;var k=A.x,F=A.y,D=this.props,O=D.shape,N=D.className,V=uf(this.props,"hidden")?"url(#".concat(y,")"):void 0,H=_9(_9({clipPath:V},ns(this.props,!0)),{},{cx:k,cy:F});return jt.createElement($o,{className:Li("recharts-reference-dot",N)},t.renderDot(O,H),yl.renderCallByParent(this.props,{x:k-f,y:F-f,width:2*f,height:2*f}))}}])}(jt.Component);R2(j2,"displayName","ReferenceDot");R2(j2,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});R2(j2,"renderDot",function(e,t){var r;return jt.isValidElement(e)?r=jt.cloneElement(e,t):Wi(e)?r=e(t):r=jt.createElement(RD,QL({},t,{cx:t.cx,cy:t.cy,className:"recharts-reference-dot-dot"})),r});function tR(){return tR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},tR.apply(this,arguments)}function y_(e){"@babel/helpers - typeof";return y_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y_(e)}function x9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function b9(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?x9(Object(r),!0).forEach(function(n){D2(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x9(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function QOe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function eLe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,hQ(n.key),n)}}function tLe(e,t,r){return t&&eLe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function rLe(e,t,r){return t=wE(t),nLe(e,dQ()?Reflect.construct(t,r||[],wE(e).constructor):t.apply(e,r))}function nLe(e,t){if(t&&(y_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return iLe(e)}function iLe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function dQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(dQ=function(){return!!e})()}function wE(e){return wE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},wE(e)}function sLe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&rR(e,t)}function rR(e,t){return rR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},rR(e,t)}function D2(e,t,r){return t=hQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function hQ(e){var t=oLe(e,"string");return y_(t)=="symbol"?t:t+""}function oLe(e,t){if(y_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(y_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var aLe=function(t,r,n,a,u){var f=u.x1,i=u.x2,y=u.y1,w=u.y2,T=u.xAxis,A=u.yAxis;if(!T||!A)return null;var k=jD({x:T.scale,y:A.scale}),F={x:t?k.x.apply(f,{position:"start"}):k.x.rangeMin,y:n?k.y.apply(y,{position:"start"}):k.y.rangeMin},D={x:r?k.x.apply(i,{position:"end"}):k.x.rangeMax,y:a?k.y.apply(w,{position:"end"}):k.y.rangeMax};return uf(u,"discard")&&(!k.isInRange(F)||!k.isInRange(D))?null:XJ(F,D)},N2=function(e){function t(){return QOe(this,t),rLe(this,t,arguments)}return sLe(t,e),tLe(t,[{key:"render",value:function(){var n=this.props,a=n.x1,u=n.x2,f=n.y1,i=n.y2,y=n.className,w=n.alwaysShow,T=n.clipPathId;gy(w===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var A=_a(a),k=_a(u),F=_a(f),D=_a(i),O=this.props.shape;if(!A&&!k&&!F&&!D&&!O)return null;var N=aLe(A,k,F,D,this.props);if(!N&&!O)return null;var V=uf(this.props,"hidden")?"url(#".concat(T,")"):void 0;return jt.createElement($o,{className:Li("recharts-reference-area",y)},t.renderRect(O,b9(b9({clipPath:V},ns(this.props,!0)),N)),yl.renderCallByParent(this.props,N))}}])}(jt.Component);D2(N2,"displayName","ReferenceArea");D2(N2,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});D2(N2,"renderRect",function(e,t){var r;return jt.isValidElement(e)?r=jt.cloneElement(e,t):Wi(e)?r=e(t):r=jt.createElement(LD,tR({},t,{className:"recharts-reference-area-rect"})),r});function fQ(e,t,r){if(t<1)return[];if(t===1&&r===void 0)return e;for(var n=[],a=0;a<e.length;a+=t)n.push(e[a]);return n}function lLe(e,t,r){var n={width:e.width+t.width,height:e.height+t.height};return yOe(n,r)}function cLe(e,t,r){var n=r==="width",a=e.x,u=e.y,f=e.width,i=e.height;return t===1?{start:n?a:u,end:n?a+f:u+i}:{start:n?a+f:u+i,end:n?a:u}}function SE(e,t,r,n,a){if(e*t<e*n||e*t>e*a)return!1;var u=r();return e*(t-e*u/2-n)>=0&&e*(t+e*u/2-a)<=0}function uLe(e,t){return fQ(e,t+1)}function dLe(e,t,r,n,a){for(var u=(n||[]).slice(),f=t.start,i=t.end,y=0,w=1,T=f,A=function(){var D=n==null?void 0:n[y];if(D===void 0)return{v:fQ(n,w)};var O=y,N,V=function(){return N===void 0&&(N=r(D,O)),N},H=D.coordinate,Z=y===0||SE(e,H,V,T,i);Z||(y=0,T=f,w+=1),Z&&(T=H+e*(V()/2+a),y+=w)},k;w<=u.length;)if(k=A(),k)return k.v;return[]}function Eb(e){"@babel/helpers - typeof";return Eb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Eb(e)}function w9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function gl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?w9(Object(r),!0).forEach(function(n){hLe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w9(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function hLe(e,t,r){return t=fLe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fLe(e){var t=pLe(e,"string");return Eb(t)=="symbol"?t:t+""}function pLe(e,t){if(Eb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Eb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function mLe(e,t,r,n,a){for(var u=(n||[]).slice(),f=u.length,i=t.start,y=t.end,w=function(k){var F=u[k],D,O=function(){return D===void 0&&(D=r(F,k)),D};if(k===f-1){var N=e*(F.coordinate+e*O()/2-y);u[k]=F=gl(gl({},F),{},{tickCoord:N>0?F.coordinate-N*e:F.coordinate})}else u[k]=F=gl(gl({},F),{},{tickCoord:F.coordinate});var V=SE(e,F.tickCoord,O,i,y);V&&(y=F.tickCoord-e*(O()/2+a),u[k]=gl(gl({},F),{},{isShow:!0}))},T=f-1;T>=0;T--)w(T);return u}function gLe(e,t,r,n,a,u){var f=(n||[]).slice(),i=f.length,y=t.start,w=t.end;if(u){var T=n[i-1],A=r(T,i-1),k=e*(T.coordinate+e*A/2-w);f[i-1]=T=gl(gl({},T),{},{tickCoord:k>0?T.coordinate-k*e:T.coordinate});var F=SE(e,T.tickCoord,function(){return A},y,w);F&&(w=T.tickCoord-e*(A/2+a),f[i-1]=gl(gl({},T),{},{isShow:!0}))}for(var D=u?i-1:i,O=function(H){var Z=f[H],J,G=function(){return J===void 0&&(J=r(Z,H)),J};if(H===0){var Y=e*(Z.coordinate-e*G()/2-y);f[H]=Z=gl(gl({},Z),{},{tickCoord:Y<0?Z.coordinate-Y*e:Z.coordinate})}else f[H]=Z=gl(gl({},Z),{},{tickCoord:Z.coordinate});var ie=SE(e,Z.tickCoord,G,y,w);ie&&(y=Z.tickCoord+e*(G()/2+a),f[H]=gl(gl({},Z),{},{isShow:!0}))},N=0;N<D;N++)O(N);return f}function yLe(e,t,r){var n=e.tick,a=e.ticks,u=e.viewBox,f=e.minTickGap,i=e.orientation,y=e.interval,w=e.tickFormatter,T=e.unit,A=e.angle;if(!a||!a.length||!n)return[];if(cn(y)||z_.isSsr)return uLe(a,typeof y=="number"&&cn(y)?y:0);var k=[],F=i==="top"||i==="bottom"?"width":"height",D=T&&F==="width"?bx(T,{fontSize:t,letterSpacing:r}):{width:0,height:0},O=function(Z,J){var G=Wi(w)?w(Z.value,J):Z.value;return F==="width"?lLe(bx(G,{fontSize:t,letterSpacing:r}),D,A):bx(G,{fontSize:t,letterSpacing:r})[F]},N=a.length>=2?Xd(a[1].coordinate-a[0].coordinate):1,V=cLe(u,N,F);return y==="equidistantPreserveStart"?dLe(N,V,O,a,f):(y==="preserveStart"||y==="preserveStartEnd"?k=gLe(N,V,O,a,f,y==="preserveStartEnd"):k=mLe(N,V,O,a,f),k.filter(function(H){return H.isShow}))}var vLe=["viewBox"],_Le=["viewBox"],xLe=["ticks"];function v_(e){"@babel/helpers - typeof";return v_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v_(e)}function jv(){return jv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},jv.apply(this,arguments)}function S9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Nl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?S9(Object(r),!0).forEach(function(n){zD(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S9(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function KI(e,t){if(e==null)return{};var r=bLe(e,t),n,a;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(a=0;a<u.length;a++)n=u[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function bLe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function wLe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function E9(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,mQ(n.key),n)}}function SLe(e,t,r){return t&&E9(e.prototype,t),r&&E9(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function ELe(e,t,r){return t=EE(t),TLe(e,pQ()?Reflect.construct(t,r||[],EE(e).constructor):t.apply(e,r))}function TLe(e,t){if(t&&(v_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return CLe(e)}function CLe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function pQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(pQ=function(){return!!e})()}function EE(e){return EE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},EE(e)}function ALe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&nR(e,t)}function nR(e,t){return nR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},nR(e,t)}function zD(e,t,r){return t=mQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function mQ(e){var t=PLe(e,"string");return v_(t)=="symbol"?t:t+""}function PLe(e,t){if(v_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(v_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var z2=function(e){function t(r){var n;return wLe(this,t),n=ELe(this,t,[r]),n.state={fontSize:"",letterSpacing:""},n}return ALe(t,e),SLe(t,[{key:"shouldComponentUpdate",value:function(n,a){var u=n.viewBox,f=KI(n,vLe),i=this.props,y=i.viewBox,w=KI(i,_Le);return!Uv(u,y)||!Uv(f,w)||!Uv(a,this.state)}},{key:"componentDidMount",value:function(){var n=this.layerReference;if(n){var a=n.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];a&&this.setState({fontSize:window.getComputedStyle(a).fontSize,letterSpacing:window.getComputedStyle(a).letterSpacing})}}},{key:"getTickLineCoord",value:function(n){var a=this.props,u=a.x,f=a.y,i=a.width,y=a.height,w=a.orientation,T=a.tickSize,A=a.mirror,k=a.tickMargin,F,D,O,N,V,H,Z=A?-1:1,J=n.tickSize||T,G=cn(n.tickCoord)?n.tickCoord:n.coordinate;switch(w){case"top":F=D=n.coordinate,N=f+ +!A*y,O=N-Z*J,H=O-Z*k,V=G;break;case"left":O=N=n.coordinate,D=u+ +!A*i,F=D-Z*J,V=F-Z*k,H=G;break;case"right":O=N=n.coordinate,D=u+ +A*i,F=D+Z*J,V=F+Z*k,H=G;break;default:F=D=n.coordinate,N=f+ +A*y,O=N+Z*J,H=O+Z*k,V=G;break}return{line:{x1:F,y1:O,x2:D,y2:N},tick:{x:V,y:H}}}},{key:"getTickTextAnchor",value:function(){var n=this.props,a=n.orientation,u=n.mirror,f;switch(a){case"left":f=u?"start":"end";break;case"right":f=u?"end":"start";break;default:f="middle";break}return f}},{key:"getTickVerticalAnchor",value:function(){var n=this.props,a=n.orientation,u=n.mirror,f="end";switch(a){case"left":case"right":f="middle";break;case"top":f=u?"start":"end";break;default:f=u?"end":"start";break}return f}},{key:"renderAxisLine",value:function(){var n=this.props,a=n.x,u=n.y,f=n.width,i=n.height,y=n.orientation,w=n.mirror,T=n.axisLine,A=Nl(Nl(Nl({},ns(this.props,!1)),ns(T,!1)),{},{fill:"none"});if(y==="top"||y==="bottom"){var k=+(y==="top"&&!w||y==="bottom"&&w);A=Nl(Nl({},A),{},{x1:a,y1:u+k*i,x2:a+f,y2:u+k*i})}else{var F=+(y==="left"&&!w||y==="right"&&w);A=Nl(Nl({},A),{},{x1:a+F*f,y1:u,x2:a+F*f,y2:u+i})}return jt.createElement("line",jv({},A,{className:Li("recharts-cartesian-axis-line",Xu(T,"className"))}))}},{key:"renderTicks",value:function(n,a,u){var f=this,i=this.props,y=i.tickLine,w=i.stroke,T=i.tick,A=i.tickFormatter,k=i.unit,F=yLe(Nl(Nl({},this.props),{},{ticks:n}),a,u),D=this.getTickTextAnchor(),O=this.getTickVerticalAnchor(),N=ns(this.props,!1),V=ns(T,!1),H=Nl(Nl({},N),{},{fill:"none"},ns(y,!1)),Z=F.map(function(J,G){var Y=f.getTickLineCoord(J),ie=Y.line,ce=Y.tick,ge=Nl(Nl(Nl(Nl({textAnchor:D,verticalAnchor:O},N),{},{stroke:"none",fill:w},V),ce),{},{index:G,payload:J,visibleTicksCount:F.length,tickFormatter:A});return jt.createElement($o,jv({className:"recharts-cartesian-axis-tick",key:"tick-".concat(J.value,"-").concat(J.coordinate,"-").concat(J.tickCoord)},jS(f.props,J,G)),y&&jt.createElement("line",jv({},H,ie,{className:Li("recharts-cartesian-axis-tick-line",Xu(y,"className"))})),T&&t.renderTickItem(T,ge,"".concat(Wi(A)?A(J.value,G):J.value).concat(k||"")))});return jt.createElement("g",{className:"recharts-cartesian-axis-ticks"},Z)}},{key:"render",value:function(){var n=this,a=this.props,u=a.axisLine,f=a.width,i=a.height,y=a.ticksGenerator,w=a.className,T=a.hide;if(T)return null;var A=this.props,k=A.ticks,F=KI(A,xLe),D=k;return Wi(y)&&(D=k&&k.length>0?y(this.props):y(F)),f<=0||i<=0||!D||!D.length?null:jt.createElement($o,{className:Li("recharts-cartesian-axis",w),ref:function(N){n.layerReference=N}},u&&this.renderAxisLine(),this.renderTicks(D,this.state.fontSize,this.state.letterSpacing),yl.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(n,a,u){var f;return jt.isValidElement(n)?f=jt.cloneElement(n,a):Wi(n)?f=n(a):f=jt.createElement(HS,jv({},a,{className:"recharts-cartesian-axis-tick-value"}),u),f}}])}(j.Component);zD(z2,"displayName","CartesianAxis");zD(z2,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var MLe=["type","layout","connectNulls","ref"],ILe=["key"];function __(e){"@babel/helpers - typeof";return __=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},__(e)}function T9(e,t){if(e==null)return{};var r=kLe(e,t),n,a;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(a=0;a<u.length;a++)n=u[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function kLe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Tx(){return Tx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Tx.apply(this,arguments)}function C9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Jc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?C9(Object(r),!0).forEach(function(n){Hd(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C9(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function _v(e){return jLe(e)||RLe(e)||LLe(e)||OLe()}function OLe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function LLe(e,t){if(e){if(typeof e=="string")return iR(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return iR(e,t)}}function RLe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function jLe(e){if(Array.isArray(e))return iR(e)}function iR(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function DLe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function A9(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,yQ(n.key),n)}}function NLe(e,t,r){return t&&A9(e.prototype,t),r&&A9(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function zLe(e,t,r){return t=TE(t),FLe(e,gQ()?Reflect.construct(t,r||[],TE(e).constructor):t.apply(e,r))}function FLe(e,t){if(t&&(__(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return BLe(e)}function BLe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function gQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(gQ=function(){return!!e})()}function TE(e){return TE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},TE(e)}function $Le(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&sR(e,t)}function sR(e,t){return sR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},sR(e,t)}function Hd(e,t,r){return t=yQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function yQ(e){var t=VLe(e,"string");return __(t)=="symbol"?t:t+""}function VLe(e,t){if(__(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(__(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Qb=function(e){function t(){var r;DLe(this,t);for(var n=arguments.length,a=new Array(n),u=0;u<n;u++)a[u]=arguments[u];return r=zLe(this,t,[].concat(a)),Hd(r,"state",{isAnimationFinished:!0,totalLength:0}),Hd(r,"generateSimpleStrokeDasharray",function(f,i){return"".concat(i,"px ").concat(f-i,"px")}),Hd(r,"getStrokeDasharray",function(f,i,y){var w=y.reduce(function(V,H){return V+H});if(!w)return r.generateSimpleStrokeDasharray(i,f);for(var T=Math.floor(f/w),A=f%w,k=i-f,F=[],D=0,O=0;D<y.length;O+=y[D],++D)if(O+y[D]>A){F=[].concat(_v(y.slice(0,D)),[A-O]);break}var N=F.length%2===0?[0,k]:[k];return[].concat(_v(t.repeat(y,T)),_v(F),N).map(function(V){return"".concat(V,"px")}).join(", ")}),Hd(r,"id",Gb("recharts-line-")),Hd(r,"pathRef",function(f){r.mainCurve=f}),Hd(r,"handleAnimationEnd",function(){r.setState({isAnimationFinished:!0}),r.props.onAnimationEnd&&r.props.onAnimationEnd()}),Hd(r,"handleAnimationStart",function(){r.setState({isAnimationFinished:!1}),r.props.onAnimationStart&&r.props.onAnimationStart()}),r}return $Le(t,e),NLe(t,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();this.setState({totalLength:n})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();n!==this.state.totalLength&&this.setState({totalLength:n})}}},{key:"getTotalLength",value:function(){var n=this.mainCurve;try{return n&&n.getTotalLength&&n.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(n,a){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var u=this.props,f=u.points,i=u.xAxis,y=u.yAxis,w=u.layout,T=u.children,A=Ku(T,Yb);if(!A)return null;var k=function(O,N){return{x:O.x,y:O.y,value:O.value,errorVal:du(O.payload,N)}},F={clipPath:n?"url(#clipPath-".concat(a,")"):null};return jt.createElement($o,F,A.map(function(D){return jt.cloneElement(D,{key:"bar-".concat(D.props.dataKey),data:f,xAxis:i,yAxis:y,layout:w,dataPointFormatter:k})}))}},{key:"renderDots",value:function(n,a,u){var f=this.props.isAnimationActive;if(f&&!this.state.isAnimationFinished)return null;var i=this.props,y=i.dot,w=i.points,T=i.dataKey,A=ns(this.props,!1),k=ns(y,!0),F=w.map(function(O,N){var V=Jc(Jc(Jc({key:"dot-".concat(N),r:3},A),k),{},{index:N,cx:O.x,cy:O.y,value:O.value,dataKey:T,payload:O.payload,points:w});return t.renderDotItem(y,V)}),D={clipPath:n?"url(#clipPath-".concat(a?"":"dots-").concat(u,")"):null};return jt.createElement($o,Tx({className:"recharts-line-dots",key:"dots"},D),F)}},{key:"renderCurveStatically",value:function(n,a,u,f){var i=this.props,y=i.type,w=i.layout,T=i.connectNulls;i.ref;var A=T9(i,MLe),k=Jc(Jc(Jc({},ns(A,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:a?"url(#clipPath-".concat(u,")"):null,points:n},f),{},{type:y,layout:w,connectNulls:T});return jt.createElement(DL,Tx({},k,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(n,a){var u=this,f=this.props,i=f.points,y=f.strokeDasharray,w=f.isAnimationActive,T=f.animationBegin,A=f.animationDuration,k=f.animationEasing,F=f.animationId,D=f.animateNewValues,O=f.width,N=f.height,V=this.state,H=V.prevPoints,Z=V.totalLength;return jt.createElement(Tp,{begin:T,duration:A,isActive:w,easing:k,from:{t:0},to:{t:1},key:"line-".concat(F),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(J){var G=J.t;if(H){var Y=H.length/i.length,ie=i.map(function(Le,ze){var Xe=Math.floor(ze*Y);if(H[Xe]){var Je=H[Xe],tt=Wd(Je.x,Le.x),st=Wd(Je.y,Le.y);return Jc(Jc({},Le),{},{x:tt(G),y:st(G)})}if(D){var Ne=Wd(O*2,Le.x),We=Wd(N/2,Le.y);return Jc(Jc({},Le),{},{x:Ne(G),y:We(G)})}return Jc(Jc({},Le),{},{x:Le.x,y:Le.y})});return u.renderCurveStatically(ie,n,a)}var ce=Wd(0,Z),ge=ce(G),be;if(y){var xe="".concat(y).split(/[,\s]+/gim).map(function(Le){return parseFloat(Le)});be=u.getStrokeDasharray(ge,Z,xe)}else be=u.generateSimpleStrokeDasharray(Z,ge);return u.renderCurveStatically(i,n,a,{strokeDasharray:be})})}},{key:"renderCurve",value:function(n,a){var u=this.props,f=u.points,i=u.isAnimationActive,y=this.state,w=y.prevPoints,T=y.totalLength;return i&&f&&f.length&&(!w&&T>0||!P2(w,f))?this.renderCurveWithAnimation(n,a):this.renderCurveStatically(f,n,a)}},{key:"render",value:function(){var n,a=this.props,u=a.hide,f=a.dot,i=a.points,y=a.className,w=a.xAxis,T=a.yAxis,A=a.top,k=a.left,F=a.width,D=a.height,O=a.isAnimationActive,N=a.id;if(u||!i||!i.length)return null;var V=this.state.isAnimationFinished,H=i.length===1,Z=Li("recharts-line",y),J=w&&w.allowDataOverflow,G=T&&T.allowDataOverflow,Y=J||G,ie=Zi(N)?this.id:N,ce=(n=ns(f,!1))!==null&&n!==void 0?n:{r:3,strokeWidth:2},ge=ce.r,be=ge===void 0?3:ge,xe=ce.strokeWidth,Le=xe===void 0?2:xe,ze=xbe(f)?f:{},Xe=ze.clipDot,Je=Xe===void 0?!0:Xe,tt=be*2+Le;return jt.createElement($o,{className:Z},J||G?jt.createElement("defs",null,jt.createElement("clipPath",{id:"clipPath-".concat(ie)},jt.createElement("rect",{x:J?k:k-F/2,y:G?A:A-D/2,width:J?F:F*2,height:G?D:D*2})),!Je&&jt.createElement("clipPath",{id:"clipPath-dots-".concat(ie)},jt.createElement("rect",{x:k-tt/2,y:A-tt/2,width:F+tt,height:D+tt}))):null,!H&&this.renderCurve(Y,ie),this.renderErrorBar(Y,ie),(H||f)&&this.renderDots(Y,Je,ie),(!O||V)&&$m.renderCallByParent(this.props,i))}}],[{key:"getDerivedStateFromProps",value:function(n,a){return n.animationId!==a.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,prevPoints:a.curPoints}:n.points!==a.curPoints?{curPoints:n.points}:null}},{key:"repeat",value:function(n,a){for(var u=n.length%2!==0?[].concat(_v(n),[0]):n,f=[],i=0;i<a;++i)f=[].concat(_v(f),_v(u));return f}},{key:"renderDotItem",value:function(n,a){var u;if(jt.isValidElement(n))u=jt.cloneElement(n,a);else if(Wi(n))u=n(a);else{var f=a.key,i=T9(a,ILe),y=Li("recharts-line-dot",typeof n!="boolean"?n.className:"");u=jt.createElement(RD,Tx({key:f},i,{className:y}))}return u}}])}(j.PureComponent);Hd(Qb,"displayName","Line");Hd(Qb,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!z_.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});Hd(Qb,"getComposedData",function(e){var t=e.props,r=e.xAxis,n=e.yAxis,a=e.xAxisTicks,u=e.yAxisTicks,f=e.dataKey,i=e.bandSize,y=e.displayedData,w=e.offset,T=t.layout,A=y.map(function(k,F){var D=du(k,f);return T==="horizontal"?{x:Uq({axis:r,ticks:a,bandSize:i,entry:k,index:F}),y:Zi(D)?null:n.scale(D),value:D,payload:k}:{x:Zi(D)?null:r.scale(D),y:Uq({axis:n,ticks:u,bandSize:i,entry:k,index:F}),value:D,payload:k}});return Jc({points:A,layout:T},w)});function x_(e){"@babel/helpers - typeof";return x_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},x_(e)}function ULe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function qLe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,xQ(n.key),n)}}function GLe(e,t,r){return t&&qLe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function HLe(e,t,r){return t=CE(t),WLe(e,vQ()?Reflect.construct(t,r||[],CE(e).constructor):t.apply(e,r))}function WLe(e,t){if(t&&(x_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ZLe(e)}function ZLe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function vQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(vQ=function(){return!!e})()}function CE(e){return CE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},CE(e)}function XLe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&oR(e,t)}function oR(e,t){return oR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},oR(e,t)}function _Q(e,t,r){return t=xQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function xQ(e){var t=KLe(e,"string");return x_(t)=="symbol"?t:t+""}function KLe(e,t){if(x_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(x_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function aR(){return aR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},aR.apply(this,arguments)}function YLe(e){var t=e.xAxisId,r=sQ(),n=oQ(),a=nQ(t);return a==null?null:jt.createElement(z2,aR({},a,{className:Li("recharts-".concat(a.axisType," ").concat(a.axisType),a.className),viewBox:{x:0,y:0,width:r,height:n},ticksGenerator:function(f){return hy(f,!0)}}))}var F2=function(e){function t(){return ULe(this,t),HLe(this,t,arguments)}return XLe(t,e),GLe(t,[{key:"render",value:function(){return jt.createElement(YLe,this.props)}}])}(jt.Component);_Q(F2,"displayName","XAxis");_Q(F2,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function b_(e){"@babel/helpers - typeof";return b_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b_(e)}function JLe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function QLe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,SQ(n.key),n)}}function eRe(e,t,r){return t&&QLe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function tRe(e,t,r){return t=AE(t),rRe(e,bQ()?Reflect.construct(t,r||[],AE(e).constructor):t.apply(e,r))}function rRe(e,t){if(t&&(b_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return nRe(e)}function nRe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function bQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(bQ=function(){return!!e})()}function AE(e){return AE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},AE(e)}function iRe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&lR(e,t)}function lR(e,t){return lR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},lR(e,t)}function wQ(e,t,r){return t=SQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function SQ(e){var t=sRe(e,"string");return b_(t)=="symbol"?t:t+""}function sRe(e,t){if(b_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(b_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function cR(){return cR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},cR.apply(this,arguments)}var oRe=function(t){var r=t.yAxisId,n=sQ(),a=oQ(),u=iQ(r);return u==null?null:jt.createElement(z2,cR({},u,{className:Li("recharts-".concat(u.axisType," ").concat(u.axisType),u.className),viewBox:{x:0,y:0,width:n,height:a},ticksGenerator:function(i){return hy(i,!0)}}))},B2=function(e){function t(){return JLe(this,t),tRe(this,t,arguments)}return iRe(t,e),eRe(t,[{key:"render",value:function(){return jt.createElement(oRe,this.props)}}])}(jt.Component);wQ(B2,"displayName","YAxis");wQ(B2,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function P9(e){return uRe(e)||cRe(e)||lRe(e)||aRe()}function aRe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function lRe(e,t){if(e){if(typeof e=="string")return uR(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return uR(e,t)}}function cRe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function uRe(e){if(Array.isArray(e))return uR(e)}function uR(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var dR=function(t,r,n,a,u){var f=Ku(t,ND),i=Ku(t,j2),y=[].concat(P9(f),P9(i)),w=Ku(t,N2),T="".concat(a,"Id"),A=a[0],k=r;if(y.length&&(k=y.reduce(function(O,N){if(N.props[T]===n&&uf(N.props,"extendDomain")&&cn(N.props[A])){var V=N.props[A];return[Math.min(O[0],V),Math.max(O[1],V)]}return O},k)),w.length){var F="".concat(A,"1"),D="".concat(A,"2");k=w.reduce(function(O,N){if(N.props[T]===n&&uf(N.props,"extendDomain")&&cn(N.props[F])&&cn(N.props[D])){var V=N.props[F],H=N.props[D];return[Math.min(O[0],V,H),Math.max(O[1],V,H)]}return O},k)}return u&&u.length&&(k=u.reduce(function(O,N){return cn(N)?[Math.min(O[0],N),Math.max(O[1],N)]:O},k)),k},YI={exports:{}},M9;function dRe(){return M9||(M9=1,function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function a(y,w,T){this.fn=y,this.context=w,this.once=T||!1}function u(y,w,T,A,k){if(typeof T!="function")throw new TypeError("The listener must be a function");var F=new a(T,A||y,k),D=r?r+w:w;return y._events[D]?y._events[D].fn?y._events[D]=[y._events[D],F]:y._events[D].push(F):(y._events[D]=F,y._eventsCount++),y}function f(y,w){--y._eventsCount===0?y._events=new n:delete y._events[w]}function i(){this._events=new n,this._eventsCount=0}i.prototype.eventNames=function(){var w=[],T,A;if(this._eventsCount===0)return w;for(A in T=this._events)t.call(T,A)&&w.push(r?A.slice(1):A);return Object.getOwnPropertySymbols?w.concat(Object.getOwnPropertySymbols(T)):w},i.prototype.listeners=function(w){var T=r?r+w:w,A=this._events[T];if(!A)return[];if(A.fn)return[A.fn];for(var k=0,F=A.length,D=new Array(F);k<F;k++)D[k]=A[k].fn;return D},i.prototype.listenerCount=function(w){var T=r?r+w:w,A=this._events[T];return A?A.fn?1:A.length:0},i.prototype.emit=function(w,T,A,k,F,D){var O=r?r+w:w;if(!this._events[O])return!1;var N=this._events[O],V=arguments.length,H,Z;if(N.fn){switch(N.once&&this.removeListener(w,N.fn,void 0,!0),V){case 1:return N.fn.call(N.context),!0;case 2:return N.fn.call(N.context,T),!0;case 3:return N.fn.call(N.context,T,A),!0;case 4:return N.fn.call(N.context,T,A,k),!0;case 5:return N.fn.call(N.context,T,A,k,F),!0;case 6:return N.fn.call(N.context,T,A,k,F,D),!0}for(Z=1,H=new Array(V-1);Z<V;Z++)H[Z-1]=arguments[Z];N.fn.apply(N.context,H)}else{var J=N.length,G;for(Z=0;Z<J;Z++)switch(N[Z].once&&this.removeListener(w,N[Z].fn,void 0,!0),V){case 1:N[Z].fn.call(N[Z].context);break;case 2:N[Z].fn.call(N[Z].context,T);break;case 3:N[Z].fn.call(N[Z].context,T,A);break;case 4:N[Z].fn.call(N[Z].context,T,A,k);break;default:if(!H)for(G=1,H=new Array(V-1);G<V;G++)H[G-1]=arguments[G];N[Z].fn.apply(N[Z].context,H)}}return!0},i.prototype.on=function(w,T,A){return u(this,w,T,A,!1)},i.prototype.once=function(w,T,A){return u(this,w,T,A,!0)},i.prototype.removeListener=function(w,T,A,k){var F=r?r+w:w;if(!this._events[F])return this;if(!T)return f(this,F),this;var D=this._events[F];if(D.fn)D.fn===T&&(!k||D.once)&&(!A||D.context===A)&&f(this,F);else{for(var O=0,N=[],V=D.length;O<V;O++)(D[O].fn!==T||k&&!D[O].once||A&&D[O].context!==A)&&N.push(D[O]);N.length?this._events[F]=N.length===1?N[0]:N:f(this,F)}return this},i.prototype.removeAllListeners=function(w){var T;return w?(T=r?r+w:w,this._events[T]&&f(this,T)):(this._events=new n,this._eventsCount=0),this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prefixed=r,i.EventEmitter=i,e.exports=i}(YI)),YI.exports}var hRe=dRe();const fRe=vs(hRe);var JI=new fRe,QI="recharts.syncMouseEvents";function Tb(e){"@babel/helpers - typeof";return Tb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Tb(e)}function pRe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function mRe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,EQ(n.key),n)}}function gRe(e,t,r){return t&&mRe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function ek(e,t,r){return t=EQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function EQ(e){var t=yRe(e,"string");return Tb(t)=="symbol"?t:t+""}function yRe(e,t){if(Tb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Tb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var vRe=function(){function e(){pRe(this,e),ek(this,"activeIndex",0),ek(this,"coordinateList",[]),ek(this,"layout","horizontal")}return gRe(e,[{key:"setDetails",value:function(r){var n,a=r.coordinateList,u=a===void 0?null:a,f=r.container,i=f===void 0?null:f,y=r.layout,w=y===void 0?null:y,T=r.offset,A=T===void 0?null:T,k=r.mouseHandlerCallback,F=k===void 0?null:k;this.coordinateList=(n=u??this.coordinateList)!==null&&n!==void 0?n:[],this.container=i??this.container,this.layout=w??this.layout,this.offset=A??this.offset,this.mouseHandlerCallback=F??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(r){if(this.coordinateList.length!==0)switch(r.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(r){this.activeIndex=r}},{key:"spoofMouse",value:function(){var r,n;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var a=this.container.getBoundingClientRect(),u=a.x,f=a.y,i=a.height,y=this.coordinateList[this.activeIndex].coordinate,w=((r=window)===null||r===void 0?void 0:r.scrollX)||0,T=((n=window)===null||n===void 0?void 0:n.scrollY)||0,A=u+y+w,k=f+this.offset.top+i/2+T;this.mouseHandlerCallback({pageX:A,pageY:k})}}}])}();function _Re(e,t,r){if(r==="number"&&t===!0&&Array.isArray(e)){var n=e==null?void 0:e[0],a=e==null?void 0:e[1];if(n&&a&&cn(n)&&cn(a))return!0}return!1}function xRe(e,t,r,n){var a=n/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?t.x-a:r.left+.5,y:e==="horizontal"?r.top+.5:t.y-a,width:e==="horizontal"?n:r.width-1,height:e==="horizontal"?r.height-1:n}}function TQ(e){var t=e.cx,r=e.cy,n=e.radius,a=e.startAngle,u=e.endAngle,f=Za(t,r,n,a),i=Za(t,r,n,u);return{points:[f,i],cx:t,cy:r,radius:n,startAngle:a,endAngle:u}}function bRe(e,t,r){var n,a,u,f;if(e==="horizontal")n=t.x,u=n,a=r.top,f=r.top+r.height;else if(e==="vertical")a=t.y,f=a,n=r.left,u=r.left+r.width;else if(t.cx!=null&&t.cy!=null)if(e==="centric"){var i=t.cx,y=t.cy,w=t.innerRadius,T=t.outerRadius,A=t.angle,k=Za(i,y,w,A),F=Za(i,y,T,A);n=k.x,a=k.y,u=F.x,f=F.y}else return TQ(t);return[{x:n,y:a},{x:u,y:f}]}function Cb(e){"@babel/helpers - typeof";return Cb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cb(e)}function I9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Aw(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?I9(Object(r),!0).forEach(function(n){wRe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I9(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function wRe(e,t,r){return t=SRe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function SRe(e){var t=ERe(e,"string");return Cb(t)=="symbol"?t:t+""}function ERe(e,t){if(Cb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Cb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function TRe(e){var t,r,n=e.element,a=e.tooltipEventType,u=e.isActive,f=e.activeCoordinate,i=e.activePayload,y=e.offset,w=e.activeTooltipIndex,T=e.tooltipAxisBandSize,A=e.layout,k=e.chartName,F=(t=n.props.cursor)!==null&&t!==void 0?t:(r=n.type.defaultProps)===null||r===void 0?void 0:r.cursor;if(!n||!F||!u||!f||k!=="ScatterChart"&&a!=="axis")return null;var D,O=DL;if(k==="ScatterChart")D=f,O=NIe;else if(k==="BarChart")D=xRe(A,f,y,T),O=LD;else if(A==="radial"){var N=TQ(f),V=N.cx,H=N.cy,Z=N.radius,J=N.startAngle,G=N.endAngle;D={cx:V,cy:H,startAngle:J,endAngle:G,innerRadius:Z,outerRadius:Z},O=LJ}else D={points:bRe(A,f,y)},O=DL;var Y=Aw(Aw(Aw(Aw({stroke:"#ccc",pointerEvents:"none"},y),D),ns(F,!1)),{},{payload:i,payloadIndex:w,className:Li("recharts-tooltip-cursor",F.className)});return j.isValidElement(F)?j.cloneElement(F,Y):j.createElement(O,Y)}var CRe=["item"],ARe=["children","className","width","height","style","compact","title","desc"];function w_(e){"@babel/helpers - typeof";return w_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},w_(e)}function Dv(){return Dv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Dv.apply(this,arguments)}function k9(e,t){return IRe(e)||MRe(e,t)||AQ(e,t)||PRe()}function PRe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function MRe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,u,f,i=[],y=!0,w=!1;try{if(u=(r=r.call(e)).next,t!==0)for(;!(y=(n=u.call(r)).done)&&(i.push(n.value),i.length!==t);y=!0);}catch(T){w=!0,a=T}finally{try{if(!y&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(w)throw a}}return i}}function IRe(e){if(Array.isArray(e))return e}function O9(e,t){if(e==null)return{};var r=kRe(e,t),n,a;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(a=0;a<u.length;a++)n=u[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function kRe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function ORe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function LRe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,PQ(n.key),n)}}function RRe(e,t,r){return t&&LRe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function jRe(e,t,r){return t=PE(t),DRe(e,CQ()?Reflect.construct(t,r||[],PE(e).constructor):t.apply(e,r))}function DRe(e,t){if(t&&(w_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return NRe(e)}function NRe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function CQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(CQ=function(){return!!e})()}function PE(e){return PE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},PE(e)}function zRe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&hR(e,t)}function hR(e,t){return hR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},hR(e,t)}function S_(e){return $Re(e)||BRe(e)||AQ(e)||FRe()}function FRe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function AQ(e,t){if(e){if(typeof e=="string")return fR(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return fR(e,t)}}function BRe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function $Re(e){if(Array.isArray(e))return fR(e)}function fR(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function L9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function _r(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?L9(Object(r),!0).forEach(function(n){Xn(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L9(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Xn(e,t,r){return t=PQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function PQ(e){var t=VRe(e,"string");return w_(t)=="symbol"?t:t+""}function VRe(e,t){if(w_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(w_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var URe={xAxis:["bottom","top"],yAxis:["left","right"]},qRe={width:"100%",height:"100%"},MQ={x:0,y:0};function Pw(e){return e}var GRe=function(t,r){return r==="horizontal"?t.x:r==="vertical"?t.y:r==="centric"?t.angle:t.radius},HRe=function(t,r,n,a){var u=r.find(function(T){return T&&T.index===n});if(u){if(t==="horizontal")return{x:u.coordinate,y:a.y};if(t==="vertical")return{x:a.x,y:u.coordinate};if(t==="centric"){var f=u.coordinate,i=a.radius;return _r(_r(_r({},a),Za(a.cx,a.cy,i,f)),{},{angle:f,radius:i})}var y=u.coordinate,w=a.angle;return _r(_r(_r({},a),Za(a.cx,a.cy,y,w)),{},{angle:w,radius:y})}return MQ},$2=function(t,r){var n=r.graphicalItems,a=r.dataStartIndex,u=r.dataEndIndex,f=(n??[]).reduce(function(i,y){var w=y.props.data;return w&&w.length?[].concat(S_(i),S_(w)):i},[]);return f.length>0?f:t&&t.length&&cn(a)&&cn(u)?t.slice(a,u+1):[]};function IQ(e){return e==="number"?[0,"auto"]:void 0}var pR=function(t,r,n,a){var u=t.graphicalItems,f=t.tooltipAxis,i=$2(r,t);return n<0||!u||!u.length||n>=i.length?null:u.reduce(function(y,w){var T,A=(T=w.props.data)!==null&&T!==void 0?T:r;A&&t.dataStartIndex+t.dataEndIndex!==0&&t.dataEndIndex-t.dataStartIndex>=n&&(A=A.slice(t.dataStartIndex,t.dataEndIndex+1));var k;if(f.dataKey&&!f.allowDuplicatedCategory){var F=A===void 0?i:A;k=LS(F,f.dataKey,a)}else k=A&&A[n]||i[n];return k?[].concat(S_(y),[IJ(w,k)]):y},[])},R9=function(t,r,n,a){var u=a||{x:t.chartX,y:t.chartY},f=GRe(u,n),i=t.orderedTooltipTicks,y=t.tooltipAxis,w=t.tooltipTicks,T=xAe(f,i,w,y);if(T>=0&&w){var A=w[T]&&w[T].value,k=pR(t,r,T,A),F=HRe(n,i,T,u);return{activeTooltipIndex:T,activeLabel:A,activePayload:k,activeCoordinate:F}}return null},WRe=function(t,r){var n=r.axes,a=r.graphicalItems,u=r.axisType,f=r.axisIdKey,i=r.stackGroups,y=r.dataStartIndex,w=r.dataEndIndex,T=t.layout,A=t.children,k=t.stackOffset,F=PJ(T,u);return n.reduce(function(D,O){var N,V=O.type.defaultProps!==void 0?_r(_r({},O.type.defaultProps),O.props):O.props,H=V.type,Z=V.dataKey,J=V.allowDataOverflow,G=V.allowDuplicatedCategory,Y=V.scale,ie=V.ticks,ce=V.includeHidden,ge=V[f];if(D[ge])return D;var be=$2(t.data,{graphicalItems:a.filter(function(Ke){var lt,Ye=f in Ke.props?Ke.props[f]:(lt=Ke.type.defaultProps)===null||lt===void 0?void 0:lt[f];return Ye===ge}),dataStartIndex:y,dataEndIndex:w}),xe=be.length,Le,ze,Xe;_Re(V.domain,J,H)&&(Le=kL(V.domain,null,J),F&&(H==="number"||Y!=="auto")&&(Xe=Sx(be,Z,"category")));var Je=IQ(H);if(!Le||Le.length===0){var tt,st=(tt=V.domain)!==null&&tt!==void 0?tt:Je;if(Z){if(Le=Sx(be,Z,H),H==="category"&&F){var Ne=ube(Le);G&&Ne?(ze=Le,Le=mE(0,xe)):G||(Le=Wq(st,Le,O).reduce(function(Ke,lt){return Ke.indexOf(lt)>=0?Ke:[].concat(S_(Ke),[lt])},[]))}else if(H==="category")G?Le=Le.filter(function(Ke){return Ke!==""&&!Zi(Ke)}):Le=Wq(st,Le,O).reduce(function(Ke,lt){return Ke.indexOf(lt)>=0||lt===""||Zi(lt)?Ke:[].concat(S_(Ke),[lt])},[]);else if(H==="number"){var We=TAe(be,a.filter(function(Ke){var lt,Ye,Ve=f in Ke.props?Ke.props[f]:(lt=Ke.type.defaultProps)===null||lt===void 0?void 0:lt[f],Et="hide"in Ke.props?Ke.props.hide:(Ye=Ke.type.defaultProps)===null||Ye===void 0?void 0:Ye.hide;return Ve===ge&&(ce||!Et)}),Z,u,T);We&&(Le=We)}F&&(H==="number"||Y!=="auto")&&(Xe=Sx(be,Z,"category"))}else F?Le=mE(0,xe):i&&i[ge]&&i[ge].hasStack&&H==="number"?Le=k==="expand"?[0,1]:MJ(i[ge].stackGroups,y,w):Le=AJ(be,a.filter(function(Ke){var lt=f in Ke.props?Ke.props[f]:Ke.type.defaultProps[f],Ye="hide"in Ke.props?Ke.props.hide:Ke.type.defaultProps.hide;return lt===ge&&(ce||!Ye)}),H,T,!0);if(H==="number")Le=dR(A,Le,ge,u,ie),st&&(Le=kL(st,Le,J));else if(H==="category"&&st){var Ue=st,De=Le.every(function(Ke){return Ue.indexOf(Ke)>=0});De&&(Le=Ue)}}return _r(_r({},D),{},Xn({},ge,_r(_r({},V),{},{axisType:u,domain:Le,categoricalDomain:Xe,duplicateDomain:ze,originalDomain:(N=V.domain)!==null&&N!==void 0?N:Je,isCategorical:F,layout:T})))},{})},ZRe=function(t,r){var n=r.graphicalItems,a=r.Axis,u=r.axisType,f=r.axisIdKey,i=r.stackGroups,y=r.dataStartIndex,w=r.dataEndIndex,T=t.layout,A=t.children,k=$2(t.data,{graphicalItems:n,dataStartIndex:y,dataEndIndex:w}),F=k.length,D=PJ(T,u),O=-1;return n.reduce(function(N,V){var H=V.type.defaultProps!==void 0?_r(_r({},V.type.defaultProps),V.props):V.props,Z=H[f],J=IQ("number");if(!N[Z]){O++;var G;return D?G=mE(0,F):i&&i[Z]&&i[Z].hasStack?(G=MJ(i[Z].stackGroups,y,w),G=dR(A,G,Z,u)):(G=kL(J,AJ(k,n.filter(function(Y){var ie,ce,ge=f in Y.props?Y.props[f]:(ie=Y.type.defaultProps)===null||ie===void 0?void 0:ie[f],be="hide"in Y.props?Y.props.hide:(ce=Y.type.defaultProps)===null||ce===void 0?void 0:ce.hide;return ge===Z&&!be}),"number",T),a.defaultProps.allowDataOverflow),G=dR(A,G,Z,u)),_r(_r({},N),{},Xn({},Z,_r(_r({axisType:u},a.defaultProps),{},{hide:!0,orientation:Xu(URe,"".concat(u,".").concat(O%2),null),domain:G,originalDomain:J,isCategorical:D,layout:T})))}return N},{})},XRe=function(t,r){var n=r.axisType,a=n===void 0?"xAxis":n,u=r.AxisComp,f=r.graphicalItems,i=r.stackGroups,y=r.dataStartIndex,w=r.dataEndIndex,T=t.children,A="".concat(a,"Id"),k=Ku(T,u),F={};return k&&k.length?F=WRe(t,{axes:k,graphicalItems:f,axisType:a,axisIdKey:A,stackGroups:i,dataStartIndex:y,dataEndIndex:w}):f&&f.length&&(F=ZRe(t,{Axis:u,graphicalItems:f,axisType:a,axisIdKey:A,stackGroups:i,dataStartIndex:y,dataEndIndex:w})),F},KRe=function(t){var r=Cv(t),n=hy(r,!1,!0);return{tooltipTicks:n,orderedTooltipTicks:oD(n,function(a){return a.coordinate}),tooltipAxis:r,tooltipAxisBandSize:oE(r,n)}},j9=function(t){var r=t.children,n=t.defaultShowTooltip,a=eu(r,f_),u=0,f=0;return t.data&&t.data.length!==0&&(f=t.data.length-1),a&&a.props&&(a.props.startIndex>=0&&(u=a.props.startIndex),a.props.endIndex>=0&&(f=a.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:u,dataEndIndex:f,activeTooltipIndex:-1,isTooltipActive:!!n}},YRe=function(t){return!t||!t.length?!1:t.some(function(r){var n=gp(r&&r.type);return n&&n.indexOf("Bar")>=0})},D9=function(t){return t==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:t==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:t==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},JRe=function(t,r){var n=t.props,a=t.graphicalItems,u=t.xAxisMap,f=u===void 0?{}:u,i=t.yAxisMap,y=i===void 0?{}:i,w=n.width,T=n.height,A=n.children,k=n.margin||{},F=eu(A,f_),D=eu(A,qv),O=Object.keys(y).reduce(function(G,Y){var ie=y[Y],ce=ie.orientation;return!ie.mirror&&!ie.hide?_r(_r({},G),{},Xn({},ce,G[ce]+ie.width)):G},{left:k.left||0,right:k.right||0}),N=Object.keys(f).reduce(function(G,Y){var ie=f[Y],ce=ie.orientation;return!ie.mirror&&!ie.hide?_r(_r({},G),{},Xn({},ce,Xu(G,"".concat(ce))+ie.height)):G},{top:k.top||0,bottom:k.bottom||0}),V=_r(_r({},N),O),H=V.bottom;F&&(V.bottom+=F.props.height||f_.defaultProps.height),D&&r&&(V=SAe(V,a,n,r));var Z=w-V.left-V.right,J=T-V.top-V.bottom;return _r(_r({brushBottom:H},V),{},{width:Math.max(Z,0),height:Math.max(J,0)})},QRe=function(t,r){if(r==="xAxis")return t[r].width;if(r==="yAxis")return t[r].height},eje=function(t){var r=t.chartName,n=t.GraphicalChild,a=t.defaultTooltipEventType,u=a===void 0?"axis":a,f=t.validateTooltipEventTypes,i=f===void 0?["axis"]:f,y=t.axisComponents,w=t.legendContent,T=t.formatAxisMap,A=t.defaultProps,k=function(V,H){var Z=H.graphicalItems,J=H.stackGroups,G=H.offset,Y=H.updateId,ie=H.dataStartIndex,ce=H.dataEndIndex,ge=V.barSize,be=V.layout,xe=V.barGap,Le=V.barCategoryGap,ze=V.maxBarSize,Xe=D9(be),Je=Xe.numericAxisName,tt=Xe.cateAxisName,st=YRe(Z),Ne=[];return Z.forEach(function(We,Ue){var De=$2(V.data,{graphicalItems:[We],dataStartIndex:ie,dataEndIndex:ce}),Ke=We.type.defaultProps!==void 0?_r(_r({},We.type.defaultProps),We.props):We.props,lt=Ke.dataKey,Ye=Ke.maxBarSize,Ve=Ke["".concat(Je,"Id")],Et=Ke["".concat(tt,"Id")],kt={},Wt=y.reduce(function(un,Fn){var vi=H["".concat(Fn.axisType,"Map")],xr=Ke["".concat(Fn.axisType,"Id")];vi&&vi[xr]||Fn.axisType==="zAxis"||Py();var Hr=vi[xr];return _r(_r({},un),{},Xn(Xn({},Fn.axisType,Hr),"".concat(Fn.axisType,"Ticks"),hy(Hr)))},kt),Tt=Wt[tt],Ht=Wt["".concat(tt,"Ticks")],ur=J&&J[Ve]&&J[Ve].hasStack&&NAe(We,J[Ve].stackGroups),Jt=gp(We.type).indexOf("Bar")>=0,Rt=oE(Tt,Ht),Dt=[],sr=st&&bAe({barSize:ge,stackGroups:J,totalSize:QRe(Wt,tt)});if(Jt){var mr,Vr,rn=Zi(Ye)?ze:Ye,$r=(mr=(Vr=oE(Tt,Ht,!0))!==null&&Vr!==void 0?Vr:rn)!==null&&mr!==void 0?mr:0;Dt=wAe({barGap:xe,barCategoryGap:Le,bandSize:$r!==Rt?$r:Rt,sizeList:sr[Et],maxBarSize:rn}),$r!==Rt&&(Dt=Dt.map(function(un){return _r(_r({},un),{},{position:_r(_r({},un.position),{},{offset:un.position.offset-$r/2})})}))}var Yr=We&&We.type&&We.type.getComposedData;Yr&&Ne.push({props:_r(_r({},Yr(_r(_r({},Wt),{},{displayedData:De,props:V,dataKey:lt,item:We,bandSize:Rt,barPosition:Dt,offset:G,stackedData:ur,layout:be,dataStartIndex:ie,dataEndIndex:ce}))),{},Xn(Xn(Xn({key:We.key||"item-".concat(Ue)},Je,Wt[Je]),tt,Wt[tt]),"animationId",Y)),childIndex:Sbe(We,V.children),item:We})}),Ne},F=function(V,H){var Z=V.props,J=V.dataStartIndex,G=V.dataEndIndex,Y=V.updateId;if(!aV({props:Z}))return null;var ie=Z.children,ce=Z.layout,ge=Z.stackOffset,be=Z.data,xe=Z.reverseStackOrder,Le=D9(ce),ze=Le.numericAxisName,Xe=Le.cateAxisName,Je=Ku(ie,n),tt=RAe(be,Je,"".concat(ze,"Id"),"".concat(Xe,"Id"),ge,xe),st=y.reduce(function(Ke,lt){var Ye="".concat(lt.axisType,"Map");return _r(_r({},Ke),{},Xn({},Ye,XRe(Z,_r(_r({},lt),{},{graphicalItems:Je,stackGroups:lt.axisType===ze&&tt,dataStartIndex:J,dataEndIndex:G}))))},{}),Ne=JRe(_r(_r({},st),{},{props:Z,graphicalItems:Je}),H==null?void 0:H.legendBBox);Object.keys(st).forEach(function(Ke){st[Ke]=T(Z,st[Ke],Ne,Ke.replace("Map",""),r)});var We=st["".concat(Xe,"Map")],Ue=KRe(We),De=k(Z,_r(_r({},st),{},{dataStartIndex:J,dataEndIndex:G,updateId:Y,graphicalItems:Je,stackGroups:tt,offset:Ne}));return _r(_r({formattedGraphicalItems:De,graphicalItems:Je,offset:Ne,stackGroups:tt},Ue),st)},D=function(N){function V(H){var Z,J,G;return ORe(this,V),G=jRe(this,V,[H]),Xn(G,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),Xn(G,"accessibilityManager",new vRe),Xn(G,"handleLegendBBoxUpdate",function(Y){if(Y){var ie=G.state,ce=ie.dataStartIndex,ge=ie.dataEndIndex,be=ie.updateId;G.setState(_r({legendBBox:Y},F({props:G.props,dataStartIndex:ce,dataEndIndex:ge,updateId:be},_r(_r({},G.state),{},{legendBBox:Y}))))}}),Xn(G,"handleReceiveSyncEvent",function(Y,ie,ce){if(G.props.syncId===Y){if(ce===G.eventEmitterSymbol&&typeof G.props.syncMethod!="function")return;G.applySyncEvent(ie)}}),Xn(G,"handleBrushChange",function(Y){var ie=Y.startIndex,ce=Y.endIndex;if(ie!==G.state.dataStartIndex||ce!==G.state.dataEndIndex){var ge=G.state.updateId;G.setState(function(){return _r({dataStartIndex:ie,dataEndIndex:ce},F({props:G.props,dataStartIndex:ie,dataEndIndex:ce,updateId:ge},G.state))}),G.triggerSyncEvent({dataStartIndex:ie,dataEndIndex:ce})}}),Xn(G,"handleMouseEnter",function(Y){var ie=G.getMouseInfo(Y);if(ie){var ce=_r(_r({},ie),{},{isTooltipActive:!0});G.setState(ce),G.triggerSyncEvent(ce);var ge=G.props.onMouseEnter;Wi(ge)&&ge(ce,Y)}}),Xn(G,"triggeredAfterMouseMove",function(Y){var ie=G.getMouseInfo(Y),ce=ie?_r(_r({},ie),{},{isTooltipActive:!0}):{isTooltipActive:!1};G.setState(ce),G.triggerSyncEvent(ce);var ge=G.props.onMouseMove;Wi(ge)&&ge(ce,Y)}),Xn(G,"handleItemMouseEnter",function(Y){G.setState(function(){return{isTooltipActive:!0,activeItem:Y,activePayload:Y.tooltipPayload,activeCoordinate:Y.tooltipPosition||{x:Y.cx,y:Y.cy}}})}),Xn(G,"handleItemMouseLeave",function(){G.setState(function(){return{isTooltipActive:!1}})}),Xn(G,"handleMouseMove",function(Y){Y.persist(),G.throttleTriggeredAfterMouseMove(Y)}),Xn(G,"handleMouseLeave",function(Y){G.throttleTriggeredAfterMouseMove.cancel();var ie={isTooltipActive:!1};G.setState(ie),G.triggerSyncEvent(ie);var ce=G.props.onMouseLeave;Wi(ce)&&ce(ie,Y)}),Xn(G,"handleOuterEvent",function(Y){var ie=wbe(Y),ce=Xu(G.props,"".concat(ie));if(ie&&Wi(ce)){var ge,be;/.*touch.*/i.test(ie)?be=G.getMouseInfo(Y.changedTouches[0]):be=G.getMouseInfo(Y),ce((ge=be)!==null&&ge!==void 0?ge:{},Y)}}),Xn(G,"handleClick",function(Y){var ie=G.getMouseInfo(Y);if(ie){var ce=_r(_r({},ie),{},{isTooltipActive:!0});G.setState(ce),G.triggerSyncEvent(ce);var ge=G.props.onClick;Wi(ge)&&ge(ce,Y)}}),Xn(G,"handleMouseDown",function(Y){var ie=G.props.onMouseDown;if(Wi(ie)){var ce=G.getMouseInfo(Y);ie(ce,Y)}}),Xn(G,"handleMouseUp",function(Y){var ie=G.props.onMouseUp;if(Wi(ie)){var ce=G.getMouseInfo(Y);ie(ce,Y)}}),Xn(G,"handleTouchMove",function(Y){Y.changedTouches!=null&&Y.changedTouches.length>0&&G.throttleTriggeredAfterMouseMove(Y.changedTouches[0])}),Xn(G,"handleTouchStart",function(Y){Y.changedTouches!=null&&Y.changedTouches.length>0&&G.handleMouseDown(Y.changedTouches[0])}),Xn(G,"handleTouchEnd",function(Y){Y.changedTouches!=null&&Y.changedTouches.length>0&&G.handleMouseUp(Y.changedTouches[0])}),Xn(G,"handleDoubleClick",function(Y){var ie=G.props.onDoubleClick;if(Wi(ie)){var ce=G.getMouseInfo(Y);ie(ce,Y)}}),Xn(G,"handleContextMenu",function(Y){var ie=G.props.onContextMenu;if(Wi(ie)){var ce=G.getMouseInfo(Y);ie(ce,Y)}}),Xn(G,"triggerSyncEvent",function(Y){G.props.syncId!==void 0&&JI.emit(QI,G.props.syncId,Y,G.eventEmitterSymbol)}),Xn(G,"applySyncEvent",function(Y){var ie=G.props,ce=ie.layout,ge=ie.syncMethod,be=G.state.updateId,xe=Y.dataStartIndex,Le=Y.dataEndIndex;if(Y.dataStartIndex!==void 0||Y.dataEndIndex!==void 0)G.setState(_r({dataStartIndex:xe,dataEndIndex:Le},F({props:G.props,dataStartIndex:xe,dataEndIndex:Le,updateId:be},G.state)));else if(Y.activeTooltipIndex!==void 0){var ze=Y.chartX,Xe=Y.chartY,Je=Y.activeTooltipIndex,tt=G.state,st=tt.offset,Ne=tt.tooltipTicks;if(!st)return;if(typeof ge=="function")Je=ge(Ne,Y);else if(ge==="value"){Je=-1;for(var We=0;We<Ne.length;We++)if(Ne[We].value===Y.activeLabel){Je=We;break}}var Ue=_r(_r({},st),{},{x:st.left,y:st.top}),De=Math.min(ze,Ue.x+Ue.width),Ke=Math.min(Xe,Ue.y+Ue.height),lt=Ne[Je]&&Ne[Je].value,Ye=pR(G.state,G.props.data,Je),Ve=Ne[Je]?{x:ce==="horizontal"?Ne[Je].coordinate:De,y:ce==="horizontal"?Ke:Ne[Je].coordinate}:MQ;G.setState(_r(_r({},Y),{},{activeLabel:lt,activeCoordinate:Ve,activePayload:Ye,activeTooltipIndex:Je}))}else G.setState(Y)}),Xn(G,"renderCursor",function(Y){var ie,ce=G.state,ge=ce.isTooltipActive,be=ce.activeCoordinate,xe=ce.activePayload,Le=ce.offset,ze=ce.activeTooltipIndex,Xe=ce.tooltipAxisBandSize,Je=G.getTooltipEventType(),tt=(ie=Y.props.active)!==null&&ie!==void 0?ie:ge,st=G.props.layout,Ne=Y.key||"_recharts-cursor";return jt.createElement(TRe,{key:Ne,activeCoordinate:be,activePayload:xe,activeTooltipIndex:ze,chartName:r,element:Y,isActive:tt,layout:st,offset:Le,tooltipAxisBandSize:Xe,tooltipEventType:Je})}),Xn(G,"renderPolarAxis",function(Y,ie,ce){var ge=Xu(Y,"type.axisType"),be=Xu(G.state,"".concat(ge,"Map")),xe=Y.type.defaultProps,Le=xe!==void 0?_r(_r({},xe),Y.props):Y.props,ze=be&&be[Le["".concat(ge,"Id")]];return j.cloneElement(Y,_r(_r({},ze),{},{className:Li(ge,ze.className),key:Y.key||"".concat(ie,"-").concat(ce),ticks:hy(ze,!0)}))}),Xn(G,"renderPolarGrid",function(Y){var ie=Y.props,ce=ie.radialLines,ge=ie.polarAngles,be=ie.polarRadius,xe=G.state,Le=xe.radiusAxisMap,ze=xe.angleAxisMap,Xe=Cv(Le),Je=Cv(ze),tt=Je.cx,st=Je.cy,Ne=Je.innerRadius,We=Je.outerRadius;return j.cloneElement(Y,{polarAngles:Array.isArray(ge)?ge:hy(Je,!0).map(function(Ue){return Ue.coordinate}),polarRadius:Array.isArray(be)?be:hy(Xe,!0).map(function(Ue){return Ue.coordinate}),cx:tt,cy:st,innerRadius:Ne,outerRadius:We,key:Y.key||"polar-grid",radialLines:ce})}),Xn(G,"renderLegend",function(){var Y=G.state.formattedGraphicalItems,ie=G.props,ce=ie.children,ge=ie.width,be=ie.height,xe=G.props.margin||{},Le=ge-(xe.left||0)-(xe.right||0),ze=TJ({children:ce,formattedGraphicalItems:Y,legendWidth:Le,legendContent:w});if(!ze)return null;var Xe=ze.item,Je=O9(ze,CRe);return j.cloneElement(Xe,_r(_r({},Je),{},{chartWidth:ge,chartHeight:be,margin:xe,onBBoxUpdate:G.handleLegendBBoxUpdate}))}),Xn(G,"renderTooltip",function(){var Y,ie=G.props,ce=ie.children,ge=ie.accessibilityLayer,be=eu(ce,Qh);if(!be)return null;var xe=G.state,Le=xe.isTooltipActive,ze=xe.activeCoordinate,Xe=xe.activePayload,Je=xe.activeLabel,tt=xe.offset,st=(Y=be.props.active)!==null&&Y!==void 0?Y:Le;return j.cloneElement(be,{viewBox:_r(_r({},tt),{},{x:tt.left,y:tt.top}),active:st,label:Je,payload:st?Xe:[],coordinate:ze,accessibilityLayer:ge})}),Xn(G,"renderBrush",function(Y){var ie=G.props,ce=ie.margin,ge=ie.data,be=G.state,xe=be.offset,Le=be.dataStartIndex,ze=be.dataEndIndex,Xe=be.updateId;return j.cloneElement(Y,{key:Y.key||"_recharts-brush",onChange:Sw(G.handleBrushChange,Y.props.onChange),data:ge,x:cn(Y.props.x)?Y.props.x:xe.left,y:cn(Y.props.y)?Y.props.y:xe.top+xe.height+xe.brushBottom-(ce.bottom||0),width:cn(Y.props.width)?Y.props.width:xe.width,startIndex:Le,endIndex:ze,updateId:"brush-".concat(Xe)})}),Xn(G,"renderReferenceElement",function(Y,ie,ce){if(!Y)return null;var ge=G,be=ge.clipPathId,xe=G.state,Le=xe.xAxisMap,ze=xe.yAxisMap,Xe=xe.offset,Je=Y.type.defaultProps||{},tt=Y.props,st=tt.xAxisId,Ne=st===void 0?Je.xAxisId:st,We=tt.yAxisId,Ue=We===void 0?Je.yAxisId:We;return j.cloneElement(Y,{key:Y.key||"".concat(ie,"-").concat(ce),xAxis:Le[Ne],yAxis:ze[Ue],viewBox:{x:Xe.left,y:Xe.top,width:Xe.width,height:Xe.height},clipPathId:be})}),Xn(G,"renderActivePoints",function(Y){var ie=Y.item,ce=Y.activePoint,ge=Y.basePoint,be=Y.childIndex,xe=Y.isRange,Le=[],ze=ie.props.key,Xe=ie.item.type.defaultProps!==void 0?_r(_r({},ie.item.type.defaultProps),ie.item.props):ie.item.props,Je=Xe.activeDot,tt=Xe.dataKey,st=_r(_r({index:be,dataKey:tt,cx:ce.x,cy:ce.y,r:4,fill:OD(ie.item),strokeWidth:2,stroke:"#fff",payload:ce.payload,value:ce.value},ns(Je,!1)),RS(Je));return Le.push(V.renderActiveDot(Je,st,"".concat(ze,"-activePoint-").concat(be))),ge?Le.push(V.renderActiveDot(Je,_r(_r({},st),{},{cx:ge.x,cy:ge.y}),"".concat(ze,"-basePoint-").concat(be))):xe&&Le.push(null),Le}),Xn(G,"renderGraphicChild",function(Y,ie,ce){var ge=G.filterFormatItem(Y,ie,ce);if(!ge)return null;var be=G.getTooltipEventType(),xe=G.state,Le=xe.isTooltipActive,ze=xe.tooltipAxis,Xe=xe.activeTooltipIndex,Je=xe.activeLabel,tt=G.props.children,st=eu(tt,Qh),Ne=ge.props,We=Ne.points,Ue=Ne.isRange,De=Ne.baseLine,Ke=ge.item.type.defaultProps!==void 0?_r(_r({},ge.item.type.defaultProps),ge.item.props):ge.item.props,lt=Ke.activeDot,Ye=Ke.hide,Ve=Ke.activeBar,Et=Ke.activeShape,kt=!!(!Ye&&Le&&st&&(lt||Ve||Et)),Wt={};be!=="axis"&&st&&st.props.trigger==="click"?Wt={onClick:Sw(G.handleItemMouseEnter,Y.props.onClick)}:be!=="axis"&&(Wt={onMouseLeave:Sw(G.handleItemMouseLeave,Y.props.onMouseLeave),onMouseEnter:Sw(G.handleItemMouseEnter,Y.props.onMouseEnter)});var Tt=j.cloneElement(Y,_r(_r({},ge.props),Wt));function Ht(Fn){return typeof ze.dataKey=="function"?ze.dataKey(Fn.payload):null}if(kt)if(Xe>=0){var ur,Jt;if(ze.dataKey&&!ze.allowDuplicatedCategory){var Rt=typeof ze.dataKey=="function"?Ht:"payload.".concat(ze.dataKey.toString());ur=LS(We,Rt,Je),Jt=Ue&&De&&LS(De,Rt,Je)}else ur=We==null?void 0:We[Xe],Jt=Ue&&De&&De[Xe];if(Et||Ve){var Dt=Y.props.activeIndex!==void 0?Y.props.activeIndex:Xe;return[j.cloneElement(Y,_r(_r(_r({},ge.props),Wt),{},{activeIndex:Dt})),null,null]}if(!Zi(ur))return[Tt].concat(S_(G.renderActivePoints({item:ge,activePoint:ur,basePoint:Jt,childIndex:Xe,isRange:Ue})))}else{var sr,mr=(sr=G.getItemByXY(G.state.activeCoordinate))!==null&&sr!==void 0?sr:{graphicalItem:Tt},Vr=mr.graphicalItem,rn=Vr.item,$r=rn===void 0?Y:rn,Yr=Vr.childIndex,un=_r(_r(_r({},ge.props),Wt),{},{activeIndex:Yr});return[j.cloneElement($r,un),null,null]}return Ue?[Tt,null,null]:[Tt,null]}),Xn(G,"renderCustomized",function(Y,ie,ce){return j.cloneElement(Y,_r(_r({key:"recharts-customized-".concat(ce)},G.props),G.state))}),Xn(G,"renderMap",{CartesianGrid:{handler:Pw,once:!0},ReferenceArea:{handler:G.renderReferenceElement},ReferenceLine:{handler:Pw},ReferenceDot:{handler:G.renderReferenceElement},XAxis:{handler:Pw},YAxis:{handler:Pw},Brush:{handler:G.renderBrush,once:!0},Bar:{handler:G.renderGraphicChild},Line:{handler:G.renderGraphicChild},Area:{handler:G.renderGraphicChild},Radar:{handler:G.renderGraphicChild},RadialBar:{handler:G.renderGraphicChild},Scatter:{handler:G.renderGraphicChild},Pie:{handler:G.renderGraphicChild},Funnel:{handler:G.renderGraphicChild},Tooltip:{handler:G.renderCursor,once:!0},PolarGrid:{handler:G.renderPolarGrid,once:!0},PolarAngleAxis:{handler:G.renderPolarAxis},PolarRadiusAxis:{handler:G.renderPolarAxis},Customized:{handler:G.renderCustomized}}),G.clipPathId="".concat((Z=H.id)!==null&&Z!==void 0?Z:Gb("recharts"),"-clip"),G.throttleTriggeredAfterMouseMove=EY(G.triggeredAfterMouseMove,(J=H.throttleDelay)!==null&&J!==void 0?J:1e3/60),G.state={},G}return zRe(V,N),RRe(V,[{key:"componentDidMount",value:function(){var Z,J;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(Z=this.props.margin.left)!==null&&Z!==void 0?Z:0,top:(J=this.props.margin.top)!==null&&J!==void 0?J:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var Z=this.props,J=Z.children,G=Z.data,Y=Z.height,ie=Z.layout,ce=eu(J,Qh);if(ce){var ge=ce.props.defaultIndex;if(!(typeof ge!="number"||ge<0||ge>this.state.tooltipTicks.length-1)){var be=this.state.tooltipTicks[ge]&&this.state.tooltipTicks[ge].value,xe=pR(this.state,G,ge,be),Le=this.state.tooltipTicks[ge].coordinate,ze=(this.state.offset.top+Y)/2,Xe=ie==="horizontal",Je=Xe?{x:Le,y:ze}:{y:Le,x:ze},tt=this.state.formattedGraphicalItems.find(function(Ne){var We=Ne.item;return We.type.name==="Scatter"});tt&&(Je=_r(_r({},Je),tt.props.points[ge].tooltipPosition),xe=tt.props.points[ge].tooltipPayload);var st={activeTooltipIndex:ge,isTooltipActive:!0,activeLabel:be,activePayload:xe,activeCoordinate:Je};this.setState(st),this.renderCursor(ce),this.accessibilityManager.setIndex(ge)}}}},{key:"getSnapshotBeforeUpdate",value:function(Z,J){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==J.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==Z.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==Z.margin){var G,Y;this.accessibilityManager.setDetails({offset:{left:(G=this.props.margin.left)!==null&&G!==void 0?G:0,top:(Y=this.props.margin.top)!==null&&Y!==void 0?Y:0}})}return null}},{key:"componentDidUpdate",value:function(Z){QO([eu(Z.children,Qh)],[eu(this.props.children,Qh)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var Z=eu(this.props.children,Qh);if(Z&&typeof Z.props.shared=="boolean"){var J=Z.props.shared?"axis":"item";return i.indexOf(J)>=0?J:u}return u}},{key:"getMouseInfo",value:function(Z){if(!this.container)return null;var J=this.container,G=J.getBoundingClientRect(),Y=uEe(G),ie={chartX:Math.round(Z.pageX-Y.left),chartY:Math.round(Z.pageY-Y.top)},ce=G.width/J.offsetWidth||1,ge=this.inRange(ie.chartX,ie.chartY,ce);if(!ge)return null;var be=this.state,xe=be.xAxisMap,Le=be.yAxisMap,ze=this.getTooltipEventType(),Xe=R9(this.state,this.props.data,this.props.layout,ge);if(ze!=="axis"&&xe&&Le){var Je=Cv(xe).scale,tt=Cv(Le).scale,st=Je&&Je.invert?Je.invert(ie.chartX):null,Ne=tt&&tt.invert?tt.invert(ie.chartY):null;return _r(_r({},ie),{},{xValue:st,yValue:Ne},Xe)}return Xe?_r(_r({},ie),Xe):null}},{key:"inRange",value:function(Z,J){var G=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,Y=this.props.layout,ie=Z/G,ce=J/G;if(Y==="horizontal"||Y==="vertical"){var ge=this.state.offset,be=ie>=ge.left&&ie<=ge.left+ge.width&&ce>=ge.top&&ce<=ge.top+ge.height;return be?{x:ie,y:ce}:null}var xe=this.state,Le=xe.angleAxisMap,ze=xe.radiusAxisMap;if(Le&&ze){var Xe=Cv(Le);return Kq({x:ie,y:ce},Xe)}return null}},{key:"parseEventsOfWrapper",value:function(){var Z=this.props.children,J=this.getTooltipEventType(),G=eu(Z,Qh),Y={};G&&J==="axis"&&(G.props.trigger==="click"?Y={onClick:this.handleClick}:Y={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var ie=RS(this.props,this.handleOuterEvent);return _r(_r({},ie),Y)}},{key:"addListener",value:function(){JI.on(QI,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){JI.removeListener(QI,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(Z,J,G){for(var Y=this.state.formattedGraphicalItems,ie=0,ce=Y.length;ie<ce;ie++){var ge=Y[ie];if(ge.item===Z||ge.props.key===Z.key||J===gp(ge.item.type)&&G===ge.childIndex)return ge}return null}},{key:"renderClipPath",value:function(){var Z=this.clipPathId,J=this.state.offset,G=J.left,Y=J.top,ie=J.height,ce=J.width;return jt.createElement("defs",null,jt.createElement("clipPath",{id:Z},jt.createElement("rect",{x:G,y:Y,height:ie,width:ce})))}},{key:"getXScales",value:function(){var Z=this.state.xAxisMap;return Z?Object.entries(Z).reduce(function(J,G){var Y=k9(G,2),ie=Y[0],ce=Y[1];return _r(_r({},J),{},Xn({},ie,ce.scale))},{}):null}},{key:"getYScales",value:function(){var Z=this.state.yAxisMap;return Z?Object.entries(Z).reduce(function(J,G){var Y=k9(G,2),ie=Y[0],ce=Y[1];return _r(_r({},J),{},Xn({},ie,ce.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(Z){var J;return(J=this.state.xAxisMap)===null||J===void 0||(J=J[Z])===null||J===void 0?void 0:J.scale}},{key:"getYScaleByAxisId",value:function(Z){var J;return(J=this.state.yAxisMap)===null||J===void 0||(J=J[Z])===null||J===void 0?void 0:J.scale}},{key:"getItemByXY",value:function(Z){var J=this.state,G=J.formattedGraphicalItems,Y=J.activeItem;if(G&&G.length)for(var ie=0,ce=G.length;ie<ce;ie++){var ge=G[ie],be=ge.props,xe=ge.item,Le=xe.type.defaultProps!==void 0?_r(_r({},xe.type.defaultProps),xe.props):xe.props,ze=gp(xe.type);if(ze==="Bar"){var Xe=(be.data||[]).find(function(Ne){return AIe(Z,Ne)});if(Xe)return{graphicalItem:ge,payload:Xe}}else if(ze==="RadialBar"){var Je=(be.data||[]).find(function(Ne){return Kq(Z,Ne)});if(Je)return{graphicalItem:ge,payload:Je}}else if(k2(ge,Y)||O2(ge,Y)||xb(ge,Y)){var tt=yke({graphicalItem:ge,activeTooltipItem:Y,itemData:Le.data}),st=Le.activeIndex===void 0?tt:Le.activeIndex;return{graphicalItem:_r(_r({},ge),{},{childIndex:st}),payload:xb(ge,Y)?Le.data[tt]:ge.props.data[tt]}}}return null}},{key:"render",value:function(){var Z=this;if(!aV(this))return null;var J=this.props,G=J.children,Y=J.className,ie=J.width,ce=J.height,ge=J.style,be=J.compact,xe=J.title,Le=J.desc,ze=O9(J,ARe),Xe=ns(ze,!1);if(be)return jt.createElement(p9,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},jt.createElement(tL,Dv({},Xe,{width:ie,height:ce,title:xe,desc:Le}),this.renderClipPath(),cV(G,this.renderMap)));if(this.props.accessibilityLayer){var Je,tt;Xe.tabIndex=(Je=this.props.tabIndex)!==null&&Je!==void 0?Je:0,Xe.role=(tt=this.props.role)!==null&&tt!==void 0?tt:"application",Xe.onKeyDown=function(Ne){Z.accessibilityManager.keyboardEvent(Ne)},Xe.onFocus=function(){Z.accessibilityManager.focus()}}var st=this.parseEventsOfWrapper();return jt.createElement(p9,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},jt.createElement("div",Dv({className:Li("recharts-wrapper",Y),style:_r({position:"relative",cursor:"default",width:ie,height:ce},ge)},st,{ref:function(We){Z.container=We}}),jt.createElement(tL,Dv({},Xe,{width:ie,height:ce,title:xe,desc:Le,style:qRe}),this.renderClipPath(),cV(G,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(j.Component);Xn(D,"displayName",r),Xn(D,"defaultProps",_r({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},A)),Xn(D,"getDerivedStateFromProps",function(N,V){var H=N.dataKey,Z=N.data,J=N.children,G=N.width,Y=N.height,ie=N.layout,ce=N.stackOffset,ge=N.margin,be=V.dataStartIndex,xe=V.dataEndIndex;if(V.updateId===void 0){var Le=j9(N);return _r(_r(_r({},Le),{},{updateId:0},F(_r(_r({props:N},Le),{},{updateId:0}),V)),{},{prevDataKey:H,prevData:Z,prevWidth:G,prevHeight:Y,prevLayout:ie,prevStackOffset:ce,prevMargin:ge,prevChildren:J})}if(H!==V.prevDataKey||Z!==V.prevData||G!==V.prevWidth||Y!==V.prevHeight||ie!==V.prevLayout||ce!==V.prevStackOffset||!Uv(ge,V.prevMargin)){var ze=j9(N),Xe={chartX:V.chartX,chartY:V.chartY,isTooltipActive:V.isTooltipActive},Je=_r(_r({},R9(V,Z,ie)),{},{updateId:V.updateId+1}),tt=_r(_r(_r({},ze),Xe),Je);return _r(_r(_r({},tt),F(_r({props:N},tt),V)),{},{prevDataKey:H,prevData:Z,prevWidth:G,prevHeight:Y,prevLayout:ie,prevStackOffset:ce,prevMargin:ge,prevChildren:J})}if(!QO(J,V.prevChildren)){var st,Ne,We,Ue,De=eu(J,f_),Ke=De&&(st=(Ne=De.props)===null||Ne===void 0?void 0:Ne.startIndex)!==null&&st!==void 0?st:be,lt=De&&(We=(Ue=De.props)===null||Ue===void 0?void 0:Ue.endIndex)!==null&&We!==void 0?We:xe,Ye=Ke!==be||lt!==xe,Ve=!Zi(Z),Et=Ve&&!Ye?V.updateId:V.updateId+1;return _r(_r({updateId:Et},F(_r(_r({props:N},V),{},{updateId:Et,dataStartIndex:Ke,dataEndIndex:lt}),V)),{},{prevChildren:J,dataStartIndex:Ke,dataEndIndex:lt})}return null}),Xn(D,"renderActiveDot",function(N,V,H){var Z;return j.isValidElement(N)?Z=j.cloneElement(N,V):Wi(N)?Z=N(V):Z=jt.createElement(RD,V),jt.createElement($o,{className:"recharts-active-dot",key:H},Z)});var O=j.forwardRef(function(V,H){return jt.createElement(D,Dv({},V,{ref:H}))});return O.displayName=D.displayName,O},tje=eje({chartName:"LineChart",GraphicalChild:Qb,axisComponents:[{axisType:"xAxis",AxisComp:F2},{axisType:"yAxis",AxisComp:B2}],formatAxisMap:pOe});const rje=()=>{const{user:e,mutate:t}=bxe(),{creditDevise:r,devise:n}=EK(),[a,u]=j.useState([]);j.useEffect(()=>{e!=null&&e.id&&(t(),Wn.get(`/api/user/credit/history/${e.id}`).then(y=>{const w=Array.isArray(y.data)?y.data:[];u(w)}))},[e,t]);const f=()=>{const y=a.map(F=>[new Date(F.date).toLocaleString(),F.usage_type,F.moteur,F.montant.toFixed(2)].join(",")).join(`
`),w=`Date,Type,Moteur,Montant (crédits)
`,T=new Blob([w+y],{type:"text/csv;charset=utf-8;"}),A=URL.createObjectURL(T),k=document.createElement("a");k.href=A,k.download="usage-ia.csv",k.click(),URL.revokeObjectURL(A)},i=a.map(y=>({date:new Date(y.date).toLocaleDateString(),montant:y.montant})).reverse();return b.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-6",children:[b.jsx("h1",{className:"text-2xl font-semibold",children:"🧾 Historique IA & Solde"}),b.jsxs("div",{className:"flex items-center justify-between bg-white dark:bg-gray-800 p-4 rounded shadow text-gray-800 dark:text-white",children:[b.jsxs("p",{children:["💰 Solde disponible :"," ",b.jsx("span",{className:"font-bold text-green-600",children:r!==null?`${r.toFixed(0)} ${n}`:"Chargement..."})]}),b.jsx("button",{onClick:f,className:"px-3 py-1 text-sm rounded bg-blue-600 text-white hover:bg-blue-700",children:"📤 Exporter CSV"})]}),b.jsxs("div",{className:"bg-white dark:bg-gray-900 p-4 rounded shadow",children:[b.jsx("h2",{className:"text-lg mb-2 font-semibold text-gray-800 dark:text-white",children:"📈 Évolution des crédits consommés"}),i.length>0?b.jsx(nEe,{width:"100%",height:250,children:b.jsxs(tje,{data:i,children:[b.jsx(F2,{dataKey:"date"}),b.jsx(B2,{}),b.jsx(Qh,{}),b.jsx(Qb,{type:"monotone",dataKey:"montant",stroke:"#f87171",strokeWidth:2})]})}):b.jsx("p",{className:"text-gray-500",children:"Pas encore d'historique IA."})]}),b.jsx("div",{className:"overflow-x-auto",children:b.jsxs("table",{className:"min-w-full bg-white dark:bg-gray-900 rounded shadow text-sm",children:[b.jsx("thead",{children:b.jsxs("tr",{className:"text-left border-b",children:[b.jsx("th",{className:"p-2",children:"Date"}),b.jsx("th",{children:"Type"}),b.jsx("th",{children:"Moteur"}),b.jsx("th",{children:"Montant (crédits)"})]})}),b.jsxs("tbody",{children:[a.length===0&&b.jsx("tr",{children:b.jsx("td",{colSpan:4,className:"p-3 text-gray-500 italic",children:"Aucun historique disponible"})}),a.map((y,w)=>b.jsxs("tr",{className:"border-b hover:bg-gray-50 dark:hover:bg-gray-800",children:[b.jsx("td",{className:"p-2",children:new Date(y.date).toLocaleString()}),b.jsx("td",{children:y.usage_type}),b.jsx("td",{children:y.moteur}),b.jsx("td",{className:"text-red-600 font-semibold",children:y.montant.toFixed(2)})]},w))]})]})})]})},tk={texte:"Champ texte libre",nombre:"Valeur numérique attendue",booléen:"Cochez si applicable",gps:"Localisez ce champ sur une carte",image:"Téléchargez une ou plusieurs images",video:"Ajoutez une vidéo explicative",audio:"Ajoutez une note audio",excel:"Fichier de données Excel (xlsx)",document:"Ajoutez un document justificatif",email:"Adresse email au format valide",téléphone:"Numéro de téléphone au format international",whatsapp:"Numéro WhatsApp (obligatoire)",url:"Lien web valide",website:"Site web de votre service",datetime:"Sélectionnez une date et une heure",liste:"Choisissez plusieurs options",objet:"Structure composée de sous-champs"},rk={texte:"Ex : Quartier Bonamoussadi",nombre:"Ex : 45000",gps:"Ex : 4.065, 9.712",image:"Ex : photo_de_la_maison.jpg",video:"Ex : visite_video.mp4",audio:"Ex : commentaire_audio.mp3",excel:"Ex : planning.xlsx",document:"Ex : devis.pdf",email:"Ex : contact@monservice.com",téléphone:"Ex : +237690000000",whatsapp:"Ex : +237690000000",url:"Ex : https://monservice.com",website:"Ex : https://monservice.com",datetime:"Ex : 2025-06-10 14:00"},zl=e=>e==="titre_service"?10:e==="category"?11:e==="description"?12:e==="produits"||e==="listeproduit"?15:e.includes("prix")||e.includes("montant")?16:e.includes("quantite")?17:e.includes("unite")?18:e==="whatsapp"?100:e==="telephone"?101:e==="email"?102:e==="website"?103:e==="gps_fixe"||e==="gps_fixe_coords"?110:e.includes("gps")?111:e.includes("tarissement")?120:e.includes("is_")?130:50,nk=e=>["whatsapp","telephone","email","website"].includes(e),ik=e=>["titre_service","category","description"].includes(e),sk=e=>({titre_service:"Titre du service",category:"Catégorie",description:"Description",whatsapp:"WhatsApp",telephone:"Téléphone",email:"Email",website:"Site web",produits:"Produits/Services",gps_fixe:"Localisation fixe",gps_fixe_coords:"Coordonnées GPS",zone_intervention:"Zone d'intervention",is_tarissable:"Service tarissable",vitesse_tarissement:"Vitesse de tarissement",prix:"Prix",montant:"Montant",quantite:"Quantité",unite:"Unité"})[e]||e.replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase()),ok=(e,t)=>([{nomChamp:"whatsapp",typeDonnee:"whatsapp",composant:"input",obligatoire:!0,priorite:zl("whatsapp"),tooltip:"Numéro WhatsApp pour contact direct (obligatoire)",exemple:"+237690000000",valeur:"",isContact:!0},{nomChamp:"telephone",typeDonnee:"téléphone",composant:"input",obligatoire:!1,priorite:zl("telephone"),tooltip:"Numéro de téléphone de contact",exemple:"+237690000000",valeur:"",isContact:!0},{nomChamp:"email",typeDonnee:"email",composant:"EmailInput",obligatoire:!1,priorite:zl("email"),tooltip:"Adresse email de contact",exemple:"contact@monservice.com",valeur:"",isContact:!0},{nomChamp:"website",typeDonnee:"website",composant:"input",obligatoire:!1,priorite:zl("website"),tooltip:"Site web de votre service",exemple:"https://monservice.com",valeur:"",isContact:!0}].forEach(n=>{if(!e.some(u=>u.nomChamp===n.nomChamp))e.push(n);else{const u=e.find(f=>f.nomChamp===n.nomChamp);u&&(u.isContact=!0,u.priorite=n.priorite,!u.valeur&&n.valeur&&(u.valeur=n.valeur))}}),e),nje=e=>"+237",N9=(e,t)=>{if(!e)return"";const r=e.replace(/\s+/g,"").replace(/[^\d+]/g,"");if(r.startsWith("+"))return r;const n=nje();return r.startsWith("00")?"+"+r.substring(2):r.startsWith("0")?n+r.substring(1):/^\d+$/.test(r)?n+r:r};function mR(e,t,r){var f,i,y,w,T,A,k,F,D,O,N,V,H,Z,J,G,Y,ie,ce,ge,be,xe,Le,ze,Xe,Je,tt,st,Ne,We,Ue,De,Ke,lt,Ye,Ve,Et,kt,Wt,Tt,Ht,ur,Jt,Rt,Dt,sr,mr,Vr,rn,$r,Yr,un,Fn,vi,xr,Hr,wn,xi,ms,Ui,js,es,Uo,Ys,Js,bo,wo,So,Jn,Ds,Io,_s,uo,qo,oa,Qt,Hs,Go;const n=[];if(e.service_refuse)return console.warn("⛔ Demande Yukpo refusée :",e.motif_refus),n;if(e.intention&&e.data){console.log("[dispatchChampsFormulaireIA] Traitement de la nouvelle structure Yukpo:",e),console.log("[dispatchChampsFormulaireIA] Type de response.data:",typeof e.data),console.log("[dispatchChampsFormulaireIA] Clés de response.data:",Object.keys(e.data));const dt=e.data,ae={};for(const[oe,pe]of Object.entries(dt)){if(console.log(`[dispatchChampsFormulaireIA] Traitement du champ: ${oe}`,pe),!pe||typeof pe!="object"||!("type_donnee"in pe)){console.log(`[dispatchChampsFormulaireIA] Champ ${oe} ignoré - pas de type_donnee`);continue}const $e=pe;if(!$e.type_donnee||oe==="contexte_demande"){console.log(`[dispatchChampsFormulaireIA] Champ ${oe} ignoré - type_donnee manquant ou contexte_demande`);continue}if(oe==="titre"){console.log("[dispatchChampsFormulaireIA] Filtrage du champ 'titre' parasite");continue}console.log(`[dispatchChampsFormulaireIA] Champ ${oe} ajouté aux champs de base`),ae[oe]=$e}console.log("[dispatchChampsFormulaireIA] Champs de base collectés:",Object.keys(ae));for(const[oe,pe]of Object.entries(ae)){if(oe==="produits"||oe==="listeproduit")continue;let $e="input",He=!1;switch(pe.type_donnee){case"string":$e=pe.valeur&&pe.valeur.length>100?"textarea":"input";break;case"number":$e="number";break;case"boolean":$e="checkbox";break;case"gps":$e="MapSelector",He=oe==="gps_fixe"||oe==="gps_fixe_coords"||oe.includes("gps");break;case"image":$e="ImageUploader";break;case"video":$e="VideoUploader";break;case"audio":$e="AudioUploader";break;case"excel":$e="ExcelUploader";break;case"document":$e="DocumentUploader";break;case"liste":$e=oe==="etat_bien"?"EtatBienSelector":"TagSelector";break;case"datetime":$e="DateTimePicker";break;case"email":$e="EmailInput";break;case"whatsapp":case"téléphone":$e="input";break;case"website":case"url":$e="input";break;case"listeproduit":$e="ProductListManager";break;case"objet":$e="ObjectViewer";break;default:$e="input"}let et=pe.valeur;(pe.type_donnee==="whatsapp"||pe.type_donnee==="téléphone")&&(et=N9(pe.valeur)),n.push({nomChamp:oe,typeDonnee:pe.type_donnee,composant:$e,obligatoire:He,priorite:zl(oe),tooltip:tk[pe.type_donnee]||"",exemple:rk[pe.type_donnee]||void 0,valeur:et||"",isContact:nk(oe),isInfoGenerale:ik(oe),labelFrancais:sk(oe)})}if(((f=ae.is_tarissable)==null?void 0:f.valeur)===!0&&(console.log("[dispatchChampsFormulaireIA] Ajout du champ conditionnel: vitesse_tarissable"),n.push({nomChamp:"vitesse_tarissable",typeDonnee:"string",composant:"input",obligatoire:!1,priorite:zl("vitesse_tarissable"),tooltip:"Vitesse de tarissement du service",exemple:"Ex : Immédiat, 24h, 48h",valeur:""})),((i=ae.gps_fixe)==null?void 0:i.valeur)===!0&&(console.log("[dispatchChampsFormulaireIA] Ajout du champ conditionnel: gps_fixe_coords"),n.push({nomChamp:"gps_fixe_coords",typeDonnee:"gps",composant:"MapSelector",obligatoire:!0,priorite:zl("gps_fixe_coords"),tooltip:"Coordonnées GPS fixes du service",exemple:"Ex : 4.065, 9.712",valeur:""})),ae.produits){console.log("[dispatchChampsFormulaireIA] Traitement des produits détectés"),console.log("[dispatchChampsFormulaireIA] Données produits brutes:",ae.produits);let oe=[];if(ae.produits.valeur&&Array.isArray(ae.produits.valeur))oe=ae.produits.valeur.map((pe,$e)=>{var et,rt,nt,mt,Ct,pt,rr,ar,gr,Ur,Xr,Jr,nn,Qn,sn,Bn,Tn,on,Vn,li,bi,Ci,Ki,Ho;console.log(`[dispatchChampsFormulaireIA] Formatage produit ${$e}:`,pe);const He={nom:((et=pe.nom)==null?void 0:et.valeur)||pe.nom||((rt=pe.titre)==null?void 0:rt.valeur)||pe.titre||`Produit ${$e+1}`,categorie:((nt=pe.categorie)==null?void 0:nt.valeur)||pe.categorie||((mt=pe.category)==null?void 0:mt.valeur)||pe.category||"Autre",nature_produit:((Ct=pe.description)==null?void 0:Ct.valeur)||pe.description||((pt=pe.nature_produit)==null?void 0:pt.valeur)||pe.nature_produit||"",quantite:((rr=pe.quantite)==null?void 0:rr.valeur)||pe.quantite||((ar=pe.quantity)==null?void 0:ar.valeur)||pe.quantity||1,unite:((gr=pe.unite)==null?void 0:gr.valeur)||pe.unite||((Ur=pe.unit)==null?void 0:Ur.valeur)||pe.unit||"pièce",prix:{montant:((Jr=(Xr=pe.prix)==null?void 0:Xr.valeur)==null?void 0:Jr.montant)||((nn=pe.prix)==null?void 0:nn.montant)||((Qn=pe.prix)==null?void 0:Qn.valeur)||pe.prix||0,devise:((Bn=(sn=pe.prix)==null?void 0:sn.valeur)==null?void 0:Bn.devise)||((Tn=pe.prix)==null?void 0:Tn.devise)||"XAF"},marque:((on=pe.marque)==null?void 0:on.valeur)||pe.marque||((Vn=pe.brand)==null?void 0:Vn.valeur)||pe.brand||"",origine:((li=pe.origine)==null?void 0:li.valeur)||pe.origine||((bi=pe.origin)==null?void 0:bi.valeur)||pe.origin||"",occasion:((Ci=pe.occasion)==null?void 0:Ci.valeur)||pe.occasion||!1,est_tarissable:((Ki=pe.est_tarissable)==null?void 0:Ki.valeur)||pe.est_tarissable||!0,vitesse_tarissement:((Ho=pe.vitesse_tarissement)==null?void 0:Ho.valeur)||pe.vitesse_tarissement||"moyenne"};return console.log(`[dispatchChampsFormulaireIA] Produit formaté ${$e}:`,He),He});else if(ae.produits.valeur&&typeof ae.produits.valeur=="object"){const pe=ae.produits.valeur;oe=[{nom:((y=pe.nom)==null?void 0:y.valeur)||pe.nom||((w=pe.titre)==null?void 0:w.valeur)||pe.titre||"Produit",categorie:((T=pe.categorie)==null?void 0:T.valeur)||pe.categorie||"Autre",nature_produit:((A=pe.description)==null?void 0:A.valeur)||pe.description||"",quantite:((k=pe.quantite)==null?void 0:k.valeur)||pe.quantite||1,unite:((F=pe.unite)==null?void 0:F.valeur)||pe.unite||"pièce",prix:{montant:((O=(D=pe.prix)==null?void 0:D.valeur)==null?void 0:O.montant)||((N=pe.prix)==null?void 0:N.montant)||((V=pe.prix)==null?void 0:V.valeur)||pe.prix||0,devise:((Z=(H=pe.prix)==null?void 0:H.valeur)==null?void 0:Z.devise)||((J=pe.prix)==null?void 0:J.devise)||"XAF"},marque:((G=pe.marque)==null?void 0:G.valeur)||pe.marque||"",origine:((Y=pe.origine)==null?void 0:Y.valeur)||pe.origine||"",occasion:((ie=pe.occasion)==null?void 0:ie.valeur)||pe.occasion||!1,est_tarissable:((ce=pe.est_tarissable)==null?void 0:ce.valeur)||pe.est_tarissable||!0,vitesse_tarissement:((ge=pe.vitesse_tarissement)==null?void 0:ge.valeur)||pe.vitesse_tarissement||"moyenne"}]}console.log("[dispatchChampsFormulaireIA] Produits finaux formatés:",oe),n.push({nomChamp:"produits",typeDonnee:"listeproduit",composant:"ProductListManager",obligatoire:!1,priorite:zl("produits"),tooltip:"Liste des produits/services proposés",exemple:"Produits détectés depuis votre demande",valeur:oe})}if(ae.listeproduit){console.log("[dispatchChampsFormulaireIA] Traitement des listeproduit détectés"),console.log("[dispatchChampsFormulaireIA] Données listeproduit brutes:",ae.listeproduit);let oe=[];if(ae.listeproduit.valeur&&Array.isArray(ae.listeproduit.valeur))oe=ae.listeproduit.valeur.map((pe,$e)=>{var et,rt,nt,mt,Ct,pt,rr,ar,gr,Ur,Xr,Jr,nn,Qn,sn,Bn,Tn,on,Vn,li,bi,Ci,Ki,Ho;return{nom:((et=pe.nom)==null?void 0:et.valeur)||pe.nom||((rt=pe.titre)==null?void 0:rt.valeur)||pe.titre||`Produit ${$e+1}`,categorie:((nt=pe.categorie)==null?void 0:nt.valeur)||pe.categorie||((mt=pe.category)==null?void 0:mt.valeur)||pe.category||"Autre",nature_produit:((Ct=pe.description)==null?void 0:Ct.valeur)||pe.description||((pt=pe.nature_produit)==null?void 0:pt.valeur)||pe.nature_produit||"",quantite:((rr=pe.quantite)==null?void 0:rr.valeur)||pe.quantite||((ar=pe.quantity)==null?void 0:ar.valeur)||pe.quantity||1,unite:((gr=pe.unite)==null?void 0:gr.valeur)||pe.unite||((Ur=pe.unit)==null?void 0:Ur.valeur)||pe.unit||"pièce",prix:{montant:((Jr=(Xr=pe.prix)==null?void 0:Xr.valeur)==null?void 0:Jr.montant)||((nn=pe.prix)==null?void 0:nn.montant)||((Qn=pe.prix)==null?void 0:Qn.valeur)||pe.prix||0,devise:((Bn=(sn=pe.prix)==null?void 0:sn.valeur)==null?void 0:Bn.devise)||((Tn=pe.prix)==null?void 0:Tn.devise)||"XAF"},marque:((on=pe.marque)==null?void 0:on.valeur)||pe.marque||((Vn=pe.brand)==null?void 0:Vn.valeur)||pe.brand||"",origine:((li=pe.origine)==null?void 0:li.valeur)||pe.origine||((bi=pe.origin)==null?void 0:bi.valeur)||pe.origin||"",occasion:((Ci=pe.occasion)==null?void 0:Ci.valeur)||pe.occasion||!1,est_tarissable:((Ki=pe.est_tarissable)==null?void 0:Ki.valeur)||pe.est_tarissable||!0,vitesse_tarissement:((Ho=pe.vitesse_tarissement)==null?void 0:Ho.valeur)||pe.vitesse_tarissement||"moyenne"}});else if(ae.listeproduit.valeur&&typeof ae.listeproduit.valeur=="object"){const pe=ae.listeproduit.valeur;oe=[{nom:((be=pe.nom)==null?void 0:be.valeur)||pe.nom||((xe=pe.titre)==null?void 0:xe.valeur)||pe.titre||"Produit",categorie:((Le=pe.categorie)==null?void 0:Le.valeur)||pe.categorie||"Autre",nature_produit:((ze=pe.description)==null?void 0:ze.valeur)||pe.description||"",quantite:((Xe=pe.quantite)==null?void 0:Xe.valeur)||pe.quantite||1,unite:((Je=pe.unite)==null?void 0:Je.valeur)||pe.unite||"pièce",prix:{montant:((st=(tt=pe.prix)==null?void 0:tt.valeur)==null?void 0:st.montant)||((Ne=pe.prix)==null?void 0:Ne.montant)||((We=pe.prix)==null?void 0:We.valeur)||pe.prix||0,devise:((De=(Ue=pe.prix)==null?void 0:Ue.valeur)==null?void 0:De.devise)||((Ke=pe.prix)==null?void 0:Ke.devise)||"XAF"},marque:((lt=pe.marque)==null?void 0:lt.valeur)||pe.marque||"",origine:((Ye=pe.origine)==null?void 0:Ye.valeur)||pe.origine||"",occasion:((Ve=pe.occasion)==null?void 0:Ve.valeur)||pe.occasion||!1,est_tarissable:((Et=pe.est_tarissable)==null?void 0:Et.valeur)||pe.est_tarissable||!0,vitesse_tarissement:((kt=pe.vitesse_tarissement)==null?void 0:kt.valeur)||pe.vitesse_tarissement||"moyenne"}]}n.push({nomChamp:"listeproduit",typeDonnee:"listeproduit",composant:"ProductListManager",obligatoire:!1,priorite:zl("listeproduit"),tooltip:"Liste des produits/services proposés",exemple:"Produits détectés depuis votre demande",valeur:oe})}return ok(n),n.sort((oe,pe)=>(oe.priorite||10)-(pe.priorite||10)),console.log("[dispatchChampsFormulaireIA] Composants triés par priorité:",n.map(oe=>({nom:oe.nomChamp,priorite:oe.priorite}))),n}if(e.intention){console.log("[dispatchChampsFormulaireIA] Traitement de la structure déballée (données à la racine):",e),console.log("[dispatchChampsFormulaireIA] Clés de la réponse:",Object.keys(e));const dt={};for(const[ae,oe]of Object.entries(e)){if(console.log(`[dispatchChampsFormulaireIA] Traitement du champ racine: ${ae}`,oe),ae==="intention"||ae==="status"||ae==="service_refuse"||ae==="motif_refus"||ae==="tokens_consumed"||ae==="ia_model_used"||ae==="confidence"||ae==="processing_mode"||ae==="interaction_id"||ae==="tokens_breakdown"||ae==="model_used"||ae==="processing_time_ms"){console.log(`[dispatchChampsFormulaireIA] Champ système ${ae} ignoré`);continue}if(!oe||typeof oe!="object"||!("type_donnee"in oe)){console.log(`[dispatchChampsFormulaireIA] Champ ${ae} ignoré - pas de type_donnee`);continue}const pe=oe;if(!pe.type_donnee||ae==="contexte_demande"){console.log(`[dispatchChampsFormulaireIA] Champ ${ae} ignoré - type_donnee manquant ou contexte_demande`);continue}if(ae==="titre"){console.log("[dispatchChampsFormulaireIA] Filtrage du champ 'titre' parasite");continue}console.log(`[dispatchChampsFormulaireIA] Champ ${ae} ajouté aux champs de base`),dt[ae]=pe}console.log("[dispatchChampsFormulaireIA] Champs de base collectés (structure déballée):",Object.keys(dt));for(const[ae,oe]of Object.entries(dt)){if(ae==="produits"||ae==="listeproduit")continue;let pe="input",$e=!1;switch(oe.type_donnee){case"string":pe=oe.valeur&&oe.valeur.length>100?"textarea":"input";break;case"number":pe="number";break;case"boolean":pe="checkbox";break;case"gps":pe="MapSelector",$e=ae==="gps_fixe"||ae==="gps_fixe_coords"||ae.includes("gps");break;case"image":pe="ImageUploader";break;case"video":pe="VideoUploader";break;case"audio":pe="AudioUploader";break;case"excel":pe="ExcelUploader";break;case"document":pe="DocumentUploader";break;case"liste":pe=ae==="etat_bien"?"EtatBienSelector":"TagSelector";break;case"datetime":pe="DateTimePicker";break;case"email":pe="EmailInput";break;case"whatsapp":case"téléphone":pe="input";break;case"website":case"url":pe="input";break;case"listeproduit":pe="ProductListManager";break;case"objet":pe="ObjectViewer";break;default:pe="input"}let He=oe.valeur;(oe.type_donnee==="whatsapp"||oe.type_donnee==="téléphone")&&(He=N9(oe.valeur)),n.push({nomChamp:ae,typeDonnee:oe.type_donnee,composant:pe,obligatoire:$e,priorite:zl(ae),tooltip:tk[oe.type_donnee]||"",exemple:rk[oe.type_donnee]||void 0,valeur:He||"",isContact:nk(ae),isInfoGenerale:ik(ae),labelFrancais:sk(ae)})}if(((Wt=dt.is_tarissable)==null?void 0:Wt.valeur)===!0&&(console.log("[dispatchChampsFormulaireIA] Ajout du champ conditionnel: vitesse_tarissable"),n.push({nomChamp:"vitesse_tarissable",typeDonnee:"string",composant:"input",obligatoire:!1,priorite:zl("vitesse_tarissable"),tooltip:"Vitesse de tarissement du service",exemple:"Ex : Immédiat, 24h, 48h",valeur:""})),((Tt=dt.gps_fixe)==null?void 0:Tt.valeur)===!0&&(console.log("[dispatchChampsFormulaireIA] Ajout du champ conditionnel: gps_fixe_coords"),n.push({nomChamp:"gps_fixe_coords",typeDonnee:"gps",composant:"MapSelector",obligatoire:!0,priorite:zl("gps_fixe_coords"),tooltip:"Coordonnées GPS fixes du service",exemple:"Ex : 4.065, 9.712",valeur:""})),dt.produits){console.log("[dispatchChampsFormulaireIA] Traitement des produits détectés"),console.log("[dispatchChampsFormulaireIA] Données produits brutes:",dt.produits);let ae=[];if(dt.produits.valeur&&Array.isArray(dt.produits.valeur))ae=dt.produits.valeur.map((oe,pe)=>{var He,et,rt,nt,mt,Ct,pt,rr,ar,gr,Ur,Xr,Jr,nn,Qn,sn,Bn,Tn,on,Vn,li,bi,Ci,Ki;console.log(`[dispatchChampsFormulaireIA] Formatage produit ${pe}:`,oe);const $e={nom:((He=oe.nom)==null?void 0:He.valeur)||oe.nom||((et=oe.titre)==null?void 0:et.valeur)||oe.titre||`Produit ${pe+1}`,categorie:((rt=oe.categorie)==null?void 0:rt.valeur)||oe.categorie||((nt=oe.category)==null?void 0:nt.valeur)||oe.category||"Autre",nature_produit:((mt=oe.description)==null?void 0:mt.valeur)||oe.description||((Ct=oe.nature_produit)==null?void 0:Ct.valeur)||oe.nature_produit||"",quantite:((pt=oe.quantite)==null?void 0:pt.valeur)||oe.quantite||((rr=oe.quantity)==null?void 0:rr.valeur)||oe.quantity||1,unite:((ar=oe.unite)==null?void 0:ar.valeur)||oe.unite||((gr=oe.unit)==null?void 0:gr.valeur)||oe.unit||"pièce",prix:{montant:((Xr=(Ur=oe.prix)==null?void 0:Ur.valeur)==null?void 0:Xr.montant)||((Jr=oe.prix)==null?void 0:Jr.montant)||((nn=oe.prix)==null?void 0:nn.valeur)||oe.prix||0,devise:((sn=(Qn=oe.prix)==null?void 0:Qn.valeur)==null?void 0:sn.devise)||((Bn=oe.prix)==null?void 0:Bn.devise)||"XAF"},marque:((Tn=oe.marque)==null?void 0:Tn.valeur)||oe.marque||((on=oe.brand)==null?void 0:on.valeur)||oe.brand||"",origine:((Vn=oe.origine)==null?void 0:Vn.valeur)||oe.origine||((li=oe.origin)==null?void 0:li.valeur)||oe.origin||"",occasion:((bi=oe.occasion)==null?void 0:bi.valeur)||oe.occasion||!1,est_tarissable:((Ci=oe.est_tarissable)==null?void 0:Ci.valeur)||oe.est_tarissable||!0,vitesse_tarissement:((Ki=oe.vitesse_tarissement)==null?void 0:Ki.valeur)||oe.vitesse_tarissement||"moyenne"};return console.log(`[dispatchChampsFormulaireIA] Produit formaté ${pe}:`,$e),$e});else if(dt.produits.valeur&&typeof dt.produits.valeur=="object"){const oe=dt.produits.valeur;ae=[{nom:((Ht=oe.nom)==null?void 0:Ht.valeur)||oe.nom||((ur=oe.titre)==null?void 0:ur.valeur)||oe.titre||"Produit",categorie:((Jt=oe.categorie)==null?void 0:Jt.valeur)||oe.categorie||"Autre",nature_produit:((Rt=oe.description)==null?void 0:Rt.valeur)||oe.description||"",quantite:((Dt=oe.quantite)==null?void 0:Dt.valeur)||oe.quantite||1,unite:((sr=oe.unite)==null?void 0:sr.valeur)||oe.unite||"pièce",prix:{montant:((Vr=(mr=oe.prix)==null?void 0:mr.valeur)==null?void 0:Vr.montant)||((rn=oe.prix)==null?void 0:rn.montant)||(($r=oe.prix)==null?void 0:$r.valeur)||oe.prix||0,devise:((un=(Yr=oe.prix)==null?void 0:Yr.valeur)==null?void 0:un.devise)||((Fn=oe.prix)==null?void 0:Fn.devise)||"XAF"},marque:((vi=oe.marque)==null?void 0:vi.valeur)||oe.marque||"",origine:((xr=oe.origine)==null?void 0:xr.valeur)||oe.origine||"",occasion:((Hr=oe.occasion)==null?void 0:Hr.valeur)||oe.occasion||!1,est_tarissable:((wn=oe.est_tarissable)==null?void 0:wn.valeur)||oe.est_tarissable||!0,vitesse_tarissement:((xi=oe.vitesse_tarissement)==null?void 0:xi.valeur)||oe.vitesse_tarissement||"moyenne"}]}console.log("[dispatchChampsFormulaireIA] Produits finaux formatés:",ae),n.push({nomChamp:"produits",typeDonnee:"listeproduit",composant:"ProductListManager",obligatoire:!1,priorite:zl("produits"),tooltip:"Liste des produits/services proposés",exemple:"Produits détectés depuis votre demande",valeur:ae})}if(dt.listeproduit){console.log("[dispatchChampsFormulaireIA] Traitement des listeproduit détectés"),console.log("[dispatchChampsFormulaireIA] Données listeproduit brutes:",dt.listeproduit);let ae=[];if(dt.listeproduit.valeur&&Array.isArray(dt.listeproduit.valeur))ae=dt.listeproduit.valeur.map((oe,pe)=>{var He,et,rt,nt,mt,Ct,pt,rr,ar,gr,Ur,Xr,Jr,nn,Qn,sn,Bn,Tn,on,Vn,li,bi,Ci,Ki;return{nom:((He=oe.nom)==null?void 0:He.valeur)||oe.nom||((et=oe.titre)==null?void 0:et.valeur)||oe.titre||`Produit ${pe+1}`,categorie:((rt=oe.categorie)==null?void 0:rt.valeur)||oe.categorie||((nt=oe.category)==null?void 0:nt.valeur)||oe.category||"Autre",nature_produit:((mt=oe.description)==null?void 0:mt.valeur)||oe.description||((Ct=oe.nature_produit)==null?void 0:Ct.valeur)||oe.nature_produit||"",quantite:((pt=oe.quantite)==null?void 0:pt.valeur)||oe.quantite||((rr=oe.quantity)==null?void 0:rr.valeur)||oe.quantity||1,unite:((ar=oe.unite)==null?void 0:ar.valeur)||oe.unite||((gr=oe.unit)==null?void 0:gr.valeur)||oe.unit||"pièce",prix:{montant:((Xr=(Ur=oe.prix)==null?void 0:Ur.valeur)==null?void 0:Xr.montant)||((Jr=oe.prix)==null?void 0:Jr.montant)||((nn=oe.prix)==null?void 0:nn.valeur)||oe.prix||0,devise:((sn=(Qn=oe.prix)==null?void 0:Qn.valeur)==null?void 0:sn.devise)||((Bn=oe.prix)==null?void 0:Bn.devise)||"XAF"},marque:((Tn=oe.marque)==null?void 0:Tn.valeur)||oe.marque||((on=oe.brand)==null?void 0:on.valeur)||oe.brand||"",origine:((Vn=oe.origine)==null?void 0:Vn.valeur)||oe.origine||((li=oe.origin)==null?void 0:li.valeur)||oe.origin||"",occasion:((bi=oe.occasion)==null?void 0:bi.valeur)||oe.occasion||!1,est_tarissable:((Ci=oe.est_tarissable)==null?void 0:Ci.valeur)||oe.est_tarissable||!0,vitesse_tarissement:((Ki=oe.vitesse_tarissement)==null?void 0:Ki.valeur)||oe.vitesse_tarissement||"moyenne"}});else if(dt.listeproduit.valeur&&typeof dt.listeproduit.valeur=="object"){const oe=dt.listeproduit.valeur;ae=[{nom:((ms=oe.nom)==null?void 0:ms.valeur)||oe.nom||((Ui=oe.titre)==null?void 0:Ui.valeur)||oe.titre||"Produit",categorie:((js=oe.categorie)==null?void 0:js.valeur)||oe.categorie||"Autre",nature_produit:((es=oe.description)==null?void 0:es.valeur)||oe.description||"",quantite:((Uo=oe.quantite)==null?void 0:Uo.valeur)||oe.quantite||1,unite:((Ys=oe.unite)==null?void 0:Ys.valeur)||oe.unite||"pièce",prix:{montant:((bo=(Js=oe.prix)==null?void 0:Js.valeur)==null?void 0:bo.montant)||((wo=oe.prix)==null?void 0:wo.montant)||((So=oe.prix)==null?void 0:So.valeur)||oe.prix||0,devise:((Ds=(Jn=oe.prix)==null?void 0:Jn.valeur)==null?void 0:Ds.devise)||((Io=oe.prix)==null?void 0:Io.devise)||"XAF"},marque:((_s=oe.marque)==null?void 0:_s.valeur)||oe.marque||"",origine:((uo=oe.origine)==null?void 0:uo.valeur)||oe.origine||"",occasion:((qo=oe.occasion)==null?void 0:qo.valeur)||oe.occasion||!1,est_tarissable:((oa=oe.est_tarissable)==null?void 0:oa.valeur)||oe.est_tarissable||!0,vitesse_tarissement:((Qt=oe.vitesse_tarissement)==null?void 0:Qt.valeur)||oe.vitesse_tarissement||"moyenne"}]}n.push({nomChamp:"listeproduit",typeDonnee:"listeproduit",composant:"ProductListManager",obligatoire:!1,priorite:zl("listeproduit"),tooltip:"Liste des produits/services proposés",exemple:"Produits détectés depuis votre demande",valeur:ae})}return ok(n),n.sort((ae,oe)=>(ae.priorite||10)-(oe.priorite||10)),console.log("[dispatchChampsFormulaireIA] Composants triés par priorité (structure déballée):",n.map(ae=>({nom:ae.nomChamp,priorite:ae.priorite}))),n}const a=(Hs=e.services_detectes)==null?void 0:Hs[0];if(!a||!a.profil_ia)return n;const u=a.profil_ia;for(const[dt,ae]of Object.entries(u)){if(!ae||!ae.type_donnee||dt==="contexte_demande")continue;if(dt==="titre"){console.log("[dispatchChampsFormulaireIA] Filtrage du champ 'titre' parasite (ancienne structure)");continue}let oe="input",pe=!1;switch(ae.type_donnee){case"texte":oe=ae.valeur&&ae.valeur.length>100?"textarea":"input";break;case"nombre":oe="number";break;case"booléen":oe="checkbox";break;case"gps":oe="MapSelector",pe=dt==="gps_fixe"&&((Go=u.gps_fixe_important)==null?void 0:Go.valeur)===!0||dt==="gps_fixe_coords"||dt.includes("gps");break;case"image":oe="ImageUploader";break;case"video":oe="VideoUploader";break;case"audio":oe="AudioUploader";break;case"excel":oe="ExcelUploader";break;case"document":oe="DocumentUploader";break;case"liste":oe=dt==="etat_bien"?"EtatBienSelector":"TagSelector";break;case"datetime":oe="DateTimePicker";break;case"email":oe="EmailInput";break;case"whatsapp":case"téléphone":oe="input";break;case"website":case"url":oe="input";break;case"listeproduit":oe="ProductListManager";break;case"objet":oe="ObjectViewer";break;default:oe="input"}n.push({nomChamp:dt,typeDonnee:ae.type_donnee,composant:oe,obligatoire:pe,priorite:zl(dt),tooltip:tk[ae.type_donnee]||"",exemple:rk[ae.type_donnee]||void 0,...ae.min!==void 0&&{min:ae.min},...ae.max!==void 0&&{max:ae.max},...ae.unite&&{unite:ae.unite},...ae.regex&&{regex:ae.regex},...ae.placeholder&&{placeholder:ae.placeholder},isContact:nk(dt),isInfoGenerale:ik(dt),labelFrancais:sk(dt)})}return ok(n),n.sort((dt,ae)=>(dt.priorite||10)-(ae.priorite||10)),n}const kQ=j.forwardRef(({className:e,label:t,checked:r,onCheckedChange:n,...a},u)=>b.jsxs("label",{className:Ec("flex items-center space-x-2 cursor-pointer",e),children:[b.jsx("input",{type:"checkbox",ref:u,checked:r,onChange:f=>n==null?void 0:n(f.target.checked),className:"h-4 w-4 text-primary border rounded focus:ring focus:ring-primary",...a}),t&&b.jsx("span",{className:"text-sm text-foreground",children:t})]}));kQ.displayName="Checkbox";const ije=({value:e="",onChange:t,placeholder:r="exemple@domain.com",label:n,required:a=!1})=>{const u=f=>{const i=f.target.value;t&&t(i)};return b.jsx("div",{className:"space-y-1",children:b.jsx($i,{type:"email",placeholder:r,value:e,onChange:u,required:a,pattern:"^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$",className:"tracking-wide w-full text-xs h-8 px-2 border-gray-300 bg-white focus:ring-1 focus:ring-orange-400 focus:border-orange-400"})})},sje=({defaultValue:e,onChange:t})=>b.jsx("input",{type:"datetime-local",className:"w-full border rounded px-3 py-2",defaultValue:e,onChange:r=>t(r.target.value)}),oje=["option1","option2","option3"],aje=({valeur:e=[],onChange:t,options:r=oje})=>{const[n,a]=j.useState(e),u=f=>{const i=n.includes(f)?n.filter(y=>y!==f):[...n,f];a(i),t(i)};return b.jsxs("div",{className:"space-y-2",children:[b.jsx("label",{className:"text-sm font-medium",children:"Sélectionnez les éléments"}),b.jsx("div",{className:"flex flex-wrap gap-2",children:r.map(f=>b.jsx("button",{type:"button",className:`px-3 py-1 rounded-full border ${n.includes(f)?"bg-primary text-white":"bg-white"}`,onClick:()=>u(f),children:f},f))})]})},lje=({valeur:e={},onChange:t,readOnly:r=!1})=>{const n=(a,u)=>{t&&t({...e,[a]:u})};return b.jsxs("div",{className:"space-y-2",children:[b.jsx("label",{className:"text-sm font-medium",children:"Données structurées"}),b.jsx("div",{className:"space-y-1",children:Object.entries(e).map(([a,u])=>b.jsxs("div",{className:"flex gap-2 items-center",children:[b.jsx("span",{className:"text-sm font-medium w-1/4",children:a}),b.jsx("input",{type:"text",className:"w-3/4 border rounded px-2 py-1",value:u,onChange:f=>n(a,f.target.value),disabled:r})]},a))})]})};var Yw={exports:{}},cje=Yw.exports,z9;function uje(){return z9||(z9=1,function(e,t){(function(r,n){e.exports=n()})(cje,function(){var r,n,a;function u(i,y){if(!r)r=y;else if(!n)n=y;else{var w="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+r+")(sharedChunk); ("+n+")(sharedChunk); self.onerror = null;",T={};r(T),a=y(T),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(a.workerUrl=window.URL.createObjectURL(new Blob([w],{type:"text/javascript"})))}}u(["exports"],function(i){var y=1e-6,w=typeof Float32Array<"u"?Float32Array:Array;function T(c,s){var l=s[0],h=s[1],p=s[2],v=s[3],x=l*v-p*h;return x?(c[0]=v*(x=1/x),c[1]=-h*x,c[2]=-p*x,c[3]=l*x,c):null}function A(){var c=new w(9);return w!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[5]=0,c[6]=0,c[7]=0),c[0]=1,c[4]=1,c[8]=1,c}function k(c,s){var l=s[0],h=s[1],p=s[2],v=s[3],x=s[4],P=s[5],I=s[6],R=s[7],$=s[8];return c[0]=x*$-P*R,c[1]=p*R-h*$,c[2]=h*P-p*x,c[3]=P*I-v*$,c[4]=l*$-p*I,c[5]=p*v-l*P,c[6]=v*R-x*I,c[7]=h*I-l*R,c[8]=l*x-h*v,c}function F(c,s,l){var h=s[0],p=s[1],v=s[2],x=s[3],P=s[4],I=s[5],R=s[6],$=s[7],U=s[8],W=l[0],te=l[1],re=l[2],le=l[3],ve=l[4],_e=l[5],Ce=l[6],Ee=l[7],ue=l[8];return c[0]=W*h+te*x+re*R,c[1]=W*p+te*P+re*$,c[2]=W*v+te*I+re*U,c[3]=le*h+ve*x+_e*R,c[4]=le*p+ve*P+_e*$,c[5]=le*v+ve*I+_e*U,c[6]=Ce*h+Ee*x+ue*R,c[7]=Ce*p+Ee*P+ue*$,c[8]=Ce*v+Ee*I+ue*U,c}function D(){var c=new w(16);return w!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c}function O(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function N(c,s){var l=s[0],h=s[1],p=s[2],v=s[3],x=s[4],P=s[5],I=s[6],R=s[7],$=s[8],U=s[9],W=s[10],te=s[11],re=s[12],le=s[13],ve=s[14],_e=s[15],Ce=l*P-h*x,Ee=l*I-p*x,ue=l*R-v*x,we=h*I-p*P,Te=h*R-v*P,Ie=p*R-v*I,Ge=$*le-U*re,Qe=$*ve-W*re,it=$*_e-te*re,ct=U*ve-W*le,St=U*_e-te*le,Vt=W*_e-te*ve,Nt=Ce*Vt-Ee*St+ue*ct+we*it-Te*Qe+Ie*Ge;return Nt?(c[0]=(P*Vt-I*St+R*ct)*(Nt=1/Nt),c[1]=(p*St-h*Vt-v*ct)*Nt,c[2]=(le*Ie-ve*Te+_e*we)*Nt,c[3]=(W*Te-U*Ie-te*we)*Nt,c[4]=(I*it-x*Vt-R*Qe)*Nt,c[5]=(l*Vt-p*it+v*Qe)*Nt,c[6]=(ve*ue-re*Ie-_e*Ee)*Nt,c[7]=($*Ie-W*ue+te*Ee)*Nt,c[8]=(x*St-P*it+R*Ge)*Nt,c[9]=(h*it-l*St-v*Ge)*Nt,c[10]=(re*Te-le*ue+_e*Ce)*Nt,c[11]=(U*ue-$*Te-te*Ce)*Nt,c[12]=(P*Qe-x*ct-I*Ge)*Nt,c[13]=(l*ct-h*Qe+p*Ge)*Nt,c[14]=(le*Ee-re*we-ve*Ce)*Nt,c[15]=($*we-U*Ee+W*Ce)*Nt,c):null}function V(c,s,l){var h=s[0],p=s[1],v=s[2],x=s[3],P=s[4],I=s[5],R=s[6],$=s[7],U=s[8],W=s[9],te=s[10],re=s[11],le=s[12],ve=s[13],_e=s[14],Ce=s[15],Ee=l[0],ue=l[1],we=l[2],Te=l[3];return c[0]=Ee*h+ue*P+we*U+Te*le,c[1]=Ee*p+ue*I+we*W+Te*ve,c[2]=Ee*v+ue*R+we*te+Te*_e,c[3]=Ee*x+ue*$+we*re+Te*Ce,c[4]=(Ee=l[4])*h+(ue=l[5])*P+(we=l[6])*U+(Te=l[7])*le,c[5]=Ee*p+ue*I+we*W+Te*ve,c[6]=Ee*v+ue*R+we*te+Te*_e,c[7]=Ee*x+ue*$+we*re+Te*Ce,c[8]=(Ee=l[8])*h+(ue=l[9])*P+(we=l[10])*U+(Te=l[11])*le,c[9]=Ee*p+ue*I+we*W+Te*ve,c[10]=Ee*v+ue*R+we*te+Te*_e,c[11]=Ee*x+ue*$+we*re+Te*Ce,c[12]=(Ee=l[12])*h+(ue=l[13])*P+(we=l[14])*U+(Te=l[15])*le,c[13]=Ee*p+ue*I+we*W+Te*ve,c[14]=Ee*v+ue*R+we*te+Te*_e,c[15]=Ee*x+ue*$+we*re+Te*Ce,c}function H(c,s,l){var h,p,v,x,P,I,R,$,U,W,te,re,le=l[0],ve=l[1],_e=l[2];return s===c?(c[12]=s[0]*le+s[4]*ve+s[8]*_e+s[12],c[13]=s[1]*le+s[5]*ve+s[9]*_e+s[13],c[14]=s[2]*le+s[6]*ve+s[10]*_e+s[14],c[15]=s[3]*le+s[7]*ve+s[11]*_e+s[15]):(p=s[1],v=s[2],x=s[3],P=s[4],I=s[5],R=s[6],$=s[7],U=s[8],W=s[9],te=s[10],re=s[11],c[0]=h=s[0],c[1]=p,c[2]=v,c[3]=x,c[4]=P,c[5]=I,c[6]=R,c[7]=$,c[8]=U,c[9]=W,c[10]=te,c[11]=re,c[12]=h*le+P*ve+U*_e+s[12],c[13]=p*le+I*ve+W*_e+s[13],c[14]=v*le+R*ve+te*_e+s[14],c[15]=x*le+$*ve+re*_e+s[15]),c}function Z(c,s,l){var h=l[0],p=l[1],v=l[2];return c[0]=s[0]*h,c[1]=s[1]*h,c[2]=s[2]*h,c[3]=s[3]*h,c[4]=s[4]*p,c[5]=s[5]*p,c[6]=s[6]*p,c[7]=s[7]*p,c[8]=s[8]*v,c[9]=s[9]*v,c[10]=s[10]*v,c[11]=s[11]*v,c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15],c}function J(c,s,l){var h=Math.sin(l),p=Math.cos(l),v=s[4],x=s[5],P=s[6],I=s[7],R=s[8],$=s[9],U=s[10],W=s[11];return s!==c&&(c[0]=s[0],c[1]=s[1],c[2]=s[2],c[3]=s[3],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[4]=v*p+R*h,c[5]=x*p+$*h,c[6]=P*p+U*h,c[7]=I*p+W*h,c[8]=R*p-v*h,c[9]=$*p-x*h,c[10]=U*p-P*h,c[11]=W*p-I*h,c}function G(c,s,l){var h=Math.sin(l),p=Math.cos(l),v=s[0],x=s[1],P=s[2],I=s[3],R=s[8],$=s[9],U=s[10],W=s[11];return s!==c&&(c[4]=s[4],c[5]=s[5],c[6]=s[6],c[7]=s[7],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[0]=v*p-R*h,c[1]=x*p-$*h,c[2]=P*p-U*h,c[3]=I*p-W*h,c[8]=v*h+R*p,c[9]=x*h+$*p,c[10]=P*h+U*p,c[11]=I*h+W*p,c}function Y(c,s,l){var h=Math.sin(l),p=Math.cos(l),v=s[0],x=s[1],P=s[2],I=s[3],R=s[4],$=s[5],U=s[6],W=s[7];return s!==c&&(c[8]=s[8],c[9]=s[9],c[10]=s[10],c[11]=s[11],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[0]=v*p+R*h,c[1]=x*p+$*h,c[2]=P*p+U*h,c[3]=I*p+W*h,c[4]=R*p-v*h,c[5]=$*p-x*h,c[6]=U*p-P*h,c[7]=W*p-I*h,c}function ie(c,s){return c[0]=s[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=s[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=s[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function ce(c,s,l){var h,p,v,x=l[0],P=l[1],I=l[2],R=Math.hypot(x,P,I);return R<y?null:(x*=R=1/R,P*=R,I*=R,h=Math.sin(s),p=Math.cos(s),c[0]=x*x*(v=1-p)+p,c[1]=P*x*v+I*h,c[2]=I*x*v-P*h,c[3]=0,c[4]=x*P*v-I*h,c[5]=P*P*v+p,c[6]=I*P*v+x*h,c[7]=0,c[8]=x*I*v+P*h,c[9]=P*I*v-x*h,c[10]=I*I*v+p,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c)}function ge(c,s){var l=s[0],h=s[1],p=s[2],v=s[3],x=l+l,P=h+h,I=p+p,R=l*x,$=h*x,U=h*P,W=p*x,te=p*P,re=p*I,le=v*x,ve=v*P,_e=v*I;return c[0]=1-U-re,c[1]=$+_e,c[2]=W-ve,c[3]=0,c[4]=$-_e,c[5]=1-R-re,c[6]=te+le,c[7]=0,c[8]=W+ve,c[9]=te-le,c[10]=1-R-U,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}Math.hypot||(Math.hypot=function(){for(var c=0,s=arguments.length;s--;)c+=arguments[s]*arguments[s];return Math.sqrt(c)});var be=V;function xe(){var c=new w(3);return w!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c}function Le(c){var s=new w(3);return s[0]=c[0],s[1]=c[1],s[2]=c[2],s}function ze(c){return Math.hypot(c[0],c[1],c[2])}function Xe(c,s,l){var h=new w(3);return h[0]=c,h[1]=s,h[2]=l,h}function Je(c,s,l){return c[0]=s[0]+l[0],c[1]=s[1]+l[1],c[2]=s[2]+l[2],c}function tt(c,s,l){return c[0]=s[0]-l[0],c[1]=s[1]-l[1],c[2]=s[2]-l[2],c}function st(c,s,l){return c[0]=s[0]*l[0],c[1]=s[1]*l[1],c[2]=s[2]*l[2],c}function Ne(c,s,l){return c[0]=Math.min(s[0],l[0]),c[1]=Math.min(s[1],l[1]),c[2]=Math.min(s[2],l[2]),c}function We(c,s,l){return c[0]=Math.max(s[0],l[0]),c[1]=Math.max(s[1],l[1]),c[2]=Math.max(s[2],l[2]),c}function Ue(c,s,l){return c[0]=s[0]*l,c[1]=s[1]*l,c[2]=s[2]*l,c}function De(c,s,l,h){return c[0]=s[0]+l[0]*h,c[1]=s[1]+l[1]*h,c[2]=s[2]+l[2]*h,c}function Ke(c,s){var l=s[0]-c[0],h=s[1]-c[1],p=s[2]-c[2];return l*l+h*h+p*p}function lt(c){var s=c[0],l=c[1],h=c[2];return s*s+l*l+h*h}function Ye(c,s){return c[0]=-s[0],c[1]=-s[1],c[2]=-s[2],c}function Ve(c,s){var l=s[0],h=s[1],p=s[2],v=l*l+h*h+p*p;return v>0&&(v=1/Math.sqrt(v)),c[0]=s[0]*v,c[1]=s[1]*v,c[2]=s[2]*v,c}function Et(c,s){return c[0]*s[0]+c[1]*s[1]+c[2]*s[2]}function kt(c,s,l){var h=s[0],p=s[1],v=s[2],x=l[0],P=l[1],I=l[2];return c[0]=p*I-v*P,c[1]=v*x-h*I,c[2]=h*P-p*x,c}function Wt(c,s,l,h){var p=s[0],v=s[1],x=s[2];return c[0]=p+h*(l[0]-p),c[1]=v+h*(l[1]-v),c[2]=x+h*(l[2]-x),c}function Tt(c,s,l){var h=s[0],p=s[1],v=s[2],x=l[3]*h+l[7]*p+l[11]*v+l[15];return c[0]=(l[0]*h+l[4]*p+l[8]*v+l[12])/(x=x||1),c[1]=(l[1]*h+l[5]*p+l[9]*v+l[13])/x,c[2]=(l[2]*h+l[6]*p+l[10]*v+l[14])/x,c}function Ht(c,s,l){var h=s[0],p=s[1],v=s[2];return c[0]=h*l[0]+p*l[3]+v*l[6],c[1]=h*l[1]+p*l[4]+v*l[7],c[2]=h*l[2]+p*l[5]+v*l[8],c}function ur(c,s,l){var h=l[0],p=l[1],v=l[2],x=s[0],P=s[1],I=s[2],R=p*I-v*P,$=v*x-h*I,U=h*P-p*x,W=p*U-v*$,te=v*R-h*U,re=h*$-p*R,le=2*l[3];return $*=le,U*=le,te*=2,re*=2,c[0]=x+(R*=le)+(W*=2),c[1]=P+$+te,c[2]=I+U+re,c}function Jt(c,s){return c[0]===s[0]&&c[1]===s[1]&&c[2]===s[2]}var Rt=tt,Dt=st,sr=ze;function mr(){var c=new w(4);return w!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0,c[3]=0),c}function Vr(c,s,l){return c[0]=s[0]*l,c[1]=s[1]*l,c[2]=s[2]*l,c[3]=s[3]*l,c}function rn(c,s){var l=s[0],h=s[1],p=s[2],v=s[3],x=l*l+h*h+p*p+v*v;return x>0&&(x=1/Math.sqrt(x)),c[0]=l*x,c[1]=h*x,c[2]=p*x,c[3]=v*x,c}function $r(c,s,l){var h=s[0],p=s[1],v=s[2],x=s[3];return c[0]=l[0]*h+l[4]*p+l[8]*v+l[12]*x,c[1]=l[1]*h+l[5]*p+l[9]*v+l[13]*x,c[2]=l[2]*h+l[6]*p+l[10]*v+l[14]*x,c[3]=l[3]*h+l[7]*p+l[11]*v+l[15]*x,c}function Yr(){var c=new w(4);return w!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c[3]=1,c}function un(c){return c[0]=0,c[1]=0,c[2]=0,c[3]=1,c}function Fn(c,s,l){l*=.5;var h=s[0],p=s[1],v=s[2],x=s[3],P=Math.sin(l),I=Math.cos(l);return c[0]=h*I+x*P,c[1]=p*I+v*P,c[2]=v*I-p*P,c[3]=x*I-h*P,c}function vi(c,s,l){l*=.5;var h=s[0],p=s[1],v=s[2],x=s[3],P=Math.sin(l),I=Math.cos(l);return c[0]=h*I-v*P,c[1]=p*I+x*P,c[2]=v*I+h*P,c[3]=x*I-p*P,c}xe(),mr();var xr,Hr,wn,xi,ms,Ui=rn,js=(xr=xe(),Hr=Xe(1,0,0),wn=Xe(0,1,0),function(c,s,l){var h=Et(s,l);return h<-.999999?(kt(xr,Hr,s),sr(xr)<1e-6&&kt(xr,wn,s),Ve(xr,xr),function(p,v,x){x*=.5;var P=Math.sin(x);p[0]=P*v[0],p[1]=P*v[1],p[2]=P*v[2],p[3]=Math.cos(x)}(c,xr,Math.PI),c):h>.999999?(c[0]=0,c[1]=0,c[2]=0,c[3]=1,c):(kt(xr,s,l),c[0]=xr[0],c[1]=xr[1],c[2]=xr[2],c[3]=1+h,Ui(c,c))});function es(){var c=new w(2);return w!=Float32Array&&(c[0]=0,c[1]=0),c}function Uo(c,s){var l=new w(2);return l[0]=c,l[1]=s,l}function Ys(c,s,l){return c[0]=s[0]+l[0],c[1]=s[1]+l[1],c}function Js(c,s,l){return c[0]=s[0]-l[0],c[1]=s[1]-l[1],c}function bo(c,s,l){return c[0]=s[0]*l,c[1]=s[1]*l,c}function wo(c){return Math.hypot(c[0],c[1])}function So(c,s){var l=s[0],h=s[1],p=l*l+h*h;return p>0&&(p=1/Math.sqrt(p)),c[0]=s[0]*p,c[1]=s[1]*p,c}function Jn(c,s){return c[0]*s[0]+c[1]*s[1]}function Ds(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}Yr(),Yr(),A(),es();var Io,_s,uo=function(){if(ms)return xi;function c(s,l,h,p){this.cx=3*s,this.bx=3*(h-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(p-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=l,this.p2x=h,this.p2y=p}return ms=1,xi=c,c.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,l){if(l===void 0&&(l=1e-6),s<0)return 0;if(s>1)return 1;for(var h=s,p=0;p<8;p++){var v=this.sampleCurveX(h)-s;if(Math.abs(v)<l)return h;var x=this.sampleCurveDerivativeX(h);if(Math.abs(x)<1e-6)break;h-=v/x}var P=0,I=1;for(h=s,p=0;p<20&&(v=this.sampleCurveX(h),!(Math.abs(v-s)<l));p++)s>v?P=h:I=h,h=.5*(I-P)+P;return h},solve:function(s,l){return this.sampleCurveY(this.solveCurveX(s,l))}},xi}(),qo=Ds(uo);function oa(){if(_s)return Io;function c(s,l){this.x=s,this.y=l}return _s=1,Io=c,c.prototype={clone:function(){return new c(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,l){return this.clone()._rotateAround(s,l)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var l=s.x-this.x,h=s.y-this.y;return l*l+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,l){return Math.atan2(this.x*l-this.y*s,this.x*s+this.y*l)},_matMult:function(s){var l=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=l,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var l=Math.cos(s),h=Math.sin(s),p=h*this.x+l*this.y;return this.x=l*this.x-h*this.y,this.y=p,this},_rotateAround:function(s,l){var h=Math.cos(s),p=Math.sin(s),v=l.y+p*(this.x-l.x)+h*(this.y-l.y);return this.x=l.x+h*(this.x-l.x)-p*(this.y-l.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},c.convert=function(s){return s instanceof c?s:Array.isArray(s)?new c(s[0],s[1]):s},Io}var Qt=Ds(oa());function Hs(c,s){if(Array.isArray(c)){if(!Array.isArray(s)||c.length!==s.length)return!1;for(let l=0;l<c.length;l++)if(!Hs(c[l],s[l]))return!1;return!0}if(typeof c=="object"&&c!==null&&s!==null){if(typeof s!="object"||Object.keys(c).length!==Object.keys(s).length)return!1;for(const l in c)if(!Hs(c[l],s[l]))return!1;return!0}return c===s}const Go=Math.PI/180,dt=180/Math.PI;function ae(c){return c*Go}function oe(c){return c*dt}const pe=[[0,0],[1,0],[1,1],[0,1]];function $e(c){if(c<=0)return 0;if(c>=1)return 1;const s=c*c,l=s*c;return 4*(c<.5?l:3*(c-s)+l-.75)}function He(c,s,l,h){const p=new qo(c,s,l,h);return function(v){return p.solve(v)}}const et=He(.25,.1,.25,1);function rt(c,s,l){return Math.min(l,Math.max(s,c))}function nt(c,s,l){return(l=rt((l-c)/(s-c),0,1))*l*(3-2*l)}function mt(c,s,l){const h=l-s,p=((c-s)%h+h)%h+s;return p===s?l:p}function Ct(c,s,l){if(!c.length)return l(null,[]);let h=c.length;const p=new Array(c.length);let v=null;c.forEach((x,P)=>{s(x,(I,R)=>{I&&(v=I),p[P]=R,--h==0&&l(v,p)})})}function pt(c,...s){for(const l of s)for(const h in l)c[h]=l[h];return c}let rr=1;function ar(){return rr++}function gr(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))}function Ur(c,s){c.forEach(l=>{s[l]&&(s[l]=s[l].bind(s))})}function Xr(c,s,l){const h={};for(const p in c)h[p]=s.call(this,c[p],p,c);return h}function Jr(c,s,l){const h={};for(const p in c)s.call(this,c[p],p,c)&&(h[p]=c[p]);return h}function nn(c){return Array.isArray(c)?c.map(nn):typeof c=="object"&&c?Xr(c,nn):c}const Qn={};function sn(c){Qn[c]||(typeof console<"u"&&console.warn(c),Qn[c]=!0)}function Bn(c,s,l){return(l.y-c.y)*(s.x-c.x)>(s.y-c.y)*(l.x-c.x)}function Tn(c){let s=0;for(let l,h,p=0,v=c.length,x=v-1;p<v;x=p++)l=c[p],h=c[x],s+=(h.x-l.x)*(l.y+h.y);return s}function on([c,s,l]){const h=ae(s+90),p=ae(l);return{x:c*Math.cos(h)*Math.sin(p),y:c*Math.sin(h)*Math.sin(p),z:c*Math.cos(p),azimuthal:s,polar:l}}function Vn(c){return(typeof self<"u"||c!==void 0)&&typeof WorkerGlobalScope<"u"&&(c!==void 0?c:self)instanceof WorkerGlobalScope}function li(c){const s={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,h,p,v)=>{const x=p||v;return s[h]=!x||x.toLowerCase(),""}),s["max-age"]){const l=parseInt(s["max-age"],10);isNaN(l)?delete s["max-age"]:s["max-age"]=l}return s}let bi=null;function Ci(c,s){return[c[4*s],c[4*s+1],c[4*s+2],c[4*s+3]]}function Ki(c,s,l,h){for(;s<l;){const p=s+l>>1;c[p]<h?s=p+1:l=p}return s}function Ho(c,s,l,h){for(;s<l;){const p=s+l>>1;c[p]<=h?s=p+1:l=p}return s}function Qs(c){return c>0?1/(1.001-c):1+c}function xs(c){return c>0?1-1/(1.001-c):-c}function eo(c,s,l){return(c-s.min)*(l.max-l.min)/(s.max-s.min)+l.min}const cs={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!cs.API_URL)return null;try{const c=new URL(cs.API_URL);return c.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":c.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function $l(c){return cs.API_URL_REGEX.test(c)}function nd(c){return cs.API_SPRITE_REGEX.test(c)}let gf,Ac,id,Pc,Vl,yf;function sg(){return gf==null&&(gf=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),gf}const Ia={now:()=>Pc!==void 0?Pc:performance.now(),setNow(c){Pc=c},restoreNow(){Pc=void 0},frame(c){const s=requestAnimationFrame(c);return{cancel:()=>cancelAnimationFrame(s)}},getImageData(c,s=0){const{width:l,height:h}=c;Vl||(Vl=document.createElement("canvas"));const p=Vl.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(l>Vl.width||h>Vl.height)&&(Vl.width=l,Vl.height=h),p.clearRect(-s,-s,l+2*s,h+2*s),p.drawImage(c,0,0,l,h),p.getImageData(-s,-s,l+2*s,h+2*s)},resolveURL:c=>(Ac||(Ac=document.createElement("a")),Ac.href=c,Ac.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(id==null&&(id=window.matchMedia("(prefers-reduced-motion: reduce)")),id.matches)},hasCanvasFingerprintNoise(){if(yf!==void 0)return yf;if(!sg())return yf=!1,!1;const c=new OffscreenCanvas(85,1),s=c.getContext("2d",{willReadFrequently:!0});let l=0;for(let p=0;p<c.width;++p)s.fillStyle=`rgba(${l++},${l++},${l++}, 255)`,s.fillRect(p,0,1,1);const h=s.getImageData(0,0,c.width,c.height);l=0;for(let p=0;p<h.data.length;++p)if(p%4!=3&&l++!==h.data[p])return yf=!0,!0;return yf=!1,!1}};function kp(c,s){const l=c.indexOf("?");if(l<0)return`${c}?${new URLSearchParams(s).toString()}`;const h=new URLSearchParams(c.slice(l));for(const p in s)h.set(p,s[p]);return`${c.slice(0,l)}?${h.toString()}`}function Wo(c,s={persistentParams:[]}){const l=c.indexOf("?");if(l<0)return c;const h=new URLSearchParams,p=new URLSearchParams(c.slice(l));for(const x of s.persistentParams){const P=p.get(x);P&&h.set(x,P)}const v=h.toString();return`${c.slice(0,l)}${v.length>0?`?${v}`:""}`}const aa="mapbox-tiles";let Mc=500,ka=50;const wi=["language","worldview","jobid"];let Oa,nh;function vf(){try{return caches}catch{}}function Ul(){const c=vf();c&&Oa==null&&(Oa=c.open(aa))}let ih=1/0;const Op={supported:!1,testSupport:function(c){!bl&&ho&&(wl?sh(c):sd=c)}};let sd,ho,bl=!1,wl=!1;const La=typeof self<"u"?self:{};function sh(c){const s=c.createTexture();c.bindTexture(c.TEXTURE_2D,s);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,ho),c.isContextLost())return;Op.supported=!0}catch{}c.deleteTexture(s),bl=!0}La.document&&(ho=La.document.createElement("img"),ho.onload=function(){sd&&sh(sd),sd=null,wl=!0},ho.onerror=function(){bl=!0,sd=null},ho.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const hu={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(hu);class Sl extends Error{constructor(s,l,h){l===401&&$l(h)&&(s+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(s),this.status=l,this.url=h}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Un=Vn()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,od=function(c,s){if(!(/^file:/.test(l=c.url)||/^file:/.test(Un())&&!/^\w+:/.test(l))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(h,p){const v=new AbortController,x=new Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:Un(),referrerPolicy:h.referrerPolicy,signal:v.signal});let P=!1,I=!1;const R=($=x.url).indexOf("sku=")>0&&$l($);var $;h.type==="json"&&x.headers.set("Accept","application/json");const U=(te,re,le)=>{if(I)return;if(te&&te.message!=="SecurityError"&&sn(te.toString()),re&&le)return W(re);const ve=Date.now();fetch(x).then(_e=>{if(_e.ok){const Ce=R?_e.clone():null;return W(_e,Ce,ve)}return p(new Sl(_e.statusText,_e.status,h.url))}).catch(_e=>{_e.name!=="AbortError"&&p(new Error(`${_e.message} ${h.url}`))})},W=(te,re,le)=>{(h.type==="arrayBuffer"?te.arrayBuffer():h.type==="json"?te.json():te.text()).then(ve=>{I||(re&&le&&function(_e,Ce,Ee){if(Ul(),Oa==null)return;const ue=li(Ce.headers.get("Cache-Control")||"");if(ue["no-store"])return;const we={status:Ce.status,statusText:Ce.statusText,headers:new Headers};Ce.headers.forEach((Ge,Qe)=>we.headers.set(Qe,Ge)),ue["max-age"]&&we.headers.set("Expires",new Date(Ee+1e3*ue["max-age"]).toUTCString());const Te=we.headers.get("Expires");if(!Te||new Date(Te).getTime()-Ee<42e4)return;let Ie=Wo(_e.url,{persistentParams:wi});if(Ce.status===206){const Ge=_e.headers.get("Range");if(!Ge)return;we.status=200,Ie=kp(Ie,{range:Ge})}(function(Ge,Qe){if(nh===void 0)try{new Response(new ReadableStream),nh=!0}catch{nh=!1}nh?Qe(Ge.body):Ge.blob().then(Qe).catch(it=>sn(it.message))})(Ce,Ge=>{const Qe=new Response((it=Ce.status)!==200&&it!==404&&[101,103,204,205,304].includes(it)?null:Ge,we);var it;Ul(),Oa!=null&&Oa.then(ct=>ct.put(Ie,Qe)).catch(ct=>sn(ct.message))})}(x,re,le),P=!0,p(null,ve,te.headers.get("Cache-Control"),te.headers.get("Expires")))}).catch(ve=>{I||p(new Error(ve.message))})};return R?function(te,re){if(Ul(),Oa==null)return re(null);Oa.then(le=>{let ve=Wo(te.url,{persistentParams:wi});const _e=te.headers.get("Range");_e&&(ve=kp(ve,{range:_e})),le.match(ve).then(Ce=>{const Ee=function(ue){if(!ue)return!1;const we=new Date(ue.headers.get("Expires")||0),Te=li(ue.headers.get("Cache-Control")||"");return Number(we)>Date.now()&&!Te["no-cache"]}(Ce);le.delete(ve).catch(re),Ee&&le.put(ve,Ce.clone()).catch(re),re(null,Ce,Ee)}).catch(re)}).catch(re)}(x,U):U(null,null),{cancel:()=>{I=!0,P||v.abort()}}}(c,s);if(Vn(self)&&self.worker.actor)return self.worker.actor.send("getResource",c,s,void 0,!0)}var l;return function(h,p){const v=new XMLHttpRequest;v.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(v.responseType="arraybuffer");for(const x in h.headers)v.setRequestHeader(x,h.headers[x]);return h.type==="json"&&(v.responseType="text",v.setRequestHeader("Accept","application/json")),v.withCredentials=h.credentials==="include",v.onerror=()=>{p(new Error(v.statusText))},v.onload=()=>{if((v.status>=200&&v.status<300||v.status===0)&&v.response!==null){let x=v.response;if(h.type==="json")try{x=JSON.parse(v.response)}catch(P){return p(P)}p(null,x,v.getResponseHeader("Cache-Control"),v.getResponseHeader("Expires"))}else p(new Sl(v.statusText,v.status,h.url))},v.send(h.body),{cancel:()=>v.abort()}}(c,s)},ql=function(c,s){return od(pt(c,{type:"arrayBuffer"}),s)};function q_(c){const s=document.createElement("a");return s.href=c,s.protocol===location.protocol&&s.host===location.host}const og="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Gl,Ic;Gl=[],Ic=0;const oh=function(c,s){if(Op.supported&&(c.headers||(c.headers={}),c.headers.accept="image/webp,*/*"),Ic>=cs.MAX_PARALLEL_IMAGE_REQUESTS){const v={requestParameters:c,callback:s,cancelled:!1,cancel(){this.cancelled=!0}};return Gl.push(v),v}Ic++;let l=!1;const h=()=>{if(!l)for(l=!0,Ic--;Gl.length&&Ic<cs.MAX_PARALLEL_IMAGE_REQUESTS;){const v=Gl.shift(),{requestParameters:x,callback:P,cancelled:I}=v;I||(v.cancel=oh(x,P).cancel)}},p=ql(c,(v,x,P,I)=>{h(),v?s(v):x&&(self.createImageBitmap?function(R,$){const U=new Blob([new Uint8Array(R)],{type:"image/png"});createImageBitmap(U).then(W=>{$(null,W)}).catch(W=>{$(new Error(`Could not load image because of ${W.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(x,(R,$)=>s(R,$,P,I)):function(R,$){const U=new Image;U.onload=()=>{$(null,U),URL.revokeObjectURL(U.src),U.onload=null,requestAnimationFrame(()=>{U.src=og})},U.onerror=()=>$(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const W=new Blob([new Uint8Array(R)],{type:"image/png"});U.src=R.byteLength?URL.createObjectURL(W):og}(x,(R,$)=>s(R,$,P,I)))});return{cancel:()=>{p.cancel(),h()}}};var ah,ad,Ja,fu={exports:{}},lh={exports:{}},Lp={exports:{}},_f=function(){if(Ja)return fu.exports;Ja=1;var c=(ah||(ah=1,lh.exports=function(l,h){var p,v,x,P,I,R,$,U;for(v=l.length-(p=3&l.length),x=h,I=3432918353,R=461845907,U=0;U<v;)$=255&l.charCodeAt(U)|(255&l.charCodeAt(++U))<<8|(255&l.charCodeAt(++U))<<16|(255&l.charCodeAt(++U))<<24,++U,x=27492+(65535&(P=5*(65535&(x=(x^=$=(65535&($=($=(65535&$)*I+((($>>>16)*I&65535)<<16)&4294967295)<<15|$>>>17))*R+((($>>>16)*R&65535)<<16)&4294967295)<<13|x>>>19))+((5*(x>>>16)&65535)<<16)&4294967295))+((58964+(P>>>16)&65535)<<16);switch($=0,p){case 3:$^=(255&l.charCodeAt(U+2))<<16;case 2:$^=(255&l.charCodeAt(U+1))<<8;case 1:x^=$=(65535&($=($=(65535&($^=255&l.charCodeAt(U)))*I+((($>>>16)*I&65535)<<16)&4294967295)<<15|$>>>17))*R+((($>>>16)*R&65535)<<16)&4294967295}return x^=l.length,x=2246822507*(65535&(x^=x>>>16))+((2246822507*(x>>>16)&65535)<<16)&4294967295,x=3266489909*(65535&(x^=x>>>13))+((3266489909*(x>>>16)&65535)<<16)&4294967295,(x^=x>>>16)>>>0}),lh.exports),s=(ad||(ad=1,Lp.exports=function(l,h){for(var p,v=l.length,x=h^v,P=0;v>=4;)p=1540483477*(65535&(p=255&l.charCodeAt(P)|(255&l.charCodeAt(++P))<<8|(255&l.charCodeAt(++P))<<16|(255&l.charCodeAt(++P))<<24))+((1540483477*(p>>>16)&65535)<<16),x=1540483477*(65535&x)+((1540483477*(x>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),v-=4,++P;switch(v){case 3:x^=(255&l.charCodeAt(P+2))<<16;case 2:x^=(255&l.charCodeAt(P+1))<<8;case 1:x=1540483477*(65535&(x^=255&l.charCodeAt(P)))+((1540483477*(x>>>16)&65535)<<16)}return x=1540483477*(65535&(x^=x>>>13))+((1540483477*(x>>>16)&65535)<<16),(x^=x>>>15)>>>0}),Lp.exports);return fu.exports=c,fu.exports.murmur3=c,fu.exports.murmur2=s,fu.exports}(),ko=Ds(_f);class Hl{constructor(s,...l){pt(this,l[0]||{}),this.type=s}}class Rp extends Hl{constructor(s,l={}){super("error",pt({error:s},l))}}function Wl(c,s,l){l[c]&&l[c].indexOf(s)!==-1||(l[c]=l[c]||[],l[c].push(s))}function ch(c,s,l){if(l&&l[c]){const h=l[c].indexOf(s);h!==-1&&l[c].splice(h,1)}}class Zl{on(s,l){return this._listeners=this._listeners||{},Wl(s,l,this._listeners),this}off(s,l){return ch(s,l,this._listeners),ch(s,l,this._oneTimeListeners),this}once(s,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},Wl(s,l,this._oneTimeListeners),this):new Promise(h=>{this.once(s,h)})}fire(s,l){const h=typeof s=="string"?new Hl(s,l):s,p=h.type;if(this.listens(p)){h.target=this;const v=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const I of v)I.call(this,h);const x=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const I of x)ch(p,I,this._oneTimeListeners),I.call(this,h);const P=this._eventedParent;P&&(pt(h,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),P.fire(h))}else h instanceof Rp&&console.error(h.error);return this}listens(s){return!!(this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s))}setEventedParent(s,l){return this._eventedParent=s,this._eventedParentData=l,this}}class la{constructor(s){typeof s=="string"?this.name=s:(this.name=s.name,this.iconsetId=s.iconsetId)}static from(s){return new la(s)}static toString(s){return s.iconsetId?`${s.name}${s.iconsetId}`:s.name}static parse(s){const[l,h]=s.split("");return new la({name:l,iconsetId:h})}static isEqual(s,l){return s.name===l.name&&s.iconsetId===l.iconsetId}toString(){return la.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var uh,ld={},dh=function(){if(uh)return ld;uh=1;var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function s(v){return(v=Math.round(v))<0?0:v>255?255:v}function l(v){return s(v[v.length-1]==="%"?parseFloat(v)/100*255:parseInt(v))}function h(v){return(x=v[v.length-1]==="%"?parseFloat(v)/100:parseFloat(v))<0?0:x>1?1:x;var x}function p(v,x,P){return P<0?P+=1:P>1&&(P-=1),6*P<1?v+(x-v)*P*6:2*P<1?x:3*P<2?v+(x-v)*(2/3-P)*6:v}try{ld.parseCSSColor=function(v){var x,P=v.replace(/ /g,"").toLowerCase();if(P in c)return c[P].slice();if(P[0]==="#")return P.length===4?(x=parseInt(P.substr(1),16))>=0&&x<=4095?[(3840&x)>>4|(3840&x)>>8,240&x|(240&x)>>4,15&x|(15&x)<<4,1]:null:P.length===7&&(x=parseInt(P.substr(1),16))>=0&&x<=16777215?[(16711680&x)>>16,(65280&x)>>8,255&x,1]:null;var I=P.indexOf("("),R=P.indexOf(")");if(I!==-1&&R+1===P.length){var $=P.substr(0,I),U=P.substr(I+1,R-(I+1)).split(","),W=1;switch($){case"rgba":if(U.length!==4)return null;W=h(U.pop());case"rgb":return U.length!==3?null:[l(U[0]),l(U[1]),l(U[2]),W];case"hsla":if(U.length!==4)return null;W=h(U.pop());case"hsl":if(U.length!==3)return null;var te=(parseFloat(U[0])%360+360)%360/360,re=h(U[1]),le=h(U[2]),ve=le<=.5?le*(re+1):le+re-le*re,_e=2*le-ve;return[s(255*p(_e,ve,te+1/3)),s(255*p(_e,ve,te)),s(255*p(_e,ve,te-1/3)),W];default:return null}}return null}}catch{}return ld}();class Pn{constructor(s,l,h,p=1){this.r=s,this.g=l,this.b=h,this.a=p}static parse(s){if(!s)return;if(s instanceof Pn)return s;if(typeof s!="string")return;const l=dh.parseCSSColor(s);return l?new Pn(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toStringPremultipliedAlpha(){const[s,l,h,p]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(s)},${Math.round(l)},${Math.round(h)},${p})`}toString(){const[s,l,h,p]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*s)},${Math.round(255*l)},${Math.round(255*h)},${p})`}toRenderColor(s){const{r:l,g:h,b:p,a:v}=this;return new cd(s,l,h,p,v)}clone(){return new Pn(this.r,this.g,this.b,this.a)}}class cd{constructor(s,l,h,p,v){if(s){const x=s.image.height,P=x*x;l=v===0?0:l/v*(x-1),h=v===0?0:h/v*(x-1),p=v===0?0:p/v*(x-1);const I=Math.floor(l),R=Math.floor(h),$=Math.floor(p),U=Math.ceil(l),W=Math.ceil(h),te=Math.ceil(p),re=l-I,le=h-R,ve=p-$,_e=s.image.data,Ce=4*(I+R*P+$*x),Ee=4*(I+R*P+te*x),ue=4*(I+W*P+$*x),we=4*(I+W*P+te*x),Te=4*(U+R*P+$*x),Ie=4*(U+R*P+te*x),Ge=4*(U+W*P+$*x),Qe=4*(U+W*P+te*x);if(Ce<0||Qe>=_e.length)throw new Error("out of range");this.r=Br(Br(Br(_e[Ce],_e[Ee],ve),Br(_e[ue],_e[we],ve),le),Br(Br(_e[Te],_e[Ie],ve),Br(_e[Ge],_e[Qe],ve),le),re)/255*v,this.g=Br(Br(Br(_e[Ce+1],_e[Ee+1],ve),Br(_e[ue+1],_e[we+1],ve),le),Br(Br(_e[Te+1],_e[Ie+1],ve),Br(_e[Ge+1],_e[Qe+1],ve),le),re)/255*v,this.b=Br(Br(Br(_e[Ce+2],_e[Ee+2],ve),Br(_e[ue+2],_e[we+2],ve),le),Br(Br(_e[Te+2],_e[Ie+2],ve),Br(_e[Ge+2],_e[Qe+2],ve),le),re)/255*v,this.a=v}else this.r=l,this.g=h,this.b=p,this.a=v}toArray(){const{r:s,g:l,b:h,a:p}=this;return p===0?[0,0,0,0]:[255*s/p,255*l/p,255*h/p,p]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:s,g:l,b:h,a:p}=this,v=Math.min(Math.max(s/p,0),1),x=Math.min(Math.max(l/p,0),1),P=Math.min(Math.max(h/p,0),1),I=Math.min(v,x,P),R=Math.max(v,x,P),$=(I+R)/2;if(I===R)return[0,0,100*$,p];const U=R-I,W=$>.5?U/(2-R-I):U/(R+I);let te=0;return R===v?te=(x-P)/U+(x<P?6:0):R===x?te=(P-v)/U+2:R===P&&(te=(v-x)/U+4),te*=60,[Math.min(Math.max(te,0),360),Math.min(Math.max(100*W,0),100),Math.min(Math.max(100*$,0),100),p]}toArray01(){const{r:s,g:l,b:h,a:p}=this;return p===0?[0,0,0,0]:[s/p,l/p,h/p,p]}toArray01Scaled(s){const{r:l,g:h,b:p,a:v}=this;return v===0?[0,0,0]:[l/v*s,h/v*s,p/v*s]}toArray01PremultipliedAlpha(){const{r:s,g:l,b:h,a:p}=this;return[s,l,h,p]}toArray01Linear(){const{r:s,g:l,b:h,a:p}=this;return p===0?[0,0,0,0]:[Math.pow(s/p,2.2),Math.pow(l/p,2.2),Math.pow(h/p,2.2),p]}}function Br(c,s,l){return c*(1-l)+s*l}function hh(c,s,l){return c.map((h,p)=>Br(h,s[p],l))}function jp(c){return c*c*c*c*c}Pn.black=new Pn(0,0,0,1),Pn.white=new Pn(1,1,1,1),Pn.transparent=new Pn(0,0,0,0),Pn.red=new Pn(1,0,0,1),Pn.blue=new Pn(0,0,1,1);var fh=Object.freeze({__proto__:null,array:hh,color:function(c,s,l){return new Pn(Br(c.r,s.r,l),Br(c.g,s.g,l),Br(c.b,s.b,l),Br(c.a,s.a,l))},easeIn:jp,number:Br});function ud(c,...s){for(const l of s)for(const h in l)c[h]=l[h];return c}class Zo extends Error{constructor(s,l){super(l),this.message=l,this.key=s}}class Xl{constructor(s,l=[]){this.parent=s,this.bindings={};for(const[h,p]of l)this.bindings[h]=p}concat(s){return new Xl(this,s)}get(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(`${s} not found in scope.`)}has(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)}}const kc={kind:"null"},Rr={kind:"number"},hi={kind:"string"},ri={kind:"boolean"},Oo={kind:"color"},pu={kind:"object"},ei={kind:"value"},dd={kind:"collator"},xf={kind:"formatted"},bf={kind:"resolvedImage"};function Lo(c,s){return{kind:"array",itemType:c,N:s}}function Ps(c){if(c.kind==="array"){const s=Ps(c.itemType);return typeof c.N=="number"?`array<${s}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${s}>`}return c.kind}const G_=[kc,Rr,hi,ri,Oo,xf,pu,Lo(ei),bf];function wf(c,s){if(s.kind==="error")return null;if(c.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!wf(c.itemType,s.itemType))&&(typeof c.N!="number"||c.N===s.N))return null}else{if(c.kind===s.kind)return null;if(c.kind==="value"){for(const l of G_)if(!wf(l,s))return null}}return`Expected ${Ps(c)} but found ${Ps(s)} instead.`}function ag(c,s){return s.some(l=>l.kind===c.kind)}function mu(c,s){return s.some(l=>l==="null"?c===null:l==="array"?Array.isArray(c):l==="object"?c&&!Array.isArray(c)&&typeof c=="object":l===typeof c)}class gu{constructor(s,l,h){this.sensitivity=s?l?"variant":"case":l?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(s,l){return this.collator.compare(s,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Dp{constructor(s,l,h,p,v){this.text=s.normalize?s.normalize():s,this.image=l,this.scale=h,this.fontStack=p,this.textColor=v}}class Xo{constructor(s){this.sections=s}static fromString(s){return new Xo([new Dp(s,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(s=>s.text.length!==0||!!s.image&&s.image.hasPrimary())}static factory(s){return s instanceof Xo?s:Xo.fromString(s)}toString(){return this.sections.length===0?"":this.sections.map(s=>s.text).join("")}serialize(){const s=["format"];for(const l of this.sections){if(l.image){const p=l.image.getPrimary().id.toString();s.push(["image",p]);continue}s.push(l.text);const h={};l.fontStack&&(h["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(h["font-scale"]=l.scale),l.textColor&&(h["text-color"]=["rgba"].concat(l.textColor.toRenderColor(null).toArray())),s.push(h)}return s}}class Qa{constructor(s,l={}){if(this.id=la.from(s),this.options=Object.assign({},l),l.transform){const{a:h,b:p,c:v,d:x,e:P,f:I}=l.transform;this.options.transform=new DOMMatrix([h,p,v,x,P,I])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:s,b:l,c:h,d:p,e:v,f:x}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:s,b:l,c:h,d:p,e:v,f:x}})}static parse(s){let l,h,p,v;try{({name:l,iconsetId:h,params:p,transform:v}=JSON.parse(s)||{})}catch{return null}if(!l)return null;const{a:x,b:P,c:I,d:R,e:$,f:U}=v||{};return new Qa({name:l,iconsetId:h},{params:p,transform:new DOMMatrix([x,P,I,R,$,U])})}scaleSelf(s,l){return this.options.transform.scaleSelf(s,l),this}}class ca{constructor(s,l,h,p,v=!1){this.primaryId=la.from(s),this.primaryOptions=l,h&&(this.secondaryId=la.from(h)),this.secondaryOptions=p,this.available=v}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Qa(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Qa(this.secondaryId,this.secondaryOptions):null}static from(s){return typeof s=="string"?ca.build({name:s}):s}static build(s,l,h,p){return!s||typeof s=="object"&&!("name"in s)?null:new ca(s,h,l,p)}}function zy(c,s,l,h){return typeof c=="number"&&c>=0&&c<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof l=="number"&&l>=0&&l<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[c,s,l,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[c,s,l,h]:[c,s,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ph(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof Pn||c instanceof gu||c instanceof Xo||c instanceof ca)return!0;if(Array.isArray(c)){for(const s of c)if(!ph(s))return!1;return!0}if(typeof c=="object"){for(const s in c)if(!ph(c[s]))return!1;return!0}return!1}function Fs(c){if(c===null)return kc;if(typeof c=="string")return hi;if(typeof c=="boolean")return ri;if(typeof c=="number")return Rr;if(c instanceof Pn)return Oo;if(c instanceof gu)return dd;if(c instanceof Xo)return xf;if(c instanceof ca)return bf;if(Array.isArray(c)){const s=c.length;let l;for(const h of c){const p=Fs(h);if(l){if(l===p)continue;l=ei;break}l=p}return Lo(l||ei,s)}return pu}function Ko(c){const s=typeof c;return c===null?"":s==="string"||s==="number"||s==="boolean"?String(c):c instanceof Pn?c.toStringPremultipliedAlpha():c instanceof Xo||c instanceof ca?c.toString():JSON.stringify(c)}class gn{constructor(s,l){this.type=s,this.value=l}static parse(s,l){if(s.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${s.length-1} instead.`);if(!ph(s[1]))return l.error("invalid value");const h=s[1];let p=Fs(h);const v=l.expectedType;return p.kind!=="array"||p.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(p=v),new gn(p,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Pn?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Xo?this.value.serialize():this.value}}class Er{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}}const hd={string:hi,number:Rr,boolean:ri,object:pu};class qr{constructor(s,l){this.type=s,this.args=l}static parse(s,l){if(s.length<2)return l.error("Expected at least one argument.");let h,p=1;const v=s[0];if(v==="array"){let P,I;if(s.length>2){const R=s[1];if(typeof R!="string"||!(R in hd)||R==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);P=hd[R],p++}else P=ei;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return l.error('The length argument to "array" must be a positive integer literal',2);I=s[2],p++}h=Lo(P,I)}else h=hd[v];const x=[];for(;p<s.length;p++){const P=l.parse(s[p],p,ei);if(!P)return null;x.push(P)}return new qr(h,x)}evaluate(s){for(let l=0;l<this.args.length;l++){const h=this.args[l].evaluate(s);if(!wf(this.type,Fs(h)))return h;if(l===this.args.length-1)throw new Er(`The expression ${JSON.stringify(this.args[l].serialize())} evaluated to ${Ps(Fs(h))} but was expected to be of type ${Ps(this.type)}.`)}return null}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}serialize(){const s=this.type,l=[s.kind];if(s.kind==="array"){const h=s.itemType;if(h.kind==="string"||h.kind==="number"||h.kind==="boolean"){l.push(h.kind);const p=s.N;(typeof p=="number"||this.args.length>1)&&l.push(p)}}return l.concat(this.args.map(h=>h.serialize()))}}class fd{constructor(s){this.type=xf,this.sections=s}static parse(s,l){if(s.length<2)return l.error("Expected at least one argument.");const h=s[1];if(!Array.isArray(h)&&typeof h=="object")return l.error("First argument must be an image or text section.");const p=[];let v=!1;for(let x=1;x<=s.length-1;++x){const P=s[x];if(v&&typeof P=="object"&&!Array.isArray(P)){v=!1;let I=null;if(P["font-scale"]&&(I=l.parseObjectValue(P["font-scale"],x,"font-scale",Rr),!I))return null;let R=null;if(P["text-font"]&&(R=l.parseObjectValue(P["text-font"],x,"text-font",Lo(hi)),!R))return null;let $=null;if(P["text-color"]&&($=l.parseObjectValue(P["text-color"],x,"text-color",Oo),!$))return null;const U=p[p.length-1];U.scale=I,U.font=R,U.textColor=$}else{const I=l.parse(s[x],x,ei);if(!I)return null;const R=I.type.kind;if(R!=="string"&&R!=="value"&&R!=="null"&&R!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,p.push({content:I,scale:null,font:null,textColor:null})}}return new fd(p)}evaluate(s){return new Xo(this.sections.map(l=>{const h=l.content.evaluate(s);return Fs(h)===bf?new Dp("",h,null,null,null):new Dp(Ko(h),null,l.scale?l.scale.evaluate(s):null,l.font?l.font.evaluate(s).join(","):null,l.textColor?l.textColor.evaluate(s):null)}))}eachChild(s){for(const l of this.sections)s(l.content),l.scale&&s(l.scale),l.font&&s(l.font),l.textColor&&s(l.textColor)}outputDefined(){return!1}serialize(){const s=["format"];for(const l of this.sections){s.push(l.content.serialize());const h={};l.scale&&(h["font-scale"]=l.scale.serialize()),l.font&&(h["text-font"]=l.font.serialize()),l.textColor&&(h["text-color"]=l.textColor.serialize()),s.push(h)}return s}}class pd{constructor(s,l,h,p){this._imageWarnHistory={},this.type=bf,this.namePrimary=s,this.nameSecondary=l,h&&(this.paramsPrimary=h.params,this.iconsetIdPrimary=h.iconset?h.iconset.id:void 0),p&&(this.paramsSecondary=p.params,this.iconsetIdSecondary=p.iconset?p.iconset.id:void 0)}static parse(s,l){if(s.length<2)return l.error("Expected two or more arguments.");let h=1;const p=[];function v(){if(h<s.length){const P=l.parse(s[h],h++,hi);return P?(p.push({image:P,options:{}}),!0):(l.error(p.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function x(){if(h<s.length){const I=s[h];if((P=I)===null||typeof P!="object"||Array.isArray(P))return!0;const R=I.params,$=I.iconset,U=l.concat(h);if(!R&&!$)return h++,!0;if(R){if(typeof R!="object"||R.constructor!==Object)return U.error('Image options "params" should be an object'),!1;const W={},te=U.concat(void 0,"params");for(const re in R){if(!re)return te.error("Image parameter name should be non-empty"),!1;const le=te.concat(void 0,re).parse(R[re],void 0,Oo,void 0,{typeAnnotation:"coerce"});if(!le)return!1;W[re]=le}p[p.length-1].options.params=W}if($){if(typeof $!="object"||$.constructor!==Object)return U.error('Image options "iconset" should be an object'),!1;if(!$.id)return U.error('Image options "iconset" should have an "id" property'),!1;p[p.length-1].options.iconset=$}return h++,!0}var P;return!0}for(let P=0;P<2;P++)if(!v()||!x())return;return new pd(p[0].image,p[1]?p[1].image:void 0,p[0].options,p[1]?p[1].options:void 0)}evaluateParams(s,l){const h={};if(l){for(const p in l)if(l[p])try{h[p]=l[p].evaluate(s)}catch{continue}if(Object.keys(h).length!==0)return{params:h}}}evaluate(s){const l={name:this.namePrimary.evaluate(s),iconsetId:this.iconsetIdPrimary},h=this.nameSecondary?{name:this.nameSecondary.evaluate(s),iconsetId:this.iconsetIdSecondary}:void 0,p=ca.build(l,h,this.paramsPrimary?this.evaluateParams(s,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(s,this.paramsSecondary):void 0);if(p&&s.availableImages){const v=p.getPrimary().id;if(p.available=s.availableImages.some(x=>la.isEqual(x,v)),p.available){const x=p.getSecondary()?p.getSecondary().id:null;x&&(p.available=s.availableImages.some(P=>la.isEqual(P,x)))}}return p}eachChild(s){if(s(this.namePrimary),this.paramsPrimary)for(const l in this.paramsPrimary)this.paramsPrimary[l]&&s(this.paramsPrimary[l]);if(this.nameSecondary&&(s(this.nameSecondary),this.paramsSecondary))for(const l in this.paramsSecondary)this.paramsSecondary[l]&&s(this.paramsSecondary[l])}outputDefined(){return!1}serializeOptions(s,l){const h={};if(l&&(h.iconset={id:l}),s){h.params={};for(const p in s)s[p]&&(h.params[p]=s[p].serialize())}return Object.keys(h).length>0?h:void 0}serialize(){const s=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const l=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);l&&s.push(l)}if(this.nameSecondary&&(s.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const l=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);l&&s.push(l)}return s}}function Zr(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}const lg={"to-boolean":ri,"to-color":Oo,"to-number":Rr,"to-string":hi};class el{constructor(s,l){this.type=s,this.args=l}static parse(s,l){if(s.length<2)return l.error("Expected at least one argument.");const h=s[0],p=[];let v=kc;if(h==="to-array"){if(!Array.isArray(s[1]))return null;const x=s[1].length;if(l.expectedType){if(l.expectedType.kind!=="array")return l.error(`Expected ${l.expectedType.kind} but found array.`);v=Lo(l.expectedType.itemType,x)}else{if(!(x>0&&ph(s[1][0])))return null;v=Lo(Fs(s[1][0]),x)}for(let P=0;P<x;P++){const I=s[1][P];let R;if(Zr(I)==="array")R=l.parse(I,void 0,v.itemType);else{const $=Zr(I);if($!==v.itemType.kind)return l.error(`Expected ${v.itemType.kind} but found ${$}.`);R=l.registry.literal.parse(["literal",I===void 0?null:I],l)}if(!R)return null;p.push(R)}}else{if((h==="to-boolean"||h==="to-string")&&s.length!==2)return l.error("Expected one argument.");v=lg[h];for(let x=1;x<s.length;x++){const P=l.parse(s[x],x,ei);if(!P)return null;p.push(P)}}return new el(v,p)}evaluate(s){if(this.type.kind==="boolean")return!!this.args[0].evaluate(s);if(this.type.kind==="color"){let l,h;for(const p of this.args){if(l=p.evaluate(s),h=null,l instanceof Pn)return l;if(typeof l=="string"){const v=s.parseColor(l);if(v)return v}else if(Array.isArray(l)&&(h=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:zy(l[0],l[1],l[2],l[3]),!h))return new Pn(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new Er(h||`Could not parse color from value '${typeof l=="string"?l:String(JSON.stringify(l))}'`)}if(this.type.kind==="number"){let l=null;for(const h of this.args){if(l=h.evaluate(s),l===null)return 0;const p=Number(l);if(!isNaN(p))return p}throw new Er(`Could not convert ${JSON.stringify(l)} to number.`)}return this.type.kind==="formatted"?Xo.fromString(Ko(this.args[0].evaluate(s))):this.type.kind==="resolvedImage"?ca.build(Ko(this.args[0].evaluate(s))):this.type.kind==="array"?this.args.map(l=>l.evaluate(s)):Ko(this.args[0].evaluate(s))}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}serialize(){if(this.type.kind==="formatted")return new fd([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new pd(this.args[0]).serialize();const s=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(l=>{s.push(l.serialize())}),s}}const cg=["Unknown","Point","LineString","Polygon"];class Oc{constructor(s,l){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=s,this.options=l}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?cg[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(s){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const s=this.featureDistanceData.center,l=this.featureDistanceData.scale,{x:h,y:p}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(h*l-s[0])+this.featureDistanceData.bearing[1]*(p*l-s[1])}return 0}parseColor(s){let l=this._parseColorCache[s];return l||(l=this._parseColorCache[s]=Pn.parse(s)),l}getConfig(s){return this.options?this.options.get(s):null}}class Ro{constructor(s,l,h,p,v){this.name=s,this.type=l,this._evaluate=h,this.args=p,this._overloadIndex=v}evaluate(s){if(!this._evaluate){const l=Ro.definitions[this.name];this._evaluate=Array.isArray(l)?l[2]:l.overloads[this._overloadIndex][1]}return this._evaluate(s,this.args)}eachChild(s){this.args.forEach(s)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(s=>s.serialize()))}static parse(s,l){const h=s[0],p=Ro.definitions[h];if(!p)return l.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(p)?p[0]:p.type,x=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,P=[];let I=null,R=-1;for(const[$,U]of x){if(Array.isArray($)&&$.length!==s.length-1)continue;P.push($),R++,I=new vg(l.registry,l.path,null,l.scope,void 0,l._scope,l.options);const W=[];let te=!1;for(let re=1;re<s.length;re++){const le=s[re],ve=Array.isArray($)?$[re-1]:$.type,_e=I.parse(le,1+W.length,ve);if(!_e){te=!0;break}W.push(_e)}if(!te)if(Array.isArray($)&&$.length!==W.length)I.error(`Expected ${$.length} arguments, but found ${W.length} instead.`);else{for(let re=0;re<W.length;re++){const le=Array.isArray($)?$[re]:$.type,ve=W[re];I.concat(re+1).checkSubtype(le,ve.type)}if(I.errors.length===0)return new Ro(h,v,U,W,R)}}if(P.length===1)l.errors.push(...I.errors);else{const $=(P.length?P:x.map(([W])=>W)).map(Yo).join(" | "),U=[];for(let W=1;W<s.length;W++){const te=l.parse(s[W],1+U.length);if(!te)return null;U.push(Ps(te.type))}l.error(`Expected arguments of type ${$}, but found (${U.join(", ")}) instead.`)}return null}static register(s,l){Ro.definitions=l;for(const h in l)s[h]=Ro}}function Yo(c){return Array.isArray(c)?`(${c.map(Ps).join(", ")})`:`(${Ps(c.type)}...)`}class mh{constructor(s,l,h){this.type=dd,this.locale=h,this.caseSensitive=s,this.diacriticSensitive=l}static parse(s,l){if(s.length!==2)return l.error("Expected one argument.");const h=s[1];if(typeof h!="object"||Array.isArray(h))return l.error("Collator options argument must be an object.");const p=h["case-sensitive"]===void 0?l.parse(!1,1,ri):l.parseObjectValue(h["case-sensitive"],1,"case-sensitive",ri);if(!p)return null;const v=h["diacritic-sensitive"]===void 0?l.parse(!1,1,ri):l.parseObjectValue(h["diacritic-sensitive"],1,"diacritic-sensitive",ri);if(!v)return null;let x=null;return h.locale&&(x=l.parseObjectValue(h.locale,1,"locale",hi),!x)?null:new mh(p,v,x)}evaluate(s){return new gu(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)}eachChild(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)}outputDefined(){return!1}serialize(){const s={};return s["case-sensitive"]=this.caseSensitive.serialize(),s["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(s.locale=this.locale.serialize()),["collator",s]}}function Lc(c,s,l=0,h=c.length-1,p=El){for(;h>l;){if(h-l>600){const I=h-l+1,R=s-l+1,$=Math.log(I),U=.5*Math.exp(2*$/3),W=.5*Math.sqrt($*U*(I-U)/I)*(R-I/2<0?-1:1);Lc(c,s,Math.max(l,Math.floor(s-R*U/I+W)),Math.min(h,Math.floor(s+(I-R)*U/I+W)),p)}const v=c[s];let x=l,P=h;for(yu(c,l,s),p(c[h],v)>0&&yu(c,l,h);x<P;){for(yu(c,x,P),x++,P--;p(c[x],v)<0;)x++;for(;p(c[P],v)>0;)P--}p(c[l],v)===0?yu(c,l,P):(P++,yu(c,P,h)),P<=s&&(l=P+1),s<=P&&(h=P-1)}}function yu(c,s,l){const h=c[s];c[s]=c[l],c[l]=h}function El(c,s){return c<s?-1:c>s?1:0}function to(c){let s=0;for(let l,h,p=0,v=c.length,x=v-1;p<v;x=p++)l=c[p],h=c[x],s+=(h.x-l.x)*(l.y+h.y);return s}function Sf(c,s){c[0]=Math.min(c[0],s[0]),c[1]=Math.min(c[1],s[1]),c[2]=Math.max(c[2],s[0]),c[3]=Math.max(c[3],s[1])}function vu(c,s){return!(c[0]<=s[0]||c[2]>=s[2]||c[1]<=s[1]||c[3]>=s[3])}function H_(c,s,l){const h=c[0]-s[0],p=c[1]-s[1],v=c[0]-l[0],x=c[1]-l[1];return h*x-v*p==0&&h*v<=0&&p*x<=0}function Kl(c,s,l=!1){let h=!1;for(let P=0,I=s.length;P<I;P++){const R=s[P];for(let $=0,U=R.length,W=U-1;$<U;W=$++){const te=R[W],re=R[$];if(H_(c,te,re))return l;(v=te)[1]>(p=c)[1]!=(x=re)[1]>p[1]&&p[0]<(x[0]-v[0])*(p[1]-v[1])/(x[1]-v[1])+v[0]&&(h=!h)}}var p,v,x;return h}function Ef(c,s,l,h){const p=h[0]-l[0],v=h[1]-l[1],x=(c[0]-l[0])*v-p*(c[1]-l[1]),P=(s[0]-l[0])*v-p*(s[1]-l[1]);return x>0&&P<0||x<0&&P>0}function tl(c,s,l,h){return(p=[h[0]-l[0],h[1]-l[1]])[0]*(v=[s[0]-c[0],s[1]-c[1]])[1]-p[1]*v[0]!=0&&!(!Ef(c,s,l,h)||!Ef(l,h,c,s));var p,v}function Np(c){const s=new Qt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),l=new Qt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const h of c[0])s.x>h.x&&(s.x=h.x),s.y>h.y&&(s.y=h.y),l.x<h.x&&(l.x=h.x),l.y<h.y&&(l.y=h.y);return{min:s,max:l}}const Rc=8192;function Fy(c,s){const l=(180+c[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,p=Math.pow(2,s.z);return[Math.round(l*p*Rc),Math.round(h*p*Rc)]}function W_(c,s){for(let l=0;l<s.length;l++)if(Kl(c,s[l]))return!0;return!1}function By(c,s,l){for(const h of l)for(let p=0,v=h.length,x=v-1;p<v;x=p++)if(tl(c,s,h[x],h[p]))return!0;return!1}function $y(c,s){for(let l=0;l<c.length;++l)if(!Kl(c[l],s))return!1;for(let l=0;l<c.length-1;++l)if(By(c[l],c[l+1],s))return!1;return!0}function Z_(c,s){for(let l=0;l<s.length;l++)if($y(c,s[l]))return!0;return!1}function zp(c,s,l){const h=[];for(let p=0;p<c.length;p++){const v=[];for(let x=0;x<c[p].length;x++){const P=Fy(c[p][x],l);Sf(s,P),v.push(P)}h.push(v)}return h}function rl(c,s,l){const h=[];for(let p=0;p<c.length;p++){const v=zp(c[p],s,l);h.push(v)}return h}function nl(c,s,l,h){if(c[0]<l[0]||c[0]>l[2]){const p=.5*h;let v=c[0]-l[0]>p?-h:l[0]-c[0]>p?h:0;v===0&&(v=c[0]-l[2]>p?-h:l[2]-c[0]>p?h:0),c[0]+=v}Sf(s,c)}function ug(c,s,l,h){const p=Math.pow(2,h.z)*Rc,v=[h.x*Rc,h.y*Rc],x=[];if(!c)return x;for(const P of c)for(const I of P){const R=[I.x+v[0],I.y+v[1]];nl(R,s,l,p),x.push(R)}return x}function dg(c,s,l,h){const p=Math.pow(2,h.z)*Rc,v=[h.x*Rc,h.y*Rc],x=[];if(!c)return x;for(const I of c){const R=[];for(const $ of I){const U=[$.x+v[0],$.y+v[1]];Sf(s,U),R.push(U)}x.push(R)}if(s[2]-s[0]<=p/2){(P=s)[0]=P[1]=1/0,P[2]=P[3]=-1/0;for(const I of x)for(const R of I)nl(R,s,l,p)}var P;return x}class Yl{constructor(s,l){this.type=ri,this.geojson=s,this.geometries=l}static parse(s,l){if(s.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${s.length-1} instead.`);if(ph(s[1])){const h=s[1];if(h.type==="FeatureCollection")for(let p=0;p<h.features.length;++p){const v=h.features[p].geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new Yl(h,h.features[p].geometry)}else if(h.type==="Feature"){const p=h.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Yl(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new Yl(h,h)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(l,h){const p=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if(!x)return!1;if(h.type==="Polygon"){const P=zp(h.coordinates,v,x),I=ug(l.geometry(),p,v,x);if(!vu(p,v))return!1;for(const R of I)if(!Kl(R,P))return!1}if(h.type==="MultiPolygon"){const P=rl(h.coordinates,v,x),I=ug(l.geometry(),p,v,x);if(!vu(p,v))return!1;for(const R of I)if(!W_(R,P))return!1}return!0}(s,this.geometries);if(s.geometryType()==="LineString")return function(l,h){const p=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if(!x)return!1;if(h.type==="Polygon"){const P=zp(h.coordinates,v,x),I=dg(l.geometry(),p,v,x);if(!vu(p,v))return!1;for(const R of I)if(!$y(R,P))return!1}if(h.type==="MultiPolygon"){const P=rl(h.coordinates,v,x),I=dg(l.geometry(),p,v,x);if(!vu(p,v))return!1;for(const R of I)if(!Z_(R,P))return!1}return!0}(s,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const gh={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Tf=1/298.257223563,il=Tf*(2-Tf),yh=Math.PI/180;class Tl{static fromTile(s,l,h){const p=Math.PI*(1-2*(s+.5)/Math.pow(2,l)),v=Math.atan(.5*(Math.exp(p)-Math.exp(-p)))/yh;return new Tl(v,h)}static get units(){return gh}constructor(s,l){if(s===void 0)throw new Error("No latitude given.");if(l&&!gh[l])throw new Error(`Unknown unit ${l}. Use one of: ${Object.keys(gh).join(", ")}`);const h=6378.137*yh*(l?gh[l]:1),p=Math.cos(s*yh),v=1/(1-il*(1-p*p)),x=Math.sqrt(v);this.kx=h*x*p,this.ky=h*x*v*(1-il)}distance(s,l){const h=ua(s[0]-l[0])*this.kx,p=(s[1]-l[1])*this.ky;return Math.sqrt(h*h+p*p)}bearing(s,l){const h=ua(l[0]-s[0])*this.kx;return Math.atan2(h,(l[1]-s[1])*this.ky)/yh}destination(s,l,h){const p=h*yh;return this.offset(s,Math.sin(p)*l,Math.cos(p)*l)}offset(s,l,h){return[s[0]+l/this.kx,s[1]+h/this.ky]}lineDistance(s){let l=0;for(let h=0;h<s.length-1;h++)l+=this.distance(s[h],s[h+1]);return l}area(s){let l=0;for(let h=0;h<s.length;h++){const p=s[h];for(let v=0,x=p.length,P=x-1;v<x;P=v++)l+=ua(p[v][0]-p[P][0])*(p[v][1]+p[P][1])*(h?-1:1)}return Math.abs(l)/2*this.kx*this.ky}along(s,l){let h=0;if(l<=0)return s[0];for(let p=0;p<s.length-1;p++){const v=s[p],x=s[p+1],P=this.distance(v,x);if(h+=P,h>l)return _u(v,x,(l-(h-P))/P)}return s[s.length-1]}pointToSegmentDistance(s,l,h){let[p,v]=l,x=ua(h[0]-p)*this.kx,P=(h[1]-v)*this.ky;if(x!==0||P!==0){const I=(ua(s[0]-p)*this.kx*x+(s[1]-v)*this.ky*P)/(x*x+P*P);I>1?(p=h[0],v=h[1]):I>0&&(p+=x/this.kx*I,v+=P/this.ky*I)}return x=ua(s[0]-p)*this.kx,P=(s[1]-v)*this.ky,Math.sqrt(x*x+P*P)}pointOnLine(s,l){let h=1/0,p=s[0][0],v=s[0][1],x=0,P=0;for(let I=0;I<s.length-1;I++){let R=s[I][0],$=s[I][1],U=ua(s[I+1][0]-R)*this.kx,W=(s[I+1][1]-$)*this.ky,te=0;U===0&&W===0||(te=(ua(l[0]-R)*this.kx*U+(l[1]-$)*this.ky*W)/(U*U+W*W),te>1?(R=s[I+1][0],$=s[I+1][1]):te>0&&(R+=U/this.kx*te,$+=W/this.ky*te)),U=ua(l[0]-R)*this.kx,W=(l[1]-$)*this.ky;const re=U*U+W*W;re<h&&(h=re,p=R,v=$,x=I,P=te)}return{point:[p,v],index:x,t:Math.max(0,Math.min(1,P))}}lineSlice(s,l,h){let p=this.pointOnLine(h,s),v=this.pointOnLine(h,l);if(p.index>v.index||p.index===v.index&&p.t>v.t){const R=p;p=v,v=R}const x=[p.point],P=p.index+1,I=v.index;!Cf(h[P],x[0])&&P<=I&&x.push(h[P]);for(let R=P+1;R<=I;R++)x.push(h[R]);return Cf(h[I],v.point)||x.push(v.point),x}lineSliceAlong(s,l,h){let p=0;const v=[];for(let x=0;x<h.length-1;x++){const P=h[x],I=h[x+1],R=this.distance(P,I);if(p+=R,p>s&&v.length===0&&v.push(_u(P,I,(s-(p-R))/R)),p>=l)return v.push(_u(P,I,(l-(p-R))/R)),v;p>s&&v.push(I)}return v}bufferPoint(s,l){const h=l/this.ky,p=l/this.kx;return[s[0]-p,s[1]-h,s[0]+p,s[1]+h]}bufferBBox(s,l){const h=l/this.ky,p=l/this.kx;return[s[0]-p,s[1]-h,s[2]+p,s[3]+h]}insideBBox(s,l){return ua(s[0]-l[0])>=0&&ua(s[0]-l[2])<=0&&s[1]>=l[1]&&s[1]<=l[3]}}function Cf(c,s){return c[0]===s[0]&&c[1]===s[1]}function _u(c,s,l){const h=ua(s[0]-c[0]);return[c[0]+h*l,c[1]+(s[1]-c[1])*l]}function ua(c){for(;c<-180;)c+=360;for(;c>180;)c-=360;return c}class Af{constructor(s=[],l=(h,p)=>h<p?-1:h>p?1:0){if(this.data=s,this.length=this.data.length,this.compare=l,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(s){this.data.push(s),this._up(this.length++)}pop(){if(this.length===0)return;const s=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:l,compare:h}=this,p=l[s];for(;s>0;){const v=s-1>>1,x=l[v];if(h(p,x)>=0)break;l[s]=x,s=v}l[s]=p}_down(s){const{data:l,compare:h}=this,p=this.length>>1,v=l[s];for(;s<p;){let x=1+(s<<1);const P=x+1;if(P<this.length&&h(l[P],l[x])<0&&(x=P),h(l[x],v)>=0)break;l[s]=l[x],s=x}l[s]=v}}var or=8192;function xu(c,s){return s.dist-c.dist}const vh=100,Pf=50;function _h(c){const s=[1/0,1/0,-1/0,-1/0];if(s.length!==c.length)return!1;for(let l=0;l<s.length;l++)if(s[l]!==c[l])return!1;return!0}function bu(c){return c[1]-c[0]+1}function Ra(c,s){const l=c[1]>=c[0]&&c[1]<s;return l||console.warn("Distance Expression: Index is out of range"),l}function md(c,s){if(c[0]>c[1])return[null,null];const l=bu(c);if(s){if(l===2)return[c,null];const h=Math.floor(l/2);return[[c[0],c[0]+h],[c[0]+h,c[1]]]}{if(l===1)return[c,null];const h=Math.floor(l/2)-1;return[[c[0],c[0]+h],[c[0]+h+1,c[1]]]}}function jc(c,s){const l=[1/0,1/0,-1/0,-1/0];if(!Ra(s,c.length))return l;for(let h=s[0];h<=s[1];++h)Sf(l,c[h]);return l}function xh(c){const s=[1/0,1/0,-1/0,-1/0];for(let l=0;l<c.length;++l)for(let h=0;h<c[l].length;++h)Sf(s,c[l][h]);return s}function wu(c,s,l){if(_h(c)||_h(s))return NaN;let h=0,p=0;return c[2]<s[0]&&(h=s[0]-c[2]),c[0]>s[2]&&(h=c[0]-s[2]),c[1]>s[3]&&(p=c[1]-s[3]),c[3]<s[1]&&(p=s[1]-c[3]),l.distance([0,0],[h,p])}function ja(c){return 360*c-180}function Dn(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function Mf(c,s){const l=Math.pow(2,s.z),h=(c.y/or+s.y)/l;return[ja((c.x/or+s.x)/l),Dn(h)]}function X_(c,s){const l=[];for(let h=0;h<c.length;++h)l.push(Mf(c[h],s));return l}function Vy(c,s,l){const h=l.pointOnLine(s,c).point;return l.distance(c,h)}function gd(c,s,l,h,p){const v=l.slice(h[0],h[1]+1);let x=1/0;for(let P=s[0];P<=s[1];++P)if((x=Math.min(x,Vy(c[P],v,p)))===0)return 0;return x}function hg(c,s,l,h,p){const v=Math.min(p.pointToSegmentDistance(c,l,h),p.pointToSegmentDistance(s,l,h)),x=Math.min(p.pointToSegmentDistance(l,c,s),p.pointToSegmentDistance(h,c,s));return Math.min(v,x)}function Vi(c,s,l,h,p){if(!Ra(s,c.length)||!Ra(h,l.length))return NaN;let v=1/0;for(let x=s[0];x<s[1];++x)for(let P=h[0];P<h[1];++P){if(tl(c[x],c[x+1],l[P],l[P+1]))return 0;v=Math.min(v,hg(c[x],c[x+1],l[P],l[P+1],p))}return v}function Uy(c,s,l,h,p){if(!Ra(s,c.length)||!Ra(h,l.length))return NaN;let v=1/0;for(let x=s[0];x<=s[1];++x)for(let P=h[0];P<=h[1];++P)if((v=Math.min(v,p.distance(c[x],l[P])))===0)return v;return v}function Cs(c,s,l){if(Kl(c,s,!0))return 0;let h=1/0;for(const p of s){const v=p.length;if(v<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(p[0]!==p[v-1]&&(h=Math.min(h,l.pointToSegmentDistance(c,p[v-1],p[0])))===0||(h=Math.min(h,Vy(c,p,l)))===0)return h}return h}function fg(c,s,l,h){if(!Ra(s,c.length))return NaN;for(let v=s[0];v<=s[1];++v)if(Kl(c[v],l,!0))return 0;let p=1/0;for(let v=s[0];v<s[1];++v)for(const x of l)for(let P=0,I=x.length,R=I-1;P<I;R=P++){if(tl(c[v],c[v+1],x[R],x[P]))return 0;p=Math.min(p,hg(c[v],c[v+1],x[R],x[P],h))}return p}function If(c,s){for(const l of c)for(let h=0;h<=l.length-1;++h)if(Kl(l[h],s,!0))return!0;return!1}function kf(c,s,l,h=1/0){const p=xh(c),v=xh(s);if(h!==1/0&&wu(p,v,l)>=h)return h;if(vu(p,v)){if(If(c,s))return 0}else if(If(s,c))return 0;let x=h;for(const P of c)for(let I=0,R=P.length,$=R-1;I<R;$=I++)for(const U of s)for(let W=0,te=U.length,re=te-1;W<te;re=W++){if(tl(P[$],P[I],U[re],U[W]))return 0;x=Math.min(x,hg(P[$],P[I],U[re],U[W],l))}return x}function Of(c,s,l,h,p,v,x){if(v===null||x===null)return;const P=wu(jc(h,v),jc(p,x),l);P<s&&c.push({dist:P,range1:v,range2:x})}function pg(c,s,l,h,p=1/0){let v=Math.min(h.distance(c[0],l[0][0]),p);if(v===0)return v;const x=new Af([{dist:0,range1:[0,c.length-1],range2:[0,0]}],xu),P=s?Pf:vh,I=xh(l);for(;x.length;){const R=x.pop();if(R.dist>=v)continue;const $=R.range1;if(bu($)<=P){if(!Ra($,c.length))return NaN;if(s){const U=fg(c,$,l,h);if((v=Math.min(v,U))===0)return v}else for(let U=$[0];U<=$[1];++U){const W=Cs(c[U],l,h);if((v=Math.min(v,W))===0)return v}}else{const U=md($,s);if(U[0]!==null){const W=wu(jc(c,U[0]),I,h);W<v&&x.push({dist:W,range1:U[0],range2:[0,0]})}if(U[1]!==null){const W=wu(jc(c,U[1]),I,h);W<v&&x.push({dist:W,range1:U[1],range2:[0,0]})}}}return v}function bh(c,s,l,h,p,v=1/0){let x=Math.min(v,p.distance(c[0],l[0]));if(x===0)return x;const P=new Af([{dist:0,range1:[0,c.length-1],range2:[0,l.length-1]}],xu),I=s?Pf:vh,R=h?Pf:vh;for(;P.length;){const $=P.pop();if($.dist>=x)continue;const U=$.range1,W=$.range2;if(bu(U)<=I&&bu(W)<=R){if(!Ra(U,c.length)||!Ra(W,l.length))return NaN;if(s&&h?x=Math.min(x,Vi(c,U,l,W,p)):s||h?s&&!h?x=Math.min(x,gd(l,W,c,U,p)):!s&&h&&(x=Math.min(x,gd(c,U,l,W,p))):x=Math.min(x,Uy(c,U,l,W,p)),x===0)return x}else{const te=md(U,s),re=md(W,h);Of(P,x,p,c,l,te[0],re[0]),Of(P,x,p,c,l,te[0],re[1]),Of(P,x,p,c,l,te[1],re[0]),Of(P,x,p,c,l,te[1],re[1])}}return x}function wh(c,s,l,h,p=1/0){let v=p;const x=jc(c,[0,c.length-1]);for(const P of l)if(!(v!==1/0&&wu(x,jc(P,[0,P.length-1]),h)>=v)&&(v=Math.min(v,bh(c,s,P,!0,h,v)),v===0))return v;return v}function Dc(c,s,l,h,p=1/0){let v=p;const x=jc(c,[0,c.length-1]);for(const P of l){if(v!==1/0&&wu(x,xh(P),h)>=v)continue;const I=pg(c,s,P,h,v);if(isNaN(I))return I;if((v=Math.min(v,I))===0)return v}return v}function Fp(c){return c==="Point"||c==="MultiPoint"||c==="LineString"||c==="MultiLineString"||c==="Polygon"||c==="MultiPolygon"}class yd{constructor(s,l){this.type=Rr,this.geojson=s,this.geometries=l}static parse(s,l){if(s.length!==2)return l.error(`'distance' expression requires either one argument, but found ' ${s.length-1} instead.`);if(ph(s[1])){const h=s[1];if(h.type==="FeatureCollection"){for(let p=0;p<h.features.length;++p)if(Fp(h.features[p].geometry.type))return new yd(h,h.features[p].geometry)}else if(h.type==="Feature"){if(Fp(h.geometry.type))return new yd(h,h.geometry)}else if(Fp(h.type))return new yd(h,h)}return l.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(s){const l=s.geometry(),h=s.canonicalID();if(l!=null&&h!=null){if(s.geometryType()==="Point")return function(p,v,x){const P=[];for(const R of p)for(const $ of R)P.push(Mf($,v));const I=new Tl(P[0][1],"meters");return x.type==="Point"||x.type==="MultiPoint"||x.type==="LineString"?bh(P,!1,x.type==="Point"?[x.coordinates]:x.coordinates,x.type==="LineString",I):x.type==="MultiLineString"?wh(P,!1,x.coordinates,I):x.type==="Polygon"||x.type==="MultiPolygon"?Dc(P,!1,x.type==="Polygon"?[x.coordinates]:x.coordinates,I):null}(l,h,this.geometries);if(s.geometryType()==="LineString")return function(p,v,x){const P=[];for(const R of p){const $=[];for(const U of R)$.push(Mf(U,v));P.push($)}const I=new Tl(P[0][0][1],"meters");if(x.type==="Point"||x.type==="MultiPoint"||x.type==="LineString")return wh(x.type==="Point"?[x.coordinates]:x.coordinates,x.type==="LineString",P,I);if(x.type==="MultiLineString"){let R=1/0;for(let $=0;$<x.coordinates.length;$++){const U=wh(x.coordinates[$],!0,P,I,R);if(isNaN(U))return U;if((R=Math.min(R,U))===0)return R}return R}if(x.type==="Polygon"||x.type==="MultiPolygon"){let R=1/0;for(let $=0;$<P.length;$++){const U=Dc(P[$],!0,x.type==="Polygon"?[x.coordinates]:x.coordinates,I,R);if(isNaN(U))return U;if((R=Math.min(R,U))===0)return R}return R}return null}(l,h,this.geometries);if(s.geometryType()==="Polygon")return function(p,v,x){const P=[];for(const R of function($,U){const W=$.length;if(W<=1)return[$];const te=[];let re,le;for(let ve=0;ve<W;ve++){const _e=to($[ve]);_e!==0&&($[ve].area=Math.abs(_e),le===void 0&&(le=_e<0),le===_e<0?(re&&te.push(re),re=[$[ve]]):re.push($[ve]))}return re&&te.push(re),te}(p)){const $=[];for(let U=0;U<R.length;++U)$.push(X_(R[U],v));P.push($)}const I=new Tl(P[0][0][0][1],"meters");if(x.type==="Point"||x.type==="MultiPoint"||x.type==="LineString")return Dc(x.type==="Point"?[x.coordinates]:x.coordinates,x.type==="LineString",P,I);if(x.type==="MultiLineString"){let R=1/0;for(let $=0;$<x.coordinates.length;$++){const U=Dc(x.coordinates[$],!0,P,I,R);if(isNaN(U))return U;if((R=Math.min(R,U))===0)return R}return R}return x.type==="Polygon"||x.type==="MultiPolygon"?function(R,$,U){let W=1/0;for(const te of R)for(const re of $){const le=kf(te,re,U,W);if(isNaN(le))return le;if((W=Math.min(W,le))===0)return W}return W}(x.type==="Polygon"?[x.coordinates]:x.coordinates,P,I):null}(l,h,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function mg(c,s){switch(c){case"string":return Ko(s);case"number":return+s;case"boolean":return!!s;case"color":return Pn.parse(s);case"formatted":return Xo.fromString(Ko(s));case"resolvedImage":return ca.build(Ko(s))}return s}function gg(c,s,l,h){return h!==void 0&&(c=h*Math.round(c/h)),s!==void 0&&c<s&&(c=s),l!==void 0&&c>l&&(c=l),c}class Nc{constructor(s,l,h){this.type=s,this.key=l,this.scope=h}static parse(s,l){let h=l.expectedType;if(h==null&&(h=ei),s.length<2||s.length>3)return l.error("Invalid number of arguments for 'config' expression.");const p=l.parse(s[1],1);if(!(p instanceof gn))return l.error("Key name of 'config' expression must be a string literal.");if(s.length>=3){const v=l.parse(s[2],2);return v instanceof gn?new Nc(h,Ko(p.value),Ko(v.value)):l.error("Scope of 'config' expression must be a string literal.")}return new Nc(h,Ko(p.value))}evaluate(s){const l=[this.key,this.scope,s.scope].filter(Boolean).join(""),h=s.getConfig(l);if(!h)return null;const{type:p,value:v,values:x,minValue:P,maxValue:I,stepValue:R}=h,$=h.default.evaluate(s);let U=$;if(v){const W=s.scope;s.scope=(W||"").split("").slice(1).join(""),U=v.evaluate(s),s.scope=W}return p&&(U=mg(p,U)),U===void 0||P===void 0&&I===void 0&&R===void 0||(typeof U=="number"?U=gg(U,P,I,R):Array.isArray(U)&&(U=U.map(W=>typeof W=="number"?gg(W,P,I,R):W))),v!==void 0&&U!==void 0&&x&&!x.includes(U)&&(U=$,p&&(U=mg(p,U))),(p&&p!==this.type||U!==void 0&&Fs(U)!==this.type)&&(U=mg(this.type.kind,U)),U}eachChild(){}outputDefined(){return!1}serialize(){const s=["config",this.key];return this.scope&&s.concat(this.key),s}}function Su(c){if(c instanceof Ro&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof Yl||c instanceof yd)return!1;let s=!0;return c.eachChild(l=>{s&&!Su(l)&&(s=!1)}),s}function Sh(c){if(c instanceof Ro&&c.name==="feature-state")return!1;let s=!0;return c.eachChild(l=>{s&&!Sh(l)&&(s=!1)}),s}function Eh(c){if(c instanceof Nc)return new Set([c.key]);let s=new Set;return c.eachChild(l=>{s=new Set([...s,...Eh(l)])}),s}function Eu(c,s){if(c instanceof Ro&&s.indexOf(c.name)>=0)return!1;let l=!0;return c.eachChild(h=>{l&&!Eu(h,s)&&(l=!1)}),l}class Th{constructor(s,l){this.type=l.type,this.name=s,this.boundExpression=l}static parse(s,l){if(s.length!==2||typeof s[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const h=s[1];return l.scope.has(h)?new Th(h,l.scope.get(h)):l.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(s){return this.boundExpression.evaluate(s)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class yg{constructor(s,l=[],h,p=new Xl,v=[],x,P){this.registry=s,this.path=l,this.key=l.map(I=>typeof I=="string"?`['${I}']`:`[${I}]`).join(""),this.scope=p,this.errors=v,this.expectedType=h,this._scope=x,this.options=P}parse(s,l,h,p,v={}){return l||h?this.concat(l,null,h,p)._parse(s,v):this._parse(s,v)}parseObjectValue(s,l,h,p,v,x={}){return this.concat(l,h,p,v)._parse(s,x)}_parse(s,l){function h(p,v,x){return x==="assert"?new qr(v,[p]):x==="coerce"?new el(v,[p]):p}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=typeof s[0]=="string"?this.registry[s[0]]:void 0;if(p){let v=p.parse(s,this);if(!v)return null;if(this.expectedType){const x=this.expectedType,P=v.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||P.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string"){if(this.checkSubtype(x,P))return null}else v=h(v,x,l.typeAnnotation||"coerce");else v=h(v,x,l.typeAnnotation||"assert")}if(!(v instanceof gn)&&v.type.kind!=="resolvedImage"&&_g(v)){const x=new Oc(this._scope,this.options);try{v=new gn(v.type,v.evaluate(x))}catch(P){return this.error(P.message),null}}return v}return el.parse(["to-array",s],this)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof s} instead.`)}concat(s,l,h,p){let v=typeof s=="number"?this.path.concat(s):this.path;v=typeof l=="string"?v.concat(l):v;const x=p?this.scope.concat(p):this.scope;return new yg(this.registry,v,h||null,x,this.errors,this._scope,this.options)}error(s,...l){const h=`${this.key}${l.map(p=>`[${p}]`).join("")}`;this.errors.push(new Zo(h,s))}checkSubtype(s,l){const h=wf(s,l);return h&&this.error(h),h}}var vg=yg;function _g(c){if(c instanceof Th)return _g(c.boundExpression);if(c instanceof Ro&&c.name==="error"||c instanceof mh||c instanceof Yl||c instanceof yd||c instanceof Nc)return!1;const s=c instanceof el||c instanceof qr;let l=!0;return c.eachChild(h=>{l=s?l&&_g(h):l&&h instanceof gn}),!!l&&Su(c)&&Eu(c,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Bp(c,s){const l=c.length-1;let h,p,v=0,x=l,P=0;for(;v<=x;)if(P=Math.floor((v+x)/2),h=c[P],p=c[P+1],h<=s){if(P===l||s<p)return P;v=P+1}else{if(!(h>s))throw new Er("Input is not a number.");x=P-1}return 0}class vd{constructor(s,l,h){this.type=s,this.input=l,this.labels=[],this.outputs=[];for(const[p,v]of h)this.labels.push(p),this.outputs.push(v)}static parse(s,l){if(s.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return l.error("Expected an even number of arguments.");const h=l.parse(s[1],1,Rr);if(!h)return null;const p=[];let v=null;l.expectedType&&l.expectedType.kind!=="value"&&(v=l.expectedType);for(let x=1;x<s.length;x+=2){const P=x===1?-1/0:s[x],I=s[x+1],R=x,$=x+1;if(typeof P!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(p.length&&p[p.length-1][0]>=P)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',R);const U=l.parse(I,$,v);if(!U)return null;v=v||U.type,p.push([P,U])}return new vd(v,h,p)}evaluate(s){const l=this.labels,h=this.outputs;if(l.length===1)return h[0].evaluate(s);const p=this.input.evaluate(s);if(p<=l[0])return h[0].evaluate(s);const v=l.length;return p>=l[v-1]?h[v-1].evaluate(s):h[Bp(l,p)].evaluate(s)}eachChild(s){s(this.input);for(const l of this.outputs)s(l)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}serialize(){const s=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&s.push(this.labels[l]),s.push(this.outputs[l].serialize());return s}}const zc=.95047,xg=1.08883,_d=4/29,da=6/29,Ch=3*da*da,Fc=da*da*da,Lf=Math.PI/180,K_=180/Math.PI;function $p(c){return c>Fc?Math.pow(c,1/3):c/Ch+_d}function Bc(c){return c>da?c*c*c:Ch*(c-_d)}function xd(c){return 255*(c<=.0031308?12.92*c:1.055*Math.pow(c,1/2.4)-.055)}function Tu(c){return(c/=255)<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function Ah(c){const s=Tu(c.r),l=Tu(c.g),h=Tu(c.b),p=$p((.4124564*s+.3575761*l+.1804375*h)/zc),v=$p((.2126729*s+.7151522*l+.072175*h)/1);return{l:116*v-16,a:500*(p-v),b:200*(v-$p((.0193339*s+.119192*l+.9503041*h)/xg)),alpha:c.a}}function Rf(c){let s=(c.l+16)/116,l=isNaN(c.a)?s:s+c.a/500,h=isNaN(c.b)?s:s-c.b/200;return s=1*Bc(s),l=zc*Bc(l),h=xg*Bc(h),new Pn(xd(3.2404542*l-1.5371385*s-.4985314*h),xd(-.969266*l+1.8760108*s+.041556*h),xd(.0556434*l-.2040259*s+1.0572252*h),c.alpha)}function Cl(c,s,l){const h=s-c;return c+l*(h>180||h<-180?h-360*Math.round(h/360):h)}const Da={forward:Ah,reverse:Rf,interpolate:function(c,s,l){return{l:Br(c.l,s.l,l),a:Br(c.a,s.a,l),b:Br(c.b,s.b,l),alpha:Br(c.alpha,s.alpha,l)}}},ts={forward:function(c){const{l:s,a:l,b:h}=Ah(c),p=Math.atan2(h,l)*K_;return{h:p<0?p+360:p,c:Math.sqrt(l*l+h*h),l:s,alpha:c.a}},reverse:function(c){const s=c.h*Lf,l=c.c;return Rf({l:c.l,a:Math.cos(s)*l,b:Math.sin(s)*l,alpha:c.alpha})},interpolate:function(c,s,l){return{h:Cl(c.h,s.h,l),c:Br(c.c,s.c,l),l:Br(c.l,s.l,l),alpha:Br(c.alpha,s.alpha,l)}}};var gs=Object.freeze({__proto__:null,hcl:ts,lab:Da});class Bs{constructor(s,l,h,p,v){this.type=s,this.operator=l,this.interpolation=h,this.input=p,this.labels=[],this.outputs=[];for(const[x,P]of v)this.labels.push(x),this.outputs.push(P)}static interpolationFactor(s,l,h,p){let v=0;if(s.name==="exponential")v=ro(l,s.base,h,p);else if(s.name==="linear")v=ro(l,1,h,p);else if(s.name==="cubic-bezier"){const x=s.controlPoints;v=new qo(x[0],x[1],x[2],x[3]).solve(ro(l,1,h,p))}return v}static parse(s,l){let[h,p,v,...x]=s;if(!Array.isArray(p)||p.length===0)return l.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const R=p[1];if(typeof R!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:R}}else{if(p[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const R=p.slice(1);if(R.length!==4||R.some($=>typeof $!="number"||$<0||$>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:R}}}if(s.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length-1>3&&(s.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(v=l.parse(v,2,Rr),!v)return null;const P=[];let I=null;h==="interpolate-hcl"||h==="interpolate-lab"?I=Oo:l.expectedType&&l.expectedType.kind!=="value"&&(I=l.expectedType);for(let R=0;R<x.length;R+=2){const $=x[R],U=x[R+1],W=R+3,te=R+4;if(typeof $!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',W);if(P.length&&P[P.length-1][0]>=$)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',W);const re=l.parse(U,te,I);if(!re)return null;I=I||re.type,P.push([$,re])}return I.kind==="number"||I.kind==="color"||I.kind==="array"&&I.itemType.kind==="number"&&typeof I.N=="number"?new Bs(I,h,p,v,P):l.error(`Type ${Ps(I)} is not interpolatable.`)}evaluate(s){const l=this.labels,h=this.outputs;if(l.length===1)return h[0].evaluate(s);const p=this.input.evaluate(s);if(p<=l[0])return h[0].evaluate(s);const v=l.length;if(p>=l[v-1])return h[v-1].evaluate(s);const x=Bp(l,p),P=Bs.interpolationFactor(this.interpolation,p,l[x],l[x+1]),I=h[x].evaluate(s),R=h[x+1].evaluate(s);return this.operator==="interpolate"?fh[this.type.kind.toLowerCase()](I,R,P):this.operator==="interpolate-hcl"?ts.reverse(ts.interpolate(ts.forward(I),ts.forward(R),P)):Da.reverse(Da.interpolate(Da.forward(I),Da.forward(R),P))}eachChild(s){s(this.input);for(const l of this.outputs)s(l)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}serialize(){let s;s=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const l=[this.operator,s,this.input.serialize()];for(let h=0;h<this.labels.length;h++)l.push(this.labels[h],this.outputs[h].serialize());return l}}function ro(c,s,l,h){const p=h-l,v=c-l;return p===0?0:s===1?v/p:(Math.pow(s,v)-1)/(Math.pow(s,p)-1)}class jo{constructor(s,l){this.type=s,this.args=l}static parse(s,l){if(s.length<2)return l.error("Expectected at least one argument.");let h=null;const p=l.expectedType;p&&p.kind!=="value"&&(h=p);const v=[];for(const P of s.slice(1)){const I=l.parse(P,1+v.length,h,void 0,{typeAnnotation:"omit"});if(!I)return null;h=h||I.type,v.push(I)}const x=p&&v.some(P=>wf(p,P.type));return new jo(x?ei:h,v)}evaluate(s){let l,h=null,p=0;for(const v of this.args){if(p++,h=v.evaluate(s),h&&h instanceof ca&&!h.available&&(l||(l=h),h=null,p===this.args.length))return l;if(h!==null)break}return h}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}serialize(){const s=["coalesce"];return this.eachChild(l=>{s.push(l.serialize())}),s}}class Jl{constructor(s,l){this.type=l.type,this.bindings=[].concat(s),this.result=l}evaluate(s){return this.result.evaluate(s)}eachChild(s){for(const l of this.bindings)s(l[1]);s(this.result)}static parse(s,l){if(s.length<4)return l.error(`Expected at least 3 arguments, but found ${s.length-1} instead.`);const h=[];for(let v=1;v<s.length-1;v+=2){const x=s[v];if(typeof x!="string")return l.error(`Expected string, but found ${typeof x} instead.`,v);if(/[^a-zA-Z0-9_]/.test(x))return l.error("Variable names must contain only alphanumeric characters or '_'.",v);const P=l.parse(s[v+1],v+1);if(!P)return null;h.push([x,P])}const p=l.parse(s[s.length-1],s.length-1,l.expectedType,h);return p?new Jl(h,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const s=["let"];for(const[l,h]of this.bindings)s.push(l,h.serialize());return s.push(this.result.serialize()),s}}class $c{constructor(s,l,h){this.type=s,this.index=l,this.input=h}static parse(s,l){if(s.length!==3)return l.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const h=l.parse(s[1],1,Rr),p=l.parse(s[2],2,Lo(l.expectedType||ei));return h&&p?new $c(p.type.itemType,h,p):null}evaluate(s){const l=this.index.evaluate(s),h=this.input.evaluate(s);if(l<0)throw new Er(`Array index out of bounds: ${l} < 0.`);if(l>=h.length)throw new Er(`Array index out of bounds: ${l} > ${h.length-1}.`);if(l!==Math.floor(l))throw new Er(`Array index must be an integer, but found ${l} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return h[l]}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Do{constructor(s,l,h){this.type=s,this.index=l,this.input=h}static parse(s,l){if(s.length!==3)return l.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const h=l.parse(s[1],1,Rr),p=l.parse(s[2],2,Lo(l.expectedType||ei));return h&&p?new Do(p.type.itemType,h,p):null}evaluate(s){const l=this.index.evaluate(s),h=this.input.evaluate(s);if(l<0)throw new Er(`Array index out of bounds: ${l} < 0.`);if(l>h.length-1)throw new Er(`Array index out of bounds: ${l} > ${h.length-1}.`);if(l===Math.floor(l))return h[l];const p=Math.floor(l),v=Math.ceil(l),x=h[p],P=h[v];if(typeof x!="number"||typeof P!="number")throw new Er(`Cannot interpolate between non-number values at index ${l}.`);const I=l-p;return x*(1-I)+P*I}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Ph{constructor(s,l){this.type=ri,this.needle=s,this.haystack=l}static parse(s,l){if(s.length!==3)return l.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const h=l.parse(s[1],1,ei),p=l.parse(s[2],2,ei);return h&&p?ag(h.type,[ri,hi,Rr,kc,ei])?new Ph(h,p):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ps(h.type)} instead`):null}evaluate(s){const l=this.needle.evaluate(s),h=this.haystack.evaluate(s);if(h==null)return!1;if(!mu(l,["boolean","string","number","null"]))throw new Er(`Expected first argument to be of type boolean, string, number or null, but found ${Ps(Fs(l))} instead.`);if(!mu(h,["string","array"]))throw new Er(`Expected second argument to be of type array or string, but found ${Ps(Fs(h))} instead.`);return h.indexOf(l)>=0}eachChild(s){s(this.needle),s(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class jf{constructor(s,l,h){this.type=Rr,this.needle=s,this.haystack=l,this.fromIndex=h}static parse(s,l){if(s.length<=2||s.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const h=l.parse(s[1],1,ei),p=l.parse(s[2],2,ei);if(!h||!p)return null;if(!ag(h.type,[ri,hi,Rr,kc,ei]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ps(h.type)} instead`);if(s.length===4){const v=l.parse(s[3],3,Rr);return v?new jf(h,p,v):null}return new jf(h,p)}evaluate(s){const l=this.needle.evaluate(s),h=this.haystack.evaluate(s);if(!mu(l,["boolean","string","number","null"]))throw new Er(`Expected first argument to be of type boolean, string, number or null, but found ${Ps(Fs(l))} instead.`);if(!mu(h,["string","array"]))throw new Er(`Expected second argument to be of type array or string, but found ${Ps(Fs(h))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(s);return h.indexOf(l,p)}return h.indexOf(l)}eachChild(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const s=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),s]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Vp{constructor(s,l,h,p,v,x){this.inputType=s,this.type=l,this.input=h,this.cases=p,this.outputs=v,this.otherwise=x}static parse(s,l){if(s.length<5)return l.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length%2!=1)return l.error("Expected an even number of arguments.");let h,p;l.expectedType&&l.expectedType.kind!=="value"&&(p=l.expectedType);const v={},x=[];for(let R=2;R<s.length-1;R+=2){let $=s[R];const U=s[R+1];Array.isArray($)||($=[$]);const W=l.concat(R);if($.length===0)return W.error("Expected at least one branch label.");for(const re of $){if(typeof re!="number"&&typeof re!="string")return W.error("Branch labels must be numbers or strings.");if(typeof re=="number"&&Math.abs(re)>Number.MAX_SAFE_INTEGER)return W.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof re=="number"&&Math.floor(re)!==re)return W.error("Numeric branch labels must be integer values.");if(h){if(W.checkSubtype(h,Fs(re)))return null}else h=Fs(re);if(v[String(re)]!==void 0)return W.error("Branch labels must be unique.");v[String(re)]=x.length}const te=l.parse(U,R,p);if(!te)return null;p=p||te.type,x.push(te)}const P=l.parse(s[1],1,ei);if(!P)return null;const I=l.parse(s[s.length-1],s.length-1,p);return I?P.type.kind!=="value"&&l.concat(1).checkSubtype(h,P.type)?null:new Vp(h,p,P,v,x,I):null}evaluate(s){const l=this.input.evaluate(s);return(Fs(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(s)}eachChild(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)}outputDefined(){return this.outputs.every(s=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const s=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),h=[],p={};for(const x of l){const P=p[this.cases[x]];P===void 0?(p[this.cases[x]]=h.length,h.push([this.cases[x],[x]])):h[P][1].push(x)}const v=x=>this.inputType.kind==="number"?Number(x):x;for(const[x,P]of h)s.push(P.length===1?v(P[0]):P.map(v)),s.push(this.outputs[x].serialize());return s.push(this.otherwise.serialize()),s}}class bd{constructor(s,l,h){this.type=s,this.branches=l,this.otherwise=h}static parse(s,l){if(s.length<4)return l.error(`Expected at least 3 arguments, but found only ${s.length-1}.`);if(s.length%2!=0)return l.error("Expected an odd number of arguments.");let h;l.expectedType&&l.expectedType.kind!=="value"&&(h=l.expectedType);const p=[];for(let x=1;x<s.length-1;x+=2){const P=l.parse(s[x],x,ri);if(!P)return null;const I=l.parse(s[x+1],x+1,h);if(!I)return null;p.push([P,I]),h=h||I.type}const v=l.parse(s[s.length-1],s.length-1,h);return v?new bd(h,p,v):null}evaluate(s){for(const[l,h]of this.branches)if(l.evaluate(s))return h.evaluate(s);return this.otherwise.evaluate(s)}eachChild(s){for(const[l,h]of this.branches)s(l),s(h);s(this.otherwise)}outputDefined(){return this.branches.every(([s,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const s=["case"];return this.eachChild(l=>{s.push(l.serialize())}),s}}class Mh{constructor(s,l,h,p){this.type=s,this.input=l,this.beginIndex=h,this.endIndex=p}static parse(s,l){if(s.length<=2||s.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const h=l.parse(s[1],1,ei),p=l.parse(s[2],2,Rr);if(!h||!p)return null;if(!ag(h.type,[Lo(ei),hi,ei]))return l.error(`Expected first argument to be of type array or string, but found ${Ps(h.type)} instead`);if(s.length===4){const v=l.parse(s[3],3,Rr);return v?new Mh(h.type,h,p,v):null}return new Mh(h.type,h,p)}evaluate(s){const l=this.input.evaluate(s),h=this.beginIndex.evaluate(s);if(!mu(l,["string","array"]))throw new Er(`Expected first argument to be of type array or string, but found ${Ps(Fs(l))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(s);return l.slice(h,p)}return l.slice(h)}eachChild(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const s=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),s]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Na(c,s){return c==="=="||c==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function Df(c,s,l,h){return h.compare(s,l)===0}function Vc(c,s,l){const h=c!=="=="&&c!=="!=";return class OQ{constructor(v,x,P){this.type=ri,this.lhs=v,this.rhs=x,this.collator=P,this.hasUntypedArgument=v.type.kind==="value"||x.type.kind==="value"}static parse(v,x){if(v.length!==3&&v.length!==4)return x.error("Expected two or three arguments.");const P=v[0];let I=x.parse(v[1],1,ei);if(!I)return null;if(!Na(P,I.type))return x.concat(1).error(`"${P}" comparisons are not supported for type '${Ps(I.type)}'.`);let R=x.parse(v[2],2,ei);if(!R)return null;if(!Na(P,R.type))return x.concat(2).error(`"${P}" comparisons are not supported for type '${Ps(R.type)}'.`);if(I.type.kind!==R.type.kind&&I.type.kind!=="value"&&R.type.kind!=="value")return x.error(`Cannot compare types '${Ps(I.type)}' and '${Ps(R.type)}'.`);h&&(I.type.kind==="value"&&R.type.kind!=="value"?I=new qr(R.type,[I]):I.type.kind!=="value"&&R.type.kind==="value"&&(R=new qr(I.type,[R])));let $=null;if(v.length===4){if(I.type.kind!=="string"&&R.type.kind!=="string"&&I.type.kind!=="value"&&R.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if($=x.parse(v[3],3,dd),!$)return null}return new OQ(I,R,$)}evaluate(v){const x=this.lhs.evaluate(v),P=this.rhs.evaluate(v);if(h&&this.hasUntypedArgument){const I=Fs(x),R=Fs(P);if(I.kind!==R.kind||I.kind!=="string"&&I.kind!=="number")throw new Er(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${I.kind}, ${R.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const I=Fs(x),R=Fs(P);if(I.kind!=="string"||R.kind!=="string")return s(v,x,P)}return this.collator?l(v,x,P,this.collator.evaluate(v)):s(v,x,P)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}serialize(){const v=[c];return this.eachChild(x=>{v.push(x.serialize())}),v}}}const qy=Vc("==",function(c,s,l){return s===l},Df),Y_=Vc("!=",function(c,s,l){return s!==l},function(c,s,l,h){return!Df(0,s,l,h)}),Uc=Vc("<",function(c,s,l){return s<l},function(c,s,l,h){return h.compare(s,l)<0}),wd=Vc(">",function(c,s,l){return s>l},function(c,s,l,h){return h.compare(s,l)>0}),Ih=Vc("<=",function(c,s,l){return s<=l},function(c,s,l,h){return h.compare(s,l)<=0}),Up=Vc(">=",function(c,s,l){return s>=l},function(c,s,l,h){return h.compare(s,l)>=0});class kh{constructor(s,l,h,p,v,x){this.type=hi,this.number=s,this.locale=l,this.currency=h,this.unit=p,this.minFractionDigits=v,this.maxFractionDigits=x}static parse(s,l){if(s.length!==3)return l.error("Expected two arguments.");const h=l.parse(s[1],1,Rr);if(!h)return null;const p=s[2];if(typeof p!="object"||Array.isArray(p))return l.error("NumberFormat options argument must be an object.");let v=null;if(p.locale&&(v=l.parseObjectValue(p.locale,2,"locale",hi),!v))return null;let x=null;if(p.currency&&(x=l.parseObjectValue(p.currency,2,"currency",hi),!x))return null;let P=null;if(p.unit&&(P=l.parseObjectValue(p.unit,2,"unit",hi),!P))return null;let I=null;if(p["min-fraction-digits"]&&(I=l.parseObjectValue(p["min-fraction-digits"],2,"min-fraction-digits",Rr),!I))return null;let R=null;return p["max-fraction-digits"]&&(R=l.parseObjectValue(p["max-fraction-digits"],2,"max-fraction-digits",Rr),!R)?null:new kh(h,v,x,P,I,R)}evaluate(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(s):void 0,unit:this.unit?this.unit.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))}eachChild(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.unit&&s(this.unit),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const s={};return this.locale&&(s.locale=this.locale.serialize()),this.currency&&(s.currency=this.currency.serialize()),this.unit&&(s.unit=this.unit.serialize()),this.minFractionDigits&&(s["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(s["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),s]}}class Jo{constructor(s){this.type=Rr,this.input=s}static parse(s,l){if(s.length!==2)return l.error(`Expected 1 argument, but found ${s.length-1} instead.`);const h=l.parse(s[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${Ps(h.type)} instead.`):new Jo(h):null}evaluate(s){const l=this.input.evaluate(s);if(typeof l=="string"||Array.isArray(l))return l.length;throw new Er(`Expected value to be of type string or array, but found ${Ps(Fs(l))} instead.`)}eachChild(s){s(this.input)}outputDefined(){return!1}serialize(){const s=["length"];return this.eachChild(l=>{s.push(l.serialize())}),s}}function za(c){return function(){c=1831565813+(c|=0)|0;let s=Math.imul(c^c>>>15,1|c);return s=s+Math.imul(s^s>>>7,61|s)^s,((s^s>>>14)>>>0)/4294967296}}const Fa={"==":qy,"!=":Y_,">":wd,"<":Uc,">=":Up,"<=":Ih,array:qr,at:$c,"at-interpolated":Do,boolean:qr,case:bd,coalesce:jo,collator:mh,format:fd,image:pd,in:Ph,"index-of":jf,interpolate:Bs,"interpolate-hcl":Bs,"interpolate-lab":Bs,length:Jo,let:Jl,literal:gn,match:Vp,number:qr,"number-format":kh,object:qr,slice:Mh,step:vd,string:qr,"to-boolean":el,"to-color":el,"to-number":el,"to-string":el,var:Th,within:Yl,distance:yd,config:Nc};function Ql(c,[s,l,h,p]){s=s.evaluate(c),l=l.evaluate(c),h=h.evaluate(c);const v=p?p.evaluate(c):1,x=zy(s,l,h,v);if(x)throw new Er(x);return new Pn(s/255*v,l/255*v,h/255*v,v)}function ec(c,[s,l,h,p]){s=s.evaluate(c),l=l.evaluate(c),h=h.evaluate(c);const v=p?p.evaluate(c):1,x=function(R,$,U,W){return typeof R=="number"&&R>=0&&R<=360?typeof $=="number"&&$>=0&&$<=100&&typeof U=="number"&&U>=0&&U<=100?W===void 0||typeof W=="number"&&W>=0&&W<=1?null:`Invalid hsla value [${[R,$,U,W].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof W=="number"?[R,$,U,W]:[R,$,U]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof W=="number"?[R,$,U,W]:[R,$,U]).join(", ")}]: 'h' must be between 0 and 360.`}(s,l,h,v);if(x)throw new Er(x);const P=`hsla(${s}, ${l}%, ${h}%, ${v})`,I=Pn.parse(P);if(!I)throw new Er(`Failed to parse HSLA color: ${P}`);return I}function qc(c,s){return c in s}function Nf(c,s){const l=s[c];return l===void 0?null:l}function tc(c){return{type:c}}function qp(c){return{result:"success",value:c}}function As(c){return{result:"error",value:c}}function ha(c,s){return!!c&&!!c.parameters&&c.parameters.indexOf(s)>-1}function ys(c){return c["property-type"]==="data-driven"}function sl(c){return ha(c.expression,"measure-light")}function Gp(c){return ha(c.expression,"zoom")}function zf(c){return!!c.expression&&c.expression.interpolated}function Oh(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function Hp(c){return c}function Ff(c,s){const l=s.type==="color",h=c.stops&&typeof c.stops[0][0]=="object",p=h||!(h||c.property!==void 0),v=c.type||(zf(s)?"exponential":"interval");if(l&&((c=ud({},c)).stops&&(c.stops=c.stops.map(R=>[R[0],Pn.parse(R[1])])),c.default=Pn.parse(c.default?c.default:s.default)),c.colorSpace&&c.colorSpace!=="rgb"&&!gs[c.colorSpace])throw new Error(`Unknown color space: ${c.colorSpace}`);let x,P,I;if(v==="exponential")x=Al;else if(v==="interval")x=Lh;else if(v==="categorical"){x=bg,P=Object.create(null);for(const R of c.stops)P[R[0]]=R[1];I=typeof c.stops[0][0]}else{if(v!=="identity")throw new Error(`Unknown function type "${v}"`);x=J_}if(h){const R={},$=[];for(let te=0;te<c.stops.length;te++){const re=c.stops[te],le=re[0].zoom;R[le]===void 0&&(R[le]={zoom:le,type:c.type,property:c.property,default:c.default,stops:[]},$.push(le)),R[le].stops.push([re[0].value,re[1]])}const U=[];for(const te of $)U.push([R[te].zoom,Ff(R[te],s)]);const W={name:"linear"};return{kind:"composite",interpolationType:W,interpolationFactor:Bs.interpolationFactor.bind(void 0,W),zoomStops:U.map(te=>te[0]),evaluate:({zoom:te},re)=>Al({stops:U,base:c.base},s,te).evaluate(te,re)}}if(p){const R=v==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:R,interpolationFactor:Bs.interpolationFactor.bind(void 0,R),zoomStops:c.stops.map($=>$[0]),evaluate:({zoom:$})=>x(c,s,$,P,I)}}return{kind:"source",evaluate(R,$){const U=$&&$.properties?$.properties[c.property]:void 0;return U===void 0?rc(c.default,s.default):x(c,s,U,P,I)}}}function rc(c,s,l){return c!==void 0?c:s!==void 0?s:l!==void 0?l:void 0}function bg(c,s,l,h,p){return rc(typeof l===p?h[l]:void 0,c.default,s.default)}function Lh(c,s,l){if(Zr(l)!=="number")return rc(c.default,s.default);const h=c.stops.length;if(h===1||l<=c.stops[0][0])return c.stops[0][1];if(l>=c.stops[h-1][0])return c.stops[h-1][1];const p=Bp(c.stops.map(v=>v[0]),l);return c.stops[p][1]}function Al(c,s,l){const h=c.base!==void 0?c.base:1;if(Zr(l)!=="number")return rc(c.default,s.default);const p=c.stops.length;if(p===1||l<=c.stops[0][0])return c.stops[0][1];if(l>=c.stops[p-1][0])return c.stops[p-1][1];const v=Bp(c.stops.map($=>$[0]),l),x=function($,U,W,te){const re=te-W,le=$-W;return re===0?0:U===1?le/re:(Math.pow(U,le)-1)/(Math.pow(U,re)-1)}(l,h,c.stops[v][0],c.stops[v+1][0]),P=c.stops[v][1],I=c.stops[v+1][1];let R=fh[s.type]||Hp;if(c.colorSpace&&c.colorSpace!=="rgb"){const $=gs[c.colorSpace];R=(U,W)=>$.reverse($.interpolate($.forward(U),$.forward(W),x))}return typeof P.evaluate=="function"?{evaluate(...$){const U=P.evaluate.apply(void 0,$),W=I.evaluate.apply(void 0,$);if(U!==void 0&&W!==void 0)return R(U,W,x)}}:R(P,I,x)}function J_(c,s,l){return s.type==="color"?l=Pn.parse(l):s.type==="formatted"?l=Xo.fromString(l.toString()):s.type==="resolvedImage"?l=ca.build(l.toString()):Zr(l)===s.type||s.type==="enum"&&s.values[l]||(l=void 0),rc(l,c.default,s.default)}Ro.register(Fa,{error:[{kind:"error"},[hi],(c,[s])=>{throw new Er(s.evaluate(c))}],typeof:[hi,[ei],(c,[s])=>Ps(Fs(s.evaluate(c)))],"to-rgba":[Lo(Rr,4),[Oo],(c,[s])=>s.evaluate(c).toRenderColor(null).toArray()],"to-hsla":[Lo(Rr,4),[Oo],(c,[s])=>s.evaluate(c).toRenderColor(null).toHslaArray()],rgb:[Oo,[Rr,Rr,Rr],Ql],rgba:[Oo,[Rr,Rr,Rr,Rr],Ql],hsl:[Oo,[Rr,Rr,Rr],ec],hsla:[Oo,[Rr,Rr,Rr,Rr],ec],has:{type:ri,overloads:[[[hi],(c,[s])=>qc(s.evaluate(c),c.properties())],[[hi,pu],(c,[s,l])=>qc(s.evaluate(c),l.evaluate(c))]]},get:{type:ei,overloads:[[[hi],(c,[s])=>Nf(s.evaluate(c),c.properties())],[[hi,pu],(c,[s,l])=>Nf(s.evaluate(c),l.evaluate(c))]]},"feature-state":[ei,[hi],(c,[s])=>Nf(s.evaluate(c),c.featureState||{})],properties:[pu,[],c=>c.properties()],"geometry-type":[hi,[],c=>c.geometryType()],id:[ei,[],c=>c.id()],zoom:[Rr,[],c=>c.globals.zoom],pitch:[Rr,[],c=>c.globals.pitch||0],"distance-from-center":[Rr,[],c=>c.distanceFromCenter()],"measure-light":[Rr,[hi],(c,[s])=>c.measureLight(s.evaluate(c))],"heatmap-density":[Rr,[],c=>c.globals.heatmapDensity||0],"line-progress":[Rr,[],c=>c.globals.lineProgress||0],"raster-value":[Rr,[],c=>c.globals.rasterValue||0],"raster-particle-speed":[Rr,[],c=>c.globals.rasterParticleSpeed||0],"sky-radial-progress":[Rr,[],c=>c.globals.skyRadialProgress||0],accumulated:[ei,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[Rr,tc(Rr),(c,s)=>{let l=0;for(const h of s)l+=h.evaluate(c);return l}],"*":[Rr,tc(Rr),(c,s)=>{let l=1;for(const h of s)l*=h.evaluate(c);return l}],"-":{type:Rr,overloads:[[[Rr,Rr],(c,[s,l])=>s.evaluate(c)-l.evaluate(c)],[[Rr],(c,[s])=>-s.evaluate(c)]]},"/":[Rr,[Rr,Rr],(c,[s,l])=>s.evaluate(c)/l.evaluate(c)],"%":[Rr,[Rr,Rr],(c,[s,l])=>s.evaluate(c)%l.evaluate(c)],ln2:[Rr,[],()=>Math.LN2],pi:[Rr,[],()=>Math.PI],e:[Rr,[],()=>Math.E],"^":[Rr,[Rr,Rr],(c,[s,l])=>Math.pow(s.evaluate(c),l.evaluate(c))],sqrt:[Rr,[Rr],(c,[s])=>Math.sqrt(s.evaluate(c))],log10:[Rr,[Rr],(c,[s])=>Math.log(s.evaluate(c))/Math.LN10],ln:[Rr,[Rr],(c,[s])=>Math.log(s.evaluate(c))],log2:[Rr,[Rr],(c,[s])=>Math.log(s.evaluate(c))/Math.LN2],sin:[Rr,[Rr],(c,[s])=>Math.sin(s.evaluate(c))],cos:[Rr,[Rr],(c,[s])=>Math.cos(s.evaluate(c))],tan:[Rr,[Rr],(c,[s])=>Math.tan(s.evaluate(c))],asin:[Rr,[Rr],(c,[s])=>Math.asin(s.evaluate(c))],acos:[Rr,[Rr],(c,[s])=>Math.acos(s.evaluate(c))],atan:[Rr,[Rr],(c,[s])=>Math.atan(s.evaluate(c))],min:[Rr,tc(Rr),(c,s)=>Math.min(...s.map(l=>l.evaluate(c)))],max:[Rr,tc(Rr),(c,s)=>Math.max(...s.map(l=>l.evaluate(c)))],abs:[Rr,[Rr],(c,[s])=>Math.abs(s.evaluate(c))],round:[Rr,[Rr],(c,[s])=>{const l=s.evaluate(c);return l<0?-Math.round(-l):Math.round(l)}],floor:[Rr,[Rr],(c,[s])=>Math.floor(s.evaluate(c))],ceil:[Rr,[Rr],(c,[s])=>Math.ceil(s.evaluate(c))],"filter-==":[ri,[hi,ei],(c,[s,l])=>c.properties()[s.value]===l.value],"filter-id-==":[ri,[ei],(c,[s])=>c.id()===s.value],"filter-type-==":[ri,[hi],(c,[s])=>c.geometryType()===s.value],"filter-<":[ri,[hi,ei],(c,[s,l])=>{const h=c.properties()[s.value],p=l.value;return typeof h==typeof p&&h<p}],"filter-id-<":[ri,[ei],(c,[s])=>{const l=c.id(),h=s.value;return typeof l==typeof h&&l<h}],"filter->":[ri,[hi,ei],(c,[s,l])=>{const h=c.properties()[s.value],p=l.value;return typeof h==typeof p&&h>p}],"filter-id->":[ri,[ei],(c,[s])=>{const l=c.id(),h=s.value;return typeof l==typeof h&&l>h}],"filter-<=":[ri,[hi,ei],(c,[s,l])=>{const h=c.properties()[s.value],p=l.value;return typeof h==typeof p&&h<=p}],"filter-id-<=":[ri,[ei],(c,[s])=>{const l=c.id(),h=s.value;return typeof l==typeof h&&l<=h}],"filter->=":[ri,[hi,ei],(c,[s,l])=>{const h=c.properties()[s.value],p=l.value;return typeof h==typeof p&&h>=p}],"filter-id->=":[ri,[ei],(c,[s])=>{const l=c.id(),h=s.value;return typeof l==typeof h&&l>=h}],"filter-has":[ri,[ei],(c,[s])=>s.value in c.properties()],"filter-has-id":[ri,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[ri,[Lo(hi)],(c,[s])=>s.value.indexOf(c.geometryType())>=0],"filter-id-in":[ri,[Lo(ei)],(c,[s])=>s.value.indexOf(c.id())>=0],"filter-in-small":[ri,[hi,Lo(ei)],(c,[s,l])=>l.value.indexOf(c.properties()[s.value])>=0],"filter-in-large":[ri,[hi,Lo(ei)],(c,[s,l])=>function(h,p,v,x){for(;v<=x;){const P=v+x>>1;if(p[P]===h)return!0;p[P]>h?x=P-1:v=P+1}return!1}(c.properties()[s.value],l.value,0,l.value.length-1)],all:{type:ri,overloads:[[[ri,ri],(c,[s,l])=>s.evaluate(c)&&l.evaluate(c)],[tc(ri),(c,s)=>{for(const l of s)if(!l.evaluate(c))return!1;return!0}]]},any:{type:ri,overloads:[[[ri,ri],(c,[s,l])=>s.evaluate(c)||l.evaluate(c)],[tc(ri),(c,s)=>{for(const l of s)if(l.evaluate(c))return!0;return!1}]]},"!":[ri,[ri],(c,[s])=>!s.evaluate(c)],"is-supported-script":[ri,[hi],(c,[s])=>{const l=c.globals&&c.globals.isSupportedScript;return!l||l(s.evaluate(c))}],upcase:[hi,[hi],(c,[s])=>s.evaluate(c).toUpperCase()],downcase:[hi,[hi],(c,[s])=>s.evaluate(c).toLowerCase()],concat:[hi,tc(ei),(c,s)=>s.map(l=>Ko(l.evaluate(c))).join("")],"resolved-locale":[hi,[dd],(c,[s])=>s.evaluate(c).resolvedLocale()],random:[Rr,[Rr,Rr,ei],(c,s)=>{const[l,h,p]=s.map(x=>x.evaluate(c));if(l>h||l===h)return l;let v;if(typeof p=="string")v=function(x){let P=0;if(x.length===0)return P;for(let I=0;I<x.length;I++)P=(P<<5)-P+x.charCodeAt(I),P|=0;return P}(p);else{if(typeof p!="number")throw new Er(`Invalid seed input: ${p}`);v=p}return l+za(v)()*(h-l)}]});class Sd{constructor(s,l,h,p){this.expression=s,this._warningHistory={},this._evaluator=new Oc(h,p),this._defaultValue=l?function(v){return v.type==="color"&&(Oh(v.default)||Array.isArray(v.default))?new Pn(0,0,0,0):v.type==="color"?Pn.parse(v.default)||null:v.default===void 0?null:v.default}(l):null,this._enumValues=l&&l.type==="enum"?l.values:null,this.configDependencies=Eh(s)}evaluateWithoutErrorHandling(s,l,h,p,v,x,P,I){return this._evaluator.globals=s,this._evaluator.feature=l,this._evaluator.featureState=h,this._evaluator.canonical=p||null,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x,this._evaluator.featureTileCoord=P||null,this._evaluator.featureDistanceData=I||null,this.expression.evaluate(this._evaluator)}evaluate(s,l,h,p,v,x,P,I){this._evaluator.globals=s,this._evaluator.feature=l||null,this._evaluator.featureState=h||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x||null,this._evaluator.featureTileCoord=P||null,this._evaluator.featureDistanceData=I||null;try{const R=this.expression.evaluate(this._evaluator);if(R==null||typeof R=="number"&&R!=R)return this._defaultValue;if(this._enumValues&&!(R in this._enumValues))throw new Er(`Expected value to be one of ${Object.keys(this._enumValues).map($=>JSON.stringify($)).join(", ")}, but found ${JSON.stringify(R)} instead.`);return R}catch(R){return this._warningHistory[R.message]||(this._warningHistory[R.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${R.message}`)),this._defaultValue}}}function Ed(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in Fa}function Td(c,s,l,h){const p=new vg(Fa,[],s?function(x){const P={color:Oo,string:hi,number:Rr,enum:hi,boolean:ri,formatted:xf,resolvedImage:bf};return x.type==="array"?Lo(P[x.value]||ei,x.length):P[x.type]}(s):void 0,void 0,void 0,l,h),v=p.parse(c,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return v?qp(new Sd(v,s,l,h)):As(p.errors)}class Cu{constructor(s,l,h,p){this.kind=s,this._styleExpression=l,this.isLightConstant=h,this.isLineProgressConstant=p,this.isStateDependent=s!=="constant"&&!Sh(l.expression),this.configDependencies=Eh(l.expression)}evaluateWithoutErrorHandling(s,l,h,p,v,x){return this._styleExpression.evaluateWithoutErrorHandling(s,l,h,p,v,x)}evaluate(s,l,h,p,v,x){return this._styleExpression.evaluate(s,l,h,p,v,x)}}class Pl{constructor(s,l,h,p,v,x){this.kind=s,this.zoomStops=h,this._styleExpression=l,this.isStateDependent=s!=="camera"&&!Sh(l.expression),this.isLightConstant=v,this.isLineProgressConstant=x,this.configDependencies=Eh(l.expression),this.interpolationType=p}evaluateWithoutErrorHandling(s,l,h,p,v,x){return this._styleExpression.evaluateWithoutErrorHandling(s,l,h,p,v,x)}evaluate(s,l,h,p,v,x){return this._styleExpression.evaluate(s,l,h,p,v,x)}interpolationFactor(s,l,h){return this.interpolationType?Bs.interpolationFactor(this.interpolationType,s,l,h):0}}function Rh(c,s,l,h){if((c=Td(c,s,l,h)).result==="error")return c;const p=c.value.expression,v=Su(p);if(!v&&!ys(s))return As([new Zo("","data expressions not supported")]);const x=Eu(p,["zoom","pitch","distance-from-center"]);if(!x&&!Gp(s))return As([new Zo("","zoom expressions not supported")]);const P=Eu(p,["measure-light"]);if(!P&&!sl(s))return As([new Zo("","measure-light expression not supported")]);const I=Eu(p,["line-progress"]);if(!I&&!function(U){return ha(U.expression,"line-progress")}(s))return As([new Zo("","line-progress expression not supported")]);const R=s.expression&&s.expression.relaxZoomRestriction,$=Cd(p);return $||x||R?$ instanceof Zo?As([$]):$ instanceof Bs&&!zf(s)?As([new Zo("",'"interpolate" expressions cannot be used with this property')]):qp($?new Pl(v&&I?"camera":"composite",c.value,$.labels,$ instanceof Bs?$.interpolation:void 0,P,I):new Cu(v&&I?"constant":"source",c.value,P,I)):As([new Zo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Au{constructor(s,l){this._parameters=s,this._specification=l,ud(this,Ff(this._parameters,this._specification))}static deserialize(s){return new Au(s._parameters,s._specification)}static serialize(s){return{_parameters:s._parameters,_specification:s._specification}}}function Cd(c){let s=null;if(c instanceof Jl)s=Cd(c.result);else if(c instanceof jo){for(const l of c.args)if(s=Cd(l),s)break}else(c instanceof vd||c instanceof Bs)&&c.input instanceof Ro&&c.input.name==="zoom"&&(s=c);return s instanceof Zo||c.eachChild(l=>{const h=Cd(l);h instanceof Zo?s=h:s&&h&&s!==h&&(s=new Zo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),s}var Pu,jh,Bf=function(){if(jh)return Pu;jh=1,Pu=s;var c=3;function s(l,h,p){var v=this.cells=[];if(l instanceof ArrayBuffer){this.arrayBuffer=l;var x=new Int32Array(this.arrayBuffer);l=x[0],this.d=(h=x[1])+2*(p=x[2]);for(var P=0;P<this.d*this.d;P++){var I=x[c+P],R=x[c+P+1];v.push(I===R?null:x.subarray(I,R))}var $=x[c+v.length+1];this.keys=x.subarray(x[c+v.length],$),this.bboxes=x.subarray($),this.insert=this._insertReadonly}else{this.d=h+2*p;for(var U=0;U<this.d*this.d;U++)v.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=l,this.padding=p,this.scale=h/l,this.uid=0;var W=p/h*l;this.min=-W,this.max=l+W}return s.prototype.insert=function(l,h,p,v,x){this._forEachCell(h,p,v,x,this._insertCell,this.uid++),this.keys.push(l),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(v),this.bboxes.push(x)},s.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},s.prototype._insertCell=function(l,h,p,v,x,P){this.cells[x].push(P)},s.prototype.query=function(l,h,p,v,x){var P=this.min,I=this.max;if(l<=P&&h<=P&&I<=p&&I<=v&&!x)return Array.prototype.slice.call(this.keys);var R=[];return this._forEachCell(l,h,p,v,this._queryCell,R,{},x),R},s.prototype._queryCell=function(l,h,p,v,x,P,I,R){var $=this.cells[x];if($!==null)for(var U=this.keys,W=this.bboxes,te=0;te<$.length;te++){var re=$[te];if(I[re]===void 0){var le=4*re;(R?R(W[le+0],W[le+1],W[le+2],W[le+3]):l<=W[le+2]&&h<=W[le+3]&&p>=W[le+0]&&v>=W[le+1])?(I[re]=!0,P.push(U[re])):I[re]=!1}}},s.prototype._forEachCell=function(l,h,p,v,x,P,I,R){for(var $=this._convertToCellCoord(l),U=this._convertToCellCoord(h),W=this._convertToCellCoord(p),te=this._convertToCellCoord(v),re=$;re<=W;re++)for(var le=U;le<=te;le++){var ve=this.d*le+re;if((!R||R(this._convertFromCellCoord(re),this._convertFromCellCoord(le),this._convertFromCellCoord(re+1),this._convertFromCellCoord(le+1)))&&x.call(this,l,h,p,v,ve,P,I,R))return}},s.prototype._convertFromCellCoord=function(l){return(l-this.padding)/this.scale},s.prototype._convertToCellCoord=function(l){return Math.max(0,Math.min(this.d-1,Math.floor(l*this.scale)+this.padding))},s.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var l=this.cells,h=c+this.cells.length+1+1,p=0,v=0;v<this.cells.length;v++)p+=this.cells[v].length;var x=new Int32Array(h+p+this.keys.length+this.bboxes.length);x[0]=this.extent,x[1]=this.n,x[2]=this.padding;for(var P=h,I=0;I<l.length;I++){var R=l[I];x[c+I]=P,x.set(R,P),P+=R.length}return x[c+l.length]=P,x.set(this.keys,P),x[c+l.length+1]=P+=this.keys.length,x.set(this.bboxes,P),P+=this.bboxes.length,x.buffer},Pu}(),Mu=Ds(Bf);const Ad={};function yr(c,s,l={}){Object.defineProperty(c,"_classRegistryKey",{value:s,writable:!1}),Ad[s]={klass:c,omit:l.omit||[]}}yr(Object,"Object"),Mu.serialize=function(c,s){const l=c.toArrayBuffer();return s&&s.add(l),{buffer:l}},Mu.deserialize=function(c){return new Mu(c.buffer)},Object.defineProperty(Mu,"name",{value:"Grid"}),yr(Mu,"Grid"),typeof DOMMatrix<"u"&&yr(DOMMatrix,"DOMMatrix"),yr(Pn,"Color"),yr(Error,"Error"),yr(Xo,"Formatted"),yr(Dp,"FormattedSection"),yr(Sl,"AJAXError"),yr(ca,"ResolvedImage"),yr(Au,"StylePropertyFunction"),yr(Sd,"StyleExpression",{omit:["_evaluator"]}),yr(la,"ImageId"),yr(Qa,"ImageVariant"),yr(Pl,"ZoomDependentExpression"),yr(Cu,"ZoomConstantExpression"),yr(Ro,"CompoundExpression",{omit:["_evaluate"]});for(const c in Fa)Ad[Fa[c]._classRegistryKey]||yr(Fa[c],`Expression${c}`);function Qo(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function Ba(c){return self.ImageBitmap&&c instanceof ImageBitmap}function nc(c,s){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp)return c;if(Qo(c)||Ba(c))return s&&s.add(c),c;if(ArrayBuffer.isView(c))return s&&s.add(c.buffer),c;if(c instanceof ImageData)return s&&s.add(c.data.buffer),c;if(Array.isArray(c)){const l=[];for(const h of c)l.push(nc(h,s));return l}if(c instanceof Map){const l={$name:"Map",entries:[]};for(const[h,p]of c.entries())l.entries.push(nc(h),nc(p,s));return l}if(c instanceof Set){const l={$name:"Set"};let h=0;for(const p of c.values())l[++h]=nc(p);return l}if(c instanceof DOMMatrix){const l={$name:"DOMMatrix"},h=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const p of h)l[p]=c[p];return l}if(typeof c=="bigint")return{$name:"BigInt",value:c.toString()};if(typeof c=="object"){const l=c.constructor,h=l._classRegistryKey;if(!h)throw new Error(`Can't serialize object of unregistered class "${l.name}".`);const p=l.serialize?l.serialize(c,s):{};if(!l.serialize){for(const v in c)c.hasOwnProperty(v)&&(Ad[h].omit.indexOf(v)>=0||(p[v]=nc(c[v],s)));c instanceof Error&&(p.message=c.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(p.$name=h),p}throw new Error("can't serialize object of type "+typeof c)}function Gc(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||Qo(c)||Ba(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(Gc);if(typeof c=="object"){const s=c.$name||"Object";if(s==="Map"){const p=c.entries||[],v=new Map;for(let x=0;x<p.length;x+=2)v.set(Gc(p[x]),Gc(p[x+1]));return v}if(s==="Set"){const p=new Set;for(const v of Object.keys(c))v!=="$name"&&p.add(Gc(c[v]));return p}if(s==="DOMMatrix"){let p;return p=c.is2D?[c.a,c.b,c.c,c.d,c.e,c.f]:[c.m11,c.m12,c.m13,c.m14,c.m21,c.m22,c.m23,c.m24,c.m31,c.m32,c.m33,c.m34,c.m41,c.m42,c.m43,c.m44],new DOMMatrix(p)}if(s==="BigInt")return BigInt(c.value);const{klass:l}=Ad[s];if(!l)throw new Error(`Can't deserialize unregistered class "${s}".`);if(l.deserialize)return l.deserialize(c);const h=Object.create(l.prototype);for(const p of Object.keys(c))p!=="$name"&&(h[p]=Gc(c[p]));return h}throw new Error("can't deserialize object of type "+typeof c)}const zr={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519,Osage:c=>c>=66736&&c<=66815,"CJK Unified Ideographs Extension B":c=>c>=131072&&c<=173791};function ic(c){for(const s of c)if($a(s.charCodeAt(0)))return!0;return!1}function wg(c){for(const s of c)if(!Sg(s.charCodeAt(0)))return!1;return!0}function Sg(c){return!(zr.Arabic(c)||zr["Arabic Supplement"](c)||zr["Arabic Extended-A"](c)||zr["Arabic Presentation Forms-A"](c)||zr["Arabic Presentation Forms-B"](c))}function $a(c){return!(c!==746&&c!==747&&(c<4352||!(zr["Bopomofo Extended"](c)||zr.Bopomofo(c)||zr["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||zr["CJK Compatibility Ideographs"](c)||zr["CJK Compatibility"](c)||zr["CJK Radicals Supplement"](c)||zr["CJK Strokes"](c)||!(!zr["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||zr["CJK Unified Ideographs Extension A"](c)||zr["CJK Unified Ideographs"](c)||zr["Enclosed CJK Letters and Months"](c)||zr["Hangul Compatibility Jamo"](c)||zr["Hangul Jamo Extended-A"](c)||zr["Hangul Jamo Extended-B"](c)||zr["Hangul Jamo"](c)||zr["Hangul Syllables"](c)||zr.Hiragana(c)||zr["Ideographic Description Characters"](c)||zr.Kanbun(c)||zr["Kangxi Radicals"](c)||zr["Katakana Phonetic Extensions"](c)||zr.Katakana(c)&&c!==12540||!(!zr["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!zr["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||zr["Unified Canadian Aboriginal Syllabics"](c)||zr["Unified Canadian Aboriginal Syllabics Extended"](c)||zr["Vertical Forms"](c)||zr["Yijing Hexagram Symbols"](c)||zr["Yi Syllables"](c)||zr["Yi Radicals"](c))))}function Hc(c){return!($a(c)||function(s){return!!(zr["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||zr["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||zr["Letterlike Symbols"](s)||zr["Number Forms"](s)||zr["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||zr["Control Pictures"](s)&&s!==9251||zr["Optical Character Recognition"](s)||zr["Enclosed Alphanumerics"](s)||zr["Geometric Shapes"](s)||zr["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||zr["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||zr["CJK Symbols and Punctuation"](s)||zr.Katakana(s)||zr["Private Use Area"](s)||zr["CJK Compatibility Forms"](s)||zr["Small Form Variants"](s)||zr["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(c))}function Wp(c){return zr.Arabic(c)||zr["Arabic Supplement"](c)||zr["Arabic Extended-A"](c)||zr["Arabic Presentation Forms-A"](c)||zr["Arabic Presentation Forms-B"](c)}function Eg(c){return c>=1424&&c<=2303||zr["Arabic Presentation Forms-A"](c)||zr["Arabic Presentation Forms-B"](c)}function Zp(c,s){return!(!s&&Eg(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||zr.Khmer(c))}function Gy(c){for(const s of c)if(Eg(s.charCodeAt(0)))return!0;return!1}const Pd="deferred",ol="loading",Md="loaded";let Id=null,no="unavailable",sc=null;const al=function(c){c&&typeof c=="string"&&c.indexOf("NetworkError")>-1&&(no="error"),Id&&Id(c)};function $f(){Dh.fire(new Hl("pluginStateChange",{pluginStatus:no,pluginURL:sc}))}const Dh=new Zl,us=function(){return no},Vf=function(){if(no!==Pd||!sc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");no=ol,$f(),sc&&ql({url:sc},c=>{c?al(c):(no=Md,$f())})},Sa={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>no===Md||Sa.applyArabicShaping!=null,isLoading:()=>no===ol,setState(c){no=c.pluginStatus,sc=c.pluginURL},isParsed:()=>Sa.applyArabicShaping!=null&&Sa.processBidirectionalText!=null&&Sa.processStyledBidirectionalText!=null,getPluginURL:()=>sc};class ni{constructor(s,l){this.zoom=s,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.transition=l.transition,this.pitch=l.pitch,this.brightness=l.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(s){return function(l,h){for(const p of l)if(!Zp(p.charCodeAt(0),h))return!1;return!0}(s,Sa.isLoaded())}}class Iu{constructor(s,l,h,p){this.property=s,this.value=l,this.expression=function(v,x,P,I){if(Oh(v))return new Au(v,x);if(Ed(v)||Array.isArray(v)&&v.length>0){const R=Rh(v,x,P,I);if(R.result==="error")throw new Error(R.value.map($=>`${$.key}: ${$.message}`).join(", "));return R.value}{let R=v;return typeof v=="string"&&x.type==="color"&&(R=Pn.parse(v)),{kind:"constant",configDependencies:new Set,evaluate:()=>R}}}(l===void 0?s.specification.default:l,s.specification,h,p)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(s,l,h){return this.property.possiblyEvaluate(this,s,l,h)}}class oc{constructor(s,l,h){this.property=s,this.value=new Iu(s,void 0,l,h)}transitioned(s,l){return new Ms(this.property,this.value,l,pt({},s.transition,this.transition),s.now)}untransitioned(){return new Ms(this.property,this.value,null,{},0)}}class ku{constructor(s,l,h){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues),this._scope=l,this._options=h,this.configDependencies=new Set}getValue(s){return nn(this._values[s].value.value)}setValue(s,l){this._values.hasOwnProperty(s)||(this._values[s]=new oc(this._values[s].property,this._scope,this._options)),this._values[s].value=new Iu(this._values[s].property,l===null?void 0:nn(l),this._scope,this._options),this._values[s].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[s].value.expression.configDependencies]))}setTransitionOrValue(s,l){l&&(this._options=l);const h=this._properties.properties;if(s)for(const p in s){const v=s[p];if(p.endsWith("-transition")){const x=p.slice(0,-11);h[x]&&this.setTransition(x,v)}else h.hasOwnProperty(p)&&this.setValue(p,v)}}getTransition(s){return nn(this._values[s].transition)}setTransition(s,l){this._values.hasOwnProperty(s)||(this._values[s]=new oc(this._values[s].property)),this._values[s].transition=nn(l)||void 0}serialize(){const s={};for(const l of Object.keys(this._values)){const h=this.getValue(l);h!==void 0&&(s[l]=h);const p=this.getTransition(l);p!==void 0&&(s[`${l}-transition`]=p)}return s}transitioned(s,l){const h=new io(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].transitioned(s,l._values[p]);return h}untransitioned(){const s=new io(this._properties);for(const l of Object.keys(this._values))s._values[l]=this._values[l].untransitioned();return s}}class Ms{constructor(s,l,h,p,v){const x=p.delay||0,P=p.duration||0;v=v||0,this.property=s,this.value=l,this.begin=v+x,this.end=this.begin+P,s.specification.transition&&(p.delay||p.duration)&&(this.prior=h)}possiblyEvaluate(s,l,h){const p=s.now||0,v=this.value.possiblyEvaluate(s,l,h),x=this.prior;if(x){if(p>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(p<this.begin)return x.possiblyEvaluate(s,l,h);{const P=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(s,l,h),v,$e(P))}}return v}}class io{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)}possiblyEvaluate(s,l,h){const p=new Ml(this._properties);for(const v of Object.keys(this._values))p._values[v]=this._values[v].possiblyEvaluate(s,l,h);return p}hasTransition(){for(const s of Object.keys(this._values))if(this._values[s].prior)return!0;return!1}}class Eo{constructor(s,l,h){this._properties=s,this._values=Object.create(s.defaultPropertyValues),this._scope=l,this._options=h,this.configDependencies=new Set}getValue(s){return nn(this._values[s].value)}setValue(s,l){this._values[s]=new Iu(this._values[s].property,l===null?void 0:nn(l),this._scope,this._options),this._values[s].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[s].expression.configDependencies]))}serialize(){const s={};for(const l of Object.keys(this._values)){const h=this.getValue(l);h!==void 0&&(s[l]=h)}return s}possiblyEvaluate(s,l,h){const p=new Ml(this._properties);for(const v of Object.keys(this._values))p._values[v]=this._values[v].possiblyEvaluate(s,l,h);return p}}class Wc{constructor(s,l,h){this.property=s,this.value=l,this.parameters=h}isConstant(){return this.value.kind==="constant"}constantOr(s){return this.value.kind==="constant"?this.value.value:s}evaluate(s,l,h,p){return this.property.evaluate(this.value,this.parameters,s,l,h,p)}}class Ml{constructor(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)}get(s){return this._values[s]}}class er{constructor(s){this.specification=s}possiblyEvaluate(s,l){return s.expression.evaluate(l)}interpolate(s,l,h){const p=fh[this.specification.type];return p?p(s,l,h):s}}class br{constructor(s,l){this.specification=s,this.overrides=l}possiblyEvaluate(s,l,h,p){return new Wc(this,s.expression.kind==="constant"||s.expression.kind==="camera"?{kind:"constant",value:s.expression.evaluate(l,null,{},h,p)}:s.expression,l)}interpolate(s,l,h){if(s.value.kind!=="constant"||l.value.kind!=="constant")return s;if(s.value.value===void 0||l.value.value===void 0)return new Wc(this,{kind:"constant",value:void 0},s.parameters);const p=fh[this.specification.type];return p?new Wc(this,{kind:"constant",value:p(s.value.value,l.value.value,h)},s.parameters):s}evaluate(s,l,h,p,v,x){return s.kind==="constant"?s.value:s.evaluate(l,h,p,v,x)}}class $s{constructor(s){this.specification=s}possiblyEvaluate(s,l,h,p){return!!s.expression.evaluate(l,null,{},h,p)}interpolate(){return!1}}class qi{constructor(s){this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new ni(0,{});for(const h in s){const p=s[h];p.specification.overridable&&this.overridableProperties.push(h);const v=this.defaultPropertyValues[h]=new Iu(p,void 0),x=this.defaultTransitionablePropertyValues[h]=new oc(p);this.defaultTransitioningPropertyValues[h]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=v.possiblyEvaluate(l)}}}yr(br,"DataDrivenProperty"),yr(er,"DataConstantProperty"),yr($s,"ColorRampProperty");var ft=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-wall-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white"},"sky-atmosphere-color":{"type":"color","default":"white"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Va(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function Ua(c){if(Array.isArray(c))return c.map(Ua);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const s={};for(const l in c)s[l]=Ua(c[l]);return s}return Va(c)}function fa(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const s of c.slice(1))if(!fa(s)&&typeof s!="boolean")return!1;return!0;default:return!0}}function kd(c,s="",l=null,h="fill"){if(c==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};fa(c)||(c=Uf(c));const p=c;let v=!0;try{v=function($){if(!Od($))return $;let U=Ua($);return Kp(U),U=Xp(U),U}(p)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(p,null,2)}
        `)}let x=null,P=null;if(h!=="background"&&h!=="sky"&&h!=="slot"){P=ft[`filter_${h}`];const $=Td(v,P,s,l);if($.result==="error")throw new Error($.value.map(U=>`${U.key}: ${U.message}`).join(", "));x=(U,W,te)=>$.value.evaluate(U,W,{},te)}let I=null,R=null;if(v!==p){const $=Td(p,P,s,l);if($.result==="error")throw new Error($.value.map(U=>`${U.key}: ${U.message}`).join(", "));I=(U,W,te,re,le)=>$.value.evaluate(U,W,{},te,void 0,void 0,re,le),R=!Su($.value.expression)}return{filter:x,dynamicFilter:I||void 0,needGeometry:Tg(v),needFeature:!!R}}function Xp(c){if(!Array.isArray(c))return c;const s=function(l){if(Hy.has(l[0])){for(let h=1;h<l.length;h++)if(Od(l[h]))return!0}return l}(c);return s===!0?s:s.map(l=>Xp(l))}function Kp(c){let s=!1;const l=[];if(c[0]==="case"){for(let h=1;h<c.length-1;h+=2)s=s||Od(c[h]),l.push(c[h+1]);l.push(c[c.length-1])}else if(c[0]==="match"){s=s||Od(c[1]);for(let h=2;h<c.length-1;h+=2)l.push(c[h+1]);l.push(c[c.length-1])}else if(c[0]==="step"){s=s||Od(c[1]);for(let h=1;h<c.length-1;h+=2)l.push(c[h+1])}s&&(c.length=0,c.push("any",...l));for(let h=1;h<c.length;h++)Kp(c[h])}function Od(c){if(!Array.isArray(c))return!1;if((s=c[0])==="pitch"||s==="distance-from-center")return!0;var s;for(let l=1;l<c.length;l++)if(Od(c[l]))return!0;return!1}const Hy=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Wy(c,s){return c<s?-1:c>s?1:0}function Tg(c){if(!Array.isArray(c))return!1;if(c[0]==="within"||c[0]==="distance")return!0;for(let s=1;s<c.length;s++)if(Tg(c[s]))return!0;return!1}function Uf(c){if(!c)return!0;const s=c[0];return c.length<=1?s!=="any":s==="=="?Yp(c[1],c[2],"=="):s==="!="?Ou(Yp(c[1],c[2],"==")):s==="<"||s===">"||s==="<="||s===">="?Yp(c[1],c[2],s):s==="any"?(l=c.slice(1),["any"].concat(l.map(Uf))):s==="all"?["all"].concat(c.slice(1).map(Uf)):s==="none"?["all"].concat(c.slice(1).map(Uf).map(Ou)):s==="in"?Jp(c[1],c.slice(2)):s==="!in"?Ou(Jp(c[1],c.slice(2))):s==="has"?Cg(c[1]):s!=="!has"||Ou(Cg(c[1]));var l}function Yp(c,s,l){switch(c){case"$type":return[`filter-type-${l}`,s];case"$id":return[`filter-id-${l}`,s];default:return[`filter-${l}`,c,s]}}function Jp(c,s){if(s.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(l=>typeof l!=typeof s[0])?["filter-in-large",c,["literal",s.sort(Wy)]]:["filter-in-small",c,["literal",s]]}}function Cg(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function Ou(c){return["!",c]}const Nh="";function ac(c,s){return s?`${c}${Nh}${s}`:c}const zh="-transition",Zc=new Set(["fill","line","background","hillshade","raster"]);class To extends Zl{constructor(s,l,h,p,v){if(super(),this.id=s.id,this.fqid=ac(this.id,h),this.type=s.type,this.scope=h,this.lut=p,this.options=v,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,s.type!=="custom"){if(this.metadata=s.metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type&&s.type!=="background"&&s.type!=="sky"&&s.type!=="slot"){this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter;const x=Td(this.filter,ft[`filter_${s.type}`]);x.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...x.value.configDependencies]))}if(s.slot&&(this.slot=s.slot),l.layout&&(this._unevaluatedLayout=new Eo(l.layout,this.scope,v),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),l.paint){this._transitionablePaint=new ku(l.paint,this.scope,v);for(const x in s.paint)this.setPaintProperty(x,s.paint[x]);for(const x in s.layout)this.setLayoutProperty(x,s.layout[x]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ml(l.paint)}}}onAdd(s){}onRemove(s){}isDraped(s){return!this.is3D(!0)&&Zc.has(this.type)}getLayoutProperty(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)}setLayoutProperty(s,l){if(this.type==="custom"&&s==="visibility")return void(this.visibility=l);const h=this._unevaluatedLayout;h._properties.properties[s]&&(h.setValue(s,l),this.configDependencies=new Set([...this.configDependencies,...h.configDependencies]),s==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(s){return s.endsWith(zh)?this._transitionablePaint.getTransition(s.slice(0,-11)):this._transitionablePaint.getValue(s)}setPaintProperty(s,l){const h=this._transitionablePaint,p=h._properties.properties;if(s.endsWith(zh)){const U=s.slice(0,-11);return p[U]&&h.setTransition(U,l||void 0),!1}if(!p[s])return!1;const v=h._values[s],x=v.value.isDataDriven(),P=v.value;h.setValue(s,l),this.configDependencies=new Set([...this.configDependencies,...h.configDependencies]),this._handleSpecialPaintPropertyUpdate(s);const I=h._values[s].value,R=I.isDataDriven(),$=s.endsWith("pattern")||s==="line-dasharray";return R||x||$||this._handleOverridablePaintPropertyUpdate(s,P,I)}_handleSpecialPaintPropertyUpdate(s){}getProgramIds(){return null}getDefaultProgramParams(s,l,h){return null}_handleOverridablePaintPropertyUpdate(s,l,h){return!1}isHidden(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"}updateTransitions(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(s,l){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,l)}serialize(){return Jr({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(s,l)=>!(s===void 0||l==="layout"&&!Object.keys(s).length||l==="paint"&&!Object.keys(s).length))}is3D(s){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const s in this.paint._values){const l=this.paint.get(s);if(l instanceof Wc&&ys(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}compileFilter(s){this._filterCompiled||(this._featureFilter=kd(this.filter,this.scope,s),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(s){this._stats&&(s.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(s){}queryIntersectsFeature(s,l,h,p,v,x,P,I,R){}}const Zy={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Fh{constructor(s,l){this._structArray=s,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ai{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(s,l){return s._trim(),l&&(s.isTransferred=!0,l.add(s.arrayBuffer)),{length:s.length,arrayBuffer:s.arrayBuffer}}static deserialize(s){const l=Object.create(this.prototype);return l.arrayBuffer=s.arrayBuffer,l.length=s.length,l.capacity=s.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(s){this.reserve(s),this.length=s}reserve(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...s){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...s){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function qn(c,s=1){let l=0,h=0;return{members:c.map(p=>{const v=Zy[p.type].BYTES_PER_ELEMENT,x=l=qf(l,Math.max(s,v)),P=p.components||1;return h=Math.max(h,v),l+=v*P,{name:p.name,type:p.type,components:P,offset:x}}),size:qf(l,Math.max(h,s)),alignment:s}}function qf(c,s){return Math.ceil(c/s)*s}class lc extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l){const h=this.length;return this.resize(h+1),this.emplace(h,s,l)}emplace(s,l,h){const p=2*s;return this.int16[p+0]=l,this.int16[p+1]=h,s}}lc.prototype.bytesPerElement=4,yr(lc,"StructArrayLayout2i4");class Gf extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,s,l,h)}emplace(s,l,h,p){const v=3*s;return this.int16[v+0]=l,this.int16[v+1]=h,this.int16[v+2]=p,s}}Gf.prototype.bytesPerElement=6,yr(Gf,"StructArrayLayout3i6");class Lu extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,h,p){const v=this.length;return this.resize(v+1),this.emplace(v,s,l,h,p)}emplace(s,l,h,p,v){const x=4*s;return this.int16[x+0]=l,this.int16[x+1]=h,this.int16[x+2]=p,this.int16[x+3]=v,s}}Lu.prototype.bytesPerElement=8,yr(Lu,"StructArrayLayout4i8");class Bh extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s){const l=this.length;return this.resize(l+1),this.emplace(l,s)}emplace(s,l){return this.float32[1*s+0]=l,s}}Bh.prototype.bytesPerElement=4,yr(Bh,"StructArrayLayout1f4");class Hf extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,s,l,h)}emplace(s,l,h,p){const v=4*s,x=2*s;return this.int16[v+0]=l,this.int16[v+1]=h,this.float32[x+1]=p,s}}Hf.prototype.bytesPerElement=8,yr(Hf,"StructArrayLayout2i1f8");class $h extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,s,l,h)}emplace(s,l,h,p){const v=4*s;return this.int16[v+0]=l,this.int16[v+1]=h,this.int16[v+2]=p,s}}$h.prototype.bytesPerElement=8,yr($h,"StructArrayLayout3i8");class Ag extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,h,p,v){const x=this.length;return this.resize(x+1),this.emplace(x,s,l,h,p,v)}emplace(s,l,h,p,v,x){const P=5*s;return this.int16[P+0]=l,this.int16[P+1]=h,this.int16[P+2]=p,this.int16[P+3]=v,this.int16[P+4]=x,s}}Ag.prototype.bytesPerElement=10,yr(Ag,"StructArrayLayout5i10");class Qp extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,h,p,v,x,P){const I=this.length;return this.resize(I+1),this.emplace(I,s,l,h,p,v,x,P)}emplace(s,l,h,p,v,x,P,I){const R=6*s,$=12*s,U=3*s;return this.int16[R+0]=l,this.int16[R+1]=h,this.uint8[$+4]=p,this.uint8[$+5]=v,this.uint8[$+6]=x,this.uint8[$+7]=P,this.float32[U+2]=I,s}}Qp.prototype.bytesPerElement=12,yr(Qp,"StructArrayLayout2i4ub1f12");class Il extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,s,l,h)}emplace(s,l,h,p){const v=3*s;return this.float32[v+0]=l,this.float32[v+1]=h,this.float32[v+2]=p,s}}Il.prototype.bytesPerElement=12,yr(Il,"StructArrayLayout3f12");class cc extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,h,p,v){const x=this.length;return this.resize(x+1),this.emplace(x,s,l,h,p,v)}emplace(s,l,h,p,v,x){const P=6*s,I=3*s;return this.uint16[P+0]=l,this.uint16[P+1]=h,this.uint16[P+2]=p,this.uint16[P+3]=v,this.float32[I+2]=x,s}}cc.prototype.bytesPerElement=12,yr(cc,"StructArrayLayout4ui1f12");class Ld extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,h,p){const v=this.length;return this.resize(v+1),this.emplace(v,s,l,h,p)}emplace(s,l,h,p,v){const x=4*s;return this.uint16[x+0]=l,this.uint16[x+1]=h,this.uint16[x+2]=p,this.uint16[x+3]=v,s}}Ld.prototype.bytesPerElement=8,yr(Ld,"StructArrayLayout4ui8");class Rd extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,h,p,v,x){const P=this.length;return this.resize(P+1),this.emplace(P,s,l,h,p,v,x)}emplace(s,l,h,p,v,x,P){const I=6*s;return this.int16[I+0]=l,this.int16[I+1]=h,this.int16[I+2]=p,this.int16[I+3]=v,this.int16[I+4]=x,this.int16[I+5]=P,s}}Rd.prototype.bytesPerElement=12,yr(Rd,"StructArrayLayout6i12");class Vh extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,h,p,v,x,P,I,R,$,U,W){const te=this.length;return this.resize(te+1),this.emplace(te,s,l,h,p,v,x,P,I,R,$,U,W)}emplace(s,l,h,p,v,x,P,I,R,$,U,W,te){const re=12*s;return this.int16[re+0]=l,this.int16[re+1]=h,this.int16[re+2]=p,this.int16[re+3]=v,this.uint16[re+4]=x,this.uint16[re+5]=P,this.uint16[re+6]=I,this.uint16[re+7]=R,this.int16[re+8]=$,this.int16[re+9]=U,this.int16[re+10]=W,this.int16[re+11]=te,s}}Vh.prototype.bytesPerElement=24,yr(Vh,"StructArrayLayout4i4ui4i24");class pa extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,h,p,v,x){const P=this.length;return this.resize(P+1),this.emplace(P,s,l,h,p,v,x)}emplace(s,l,h,p,v,x,P){const I=10*s,R=5*s;return this.int16[I+0]=l,this.int16[I+1]=h,this.int16[I+2]=p,this.float32[R+2]=v,this.float32[R+3]=x,this.float32[R+4]=P,s}}pa.prototype.bytesPerElement=20,yr(pa,"StructArrayLayout3i3f20");class so extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,h,p){const v=this.length;return this.resize(v+1),this.emplace(v,s,l,h,p)}emplace(s,l,h,p,v){const x=4*s;return this.float32[x+0]=l,this.float32[x+1]=h,this.float32[x+2]=p,this.float32[x+3]=v,s}}so.prototype.bytesPerElement=16,yr(so,"StructArrayLayout4f16");class Wf extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s){const l=this.length;return this.resize(l+1),this.emplace(l,s)}emplace(s,l){return this.uint32[1*s+0]=l,s}}Wf.prototype.bytesPerElement=4,yr(Wf,"StructArrayLayout1ul4");class kl extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l){const h=this.length;return this.resize(h+1),this.emplace(h,s,l)}emplace(s,l,h){const p=2*s;return this.uint16[p+0]=l,this.uint16[p+1]=h,s}}kl.prototype.bytesPerElement=4,yr(kl,"StructArrayLayout2ui4");class em extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,h,p,v,x,P,I,R,$,U,W,te){const re=this.length;return this.resize(re+1),this.emplace(re,s,l,h,p,v,x,P,I,R,$,U,W,te)}emplace(s,l,h,p,v,x,P,I,R,$,U,W,te,re){const le=20*s,ve=10*s;return this.int16[le+0]=l,this.int16[le+1]=h,this.int16[le+2]=p,this.int16[le+3]=v,this.int16[le+4]=x,this.float32[ve+3]=P,this.float32[ve+4]=I,this.float32[ve+5]=R,this.float32[ve+6]=$,this.int16[le+14]=U,this.uint32[ve+8]=W,this.uint16[le+18]=te,this.uint16[le+19]=re,s}}em.prototype.bytesPerElement=40,yr(em,"StructArrayLayout5i4f1i1ul2ui40");class Zf extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,h,p,v,x,P){const I=this.length;return this.resize(I+1),this.emplace(I,s,l,h,p,v,x,P)}emplace(s,l,h,p,v,x,P,I){const R=8*s;return this.int16[R+0]=l,this.int16[R+1]=h,this.int16[R+2]=p,this.int16[R+4]=v,this.int16[R+5]=x,this.int16[R+6]=P,this.int16[R+7]=I,s}}Zf.prototype.bytesPerElement=16,yr(Zf,"StructArrayLayout3i2i2i16");class Uh extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,h,p,v){const x=this.length;return this.resize(x+1),this.emplace(x,s,l,h,p,v)}emplace(s,l,h,p,v,x){const P=4*s,I=8*s;return this.float32[P+0]=l,this.float32[P+1]=h,this.float32[P+2]=p,this.int16[I+6]=v,this.int16[I+7]=x,s}}Uh.prototype.bytesPerElement=16,yr(Uh,"StructArrayLayout2f1f2i16");class Xf extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,h,p,v,x){const P=this.length;return this.resize(P+1),this.emplace(P,s,l,h,p,v,x)}emplace(s,l,h,p,v,x,P){const I=20*s,R=5*s;return this.uint8[I+0]=l,this.uint8[I+1]=h,this.float32[R+1]=p,this.float32[R+2]=v,this.float32[R+3]=x,this.float32[R+4]=P,s}}Xf.prototype.bytesPerElement=20,yr(Xf,"StructArrayLayout2ub4f20");class bs extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,s,l,h)}emplace(s,l,h,p){const v=3*s;return this.uint16[v+0]=l,this.uint16[v+1]=h,this.uint16[v+2]=p,s}}bs.prototype.bytesPerElement=6,yr(bs,"StructArrayLayout3ui6");class Kf extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s,l,h,p,v,x,P,I,R,$,U,W,te,re,le,ve,_e,Ce,Ee,ue,we){const Te=this.length;return this.resize(Te+1),this.emplace(Te,s,l,h,p,v,x,P,I,R,$,U,W,te,re,le,ve,_e,Ce,Ee,ue,we)}emplace(s,l,h,p,v,x,P,I,R,$,U,W,te,re,le,ve,_e,Ce,Ee,ue,we,Te){const Ie=30*s,Ge=15*s,Qe=60*s;return this.int16[Ie+0]=l,this.int16[Ie+1]=h,this.int16[Ie+2]=p,this.float32[Ge+2]=v,this.float32[Ge+3]=x,this.uint16[Ie+8]=P,this.uint16[Ie+9]=I,this.uint32[Ge+5]=R,this.uint32[Ge+6]=$,this.uint32[Ge+7]=U,this.uint16[Ie+16]=W,this.uint16[Ie+17]=te,this.uint16[Ie+18]=re,this.float32[Ge+10]=le,this.float32[Ge+11]=ve,this.uint8[Qe+48]=_e,this.uint8[Qe+49]=Ce,this.uint8[Qe+50]=Ee,this.uint32[Ge+13]=ue,this.int16[Ie+28]=we,this.uint8[Qe+58]=Te,s}}Kf.prototype.bytesPerElement=60,yr(Kf,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Yf extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s,l,h,p,v,x,P,I,R,$,U,W,te,re,le,ve,_e,Ce,Ee,ue,we,Te,Ie,Ge,Qe,it,ct,St,Vt,Nt,Bt,Xt,xt){const Ft=this.length;return this.resize(Ft+1),this.emplace(Ft,s,l,h,p,v,x,P,I,R,$,U,W,te,re,le,ve,_e,Ce,Ee,ue,we,Te,Ie,Ge,Qe,it,ct,St,Vt,Nt,Bt,Xt,xt)}emplace(s,l,h,p,v,x,P,I,R,$,U,W,te,re,le,ve,_e,Ce,Ee,ue,we,Te,Ie,Ge,Qe,it,ct,St,Vt,Nt,Bt,Xt,xt,Ft){const _t=20*s,wt=40*s,Yt=80*s;return this.float32[_t+0]=l,this.float32[_t+1]=h,this.int16[wt+4]=p,this.int16[wt+5]=v,this.int16[wt+6]=x,this.int16[wt+7]=P,this.int16[wt+8]=I,this.int16[wt+9]=R,this.int16[wt+10]=$,this.int16[wt+11]=U,this.int16[wt+12]=W,this.uint16[wt+13]=te,this.uint16[wt+14]=re,this.uint16[wt+15]=le,this.uint16[wt+16]=ve,this.uint16[wt+17]=_e,this.uint16[wt+18]=Ce,this.uint16[wt+19]=Ee,this.uint16[wt+20]=ue,this.uint16[wt+21]=we,this.uint16[wt+22]=Te,this.uint16[wt+23]=Ie,this.uint16[wt+24]=Ge,this.uint16[wt+25]=Qe,this.uint16[wt+26]=it,this.uint16[wt+27]=ct,this.uint32[_t+14]=St,this.float32[_t+15]=Vt,this.float32[_t+16]=Nt,this.float32[_t+17]=Bt,this.float32[_t+18]=Xt,this.uint8[Yt+76]=xt,this.uint16[wt+39]=Ft,s}}Yf.prototype.bytesPerElement=80,yr(Yf,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Ru extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,h,p,v){const x=this.length;return this.resize(x+1),this.emplace(x,s,l,h,p,v)}emplace(s,l,h,p,v,x){const P=5*s;return this.float32[P+0]=l,this.float32[P+1]=h,this.float32[P+2]=p,this.float32[P+3]=v,this.float32[P+4]=x,s}}Ru.prototype.bytesPerElement=20,yr(Ru,"StructArrayLayout5f20");class qh extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,h,p,v,x,P){const I=this.length;return this.resize(I+1),this.emplace(I,s,l,h,p,v,x,P)}emplace(s,l,h,p,v,x,P,I){const R=7*s;return this.float32[R+0]=l,this.float32[R+1]=h,this.float32[R+2]=p,this.float32[R+3]=v,this.float32[R+4]=x,this.float32[R+5]=P,this.float32[R+6]=I,s}}qh.prototype.bytesPerElement=28,yr(qh,"StructArrayLayout7f28");class tm extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,h,p,v,x,P,I,R,$,U){const W=this.length;return this.resize(W+1),this.emplace(W,s,l,h,p,v,x,P,I,R,$,U)}emplace(s,l,h,p,v,x,P,I,R,$,U,W){const te=11*s;return this.float32[te+0]=l,this.float32[te+1]=h,this.float32[te+2]=p,this.float32[te+3]=v,this.float32[te+4]=x,this.float32[te+5]=P,this.float32[te+6]=I,this.float32[te+7]=R,this.float32[te+8]=$,this.float32[te+9]=U,this.float32[te+10]=W,s}}tm.prototype.bytesPerElement=44,yr(tm,"StructArrayLayout11f44");class Jf extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,h,p,v,x,P,I,R){const $=this.length;return this.resize($+1),this.emplace($,s,l,h,p,v,x,P,I,R)}emplace(s,l,h,p,v,x,P,I,R,$){const U=9*s;return this.float32[U+0]=l,this.float32[U+1]=h,this.float32[U+2]=p,this.float32[U+3]=v,this.float32[U+4]=x,this.float32[U+5]=P,this.float32[U+6]=I,this.float32[U+7]=R,this.float32[U+8]=$,s}}Jf.prototype.bytesPerElement=36,yr(Jf,"StructArrayLayout9f36");class ju extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l){const h=this.length;return this.resize(h+1),this.emplace(h,s,l)}emplace(s,l,h){const p=2*s;return this.float32[p+0]=l,this.float32[p+1]=h,s}}ju.prototype.bytesPerElement=8,yr(ju,"StructArrayLayout2f8");class rm extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,h,p){const v=this.length;return this.resize(v+1),this.emplace(v,s,l,h,p)}emplace(s,l,h,p,v){const x=6*s;return this.uint32[3*s+0]=l,this.uint16[x+2]=h,this.uint16[x+3]=p,this.uint16[x+4]=v,s}}rm.prototype.bytesPerElement=12,yr(rm,"StructArrayLayout1ul3ui12");class Qf extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s){const l=this.length;return this.resize(l+1),this.emplace(l,s)}emplace(s,l){return this.uint16[1*s+0]=l,s}}Qf.prototype.bytesPerElement=2,yr(Qf,"StructArrayLayout1ui2");class fo extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,h,p,v,x,P,I,R,$,U,W,te,re,le,ve){const _e=this.length;return this.resize(_e+1),this.emplace(_e,s,l,h,p,v,x,P,I,R,$,U,W,te,re,le,ve)}emplace(s,l,h,p,v,x,P,I,R,$,U,W,te,re,le,ve,_e){const Ce=16*s;return this.float32[Ce+0]=l,this.float32[Ce+1]=h,this.float32[Ce+2]=p,this.float32[Ce+3]=v,this.float32[Ce+4]=x,this.float32[Ce+5]=P,this.float32[Ce+6]=I,this.float32[Ce+7]=R,this.float32[Ce+8]=$,this.float32[Ce+9]=U,this.float32[Ce+10]=W,this.float32[Ce+11]=te,this.float32[Ce+12]=re,this.float32[Ce+13]=le,this.float32[Ce+14]=ve,this.float32[Ce+15]=_e,s}}fo.prototype.bytesPerElement=64,yr(fo,"StructArrayLayout16f64");class po extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,h,p,v,x,P){const I=this.length;return this.resize(I+1),this.emplace(I,s,l,h,p,v,x,P)}emplace(s,l,h,p,v,x,P,I){const R=10*s,$=5*s;return this.uint16[R+0]=l,this.uint16[R+1]=h,this.uint16[R+2]=p,this.uint16[R+3]=v,this.float32[$+2]=x,this.float32[$+3]=P,this.float32[$+4]=I,s}}po.prototype.bytesPerElement=20,yr(po,"StructArrayLayout4ui3f20");class nm extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s){const l=this.length;return this.resize(l+1),this.emplace(l,s)}emplace(s,l){return this.int16[1*s+0]=l,s}}nm.prototype.bytesPerElement=2,yr(nm,"StructArrayLayout1i2");class ep extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(s){const l=this.length;return this.resize(l+1),this.emplace(l,s)}emplace(s,l){return this.uint8[1*s+0]=l,s}}ep.prototype.bytesPerElement=1,yr(ep,"StructArrayLayout1ub1");class Pg extends Fh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Pg.prototype.size=40;class tp extends em{get(s){return new Pg(this,s)}}yr(tp,"CollisionBoxArray");class Mg extends Fh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(s){this._structArray.uint8[this._pos1+49]=s}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(s){this._structArray.uint8[this._pos1+50]=s}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(s){this._structArray.uint32[this._pos4+13]=s}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(s){this._structArray.uint8[this._pos1+58]=s}}Mg.prototype.size=60;class im extends Kf{get(s){return new Mg(this,s)}}yr(im,"PlacedSymbolArray");class Ig extends Fh{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(s){this._structArray.uint32[this._pos4+14]=s}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(s){this._structArray.float32[this._pos4+18]=s}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Ig.prototype.size=80;class sm extends Yf{get(s){return new Ig(this,s)}}yr(sm,"SymbolInstanceArray");class om extends Bh{getoffsetX(s){return this.float32[1*s+0]}}yr(om,"GlyphOffsetArray");class kg extends lc{getx(s){return this.int16[2*s+0]}gety(s){return this.int16[2*s+1]}}yr(kg,"SymbolLineVertexArray");class am extends Fh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}am.prototype.size=12;class lm extends rm{get(s){return new am(this,s)}}yr(lm,"FeatureIndexArray");class Og extends kl{geta_centroid_pos0(s){return this.uint16[2*s+0]}geta_centroid_pos1(s){return this.uint16[2*s+1]}}yr(Og,"FillExtrusionCentroidArray");class cm extends Fh{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}cm.prototype.size=6;class rp extends Gf{get(s){return new cm(this,s)}}yr(rp,"FillExtrusionWallArray");const Q_=qn([{name:"a_pos",components:2,type:"Int16"}],4),Xy=qn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ji{constructor(s=[]){this.segments=s}_prepareSegment(s,l,h,p){let v=this.segments[this.segments.length-1];return s>ji.MAX_VERTEX_ARRAY_LENGTH&&sn(`Max vertices per segment is ${ji.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${s}`),(!v||v.vertexLength+s>ji.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==p)&&(v={vertexOffset:l,primitiveOffset:h,vertexLength:0,primitiveLength:0},p!==void 0&&(v.sortKey=p),this.segments.push(v)),v}prepareSegment(s,l,h,p){return this._prepareSegment(s,l.length,h.length,p)}get(){return this.segments}destroy(){for(const s of this.segments)for(const l in s.vaos)s.vaos[l].destroy()}static simpleSegment(s,l,h,p){return new ji([{vertexOffset:s,primitiveOffset:l,vertexLength:h,primitiveLength:p,vaos:{},sortKey:0}])}}function Lg(c,s){return 256*(c=rt(Math.floor(c),0,255))+rt(Math.floor(s),0,255)}ji.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,yr(ji,"SegmentVector");const um=qn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Ea=qn([{name:"a_pattern_b",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),e0=qn([{name:"a_dash",components:4,type:"Uint16"}]);class jd{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(s,l,h,p){this.ids.push(dm(s)),this.positions.push(l,h,p)}eachPosition(s,l){const h=dm(s);let p=0,v=this.ids.length-1;for(;p<v;){const x=p+v>>1;this.ids[x]>=h?v=x:p=x+1}for(;this.ids[p]===h;)l(this.positions[3*p],this.positions[3*p+1],this.positions[3*p+2]),p++}static serialize(s,l){const h=new Float64Array(s.ids),p=new Uint32Array(s.positions);return np(h,p,0,h.length-1),l&&(l.add(h.buffer),l.add(p.buffer)),{ids:h,positions:p}}static deserialize(s){const l=new jd;let h;l.ids=s.ids,l.positions=s.positions;for(const p of l.ids)p!==h&&l.uniqueIds.push(p),h=p;return l.indexed=!0,l}}function dm(c){const s=+c;return!isNaN(s)&&Number.MIN_SAFE_INTEGER<=s&&s<=Number.MAX_SAFE_INTEGER?s:ko(String(c))}function np(c,s,l,h){for(;l<h;){const p=c[l+h>>1];let v=l-1,x=h+1;for(;;){do v++;while(c[v]<p);do x--;while(c[x]>p);if(v>=x)break;Gh(c,v,x),Gh(s,3*v,3*x),Gh(s,3*v+1,3*x+1),Gh(s,3*v+2,3*x+2)}x-l<h-x?(np(c,s,l,x),l=x+1):(np(c,s,x+1,h),h=x)}}function Gh(c,s,l){const h=c[s];c[s]=c[l],c[l]=h}yr(jd,"FeaturePositionMap");class Ta{constructor(s){this.gl=s.gl,this.initialized=!1}fetchUniformLocation(s,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(s,l),this.initialized=!0),!!this.location}set(s,l,h){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class mo extends Ta{constructor(s){super(s),this.current=0}set(s,l,h){this.fetchUniformLocation(s,l)&&this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))}}class ws extends Ta{constructor(s){super(s),this.current=0}set(s,l,h){this.fetchUniformLocation(s,l)&&this.current!==h&&(this.current=h,this.gl.uniform1f(this.location,h))}}class Ol extends Ta{constructor(s){super(s),this.current=[0,0]}set(s,l,h){this.fetchUniformLocation(s,l)&&(h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1])))}}class Du extends Ta{constructor(s){super(s),this.current=[0,0,0]}set(s,l,h){this.fetchUniformLocation(s,l)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2])))}}class go extends Ta{constructor(s){super(s),this.current=[0,0,0,0]}set(s,l,h){this.fetchUniformLocation(s,l)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]&&h[3]===this.current[3]||(this.current=h,this.gl.uniform4f(this.location,h[0],h[1],h[2],h[3])))}}class Ky extends Ta{constructor(s){super(s),this.current=Pn.transparent.toRenderColor(null)}set(s,l,h){this.fetchUniformLocation(s,l)&&(h.r===this.current.r&&h.g===this.current.g&&h.b===this.current.b&&h.a===this.current.a||(this.current=h,this.gl.uniform4f(this.location,h.r,h.g,h.b,h.a)))}}const hn=new Float32Array(16);class uc extends Ta{constructor(s){super(s),this.current=hn}set(s,l,h){if(this.fetchUniformLocation(s,l)){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(let p=1;p<16;p++)if(h[p]!==this.current[p]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}}}}const hm=new Float32Array(9),fm=new Float32Array(4);class ll extends Ta{constructor(s){super(s),this.current=fm}set(s,l,h){if(this.fetchUniformLocation(s,l)){for(let p=0;p<4;p++)if(h[p]!==this.current[p]){this.current=h,this.gl.uniformMatrix2fv(this.location,!1,h);break}}}}function Xc(c){return[Lg(255*c.r,255*c.g),Lg(255*c.b,255*c.a)]}class Nu{constructor(s,l,h,p){this.value=s,this.uniformNames=l.map(v=>`u_${v}`),this.type=h,this.context=p}setUniform(s,l,h,p,v){const x=p.constantOr(this.value);l.set(s,v,x instanceof Pn?x.toRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):x)}getBinding(s,l){return this.type==="color"?new Ky(s):new ws(s)}}class zu{constructor(s,l){this.uniformNames=l.map(h=>`u_${h}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(s,l){this.pixelRatio=s.pixelRatio||1,this.pattern=s.tl.concat(s.br),this.patternTransition=l?l.tl.concat(l.br):this.pattern}setUniform(s,l,h,p,v){let x=null;v!=="u_pattern"&&v!=="u_dash"||(x=this.pattern),v==="u_pattern_b"&&(x=this.patternTransition),v==="u_pixel_ratio"&&(x=this.pixelRatio),x&&l.set(s,v,x)}getBinding(s,l){return l==="u_pattern"||l==="u_pattern_b"||l==="u_dash"?new go(s):new ws(s)}}class dc{constructor(s,l,h,p){this.expression=s,this.type=h,this.maxValue=0,this.paintVertexAttributes=l.map(v=>({name:`a_${v}`,type:"Float32",components:h==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(s,l,h,p,v,x,P){const I=this.paintVertexArray.length,R=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new ni(0,{brightness:x}),l,{},v,p,P):this.expression.kind==="constant"&&this.expression.value,$=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new ni(0,{brightness:x}),l,{},v,p,P):this.lutExpression.value)==="none";this.paintVertexArray.resize(s),this._setPaintValue(I,s,R,$?null:this.context.lut)}updatePaintArray(s,l,h,p,v,x,P){const I=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:P},h,p,void 0,v):this.expression.kind==="constant"&&this.expression.value,R=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new ni(0,{brightness:P}),h,p,void 0,v):this.lutExpression.value)==="none";this._setPaintValue(s,l,I,R?null:this.context.lut)}_setPaintValue(s,l,h,p){if(this.type==="color"){const v=Xc(h.toRenderColor(p));for(let x=s;x<l;x++)this.paintVertexArray.emplace(x,v[0],v[1])}else{for(let v=s;v<l;v++)this.paintVertexArray.emplace(v,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class cl{constructor(s,l,h,p,v,x){this.expression=s,this.uniformNames=l.map(P=>`u_${P}_t`),this.type=h,this.useIntegerZoom=p,this.context=v,this.maxValue=0,this.paintVertexAttributes=l.map(P=>({name:`a_${P}`,type:"Float32",components:h==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(s,l,h,p,v,x,P){const I=this.expression.evaluate(new ni(this.context.zoom,{brightness:x}),l,{},v,p,P),R=this.expression.evaluate(new ni(this.context.zoom+1,{brightness:x}),l,{},v,p,P),$=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new ni(0,{brightness:x}),l,{},v,p,P):this.lutExpression.value)==="none",U=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(U,s,I,R,$?null:this.context.lut)}updatePaintArray(s,l,h,p,v,x,P){const I=this.expression.evaluate({zoom:this.context.zoom,brightness:P},h,p,void 0,v),R=this.expression.evaluate({zoom:this.context.zoom+1,brightness:P},h,p,void 0,v),$=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new ni(0,{brightness:P}),h,p,void 0,v):this.lutExpression.value)==="none";this._setPaintValue(s,l,I,R,$?null:this.context.lut)}_setPaintValue(s,l,h,p,v){if(this.type==="color"){const x=Xc(h.toRenderColor(v)),P=Xc(h.toRenderColor(v));for(let I=s;I<l;I++)this.paintVertexArray.emplace(I,x[0],x[1],P[0],P[1])}else{for(let x=s;x<l;x++)this.paintVertexArray.emplace(x,h,p);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(p))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(s,l,h,p,v){const x=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,P=rt(this.expression.interpolationFactor(x,this.context.zoom,this.context.zoom+1),0,1);l.set(s,v,P)}getBinding(s,l){return new ws(s)}}class ul{constructor(s,l,h,p,v){this.expression=s,this.layerId=v,this.paintVertexAttributes=(h==="array"?e0:um).members;for(let x=0;x<l.length;++x);this.paintVertexArray=new p,this.paintTransitionVertexArray=new cc}populatePaintArray(s,l,h,p){const v=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValues(v,s,l.patterns&&l.patterns[this.layerId],h)}updatePaintArray(s,l,h,p,v,x,P){this._setPaintValues(s,l,h.patterns&&h.patterns[this.layerId],x)}_setPaintValues(s,l,h,p){if(!p||!h)return;const v=p[h[0]],x=p[h[1]];if(v){if(v){const{tl:P,br:I,pixelRatio:R}=v;for(let $=s;$<l;$++)this.paintVertexArray.emplace($,P[0],P[1],I[0],I[1],R)}if(x){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:P,br:I,pixelRatio:R}=x;for(let $=s;$<l;$++)this.paintTransitionVertexArray.emplace($,P[0],P[1],I[0],I[1],R)}}}upload(s){const l=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,l)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=s.createVertexBuffer(this.paintTransitionVertexArray,Ea.members,l))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class hc{constructor(s,l,h=()=>!0){this.binders={},this._buffers=[],this.context=l;const p=[];for(const v in s.paint._values){const x=s.paint.get(v);if(v.endsWith("-use-theme")||!h(v)||!(x instanceof Wc&&ys(x.property.specification)))continue;const P=o(v,s.type),I=x.value,R=x.property.specification.type,$=!!x.property.useIntegerZoom,U=v==="line-dasharray"||v.endsWith("pattern"),W=s.paint.get(`${v}-use-theme`),te=v==="line-dasharray"&&s.layout.get("line-cap").value.kind!=="constant"||W&&W.value.kind!=="constant";if(I.kind!=="constant"||te)if(I.kind==="source"||te||U){const re=S(v,R,"source");this.binders[v]=U?new ul(I,P,R,re,s.id):new dc(I,P,R,re),p.push(`/a_${v}`)}else{const re=S(v,R,"composite");this.binders[v]=new cl(I,P,R,$,l,re),p.push(`/z_${v}`)}else this.binders[v]=U?new zu(I.value,P):new Nu(I.value,P,R,l),p.push(`/u_${v}`);W&&(this.binders[v].lutExpression=W.value)}this.cacheKey=p.sort().join("")}getMaxValue(s){const l=this.binders[s];return l instanceof dc||l instanceof cl?l.maxValue:0}populatePaintArrays(s,l,h,p,v,x,P){for(const I in this.binders){const R=this.binders[I];R.context=this.context,(R instanceof dc||R instanceof cl||R instanceof ul)&&R.populatePaintArray(s,l,h,p,v,x,P)}}setConstantPatternPositions(s,l){for(const h in this.binders){const p=this.binders[h];p instanceof zu&&p.setConstantPatternPositions(s,l)}}getPatternTransitionVertexBuffer(s){const l=this.binders[s];return l instanceof ul?l.paintTransitionVertexBuffer:null}updatePaintArrays(s,l,h,p,v,x,P,I,R){let $=!1;const U=Object.keys(s),W=U.length!==0&&!I,te=W?U:l.uniqueIds;this.context.lut=v.lut;for(const re in this.binders){const le=this.binders[re];if(le.context=this.context,(le instanceof dc||le instanceof cl||le instanceof ul)&&le.expression&&le.expression.kind&&le.expression.kind!=="constant"&&(le.expression.isStateDependent===!0||le.expression.isLightConstant===!1)){const ve=v.paint.get(re);le.expression=ve.value;for(const _e of te){const Ce=s[_e.toString()];l.eachPosition(_e,(Ee,ue,we)=>{const Te=p.feature(Ee);le.updatePaintArray(ue,we,Te,Ce,x,P,R)})}if(!W)for(const _e of h.uniqueIds){const Ce=s[_e.toString()];h.eachPosition(_e,(Ee,ue,we)=>{const Te=p.feature(Ee);le.updatePaintArray(ue,we,Te,Ce,x,P,R)})}$=!0}}return $}defines(){const s=[];for(const l in this.binders){const h=this.binders[l];(h instanceof Nu||h instanceof zu)&&s.push(...h.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return s}getBinderAttributes(){const s=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof dc||h instanceof cl||h instanceof ul)for(let p=0;p<h.paintVertexAttributes.length;p++)s.push(h.paintVertexAttributes[p].name);if(h instanceof ul)for(let p=0;p<Ea.members.length;p++)s.push(Ea.members[p].name)}return s}getBinderUniforms(){const s=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof Nu||h instanceof zu||h instanceof cl)for(const p of h.uniformNames)s.push(p)}return s}getPaintVertexBuffers(){return this._buffers}getUniforms(s){const l=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof Nu||p instanceof zu||p instanceof cl)for(const v of p.uniformNames)l.push({name:v,property:h,binding:p.getBinding(s,v)})}return l}setUniforms(s,l,h,p,v){for(const{name:x,property:P,binding:I}of h)this.binders[P].setUniform(s,I,v,p.get(P),x)}updatePaintBuffers(){this._buffers=[];for(const s in this.binders){const l=this.binders[s];(l instanceof dc||l instanceof cl||l instanceof ul)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer),l instanceof ul&&l.paintTransitionVertexBuffer&&this._buffers.push(l.paintTransitionVertexBuffer)}}upload(s){for(const l in this.binders){const h=this.binders[l];(h instanceof dc||h instanceof cl||h instanceof ul)&&h.upload(s)}this.updatePaintBuffers()}destroy(){for(const s in this.binders){const l=this.binders[s];(l instanceof dc||l instanceof cl||l instanceof ul)&&l.destroy()}}}class Kc{constructor(s,l,h=()=>!0){this.programConfigurations={};for(const p of s)this.programConfigurations[p.id]=new hc(p,l,h);this.needsUpload=!1,this._featureMap=new jd,this._featureMapWithoutIds=new jd,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(s,l,h,p,v,x,P,I){for(const R in this.programConfigurations)this.programConfigurations[R].populatePaintArrays(s,l,p,v,x,P,I);l.id!==void 0?this._featureMap.add(l.id,h,this._bufferOffset,s):(this._featureMapWithoutIds.add(this._idlessCounter,h,this._bufferOffset,s),this._idlessCounter+=1),this._bufferOffset=s,this.needsUpload=!0}updatePaintArrays(s,l,h,p,v,x,P){for(const I of h)this.needsUpload=this.programConfigurations[I.id].updatePaintArrays(s,this._featureMap,this._featureMapWithoutIds,l,I,p,v,x,P||0)||this.needsUpload}get(s){return this.programConfigurations[s]}upload(s){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(s);this.needsUpload=!1}}destroy(){for(const s in this.programConfigurations)this.programConfigurations[s].destroy()}}const m={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"]};function o(c,s){return m[c]||[c.replace(`${s}-`,"").replace(/-/g,"_")]}const d={"line-pattern":{source:cc,composite:cc},"fill-pattern":{source:cc,composite:cc},"fill-extrusion-pattern":{source:cc,composite:cc},"line-dasharray":{source:Ld,composite:Ld}},g={color:{source:ju,composite:so},number:{source:Bh,composite:ju}};function S(c,s,l){const h=d[c];return h&&h[l]||g[s][l]}yr(Nu,"ConstantBinder"),yr(zu,"PatternConstantBinder"),yr(dc,"SourceExpressionBinder"),yr(ul,"PatternCompositeBinder"),yr(cl,"CompositeExpressionBinder"),yr(hc,"ProgramConfiguration",{omit:["_buffers"]}),yr(Kc,"ProgramConfigurationSet");const C=or/Math.PI/2,M=5,L=6,B=16383,q=64,X=[q,32,16],ee=-C,Q=C;function ne(c,s,l,h=C){return l=ae(l),[c*Math.sin(l)*h,-s*h,c*Math.cos(l)*h]}function fe(c,s,l){return ne(Math.cos(ae(c)),Math.sin(ae(c)),s,l)}const de=63710088e-1,ye=2*Math.PI*de;class he{constructor(s,l){if(isNaN(s)||isNaN(l))throw new Error(`Invalid LngLat object: (${s}, ${l})`);if(this.lng=+s,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new he(mt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(s){const l=Math.PI/180,h=this.lat*l,p=s.lat*l,v=Math.sin(h)*Math.sin(p)+Math.cos(h)*Math.cos(p)*Math.cos((s.lng-this.lng)*l);return de*Math.acos(Math.min(v,1))}toBounds(s=0){const l=360*s/40075017,h=l/Math.cos(Math.PI/180*this.lat);return new Se({lng:this.lng-h,lat:this.lat-l},{lng:this.lng+h,lat:this.lat+l})}toEcef(s){return fe(this.lat,this.lng,C+s*C/de)}static convert(s){if(s instanceof he)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new he(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new he(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Se{constructor(s,l){if(s)if(l)this.setSouthWest(s).setNorthEast(l);else if(s.length===4){const h=s;this.setSouthWest([h[0],h[1]]).setNorthEast([h[2],h[3]])}else{const h=s;this.setSouthWest(h[0]).setNorthEast(h[1])}}setNorthEast(s){return this._ne=s instanceof he?new he(s.lng,s.lat):he.convert(s),this}setSouthWest(s){return this._sw=s instanceof he?new he(s.lng,s.lat):he.convert(s),this}extend(s){const l=this._sw,h=this._ne;let p,v;if(s instanceof he)p=s,v=s;else{if(!(s instanceof Se))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(Se.convert(s)):this.extend(he.convert(s)):typeof s=="object"&&s!==null&&s.hasOwnProperty("lat")&&(s.hasOwnProperty("lon")||s.hasOwnProperty("lng"))?this.extend(he.convert(s)):this;if(p=s._sw,v=s._ne,!p||!v)return this}return l||h?(l.lng=Math.min(p.lng,l.lng),l.lat=Math.min(p.lat,l.lat),h.lng=Math.max(v.lng,h.lng),h.lat=Math.max(v.lat,h.lat)):(this._sw=new he(p.lng,p.lat),this._ne=new he(v.lng,v.lat)),this}getCenter(){return new he((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new he(this.getWest(),this.getNorth())}getSouthEast(){return new he(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:l,lat:h}=he.convert(s);let p=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&p}static convert(s){if(s)return s instanceof Se?s:new Se(s)}}const Ae=0,Pe=25.5;function Be(c){return ye*Math.cos(c*Math.PI/180)}function Fe(c){return(180+c)/360}function je(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function ke(c,s){return c/Be(s)}function qe(c){return 360*c-180}function Ze(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function yt(c,s){return c*Be(Ze(s))}const ut=85.051129;function At(c){return Math.cos(ae(rt(c,-85.051129,ut)))}function Mt(c,s){const l=rt(s,Ae,Pe),h=Math.pow(2,l);return At(c)*ye/(512*h)}function Zt(c){return 1/Math.cos(c*Math.PI/180)}function at(c,s=0){const l=Math.exp(Math.PI*(1-(c.y+s/or)/(1<<c.z)*2));return 80150034*l/(l*l+1)/or/(1<<c.z)}class gt{constructor(s,l,h=0){this.x=+s,this.y=+l,this.z=+h}static fromLngLat(s,l=0){const h=he.convert(s);return new gt(Fe(h.lng),je(h.lat),ke(l,h.lat))}toLngLat(){return new he(qe(this.x),Ze(this.y))}toAltitude(){return yt(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ye*Zt(Ze(this.y))}}function ot(c,s,l,h,p,v,x,P,I){const R=(s+h)/2,$=(l+p)/2,U=new Qt(R,$);P(U),function(W,te,re,le,ve,_e){const Ce=re-ve,Ee=le-_e;return Math.abs((le-te)*Ce-(re-W)*Ee)/Math.hypot(Ce,Ee)}(U.x,U.y,v.x,v.y,x.x,x.y)>=I?(ot(c,s,l,R,$,v,U,P,I),ot(c,R,$,h,p,U,x,P,I)):c.push(x)}function Lt(c,s,l){let h=c[0],p=h.x,v=h.y;s(h);const x=[h];for(let P=1;P<c.length;P++){const I=c[P],{x:R,y:$}=I;s(I),ot(x,p,v,R,$,h,I,s,l),p=R,v=$,h=I}return x}function vt(c,s,l,h){if(h(s,l)){const p=s.add(l)._mult(.5);vt(c,s,p,h),vt(c,p,l,h)}else c.push(l)}function zt(c,s){let l=c[0];const h=[l];for(let p=1;p<c.length;p++){const v=c[p];vt(h,l,v,s),l=v}return h}const Ot=Math.pow(2,14)-1,$t=-Ot-1;function Ut(c,s){const l=Math.round(c.x*s),h=Math.round(c.y*s);return c.x=rt(l,$t,Ot),c.y=rt(h,$t,Ot),(l<c.x||l>c.x+1||h<c.y||h>c.y+1)&&sn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),c}function wr(c,s,l){const h=c.loadGeometry(),p=c.extent,v=or/p;if(s&&l&&l.projection.isReprojectedInTileSpace){const x=1<<s.z,{scale:P,x:I,y:R,projection:$}=l,U=W=>{const te=qe((s.x+W.x/p)/x),re=Ze((s.y+W.y/p)/x),le=$.project(te,re);W.x=(le.x*P-I)*p,W.y=(le.y*P-R)*p};for(let W=0;W<h.length;W++)if(c.type!==1)h[W]=Lt(h[W],U,1);else{const te=[];for(const re of h[W])re.x<0||re.x>=p||re.y<0||re.y>=p||(U(re),te.push(re));h[W]=te}}for(const x of h)for(const P of x)Ut(P,v);return h}function Ar(c,s){return{type:c.type,id:c.id,properties:c.properties,geometry:s?wr(c):[]}}function dr(c,s,l,h,p){c.emplaceBack(2*s+(h+1)/2,2*l+(p+1)/2)}function Cr(c,s,l){c.emplaceBack(s.x,s.y,s.z,l[0]*16384,l[1]*16384,l[2]*16384)}class vr{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=s.index,this.hasPattern=!1,this.projection=s.projection,this.layoutVertexArray=new lc,this.indexArray=new bs,this.segments=new ji,this.programConfigurations=new Kc(s.layers,{zoom:s.zoom,lut:s.lut}),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}updateFootprints(s,l){}populate(s,l,h,p){const v=this.layers[0],x=[];let P=null;v.type==="circle"&&(P=v.layout.get("circle-sort-key"));for(const{feature:R,id:$,index:U,sourceLayerIndex:W}of s){const te=this.layers[0]._featureFilter.needGeometry,re=Ar(R,te);if(!this.layers[0]._featureFilter.filter(new ni(this.zoom),re,h))continue;const le=P?P.evaluate(re,{},h):void 0,ve={id:$,properties:R.properties,type:R.type,sourceLayerIndex:W,index:U,geometry:te?re.geometry:wr(R,h,p),patterns:{},sortKey:le};x.push(ve)}P&&x.sort((R,$)=>R.sortKey-$.sortKey);let I=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new Rd,I=p.projection);for(const R of x){const{geometry:$,index:U,sourceLayerIndex:W}=R,te=s[U].feature;this.addFeature(R,$,U,l.availableImages,h,I,l.brightness),l.featureIndex.insert(te,$,U,W,this.index)}}update(s,l,h,p,v,x,P){this.programConfigurations.updatePaintArrays(s,l,v,h,p,x,P)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Q_.members),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=s.createVertexBuffer(this.globeExtVertexArray,Xy.members))),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(s,l,h,p,v,x,P){for(const I of l)for(const R of I){const $=R.x,U=R.y;if($<0||$>=or||U<0||U>=or)continue;if(x){const re=x.projectTilePoint($,U,v),le=x.upVector(v,$,U),ve=this.globeExtVertexArray;Cr(ve,re,le),Cr(ve,re,le),Cr(ve,re,le),Cr(ve,re,le)}const W=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,s.sortKey),te=W.vertexLength;dr(this.layoutVertexArray,$,U,-1,-1),dr(this.layoutVertexArray,$,U,1,-1),dr(this.layoutVertexArray,$,U,1,1),dr(this.layoutVertexArray,$,U,-1,1),this.indexArray.emplaceBack(te,te+1,te+2),this.indexArray.emplaceBack(te,te+2,te+3),W.vertexLength+=4,W.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,h,{},p,v,P)}}function jr(c,s){for(let l=0;l<c.length;l++)if(oi(s,c[l]))return!0;for(let l=0;l<s.length;l++)if(oi(c,s[l]))return!0;return!!si(c,s)}function Qr(c,s,l){return!!oi(c,s)||!!en(s,c,l)}function _n(c,s){if(c.length===1)return On(s,c[0]);for(let l=0;l<s.length;l++){const h=s[l];for(let p=0;p<h.length;p++)if(oi(c,h[p]))return!0}for(let l=0;l<c.length;l++)if(On(s,c[l]))return!0;for(let l=0;l<s.length;l++)if(si(c,s[l]))return!0;return!1}function ii(c,s,l){if(c.length>1){if(si(c,s))return!0;for(let h=0;h<s.length;h++)if(en(s[h],c,l))return!0}for(let h=0;h<c.length;h++)if(en(c[h],s,l))return!0;return!1}function si(c,s){if(c.length===0||s.length===0)return!1;for(let l=0;l<c.length-1;l++){const h=c[l],p=c[l+1];for(let v=0;v<s.length-1;v++)if(fn(h,p,s[v],s[v+1]))return!0}return!1}function fn(c,s,l,h){return Bn(c,l,h)!==Bn(s,l,h)&&Bn(c,s,l)!==Bn(c,s,h)}function Gi(c,s,l){return(c.x-l.x)*(s.y-l.y)-(c.y-l.y)*(s.x-l.x)}function Pi(c,s,l,h){const p=Gi(c,s,h),v=Gi(c,s,l);if(Math.sign(p)===Math.sign(v))return;const x=Gi(l,h,c),P=x+v-p;return Math.sign(x)!==Math.sign(P)?[x/(x-P),v/(v-p)]:void 0}function en(c,s,l){const h=l*l;if(s.length===1)return c.distSqr(s[0])<h;for(let p=1;p<s.length;p++)if(kn(c,s[p-1],s[p])<h)return!0;return!1}function kn(c,s,l){const h=s.distSqr(l);if(h===0)return c.distSqr(s);const p=((c.x-s.x)*(l.x-s.x)+(c.y-s.y)*(l.y-s.y))/h;return c.distSqr(p<0?s:p>1?l:l.sub(s)._mult(p)._add(s))}function On(c,s){let l,h,p,v=!1;for(let x=0;x<c.length;x++){l=c[x];for(let P=0,I=l.length-1;P<l.length;I=P++)h=l[P],p=l[I],h.y>s.y!=p.y>s.y&&s.x<(p.x-h.x)*(s.y-h.y)/(p.y-h.y)+h.x&&(v=!v)}return v}function oi(c,s){let l=!1;for(let h=0,p=c.length-1;h<c.length;p=h++){const v=c[h],x=c[p];v.y>s.y!=x.y>s.y&&s.x<(x.x-v.x)*(s.y-v.y)/(x.y-v.y)+v.x&&(l=!l)}return l}function Ss(c,s,l,h,p){for(const x of c)if(s<=x.x&&l<=x.y&&h>=x.x&&p>=x.y)return!0;const v=[new Qt(s,l),new Qt(s,p),new Qt(h,p),new Qt(h,l)];if(c.length>2){for(const x of v)if(oi(c,x))return!0}for(let x=0;x<c.length-1;x++)if(Hi(c[x],c[x+1],v))return!0;return!1}function Hi(c,s,l){const h=l[0],p=l[2];if(c.x<h.x&&s.x<h.x||c.x>p.x&&s.x>p.x||c.y<h.y&&s.y<h.y||c.y>p.y&&s.y>p.y)return!1;const v=Bn(c,s,l[0]);return v!==Bn(c,s,l[1])||v!==Bn(c,s,l[2])||v!==Bn(c,s,l[3])}function os(c,s,l,h,p,v){let x=s.y-c.y,P=c.x-s.x;if(v=v||0){const I=x*x+P*P;if(I===0)return!0;const R=Math.sqrt(I);x/=R,P/=R}return!((l.x-c.x)*x+(l.y-c.y)*P-v<0||(h.x-c.x)*x+(h.y-c.y)*P-v<0||(p.x-c.x)*x+(p.y-c.y)*P-v<0)}function Di(c,s,l,h,p,v,x){return!(os(c,s,h,p,v,x)||os(s,l,h,p,v,x)||os(l,c,h,p,v,x)||os(h,p,c,s,l,x)||os(p,v,c,s,l,x)||os(v,h,c,s,l,x))}function pn(c,s,l){const h=s.paint.get(c).value;return h.kind==="constant"?h.value:l.programConfigurations.get(s.id).getMaxValue(c)}function Si(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function zn(c,s,l,h,p){if(!s[0]&&!s[1])return c;const v=Qt.convert(s)._mult(p);l==="viewport"&&v._rotate(-h);const x=[];for(let P=0;P<c.length;P++)x.push(c[P].sub(v));return x}function ci(c,s,l,h){const p=Qt.convert(c)._mult(h);return s==="viewport"&&p._rotate(-l),p}let Zn,pi;function Vs(c,s,l){var h=2*Math.PI*6378137/256/Math.pow(2,l);return[c*h-2*Math.PI*6378137/2,s*h-2*Math.PI*6378137/2]}yr(vr,"CircleBucket",{omit:["layers"]});class Mn{constructor(s,l,h){this.z=s,this.x=l,this.y=h,this.key=yo(0,s,s,l,h)}equals(s){return this.z===s.z&&this.x===s.x&&this.y===s.y}url(s,l){const h=function(v,x,P){var I=Vs(256*v,256*(x=Math.pow(2,P)-x-1),P),R=Vs(256*(v+1),256*(x+1),P);return I[0]+","+I[1]+","+R[0]+","+R[1]}(this.x,this.y,this.z),p=function(v,x,P){let I,R="";for(let $=v;$>0;$--)I=1<<$-1,R+=(x&I?1:0)+(P&I?2:0);return R}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",h)}toString(){return`${this.z}/${this.x}/${this.y}`}}class oo{constructor(s,l){this.wrap=s,this.canonical=l,this.key=yo(s,l.z,l.z,l.x,l.y)}}class ds{constructor(s,l,h,p,v){this.overscaledZ=s,this.wrap=l,this.canonical=new Mn(h,+p,+v),this.key=l===0&&s===h?this.canonical.key:yo(l,s,h,p,v)}equals(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)}scaledTo(s){const l=this.canonical.z-s;return s>this.canonical.z?new ds(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ds(s,this.wrap,s,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(s,l=!0){if(this.overscaledZ===s&&l)return this.key;if(s>this.canonical.z)return yo(this.wrap*+l,s,this.canonical.z,this.canonical.x,this.canonical.y);{const h=this.canonical.z-s;return yo(this.wrap*+l,s,s,this.canonical.x>>h,this.canonical.y>>h)}}isChildOf(s){if(s.wrap!==this.wrap)return!1;const l=this.canonical.z-s.canonical.z;return s.overscaledZ===0||s.overscaledZ<this.overscaledZ&&s.canonical.z<this.canonical.z&&s.canonical.x===this.canonical.x>>l&&s.canonical.y===this.canonical.y>>l}children(s){if(this.overscaledZ>=s)return[new ds(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,h=2*this.canonical.x,p=2*this.canonical.y;return[new ds(l,this.wrap,l,h,p),new ds(l,this.wrap,l,h+1,p),new ds(l,this.wrap,l,h,p+1),new ds(l,this.wrap,l,h+1,p+1)]}isLessThan(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))}wrapped(){return new ds(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(s){return new ds(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new oo(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function yo(c,s,l,h,p){const v=1<<Math.min(l,22);let x=v*(p%v)+h%v;return c&&l<22&&(x+=v*v*((c<0?-2*c-1:2*c)%(1<<2*(22-l)))),16*(32*x+l)+(s-l)}const Ll=[c=>{let s=c.canonical.x-1,l=c.wrap;return s<0&&(s=(1<<c.canonical.z)-1,l--),new ds(c.overscaledZ,l,c.canonical.z,s,c.canonical.y)},c=>{let s=c.canonical.x+1,l=c.wrap;return s===1<<c.canonical.z&&(s=0,l++),new ds(c.overscaledZ,l,c.canonical.z,s,c.canonical.y)},c=>new ds(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,(c.canonical.y===0?1<<c.canonical.z:c.canonical.y)-1),c=>new ds(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y===(1<<c.canonical.z)-1?0:c.canonical.y+1)];yr(Mn,"CanonicalTileID"),yr(ds,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const fc=qn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:ma}=fc,dl=qn([{name:"a_pos_3",components:3,type:"Int16"}]);var Ws=qn([{name:"a_pos",type:"Int16",components:2}]);class hl{constructor(s,l){this.pos=s,this.dir=l}intersectsPlane(s,l,h){const p=Jn(l,this.dir);if(Math.abs(p)<1e-6)return!1;const v=((s[0]-this.pos[0])*l[0]+(s[1]-this.pos[1])*l[1])/p;return h[0]=this.pos[0]+this.dir[0]*v,h[1]=this.pos[1]+this.dir[1]*v,!0}}class Rl{constructor(s,l){this.pos=s,this.dir=l}intersectsPlane(s,l,h){const p=Et(l,this.dir);if(Math.abs(p)<1e-6)return!1;const v=((s[0]-this.pos[0])*l[0]+(s[1]-this.pos[1])*l[1]+(s[2]-this.pos[2])*l[2])/p;return h[0]=this.pos[0]+this.dir[0]*v,h[1]=this.pos[1]+this.dir[1]*v,h[2]=this.pos[2]+this.dir[2]*v,!0}closestPointOnSphere(s,l,h){if(function(te,re){var le=te[0],ve=te[1],_e=te[2],Ce=re[0],Ee=re[1],ue=re[2];return Math.abs(le-Ce)<=y*Math.max(1,Math.abs(le),Math.abs(Ce))&&Math.abs(ve-Ee)<=y*Math.max(1,Math.abs(ve),Math.abs(Ee))&&Math.abs(_e-ue)<=y*Math.max(1,Math.abs(_e),Math.abs(ue))}(this.pos,s)||l===0)return h[0]=h[1]=h[2]=0,!1;const[p,v,x]=this.dir,P=this.pos[0]-s[0],I=this.pos[1]-s[1],R=this.pos[2]-s[2],$=p*p+v*v+x*x,U=2*(P*p+I*v+R*x),W=U*U-4*$*(P*P+I*I+R*R-l*l);if(W<0){const te=Math.max(-U/2,0),re=P+p*te,le=I+v*te,ve=R+x*te,_e=Math.hypot(re,le,ve);return h[0]=re*l/_e,h[1]=le*l/_e,h[2]=ve*l/_e,!1}{const te=(-U-Math.sqrt(W))/(2*$);if(te<0){const re=Math.hypot(P,I,R);return h[0]=P*l/re,h[1]=I*l/re,h[2]=R*l/re,!1}return h[0]=P+p*te,h[1]=I+v*te,h[2]=R+x*te,!0}}}class qa{constructor(s,l,h,p,v){this.TL=s,this.TR=l,this.BR=h,this.BL=p,this.horizon=v}static fromInvProjectionMatrix(s,l,h){const p=[-1,1,1],v=[1,1,1],x=[1,-1,1],P=[-1,-1,1],I=Tt(p,p,s),R=Tt(v,v,s),$=Tt(x,x,s),U=Tt(P,P,s);return new qa(I,R,$,U,l/h)}}function pc(c,s,l){let h=1/0,p=-1/0;const v=[];for(const x of c){Rt(v,x,s);const P=Et(v,l);h=Math.min(h,P),p=Math.max(p,P)}return[h,p]}function mc(c,s){let l=!0;for(let h=0;h<c.planes.length;h++){const p=c.planes[h];let v=0;for(let x=0;x<s.length;x++)v+=Et(p,s[x])+p[3]>=0;if(v===0)return 0;v!==s.length&&(l=!1)}return l?2:1}function Dd(c,s){for(const l of c.projections){const h=pc(s,c.points[0],l.axis);if(l.projection[1]<h[0]||l.projection[0]>h[1])return 0}return 1}function Hh(c,s){let l=0;const h=[0,0,0,0];for(let x=0;x<c.length;x++)h[0]=c[x][0],h[1]=c[x][1],h[2]=c[x][2],h[3]=1,(p=h)[0]*(v=s)[0]+p[1]*v[1]+p[2]*v[2]+p[3]*v[3]>=0&&l++;var p,v;return l}class Nd{constructor(s,l){this.points=s||new Array(8).fill([0,0,0]),this.planes=l||new Array(6).fill([0,0,0,0]),this.bounds=Mi.fromPoints(this.points),this.projections=[],this.frustumEdges=[Rt([],this.points[2],this.points[3]),Rt([],this.points[0],this.points[3]),Rt([],this.points[4],this.points[0]),Rt([],this.points[5],this.points[1]),Rt([],this.points[6],this.points[2]),Rt([],this.points[7],this.points[3])];for(const h of this.frustumEdges){const p=[0,-h[2],h[1]],v=[h[2],0,-h[0]];this.projections.push({axis:p,projection:pc(this.points,this.points[0],p)}),this.projections.push({axis:v,projection:pc(this.points,this.points[0],v)})}}static fromInvProjectionMatrix(s,l,h,p){const v=Math.pow(2,h),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(R=>{const $=$r([],R,s),U=1/$[3]/l*v;return(W=$)[0]=(te=$)[0]*(re=[U,U,p?1/$[3]:U,U])[0],W[1]=te[1]*re[1],W[2]=te[2]*re[2],W[3]=te[3]*re[3],W;var W,te,re}),P=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(R=>{const $=Ve([],kt([],Rt([],x[R[0]],x[R[1]]),Rt([],x[R[2]],x[R[1]]))),U=-Et($,x[R[1]]);return $.concat(U)}),I=[];for(let R=0;R<x.length;R++)I.push([x[R][0],x[R][1],x[R][2]]);return new Nd(I,P)}intersectsPrecise(s,l,h){for(let p=0;p<l.length;p++)if(!Hh(s,l[p]))return 0;for(let p=0;p<this.planes.length;p++)if(!Hh(s,this.planes[p]))return 0;for(const p of h)for(const v of this.frustumEdges){const x=kt([],p,v),P=ze(x);if(P===0)continue;Ue(x,x,1/P);const I=pc(this.points,this.points[0],x),R=pc(s,this.points[0],x);if(I[0]>R[1]||R[0]>I[1])return 0}return 1}containsPoint(s){for(const l of this.planes){const h=l[3];if(Et([l[0],l[1],l[2]],s)+h<0)return!1}return!0}}class Mi{static fromPoints(s){const l=[1/0,1/0,1/0],h=[-1/0,-1/0,-1/0];for(const p of s)Ne(l,l,p),We(h,h,p);return new Mi(l,h)}static fromTileIdAndHeight(s,l,h){const p=1<<s.canonical.z,v=s.canonical.x,x=s.canonical.y;return new Mi([v/p,x/p,l],[(v+1)/p,(x+1)/p,h])}static applyTransform(s,l){const h=s.getCorners();for(let p=0;p<h.length;++p)Tt(h[p],h[p],l);return Mi.fromPoints(h)}static applyTransformFast(s,l){const h=[l[12],l[13],l[14]],p=[...h];for(let v=0;v<3;v++)for(let x=0;x<3;x++){const P=l[4*x+v],I=P*s.min[x],R=P*s.max[x];h[v]+=Math.min(I,R),p[v]+=Math.max(I,R)}return new Mi(h,p)}static projectAabbCorners(s,l){const h=s.getCorners();for(let p=0;p<h.length;++p)Tt(h[p],h[p],l);return h}constructor(s,l){this.min=s,this.max=l,this.center=Ue([],Je([],this.min,this.max),.5)}quadrant(s){const l=[s%2==0,s<2],h=Le(this.min),p=Le(this.max);for(let v=0;v<l.length;v++)h[v]=l[v]?this.min[v]:this.center[v],p[v]=l[v]?this.center[v]:this.max[v];return p[2]=this.max[2],new Mi(h,p)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}distanceZ(s){return Math.max(Math.min(this.max[2],s[2]),this.min[2])-s[2]}getCorners(){const s=this.min,l=this.max;return[[s[0],s[1],s[2]],[l[0],s[1],s[2]],[l[0],l[1],s[2]],[s[0],l[1],s[2]],[s[0],s[1],l[2]],[l[0],s[1],l[2]],[l[0],l[1],l[2]],[s[0],l[1],l[2]]]}intersects(s){return this.intersectsAabb(s.bounds)?mc(s,this.getCorners()):0}intersectsFlat(s){return this.intersectsAabb(s.bounds)?mc(s,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(s,l){return l||this.intersects(s)?Dd(s,this.getCorners()):0}intersectsPreciseFlat(s,l){return l||this.intersectsFlat(s)?Dd(s,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(s){for(let l=0;l<3;++l)if(this.min[l]>s.max[l]||s.min[l]>this.max[l])return!1;return!0}intersectsAabbXY(s){return!(this.min[0]>s.max[0]||s.min[0]>this.max[0]||this.min[1]>s.max[1]||s.min[1]>this.max[1])}encapsulate(s){for(let l=0;l<3;l++)this.min[l]=Math.min(this.min[l],s.min[l]),this.max[l]=Math.max(this.max[l],s.max[l])}encapsulatePoint(s){for(let l=0;l<3;l++)this.min[l]=Math.min(this.min[l],s[l]),this.max[l]=Math.max(this.max[l],s[l])}closestPoint(s){return[Math.max(Math.min(this.max[0],s[0]),this.min[0]),Math.max(Math.min(this.max[1],s[1]),this.min[1]),Math.max(Math.min(this.max[2],s[2]),this.min[2])]}}function Fu(c){return c*C/de}yr(Mi,"Aabb");const Rg=[new Mi([ee,ee,ee],[Q,Q,Q]),new Mi([ee,ee,ee],[0,0,Q]),new Mi([0,ee,ee],[Q,0,Q]),new Mi([ee,0,ee],[0,Q,Q]),new Mi([0,0,ee],[Q,Q,Q])];function t0(c,s,l,h=!0){const p=Ue([],c._camera.position,c.worldSize),v=[s,l,1,1];$r(v,v,c.pixelMatrixInverse),Vr(v,v,1/v[3]);const x=Ve([],Rt([],v,p)),P=c.globeMatrix,I=[P[12],P[13],P[14]],R=Rt([],I,p),$=ze(R),U=Ve([],R),W=c.worldSize/(2*Math.PI),te=Et(U,x),re=Math.asin(W/$);if(re<Math.acos(te)){if(!h)return null;const it=[],ct=[];Ue(it,x,$/te),Ve(ct,Rt(ct,it,R)),Ve(x,Je(x,R,Ue(x,ct,Math.tan(re)*$)))}const le=[];new Rl(p,x).closestPointOnSphere(I,W,le);const ve=Ve([],Ci(P,0)),_e=Ve([],Ci(P,1)),Ce=Ve([],Ci(P,2)),Ee=Et(ve,le),ue=Et(_e,le),we=Et(Ce,le),Te=oe(Math.asin(-ue/W));let Ie=oe(Math.atan2(Ee,we));Ie=c.center.lng+function(it,ct){const St=(ct-it+180)%360-180;return St<-180?St+360:St}(c.center.lng,Ie);const Ge=Fe(Ie),Qe=rt(je(Te),0,1);return new gt(Ge,Qe)}class i1{constructor(s,l,h){this.a=Rt([],s,h),this.b=Rt([],l,h),this.center=h;const p=Ve([],this.a),v=Ve([],this.b);this.angle=Math.acos(Et(p,v))}}function pm(c,s){if(c.angle===0)return null;let l;return l=c.a[s]===0?1/c.angle*.5*Math.PI:1/c.angle*Math.atan(c.b[s]/c.a[s]/Math.sin(c.angle)-1/Math.tan(c.angle)),l<0||l>1?null:function(h,p,v,x){const P=Math.sin(v);return h*(Math.sin((1-x)*v)/P)+p*(Math.sin(x*v)/P)}(c.a[s],c.b[s],c.angle,rt(l,0,1))+c.center[s]}function jl(c){if(c.z<=1)return Rg[c.z+2*c.y+c.x];const s=Dg(jg(c));return Mi.fromPoints(s)}function Bu(c,s,l){return Ue(c,c,1-l),De(c,c,s,l)}function Yy(c,s,l){for(const h of c)Tt(h,h,s),Ue(h,h,l)}function s1(c,s,l,h){const p=s/c.worldSize,v=c.globeMatrix;if(l.z<=1){const Qe=jl(l).getCorners();return Yy(Qe,v,p),Mi.fromPoints(Qe)}const x=jg(l,h),P=Dg(x,C+Fu(c._tileCoverLift));Yy(P,v,p);const I=Number.MAX_VALUE,R=[-I,-I,-I],$=[I,I,I];if(x.contains(c.center)){for(const ct of P)Ne($,$,ct),We(R,R,ct);R[2]=0;const Qe=c.point,it=[Qe.x*p,Qe.y*p,0];return Ne($,$,it),We(R,R,it),new Mi($,R)}if(c._tileCoverLift>0){for(const Qe of P)Ne($,$,Qe),We(R,R,Qe);return new Mi($,R)}const U=[v[12]*p,v[13]*p,v[14]*p],W=x.getCenter(),te=rt(c.center.lat,-85.051129,ut),re=rt(W.lat,-85.051129,ut),le=Fe(c.center.lng),ve=je(te);let _e=le-Fe(W.lng);const Ce=ve-je(re);_e>.5?_e-=1:_e<-.5&&(_e+=1);let Ee=0;Math.abs(_e)>Math.abs(Ce)?Ee=_e>=0?1:3:(Ee=Ce>=0?0:2,De(U,U,[v[4]*p,v[5]*p,v[6]*p],-Math.sin(ae(Ce>=0?x.getSouth():x.getNorth()))*C));const ue=P[Ee],we=P[(Ee+1)%4],Te=new i1(ue,we,U),Ie=[pm(Te,0)||ue[0],pm(Te,1)||ue[1],pm(Te,2)||ue[2]],Ge=Zh(c.zoom);if(Ge>0){const Qe=function({x:ct,y:St,z:Vt},Nt,Bt,Xt,xt){const Ft=1/(1<<Vt);let _t=ct*Ft,wt=_t+Ft,Yt=St*Ft,tr=Yt+Ft,Or=0;const Tr=(_t+wt)/2-Xt;return Tr>.5?Or=-1:Tr<-.5&&(Or=1),_t=((_t+Or)*Nt-(Xt*=Nt))*Bt+Xt,wt=((wt+Or)*Nt-Xt)*Bt+Xt,Yt=(Yt*Nt-(xt*=Nt))*Bt+xt,tr=(tr*Nt-xt)*Bt+xt,[[_t,tr,0],[wt,tr,0],[wt,Yt,0],[_t,Yt,0]]}(l,s,c._pixelsPerMercatorPixel,le,ve);for(let ct=0;ct<P.length;ct++)Bu(P[ct],Qe[ct],Ge);const it=Je([],Qe[Ee],Qe[(Ee+1)%4]);Ue(it,it,.5),Bu(Ie,it,Ge)}for(const Qe of P)Ne($,$,Qe),We(R,R,Qe);return $[2]=Math.min(ue[2],we[2]),Ne($,$,Ie),We(R,R,Ie),new Mi($,R)}function jg({x:c,y:s,z:l},h=!1){const p=1/(1<<l),v=new he(qe(c*p),s===(1<<l)-1&&h?-90:Ze((s+1)*p)),x=new he(qe((c+1)*p),s===0&&h?90:Ze(s*p));return new Se(v,x)}function Dg(c,s=C){const l=ae(c.getNorth()),h=ae(c.getSouth()),p=Math.cos(l),v=Math.cos(h),x=Math.sin(l),P=Math.sin(h),I=c.getWest(),R=c.getEast();return[ne(v,P,I,s),ne(v,P,R,s),ne(p,x,R,s),ne(p,x,I,s)]}function Wh(c,s,l,h){const p=1<<l.z,v=(c/or+l.x)/p;return fe(Ze((s/or+l.y)/p),qe(v),h)}function mm({min:c,max:s}){return B/Math.max(s[0]-c[0],s[1]-c[1],s[2]-c[2])}const Ng=new Float64Array(16);function zg(c){const s=mm(c),l=ie(Ng,[s,s,s]);return H(l,l,Ye([],c.min))}function r0(c){const s=(h=c.min,(l=Ng)[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=h[0],l[13]=h[1],l[14]=h[2],l[15]=1,l);var l,h;const p=1/mm(c);return Z(s,s,[p,p,p])}function gm(c){const s=or/(2*Math.PI);return c/(2*Math.PI)/s}function o1(c,s){return or/(512*Math.pow(2,c))*mm(jl(s))}function ym(c,s,l,h,p){const v=gm(l),x=[c,s,-l/(2*Math.PI)],P=O(new Float64Array(16));return H(P,P,x),Z(P,P,[v,v,v]),J(P,P,ae(-p)),G(P,P,ae(-h)),P}function Zh(c){return nt(M,L,c)}function Fg(c,s){const l=fe(s.lat,s.lng),h=function(re){const le=fe(re._center.lat,re._center.lng);let ve=kt([],Xe(0,1,0),le);const _e=ce([],-re.angle,le);ve=Tt(ve,ve,_e),ce(_e,-re._pitch,ve);const Ce=Ve([],le);return Ue(Ce,Ce,Fu(re.cameraToCenterDistance/re.pixelsPerMeter)),Tt(Ce,Ce,_e),Je([],le,Ce)}(c);return x=(p=tt([],h,l))[0],P=p[1],I=p[2],R=(v=l)[0],$=v[1],U=v[2],te=(W=Math.sqrt(x*x+P*P+I*I)*Math.sqrt(R*R+$*$+U*U))&&Et(p,v)/W,Math.acos(Math.min(Math.max(te,-1),1));var p,v,x,P,I,R,$,U,W,te}function _(c,s){return Fg(c,s)>Math.PI/2*1.01}const E=ae(85),z=Math.cos(E),K=Math.sin(E),se=D(),me=c=>{const s=[];return c.paint.get("circle-pitch-alignment")==="map"&&s.push("PITCH_WITH_MAP"),c.paint.get("circle-pitch-scale")==="map"&&s.push("SCALE_WITH_MAP"),s};function Re(c,s,l,h,p,v,x,P,I){if(v&&c.queryGeometry.isAboveHorizon)return!1;v&&(I*=c.pixelToTileUnitsFactor);const R=c.tileID.canonical,$=l.projection.upVectorScale(R,l.center.lat,l.worldSize).metersToTile;for(const U of s)for(const W of U){const te=W.add(P),re=p&&l.elevation?l.elevation.exaggeration()*p.getElevationAt(te.x,te.y,!0):0,le=l.projection.projectTilePoint(te.x,te.y,R);if(re>0){const Ee=l.projection.upVector(R,te.x,te.y);le.x+=Ee[0]*$*re,le.y+=Ee[1]*$*re,le.z+=Ee[2]*$*re}const ve=v?te:ht(le.x,le.y,le.z,h),_e=v?c.tilespaceRays.map(Ee=>Dr(Ee,re)):c.queryGeometry.screenGeometry,Ce=$r([],[le.x,le.y,le.z,1],h);if(!x&&v?I*=Ce[3]/l.cameraToCenterDistance:x&&!v&&(I*=l.cameraToCenterDistance/Ce[3]),v){const Ee=Ze((W.y/or+R.y)/(1<<R.z));I/=l.projection.pixelsPerMeter(Ee,1)/ke(1,Ee)}if(Qr(_e,ve,I))return!0}return!1}function ht(c,s,l,h){const p=$r([],[c,s,l,1],h);return new Qt(p[0]/p[3],p[1]/p[3])}const bt=Xe(0,0,0),nr=Xe(0,0,1);function Dr(c,s){const l=xe();return bt[2]=s,c.intersectsPlane(bt,nr,l),new Qt(l[0],l[1])}class Fr extends vr{}let Lr,ln,xn,Cn;function ao(c,{width:s,height:l},h,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==s*l*h)throw new RangeError("mismatched image size")}else p=new Uint8Array(s*l*h);return c.width=s,c.height=l,c.data=p,c}function qt(c,s,l){const{width:h,height:p}=s;h===c.width&&p===c.height||(It(c,s,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,h),height:Math.min(c.height,p)},l,null),c.width=h,c.height=p,c.data=s.data)}function It(c,s,l,h,p,v,x,P){if(p.width===0||p.height===0)return s;if(p.width>c.width||p.height>c.height||l.x>c.width-p.width||l.y>c.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>s.width||p.height>s.height||h.x>s.width-p.width||h.y>s.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const I=c.data,R=s.data,$=v===4&&P;for(let U=0;U<p.height;U++){const W=((l.y+U)*c.width+l.x)*v,te=((h.y+U)*s.width+h.x)*v;if($)for(let re=0;re<p.width;re++){const le=W+re*v+3,ve=te+re*v;R[ve+0]=255,R[ve+1]=255,R[ve+2]=255,R[ve+3]=I[le]}else if(x)for(let re=0;re<p.width;re++){const le=W+re*v,ve=te+re*v,_e=I[le+3],Ce=new Pn(I[le+0]/255*_e,I[le+1]/255*_e,I[le+2]/255*_e,_e).toRenderColor(x).toArray();R[ve+0]=Ce[0],R[ve+1]=Ce[1],R[ve+2]=Ce[2],R[ve+3]=Ce[3]}else for(let re=0;re<p.width*v;re++)R[te+re]=I[W+re]}return s}yr(Fr,"HeatmapBucket",{omit:["layers"]});class Gt{constructor(s,l){ao(this,s,1,l)}resize(s){qt(this,new Gt(s),1)}clone(){return new Gt({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,l,h,p,v){It(s,l,h,p,v,1,null)}}class kr{constructor(s,l){ao(this,s,4,l)}resize(s){qt(this,new kr(s),4)}replace(s,l){l?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s}clone(){return new kr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,l,h,p,v,x,P){It(s,l,h,p,v,4,x,P)}}class In{constructor(s,l){this.width=s.width,this.height=s.height,this.data=l instanceof Uint8Array?new Float32Array(l.buffer):l}}function Nn(c){const s={},l=c.resolution||256,h=c.clips?c.clips.length:1,p=c.image||new kr({width:l,height:h}),v=(x,P,I)=>{s[c.evaluationKey]=I;const R=c.expression.evaluate(s);R&&(p.data[x+P+0]=Math.floor(255*R.r/R.a),p.data[x+P+1]=Math.floor(255*R.g/R.a),p.data[x+P+2]=Math.floor(255*R.b/R.a),p.data[x+P+3]=Math.floor(255*R.a))};if(c.clips)for(let x=0,P=0;x<h;++x,P+=4*l)for(let I=0,R=0;I<l;I++,R+=4){const $=I/(l-1),{start:U,end:W}=c.clips[x];v(P,R,U*(1-$)+W*$)}else for(let x=0,P=0;x<l;x++,P+=4)v(0,P,x/(l-1));return p}yr(Gt,"AlphaImage"),yr(kr,"RGBAImage");const Gn=qn([{name:"a_pos",components:2,type:"Int16"}],4),ti=qn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),ea=qn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),rs=qn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function gc(c,s,l=2){const h=s&&s.length,p=h?s[0]*l:c.length;let v=a1(c,0,p,l,!0);const x=[];if(!v||v.next===v.prev)return x;let P,I,R;if(h&&(v=function($,U,W,te){const re=[];for(let le=0,ve=U.length;le<ve;le++){const _e=a1($,U[le]*te,le<ve-1?U[le+1]*te:$.length,te,!1);_e===_e.next&&(_e.steiner=!0),re.push(Mee(_e))}re.sort(Cee);for(let le=0;le<re.length;le++)W=Aee(re[le],W);return W}(c,s,v,l)),c.length>80*l){P=1/0,I=1/0;let $=-1/0,U=-1/0;for(let W=l;W<p;W+=l){const te=c[W],re=c[W+1];te<P&&(P=te),re<I&&(I=re),te>$&&($=te),re>U&&(U=re)}R=Math.max($-P,U-I),R=R!==0?32767/R:0}return n0(v,x,l,P,I,R,0),x}function a1(c,s,l,h,p){let v;if(p===function(x,P,I,R){let $=0;for(let U=P,W=I-R;U<I;U+=R)$+=(x[W]-x[U])*(x[U+1]+x[W+1]),W=U;return $}(c,s,l,h)>0)for(let x=s;x<l;x+=h)v=mN(x/h|0,c[x],c[x+1],v);else for(let x=l-h;x>=s;x-=h)v=mN(x/h|0,c[x],c[x+1],v);return v&&Jy(v,v.next)&&(o0(v),v=v.next),v}function Bg(c,s){if(!c)return c;s||(s=c);let l,h=c;do if(l=!1,h.steiner||!Jy(h,h.next)&&vo(h.prev,h,h.next)!==0)h=h.next;else{if(o0(h),h=s=h.prev,h===h.next)break;l=!0}while(l||h!==s);return s}function n0(c,s,l,h,p,v,x){if(!c)return;!x&&v&&function(I,R,$,U){let W=I;do W.z===0&&(W.z=J2(W.x,W.y,R,$,U)),W.prevZ=W.prev,W.nextZ=W.next,W=W.next;while(W!==I);W.prevZ.nextZ=null,W.prevZ=null,function(te){let re,le=1;do{let ve,_e=te;te=null;let Ce=null;for(re=0;_e;){re++;let Ee=_e,ue=0;for(let Te=0;Te<le&&(ue++,Ee=Ee.nextZ,Ee);Te++);let we=le;for(;ue>0||we>0&&Ee;)ue!==0&&(we===0||!Ee||_e.z<=Ee.z)?(ve=_e,_e=_e.nextZ,ue--):(ve=Ee,Ee=Ee.nextZ,we--),Ce?Ce.nextZ=ve:te=ve,ve.prevZ=Ce,Ce=ve;_e=Ee}Ce.nextZ=null,le*=2}while(re>1)}(W)}(c,h,p,v);let P=c;for(;c.prev!==c.next;){const I=c.prev,R=c.next;if(v?See(c,h,p,v):wee(c))s.push(I.i,c.i,R.i),o0(c),c=R.next,P=R.next;else if((c=R)===P){x?x===1?n0(c=Eee(Bg(c),s),s,l,h,p,v,2):x===2&&Tee(c,s,l,h,p,v):n0(Bg(c),s,l,h,p,v,1);break}}}function wee(c){const s=c.prev,l=c,h=c.next;if(vo(s,l,h)>=0)return!1;const p=s.x,v=l.x,x=h.x,P=s.y,I=l.y,R=h.y,$=Math.min(p,v,x),U=Math.min(P,I,R),W=Math.max(p,v,x),te=Math.max(P,I,R);let re=h.next;for(;re!==s;){if(re.x>=$&&re.x<=W&&re.y>=U&&re.y<=te&&i0(p,P,v,I,x,R,re.x,re.y)&&vo(re.prev,re,re.next)>=0)return!1;re=re.next}return!0}function See(c,s,l,h){const p=c.prev,v=c,x=c.next;if(vo(p,v,x)>=0)return!1;const P=p.x,I=v.x,R=x.x,$=p.y,U=v.y,W=x.y,te=Math.min(P,I,R),re=Math.min($,U,W),le=Math.max(P,I,R),ve=Math.max($,U,W),_e=J2(te,re,s,l,h),Ce=J2(le,ve,s,l,h);let Ee=c.prevZ,ue=c.nextZ;for(;Ee&&Ee.z>=_e&&ue&&ue.z<=Ce;){if(Ee.x>=te&&Ee.x<=le&&Ee.y>=re&&Ee.y<=ve&&Ee!==p&&Ee!==x&&i0(P,$,I,U,R,W,Ee.x,Ee.y)&&vo(Ee.prev,Ee,Ee.next)>=0||(Ee=Ee.prevZ,ue.x>=te&&ue.x<=le&&ue.y>=re&&ue.y<=ve&&ue!==p&&ue!==x&&i0(P,$,I,U,R,W,ue.x,ue.y)&&vo(ue.prev,ue,ue.next)>=0))return!1;ue=ue.nextZ}for(;Ee&&Ee.z>=_e;){if(Ee.x>=te&&Ee.x<=le&&Ee.y>=re&&Ee.y<=ve&&Ee!==p&&Ee!==x&&i0(P,$,I,U,R,W,Ee.x,Ee.y)&&vo(Ee.prev,Ee,Ee.next)>=0)return!1;Ee=Ee.prevZ}for(;ue&&ue.z<=Ce;){if(ue.x>=te&&ue.x<=le&&ue.y>=re&&ue.y<=ve&&ue!==p&&ue!==x&&i0(P,$,I,U,R,W,ue.x,ue.y)&&vo(ue.prev,ue,ue.next)>=0)return!1;ue=ue.nextZ}return!0}function Eee(c,s){let l=c;do{const h=l.prev,p=l.next.next;!Jy(h,p)&&fN(h,l,l.next,p)&&s0(h,p)&&s0(p,h)&&(s.push(h.i,l.i,p.i),o0(l),o0(l.next),l=c=p),l=l.next}while(l!==c);return Bg(l)}function Tee(c,s,l,h,p,v){let x=c;do{let P=x.next.next;for(;P!==x.prev;){if(x.i!==P.i&&Iee(x,P)){let I=pN(x,P);return x=Bg(x,x.next),I=Bg(I,I.next),n0(x,s,l,h,p,v,0),void n0(I,s,l,h,p,v,0)}P=P.next}x=x.next}while(x!==c)}function Cee(c,s){let l=c.x-s.x;return l===0&&(l=c.y-s.y,l===0)&&(l=(c.next.y-c.y)/(c.next.x-c.x)-(s.next.y-s.y)/(s.next.x-s.x)),l}function Aee(c,s){const l=function(p,v){let x=v;const P=p.x,I=p.y;let R,$=-1/0;if(Jy(p,x))return x;do{if(Jy(p,x.next))return x.next;if(I<=x.y&&I>=x.next.y&&x.next.y!==x.y){const le=x.x+(I-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(le<=P&&le>$&&($=le,R=x.x<x.next.x?x:x.next,le===P))return R}x=x.next}while(x!==v);if(!R)return null;const U=R,W=R.x,te=R.y;let re=1/0;x=R;do{if(P>=x.x&&x.x>=W&&P!==x.x&&hN(I<te?P:$,I,W,te,I<te?$:P,I,x.x,x.y)){const le=Math.abs(I-x.y)/(P-x.x);s0(x,p)&&(le<re||le===re&&(x.x>R.x||x.x===R.x&&Pee(R,x)))&&(R=x,re=le)}x=x.next}while(x!==U);return R}(c,s);if(!l)return s;const h=pN(l,c);return Bg(h,h.next),Bg(l,l.next)}function Pee(c,s){return vo(c.prev,c,s.prev)<0&&vo(s.next,c,c.next)<0}function J2(c,s,l,h,p){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-l)*p|0)|c<<8))|c<<4))|c<<2))|c<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-h)*p|0)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function Mee(c){let s=c,l=c;do(s.x<l.x||s.x===l.x&&s.y<l.y)&&(l=s),s=s.next;while(s!==c);return l}function hN(c,s,l,h,p,v,x,P){return(p-x)*(s-P)>=(c-x)*(v-P)&&(c-x)*(h-P)>=(l-x)*(s-P)&&(l-x)*(v-P)>=(p-x)*(h-P)}function i0(c,s,l,h,p,v,x,P){return!(c===x&&s===P)&&hN(c,s,l,h,p,v,x,P)}function Iee(c,s){return c.next.i!==s.i&&c.prev.i!==s.i&&!function(l,h){let p=l;do{if(p.i!==l.i&&p.next.i!==l.i&&p.i!==h.i&&p.next.i!==h.i&&fN(p,p.next,l,h))return!0;p=p.next}while(p!==l);return!1}(c,s)&&(s0(c,s)&&s0(s,c)&&function(l,h){let p=l,v=!1;const x=(l.x+h.x)/2,P=(l.y+h.y)/2;do p.y>P!=p.next.y>P&&p.next.y!==p.y&&x<(p.next.x-p.x)*(P-p.y)/(p.next.y-p.y)+p.x&&(v=!v),p=p.next;while(p!==l);return v}(c,s)&&(vo(c.prev,c,s.prev)||vo(c,s.prev,s))||Jy(c,s)&&vo(c.prev,c,c.next)>0&&vo(s.prev,s,s.next)>0)}function vo(c,s,l){return(s.y-c.y)*(l.x-s.x)-(s.x-c.x)*(l.y-s.y)}function Jy(c,s){return c.x===s.x&&c.y===s.y}function fN(c,s,l,h){const p=c1(vo(c,s,l)),v=c1(vo(c,s,h)),x=c1(vo(l,h,c)),P=c1(vo(l,h,s));return p!==v&&x!==P||!(p!==0||!l1(c,l,s))||!(v!==0||!l1(c,h,s))||!(x!==0||!l1(l,c,h))||!(P!==0||!l1(l,s,h))}function l1(c,s,l){return s.x<=Math.max(c.x,l.x)&&s.x>=Math.min(c.x,l.x)&&s.y<=Math.max(c.y,l.y)&&s.y>=Math.min(c.y,l.y)}function c1(c){return c>0?1:c<0?-1:0}function s0(c,s){return vo(c.prev,c,c.next)<0?vo(c,s,c.next)>=0&&vo(c,c.prev,s)>=0:vo(c,s,c.prev)<0||vo(c,c.next,s)<0}function pN(c,s){const l=Q2(c.i,c.x,c.y),h=Q2(s.i,s.x,s.y),p=c.next,v=s.prev;return c.next=s,s.prev=c,l.next=p,p.prev=l,h.next=l,l.prev=h,v.next=h,h.prev=v,h}function mN(c,s,l,h){const p=Q2(c,s,l);return h?(p.next=h.next,p.prev=h,h.next.prev=p,h.next=p):(p.prev=p,p.next=p),p}function o0(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function Q2(c,s,l){return{i:c,x:s,y:l,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function u1(c,s){const l=c.length;if(l<=1)return[c];const h=[];let p,v;for(let x=0;x<l;x++){const P=Tn(c[x]);P!==0&&(c[x].area=Math.abs(P),v===void 0&&(v=P<0),v===P<0?(p&&h.push(p),p=[c[x]]):p.push(c[x]))}if(p&&h.push(p),s>1)for(let x=0;x<h.length;x++)h[x].length<=s||(Lc(h[x],s,1,h[x].length-1,kee),h[x]=h[x].slice(0,s));return h}function kee(c,s){return s.area-c.area}function gN(c,s,l=1){if(!c)return null;const h=typeof c=="string"?ca.from(c).getPrimary():c.getPrimary(),p=typeof c=="string"?null:c.getSecondary();for(const v of[h,p]){if(!v)continue;const x=v.id.toString();s.has(x)||s.set(x,[]),v.scaleSelf(l),s.get(x).push(v)}return{primary:h.toString(),secondary:p?p.toString():null}}function eT(c,s,l,h){const p=h.patternDependencies;let v=!1;for(const x of s){const P=x.paint.get(`${c}-pattern`);P.isConstant()||(v=!0),gN(P.constantOr(null),p,l)&&(v=!0)}return v}function tT(c,s,l,h,p,v){const x=v.patternDependencies;for(const P of s){const I=P.paint.get(`${c}-pattern`).value;if(I.kind!=="constant"){let R=I.evaluate({zoom:h},l,{},v.availableImages);R=R&&R.name?R.name:R;const $=gN(R,x,p);if(!$)continue;const{primary:U,secondary:W}=$;U&&(l.patterns[P.id]=[U,W].filter(Boolean))}}return l}var rT,yN,nT,vN,iT,_N,xN,d1={};function bN(){if(yN)return rT;yN=1;var c=oa();function s(p,v,x,P,I){this.properties={},this.extent=x,this.type=0,this._pbf=p,this._geometry=-1,this._keys=P,this._values=I,p.readFields(l,this,v)}function l(p,v,x){p==1?v.id=x.readVarint():p==2?function(P,I){for(var R=P.readVarint()+P.pos;P.pos<R;){var $=I._keys[P.readVarint()],U=I._values[P.readVarint()];I.properties[$]=U}}(x,v):p==3?v.type=x.readVarint():p==4&&(v._geometry=x.pos)}function h(p){for(var v,x,P=0,I=0,R=p.length,$=R-1;I<R;$=I++)P+=((x=p[$]).x-(v=p[I]).x)*(v.y+x.y);return P}return rT=s,s.types=["Unknown","Point","LineString","Polygon"],s.prototype.loadGeometry=function(){var p=this._pbf;p.pos=this._geometry;for(var v,x=p.readVarint()+p.pos,P=1,I=0,R=0,$=0,U=[];p.pos<x;){if(I<=0){var W=p.readVarint();P=7&W,I=W>>3}if(I--,P===1||P===2)R+=p.readSVarint(),$+=p.readSVarint(),P===1&&(v&&U.push(v),v=[]),v.push(new c(R,$));else{if(P!==7)throw new Error("unknown command "+P);v&&v.push(v[0].clone())}}return v&&U.push(v),U},s.prototype.bbox=function(){var p=this._pbf;p.pos=this._geometry;for(var v=p.readVarint()+p.pos,x=1,P=0,I=0,R=0,$=1/0,U=-1/0,W=1/0,te=-1/0;p.pos<v;){if(P<=0){var re=p.readVarint();x=7&re,P=re>>3}if(P--,x===1||x===2)(I+=p.readSVarint())<$&&($=I),I>U&&(U=I),(R+=p.readSVarint())<W&&(W=R),R>te&&(te=R);else if(x!==7)throw new Error("unknown command "+x)}return[$,W,U,te]},s.prototype.toGeoJSON=function(p,v,x){var P,I,R=this.extent*Math.pow(2,x),$=this.extent*p,U=this.extent*v,W=this.loadGeometry(),te=s.types[this.type];function re(_e){for(var Ce=0;Ce<_e.length;Ce++){var Ee=_e[Ce];_e[Ce]=[360*(Ee.x+$)/R-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ee.y+U)/R)*Math.PI/180))-90]}}switch(this.type){case 1:var le=[];for(P=0;P<W.length;P++)le[P]=W[P][0];re(W=le);break;case 2:for(P=0;P<W.length;P++)re(W[P]);break;case 3:for(W=function(_e){var Ce=_e.length;if(Ce<=1)return[_e];for(var Ee,ue,we=[],Te=0;Te<Ce;Te++){var Ie=h(_e[Te]);Ie!==0&&(ue===void 0&&(ue=Ie<0),ue===Ie<0?(Ee&&we.push(Ee),Ee=[_e[Te]]):Ee.push(_e[Te]))}return Ee&&we.push(Ee),we}(W),P=0;P<W.length;P++)for(I=0;I<W[P].length;I++)re(W[P][I])}W.length===1?W=W[0]:te="Multi"+te;var ve={type:"Feature",geometry:{type:te,coordinates:W},properties:this.properties};return"id"in this&&(ve.id=this.id),ve},rT}function wN(){if(vN)return nT;vN=1;var c=bN();function s(h,p){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=h,this._keys=[],this._values=[],this._features=[],h.readFields(l,this,p),this.length=this._features.length}function l(h,p,v){h===15?p.version=v.readVarint():h===1?p.name=v.readString():h===5?p.extent=v.readVarint():h===2?p._features.push(v.pos):h===3?p._keys.push(v.readString()):h===4&&p._values.push(function(x){for(var P=null,I=x.readVarint()+x.pos;x.pos<I;){var R=x.readVarint()>>3;P=R===1?x.readString():R===2?x.readFloat():R===3?x.readDouble():R===4?x.readVarint64():R===5?x.readVarint():R===6?x.readSVarint():R===7?x.readBoolean():null}return P}(v))}return nT=s,s.prototype.feature=function(h){if(h<0||h>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[h];var p=this._pbf.readVarint()+this._pbf.pos;return new c(this._pbf,p,this.extent,this._keys,this._values)},nT}function SN(){return xN||(xN=1,d1.VectorTile=function(){if(_N)return iT;_N=1;var c=wN();function s(l,h,p){if(l===3){var v=new c(p,p.readVarint()+p.pos);v.length&&(h[v.name]=v)}}return iT=function(l,h){this.layers=l.readFields(s,{},h)},iT}(),d1.VectorTileFeature=bN(),d1.VectorTileLayer=wN()),d1}var vm=SN();const $g="3d_elevation_id",EN="level";class Oee{constructor(){this._valid=!1}reset(s){return this.feature=s,this._valid=!0,this._geometry=s.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(s,l){return this._valid&&s(l(this._geometry)),this}require(s,l,h){return this.get(s,!0,l,h)}optional(s,l,h){return this.get(s,!1,l,h)}success(){return this._valid}get(s,l,h,p){const v=this.feature.properties.hasOwnProperty(s)?+this.feature.properties[s]:void 0;return this._valid&&v!==void 0&&!Number.isNaN(v)?h(p?p(v):v):l&&(this._valid=!1),this}}class TN{constructor(s,l){this.featureFunc=s,this.vertexFunc=l}parseFeature(s,l,h){return this.featureFunc(s,l,h)}parseVertex(s,l,h){return this.vertexFunc(s,l,h)}}const Lee=new TN((c,s,l)=>c.reset(s).require($g,h=>{l.id=h}).optional("fixed_height_relative",h=>{l.constantHeight=h},Vg.decodeRelativeHeight).geometry(h=>{l.bounds=h},Np).success(),(c,s,l)=>c.reset(s).require($g,h=>{l.id=h}).require("elevation_idx",h=>{l.idx=h}).require("extent",h=>{l.extent=h}).require("height_relative",h=>{l.height=h},Vg.decodeRelativeHeight).geometry(h=>{l.position=h},Vg.getPoint).success()),Ree=new TN((c,s,l)=>c.reset(s).require($g,h=>{l.id=h}).optional("fixed_height",h=>{l.constantHeight=h},Vg.decodeMetricHeight).geometry(h=>{l.bounds=h},Np).success(),(c,s,l)=>c.reset(s).require($g,h=>{l.id=h}).require("elevation_idx",h=>{l.idx=h}).require("extent",h=>{l.extent=h}).require("height",h=>{l.height=h},Vg.decodeMetricHeight).geometry(h=>{l.position=h},Vg.getPoint).success());class Vg{static getPoint(s){return Uo(s[0][0].x,s[0][0].y)}static decodeRelativeHeight(s){return 1e-4*s*5}static decodeMetricHeight(s){return 1e-4*s}static parse(s){const l=[],h=[],p=s.length,v=new Oee;for(let P=0;P<p;P++){const I=s.feature(P),R=I.properties.hasOwnProperty("version")?String(I.properties.version):void 0,$=(x=R)?x==="1.0.1"?Ree:void 0:Lee;if($===void 0){sn(`Unknown elevation feature version number ${R||"(unknown)"}`);continue}const U=I.properties.hasOwnProperty("type")?I.properties.type:void 0;if(U){if(vm.VectorTileFeature.types[I.type]==="Point"&&U==="curve_point"){const W={};$.parseVertex(v,I,W)&&l.push(W)}else if(vm.VectorTileFeature.types[I.type]==="Polygon"&&U==="curve_meta"){const W={};$.parseFeature(v,I,W)&&h.push(W)}}}var x;return{vertices:l,features:h}}}class CN{constructor(s,l){this.feature=s,this.metersToTile=l,this.index=0}get(){const s=this.feature.vertices[this.index],l=this.feature.vertexProps[this.index].dir,h=l[1],p=-l[0],v=(s.extent+1)*this.metersToTile;return[new Qt(Math.trunc(s.position[0]+h*v),Math.trunc(s.position[1]+p*v)),new Qt(Math.trunc(s.position[0]-h*v),Math.trunc(s.position[1]-p*v))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class sT{constructor(s,l,h,p,v,x){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=s,this.heightRange={min:h,max:h},this.safeArea=l,this.constantHeight=h,this.constantHeight==null&&(this.constantHeight!=null||p.length!==0)){this.vertices=p,this.edges=v,this.edges=this.edges.filter(P=>{return P.a<this.vertices.length&&P.b<this.vertices.length&&!((I=this.vertices[P.a].position)[0]===(R=this.vertices[P.b].position)[0]&&I[1]===R[1]);var I,R}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const P of this.vertices)this.vertexProps.push({dir:Uo(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,P.height),this.heightRange.max=Math.max(this.heightRange.max,P.height);for(const P of this.edges){const I=this.vertices[P.a].position,R=this.vertices[P.b].position,$=Js(es(),R,I),U=wo($),W=bo(es(),$,1/U);this.edgeProps.push({vec:$,dir:W,len:U});const te=this.vertexProps[P.a].dir,re=this.vertexProps[P.b].dir;Ys(te,te,W),Ys(re,re,W)}for(const P of this.vertexProps)P.dir[0]===0&&P.dir[1]===0||So(P.dir,P.dir);this.tessellate(x)}}pointElevation(s){if(this.constantHeight!=null)return this.constantHeight;const l=this.getClosestEdge(s);if(l==null)return 0;const[h,p]=l;return((v,x,P)=>(1-P)*v+P*x)(this.vertices[this.edges[h].a].height,this.vertices[this.edges[h].b].height,p)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(s){if(this.edges.length===0)return;let l=0,h=Number.POSITIVE_INFINITY,p=0;const v=Uo(s.x,s.y);for(let x=0;x<this.edges.length;x++){const P=this.edges[x],I=this.edgeProps[x].dir,R=new hl(v,this.edgeProps[x].dir),$=this.vertices[P.a].position,U=this.vertices[P.b].position,W=es(),te=es(),re=R.intersectsPlane($,this.vertexProps[P.a].dir,W),le=R.intersectsPlane(U,this.vertexProps[P.b].dir,te);if(!re||!le)continue;const ve=Js(es(),te,W),_e=Js(es(),v,W),Ce=Jn(ve,ve),Ee=Ce>0?Jn(_e,ve)/Ce:0,ue=rt(Ee,0,1),we=Math.abs((Ee-ue)*this.edgeProps[x].len),Te=Js(es(),v,$),Ie=we+Math.abs(Jn(Te,Uo(I[1],-I[0])));Ie<h&&(l=x,h=Ie,p=ue)}return[l,p]}tessellate(s){for(let l=this.edges.length-1;l>=0;--l){const h=this.edges[l].a,p=this.edges[l].b,{position:v,height:x,extent:P}=this.vertices[h],{position:I,height:R,extent:$}=this.vertices[p],U=this.vertexProps[h].dir,W=this.vertexProps[p].dir,te=Xe(v[0]/s,v[1]/s,x),re=Xe(I[0]/s,I[1]/s,R),le=Xe(U[1],-U[0],0);Ue(le,le,P);const ve=Xe(W[1],-W[0],0);if(Ue(ve,ve,$),this.distSqLines(Xe(te[0]+.5*le[0],te[1]+.5*le[1],te[2]+.5*le[2]),Xe(re[0]-.5*ve[0],re[1]-.5*ve[1],re[2]-.5*ve[2]),Xe(te[0]-.5*le[0],te[1]-.5*le[1],te[2]-.5*le[2]),Xe(re[0]+.5*ve[0],re[1]+.5*ve[1],re[2]+.5*ve[2]))<=.0025000000000000005)continue;const _e=this.vertices.length,Ce=Ys(es(),v,I);this.vertices.push({position:bo(Ce,Ce,.5),height:.5*(x+R),extent:.5*(P+$)});const Ee=Ys(es(),U,W);this.vertexProps.push({dir:So(Ee,Ee)}),this.edges.splice(l,1),this.edgeProps.splice(l,1),this.edges.push({a:h,b:_e}),this.edges.push({a:_e,b:p});const ue=Js(es(),this.vertices[_e].position,v),we=wo(ue),Te={vec:ue,dir:bo(es(),ue,1/we),len:we};this.edgeProps.push(Te),this.edgeProps.push(Te)}}distSqLines(s,l,h,p){const v=tt(xe(),l,s),x=tt(xe(),p,h),P=tt(xe(),s,h),I=Et(v,v),R=Et(v,x),$=Et(v,P),U=Et(x,x),W=Et(x,P),te=I*U-R*R;if(te===0){const ve=Et(P,x)/Et(x,x);return Ke(Wt(xe(),h,p,ve),s)}const re=(R*W-$*U)/te,le=(I*W-R*$)/te;return Ke(Wt(xe(),s,l,re),Wt(xe(),h,p,le))}}class oT{static parseFrom(s,l){const h=Vg.parse(s);if(!h)return[];let{vertices:p,features:v}=h;const x=1/at(l);v.sort(($,U)=>$.id-U.id),p.sort(($,U)=>$.id-U.id||$.idx-U.idx),p=p.filter(($,U,W)=>U===W.findIndex(te=>te.id===$.id&&te.idx===$.idx));const P=new Array;let I=0;const R=p.length;for(const $ of v){if($.constantHeight){P.push(new sT($.id,$.bounds,$.constantHeight));continue}for(;I!==R&&p[I].id<$.id;)I++;if(I===R||p[I].id!==$.id)continue;const U=new Array,W=new Array,te=I;for(;I!==R&&p[I].id===$.id;){const re=p[I];if(U.push({position:re.position,height:re.height,extent:re.extent}),I!==te&&p[I-1].idx===re.idx-1){const le=I-te;W.push({a:le-1,b:le})}I++}P.push(new sT($.id,$.bounds,void 0,U,W,x))}return P}static getElevationFeature(s,l){if(!l)return;const h=+s.properties[$g];return Number.isNaN(h)?void 0:l.find(p=>p.id===h)}}class AN{constructor(s,l){this.zScale=1,this.xOffset=0,this.yOffset=0,s.equals(l)||(this.zScale=Math.pow(2,l.z-s.z),this.xOffset=(s.x*this.zScale-l.x)*or,this.yOffset=(s.y*this.zScale-l.y)*or)}constantElevation(s,l){if(s.constantHeight!=null)return this.computeBiasedHeight(s.constantHeight,l)}pointElevation(s,l,h){const p=this.constantElevation(l,h);return p??(s.x=s.x*this.zScale+this.xOffset,s.y=s.y*this.zScale+this.yOffset,this.computeBiasedHeight(l.pointElevation(s),h))}computeBiasedHeight(s,l){return l<=0?s:s+l*nt(0,l,s>=0?s:Math.abs(.5*s))}}yr(sT,"ElevationFeature");class PN{constructor(){this.polygons=new Map}add(s,...l){this.polygons.has(s)?this.polygons.get(s).push(...l):this.polygons.set(s,l)}merge(s){for(const[l,h]of s.polygons)this.add(l,...h)}}class Ug{constructor(){this.portals=[]}static evaluate(s){if(s.length===0)return new Ug;let l=[];for(const R of s)l.push(...R.portals);if(l.length===0)return new Ug;const h=(R,$)=>R<=0&&$<=0||R>=or&&$>=or;for(const R of l){const $=R.va,U=R.vb;(h($.x,U.x)||h($.y,U.y))&&(R.type="border")}const p=l.filter(R=>R.type!=="unevaluated"),v=l.filter(R=>R.type==="unevaluated");if(v.length===0)return new Ug;v.sort((R,$)=>R.hash===$.hash?R.isTunnel===$.isTunnel?0:R.isTunnel?-1:1:R.hash<$.hash?1:-1),l=p.concat(v);let x=p.length,P=x,I=x;do if(P++,P===l.length||l[x].hash!==l[P].hash){if(P-x==2){I<x&&(l[I]=l[x],l[x]=null);const R=l[I],$=l[P-1];R.type=R.isTunnel!==$.isTunnel?"tunnel":"polygon",R.connection={a:R.connection.a,b:$.connection.a},I++}x=P}while(x!==l.length);return l.splice(I),l.sort((R,$)=>R.hash<$.hash?1:-1),{portals:l}}}yr(Ug,"ElevationPortalGraph"),yr(PN,"ElevationPolygons");class jee{constructor(s,l,h){this.outPositions=s,this.outNormals=l,this.outIndices=h,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(s,l,h){let p=s[2];h!=null&&(p*=h);const v=this.getVec3Bits(s)<<96n|this.getVec3Bits(l),x=this.vertexLookup.get(v);if(x!=null)return x;const P=this.outPositions.length;this.vertexLookup.set(v,P);const I=Math.trunc(16384*l[0]),R=Math.trunc(16384*l[1]),$=Math.trunc(16384*l[2]);return this.outPositions.emplaceBack(s[0],s[1],p),this.outNormals.emplaceBack(I,R,$),P}addVertices(s,l,...h){const p=[];for(const v of h){const x=this.addVertex(v,s,l);p.push(x)}return p}addTriangles(s,l,h){if(l&&h){const p=h.length===1,v=Xe(0,0,0);for(let x=0;x<s.length;x+=3){const P=l[s[x+0]],I=l[s[x+1]],R=l[s[x+2]],$=p?h[0]:h[s[x+1]],U=p?h[0]:h[s[x+2]],W=this.addVertex(Xe(P.x,P.y,p?h[0]:h[s[x+0]]),v),te=this.addVertex(Xe(I.x,I.y,$),v),re=this.addVertex(Xe(R.x,R.y,U),v);this.outIndices.emplaceBack(W,te,re)}}else for(let p=0;p<s.length;p+=3)this.outIndices.emplaceBack(s[p+0],s[p+1],s[p+2])}addQuad(s,l){const h=this.addVertices(l,void 0,...s.map(I=>Xe(I.coord.x,I.coord.y,I.height))),[p,v,x,P]=h;this.addTriangles([p,v,x,x,P,p])}getBits(s){return this.view.setFloat32(0,s),BigInt(this.view.getUint32(0))}getVec3Bits(s){return this.getBits(s[0])<<64n|this.getBits(s[1])<<32n|this.getBits(s[2])}}class yc{constructor(s){this.unevaluatedPortals=new Ug,this.portalPolygons=new PN,this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Hf,this.vertexNormals=new $h,this.indexArray=new bs,this.tileToMeters=at(s)}addVertices(s,l){const h=this.unevalVertices.length;for(let p=0;p<s.length;p++)this.unevalVertices.push(s[p]),this.unevalHeights.push(l[p]);return h}addTriangles(s,l,h){const p=h?this.unevalTunnelTriangles:this.unevalTriangles;for(const v of s)p.push(v+l)}addRenderableRing(s,l,h,p,v){const x=[new Qt(v.min.x,v.min.y),new Qt(v.max.x,v.min.y),new Qt(v.max.x,v.max.y),new Qt(v.min.x,v.max.y)];for(let P=0;P<h-1;P++){const I=l+P,R=I+1,$=this.unevalVertices[I],U=this.unevalVertices[R];if(!($.x>=v.min.x&&$.x<=v.max.x&&$.y>=v.min.y&&$.y<=v.max.y||U.x>=v.min.x&&U.x<=v.max.x&&U.y>=v.min.y&&U.y<=v.max.y||Hi($,U,x))||this.isOnBorder($.x,U.x)||this.isOnBorder($.y,U.y))continue;const W=yc.computeEdgeHash(this.unevalVertices[I],this.unevalVertices[R]);let te,re=this.vertexHashLookup.get(yc.computePosHash($));re!=null?te=re.next:(re=this.vertexHashLookup.get(yc.computePosHash(U)),te=re!=null?re.prev:W),this.unevalEdges.push({polygonIdx:s,a:I,b:R,hash:W,portalHash:te,isTunnel:p,type:"unevaluated"})}}addPortalCandidates(s,l,h,p,v){if(l.length===0)return;this.portalPolygons.add(s,{geometry:l,zLevel:v});const x=l[0];this.vertexHashLookup.clear();let P=yc.computeEdgeHash(x[x.length-2],x[x.length-1]);for(let I=0;I<x.length-1;I++){const R=x[I+0],$=x[I+1],U=Uo($.x-R.x,$.y-R.y),W=wo(U);if(W===0)continue;let te="unevaluated";const re=p.pointElevation(R),le=p.pointElevation($);Math.abs(re)<.01&&Math.abs(le)<.01?te="entrance":(this.isOnBorder(R.x,$.x)||this.isOnBorder(R.y,$.y))&&(te="border");const ve=yc.computeEdgeHash(R,$);this.unevaluatedPortals.portals.push({connection:{a:s,b:void 0},va:R,vb:$,vab:U,length:W,hash:ve,isTunnel:h,type:te});const _e=yc.computePosHash(R);this.vertexHashLookup.set(_e,{prev:P,next:ve}),P=ve}}construct(s){if(this.unevalVertices.length===0)return;const l=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),h=U=>{U.primitiveLength=this.indexArray.length-U.primitiveOffset},p=new jee(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(s.portals,this.unevalEdges);const v=l(),x=l(),P=l(),I=(U,W)=>{U.sort((re,le)=>re.type===W&&le.type!==W?-1:re.type!==W&&le.type===W?1:0);const te=U.findIndex(re=>re.type!==W);return te>=0?te:U.length};let R=0;this.unevalEdges.length>0&&(R=I(this.unevalEdges,"none"),this.constructBridgeStructures(p,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:R},this.tileToMeters));const $=l();if(this.unevalEdges.length>0){const U=this.unevalEdges.splice(R),W=I(U,"tunnel")+R;this.unevalEdges.push(...U),this.constructTunnelStructures(p,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:R},{min:R,max:W})}h(P),p.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),h($),p.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),h(x),p.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),h(v),this.maskSegments=ji.simpleSegment(0,$.primitiveOffset,0,$.primitiveLength),this.depthSegments=ji.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength),this.renderableSegments=ji.simpleSegment(0,P.primitiveOffset,0,P.primitiveLength),this.shadowCasterSegments=ji.simpleSegment(0,v.primitiveOffset,0,v.primitiveLength)}upload(s){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=s.createVertexBuffer(this.vertexPositions,ea.members),this.vertexBufferNormal=s.createVertexBuffer(this.vertexNormals,rs.members),this.indexBuffer=s.createIndexBuffer(this.indexArray))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableSegments.destroy(),this.shadowCasterSegments.destroy())}computeVertexConnections(s,l,h,p,v){const x=new Map;for(let P=p;P<v;P++){const I=h[P],R=I.a,$=I.b,U=yc.computePosHash(s[R]),W=yc.computePosHash(s[$]);x.has(U)||x.set(U,{}),x.has(W)||x.set(W,{});const te=x.get(U),re=x.get(W);l[R]<=0&&l[$]<=0||(te.to=$,re.from=R)}return x}constructBridgeStructures(s,l,h,p,v,x){const P=this.computeVertexConnections(l,h,p,v.min,v.max),I=1/x,R=.5*I,$=W=>Xe(l[W].x,l[W].y,h[W]*I),U=W=>{const te=P.get(yc.computePosHash(l[W])),re=te.from,le=te.to;if(!re||!le)return;const ve=$(re),_e=$(W),Ce=$(le),Ee=Xe(0,0,0);if(!Jt(ve,_e)){const we=Rt(xe(),_e,ve);Je(Ee,Ee,Ve(we,we))}if(!Jt(Ce,_e)){const we=Rt(xe(),Ce,_e);Je(Ee,Ee,Ve(we,we))}const ue=sr(Ee);return ue>0?Ue(Ee,Ee,1/ue):void 0};for(let W=v.min;W<v.max;W++){const te=p[W],re=this.prepareEdgePoints(l,h,te,(Kt,tn)=>Kt>tn);if(re==null)continue;const le=re[0],ve=re[1],_e=Xe(le.coord.x,le.coord.y,I*le.height),Ce=Xe(ve.coord.x,ve.coord.y,I*ve.height);if(Jt(_e,Ce))continue;const Ee=Rt(xe(),Ce,_e);Ve(Ee,Ee);const ue=Kt=>Ve(Kt,Kt),we=U(te.a)||Ee,Te=U(te.b)||Ee,Ie=ue(Xe(we[1],-we[0],0)),Ge=ue(Xe(Te[1],-Te[0],0)),Qe=ue(kt(xe(),Ie,we)),it=ue(kt(xe(),Ge,Te)),ct=xe(),St=[Je(xe(),_e,Ue(ct,Rt(ct,Ie,Qe),R)),Je(xe(),_e,Ue(ct,Je(ct,Ie,Qe),R)),Je(xe(),_e,Ue(ct,Qe,R)),_e],Vt=[Je(xe(),Ce,Ue(ct,Rt(ct,Ge,it),R)),Je(xe(),Ce,Ue(ct,Je(ct,Ge,it),R)),Je(xe(),Ce,Ue(ct,it,R)),Ce],[Nt,Bt]=s.addVertices(Ie,x,St[0],St[1]),[Xt,xt]=s.addVertices(Ge,x,Vt[0],Vt[1]);s.addTriangles([Nt,Bt,Xt,Bt,xt,Xt]);const[Ft,_t]=s.addVertices(Qe,x,St[1],St[2]),[wt,Yt]=s.addVertices(it,x,Vt[1],Vt[2]);s.addTriangles([Ft,_t,wt,_t,Yt,wt]);const[tr,Or]=s.addVertices(Ye(Ie,Ie),x,St[2],St[3]),[Tr,hr]=s.addVertices(Ye(Ge,Ge),x,Vt[2],Vt[3]);s.addTriangles([tr,Or,Tr,Or,hr,Tr])}}constructTunnelStructures(s,l,h,p,v,x){const P=I=>Ve(I,I);for(let I=v.min;I<v.max;I++){const R=this.prepareEdgePoints(l,h,p[I],(te,re)=>te<re);if(R==null)continue;const[$,U]=R,W=P(Xe(U.coord.y-$.coord.y,-(U.coord.x-$.coord.x),0));s.addQuad([$,U,{coord:U.coord,height:p[I].isTunnel?-.1:0},{coord:$.coord,height:p[I].isTunnel?-.1:0}],W)}for(let I=x.min;I<x.max;I++){const R=p[I],$=l[R.a],U=l[R.b],W=P(Xe(U.y-$.y,-(U.x-$.x),0));s.addQuad([{coord:U,height:0},{coord:$,height:0},{coord:$,height:h[R.a]+4},{coord:U,height:h[R.b]+4}],W),s.addQuad([{coord:$,height:0},{coord:U,height:0},{coord:U,height:h[R.b]+4},{coord:$,height:h[R.a]+4}],W)}}prepareEdgePoints(s,l,h,p){let v=l[h.a],x=l[h.b];const P=p(v,0),I=p(x,0);if(P&&I)return[{coord:s[h.a],height:v},{coord:s[h.b],height:x}];if(!P&&!I)return;const R=s[h.a].clone(),$=s[h.b].clone();if(P){if(!I){const U=x/(x-v);$.x=Br($.x,R.x,U),$.y=Br($.y,R.y,U),x=Br(x,v,U)}}else{const U=v/(v-x);R.x=Br(R.x,$.x,U),R.y=Br(R.y,$.y,U),v=Br(v,x,U)}return[{coord:R,height:v},{coord:$,height:x}]}prepareEdges(s,l){if(l.length===0)return;l.sort((P,I)=>P.hash===I.hash?I.polygonIdx-P.polygonIdx:I.hash>P.hash?1:-1);let h=0,p=0,v=0,x=l[h].polygonIdx;do p++,(p===l.length||l[h].hash!==l[p].hash)&&((p-h==1||l[p-1].polygonIdx!==x)&&(v<h&&(l[v]=l[h],l[h]=null),l[v].type="none",v++),h=p,h!==l.length&&(x=l[h].polygonIdx));while(h!==l.length);if(l.splice(v),l.length!==0&&s.length!==0){l.sort((R,$)=>R.portalHash<$.portalHash?1:-1);let P=0,I=0;for(;P!==l.length&&I!==s.length;){const R=l[P],$=s[I];R.portalHash>$.hash?P++:$.hash>R.portalHash?I++:(R.type=$.type,P++)}}}isOnBorder(s,l){return s<=0&&l<=0||s>=or&&l>=or}static computeEdgeHash(s,l){return(s.y===l.y&&s.x>l.x||s.y>l.y)&&([s,l]=[l,s]),BigInt(yc.computePosHash(s))<<32n|BigInt(yc.computePosHash(l))}static computePosHash(s){return((65535&s.x)<<16|65535&s.y)>>>0}}var MN,IN={exports:{}},kN=(MN||(MN=1,function(c,s){(function(l){function h(Me,Oe){return Me>Oe?1:Me<Oe?-1:0}var p=function(Me,Oe){Me===void 0&&(Me=h),Oe===void 0&&(Oe=!1),this._compare=Me,this._root=null,this._size=0,this._noDuplicates=!!Oe},v={size:{configurable:!0}};function x(Me,Oe,Pt,ir,pr){var fr=pr-ir;if(fr>0){var Ir=ir+Math.floor(fr/2),Wr={key:Oe[Ir],data:Pt[Ir],parent:Me};return Wr.left=x(Wr,Oe,Pt,ir,Ir),Wr.right=x(Wr,Oe,Pt,Ir+1,pr),Wr}return null}function P(Me,Oe,Pt,ir,pr){if(!(Pt>=ir)){for(var fr=Me[Pt+ir>>1],Ir=Pt-1,Wr=ir+1;;){do Ir++;while(pr(Me[Ir],fr)<0);do Wr--;while(pr(Me[Wr],fr)>0);if(Ir>=Wr)break;var Ln=Me[Ir];Me[Ir]=Me[Wr],Me[Wr]=Ln,Ln=Oe[Ir],Oe[Ir]=Oe[Wr],Oe[Wr]=Ln}P(Me,Oe,Pt,Wr,pr),P(Me,Oe,Wr+1,ir,pr)}}p.prototype.rotateLeft=function(Me){var Oe=Me.right;Oe&&(Me.right=Oe.left,Oe.left&&(Oe.left.parent=Me),Oe.parent=Me.parent),Me.parent?Me===Me.parent.left?Me.parent.left=Oe:Me.parent.right=Oe:this._root=Oe,Oe&&(Oe.left=Me),Me.parent=Oe},p.prototype.rotateRight=function(Me){var Oe=Me.left;Oe&&(Me.left=Oe.right,Oe.right&&(Oe.right.parent=Me),Oe.parent=Me.parent),Me.parent?Me===Me.parent.left?Me.parent.left=Oe:Me.parent.right=Oe:this._root=Oe,Oe&&(Oe.right=Me),Me.parent=Oe},p.prototype._splay=function(Me){for(;Me.parent;){var Oe=Me.parent;Oe.parent?Oe.left===Me&&Oe.parent.left===Oe?(this.rotateRight(Oe.parent),this.rotateRight(Oe)):Oe.right===Me&&Oe.parent.right===Oe?(this.rotateLeft(Oe.parent),this.rotateLeft(Oe)):Oe.left===Me&&Oe.parent.right===Oe?(this.rotateRight(Oe),this.rotateLeft(Oe)):(this.rotateLeft(Oe),this.rotateRight(Oe)):Oe.left===Me?this.rotateRight(Oe):this.rotateLeft(Oe)}},p.prototype.splay=function(Me){for(var Oe,Pt,ir,pr,fr;Me.parent;)(Pt=(Oe=Me.parent).parent)&&Pt.parent?((ir=Pt.parent).left===Pt?ir.left=Me:ir.right=Me,Me.parent=ir):(Me.parent=null,this._root=Me),pr=Me.left,fr=Me.right,Me===Oe.left?(Pt&&(Pt.left===Oe?(Oe.right?(Pt.left=Oe.right,Pt.left.parent=Pt):Pt.left=null,Oe.right=Pt,Pt.parent=Oe):(pr?(Pt.right=pr,pr.parent=Pt):Pt.right=null,Me.left=Pt,Pt.parent=Me)),fr?(Oe.left=fr,fr.parent=Oe):Oe.left=null,Me.right=Oe,Oe.parent=Me):(Pt&&(Pt.right===Oe?(Oe.left?(Pt.right=Oe.left,Pt.right.parent=Pt):Pt.right=null,Oe.left=Pt,Pt.parent=Oe):(fr?(Pt.left=fr,fr.parent=Pt):Pt.left=null,Me.right=Pt,Pt.parent=Me)),pr?(Oe.right=pr,pr.parent=Oe):Oe.right=null,Me.left=Oe,Oe.parent=Me)},p.prototype.replace=function(Me,Oe){Me.parent?Me===Me.parent.left?Me.parent.left=Oe:Me.parent.right=Oe:this._root=Oe,Oe&&(Oe.parent=Me.parent)},p.prototype.minNode=function(Me){if(Me===void 0&&(Me=this._root),Me)for(;Me.left;)Me=Me.left;return Me},p.prototype.maxNode=function(Me){if(Me===void 0&&(Me=this._root),Me)for(;Me.right;)Me=Me.right;return Me},p.prototype.insert=function(Me,Oe){var Pt=this._root,ir=null,pr=this._compare;if(this._noDuplicates)for(;Pt;){if(ir=Pt,pr(Pt.key,Me)===0)return;Pt=pr(Pt.key,Me)<0?Pt.right:Pt.left}else for(;Pt;)ir=Pt,Pt=pr(Pt.key,Me)<0?Pt.right:Pt.left;return Pt={key:Me,data:Oe,left:null,right:null,parent:ir},ir?pr(ir.key,Pt.key)<0?ir.right=Pt:ir.left=Pt:this._root=Pt,this.splay(Pt),this._size++,Pt},p.prototype.find=function(Me){for(var Oe=this._root,Pt=this._compare;Oe;){var ir=Pt(Oe.key,Me);if(ir<0)Oe=Oe.right;else{if(!(ir>0))return Oe;Oe=Oe.left}}return null},p.prototype.contains=function(Me){for(var Oe=this._root,Pt=this._compare;Oe;){var ir=Pt(Me,Oe.key);if(ir===0)return!0;Oe=ir<0?Oe.left:Oe.right}return!1},p.prototype.remove=function(Me){var Oe=this.find(Me);if(!Oe)return!1;if(this.splay(Oe),Oe.left)if(Oe.right){var Pt=this.minNode(Oe.right);Pt.parent!==Oe&&(this.replace(Pt,Pt.right),Pt.right=Oe.right,Pt.right.parent=Pt),this.replace(Oe,Pt),Pt.left=Oe.left,Pt.left.parent=Pt}else this.replace(Oe,Oe.left);else this.replace(Oe,Oe.right);return this._size--,!0},p.prototype.removeNode=function(Me){if(!Me)return!1;if(this.splay(Me),Me.left)if(Me.right){var Oe=this.minNode(Me.right);Oe.parent!==Me&&(this.replace(Oe,Oe.right),Oe.right=Me.right,Oe.right.parent=Oe),this.replace(Me,Oe),Oe.left=Me.left,Oe.left.parent=Oe}else this.replace(Me,Me.left);else this.replace(Me,Me.right);return this._size--,!0},p.prototype.erase=function(Me){var Oe=this.find(Me);if(Oe){this.splay(Oe);var Pt=Oe.left,ir=Oe.right,pr=null;Pt&&(Pt.parent=null,pr=this.maxNode(Pt),this.splay(pr),this._root=pr),ir&&(Pt?pr.right=ir:this._root=ir,ir.parent=pr),this._size--}},p.prototype.pop=function(){var Me=this._root,Oe=null;if(Me){for(;Me.left;)Me=Me.left;Oe={key:Me.key,data:Me.data},this.remove(Me.key)}return Oe},p.prototype.next=function(Me){var Oe=Me;if(Oe)if(Oe.right)for(Oe=Oe.right;Oe&&Oe.left;)Oe=Oe.left;else for(Oe=Me.parent;Oe&&Oe.right===Me;)Me=Oe,Oe=Oe.parent;return Oe},p.prototype.prev=function(Me){var Oe=Me;if(Oe)if(Oe.left)for(Oe=Oe.left;Oe&&Oe.right;)Oe=Oe.right;else for(Oe=Me.parent;Oe&&Oe.left===Me;)Me=Oe,Oe=Oe.parent;return Oe},p.prototype.forEach=function(Me){for(var Oe=this._root,Pt=[],ir=!1,pr=0;!ir;)Oe?(Pt.push(Oe),Oe=Oe.left):Pt.length>0?(Me(Oe=Pt.pop(),pr++),Oe=Oe.right):ir=!0;return this},p.prototype.range=function(Me,Oe,Pt,ir){for(var pr=[],fr=this._compare,Ir=this._root;pr.length!==0||Ir;)if(Ir)pr.push(Ir),Ir=Ir.left;else{if(fr((Ir=pr.pop()).key,Oe)>0)break;if(fr(Ir.key,Me)>=0&&Pt.call(ir,Ir))return this;Ir=Ir.right}return this},p.prototype.keys=function(){for(var Me=this._root,Oe=[],Pt=[],ir=!1;!ir;)Me?(Oe.push(Me),Me=Me.left):Oe.length>0?(Me=Oe.pop(),Pt.push(Me.key),Me=Me.right):ir=!0;return Pt},p.prototype.values=function(){for(var Me=this._root,Oe=[],Pt=[],ir=!1;!ir;)Me?(Oe.push(Me),Me=Me.left):Oe.length>0?(Me=Oe.pop(),Pt.push(Me.data),Me=Me.right):ir=!0;return Pt},p.prototype.at=function(Me){for(var Oe=this._root,Pt=[],ir=!1,pr=0;!ir;)if(Oe)Pt.push(Oe),Oe=Oe.left;else if(Pt.length>0){if(Oe=Pt.pop(),pr===Me)return Oe;pr++,Oe=Oe.right}else ir=!0;return null},p.prototype.load=function(Me,Oe,Pt){if(Me===void 0&&(Me=[]),Oe===void 0&&(Oe=[]),Pt===void 0&&(Pt=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var ir=Me.length;return Pt&&P(Me,Oe,0,ir-1,this._compare),this._root=x(null,Me,Oe,0,ir),this._size=ir,this},p.prototype.min=function(){var Me=this.minNode(this._root);return Me?Me.key:null},p.prototype.max=function(){var Me=this.maxNode(this._root);return Me?Me.key:null},p.prototype.isEmpty=function(){return this._root===null},v.size.get=function(){return this._size},p.createTree=function(Me,Oe,Pt,ir,pr){return new p(Pt,pr).load(Me,Oe,ir)},Object.defineProperties(p.prototype,v);var I=0,R=1,$=2,U=3,W=0,te=1,re=2,le=3;function ve(Me,Oe,Pt){Oe===null?(Me.inOut=!1,Me.otherInOut=!0):(Me.isSubject===Oe.isSubject?(Me.inOut=!Oe.inOut,Me.otherInOut=Oe.otherInOut):(Me.inOut=!Oe.otherInOut,Me.otherInOut=Oe.isVertical()?!Oe.inOut:Oe.inOut),Oe&&(Me.prevInResult=!_e(Oe,Pt)||Oe.isVertical()?Oe.prevInResult:Oe));var ir=_e(Me,Pt);Me.resultTransition=ir?function(pr,fr){var Ir,Wr=!pr.inOut,Ln=!pr.otherInOut;switch(fr){case W:Ir=Wr&&Ln;break;case te:Ir=Wr||Ln;break;case le:Ir=Wr^Ln;break;case re:Ir=pr.isSubject?Wr&&!Ln:Ln&&!Wr}return Ir?1:-1}(Me,Pt):0}function _e(Me,Oe){switch(Me.type){case I:switch(Oe){case W:return!Me.otherInOut;case te:return Me.otherInOut;case re:return Me.isSubject&&Me.otherInOut||!Me.isSubject&&!Me.otherInOut;case le:return!0}break;case $:return Oe===W||Oe===te;case U:return Oe===re;case R:return!1}return!1}var Ce=function(Me,Oe,Pt,ir,pr){this.left=Oe,this.point=Me,this.otherEvent=Pt,this.isSubject=ir,this.type=pr||I,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},Ee={inResult:{configurable:!0}};function ue(Me,Oe){return Me[0]===Oe[0]&&Me[1]===Oe[1]}Ce.prototype.isBelow=function(Me){var Oe=this.point,Pt=this.otherEvent.point;return this.left?(Oe[0]-Me[0])*(Pt[1]-Me[1])-(Pt[0]-Me[0])*(Oe[1]-Me[1])>0:(Pt[0]-Me[0])*(Oe[1]-Me[1])-(Oe[0]-Me[0])*(Pt[1]-Me[1])>0},Ce.prototype.isAbove=function(Me){return!this.isBelow(Me)},Ce.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},Ee.inResult.get=function(){return this.resultTransition!==0},Ce.prototype.clone=function(){var Me=new Ce(this.point,this.left,this.otherEvent,this.isSubject,this.type);return Me.contourId=this.contourId,Me.resultTransition=this.resultTransition,Me.prevInResult=this.prevInResult,Me.isExteriorRing=this.isExteriorRing,Me.inOut=this.inOut,Me.otherInOut=this.otherInOut,Me},Object.defineProperties(Ce.prototype,Ee);var we=11102230246251565e-32,Te=134217729,Ie=(3+8*we)*we;function Ge(Me,Oe,Pt,ir,pr){var fr,Ir,Wr,Ln,Rn=Oe[0],vn=ir[0],ui=0,Ei=0;vn>Rn==vn>-Rn?(fr=Rn,Rn=Oe[++ui]):(fr=vn,vn=ir[++Ei]);var jn=0;if(ui<Me&&Ei<Pt)for(vn>Rn==vn>-Rn?(Wr=fr-((Ir=Rn+fr)-Rn),Rn=Oe[++ui]):(Wr=fr-((Ir=vn+fr)-vn),vn=ir[++Ei]),fr=Ir,Wr!==0&&(pr[jn++]=Wr);ui<Me&&Ei<Pt;)vn>Rn==vn>-Rn?(Wr=fr-((Ir=fr+Rn)-(Ln=Ir-fr))+(Rn-Ln),Rn=Oe[++ui]):(Wr=fr-((Ir=fr+vn)-(Ln=Ir-fr))+(vn-Ln),vn=ir[++Ei]),fr=Ir,Wr!==0&&(pr[jn++]=Wr);for(;ui<Me;)Wr=fr-((Ir=fr+Rn)-(Ln=Ir-fr))+(Rn-Ln),Rn=Oe[++ui],fr=Ir,Wr!==0&&(pr[jn++]=Wr);for(;Ei<Pt;)Wr=fr-((Ir=fr+vn)-(Ln=Ir-fr))+(vn-Ln),vn=ir[++Ei],fr=Ir,Wr!==0&&(pr[jn++]=Wr);return fr===0&&jn!==0||(pr[jn++]=fr),jn}function Qe(Me){return new Float64Array(Me)}var it=33306690738754716e-32,ct=22204460492503146e-32,St=11093356479670487e-47,Vt=Qe(4),Nt=Qe(8),Bt=Qe(12),Xt=Qe(16),xt=Qe(4);function Ft(Me,Oe,Pt){var ir=function(pr,fr,Ir,Wr,Ln,Rn){var vn=(fr-Rn)*(Ir-Ln),ui=(pr-Ln)*(Wr-Rn),Ei=vn-ui;if(vn===0||ui===0||vn>0!=ui>0)return Ei;var jn=Math.abs(vn+ui);return Math.abs(Ei)>=it*jn?Ei:-function(Yi,ki,ai,hs,Ni,Ti,Oi){var fi,Sn,mi,Ji,Gr,Hn,zi,as,Fi,Us,yi,Ns,fl,ta,No,pl,Yh,qs,lo=Yi-Ni,ra=ai-Ni,Ca=ki-Ti,ga=hs-Ti;Vt[0]=(No=(as=lo-(zi=(Hn=Te*lo)-(Hn-lo)))*(Us=ga-(Fi=(Hn=Te*ga)-(Hn-ga)))-((ta=lo*ga)-zi*Fi-as*Fi-zi*Us))-((yi=No-(Yh=(as=Ca-(zi=(Hn=Te*Ca)-(Hn-Ca)))*(Us=ra-(Fi=(Hn=Te*ra)-(Hn-ra)))-((pl=Ca*ra)-zi*Fi-as*Fi-zi*Us)))+(Gr=No-yi))+(Gr-Yh),Vt[1]=(fl=ta-((Ns=ta+yi)-(Gr=Ns-ta))+(yi-Gr))-((yi=fl-pl)+(Gr=fl-yi))+(Gr-pl),Vt[2]=Ns-((qs=Ns+yi)-(Gr=qs-Ns))+(yi-Gr),Vt[3]=qs;var Em=function(PFe,jF){for(var DF=jF[0],uC=1;uC<4;uC++)DF+=jF[uC];return DF}(0,Vt),R0=ct*Oi;if(Em>=R0||-Em>=R0||(fi=Yi-(lo+(Gr=Yi-lo))+(Gr-Ni),mi=ai-(ra+(Gr=ai-ra))+(Gr-Ni),Sn=ki-(Ca+(Gr=ki-Ca))+(Gr-Ti),Ji=hs-(ga+(Gr=hs-ga))+(Gr-Ti),fi===0&&Sn===0&&mi===0&&Ji===0)||(R0=St*Oi+Ie*Math.abs(Em),(Em+=lo*Ji+ga*fi-(Ca*mi+ra*Sn))>=R0||-Em>=R0))return Em;xt[0]=(No=(as=fi-(zi=(Hn=Te*fi)-(Hn-fi)))*(Us=ga-(Fi=(Hn=Te*ga)-(Hn-ga)))-((ta=fi*ga)-zi*Fi-as*Fi-zi*Us))-((yi=No-(Yh=(as=Sn-(zi=(Hn=Te*Sn)-(Hn-Sn)))*(Us=ra-(Fi=(Hn=Te*ra)-(Hn-ra)))-((pl=Sn*ra)-zi*Fi-as*Fi-zi*Us)))+(Gr=No-yi))+(Gr-Yh),xt[1]=(fl=ta-((Ns=ta+yi)-(Gr=Ns-ta))+(yi-Gr))-((yi=fl-pl)+(Gr=fl-yi))+(Gr-pl),xt[2]=Ns-((qs=Ns+yi)-(Gr=qs-Ns))+(yi-Gr),xt[3]=qs;var _ne=Ge(4,Vt,4,xt,Nt);xt[0]=(No=(as=lo-(zi=(Hn=Te*lo)-(Hn-lo)))*(Us=Ji-(Fi=(Hn=Te*Ji)-(Hn-Ji)))-((ta=lo*Ji)-zi*Fi-as*Fi-zi*Us))-((yi=No-(Yh=(as=Ca-(zi=(Hn=Te*Ca)-(Hn-Ca)))*(Us=mi-(Fi=(Hn=Te*mi)-(Hn-mi)))-((pl=Ca*mi)-zi*Fi-as*Fi-zi*Us)))+(Gr=No-yi))+(Gr-Yh),xt[1]=(fl=ta-((Ns=ta+yi)-(Gr=Ns-ta))+(yi-Gr))-((yi=fl-pl)+(Gr=fl-yi))+(Gr-pl),xt[2]=Ns-((qs=Ns+yi)-(Gr=qs-Ns))+(yi-Gr),xt[3]=qs;var xne=Ge(_ne,Nt,4,xt,Bt);xt[0]=(No=(as=fi-(zi=(Hn=Te*fi)-(Hn-fi)))*(Us=Ji-(Fi=(Hn=Te*Ji)-(Hn-Ji)))-((ta=fi*Ji)-zi*Fi-as*Fi-zi*Us))-((yi=No-(Yh=(as=Sn-(zi=(Hn=Te*Sn)-(Hn-Sn)))*(Us=mi-(Fi=(Hn=Te*mi)-(Hn-mi)))-((pl=Sn*mi)-zi*Fi-as*Fi-zi*Us)))+(Gr=No-yi))+(Gr-Yh),xt[1]=(fl=ta-((Ns=ta+yi)-(Gr=Ns-ta))+(yi-Gr))-((yi=fl-pl)+(Gr=fl-yi))+(Gr-pl),xt[2]=Ns-((qs=Ns+yi)-(Gr=qs-Ns))+(yi-Gr),xt[3]=qs;var bne=Ge(xne,Bt,4,xt,Xt);return Xt[bne-1]}(pr,fr,Ir,Wr,Ln,Rn,jn)}(Me[0],Me[1],Oe[0],Oe[1],Pt[0],Pt[1]);return ir>0?-1:ir<0?1:0}function _t(Me,Oe){var Pt=Me.point,ir=Oe.point;return Pt[0]>ir[0]?1:Pt[0]<ir[0]?-1:Pt[1]!==ir[1]?Pt[1]>ir[1]?1:-1:function(pr,fr,Ir,Wr){return pr.left!==fr.left?pr.left?1:-1:Ft(Ir,pr.otherEvent.point,fr.otherEvent.point)!==0?pr.isBelow(fr.otherEvent.point)?-1:1:!pr.isSubject&&fr.isSubject?1:-1}(Me,Oe,Pt)}function wt(Me,Oe,Pt){var ir=new Ce(Oe,!1,Me,Me.isSubject),pr=new Ce(Oe,!0,Me.otherEvent,Me.isSubject);return ue(Me.point,Me.otherEvent.point)&&console.warn("what is that, a collapsed segment?",Me),ir.contourId=pr.contourId=Me.contourId,_t(pr,Me.otherEvent)>0&&(Me.otherEvent.left=!0,pr.left=!1),Me.otherEvent.otherEvent=pr,Me.otherEvent=ir,Pt.push(pr),Pt.push(ir),Pt}function Yt(Me,Oe){return Me[0]*Oe[1]-Me[1]*Oe[0]}function tr(Me,Oe){return Me[0]*Oe[0]+Me[1]*Oe[1]}function Or(Me,Oe,Pt){var ir=function(Ln,Rn,vn,ui,Ei){var jn=[Rn[0]-Ln[0],Rn[1]-Ln[1]],Yi=[ui[0]-vn[0],ui[1]-vn[1]];function ki(Hn,zi,as){return[Hn[0]+zi*as[0],Hn[1]+zi*as[1]]}var ai=[vn[0]-Ln[0],vn[1]-Ln[1]],hs=Yt(jn,Yi),Ni=hs*hs,Ti=tr(jn,jn);if(Ni>0){var Oi=Yt(ai,Yi)/hs;if(Oi<0||Oi>1)return null;var fi=Yt(ai,jn)/hs;return fi<0||fi>1?null:Oi===0||Oi===1?[ki(Ln,Oi,jn)]:fi===0||fi===1?[ki(vn,fi,Yi)]:[ki(Ln,Oi,jn)]}if((Ni=(hs=Yt(ai,jn))*hs)>0)return null;var Sn=tr(jn,ai)/Ti,mi=Sn+tr(jn,Yi)/Ti,Ji=Math.min(Sn,mi),Gr=Math.max(Sn,mi);return Ji<=1&&Gr>=0?Ji===1?[ki(Ln,Ji>0?Ji:0,jn)]:Gr===0?[ki(Ln,Gr<1?Gr:1,jn)]:[ki(Ln,Ji>0?Ji:0,jn),ki(Ln,Gr<1?Gr:1,jn)]:null}(Me.point,Me.otherEvent.point,Oe.point,Oe.otherEvent.point),pr=ir?ir.length:0;if(pr===0||pr===1&&(ue(Me.point,Oe.point)||ue(Me.otherEvent.point,Oe.otherEvent.point))||pr===2&&Me.isSubject===Oe.isSubject)return 0;if(pr===1)return ue(Me.point,ir[0])||ue(Me.otherEvent.point,ir[0])||wt(Me,ir[0],Pt),ue(Oe.point,ir[0])||ue(Oe.otherEvent.point,ir[0])||wt(Oe,ir[0],Pt),1;var fr=[],Ir=!1,Wr=!1;return ue(Me.point,Oe.point)?Ir=!0:_t(Me,Oe)===1?fr.push(Oe,Me):fr.push(Me,Oe),ue(Me.otherEvent.point,Oe.otherEvent.point)?Wr=!0:_t(Me.otherEvent,Oe.otherEvent)===1?fr.push(Oe.otherEvent,Me.otherEvent):fr.push(Me.otherEvent,Oe.otherEvent),Ir&&Wr||Ir?(Oe.type=R,Me.type=Oe.inOut===Me.inOut?$:U,Ir&&!Wr&&wt(fr[1].otherEvent,fr[0].point,Pt),2):Wr?(wt(fr[0],fr[1].point,Pt),3):fr[0]!==fr[3].otherEvent?(wt(fr[0],fr[1].point,Pt),wt(fr[1],fr[2].point,Pt),3):(wt(fr[0],fr[1].point,Pt),wt(fr[3].otherEvent,fr[2].point,Pt),3)}function Tr(Me,Oe){if(Me===Oe)return 0;if(Ft(Me.point,Me.otherEvent.point,Oe.point)!==0||Ft(Me.point,Me.otherEvent.point,Oe.otherEvent.point)!==0)return ue(Me.point,Oe.point)?Me.isBelow(Oe.otherEvent.point)?-1:1:Me.point[0]===Oe.point[0]?Me.point[1]<Oe.point[1]?-1:1:_t(Me,Oe)===1?Oe.isAbove(Me.point)?-1:1:Me.isBelow(Oe.point)?-1:1;if(Me.isSubject!==Oe.isSubject)return Me.isSubject?-1:1;var Pt=Me.point,ir=Oe.point;return Pt[0]===ir[0]&&Pt[1]===ir[1]?(Pt=Me.otherEvent.point)[0]===(ir=Oe.otherEvent.point)[0]&&Pt[1]===ir[1]?0:Me.contourId>Oe.contourId?1:-1:_t(Me,Oe)===1?1:-1}var hr=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Kt(Me,Oe,Pt,ir){var pr,fr=Me+1,Ir=Oe[Me].point,Wr=Oe.length;for(fr<Wr&&(pr=Oe[fr].point);fr<Wr&&pr[0]===Ir[0]&&pr[1]===Ir[1];){if(!Pt[fr])return fr;++fr<Wr&&(pr=Oe[fr].point)}for(fr=Me-1;Pt[fr]&&fr>ir;)fr--;return fr}hr.prototype.isExterior=function(){return this.holeOf==null};var tn=Mr,Pr=Mr;function Mr(Me,Oe){if(!(this instanceof Mr))return new Mr(Me,Oe);if(this.data=Me||[],this.length=this.data.length,this.compare=Oe||Kr,this.length>0)for(var Pt=(this.length>>1)-1;Pt>=0;Pt--)this._down(Pt)}function Kr(Me,Oe){return Me<Oe?-1:Me>Oe?1:0}Mr.prototype={push:function(Me){this.data.push(Me),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var Me=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),Me}},peek:function(){return this.data[0]},_up:function(Me){for(var Oe=this.data,Pt=this.compare,ir=Oe[Me];Me>0;){var pr=Me-1>>1,fr=Oe[pr];if(Pt(ir,fr)>=0)break;Oe[Me]=fr,Me=pr}Oe[Me]=ir},_down:function(Me){for(var Oe=this.data,Pt=this.compare,ir=this.length>>1,pr=Oe[Me];Me<ir;){var fr=1+(Me<<1),Ir=fr+1,Wr=Oe[fr];if(Ir<this.length&&Pt(Oe[Ir],Wr)<0&&(fr=Ir,Wr=Oe[Ir]),Pt(Wr,pr)>=0)break;Oe[Me]=Wr,Me=fr}Oe[Me]=pr}},tn.default=Pr;var dn=Math.max,mn=Math.min,An=0;function bn(Me,Oe,Pt,ir,pr,fr){var Ir,Wr,Ln,Rn,vn,ui;for(Ir=0,Wr=Me.length-1;Ir<Wr;Ir++)if(Rn=Me[Ir+1],vn=new Ce(Ln=Me[Ir],!1,void 0,Oe),ui=new Ce(Rn,!1,vn,Oe),vn.otherEvent=ui,Ln[0]!==Rn[0]||Ln[1]!==Rn[1]){vn.contourId=ui.contourId=Pt,fr||(vn.isExteriorRing=!1,ui.isExteriorRing=!1),_t(vn,ui)>0?ui.left=!0:vn.left=!0;var Ei=Ln[0],jn=Ln[1];pr[0]=mn(pr[0],Ei),pr[1]=mn(pr[1],jn),pr[2]=dn(pr[2],Ei),pr[3]=dn(pr[3],jn),ir.push(vn),ir.push(ui)}}var yn=[];function gi(Me,Oe,Pt){typeof Me[0][0][0]=="number"&&(Me=[Me]),typeof Oe[0][0][0]=="number"&&(Oe=[Oe]);var ir=function(jn,Yi,ki){var ai=null;return jn.length*Yi.length==0&&(ki===W?ai=yn:ki===re?ai=jn:ki!==te&&ki!==le||(ai=jn.length===0?Yi:jn)),ai}(Me,Oe,Pt);if(ir)return ir===yn?null:ir;var pr=[1/0,1/0,-1/0,-1/0],fr=[1/0,1/0,-1/0,-1/0],Ir=function(jn,Yi,ki,ai,hs){var Ni,Ti,Oi,fi,Sn,mi,Ji=new tn(null,_t);for(Oi=0,fi=jn.length;Oi<fi;Oi++)for(Sn=0,mi=(Ni=jn[Oi]).length;Sn<mi;Sn++)(Ti=Sn===0)&&An++,bn(Ni[Sn],!0,An,Ji,ki,Ti);for(Oi=0,fi=Yi.length;Oi<fi;Oi++)for(Sn=0,mi=(Ni=Yi[Oi]).length;Sn<mi;Sn++)Ti=Sn===0,hs===re&&(Ti=!1),Ti&&An++,bn(Ni[Sn],!1,An,Ji,ai,Ti);return Ji}(Me,Oe,pr,fr,Pt);if(ir=function(jn,Yi,ki,ai,hs){var Ni=null;return(ki[0]>ai[2]||ai[0]>ki[2]||ki[1]>ai[3]||ai[1]>ki[3])&&(hs===W?Ni=yn:hs===re?Ni=jn:hs!==te&&hs!==le||(Ni=jn.concat(Yi))),Ni}(Me,Oe,pr,fr,Pt))return ir===yn?null:ir;for(var Wr=function(jn){var Yi,ki,ai=function(Oi){var fi,Sn,mi,Ji,Gr=[];for(Sn=0,mi=Oi.length;Sn<mi;Sn++)((fi=Oi[Sn]).left&&fi.inResult||!fi.left&&fi.otherEvent.inResult)&&Gr.push(fi);for(var Hn=!1;!Hn;)for(Hn=!0,Sn=0,mi=Gr.length;Sn<mi;Sn++)Sn+1<mi&&_t(Gr[Sn],Gr[Sn+1])===1&&(Ji=Gr[Sn],Gr[Sn]=Gr[Sn+1],Gr[Sn+1]=Ji,Hn=!1);for(Sn=0,mi=Gr.length;Sn<mi;Sn++)(fi=Gr[Sn]).otherPos=Sn;for(Sn=0,mi=Gr.length;Sn<mi;Sn++)(fi=Gr[Sn]).left||(Ji=fi.otherPos,fi.otherPos=fi.otherEvent.otherPos,fi.otherEvent.otherPos=Ji);return Gr}(jn),hs={},Ni=[],Ti=function(){if(!hs[Yi]){var Oi=Ni.length,fi=function(Gr,Hn,zi){var as=new hr;if(Gr.prevInResult!=null){var Fi=Gr.prevInResult,Us=Fi.outputContourId;if(Fi.resultTransition>0){var yi=Hn[Us];if(yi.holeOf!=null){var Ns=yi.holeOf;Hn[Ns].holeIds.push(zi),as.holeOf=Ns,as.depth=Hn[Us].depth}else Hn[Us].holeIds.push(zi),as.holeOf=Us,as.depth=Hn[Us].depth+1}else as.holeOf=null,as.depth=Hn[Us].depth}else as.holeOf=null,as.depth=0;return as}(ai[Yi],Ni,Oi),Sn=function(Gr){hs[Gr]=!0,Gr<ai.length&&ai[Gr]&&(ai[Gr].outputContourId=Oi)},mi=Yi,Ji=Yi;for(fi.points.push(ai[Yi].point);Sn(mi),Sn(mi=ai[mi].otherPos),fi.points.push(ai[mi].point),!((mi=Kt(mi,ai,hs,Ji))==Ji||mi>=ai.length)&&ai[mi];);Ni.push(fi)}};for(Yi=0,ki=ai.length;Yi<ki;Yi++)Ti();return Ni}(function(jn,Yi,ki,ai,hs,Ni){for(var Ti,Oi,fi,Sn=new p(Tr),mi=[],Ji=Math.min(ai[2],hs[2]);jn.length!==0;){var Gr=jn.pop();if(mi.push(Gr),Ni===W&&Gr.point[0]>Ji||Ni===re&&Gr.point[0]>ai[2])break;if(Gr.left){Oi=Ti=Sn.insert(Gr),Ti=Ti!==(fi=Sn.minNode())?Sn.prev(Ti):null,Oi=Sn.next(Oi);var Hn=Ti?Ti.key:null;if(ve(Gr,Hn,Ni),Oi&&Or(Gr,Oi.key,jn)===2&&(ve(Gr,Hn,Ni),ve(Oi.key,Gr,Ni)),Ti&&Or(Ti.key,Gr,jn)===2){var zi=Ti;ve(Hn,(zi=zi!==fi?Sn.prev(zi):null)?zi.key:null,Ni),ve(Gr,Hn,Ni)}}else Oi=Ti=Sn.find(Gr=Gr.otherEvent),Ti&&Oi&&(Ti=Ti!==fi?Sn.prev(Ti):null,Oi=Sn.next(Oi),Sn.remove(Gr),Oi&&Ti&&Or(Ti.key,Oi.key,jn))}return mi}(Ir,0,0,pr,fr,Pt)),Ln=[],Rn=0;Rn<Wr.length;Rn++){var vn=Wr[Rn];if(vn.isExterior()){for(var ui=[vn.points],Ei=0;Ei<vn.holeIds.length;Ei++)ui.push(Wr[vn.holeIds[Ei]].points);Ln.push(ui)}}return Ln}var Ii={UNION:te,DIFFERENCE:re,INTERSECTION:W,XOR:le};l.diff=function(Me,Oe){return gi(Me,Oe,re)},l.intersection=function(Me,Oe){return gi(Me,Oe,W)},l.operations=Ii,l.union=function(Me,Oe){return gi(Me,Oe,te)},l.xor=function(Me,Oe){return gi(Me,Oe,le)},Object.defineProperty(l,"__esModule",{value:!0})})(s)}(0,IN.exports)),IN.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function h1(c,s,l,h){const p=[],v=h===0?(x,P,I,R,$,U)=>{x.push(new Qt(U,I+(U-P)/(R-P)*($-I)))}:(x,P,I,R,$,U)=>{x.push(new Qt(P+(U-I)/($-I)*(R-P),U))};for(const x of c){const P=[];for(const I of x){if(I.length<=2)continue;const R=[];for(let W=0;W<I.length-1;W++){const te=I[W].x,re=I[W].y,le=I[W+1].x,ve=I[W+1].y,_e=h===0?te:re,Ce=h===0?le:ve;_e<s?Ce>s&&v(R,te,re,le,ve,s):_e>l?Ce<l&&v(R,te,re,le,ve,l):R.push(I[W]),Ce<s&&_e>=s&&v(R,te,re,le,ve,s),Ce>l&&_e<=l&&v(R,te,re,le,ve,l)}let $=I[I.length-1];const U=h===0?$.x:$.y;U>=s&&U<=l&&R.push($),R.length&&($=R[R.length-1],R[0].x===$.x&&R[0].y===$.y||R.push(R[0]),P.push(R))}P.length&&p.push(P)}return p}function Dee(c,s){const l=aT(c),h=aT([s]),p=kN.intersection(l,h);return p==null?[]:ON(p)}function Nee(c,s){let h=aT(c,65536);for(;s.valid();s.next()){const[p,v]=s.get(),x=p.x*65536,P=p.y*65536,I=v.x*65536,R=v.y*65536,$=I-x,U=R-P,W=Math.hypot($,U),te=Math.trunc(U/W*3),re=-Math.trunc($/W*3);h=kN.diff(h,[[[x,P],[I,R],[I+te,R+re],[x+te,P+re],[x,P]]])}return ON(h,1/65536)}function aT(c,s=1){return[c.map(l=>l.map(h=>[h.x*s,h.y*s]))]}function ON(c,s=1){return c.map(l=>l.map((h,p)=>{const v=h.map(x=>new Qt(x[0]*s,x[1]*s).round());return p>0&&v.reverse(),v}))}class lT{constructor(s,l){this.layoutVertexArray=new lc,this.indexArray=new bs,this.lineIndexArray=new kl,this.triangleSegments=new ji,this.lineSegments=new ji,this.programConfigurations=new Kc(s.layers,{zoom:s.zoom,lut:s.lut}),this.uploaded=!1,l&&(this.elevatedLayoutVertexArray=new Bh)}update(s,l,h,p,v,x,P){this.programConfigurations.updatePaintArrays(s,l,v,h,p,x,P)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Gn.members),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.lineIndexBuffer=s.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=s.createVertexBuffer(this.elevatedLayoutVertexArray,ti.members))),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(s,l,h,p,v,x){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,l,h,p,v,x)}}class cT{constructor(s){this.zoom=s.zoom,this.pixelRatio=s.pixelRatio,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.bufferData=new lT(s,!1),this.elevationBufferData=new lT(s,!0),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=s.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference")}updateFootprints(s,l){}populate(s,l,h,p){this.hasPattern=eT("fill",this.layers,this.pixelRatio,l);const v=this.layers[0].layout.get("fill-sort-key"),x=[];for(const{feature:P,id:I,index:R,sourceLayerIndex:$}of s){const U=this.layers[0]._featureFilter.needGeometry,W=Ar(P,U);if(!this.layers[0]._featureFilter.filter(new ni(this.zoom),W,h))continue;const te=v?v.evaluate(W,{},h,l.availableImages):void 0,re={id:I,properties:P.properties,type:P.type,sourceLayerIndex:$,index:R,geometry:U?W.geometry:wr(P,h,p),patterns:{},sortKey:te};x.push(re)}v&&x.sort((P,I)=>P.sortKey-I.sortKey);for(const P of x){const{geometry:I,index:R,sourceLayerIndex:$}=P;if(this.hasPattern){const U=tT("fill",this.layers,P,this.zoom,this.pixelRatio,l);this.patternFeatures.push(U)}else this.addFeature(P,I,R,h,{},l.availableImages,l.brightness,l.elevationFeatures);l.featureIndex.insert(s[R].feature,I,R,$,this.index)}}update(s,l,h,p,v,x,P){this.bufferData.update(s,l,h,p,v,x,P),this.elevationBufferData.update(s,l,h,p,v,x,P)}addFeatures(s,l,h,p,v,x){for(const P of this.patternFeatures)this.addFeature(P,P.geometry,P.index,l,h,p,x,s.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(s){this.bufferData.upload(s),this.elevationBufferData.upload(s),this.elevatedStructures&&this.elevatedStructures.upload(s)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(s,l,h,p,v,x=[],P,I){const R=u1(l,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(s,R,p,h,I):this.addGeometry(R,this.bufferData),this.bufferData.populatePaintArrays(s,h,v,x,p,P),this.elevationBufferData.populatePaintArrays(s,h,v,x,p,P)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(s){this.elevatedStructures&&this.elevatedStructures.construct(s)}addElevatedRoadFeature(s,l,h,p,v){const x=new Array,P=oT.getElevationFeature(s,v);if(P){{const I=this.clipPolygonsToTile(l,1);I.length>0&&x.push({polygons:I,elevationFeature:P,elevationTileID:h})}for(const I of x)if(I.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new yc(I.elevationTileID));const $=I.elevationFeature.isTunnel();let U=0;s.properties.hasOwnProperty(EN)&&(U=+s.properties[EN]);for(const W of I.polygons)this.elevatedStructures.addPortalCandidates(I.elevationFeature.id,W,$,I.elevationFeature,U)}I.elevationFeature.constantHeight==null&&(I.polygons=this.prepareElevatedPolygons(I.polygons,I.elevationFeature,I.elevationTileID));const R=new AN(h,I.elevationTileID);this.addElevatedGeometry(I.polygons,R,I.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,p)}}else this.addGeometry(l,this.bufferData)}addElevatedGeometry(s,l,h,p,v){const x={elevation:h,elevationSampler:l,bias:p,index:v},[P,I]=this.addGeometry(s,this.elevationBufferData,x);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:P,max:I}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,P),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,I))}addGeometry(s,l,h){let p=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY,x=null;h&&(x=h.elevationSampler.constantElevation(h.elevation,h.bias),x!=null&&(p=x,v=x));const P=(I,R,$)=>{if(h!=null)if(R.push(I),x!=null)l.elevatedLayoutVertexArray.emplaceBack(x),$.push(x);else{const U=h.elevationSampler.pointElevation(I,h.elevation,h.bias);l.elevatedLayoutVertexArray.emplaceBack(U),$.push(U),p=Math.min(p,U),v=Math.max(v,U)}};for(const I of s){let R=0;for(const Ee of I)R+=Ee.length;const $=l.triangleSegments.prepareSegment(R,l.layoutVertexArray,l.indexArray),U=$.vertexLength,W=[],te=[],re=[],le=[],ve=[],_e=l.layoutVertexArray.length;for(const Ee of I){if(Ee.length===0)continue;Ee!==I[0]&&te.push(W.length/2);const ue=l.lineSegments.prepareSegment(Ee.length,l.layoutVertexArray,l.lineIndexArray),we=ue.vertexLength;h&&ve.push(l.layoutVertexArray.length-_e),P(Ee[0],re,le),l.layoutVertexArray.emplaceBack(Ee[0].x,Ee[0].y),l.lineIndexArray.emplaceBack(we+Ee.length-1,we),W.push(Ee[0].x),W.push(Ee[0].y);for(let Te=1;Te<Ee.length;Te++)P(Ee[Te],re,le),l.layoutVertexArray.emplaceBack(Ee[Te].x,Ee[Te].y),l.lineIndexArray.emplaceBack(we+Te-1,we+Te),W.push(Ee[Te].x),W.push(Ee[Te].y);ue.vertexLength+=Ee.length,ue.primitiveLength+=Ee.length}const Ce=gc(W,te);for(let Ee=0;Ee<Ce.length;Ee+=3)l.indexArray.emplaceBack(U+Ce[Ee],U+Ce[Ee+1],U+Ce[Ee+2]);if(Ce.length>0&&h&&this.elevationMode==="hd-road-base"){const Ee=h.elevation.isTunnel(),ue=h.elevation.safeArea,we=this.elevatedStructures.addVertices(re,le);this.elevatedStructures.addTriangles(Ce,we,Ee);const Te=ve.length;if(Te>0){for(let Ie=0;Ie<Te-1;Ie++)this.elevatedStructures.addRenderableRing(h.index,ve[Ie]+we,ve[Ie+1]-ve[Ie],Ee,ue);this.elevatedStructures.addRenderableRing(h.index,ve[Te-1]+we,re.length-ve[Te-1],Ee,ue)}}$.vertexLength+=R,$.primitiveLength+=Ce.length/3}return[p,v]}prepareElevatedPolygons(s,l,h){const p=1/at(h),v=[];for(const x of s){const P=Nee(x,new CN(l,p));v.push(...P)}return v}clipPolygonsToTile(s,l){const h=-l,p=-l,v=or+l,x=or+l;let P=0;const I=[],R=[];for(;P<s.length;P++){const W=s[P],te=Np(W);(te.min.x>=h&&te.max.x<=v&&te.min.y>=p&&te.max.y<=x?I:R).push(W)}if(I.length===s.length)return s;const $=[new Qt(h,p),new Qt(v,p),new Qt(v,x),new Qt(h,x),new Qt(h,p)],U=I;for(const W of R)U.push(...Dee(W,$));return U}}let LN,RN,jN,DN;yr(cT,"FillBucket",{omit:["layers","patternFeatures"]}),yr(lT,"FillBufferData"),yr(yc,"ElevatedStructures");class uT{constructor(s,l,h,p){if(this.triangleCount=l.length/3,this.min=new Qt(0,0),this.max=new Qt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||s.length===0)return;const[v,x]=[s[0].clone(),s[0].clone()];for(let U=1;U<s.length;++U){const W=s[U];v.x=Math.min(v.x,W.x),v.y=Math.min(v.y,W.y),x.x=Math.max(x.x,W.x),x.y=Math.max(x.y,W.y)}if(p){const U=Math.ceil(Math.max(x.x-v.x,x.y-v.y)/p);h=Math.max(h,U)}if(h===0)return;this.min=v,this.max=x;const P=this.max.sub(this.min);P.x=Math.max(P.x,1),P.y=Math.max(P.y,1);const I=Math.max(P.x,P.y)/h;this.cellsX=Math.max(1,Math.ceil(P.x/I)),this.cellsY=Math.max(1,Math.ceil(P.y/I)),this.xScale=1/I,this.yScale=1/I;const R=[];for(let U=0;U<this.triangleCount;U++){const W=s[l[3*U+0]].sub(this.min),te=s[l[3*U+1]].sub(this.min),re=s[l[3*U+2]].sub(this.min),le=Xh(Math.floor(Math.min(W.x,te.x,re.x)),this.xScale,this.cellsX),ve=Xh(Math.floor(Math.max(W.x,te.x,re.x)),this.xScale,this.cellsX),_e=Xh(Math.floor(Math.min(W.y,te.y,re.y)),this.yScale,this.cellsY),Ce=Xh(Math.floor(Math.max(W.y,te.y,re.y)),this.yScale,this.cellsY),Ee=new Qt(0,0),ue=new Qt(0,0),we=new Qt(0,0),Te=new Qt(0,0);for(let Ie=_e;Ie<=Ce;++Ie){Ee.y=ue.y=Ie*I,we.y=Te.y=(Ie+1)*I;for(let Ge=le;Ge<=ve;++Ge)Ee.x=we.x=Ge*I,ue.x=Te.x=(Ge+1)*I,(Di(W,te,re,Ee,ue,Te)||Di(W,te,re,Ee,Te,we))&&R.push({cellIdx:Ie*this.cellsX+Ge,triIdx:U})}}if(R.length===0)return;R.sort((U,W)=>U.cellIdx-W.cellIdx||U.triIdx-W.triIdx);let $=0;for(;$<R.length;){const U=R[$].cellIdx,W={start:this.payload.length,len:0};for(;$<R.length&&R[$].cellIdx===U;)++W.len,this.payload.push(R[$++].triIdx);this.cells[U]=W}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(s,l){if(this.triangleCount===0||this.cells.length===0||s.x>this.max.x||this.min.x>s.x||s.y>this.max.y||this.min.y>s.y)return;const h=Xh(s.x-this.min.x,this.xScale,this.cellsX),p=Xh(s.y-this.min.y,this.yScale,this.cellsY),v=this.cells[p*this.cellsX+h];if(v){this._lazyInitLookup();for(let x=0;x<v.len;x++){const P=this.payload[v.start+x],I=Math.floor(P/8),R=1<<P%8;if(!(this.lookup[I]&R)&&(this.lookup[I]|=R,l.push(P),l.length===this.triangleCount))return}}}query(s,l,h){if(this.triangleCount===0||this.cells.length===0||s.x>this.max.x||this.min.x>l.x||s.y>this.max.y||this.min.y>l.y)return;this._lazyInitLookup();const p=Xh(s.x-this.min.x,this.xScale,this.cellsX),v=Xh(l.x-this.min.x,this.xScale,this.cellsX),x=Xh(s.y-this.min.y,this.yScale,this.cellsY),P=Xh(l.y-this.min.y,this.yScale,this.cellsY);for(let I=x;I<=P;I++)for(let R=p;R<=v;R++){const $=this.cells[I*this.cellsX+R];if($)for(let U=0;U<$.len;U++){const W=this.payload[$.start+U],te=Math.floor(W/8),re=1<<W%8;if(!(this.lookup[te]&re)&&(this.lookup[te]|=re,h.push(W),h.length===this.triangleCount))return}}}}function Xh(c,s,l){return Math.max(0,Math.min(l-1,Math.floor(c*s)))}yr(uT,"TriangleGridIndex");class NN{constructor(s){this.zoom=s.zoom,this.layers=s.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=s.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.footprints=[]}updateFootprints(s,l){for(const h of this.footprints)l.push({footprint:h,id:s})}populate(s,l,h,p){const v=[];for(const{feature:x,id:P,index:I,sourceLayerIndex:R}of s){const $=this.layers[0]._featureFilter.needGeometry,U=Ar(x,$);if(!this.layers[0]._featureFilter.filter(new ni(this.zoom),U,h))continue;const W={id:P,properties:x.properties,type:x.type,sourceLayerIndex:R,index:I,geometry:$?U.geometry:wr(x,h,p),patterns:{}};v.push(W)}for(const x of v){const{geometry:P,index:I,sourceLayerIndex:R}=x;this.addFeature(x,P,I,h,{},l.availableImages,l.brightness),l.featureIndex.insert(s[I].feature,P,I,R,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(s){}update(s,l,h,p,v,x,P){}destroy(){}addFeature(s,l,h,p,v,x=[],P){for(const I of u1(l,2)){const R=[],$=[],U=[],W=new Qt(1/0,1/0),te=new Qt(-1/0,-1/0);for(const ve of I)if(ve.length!==0){ve!==I[0]&&U.push($.length/2);for(let _e=0;_e<ve.length;_e++)$.push(ve[_e].x),$.push(ve[_e].y),R.push(ve[_e]),W.x=Math.min(W.x,ve[_e].x),W.y=Math.min(W.y,ve[_e].y),te.x=Math.max(te.x,ve[_e].x),te.y=Math.max(te.y,ve[_e].y)}const re=gc($,U),le=new uT(R,re,8,256);this.footprints.push({vertices:R,indices:re,grid:le,min:W,max:te})}}}yr(NN,"ClipBucket",{omit:["layers"]});const zee=qn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Fee=qn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Bee=qn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),$ee=qn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),Vee=qn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Uee=qn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:qee}=zee,f1=Number.MAX_SAFE_INTEGER;function zN(c,s,l,h){return c.order<s||c.order===f1||!(c.clipMask&l)||function(p,v){return v.length!==0&&v.find(x=>x===p)===void 0}(h,c.clipScope)}function p1(c,s){return c.x-s.x||c.y-s.y}function FN(c,s){return p1(c.min,s.min)===0&&p1(c.max,s.max)===0}function dT(c,s){return!(c.min.x>s.max.x||c.max.x<s.min.x||c.min.y>s.max.y||c.max.y<s.min.y)}function hT(c,s){if(c.length!==s.length)return!1;for(let l=0;l<c.length;l++)if(c[l].sourceId!==s[l].sourceId||!FN(c[l],s[l])||c[l].order!==s[l].order||c[l].clipMask!==s[l].clipMask||!Hs(c[l].clipScope,s[l].clipScope))return!1;return!0}function BN(c,s,l){const h=1/or,p=1/(1<<l.canonical.z),v=(s.x*h+l.canonical.x)*p+l.wrap,x=(s.y*h+l.canonical.y)*p;return{min:new Qt((c.x*h+l.canonical.x)*p+l.wrap,(c.y*h+l.canonical.y)*p),max:new Qt(v,x)}}function Gee(c,s,l){const h=1<<l.canonical.z,p=((s.x-l.wrap)*h-l.canonical.x)*or,v=(s.y*h-l.canonical.y)*or;return{min:new Qt(((c.x-l.wrap)*h-l.canonical.x)*or,(c.y*h-l.canonical.y)*or),max:new Qt(p,v)}}function $N(c,s,l,h,p,v,x){const P=c.indices,I=c.vertices,R=[];for(let $=h;$<h+p;$+=3){const U=s[l[$+0]+v],W=s[l[$+1]+v],te=s[l[$+2]+v],re=Math.min(U.x,W.x,te.x),le=Math.max(U.x,W.x,te.x),ve=Math.min(U.y,W.y,te.y),_e=Math.max(U.y,W.y,te.y);R.length=0,c.grid.query(new Qt(re,ve),new Qt(le,_e),R);for(let Ce=0;Ce<R.length;Ce++){const Ee=R[Ce];if(Di(I[P[3*Ee+0]],I[P[3*Ee+1]],I[P[3*Ee+2]],U,W,te,x))return!0}}return!1}function VN(c,s,l,h){if(!c||!l)return!1;let p=c.vertices;if(!s.canonical.equals(h.canonical)||s.wrap!==h.wrap){if(l.vertices.length<c.vertices.length)return VN(l,h,c,s);const v=s.canonical,x=h.canonical,P=Math.pow(2,x.z-v.z);p=c.vertices.map(I=>new Qt((I.x+v.x*or)*P-x.x*or,(I.y+v.y*or)*P-x.y*or))}return $N(l,p,c.indices,0,c.indices.length,0,0)}function UN(c,s,l,h){const p=Math.pow(2,h.z-l.z);return new Qt((c+l.x*or)*p-h.x*or,(s+l.y*or)*p-h.y*or)}function qN(c,s){const l=[];s.grid.queryPoint(c,l);const h=s.indices,p=s.vertices;for(let v=0;v<l.length;v++){const x=l[v];if(oi([p[h[3*x+0]],p[h[3*x+1]],p[h[3*x+2]]],c))return!0}return!1}const fT=[new Qt(0,0),new Qt(or,0),new Qt(or,or),new Qt(0,or)];function GN(c,s){const l=[];let h=[];if(!s||c.length<2)return[c];if(c.length===2)return Hi(c[0],c[1],fT)?[c]:[];for(let p=0;p<c.length+2;p++){const v=c[p%c.length],x=c[(p+1)%c.length],P=Hi(p===0?c[c.length-1]:c[(p-1)%c.length],v,fT),I=Hi(v,x,fT),R=P||I;R&&h.push(v),R&&I||h.length>0&&(h.length>1&&l.push(h),h=[])}return h.length>1&&l.push(h),l}const pT=vm.VectorTileFeature.types,Hee=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],Wee=["fill-extrusion-flood-light-ground-radius"],Zee=Math.pow(2,13),Xee=Math.pow(2,15)-1,HN=new Qt(0,1),_m=2147483648;function a0(c,s,l,h,p,v,x,P){c.emplaceBack((s<<1)+x,(l<<1)+v,(Math.floor(h*Zee)<<1)+p,Math.round(P))}function l0(c,s,l){c.emplaceBack(s.x*or,s.y*or,l?1:0)}function m1(c,s,l,h,p,v){c.emplaceBack(s.x,s.y,(l.x<<1)+h,(l.y<<1)+p,v)}function c0(c,s,l){c.emplaceBack(s.x,s.y,s.z,l[0]*16384,l[1]*16384,l[2]*16384)}class WN{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class ZN{constructor(){this.centroidXY=new Qt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Qt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Qt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Qt(this.max.x-this.min.x,this.max.y-this.min.y)}}class XN{constructor(){this.acc=new Qt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(s,l){s.min.x===Number.MAX_VALUE&&(s.min.x=s.max.x=l.x,s.min.y=s.max.y=l.y)}appendEdge(s,l,h){this.accCount++,this.acc._add(l);let p=!!this.borders;l.x<s.min.x?(s.min.x=l.x,p=!0):l.x>s.max.x&&(s.max.x=l.x,p=!0),l.y<s.min.y?(s.min.y=l.y,p=!0):l.y>s.max.y&&(s.max.y=l.y,p=!0),((l.x===0||l.x===or)&&l.x===h.x)!=((l.y===0||l.y===or)&&l.y===h.y)&&this.processBorderOverlap(l,h),p&&this.checkBorderIntersection(l,h)}checkBorderIntersection(s,l){l.x<0!=s.x<0&&this.addBorderIntersection(0,Br(l.y,s.y,(0-l.x)/(s.x-l.x))),l.x>or!=s.x>or&&this.addBorderIntersection(1,Br(l.y,s.y,(or-l.x)/(s.x-l.x))),l.y<0!=s.y<0&&this.addBorderIntersection(2,Br(l.x,s.x,(0-l.y)/(s.y-l.y))),l.y>or!=s.y>or&&this.addBorderIntersection(3,Br(l.x,s.x,(or-l.y)/(s.y-l.y)))}addBorderIntersection(s,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const h=this.borders[s];l<h[0]&&(h[0]=l),l>h[1]&&(h[1]=l)}processBorderOverlap(s,l){if(s.x===l.x){if(s.y===l.y)return;const h=s.x===0?0:1;this.addBorderIntersection(h,l.y),this.addBorderIntersection(h,s.y)}else{const h=s.y===0?2:3;this.addBorderIntersection(h,l.x),this.addBorderIntersection(h,s.x)}}centroid(){return this.accCount===0?new Qt(0,0):new Qt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((s,l)=>s+ +(l[0]!==Number.MAX_VALUE),0):0}}function KN(c,s){const l=c.add(s)._unit(),h=rt(c.x*l.x+c.y*l.y,-1,1);var p,v,x;return p=Math.acos(h),Math.min(4,Math.max(-4,Math.tan(p)))/4*Xee*((v=c).x*(x=s).y-v.y*x.x<0?-1:1)}const Kee=[c=>c.x<0,c=>c.x>or,c=>c.y<0,c=>c.y>or];function Yee(c,s,l,h){const p=[4];if(h===0)return p;l._mult(h);const v=c.sub(l),x=s.sub(l),P=[c,s,v,x];for(let I=0;I<4;I++)for(const R of P)if(Kee[I](R)){p.push(I);break}return p}class YN{constructor(s){this.vertexArray=new Ag,this.indexArray=new bs,this.programConfigurations=new Kc(s.layers,{zoom:s.zoom,lut:s.lut},l=>Wee.includes(l)),this._segments=new ji,this.hiddenByLandmarkVertexArray=new ep,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ji}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(s,l,h,p=!1){const v=s.length;if(v>2){let x=Math.max(0,this._segments.get().length-1);const P=this._segments._prepareSegment(4*v,this.vertexArray.length,2*this._segmentToGroundQuads[x].length);let I;x!==this._segments.get().length-1&&(x++,this._segmentToGroundQuads[x]=[],this._segmentToRegionTriCounts[x]=[0,0,0,0,0]);{const R=s[0],$=s[1];I=KN(R.sub(s[v-1])._perp()._unit(),$.sub(R)._perp()._unit())}for(let R=0;R<v;R++){const $=R===v-1?0:R+1,U=s[R],W=s[$],te=s[$===v-1?0:$+1],re=W.sub(U)._perp()._unit(),le=KN(re,te.sub(W)._perp()._unit()),ve=I,_e=le;if(mT(U,W,l)||p&&e3(U,l)&&e3(W,l)){I=le;continue}const Ce=P.vertexLength;m1(this.vertexArray,U,W,1,1,ve),m1(this.vertexArray,U,W,1,0,ve),m1(this.vertexArray,U,W,0,1,_e),m1(this.vertexArray,U,W,0,0,_e),P.vertexLength+=4;const Ee=Yee(U,W,re,h);for(const ue of Ee)this._segmentToGroundQuads[x].push({id:Ce,region:ue}),this._segmentToRegionTriCounts[x][ue]+=2,P.primitiveLength+=2;I=le}}}prepareBorderSegments(){if(!this.hasData())return;const s=this._segments.get(),l=s.length;for(let h=0;h<l;h++)this._segmentToGroundQuads[h].sort((p,v)=>p.region-v.region);for(let h=0;h<l;h++){const p=this._segmentToGroundQuads[h],v=s[h],x=this._segmentToRegionTriCounts[h];x.reduce((I,R)=>I+R,0);let P=0;for(let I=0;I<=4;I++){const R=x[I];if(R!==0){let $=this.regionSegments[I];$||($=this.regionSegments[I]=new ji);const U={vertexOffset:v.vertexOffset,primitiveOffset:v.primitiveOffset+P,vertexLength:v.vertexLength,primitiveLength:R};$.get().push(U)}P+=R}for(let I=0;I<p.length;I++){const R=p[I].id;this.indexArray.emplaceBack(R,R+1,R+3),this.indexArray.emplaceBack(R,R+3,R+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(s,l,h,p,v,x){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,s,l,h,p,v,x)}upload(s){this.hasData()&&(this.vertexBuffer=s.createVertexBuffer(this.vertexArray,Fee.members),this.indexBuffer=s.createIndexBuffer(this.indexArray))}uploadPaintProperties(s){this.hasData()&&this.programConfigurations.upload(s)}update(s,l,h,p,v,x,P){this.hasData()&&this.programConfigurations.updatePaintArrays(s,l,h,p,v,x,P)}updateHiddenByLandmark(s){if(!this.hasData())return;const l=s.groundVertexCount+s.groundVertexArrayOffset;if(s.groundVertexCount===0)return;const h=s.flags&_m?1:0;for(let p=s.groundVertexArrayOffset;p<l;++p)this.hiddenByLandmarkVertexArray.emplace(p,h);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(s){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=s.createVertexBuffer(this.hiddenByLandmarkVertexArray,Vee.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let s=0;s<=4;s++){const l=this.regionSegments[s];l&&l.destroy()}}}}class g1{constructor(s){this.zoom=s.zoom,this.canonical=s.canonical,this.overscaling=s.overscaling,this.layers=s.layers,this.pixelRatio=s.pixelRatio,this.layerIds=this.layers.map(l=>l.fqid),this.index=s.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=s.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new bs,this.footprintVertices=new lc,this.footprintSegments=[],this.layoutVertexArray=new Lu,this.centroidVertexArray=new Og,this.wallVertexArray=new rp,this.indexArray=new bs,this.programConfigurations=new Kc(s.layers,{zoom:s.zoom,lut:s.lut},l=>Hee.includes(l)),this.segments=new ji,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.groundEffect=new YN(s),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(s,l){}populate(s,l,h,p){this.features=[],this.hasPattern=eT("fill-extrusion",this.layers,this.pixelRatio,l),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=at(h),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:v,id:x,index:P,sourceLayerIndex:I}of s){const R=this.layers[0]._featureFilter.needGeometry,$=Ar(v,R);if(!this.layers[0]._featureFilter.filter(new ni(this.zoom),$,h))continue;const U={id:x,sourceLayerIndex:I,index:P,geometry:R?$.geometry:wr(v,h,p),properties:v.properties,type:v.type,patterns:{}},W=this.layoutVertexArray.length,te=pT[U.type]==="Polygon";if(this.hasPattern)this.features.push(tT("fill-extrusion",this.layers,U,this.zoom,this.pixelRatio,l));else if(this.wallMode)for(const re of U.geometry)for(const le of GN(re,te))this.addFeature(U,[le],P,h,{},l.availableImages,p,l.brightness);else this.addFeature(U,U.geometry,P,h,{},l.availableImages,p,l.brightness);l.featureIndex.insert(v,U.geometry,P,I,this.index,W)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(s,l,h,p,v,x){for(const P of this.features){const I=pT[P.type]==="Polygon",{geometry:R}=P;if(this.wallMode)for(const $ of R)for(const U of GN($,I))this.addFeature(P,[U],P.index,l,h,p,v,x);else this.addFeature(P,R,P.index,l,h,p,v,x)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(s,l,h,p,v,x,P){this.programConfigurations.updatePaintArrays(s,l,v,h,p,x,P),this.groundEffect.update(s,l,v,h,p,x,P)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,qee),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.wallVertexBuffer=s.createVertexBuffer(this.wallVertexArray,$ee.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=s.createVertexBuffer(this.layoutVertexExtArray,Uee.members,!0)),this.groundEffect.upload(s)),this.groundEffect.uploadPaintProperties(s),this.programConfigurations.upload(s),this.uploaded=!0}uploadCentroid(s){this.groundEffect.uploadHiddenByLandmark(s),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=s.createVertexBuffer(this.centroidVertexArray,Bee.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(s,l,h,p,v,x,P,I){const R=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(s,{})/this.tileToMeter,$=[new Qt(0,0),new Qt(or,or)],U=P.projection,W=U.name==="globe",te=this.wallMode||pT[s.type]==="Polygon",re=new XN;re.centroidDataIndex=this.centroidData.length;const le=new ZN,ve=this.layers[0].paint.get("fill-extrusion-base").evaluate(s,{},p)<=0,_e=this.layers[0].paint.get("fill-extrusion-height").evaluate(s,{},p);let Ce;if(le.height=_e,le.vertexArrayOffset=this.layoutVertexArray.length,le.groundVertexArrayOffset=this.groundEffect.vertexArray.length,W&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Rd),this.wallMode){if(W)return void sn("Non zero fill-extrusion-line-width is not yet supported on globe.");if(l.length!==1)return;Ce=function(it){const ct=it[0].x===it[it.length-1].x&&it[0].y===it[it.length-1].y;(function(hr){let Kt=0;const tn=hr.length;for(let Pr=0;Pr<tn;Pr++)Kt+=(hr[(Pr+1)%tn].x-hr[Pr].x)*(hr[(Pr+1)%tn].y+hr[Pr].y);return Kt>=0})(it)||(it=it.reverse());const Vt={geometry:[],joinNormals:[],indices:[]},Nt=[],Bt=[],Xt=[];let xt=it.length;for(;xt>=2&&it[xt-1].equals(it[xt-2]);)xt--;if(xt<(ct?3:2))return Vt;let Ft,_t,wt,Yt,tr,Or=0;for(;Or<xt-1&&it[Or].equals(it[Or+1]);)Or++;ct&&(Ft=it[xt-2],tr=it[Or].sub(Ft)._unit()._perp());for(let hr=Or;hr<xt;hr++){if(wt=hr===xt-1?ct?it[Or+1]:void 0:it[hr+1],wt&&it[hr].equals(wt))continue;tr&&(Yt=tr),Ft&&(_t=Ft),Ft=it[hr],tr=wt?wt.sub(Ft)._unit()._perp():Yt,Yt=Yt||tr;let Kt=Yt.add(tr);Kt.x===0&&Kt.y===0||Kt._unit();const tn=Kt.x*tr.x+Kt.y*tr.y,Pr=tn!==0?1/tn:1/0,Mr=Yt.x*tr.y-Yt.y*tr.x>0;let Kr="miter";const dn=2;Kr==="miter"&&Pr>dn&&(Kr="bevel"),Kr==="bevel"&&(Pr>100&&(Kr="flipbevel"),Pr<dn&&(Kr="miter"));const mn=(An,bn,yn,gi)=>{const Ii=new Qt(An.x,An.y),Me=new Qt(An.x,An.y);Ii.x+=bn.x*gi,Ii.y+=bn.y*gi,Me.x-=bn.x*Math.max(yn,1),Me.y-=bn.y*Math.max(yn,1),Xt.push(bn),Nt.push(Ii),Bt.push(Me)};if(Kr==="miter")Kt._mult(Pr),mn(Ft,Kt,0,0);else if(Kr==="flipbevel")Kt=tr.mult(-1),mn(Ft,Kt,0,0),mn(Ft,Kt.mult(-1),0,0);else{const An=-Math.sqrt(Pr*Pr-1),bn=Mr?An:0,yn=Mr?0:An;_t&&mn(Ft,Yt,bn,yn),wt&&mn(Ft,tr,bn,yn)}}Vt.geometry=[...Nt,...Bt.reverse(),Nt[0]],Vt.joinNormals=[...Xt,...Xt.reverse(),Xt[Xt.length-1]];const Tr=Vt.geometry.length-1;for(let hr=0;hr<Tr/2;hr++)if(hr+1<Tr/2){let Kt=hr,tn=hr+1,Pr=Tr-1-hr,Mr=Tr-2-hr;Kt=Kt===0?Tr-1:Kt-1,tn=tn===0?Tr-1:tn-1,Pr=Pr===0?Tr-1:Pr-1,Mr=Mr===0?Tr-1:Mr-1,Vt.indices.push(Pr),Vt.indices.push(tn),Vt.indices.push(Kt),Vt.indices.push(Pr),Vt.indices.push(Mr),Vt.indices.push(tn)}return Vt}(l[0]),l=[Ce.geometry]}const Ee=(it,ct)=>it<(ct.length-1)/2||it===ct.length-1,ue=this.wallMode?[l]:u1(l,500);for(let it=ue.length-1;it>=0;it--){const ct=ue[it];(ct.length===0||(we=ct[0]).every(St=>St.x<=0)||we.every(St=>St.x>=or)||we.every(St=>St.y<=0)||we.every(St=>St.y>=or))&&ue.splice(it,1)}var we;let Te;if(W)Te=i3(ue,$,p);else{Te=[];for(const it of ue)Te.push({polygon:it,bounds:$})}const Ie=te?this.edgeRadius:0,Ge=Ie>0&&this.zoom<17,Qe=(it,ct)=>{if(it.length===0)return!1;const St=it[it.length-1];return ct.x===St.x&&ct.y===St.y};for(const{polygon:it,bounds:ct}of Te){let St=0,Vt=0;for(const xt of it)te&&!xt[0].equals(xt[xt.length-1])&&xt.push(xt[0]),Vt+=te?xt.length-1:xt.length;const Nt=this.segments.prepareSegment((te?5:4)*Vt,this.layoutVertexArray,this.indexArray);le.footprintSegIdx<0&&(le.footprintSegIdx=this.footprintSegments.length),le.polygonSegIdx<0&&(le.polygonSegIdx=this.polygonSegments.length);const Bt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Xt=new WN;if(Xt.vertexOffset=this.footprintVertices.length,Xt.indexOffset=3*this.footprintIndices.length,Xt.ringIndices=[],te){const xt=[],Ft=[];St=Nt.vertexLength;for(let wt=0;wt<it.length;wt++){const Yt=it[wt];Yt.length&&wt!==0&&Ft.push(xt.length/2);const tr=[];let Or,Tr;Or=Yt[1].sub(Yt[0])._perp()._unit(),Xt.ringIndices.push(Yt.length-1);for(let hr=1;hr<Yt.length;hr++){const Kt=Yt[hr],tn=Yt[hr===Yt.length-1?1:hr+1],Pr=Kt.clone();if(Ie){Tr=tn.sub(Kt)._perp()._unit();const Mr=Or.add(Tr)._unit(),Kr=Ie*Math.min(4,1/(Or.x*Mr.x+Or.y*Mr.y));Pr.x+=Kr*Mr.x,Pr.y+=Kr*Mr.y,Pr.x=Math.round(Pr.x),Pr.y=Math.round(Pr.y),Or=Tr}if(!ve||Ie!==0&&!Ge||Qe(tr,Pr)||tr.push(Pr),a0(this.layoutVertexArray,Pr.x,Pr.y,0,0,1,1,0),this.wallMode){const Mr=Ee(hr,Yt);l0(this.wallVertexArray,Ce.joinNormals[hr],!Mr)}Nt.vertexLength++,this.footprintVertices.emplaceBack(Kt.x,Kt.y),xt.push(Kt.x,Kt.y),W&&c0(this.layoutVertexExtArray,U.projectTilePoint(Pr.x,Pr.y,p),U.upVector(p,Pr.x,Pr.y))}ve&&(Ie===0||Ge)&&(tr.length!==0&&Qe(tr,tr[0])&&tr.pop(),this.groundEffect.addData(tr,ct,R))}const _t=this.wallMode?Ce.indices:gc(xt,Ft);for(let wt=0;wt<_t.length;wt+=3)this.footprintIndices.emplaceBack(Xt.vertexOffset+_t[wt+0],Xt.vertexOffset+_t[wt+1],Xt.vertexOffset+_t[wt+2]),this.indexArray.emplaceBack(St+_t[wt],St+_t[wt+2],St+_t[wt+1]),Nt.primitiveLength++;Xt.indexCount+=_t.length,Xt.vertexCount+=this.footprintVertices.length-Xt.vertexOffset}for(let xt=0;xt<it.length;xt++){const Ft=it[xt];re.startRing(le,Ft[0]);let _t=Ft.length>4&&t3(Ft[Ft.length-2],Ft[0],Ft[1]),wt=Ie?Jee(Ft[Ft.length-2],Ft[0],Ft[1],Ie):0;const Yt=[];let tr,Or,Tr;Or=Ft[1].sub(Ft[0])._perp()._unit();let hr=!0;for(let Kt=1,tn=0;Kt<Ft.length;Kt++){let Pr=Ft[Kt-1],Mr=Ft[Kt];const Kr=Ft[Kt===Ft.length-1?1:Kt+1];if(re.appendEdge(le,Mr,Pr),mT(Mr,Pr,ct)){Ie&&(Or=Kr.sub(Mr)._perp()._unit(),hr=!hr);continue}const dn=Mr.sub(Pr)._perp(),mn=dn.x/(Math.abs(dn.x)+Math.abs(dn.y)),An=dn.y>0?1:0,bn=Pr.dist(Mr);if(tn+bn>32768&&(tn=0),Ie){Tr=Kr.sub(Mr)._perp()._unit();let Me=QN(Pr,Mr,Kr,JN(Or,Tr),Ie);isNaN(Me)&&(Me=0);const Oe=Mr.sub(Pr)._unit();Pr=Pr.add(Oe.mult(wt))._round(),Mr=Mr.add(Oe.mult(-Me))._round(),wt=Me,Or=Tr,ve&&this.zoom>=17&&(Qe(Yt,Pr)||Yt.push(Pr),Qe(Yt,Mr)||Yt.push(Mr))}const yn=Nt.vertexLength,gi=Ft.length>4&&t3(Pr,Mr,Kr);let Ii=r3(tn,_t,hr);if(a0(this.layoutVertexArray,Pr.x,Pr.y,mn,An,0,0,Ii),a0(this.layoutVertexArray,Pr.x,Pr.y,mn,An,0,1,Ii),this.wallMode){const Me=Ee(Kt-1,Ft),Oe=Ce.joinNormals[Kt-1];l0(this.wallVertexArray,Oe,Me),l0(this.wallVertexArray,Oe,Me)}if(tn+=bn,Ii=r3(tn,gi,!hr),_t=gi,a0(this.layoutVertexArray,Mr.x,Mr.y,mn,An,0,0,Ii),a0(this.layoutVertexArray,Mr.x,Mr.y,mn,An,0,1,Ii),this.wallMode){const Me=Ee(Kt,Ft),Oe=Ce.joinNormals[Kt];l0(this.wallVertexArray,Oe,Me),l0(this.wallVertexArray,Oe,Me)}if(Nt.vertexLength+=4,this.indexArray.emplaceBack(yn+0,yn+1,yn+2),this.indexArray.emplaceBack(yn+1,yn+3,yn+2),Nt.primitiveLength+=2,Ie){const Me=St+(Kt===1?Ft.length-2:Kt-2),Oe=Kt===1?St:Me+1;if(this.indexArray.emplaceBack(yn+1,Me,yn+3),this.indexArray.emplaceBack(Me,Oe,yn+3),Nt.primitiveLength+=2,tr===void 0&&(tr=yn),!mT(Kr,Ft[Kt],ct)){const Pt=Kt===Ft.length-1?tr:Nt.vertexLength;this.indexArray.emplaceBack(yn+2,yn+3,Pt),this.indexArray.emplaceBack(yn+3,Pt+1,Pt),this.indexArray.emplaceBack(yn+3,Oe,Pt+1),Nt.primitiveLength+=3}hr=!hr}if(W){const Me=this.layoutVertexExtArray,Oe=U.projectTilePoint(Pr.x,Pr.y,p),Pt=U.projectTilePoint(Mr.x,Mr.y,p),ir=U.upVector(p,Pr.x,Pr.y),pr=U.upVector(p,Mr.x,Mr.y);c0(Me,Oe,ir),c0(Me,Oe,ir),c0(Me,Pt,pr),c0(Me,Pt,pr)}}te&&(St+=Ft.length-1),ve&&Ie&&this.zoom>=17&&(Yt.length!==0&&Qe(Yt,Yt[0])&&Yt.pop(),this.groundEffect.addData(Yt,ct,R,Ie>0))}this.footprintSegments.push(Xt),Bt.triangleCount=this.indexArray.length-Bt.triangleArrayOffset,this.polygonSegments.push(Bt),++le.footprintSegLen,++le.polygonSegLen}if(le.vertexCount=this.layoutVertexArray.length-le.vertexArrayOffset,le.groundVertexCount=this.groundEffect.vertexArray.length-le.groundVertexArrayOffset,le.vertexCount!==0){if(le.centroidXY=re.borders?HN:this.encodeCentroid(re,le),this.centroidData.push(le),re.borders){this.featuresOnBorder.push(re);const it=this.featuresOnBorder.length-1;for(let ct=0;ct<re.borders.length;ct++)re.borders[ct][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[ct].push(it)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,h,v,x,p,I),this.groundEffect.addPaintPropertiesData(s,h,v,x,p,I),this.maxHeight=Math.max(this.maxHeight,_e)}}sortBorders(){for(let s=0;s<this.borderFeatureIndices.length;s++)this.borderFeatureIndices[s].sort((l,h)=>this.featuresOnBorder[l].borders[s][0]-this.featuresOnBorder[h].borders[s][0])}splitToSubtiles(){const s=[];for(let P=0;P<this.centroidData.length;P++){const I=this.centroidData[P],R=+(I.min.y+I.max.y>or),$=2*R+(+(I.min.x+I.max.x>or)^R);for(let U=0;U<I.polygonSegLen;U++){const W=I.polygonSegIdx+U;s.push({centroidIdx:P,subtile:$,polygonSegmentIdx:W,triangleSegmentIdx:this.polygonSegments[W].triangleSegIdx})}}const l=new bs;s.sort((P,I)=>P.triangleSegmentIdx===I.triangleSegmentIdx?P.subtile-I.subtile:P.triangleSegmentIdx-I.triangleSegmentIdx);let h=0,p=0,v=0;for(const P of s){if(P.triangleSegmentIdx!==h)break;v++}const x=s.length;for(;p!==s.length;){h=s[p].triangleSegmentIdx;let P=0,I=p,R=p;for(let $=I;$<v&&s[$].subtile===P;$++)R++;for(;I!==v;){const $=s[I];P=$.subtile;const U=this.centroidData[$.centroidIdx].min.clone(),W=this.centroidData[$.centroidIdx].max.clone(),te={vertexOffset:this.segments.segments[h].vertexOffset,primitiveOffset:l.length,vertexLength:this.segments.segments[h].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let re=I;re<R;re++){const le=s[re],ve=this.polygonSegments[le.polygonSegmentIdx],_e=this.centroidData[le.centroidIdx].min,Ce=this.centroidData[le.centroidIdx].max,Ee=this.indexArray.uint16;for(let ue=ve.triangleArrayOffset;ue<ve.triangleArrayOffset+ve.triangleCount;ue++)l.emplaceBack(Ee[3*ue],Ee[3*ue+1],Ee[3*ue+2]);te.primitiveLength+=ve.triangleCount,U.x=Math.min(U.x,_e.x),U.y=Math.min(U.y,_e.y),W.x=Math.max(W.x,Ce.x),W.y=Math.max(W.y,Ce.y)}te.primitiveLength>0&&this.triangleSubSegments.push({segment:te,min:U,max:W}),I=R;for(let re=I;re<v&&s[re].subtile===s[I].subtile;re++)R++}p=v;for(let $=p;$<x&&s[$].triangleSegmentIdx===s[p].triangleSegmentIdx;$++)v++}l._trim(),this.indexArray=l}getVisibleSegments(s,l,h){const p=new ji;if(this.wallMode){for(const le of this.triangleSubSegments)p.segments.push(le.segment);return p}let v=0,x=0;const P=1<<s.canonical.z;if(l){const le=l.getMinMaxForTile(s);le&&(v=le.min,x=le.max)}x+=this.maxHeight;const I=s.toUnwrapped();let R;const $=[I.canonical.x/P+I.wrap,I.canonical.y/P],U=[(I.canonical.x+1)/P+I.wrap,(I.canonical.y+1)/P],W=(le,ve,_e)=>[le[0]*(1-_e[0])+ve[0]*_e[0],le[1]*(1-_e[1])+ve[1]*_e[1]],te=[],re=[];for(const le of this.triangleSubSegments){te[0]=le.min.x/or,te[1]=le.min.y/or,re[0]=le.max.x/or,re[1]=le.max.y/or;const ve=W($,U,te),_e=W($,U,re);if(new Mi([ve[0],ve[1],v],[_e[0],_e[1],x]).intersectsPrecise(h)===0){R&&(p.segments.push(R),R=void 0);continue}const Ce=le.segment;R&&R.vertexOffset!==Ce.vertexOffset&&(p.segments.push(R),R=void 0),R?(R.vertexLength+=Ce.vertexLength,R.primitiveLength+=Ce.primitiveLength):R={vertexOffset:Ce.vertexOffset,primitiveLength:Ce.primitiveLength,vertexLength:Ce.vertexLength,primitiveOffset:Ce.primitiveOffset,sortKey:void 0,vaos:{}}}return R&&p.segments.push(R),p}encodeCentroid(s,l){const h=s.centroid(),p=l.span(),v=Math.min(7,Math.round(p.x*this.tileToMeter/10)),x=Math.min(7,Math.round(p.y*this.tileToMeter/10));return new Qt(rt(h.x,1,or-1)<<3|v,rt(h.y,1,or-1)<<3|x)}encodeBorderCentroid(s){if(!s.borders)return new Qt(0,0);const l=s.borders,h=Number.MAX_VALUE;if(l[0][0]!==h||l[1][0]!==h){const p=l[0][0]!==h?0:1;return new Qt(6|(l[0][0]!==h?0:65528),(l[p][0]+l[p][1])/2<<3|6)}{const p=l[2][0]!==h?2:3;return new Qt((l[p][0]+l[p][1])/2<<3|6,6|(l[2][0]!==h?0:65528))}}showCentroid(s){const l=this.centroidData[s.centroidDataIndex];l.flags&=_m,l.centroidXY.x=0,l.centroidXY.y=0,this.writeCentroidToBuffer(l)}writeCentroidToBuffer(s){this.groundEffect.updateHiddenByLandmark(s);const l=s.vertexArrayOffset,h=s.vertexCount+s.vertexArrayOffset,p=s.flags&_m?HN:s.centroidXY,v=this.centroidVertexArray.geta_centroid_pos0(l);if(this.centroidVertexArray.geta_centroid_pos1(l)!==p.y||v!==p.x){for(let x=l;x<h;++x)this.centroidVertexArray.emplace(x,p.x,p.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const s of this.centroidData)this.writeCentroidToBuffer(s)}updateReplacement(s,l,h){if(l.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=l.updateTime;const p=l.getReplacementRegionsForTile(s.toUnwrapped());if(hT(this.activeReplacements,p))return;if(this.activeReplacements=p,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const x of this.centroidData)x.flags&=2147483647;const v=[];for(const x of this.activeReplacements){if(x.order<h)continue;const P=Math.max(1,Math.pow(2,x.footprintTileId.canonical.z-s.canonical.z));for(const I of this.centroidData)if(!(I.flags&_m||x.min.x>I.max.x||I.min.x>x.max.x||x.min.y>I.max.y||I.min.y>x.max.y))for(let R=0;R<I.footprintSegLen;R++){const $=this.footprintSegments[I.footprintSegIdx+R];if(v.length=0,Qee(this.footprintVertices,$.vertexOffset,$.vertexCount,x.footprintTileId.canonical,s.canonical,v),$N(x.footprint,v,this.footprintIndices.uint16,$.indexOffset,$.indexCount,-$.vertexOffset,-P)){I.flags|=_m;break}}}for(const x of this.centroidData)this.writeCentroidToBuffer(x);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(s,l,h){let p=!1;for(let v=0;v<h.footprintSegLen;v++){const x=this.footprintSegments[h.footprintSegIdx+v];let P=0;for(const I of x.ringIndices){for(let R=P,$=I+P-1;R<I+P;$=R++){const U=this.footprintVertices.int16[2*(R+x.vertexOffset)+0],W=this.footprintVertices.int16[2*(R+x.vertexOffset)+1],te=this.footprintVertices.int16[2*($+x.vertexOffset)+1];W>l!=te>l&&s<(this.footprintVertices.int16[2*($+x.vertexOffset)+0]-U)*(l-W)/(te-W)+U&&(p=!p)}P=I}}return p}getHeightAtTileCoord(s,l){let h=Number.NEGATIVE_INFINITY,p=!0;const v=4*(s+or)*or+(l+or);if(this.partLookup.hasOwnProperty(v)){const x=this.partLookup[v];return x?{height:x.height,hidden:!!(x.flags&_m)}:void 0}for(const x of this.centroidData)s>x.max.x||x.min.x>s||l>x.max.y||x.min.y>l||this.footprintContainsPoint(s,l,x)&&x&&x.height>h&&(h=x.height,this.partLookup[v]=x,p=!!(x.flags&_m));if(h!==Number.NEGATIVE_INFINITY)return{height:h,hidden:p};this.partLookup[v]=void 0}}function JN(c,s){const l=c.add(s)._unit();return c.x*l.x+c.y*l.y}function Jee(c,s,l,h){const p=s.sub(c)._perp()._unit(),v=l.sub(s)._perp()._unit();return QN(c,s,l,JN(p,v),h)}function QN(c,s,l,h,p){const v=Math.sqrt(1-h*h);return Math.min(c.dist(s)/3,s.dist(l)/3,p*v/h)}function mT(c,s,l){return c.x<l[0].x&&s.x<l[0].x||c.x>l[1].x&&s.x>l[1].x||c.y<l[0].y&&s.y<l[0].y||c.y>l[1].y&&s.y>l[1].y}function e3(c,s){return c.x<s[0].x||c.x>s[1].x||c.y<s[0].y||c.y>s[1].y}function t3(c,s,l){if(c.x<0||c.x>=or||s.x<0||s.x>=or||l.x<0||l.x>=or)return!1;const h=l.sub(s),p=h.perp(),v=c.sub(s);return(h.x*v.x+h.y*v.y)/Math.sqrt((h.x*h.x+h.y*h.y)*(v.x*v.x+v.y*v.y))>-.866&&p.x*v.x+p.y*v.y<0}function r3(c,s,l){const h=s?2|c:-3&c;return l?1|h:-2&h}function n3(){const c=Math.PI/32,s=Math.tan(c),l=de;return l*Math.sqrt(1+2*s*s)-l}function i3(c,s,l){const h=1<<l.z,p=qe(l.x/h),v=qe((l.x+1)/h),x=Ze(l.y/h),P=Ze((l.y+1)/h);return function(I,R,$,U,W=0,te){const re=[];if(!I.length||!$||!U)return re;const le=(Te,Ie)=>{for(const Ge of Te)re.push({polygon:Ge,bounds:Ie})},ve=Math.ceil(Math.log2($)),_e=Math.ceil(Math.log2(U)),Ce=ve-_e,Ee=[];for(let Te=0;Te<Math.abs(Ce);Te++)Ee.push(Ce>0?0:1);for(let Te=0;Te<Math.min(ve,_e);Te++)Ee.push(0),Ee.push(1);let ue=I;if(ue=h1(ue,R[0].y-W,R[1].y+W,1),ue=h1(ue,R[0].x-W,R[1].x+W,0),!ue.length)return re;const we=[];for(Ee.length?we.push({polygons:ue,bounds:R,depth:0}):le(ue,R);we.length;){const Te=we.pop(),Ie=Te.depth,Ge=Ee[Ie],Qe=Te.bounds[0],it=Te.bounds[1],ct=Ge===0?Qe.x:Qe.y,St=Ge===0?it.x:it.y,Vt=te?te(Ge,ct,St):.5*(ct+St),Nt=h1(Te.polygons,ct-W,Vt+W,Ge),Bt=h1(Te.polygons,Vt-W,St+W,Ge);if(Nt.length){const Xt=[Qe,new Qt(Ge===0?Vt:it.x,Ge===1?Vt:it.y)];Ee.length>Ie+1?we.push({polygons:Nt,bounds:Xt,depth:Ie+1}):le(Nt,Xt)}if(Bt.length){const Xt=[new Qt(Ge===0?Vt:Qe.x,Ge===1?Vt:Qe.y),it];Ee.length>Ie+1?we.push({polygons:Bt,bounds:Xt,depth:Ie+1}):le(Bt,Xt)}}return re}(c,s,Math.ceil((v-p)/11.25),Math.ceil((x-P)/11.25),1,(I,R,$)=>{if(I===0)return .5*(R+$);{const U=Ze((l.y+R/or)/h);return(je(.5*(Ze((l.y+$/or)/h)+U))*h-l.y)*or}})}function Qee(c,s,l,h,p,v){const x=Math.pow(2,h.z-p.z);for(let P=0;P<l;P++){let I=c.int16[2*(P+s)+0],R=c.int16[2*(P+s)+1];I=(I+p.x*or)*x-h.x*or,R=(R+p.y*or)*x-h.y*or,v.push(new Qt(I,R))}}let s3,o3;yr(g1,"FillExtrusionBucket",{omit:["layers","features"]}),yr(ZN,"PartData"),yr(WN,"FootprintSegment"),yr(XN,"BorderCentroidData"),yr(YN,"GroundEffect");class qg extends Qt{constructor(s,l,h){super(s,l),this.z=h}}class a3 extends qg{constructor(s,l,h,p){super(s,l,h),this.w=p}}function l3(c,s,l,h){const p=l==="x"?"y":"x",v=(h-c[l])/(s[l]-c[l]);c[p]=Math.round(c[p]+(s[p]-c[p])*v),c[l]=h,c.hasOwnProperty("z")&&(c.z=Br(c.z,s.z,v)),c.hasOwnProperty("w")&&(c.w=Br(c.w,s.w,v))}function c3(c,s,l,h){const p=l,v=h;for(const x of["x","y"]){let P=c,I=s;P[x]>=I[x]&&(P=s,I=c),P[x]<p&&I[x]>p&&l3(P,I,x,p),P[x]<v&&I[x]>v&&l3(I,P,x,v)}}function y1(c,s,l,h,p,v){const x=[];for(let P=0;P<c.length;P++){const I=c[P];let R;const $=x.length;let U=0;for(let W=0;W<I.length-1;W++){let te=I[W],re=I[W+1],le=0;const ve=U;let _e,Ce;v&&(le=Math.hypot(re.x-te.x,re.y-te.y),U+=le,_e=te,Ce=re),te.x<s&&re.x<s||(te.x<s?te=new Qt(s,te.y+(s-te.x)/(re.x-te.x)*(re.y-te.y))._round():re.x<s&&(re=new Qt(s,te.y+(s-te.x)/(re.x-te.x)*(re.y-te.y))._round()),te.y<l&&re.y<l||(te.y<l?te=new Qt(te.x+(l-te.y)/(re.y-te.y)*(re.x-te.x),l)._round():re.y<l&&(re=new Qt(te.x+(l-te.y)/(re.y-te.y)*(re.x-te.x),l)._round()),te.x>=h&&re.x>=h||(te.x>=h?te=new Qt(h,te.y+(h-te.x)/(re.x-te.x)*(re.y-te.y))._round():re.x>=h&&(re=new Qt(h,te.y+(h-te.x)/(re.x-te.x)*(re.y-te.y))._round()),te.y>=p&&re.y>=p||(te.y>=p?te=new Qt(te.x+(p-te.y)/(re.y-te.y)*(re.x-te.x),p)._round():re.y>=p&&(re=new Qt(te.x+(p-te.y)/(re.y-te.y)*(re.x-te.x),p)._round()),R&&te.equals(R[R.length-1])||(R=[te],x.push(R),v&&v.push({progress:{min:ve+u3(_e,Ce,te)*le,max:1},parentIndex:P,prevPoint:_e,nextPoint:Ce})),R.push(re),v&&(v[v.length-1].progress.max=ve+u3(_e,Ce,re)*le,v[v.length-1].nextPoint=Ce)))))}if(v&&U>0)for(let W=$;W<x.length;W++)v[W].progress.min/=U,v[W].progress.max/=U}return x}function ete(c,s,l,h,p){if(c.length<2)return void h.push(c);const v=[];for(;s.valid();){const[R,$]=s.get();for(let U=0;U<c.length-1;U++){const W=c[U],te=c[U+1],re=Pi(W,te,R,$);if(re){const[le]=re,ve=new Qt(Br(W.x,te.x,le),Br(W.y,te.y,le));v.push({t:U+le,distance:0,point:ve})}}s.next()}if(v.length===0)return void h.push(c);v.sort((R,$)=>R.t-$.t);let x=0,P=0,I=[];for(h.push(I);x!==c.length;){if(P===v.length){for(;x!==c.length;)I.length!==0&&I[I.length-1].equals(c[x])||I.push(c[x]),x++;break}v[P].t<=x?(I.length!==0&&I[I.length-1].equals(v[P].point)||I.push(v[P].point),Math.trunc(v[P].t),P++):(I.length!==0&&I[I.length-1].equals(c[x])||I.push(c[x]),x++)}}function u3(c,s,l){return c.x!==s.x?(l.x-c.x)/(s.x-c.x):c.y!==s.y?(l.y-c.y)/(s.y-c.y):0}function u0(c,s){return c.x*s.x+c.y*s.y}function d3(c,s){if(c.length===1){let l=0;const h=s[l++];let p;for(;!p||h.equals(p);)if(p=s[l++],!p)return 1/0;for(;l<s.length;l++){const v=s[l],x=c[0],P=p.sub(h),I=v.sub(h),R=x.sub(h),$=u0(P,P),U=u0(P,I),W=u0(I,I),te=u0(R,P),re=u0(R,I),le=$*W-U*U,ve=(W*te-U*re)/le,_e=($*re-U*te)/le,Ce=h.z*(1-ve-_e)+p.z*ve+v.z*_e;if(isFinite(Ce))return Ce}return 1/0}{let l=1/0;for(const h of s)l=Math.min(l,h.z);return l}}function h3(c,s,l,h,p,v,x,P){const I=x*p.getElevationAt(c,s,!0,!0),R=v[0]!==0,$=R?v[1]===0?x*(v[0]/7-450):x*function(U,W,te){const re=Math.floor(W[0]/8),le=Math.floor(W[1]/8),ve=10*(W[0]-8*re),_e=10*(W[1]-8*le),Ce=U.getElevationAt(re,le,!0,!0),Ee=U.getMeterToDEM(te),ue=Math.floor(.5*(ve*Ee-1)),we=Math.floor(.5*(_e*Ee-1)),Te=U.tileCoordToPixel(re,le),Ie=2*ue+1,Ge=2*we+1,Qe=function(Bt,Xt,xt,Ft,_t){return[Bt.getElevationAtPixel(Xt,xt,!0),Bt.getElevationAtPixel(Xt+_t,xt,!0),Bt.getElevationAtPixel(Xt,xt+_t,!0),Bt.getElevationAtPixel(Xt+Ft,xt+_t,!0)]}(U,Te.x-ue,Te.y-we,Ie,Ge),it=Math.abs(Qe[0]-Qe[1]),ct=Math.abs(Qe[2]-Qe[3]),St=Math.abs(Qe[0]-Qe[2])+Math.abs(Qe[1]-Qe[3]),Vt=Math.min(.25,.5*Ee*(it+ct)/Ie),Nt=Math.min(.25,.5*Ee*St/Ge);return Ce+Math.max(Vt*ve,Nt*_e)}(p,v,P):I;return{base:I+(l===0?-1:l),top:R?Math.max($+h,I+l+2):I+h}}const tte=qn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),rte=qn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:nte}=tte,ite=qn([{name:"a_packed",components:3,type:"Float32"}]),{members:ste}=ite,ote=qn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:ate}=ote;class f3{constructor(s,l){this.width=s,this.height=l,this.nextRow=0,this.image=new Gt({width:s,height:l}),this.positions={},this.uploaded=!1}getDash(s,l){const h=this.getKey(s,l);return this.positions[h]}trim(){const s=this.width,l=this.height=gr(this.nextRow);this.image.resize({width:s,height:l})}getKey(s,l){return s.join(",")+l}getDashRanges(s,l,h){const p=[];let v=s.length%2==1?-s[s.length-1]*h:0,x=s[0]*h,P=!0;p.push({left:v,right:x,isDash:P,zeroLength:s[0]===0});let I=s[0];for(let R=1;R<s.length;R++){P=!P;const $=s[R];v=I*h,I+=$,x=I*h,p.push({left:v,right:x,isDash:P,zeroLength:$===0})}return p}addRoundDash(s,l,h){const p=l/2;for(let v=-h;v<=h;v++){const x=this.width*(this.nextRow+h+v);let P=0,I=s[P];for(let R=0;R<this.width;R++){R/I.right>1&&(I=s[++P]);const $=Math.abs(R-I.left),U=Math.abs(R-I.right),W=Math.min($,U);let te;const re=v/h*(p+1);if(I.isDash){const le=p-Math.abs(re);te=Math.sqrt(W*W+le*le)}else te=p-Math.sqrt(W*W+re*re);this.image.data[x+R]=Math.max(0,Math.min(255,te+128))}}}addRegularDash(s,l){for(let I=s.length-1;I>=0;--I){const R=s[I],$=s[I+1];R.zeroLength?s.splice(I,1):$&&$.isDash===R.isDash&&($.left=R.left,s.splice(I,1))}const h=s[0],p=s[s.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const v=this.width*this.nextRow;let x=0,P=s[x];for(let I=0;I<this.width;I++){I/P.right>1&&(P=s[++x]);const R=Math.abs(I-P.left),$=Math.abs(I-P.right),U=Math.min(R,$);this.image.data[v+I]=Math.max(0,Math.min(255,(P.isDash?U:-U)+l+128))}}addDash(s,l){const h=this.getKey(s,l);if(this.positions[h])return this.positions[h];const p=l==="round",v=p?7:0,x=2*v+1;if(this.nextRow+x>this.height)return sn("LineAtlas out of space"),null;s.length===0&&s.push(1);let P=0;for(let $=0;$<s.length;$++)s[$]<0&&(sn("Negative value is found in line dasharray, replacing values with 0"),s[$]=0),P+=s[$];if(P!==0){const $=this.width/P,U=this.getDashRanges(s,this.width,$);p?this.addRoundDash(U,$,v):this.addRegularDash(U,l==="square"?.5*$:0)}const I=this.nextRow+v;this.nextRow+=x;const R={tl:[I,v],br:[P,0]};return this.positions[h]=R,R}}yr(f3,"LineAtlas");const lte=vm.VectorTileFeature.types,cte=Math.cos(Math.PI/180*37.5),ute=Math.cos(Math.PI/180*5);class gT{constructor(s){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=s.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=s.overscaling,this.pixelRatio=s.pixelRatio,this.layers=s.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=s.index,this.projection=s.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new Qp,this.layoutVertexArray2=new Il,this.patternVertexArray=new Il,this.indexArray=new bs,this.programConfigurations=new Kc(s.layers,{zoom:s.zoom,lut:s.lut}),this.segments=new ji,this.maxLineLength=0,this.zOffsetVertexArray=new Il,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.tessellationStep=s.tessellationStep?s.tessellationStep:or/64}updateFootprints(s,l){}populate(s,l,h,p){this.hasPattern=eT("line",this.layers,this.pixelRatio,l);const v=this.layers[0].layout.get("line-sort-key");this.tileToMeter=at(h);const x=this.layers[0].layout.get("line-elevation-reference");if(x==="hd-road-markup")this.elevationType="road";else{const W=this.layers[0].layout.get("line-z-offset"),te=W.isConstant()&&!W.constantOr(0);this.elevationType=x!=="sea"&&x!=="ground"&&te?"none":"offset",this.elevationType==="offset"&&x==="none"&&sn(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const P=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&P!==void 0;const I=[];for(const{feature:W,id:te,index:re,sourceLayerIndex:le}of s){const ve=this.layers[0]._featureFilter.needGeometry,_e=Ar(W,ve);if(!this.layers[0]._featureFilter.filter(new ni(this.zoom),_e,h))continue;const Ce=v?v.evaluate(_e,{},h):void 0,Ee={id:te,properties:W.properties,type:W.type,sourceLayerIndex:le,index:re,geometry:ve?_e.geometry:wr(W,h,p),patterns:{},sortKey:Ce};I.push(Ee)}v&&I.sort((W,te)=>W.sortKey-te.sortKey);const{lineAtlas:R,featureIndex:$}=l,U=this.addConstantDashes(R);for(const W of I){const{geometry:te,index:re,sourceLayerIndex:le}=W;if(U&&this.addFeatureDashes(W,R),this.hasPattern){const ve=tT("line",this.layers,W,this.zoom,this.pixelRatio,l);this.patternFeatures.push(ve)}else this.addFeature(W,te,re,h,R.positions,l.availableImages,l.brightness,l.elevationFeatures);$.insert(s[re].feature,te,re,le,this.index)}}addConstantDashes(s){let l=!1;for(const h of this.layers){const p=h.paint.get("line-dasharray").value,v=h.layout.get("line-cap").value;if(p.kind!=="constant"||v.kind!=="constant")l=!0;else{const x=v.value,P=p.value;if(!P)continue;s.addDash(P,x)}}return l}addFeatureDashes(s,l){const h=this.zoom;for(const p of this.layers){const v=p.paint.get("line-dasharray").value,x=p.layout.get("line-cap").value;if(v.kind==="constant"&&x.kind==="constant")continue;let P,I;if(v.kind==="constant"){if(P=v.value,!P)continue}else P=v.evaluate({zoom:h},s);I=x.kind==="constant"?x.value:x.evaluate({zoom:h},s),l.addDash(P,I),s.patterns[p.id]=[l.getKey(P,I)]}}update(s,l,h,p,v,x,P){this.programConfigurations.updatePaintArrays(s,l,v,h,p,x,P)}addFeatures(s,l,h,p,v,x){for(const P of this.patternFeatures)this.addFeature(P,P.geometry,P.index,l,h,p,x)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,ste)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=s.createVertexBuffer(this.patternVertexArray,ate)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=s.createVertexBuffer(this.zOffsetVertexArray,rte.members,!0)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,nte),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(s){if(s.properties&&s.properties.hasOwnProperty("mapbox_clip_start")&&s.properties.hasOwnProperty("mapbox_clip_end"))return{start:+s.properties.mapbox_clip_start,end:+s.properties.mapbox_clip_end}}addFeature(s,l,h,p,v,x,P,I){const R=this.layers[0].layout,$=R.get("line-join").evaluate(s,{}),U=R.get("line-cap").evaluate(s,{}),W=R.get("line-miter-limit"),te=R.get("line-round-limit");this.lineClips=this.lineFeatureClips(s),this.lineFeature=s,this.zOffsetValue=R.get("line-z-offset").value;const re=this.layers[0].paint.get("line-width").value;if(re.kind!=="constant"&&re.isLineProgressConstant===!1&&(this.variableWidthValue=re),this.elevationType==="road"){const le=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(s,l,p,I,$,U,W,te)){const[ve,_e]=this.clipRuntimeLinesToTile(l,1);for(let Ce=0;Ce<ve.length;Ce++){const Ee=ve[Ce],ue=_e[Ce],we={progress:{min:ue.progress.min,max:ue.progress.max},nextDir:this.computeSegNextDir(ue,Ee),prevDir:this.computeSegPrevDir(ue,Ee)};this.addLine(Ee,s,p,$,U,W,te,we)}this.fillNonElevatedRoadSegment(le)}}else for(const le of l)this.addLine(le,s,p,$,U,W,te);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,h,v,x,p,P)}computeSegNextDir(s,l){return s.nextPoint.sub(l.at(-2)).unit()}computeSegPrevDir(s,l){return l[1].sub(s.prevPoint).unit()}clipLinesToTile(s,l){return y1(s,-l,-l,or+l,or+l)}clipRuntimeLinesToTile(s,l){const h=[];return[y1(s,-l,-l,or+l,or+l,h),h]}addElevatedRoadFeature(s,l,h,p,v,x,P,I){const R=[],$=oT.getElevationFeature(s,p);if($){const U=this.clipLinesToTile(l,1),W=this.prepareElevatedLines(U,$,h);for(const te of W)R.push({geometry:te,elevation:$,elevationTileID:h,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(R.length===0)return!1;for(const U of R){const W=this.layoutVertexArray.length;this.addLine(U.geometry,s,h,v,x,P,I);const te=new AN(h,U.elevationTileID);if(U.elevation)for(let re=W;re<this.layoutVertexArray.length;re++){const le=new Qt(this.layoutVertexArray.int16[6*re]>>1,this.layoutVertexArray.int16[6*re+1]>>1),ve=te.pointElevation(le,U.elevation,.05);this.updateHeightRange(ve),this.zOffsetVertexArray.emplaceBack(ve,0,0)}else this.fillNonElevatedRoadSegment(W)}return!0}prepareElevatedLines(s,l,h){if(l.constantHeight!=null)return s;const p=[],v=1/at(h);for(const x of s)ete(x,new CN(l,v),0,p);return p}fillNonElevatedRoadSegment(s){for(let l=s;l<this.layoutVertexArray.length;l++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(s){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,s),this.heightRange.max=Math.max(this.heightRange.max,s)):this.heightRange={min:s,max:s}}addLine(s,l,h,p,v,x,P,I){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const R=p==="none";this.patternJoinNone=this.hasPattern&&R,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const $=I&&I.progress.min>0,U=I&&I.progress.max<1;if(this.lineClips){let Ge={min:this.lineClips.start,max:this.lineClips.end},Qe=1;if(I){const St=this.lineClips.end-this.lineClips.start;Ge=function(Vt,Nt,Bt){return{min:eo(Vt.min,Nt,Bt),max:eo(Vt.max,Nt,Bt)}}(I.progress,{min:0,max:1},Ge),St>0&&(Qe=(Ge.max-Ge.min)/St)}const it=+l.properties.mapbox_clip_feature_len,ct=+l.properties.mapbox_clip_seg_len;if(Number.isNaN(it)||Number.isNaN(ct)){for(let Vt=0;Vt<s.length-1;Vt++)this.totalDistance+=s[Vt].dist(s[Vt+1]);const St=this.totalDistance/(Ge.max-Ge.min);this.totalFeatureLength=Number.isFinite(St)?St:0,this.lineClips.start=Ge.min,this.lineClips.end=Ge.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=it,this.distance=ct*Qe,this.lineClips.start=Ge.min,this.lineClips.end=Ge.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const W=lte[l.type]==="Polygon";let te=s.length;for(;te>=2&&s[te-1].equals(s[te-2]);)te--;let re=0;for(;re<te-1&&s[re].equals(s[re+1]);)re++;if(te<(W?3:2))return;p==="bevel"&&(x=1.05);const le=this.segments.prepareSegment(10*te,this.layoutVertexArray,this.indexArray);let ve,_e,Ce,Ee,ue,we,Te,Ie;I&&I.prevDir&&(we=I.prevDir.perp()),I&&I.nextDir&&(Te=I.nextDir.perp()),this.e1=this.e2=-1,W&&(ve=s[te-2],ue=s[re].sub(ve)._unit()._perp());for(let Ge=re;Ge<te;Ge++){if(Ce=Ge===te-1?W?s[re+1]:void 0:s[Ge+1],Ce&&s[Ge].equals(Ce))continue;ue&&(Ee=ue),ve&&(_e=ve),ve=s[Ge],Ie=this.evaluateLineProgressFeatures(_e?_e.dist(ve):0),ue=Ce?Ce.sub(ve)._unit()._perp():Ee,Ee=Ee||ue;const Qe=_e&&Ce;let it=Qe?p:W||R?"butt":v;const ct=Ee.x*ue.x+Ee.y*ue.y;if(R){const _t=function(wt){if(wt.patternJoinNone){const Yt=wt.segmentPoints.length/2,tr=wt.lineSoFar-wt.segmentStart;for(let Or=0;Or<Yt;++Or){const Tr=wt.segmentPoints[2*Or+1],hr=Math.round(wt.segmentPoints[2*Or])+.5+.25*Tr;wt.patternVertexArray.emplaceBack(hr,tr,wt.segmentStart),wt.patternVertexArray.emplaceBack(hr,tr,wt.segmentStart)}wt.segmentPoints.length=0}wt.e1=wt.e2=-1};if(Qe&&ct<ute){this.updateDistance(_e,ve),this.addCurrentVertex(ve,Ee,1,1,le,Ie),_t(this),this.addCurrentVertex(ve,ue,-1,-1,le,Ie);continue}if(_e){if(!Ce){this.updateDistance(_e,ve),this.addCurrentVertex(ve,Ee,1,1,le,Ie),_t(this);continue}it="miter"}}let St=Ee.add(ue);St.x===0&&St.y===0||St._unit();const Vt=St.x*ue.x+St.y*ue.y,Nt=Vt!==0?1/Vt:1/0,Bt=2*Math.sqrt(2-2*Vt),Xt=Vt<cte&&_e&&Ce,xt=Ee.x*ue.y-Ee.y*ue.x>0,Ft=this.overscaling<=16?15*or/(512*this.overscaling):0;if(Qe&&it==="round"){if(Nt<P)it="miter";else if(Nt<=2){const _t=yT(ve,-10,or+10);it=this.elevationType==="offset"&&(_t||this.hasCrossSlope)?"miter":"fakeround"}}if(it==="miter"&&Nt>x&&(it="bevel"),it==="bevel"&&(Nt>2&&(it="flipbevel"),Nt<x&&(it="miter")),_e&&!(it==="miter"&&Xt)&&this.updateDistance(_e,ve),it==="miter")if(Xt){const _t=ve.dist(_e);if(_t>2*Ft){const Yt=ve.sub(ve.sub(_e)._mult(Ft/_t)._round());this.updateDistance(_e,Yt),this.addCurrentVertex(Yt,Ee,0,0,le,Ie),_e=Yt}this.updateDistance(_e,ve),St._mult(Nt),this.addCurrentVertex(ve,St,0,0,le,Ie);const wt=ve.dist(Ce);if(wt>2*Ft){const Yt=ve.add(Ce.sub(ve)._mult(Ft/wt)._round());this.updateDistance(ve,Yt),this.addCurrentVertex(Yt,ue,0,0,le,Ie),ve=Yt}}else St._mult(Nt),this.addCurrentVertex(ve,St,0,0,le,Ie);else if(it==="flipbevel"){if(Nt>100)St=ue.mult(-1);else{const _t=Nt*Ee.add(ue).mag()/Ee.sub(ue).mag();St._perp()._mult(_t*(xt?-1:1))}this.addCurrentVertex(ve,St,0,0,le,Ie),this.addCurrentVertex(ve,St.mult(-1),0,0,le,Ie)}else if(it==="bevel"||it==="fakeround"){Ie!=null&&_e&&this.addCurrentVertex(ve,Te||Ee,-1,-1,le,Ie);const _t=ve.dist(_e)<=2*Ft&&it!=="bevel",wt=St.mult(xt?1:-1);wt._mult(Nt);const Yt=ue.mult(xt?-1:1),tr=Ee.mult(xt?-1:1),Or=this.evaluateLineProgressFeatures(this.distance);if(Ie==null&&(this.addHalfVertex(ve,wt.x,wt.y,!1,!xt,0,le,Or),_t||this.addHalfVertex(ve,wt.x+2*tr.x,wt.y+2*tr.y,!1,xt,0,le,Or)),it==="fakeround"){const Tr=Math.round(180*Bt/Math.PI/20);this.addHalfVertex(ve,tr.x,tr.y,!1,xt,0,le,Or);for(let hr=0;hr<Tr;hr++){let Kt=hr/Tr;if(Kt!==.5){const Pr=Kt-.5;Kt+=Kt*Pr*(Kt-1)*((1.0904+ct*(ct*(3.55645-1.43519*ct)-3.2452))*Pr*Pr+(.848013+ct*(.215638*ct-1.06021)))}const tn=Yt.sub(tr)._mult(Kt)._add(tr)._unit();this.addHalfVertex(ve,tn.x,tn.y,!1,xt,0,le,Or)}this.addHalfVertex(ve,Yt.x,Yt.y,!1,xt,0,le,Or)}_t||Ie!=null||this.addHalfVertex(ve,wt.x+2*Yt.x,wt.y+2*Yt.y,!1,xt,0,le,Or),Ie!=null&&Ce&&this.addCurrentVertex(ve,we||ue,1,1,le,Ie)}else if(it==="butt")this.addCurrentVertex(ve,St,0,0,le,Ie);else if(it==="square"){if(!_e){const _t=$?0:-1;this.addCurrentVertex(ve,St,_t,_t,le,Ie)}if(this.addCurrentVertex(ve,St,0,0,le,Ie),_e){const _t=U?0:1;this.addCurrentVertex(ve,St,_t,_t,le,Ie)}}else if(it==="round"){if(_e){const _t=!Qe&&Te?Te:Ee;this.addCurrentVertex(ve,_t,0,0,le,Ie),!Qe&&U||this.addCurrentVertex(ve,_t,1,1,le,Ie,!0)}if(Ce){const _t=!Qe&&we?we:ue;!Qe&&$||this.addCurrentVertex(ve,_t,-1,-1,le,Ie,!0),this.addCurrentVertex(ve,_t,0,0,le,Ie)}}}}addVerticesTo(s,l,h,p,v,x,P,I,R,$){const U=(l.w-s.w)/this.tessellationStep|0;let W=0;const te=this.scaledDistance;if(U>1){this.lineSoFar=s.w;const le=(l.x-s.x)/U,ve=(l.y-s.y)/U,_e=(l.z-s.z)/U,Ce=(l.w-s.w)/U;for(let Ee=1;Ee<U;++Ee){s.x+=le,s.y+=ve,s.z+=_e,this.lineSoFar+=Ce,W+=Ce;const ue=this.evaluateLineProgressFeatures(this.prevDistance+W);this.scaledDistance=(this.prevDistance+W)/this.totalDistance,this.addHalfVertex(s,h,p,$,!1,P,R,ue),this.addHalfVertex(s,v,x,$,!0,-I,R,ue)}}this.lineSoFar=l.w,this.scaledDistance=te;const re=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(l,h,p,$,!1,P,R,re),this.addHalfVertex(l,v,x,$,!0,-I,R,re)}evaluateLineProgressFeatures(s){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+s)/this.totalFeatureLength):sn(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let l=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(l=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:l}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:l}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:l}}addCurrentVertex(s,l,h,p,v,x,P=!1){const I=l.x+l.y*h,R=l.y-l.x*h,$=l.y*p-l.x,U=-l.y-l.x*p;if(x!=null){const W=this.elevationType==="offset",te=-10,re=or+10,le=x.zOffset,ve=new a3(s.x,s.y,le,this.lineSoFar),_e=!!W&&yT(s,te,re),Ce=this.lineSoFar,Ee=this.distance;if(this.currentVertex)if(_e){const ue=this.currentVertexIsOutside,we=this.currentVertex,Te=new a3(s.x,s.y,le,this.lineSoFar);if(c3(we,Te,te,re),!yT(Te,te,re)){if(ue){this.e1=this.e2=-1,this.distance-=we.dist(ve),this.lineSoFar=we.w;const Ie=this.evaluateLineProgressFeatures(we.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(we,I,R,P,!1,h,v,Ie),this.addHalfVertex(we,$,U,P,!0,-p,v,Ie),this.prevDistance=this.distance}this.distance=this.prevDistance+we.dist(Te),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(we,Te,I,R,$,U,h,p,v,P),this.distance=Ee,this.scaledDistance=this.distance/this.totalDistance}}else{const ue=this.currentVertex;if(this.currentVertexIsOutside){c3(ue,ve,te,re),this.e1=this.e2=-1,this.distance-=ue.dist(ve),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=ue.w;const we=this.evaluateLineProgressFeatures(ue.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ue,I,R,P,!1,h,v,we),this.addHalfVertex(ue,$,U,P,!0,-p,v,we),this.prevDistance=this.distance,this.distance=Ee,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(ue,ve,I,R,$,U,h,p,v,P)}else _e||(this.addHalfVertex(s,I,R,P,!1,h,v,x),this.addHalfVertex(s,$,U,P,!0,-p,v,x));this.currentVertex=ve,this.currentVertexIsOutside=_e,this.lineSoFar=Ce}else this.addHalfVertex(s,I,R,P,!1,h,v,x),this.addHalfVertex(s,$,U,P,!0,-p,v,x)}addHalfVertex({x:s,y:l},h,p,v,x,P,I,R){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),x||this.segmentPoints.push(this.lineSoFar-this.segmentStart,P)),this.layoutVertexArray.emplaceBack((s<<1)+(v?1:0),(l<<1)+(x?1:0),Math.round(63*h)+128,Math.round(63*p)+128,1+(P===0?0:P<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const U=Br(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,U)}const $=I.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,$),I.primitiveLength++),x?this.e2=$:this.e1=$,R!=null&&this.zOffsetVertexArray.emplaceBack(R.zOffset,R.variableWidth,R.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(s,l){this.prevDistance=this.distance,this.distance+=s.dist(l),this.updateScaledDistance()}}function yT(c,s,l){return c.x<s||c.x>l||c.y<s||c.y>l}let p3,m3;function g3(c,s,l){return s*(or/(c.tileSize*Math.pow(2,l-c.tileID.overscaledZ)))}yr(gT,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const y3=(c,s,l)=>(1-l)*c+l*s;function v3(c,s){return 1/g3(c,1,s.tileZoom)}function _3(c,s,l,h){return c.translatePosMatrix(h||s.tileID.projMatrix,s,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}const x3=c=>{const s=[];b3(c)&&s.push("RENDER_LINE_DASH"),c.paint.get("line-gradient")&&s.push("RENDER_LINE_GRADIENT");const l=c.paint.get("line-trim-offset");l[0]===0&&l[1]===0||s.push("RENDER_LINE_TRIM_OFFSET"),c.paint.get("line-border-width").constantOr(1)!==0&&s.push("RENDER_LINE_BORDER");const h=c.layout.get("line-join").constantOr("miter")==="none",p=!!c.paint.get("line-pattern").constantOr(1);return h&&p&&s.push("LINE_JOIN_NONE"),s};function b3(c){const s=c.paint.get("line-dasharray").value;return s.value||s.kind!=="constant"}let vT;const w3=()=>vT||(vT={layout:p3||(p3=new qi({"line-cap":new br(ft.layout_line["line-cap"]),"line-join":new br(ft.layout_line["line-join"]),"line-miter-limit":new er(ft.layout_line["line-miter-limit"]),"line-round-limit":new er(ft.layout_line["line-round-limit"]),"line-sort-key":new br(ft.layout_line["line-sort-key"]),"line-z-offset":new br(ft.layout_line["line-z-offset"]),"line-elevation-reference":new er(ft.layout_line["line-elevation-reference"]),"line-cross-slope":new er(ft.layout_line["line-cross-slope"]),visibility:new er(ft.layout_line.visibility),"line-width-unit":new er(ft.layout_line["line-width-unit"])})),paint:m3||(m3=new qi({"line-opacity":new br(ft.paint_line["line-opacity"]),"line-color":new br(ft.paint_line["line-color"]),"line-translate":new er(ft.paint_line["line-translate"]),"line-translate-anchor":new er(ft.paint_line["line-translate-anchor"]),"line-width":new br(ft.paint_line["line-width"]),"line-gap-width":new br(ft.paint_line["line-gap-width"]),"line-offset":new br(ft.paint_line["line-offset"]),"line-blur":new br(ft.paint_line["line-blur"]),"line-dasharray":new br(ft.paint_line["line-dasharray"]),"line-pattern":new br(ft.paint_line["line-pattern"]),"line-pattern-cross-fade":new er(ft.paint_line["line-pattern-cross-fade"]),"line-gradient":new $s(ft.paint_line["line-gradient"]),"line-trim-offset":new er(ft.paint_line["line-trim-offset"]),"line-trim-fade-range":new er(ft.paint_line["line-trim-fade-range"]),"line-trim-color":new er(ft.paint_line["line-trim-color"]),"line-emissive-strength":new er(ft.paint_line["line-emissive-strength"]),"line-border-width":new br(ft.paint_line["line-border-width"]),"line-border-color":new br(ft.paint_line["line-border-color"]),"line-occlusion-opacity":new er(ft.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new br({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new br({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new br({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new br({type:"string",default:"default","property-type":"data-driven"})}))},vT);class dte extends br{possiblyEvaluate(s,l){return l=new ni(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,transition:l.transition}),super.possiblyEvaluate(s,l)}evaluate(s,l,h,p){return l=pt({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(s,l,h,p)}}let d0;function S3(c,s){return s>0?s+2*c:c}const hte=qn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),fte=qn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),pte=qn([{name:"a_projected_pos",components:4,type:"Float32"}],4);qn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const mte=qn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),gte=qn([{name:"a_texb",components:2,type:"Uint16"}]),yte=qn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),vte=qn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);qn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const E3=qn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),_te=qn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);qn([{name:"triangle",components:3,type:"Uint16"}]),qn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),qn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),qn([{type:"Float32",name:"offsetX"}]),qn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Co=24;function xte(c,s,l){return c.sections.forEach(h=>{h.text=function(p,v,x){const P=v.layout.get("text-transform").evaluate(x,{});return P==="uppercase"?p=p.toLocaleUpperCase():P==="lowercase"&&(p=p.toLocaleLowerCase()),Sa.applyArabicShaping&&(p=Sa.applyArabicShaping(p)),p}(h.text,s,l)}),c}const h0={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function bte(c){return c==="︶"||c==="﹈"||c==="︸"||c==="﹄"||c==="﹂"||c==="︾"||c==="︼"||c==="︺"||c==="︘"||c==="﹀"||c==="︐"||c==="︓"||c==="︔"||c==="｀"||c==="￣"||c==="︑"||c==="︒"}function wte(c){return c==="︵"||c==="﹇"||c==="︷"||c==="﹃"||c==="﹁"||c==="︽"||c==="︻"||c==="︹"||c==="︗"||c==="︿"}var T3,_T,C3,xT={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Ste(){return T3||(T3=1,xT.read=function(c,s,l,h,p){var v,x,P=8*p-h-1,I=(1<<P)-1,R=I>>1,$=-7,U=l?p-1:0,W=l?-1:1,te=c[s+U];for(U+=W,v=te&(1<<-$)-1,te>>=-$,$+=P;$>0;v=256*v+c[s+U],U+=W,$-=8);for(x=v&(1<<-$)-1,v>>=-$,$+=h;$>0;x=256*x+c[s+U],U+=W,$-=8);if(v===0)v=1-R;else{if(v===I)return x?NaN:1/0*(te?-1:1);x+=Math.pow(2,h),v-=R}return(te?-1:1)*x*Math.pow(2,v-h)},xT.write=function(c,s,l,h,p,v){var x,P,I,R=8*v-p-1,$=(1<<R)-1,U=$>>1,W=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,te=h?0:v-1,re=h?1:-1,le=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(P=isNaN(s)?1:0,x=$):(x=Math.floor(Math.log(s)/Math.LN2),s*(I=Math.pow(2,-x))<1&&(x--,I*=2),(s+=x+U>=1?W/I:W*Math.pow(2,1-U))*I>=2&&(x++,I/=2),x+U>=$?(P=0,x=$):x+U>=1?(P=(s*I-1)*Math.pow(2,p),x+=U):(P=s*Math.pow(2,U-1)*Math.pow(2,p),x=0));p>=8;c[l+te]=255&P,te+=re,P/=256,p-=8);for(x=x<<p|P,R+=p;R>0;c[l+te]=255&x,te+=re,x/=256,R-=8);c[l+te-re]|=128*le}),xT}function A3(){if(C3)return _T;C3=1,_T=s;var c=Ste();function s(ue){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(ue)?ue:new Uint8Array(ue||0),this.pos=0,this.type=0,this.length=this.buf.length}s.Varint=0,s.Fixed64=1,s.Bytes=2,s.Fixed32=5;var l=4294967296,h=1/l,p=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function v(ue){return ue.type===s.Bytes?ue.readVarint()+ue.pos:ue.pos+1}function x(ue,we,Te){return Te?4294967296*we+(ue>>>0):4294967296*(we>>>0)+(ue>>>0)}function P(ue,we,Te){var Ie=we<=16383?1:we<=2097151?2:we<=268435455?3:Math.floor(Math.log(we)/(7*Math.LN2));Te.realloc(Ie);for(var Ge=Te.pos-1;Ge>=ue;Ge--)Te.buf[Ge+Ie]=Te.buf[Ge]}function I(ue,we){for(var Te=0;Te<ue.length;Te++)we.writeVarint(ue[Te])}function R(ue,we){for(var Te=0;Te<ue.length;Te++)we.writeSVarint(ue[Te])}function $(ue,we){for(var Te=0;Te<ue.length;Te++)we.writeFloat(ue[Te])}function U(ue,we){for(var Te=0;Te<ue.length;Te++)we.writeDouble(ue[Te])}function W(ue,we){for(var Te=0;Te<ue.length;Te++)we.writeBoolean(ue[Te])}function te(ue,we){for(var Te=0;Te<ue.length;Te++)we.writeFixed32(ue[Te])}function re(ue,we){for(var Te=0;Te<ue.length;Te++)we.writeSFixed32(ue[Te])}function le(ue,we){for(var Te=0;Te<ue.length;Te++)we.writeFixed64(ue[Te])}function ve(ue,we){for(var Te=0;Te<ue.length;Te++)we.writeSFixed64(ue[Te])}function _e(ue,we){return(ue[we]|ue[we+1]<<8|ue[we+2]<<16)+16777216*ue[we+3]}function Ce(ue,we,Te){ue[Te]=we,ue[Te+1]=we>>>8,ue[Te+2]=we>>>16,ue[Te+3]=we>>>24}function Ee(ue,we){return(ue[we]|ue[we+1]<<8|ue[we+2]<<16)+(ue[we+3]<<24)}return s.prototype={destroy:function(){this.buf=null},readFields:function(ue,we,Te){for(Te=Te||this.length;this.pos<Te;){var Ie=this.readVarint(),Ge=Ie>>3,Qe=this.pos;this.type=7&Ie,ue(Ge,we,this),this.pos===Qe&&this.skip(Ie)}return we},readMessage:function(ue,we){return this.readFields(ue,we,this.readVarint()+this.pos)},readFixed32:function(){var ue=_e(this.buf,this.pos);return this.pos+=4,ue},readSFixed32:function(){var ue=Ee(this.buf,this.pos);return this.pos+=4,ue},readFixed64:function(){var ue=_e(this.buf,this.pos)+_e(this.buf,this.pos+4)*l;return this.pos+=8,ue},readSFixed64:function(){var ue=_e(this.buf,this.pos)+Ee(this.buf,this.pos+4)*l;return this.pos+=8,ue},readFloat:function(){var ue=c.read(this.buf,this.pos,!0,23,4);return this.pos+=4,ue},readDouble:function(){var ue=c.read(this.buf,this.pos,!0,52,8);return this.pos+=8,ue},readVarint:function(ue){var we,Te,Ie=this.buf;return we=127&(Te=Ie[this.pos++]),Te<128?we:(we|=(127&(Te=Ie[this.pos++]))<<7,Te<128?we:(we|=(127&(Te=Ie[this.pos++]))<<14,Te<128?we:(we|=(127&(Te=Ie[this.pos++]))<<21,Te<128?we:function(Ge,Qe,it){var ct,St,Vt=it.buf;if(ct=(112&(St=Vt[it.pos++]))>>4,St<128||(ct|=(127&(St=Vt[it.pos++]))<<3,St<128)||(ct|=(127&(St=Vt[it.pos++]))<<10,St<128)||(ct|=(127&(St=Vt[it.pos++]))<<17,St<128)||(ct|=(127&(St=Vt[it.pos++]))<<24,St<128)||(ct|=(1&(St=Vt[it.pos++]))<<31,St<128))return x(Ge,ct,Qe);throw new Error("Expected varint not more than 10 bytes")}(we|=(15&(Te=Ie[this.pos]))<<28,ue,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var ue=this.readVarint();return ue%2==1?(ue+1)/-2:ue/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var ue=this.readVarint()+this.pos,we=this.pos;return this.pos=ue,ue-we>=12&&p?function(Te,Ie,Ge){return p.decode(Te.subarray(Ie,Ge))}(this.buf,we,ue):function(Te,Ie,Ge){for(var Qe="",it=Ie;it<Ge;){var ct,St,Vt,Nt=Te[it],Bt=null,Xt=Nt>239?4:Nt>223?3:Nt>191?2:1;if(it+Xt>Ge)break;Xt===1?Nt<128&&(Bt=Nt):Xt===2?(192&(ct=Te[it+1]))==128&&(Bt=(31&Nt)<<6|63&ct)<=127&&(Bt=null):Xt===3?(St=Te[it+2],(192&(ct=Te[it+1]))==128&&(192&St)==128&&((Bt=(15&Nt)<<12|(63&ct)<<6|63&St)<=2047||Bt>=55296&&Bt<=57343)&&(Bt=null)):Xt===4&&(St=Te[it+2],Vt=Te[it+3],(192&(ct=Te[it+1]))==128&&(192&St)==128&&(192&Vt)==128&&((Bt=(15&Nt)<<18|(63&ct)<<12|(63&St)<<6|63&Vt)<=65535||Bt>=1114112)&&(Bt=null)),Bt===null?(Bt=65533,Xt=1):Bt>65535&&(Bt-=65536,Qe+=String.fromCharCode(Bt>>>10&1023|55296),Bt=56320|1023&Bt),Qe+=String.fromCharCode(Bt),it+=Xt}return Qe}(this.buf,we,ue)},readBytes:function(){var ue=this.readVarint()+this.pos,we=this.buf.subarray(this.pos,ue);return this.pos=ue,we},readPackedVarint:function(ue,we){if(this.type!==s.Bytes)return ue.push(this.readVarint(we));var Te=v(this);for(ue=ue||[];this.pos<Te;)ue.push(this.readVarint(we));return ue},readPackedSVarint:function(ue){if(this.type!==s.Bytes)return ue.push(this.readSVarint());var we=v(this);for(ue=ue||[];this.pos<we;)ue.push(this.readSVarint());return ue},readPackedBoolean:function(ue){if(this.type!==s.Bytes)return ue.push(this.readBoolean());var we=v(this);for(ue=ue||[];this.pos<we;)ue.push(this.readBoolean());return ue},readPackedFloat:function(ue){if(this.type!==s.Bytes)return ue.push(this.readFloat());var we=v(this);for(ue=ue||[];this.pos<we;)ue.push(this.readFloat());return ue},readPackedDouble:function(ue){if(this.type!==s.Bytes)return ue.push(this.readDouble());var we=v(this);for(ue=ue||[];this.pos<we;)ue.push(this.readDouble());return ue},readPackedFixed32:function(ue){if(this.type!==s.Bytes)return ue.push(this.readFixed32());var we=v(this);for(ue=ue||[];this.pos<we;)ue.push(this.readFixed32());return ue},readPackedSFixed32:function(ue){if(this.type!==s.Bytes)return ue.push(this.readSFixed32());var we=v(this);for(ue=ue||[];this.pos<we;)ue.push(this.readSFixed32());return ue},readPackedFixed64:function(ue){if(this.type!==s.Bytes)return ue.push(this.readFixed64());var we=v(this);for(ue=ue||[];this.pos<we;)ue.push(this.readFixed64());return ue},readPackedSFixed64:function(ue){if(this.type!==s.Bytes)return ue.push(this.readSFixed64());var we=v(this);for(ue=ue||[];this.pos<we;)ue.push(this.readSFixed64());return ue},skip:function(ue){var we=7&ue;if(we===s.Varint)for(;this.buf[this.pos++]>127;);else if(we===s.Bytes)this.pos=this.readVarint()+this.pos;else if(we===s.Fixed32)this.pos+=4;else{if(we!==s.Fixed64)throw new Error("Unimplemented type: "+we);this.pos+=8}},writeTag:function(ue,we){this.writeVarint(ue<<3|we)},realloc:function(ue){for(var we=this.length||16;we<this.pos+ue;)we*=2;if(we!==this.length){var Te=new Uint8Array(we);Te.set(this.buf),this.buf=Te,this.length=we}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(ue){this.realloc(4),Ce(this.buf,ue,this.pos),this.pos+=4},writeSFixed32:function(ue){this.realloc(4),Ce(this.buf,ue,this.pos),this.pos+=4},writeFixed64:function(ue){this.realloc(8),Ce(this.buf,-1&ue,this.pos),Ce(this.buf,Math.floor(ue*h),this.pos+4),this.pos+=8},writeSFixed64:function(ue){this.realloc(8),Ce(this.buf,-1&ue,this.pos),Ce(this.buf,Math.floor(ue*h),this.pos+4),this.pos+=8},writeVarint:function(ue){(ue=+ue||0)>268435455||ue<0?function(we,Te){var Ie,Ge;if(we>=0?(Ie=we%4294967296|0,Ge=we/4294967296|0):(Ge=~(-we/4294967296),4294967295^(Ie=~(-we%4294967296))?Ie=Ie+1|0:(Ie=0,Ge=Ge+1|0)),we>=18446744073709552e3||we<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Te.realloc(10),function(Qe,it,ct){ct.buf[ct.pos++]=127&Qe|128,Qe>>>=7,ct.buf[ct.pos++]=127&Qe|128,Qe>>>=7,ct.buf[ct.pos++]=127&Qe|128,Qe>>>=7,ct.buf[ct.pos++]=127&Qe|128,ct.buf[ct.pos]=127&(Qe>>>=7)}(Ie,0,Te),function(Qe,it){var ct=(7&Qe)<<4;it.buf[it.pos++]|=ct|((Qe>>>=3)?128:0),Qe&&(it.buf[it.pos++]=127&Qe|((Qe>>>=7)?128:0),Qe&&(it.buf[it.pos++]=127&Qe|((Qe>>>=7)?128:0),Qe&&(it.buf[it.pos++]=127&Qe|((Qe>>>=7)?128:0),Qe&&(it.buf[it.pos++]=127&Qe|((Qe>>>=7)?128:0),Qe&&(it.buf[it.pos++]=127&Qe)))))}(Ge,Te)}(ue,this):(this.realloc(4),this.buf[this.pos++]=127&ue|(ue>127?128:0),ue<=127||(this.buf[this.pos++]=127&(ue>>>=7)|(ue>127?128:0),ue<=127||(this.buf[this.pos++]=127&(ue>>>=7)|(ue>127?128:0),ue<=127||(this.buf[this.pos++]=ue>>>7&127))))},writeSVarint:function(ue){this.writeVarint(ue<0?2*-ue-1:2*ue)},writeBoolean:function(ue){this.writeVarint(!!ue)},writeString:function(ue){ue=String(ue),this.realloc(4*ue.length),this.pos++;var we=this.pos;this.pos=function(Ie,Ge,Qe){for(var it,ct,St=0;St<Ge.length;St++){if((it=Ge.charCodeAt(St))>55295&&it<57344){if(!ct){it>56319||St+1===Ge.length?(Ie[Qe++]=239,Ie[Qe++]=191,Ie[Qe++]=189):ct=it;continue}if(it<56320){Ie[Qe++]=239,Ie[Qe++]=191,Ie[Qe++]=189,ct=it;continue}it=ct-55296<<10|it-56320|65536,ct=null}else ct&&(Ie[Qe++]=239,Ie[Qe++]=191,Ie[Qe++]=189,ct=null);it<128?Ie[Qe++]=it:(it<2048?Ie[Qe++]=it>>6|192:(it<65536?Ie[Qe++]=it>>12|224:(Ie[Qe++]=it>>18|240,Ie[Qe++]=it>>12&63|128),Ie[Qe++]=it>>6&63|128),Ie[Qe++]=63&it|128)}return Qe}(this.buf,ue,this.pos);var Te=this.pos-we;Te>=128&&P(we,Te,this),this.pos=we-1,this.writeVarint(Te),this.pos+=Te},writeFloat:function(ue){this.realloc(4),c.write(this.buf,ue,this.pos,!0,23,4),this.pos+=4},writeDouble:function(ue){this.realloc(8),c.write(this.buf,ue,this.pos,!0,52,8),this.pos+=8},writeBytes:function(ue){var we=ue.length;this.writeVarint(we),this.realloc(we);for(var Te=0;Te<we;Te++)this.buf[this.pos++]=ue[Te]},writeRawMessage:function(ue,we){this.pos++;var Te=this.pos;ue(we,this);var Ie=this.pos-Te;Ie>=128&&P(Te,Ie,this),this.pos=Te-1,this.writeVarint(Ie),this.pos+=Ie},writeMessage:function(ue,we,Te){this.writeTag(ue,s.Bytes),this.writeRawMessage(we,Te)},writePackedVarint:function(ue,we){we.length&&this.writeMessage(ue,I,we)},writePackedSVarint:function(ue,we){we.length&&this.writeMessage(ue,R,we)},writePackedBoolean:function(ue,we){we.length&&this.writeMessage(ue,W,we)},writePackedFloat:function(ue,we){we.length&&this.writeMessage(ue,$,we)},writePackedDouble:function(ue,we){we.length&&this.writeMessage(ue,U,we)},writePackedFixed32:function(ue,we){we.length&&this.writeMessage(ue,te,we)},writePackedSFixed32:function(ue,we){we.length&&this.writeMessage(ue,re,we)},writePackedFixed64:function(ue,we){we.length&&this.writeMessage(ue,le,we)},writePackedSFixed64:function(ue,we){we.length&&this.writeMessage(ue,ve,we)},writeBytesField:function(ue,we){this.writeTag(ue,s.Bytes),this.writeBytes(we)},writeFixed32Field:function(ue,we){this.writeTag(ue,s.Fixed32),this.writeFixed32(we)},writeSFixed32Field:function(ue,we){this.writeTag(ue,s.Fixed32),this.writeSFixed32(we)},writeFixed64Field:function(ue,we){this.writeTag(ue,s.Fixed64),this.writeFixed64(we)},writeSFixed64Field:function(ue,we){this.writeTag(ue,s.Fixed64),this.writeSFixed64(we)},writeVarintField:function(ue,we){this.writeTag(ue,s.Varint),this.writeVarint(we)},writeSVarintField:function(ue,we){this.writeTag(ue,s.Varint),this.writeSVarint(we)},writeStringField:function(ue,we){this.writeTag(ue,s.Bytes),this.writeString(we)},writeFloatField:function(ue,we){this.writeTag(ue,s.Fixed32),this.writeFloat(we)},writeDoubleField:function(ue,we){this.writeTag(ue,s.Fixed64),this.writeDouble(we)},writeBooleanField:function(ue,we){this.writeVarintField(ue,!!we)}},_T}var v1=Ds(A3());const bT=3;function Ete(c,s,l){s.glyphs=[],c===1&&l.readMessage(Tte,s)}function Tte(c,s,l){if(c===3){const{id:h,bitmap:p,width:v,height:x,left:P,top:I,advance:R}=l.readMessage(Cte,{});s.glyphs.push({id:h,bitmap:new Gt({width:v+2*bT,height:x+2*bT},p),metrics:{width:v,height:x,left:P,top:I,advance:R}})}else c===4?s.ascender=l.readSVarint():c===5&&(s.descender=l.readSVarint())}function Cte(c,s,l){c===1?s.id=l.readVarint():c===2?s.bitmap=l.readBytes():c===3?s.width=l.readVarint():c===4?s.height=l.readVarint():c===5?s.left=l.readSVarint():c===6?s.top=l.readSVarint():c===7&&(s.advance=l.readVarint())}const Ate=bT,Dl={horizontal:1,vertical:2,horizontalOnly:3};class f0{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(s,l){const h=new f0;return h.scale=s||1,h.fontStack=l,h}static forImage(s){const l=new f0;return l.image=s,l}}class Qy{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(s,l,h){const p=new Qy;for(let v=0;v<s.sections.length;v++){const x=s.sections[v];x.image?p.addImageSection(x,h):p.addTextSection(x,l)}return p}length(){return this.text.length}getSection(s){return this.sections[this.sectionIndex[s]]}getSections(){return this.sections}getSectionIndex(s){return this.sectionIndex[s]}getCodePoint(s){return this.text.codePointAt(s)}verticalizePunctuation(s){this.text=function(l,h){let p="";for(let v=0;v<l.length;v++){const x=l.charCodeAt(v+1)||null,P=l.charCodeAt(v-1)||null;p+=!h&&(x&&Hc(x)&&!h0[l[v+1]]||P&&Hc(P)&&!h0[l[v-1]])||!h0[l[v]]?l[v]:h0[l[v]]}return p}(this.text,s)}trim(){let s=0;for(let h=0;h<this.text.length&&_1[this.text.charCodeAt(h)];h++)s++;let l=this.text.length;for(let h=this.text.length-1;h>=0&&h>=s&&_1[this.text.charCodeAt(h)];h--)l--;this.text=this.text.substring(s,l),this.sectionIndex=this.sectionIndex.slice(s,l)}substring(s,l){const h=new Qy;return h.text=this.text.substring(s,l),h.sectionIndex=this.sectionIndex.slice(s,l),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((s,l)=>Math.max(s,this.sections[l].scale),0)}addTextSection(s,l){this.text+=s.text,this.sections.push(f0.forText(s.scale,s.fontStack||l));const h=this.sections.length-1;for(let p=0;p<s.text.length;++p)this.sectionIndex.push(h)}addImageSection(s,l){const h=s.image?s.image.getPrimary():null;if(!h)return void sn("Can't add FormattedSection with an empty image.");h.scaleSelf(l);const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCodePoint(p),this.sections.push(f0.forImage(h)),this.sectionIndex.push(this.sections.length-1)):sn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function wT(c,s,l,h,p,v,x,P,I,R,$,U,W,te,re,le=1){const ve=Qy.fromFeature(c,p,le);U===Dl.vertical&&ve.verticalizePunctuation(W);let _e=[];const Ce=function(Ie,Ge,Qe,it,ct,St){if(!Ie)return[];const Vt=[],Nt=function(Ft,_t,wt,Yt,tr,Or){let Tr=0;for(let hr=0;hr<Ft.length();hr++){const Kt=Ft.getSection(hr);Tr+=P3(Ft.getCodePoint(hr),Kt,Yt,tr,_t,Or)}return Tr/Math.max(1,Math.ceil(Tr/wt))}(Ie,Ge,Qe,it,ct,St),Bt=Ie.text.indexOf("​")>=0;let Xt=0;for(let Ft=0;Ft<Ie.length();Ft++){const _t=Ie.getSection(Ft),wt=Ie.getCodePoint(Ft);if(_1[wt]||(Xt+=P3(wt,_t,it,ct,Ge,St)),Ft<Ie.length()-1){const Yt=!((xt=wt)<11904||!(zr["Bopomofo Extended"](xt)||zr.Bopomofo(xt)||zr["CJK Compatibility Forms"](xt)||zr["CJK Compatibility Ideographs"](xt)||zr["CJK Compatibility"](xt)||zr["CJK Radicals Supplement"](xt)||zr["CJK Strokes"](xt)||zr["CJK Symbols and Punctuation"](xt)||zr["CJK Unified Ideographs Extension A"](xt)||zr["CJK Unified Ideographs"](xt)||zr["Enclosed CJK Letters and Months"](xt)||zr["Halfwidth and Fullwidth Forms"](xt)||zr.Hiragana(xt)||zr["Ideographic Description Characters"](xt)||zr["Kangxi Radicals"](xt)||zr["Katakana Phonetic Extensions"](xt)||zr.Katakana(xt)||zr["Vertical Forms"](xt)||zr["Yi Radicals"](xt)||zr["Yi Syllables"](xt)));(Pte[wt]||Yt||_t.image)&&Vt.push(I3(Ft+1,Xt,Nt,Vt,Mte(wt,Ie.getCodePoint(Ft+1),Yt&&Bt),!1))}}var xt;return k3(I3(Ie.length(),Xt,Nt,Vt,0,!0))}(ve,R,v,s,h,te),{processBidirectionalText:Ee,processStyledBidirectionalText:ue}=Sa;if(Ee&&ve.sections.length===1){const Ie=Ee(ve.toString(),Ce);for(const Ge of Ie){const Qe=new Qy;Qe.text=Ge,Qe.sections=ve.sections;for(let it=0;it<Ge.length;it++)Qe.sectionIndex.push(0);_e.push(Qe)}}else if(ue){const Ie=ue(ve.text,ve.sectionIndex,Ce);for(const Ge of Ie){const Qe=new Qy;Qe.text=Ge[0],Qe.sectionIndex=Ge[1],Qe.sections=ve.sections,_e.push(Qe)}}else _e=function(Ie,Ge){const Qe=[],it=Ie.text;let ct=0;for(const St of Ge)Qe.push(Ie.substring(ct,St)),ct=St;return ct<it.length&&Qe.push(Ie.substring(ct,it.length)),Qe}(ve,Ce);const we=[],Te={positionedLines:we,text:ve.toString(),top:$[1],bottom:$[1],left:$[0],right:$[0],writingMode:U,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Ie,Ge,Qe,it,ct,St,Vt,Nt,Bt,Xt,xt,Ft){let _t=0,wt=0,Yt=0;const tr=Nt==="right"?1:Nt==="left"?0:.5;let Or=!1;for(const Mr of ct){const Kr=Mr.getSections();for(const dn of Kr){if(dn.image)continue;const mn=Ge[dn.fontStack];if(mn&&(Or=mn.ascender!==void 0&&mn.descender!==void 0,!Or))break}if(!Or)break}let Tr=0;for(const Mr of ct){Mr.trim();const Kr=Mr.getMaxScale(),dn=(Kr-1)*Co,mn={positionedGlyphs:[],lineOffset:0};Ie.positionedLines[Tr]=mn;const An=mn.positionedGlyphs;let bn=0;if(!Mr.length()){wt+=St,++Tr;continue}let yn=0,gi=0;for(let Me=0;Me<Mr.length();Me++){const Oe=Mr.getSection(Me),Pt=Mr.getSectionIndex(Me),ir=Mr.getCodePoint(Me);let pr=Oe.scale,fr=null,Ir=null,Wr=null,Ln=Co,Rn=0;Bt===Dl.vertical&&((hr=ir)===12312||hr===12313||hr===12316||hr===12540||hr===12448)&&(Bt=Dl.horizontal);const vn=!(Bt===Dl.horizontal||!xt&&!$a(ir)||xt&&(_1[ir]||Wp(ir)));if(Oe.image){const ui=it.get(Oe.image.toString());if(!ui)continue;Wr=Oe.image,Ie.iconsInText=Ie.iconsInText||!0,Ir=ui.paddedRect;const Ei=ui.displaySize;pr=pr*Co/Ft,fr={width:Ei[0],height:Ei[1],left:0,top:-3,advance:vn?Ei[1]:Ei[0],localGlyph:!1},Rn=Or?-fr.height*pr:Kr*Co-17-Ei[1]*pr,Ln=fr.advance;const jn=(vn?Ei[0]:Ei[1])*pr-Co*Kr;jn>0&&jn>bn&&(bn=jn)}else{const ui=Qe[Oe.fontStack];if(!ui)continue;ui[ir]&&(Ir=ui[ir]);const Ei=Ge[Oe.fontStack];if(!Ei)continue;const jn=Ei.glyphs[ir];if(!jn)continue;if(fr=jn.metrics,Ln=ir!==8203?Co:0,Or){const Yi=Ei.ascender!==void 0?Math.abs(Ei.ascender):0,ki=Ei.descender!==void 0?Math.abs(Ei.descender):0,ai=(Yi+ki)*pr;yn<ai&&(yn=ai,gi=(Yi-ki)/2*pr),Rn=-Yi*pr}else Rn=(Kr-pr)*Co-17}vn?(Ie.verticalizable=!0,An.push({glyph:ir,image:Wr,x:_t,y:wt+Rn,vertical:vn,scale:pr,localGlyph:fr.localGlyph,fontStack:Oe.fontStack,sectionIndex:Pt,metrics:fr,rect:Ir}),_t+=Ln*pr+Xt):(An.push({glyph:ir,image:Wr,x:_t,y:wt+Rn,vertical:vn,scale:pr,localGlyph:fr.localGlyph,fontStack:Oe.fontStack,sectionIndex:Pt,metrics:fr,rect:Ir}),_t+=fr.advance*pr+Xt)}An.length!==0&&(Yt=Math.max(_t-Xt,Yt),Or?O3(An,tr,bn,gi,St*Kr/2):O3(An,tr,bn,0,St/2)),_t=0;const Ii=St*Kr+bn;mn.lineOffset=Math.max(bn,dn),wt+=Ii,++Tr}var hr;const Kt=wt,{horizontalAlign:tn,verticalAlign:Pr}=ST(Vt);(function(Mr,Kr,dn,mn,An,bn){const yn=(Kr-dn)*An,gi=-bn*mn;for(const Ii of Mr)for(const Me of Ii.positionedGlyphs)Me.x+=yn,Me.y+=gi})(Ie.positionedLines,tr,tn,Pr,Yt,Kt),Ie.top+=-Pr*Kt,Ie.bottom=Ie.top+Kt,Ie.left+=-tn*Yt,Ie.right=Ie.left+Yt,Ie.hasBaseline=Or}(Te,s,l,h,_e,x,P,I,U,R,W,re),!function(Ie){for(const Ge of Ie)if(Ge.positionedGlyphs.length!==0)return!1;return!0}(we))return Te}const _1={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Pte={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function P3(c,s,l,h,p,v){if(s.image){const x=h.get(s.image.toString());return x?x.displaySize[0]*s.scale*Co/v+p:0}{const x=l[s.fontStack],P=x&&x.glyphs[c];return P?P.metrics.advance*s.scale+p:0}}function M3(c,s,l,h){const p=Math.pow(c-s,2);return h?c<s?p/2:2*p:p+Math.abs(l)*l}function Mte(c,s,l){let h=0;return c===10&&(h-=1e4),l&&(h+=150),c!==40&&c!==65288||(h+=50),s!==41&&s!==65289||(h+=50),h}function I3(c,s,l,h,p,v){let x=null,P=M3(s,l,p,v);for(const I of h){const R=M3(s-I.x,l,p,v)+I.badness;R<=P&&(x=I,P=R)}return{index:c,x:s,priorBreak:x,badness:P}}function k3(c){return c?k3(c.priorBreak).concat(c.index):[]}function ST(c){let s=.5,l=.5;switch(c){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:s,verticalAlign:l}}function O3(c,s,l,h,p){if(!(s||l||h||p))return;const v=c.length-1,x=c[v],P=(x.x+x.metrics.advance*x.scale)*s;for(let I=0;I<=v;I++)c[I].x-=P,c[I].y+=l+h+p}function L3(c){return c.imagePrimary!==void 0&&c.top!==void 0&&c.bottom!==void 0&&c.left!==void 0&&c.right!==void 0}function Ite(c,s,l,h){const{horizontalAlign:p,verticalAlign:v}=ST(h),x=l[0]-c.displaySize[0]*p,P=l[1]-c.displaySize[1]*v;return{imagePrimary:c,imageSecondary:s,top:P,bottom:P+c.displaySize[1],left:x,right:x+c.displaySize[0]}}function R3(c,s,l,h,p,v){const x=c.imagePrimary;let P;if(x.content){const ve=x.content,_e=x.pixelRatio||1;P=[ve[0]/_e,ve[1]/_e,x.displaySize[0]-ve[2]/_e,x.displaySize[1]-ve[3]/_e]}const I=s.left*v,R=s.right*v;let $,U,W,te;l==="width"||l==="both"?(te=p[0]+I-h[3],U=p[0]+R+h[1]):(te=p[0]+(I+R-x.displaySize[0])/2,U=te+x.displaySize[0]);const re=s.top*v,le=s.bottom*v;return l==="height"||l==="both"?($=p[1]+re-h[0],W=p[1]+le+h[2]):($=p[1]+(re+le-x.displaySize[1])/2,W=$+x.displaySize[1]),{imagePrimary:x,imageSecondary:void 0,top:$,right:U,bottom:W,left:te,collisionPadding:P}}function j3(c){return!c.imagePrimary.stretchX}function D3(c){return!c.imagePrimary.stretchY}function N3(c){return{width:c.right-c.left,height:c.bottom-c.top}}const Kh=128;function z3(c,s){const{expression:l}=s;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new ni(c+1))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:p}=l;let v=0;for(;v<h.length&&h[v]<=c;)v++;v=Math.max(0,v-1);let x=v;for(;x<h.length&&h[x]<c+1;)x++;x=Math.min(h.length-1,x);const P=h[v],I=h[x];return l.kind==="composite"?{kind:"composite",minZoom:P,maxZoom:I,interpolationType:p}:{kind:"camera",minZoom:P,maxZoom:I,minSize:l.evaluate(new ni(P)),maxSize:l.evaluate(new ni(I)),interpolationType:p}}}function ET(c,{uSize:s,uSizeT:l},{lowerSize:h,upperSize:p}){return c.kind==="source"?h/Kh:c.kind==="composite"?Br(h/Kh,p/Kh,l):s}function p0(c,s,l=1){let h=0,p=0;if(c.kind==="constant")p=c.layoutSize*l;else if(c.kind!=="source"){const{interpolationType:v,minZoom:x,maxZoom:P}=c,I=v?rt(Bs.interpolationFactor(v,s,x,P),0,1):0;c.kind==="camera"?p=Br(c.minSize,c.maxSize,I)*l:h=I*l}return{uSizeT:h,uSize:p}}class ip extends Qt{constructor(s,l,h,p,v){super(s,l),this.angle=p,this.z=h,v!==void 0&&(this.segment=v)}clone(){return new ip(this.x,this.y,this.z,this.angle,this.segment)}}function F3(c,s,l,h,p){if(s.segment===void 0)return!0;let v=s,x=s.segment+1,P=0;for(;P>-l/2;){if(x--,x<0)return!1;P-=c[x].dist(v),v=c[x]}P+=c[x].dist(c[x+1]),x++;const I=[];let R=0;for(;P<l/2;){const $=c[x],U=c[x+1];if(!U)return!1;let W=c[x-1].angleTo($)-$.angleTo(U);for(W=Math.abs((W+3*Math.PI)%(2*Math.PI)-Math.PI),I.push({distance:P,angleDelta:W}),R+=W;P-I[0].distance>h;)R-=I.shift().angleDelta;if(R>p)return!1;x++,P+=$.dist(U)}return!0}function B3(c){let s=0;for(let l=0;l<c.length-1;l++)s+=c[l].dist(c[l+1]);return s}function $3(c,s,l){return c?.6*s*l:0}function V3(c,s){return Math.max(c?c.right-c.left:0,s?s.right-s.left:0)}function kte(c,s,l,h,p,v){const x=$3(l,p,v),P=V3(l,h)*v;let I=0;const R=B3(c)/2;for(let $=0;$<c.length-1;$++){const U=c[$],W=c[$+1],te=U.dist(W);if(I+te>R){const re=(R-I)/te,le=Br(U.x,W.x,re),ve=Br(U.y,W.y,re),_e=new ip(le,ve,0,W.angleTo(U),$);return!x||F3(c,_e,P,x,s)?_e:void 0}I+=te}}function Ote(c,s,l,h,p,v,x,P,I){const R=$3(h,v,x),$=V3(h,p),U=$*x,W=c[0].x===0||c[0].x===I||c[0].y===0||c[0].y===I;return s-U<s/4&&(s=U+s/4),U3(c,W?s/2*P%s:($/2+2*v)*x*P%s,s,R,l,U,W,!1,I)}function U3(c,s,l,h,p,v,x,P,I){const R=v/2,$=B3(c);let U=0,W=s-l,te=[];for(let re=0;re<c.length-1;re++){const le=c[re],ve=c[re+1],_e=le.dist(ve),Ce=ve.angleTo(le);for(;W+l<U+_e;){W+=l;const Ee=(W-U)/_e,ue=Br(le.x,ve.x,Ee),we=Br(le.y,ve.y,Ee);if(ue>=0&&ue<I&&we>=0&&we<I&&W-R>=0&&W+R<=$){const Te=new ip(ue,we,0,Ce,re);h&&!F3(c,Te,v,h,p)||te.push(Te)}}U+=_e}return P||te.length||x||(te=U3(c,U/2,l,h,p,v,x,!0,I)),te}function q3(c){let s=0,l=0;for(const x of c)s+=x.w*x.h,l=Math.max(l,x.w);c.sort((x,P)=>P.h-x.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),l),h:1/0}];let p=0,v=0;for(const x of c)for(let P=h.length-1;P>=0;P--){const I=h[P];if(!(x.w>I.w||x.h>I.h)){if(x.x=I.x,x.y=I.y,v=Math.max(v,x.y+x.h),p=Math.max(p,x.x+x.w),x.w===I.w&&x.h===I.h){const R=h.pop();P<h.length&&(h[P]=R)}else x.h===I.h?(I.x+=x.w,I.w-=x.w):x.w===I.w?(I.y+=x.h,I.h-=x.h):(h.push({x:I.x+x.w,y:I.y,w:I.w-x.w,h:x.h}),I.y+=x.h,I.h-=x.h);break}}return{w:p,h:v,fill:s/(p*v)||0}}yr(ip,"Anchor");const Gg=1;class m0{static getImagePositionScale(s,l,h){if(l&&s&&s.options&&s.options.transform){const p=s.options.transform;return{x:p.a,y:p.d}}return{x:h,y:h}}constructor(s,l,h,p){this.paddedRect=s;const{pixelRatio:v,version:x,stretchX:P,stretchY:I,content:R,sdf:$,usvg:U}=l;this.pixelRatio=v,this.stretchX=P,this.stretchY=I,this.content=R,this.version=x,this.padding=h,this.sdf=$,this.scale=m0.getImagePositionScale(p,U,v)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function TT(c,s,l){const h=Qa.parse(c),p=function(v,x,P=[1,1]){return{x:0,y:0,w:(v.data?v.data.width:v.width*P[0])+2*x,h:(v.data?v.data.height:v.height*P[1])+2*x}}(s,l,[h.options.transform.a,h.options.transform.d]);return{bin:p,imagePosition:new m0(p,s,l,h),imageVariant:h}}class G3{constructor(s,l,h){const p=new Map,v=new Map;this.haveRenderCallbacks=[];const x=[];this.addImages(s,p,Gg,x),this.addImages(l,v,2,x);const{w:P,h:I}=q3(x),R=new kr({width:P||1,height:I||1});for(const[$,U]of s.entries()){const W=p.get($).paddedRect;kr.copy(U.data,R,{x:0,y:0},{x:W.x+Gg,y:W.y+Gg},U.data,h,U.sdf)}for(const[$,U]of l.entries()){const W=v.get($),te=W.paddedRect;let re=W.padding;const le=te.x+re,ve=te.y+re,_e=U.data.width,Ce=U.data.height;re=re>1?re-1:re,kr.copy(U.data,R,{x:0,y:0},{x:le,y:ve},U.data,h),kr.copy(U.data,R,{x:0,y:Ce-re},{x:le,y:ve-re},{width:_e,height:re},h),kr.copy(U.data,R,{x:0,y:0},{x:le,y:ve+Ce},{width:_e,height:re},h),kr.copy(U.data,R,{x:_e-re,y:0},{x:le-re,y:ve},{width:re,height:Ce},h),kr.copy(U.data,R,{x:0,y:0},{x:le+_e,y:ve},{width:re,height:Ce},h),kr.copy(U.data,R,{x:_e-re,y:Ce-re},{x:le-re,y:ve-re},{width:re,height:re},h),kr.copy(U.data,R,{x:0,y:Ce-re},{x:le+_e,y:ve-re},{width:re,height:re},h),kr.copy(U.data,R,{x:0,y:0},{x:le+_e,y:ve+Ce},{width:re,height:re},h),kr.copy(U.data,R,{x:_e-re,y:0},{x:le-re,y:ve+Ce},{width:re,height:re},h)}this.lut=h,this.image=R,this.iconPositions=p,this.patternPositions=v}addImages(s,l,h,p){for(const[v,x]of s.entries()){const{bin:P,imagePosition:I,imageVariant:R}=TT(v,x,h);l.set(v,I),p.push(P),x.hasRenderCallback&&this.haveRenderCallbacks.push(R.id)}}patchUpdatedImages(s,l,h){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(p=>s.hasImage(p,h)),s.dispatchRenderCallbacks(this.haveRenderCallbacks,h);for(const p of s.getUpdatedImages(h)){for(const v of this.iconPositions.keys()){const x=Qa.parse(v);if(la.isEqual(x.id,p)){const P=s.getImage(p,h);this.patchUpdatedImage(this.iconPositions.get(v),P,l)}}for(const v of this.patternPositions.keys()){const x=Qa.parse(v);if(la.isEqual(x.id,p)){const P=s.getImage(p,h);this.patchUpdatedImage(this.patternPositions.get(v),P,l)}}}}patchUpdatedImage(s,l,h){if(!s||!l||s.version===l.version)return;s.version=l.version;const[p,v]=s.tl,x=s.sdf;if(this.lut||x){const P={width:l.data.width,height:l.data.height},I=new kr(P);kr.copy(l.data,I,{x:0,y:0},{x:0,y:0},P,this.lut,x),h.update(I,{position:{x:p,y:v}})}else h.update(l.data,{position:{x:p,y:v}})}}yr(m0,"ImagePosition"),yr(G3,"ImageAtlas");const x1=1e20;function H3(c,s,l,h,p,v,x,P,I){for(let R=s;R<s+h;R++)W3(c,l*v+R,v,p,x,P,I);for(let R=l;R<l+p;R++)W3(c,R*v+s,1,h,x,P,I)}function W3(c,s,l,h,p,v,x){v[0]=0,x[0]=-1e20,x[1]=x1,p[0]=c[s];for(let P=1,I=0,R=0;P<h;P++){p[P]=c[s+P*l];const $=P*P;do{const U=v[I];R=(p[P]-p[U]+$-U*U)/(P-U)/2}while(R<=x[I]&&--I>-1);I++,v[I]=P,x[I]=R,x[I+1]=x1}for(let P=0,I=0;P<h;P++){for(;x[I+1]<P;)I++;const R=v[I],$=P-R;c[s+P*l]=p[R]+$*$}}const zd=2,CT={none:0,ideographs:1,all:2};class ev{constructor(s,l,h){this.requestManager=s,this.localGlyphMode=l,this.localFontFamily=h,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(s,l){this.urls[l]=s}getGlyphs(s,l,h){const p=[],v=this.urls[l]||cs.GLYPHS_URL;for(const x in s)for(const P of s[x])p.push({stack:x,id:P});Ct(p,({stack:x,id:P},I)=>{let R=this.entries[x];R||(R=this.entries[x]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let $=R.glyphs[P];if($!==void 0)return void I(null,{stack:x,id:P,glyph:$});if($=this._tinySDF(R,x,P),$)return R.glyphs[P]=$,void I(null,{stack:x,id:P,glyph:$});const U=Math.floor(P/256);if(256*U>65535)return sn("glyphs > 65535 not supported"),void I(null,{stack:x,id:P,glyph:$});if(R.ranges[U])return void I(null,{stack:x,id:P,glyph:$});let W=R.requests[U];W||(W=R.requests[U]=[],ev.loadGlyphRange(x,U,v,this.requestManager,(te,re)=>{if(re){R.ascender=re.ascender,R.descender=re.descender;for(const le in re.glyphs)this._doesCharSupportLocalGlyph(+le)||(R.glyphs[+le]=re.glyphs[+le]);R.ranges[U]=!0}for(const le of W)le(te,re);delete R.requests[U]})),W.push((te,re)=>{te?I(te):re&&I(null,{stack:x,id:P,glyph:re.glyphs[P]||null})})},(x,P)=>{if(x)h(x);else if(P){const I={};for(const{stack:R,id:$,glyph:U}of P)I[R]===void 0&&(I[R]={}),I[R].glyphs===void 0&&(I[R].glyphs={}),I[R].glyphs[$]=U&&{id:U.id,bitmap:U.bitmap.clone(),metrics:U.metrics},I[R].ascender=this.entries[R].ascender,I[R].descender=this.entries[R].descender;h(null,I)}})}_doesCharSupportLocalGlyph(s){return this.localGlyphMode!==CT.none&&(this.localGlyphMode===CT.all?!!this.localFontFamily:!!this.localFontFamily&&(zr["CJK Unified Ideographs"](s)||zr["Hangul Syllables"](s)||zr.Hiragana(s)||zr.Katakana(s)||zr["CJK Symbols and Punctuation"](s)||zr["CJK Unified Ideographs Extension A"](s)||zr["CJK Unified Ideographs Extension B"](s)||zr.Osage(s)))}_tinySDF(s,l,h){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(h))return;let v=s.tinySDF;if(!v){let le="400";/bold/i.test(l)?le="900":/medium/i.test(l)?le="500":/light/i.test(l)&&(le="200"),v=s.tinySDF=new ev.TinySDF({fontFamily:p,fontWeight:le,fontSize:24*zd,buffer:3*zd,radius:8*zd}),v.fontWeight=le}if(this.localGlyphs[v.fontWeight][h])return this.localGlyphs[v.fontWeight][h];const x=String.fromCodePoint(h),{data:P,width:I,height:R,glyphWidth:$,glyphHeight:U,glyphLeft:W,glyphTop:te,glyphAdvance:re}=v.draw(x);return this.localGlyphs[v.fontWeight][h]={id:h,bitmap:new Gt({width:I,height:R},P),metrics:{width:$/zd,height:U/zd,left:W/zd,top:te/zd-27,advance:re/zd,localGlyph:!0}}}}ev.loadGlyphRange=function(c,s,l,h,p){const v=256*s,x=v+255,P=h.transformRequest(h.normalizeGlyphsURL(l).replace("{fontstack}",c).replace("{range}",`${v}-${x}`),hu.Glyphs);ql(P,(I,R)=>{if(I)p(I);else if(R){const $={},U=function(W){return new v1(W).readFields(Ete,{})}(R);for(const W of U.glyphs)$[W.id]=W;p(null,{glyphs:$,ascender:U.ascender,descender:U.descender})}})},ev.TinySDF=class{constructor({fontSize:c=24,buffer:s=3,radius:l=8,cutoff:h=.25,fontFamily:p="sans-serif",fontWeight:v="normal",fontStyle:x="normal"}={}){this.buffer=s,this.cutoff=h,this.radius=l;const P=this.size=c+4*s,I=this._createCanvas(P),R=this.ctx=I.getContext("2d",{willReadFrequently:!0});R.font=`${x} ${v} ${c}px ${p}`,R.textBaseline="alphabetic",R.textAlign="left",R.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Uint16Array(P)}_createCanvas(c){const s=document.createElement("canvas");return s.width=s.height=c,s}draw(c){const{width:s,actualBoundingBoxAscent:l,actualBoundingBoxDescent:h,actualBoundingBoxLeft:p,actualBoundingBoxRight:v}=this.ctx.measureText(c),x=Math.ceil(l),P=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(v-p))),I=Math.min(this.size-this.buffer,x+Math.ceil(h)),R=P+2*this.buffer,$=I+2*this.buffer,U=Math.max(R*$,0),W=new Uint8ClampedArray(U),te={data:W,width:R,height:$,glyphWidth:P,glyphHeight:I,glyphTop:x,glyphLeft:0,glyphAdvance:s};if(P===0||I===0)return te;const{ctx:re,buffer:le,gridInner:ve,gridOuter:_e}=this;re.clearRect(le,le,P,I),re.fillText(c,le,le+x);const Ce=re.getImageData(le,le,P,I);_e.fill(x1,0,U),ve.fill(0,0,U);for(let Ee=0;Ee<I;Ee++)for(let ue=0;ue<P;ue++){const we=Ce.data[4*(Ee*P+ue)+3]/255;if(we===0)continue;const Te=(Ee+le)*R+ue+le;if(we===1)_e[Te]=0,ve[Te]=x1;else{const Ie=.5-we;_e[Te]=Ie>0?Ie*Ie:0,ve[Te]=Ie<0?Ie*Ie:0}}H3(_e,0,0,R,$,R,this.f,this.v,this.z),H3(ve,le,le,P,I,R,this.f,this.v,this.z);for(let Ee=0;Ee<U;Ee++){const ue=Math.sqrt(_e[Ee])-Math.sqrt(ve[Ee]);W[Ee]=Math.round(255-255*(ue/this.radius+this.cutoff))}return te}};const Hg=Gg;function Z3(c,s){return c+s[1]-s[0]}function X3(c,s,l,h,p=1){const v=[],x=c.imagePrimary,P=x.pixelRatio,I=x.paddedRect.w-2*Hg,R=x.paddedRect.h-2*Hg,$=(c.right-c.left)*p,U=(c.bottom-c.top)*p,W=x.stretchX||[[0,I]],te=x.stretchY||[[0,R]],re=W.reduce(Z3,0),le=te.reduce(Z3,0),ve=I-re,_e=R-le;let Ce=0,Ee=re,ue=0,we=le,Te=0,Ie=ve,Ge=0,Qe=_e;if(x.content&&h){const ct=x.content;Ce=b1(W,0,ct[0]),ue=b1(te,0,ct[1]),Ee=b1(W,ct[0],ct[2]),we=b1(te,ct[1],ct[3]),Te=ct[0]-Ce,Ge=ct[1]-ue,Ie=ct[2]-ct[0]-Ee,Qe=ct[3]-ct[1]-we}const it=(ct,St,Vt,Nt)=>{const Bt=w1(ct.stretch-Ce,Ee,$,c.left*p),Xt=S1(ct.fixed-Te,Ie,ct.stretch,re),xt=w1(St.stretch-ue,we,U,c.top*p),Ft=S1(St.fixed-Ge,Qe,St.stretch,le),_t=w1(Vt.stretch-Ce,Ee,$,c.left*p),wt=S1(Vt.fixed-Te,Ie,Vt.stretch,re),Yt=w1(Nt.stretch-ue,we,U,c.top*p),tr=S1(Nt.fixed-Ge,Qe,Nt.stretch,le),Or=new Qt(Bt,xt),Tr=new Qt(_t,xt),hr=new Qt(_t,Yt),Kt=new Qt(Bt,Yt),tn=new Qt(Xt/P,Ft/P),Pr=new Qt(wt/P,tr/P),Mr=s*Math.PI/180;if(Mr){const yn=Math.sin(Mr),gi=Math.cos(Mr),Ii=[gi,-yn,yn,gi];Or._matMult(Ii),Tr._matMult(Ii),Kt._matMult(Ii),hr._matMult(Ii)}const Kr=ct.stretch+ct.fixed,dn=Vt.stretch+Vt.fixed,mn=St.stretch+St.fixed,An=Nt.stretch+Nt.fixed,bn=c.imageSecondary;return{tl:Or,tr:Tr,bl:Kt,br:hr,texPrimary:{x:x.paddedRect.x+Hg+Kr,y:x.paddedRect.y+Hg+mn,w:dn-Kr,h:An-mn},texSecondary:bn?{x:bn.paddedRect.x+Hg+Kr,y:bn.paddedRect.y+Hg+mn,w:dn-Kr,h:An-mn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:tn,pixelOffsetBR:Pr,minFontScaleX:Ie/P/$,minFontScaleY:Qe/P/U,isSDF:l}};if(h&&(x.stretchX||x.stretchY)){const ct=K3(W,ve,re),St=K3(te,_e,le);for(let Vt=0;Vt<ct.length-1;Vt++){const Nt=ct[Vt],Bt=ct[Vt+1];for(let Xt=0;Xt<St.length-1;Xt++)v.push(it(Nt,St[Xt],Bt,St[Xt+1]))}}else v.push(it({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:R+1}));return v}function b1(c,s,l){let h=0;for(const p of c)h+=Math.max(s,Math.min(l,p[1]))-Math.max(s,Math.min(l,p[0]));return h}function K3(c,s,l){const h=[{fixed:-1,stretch:0}];for(const[p,v]of c){const x=h[h.length-1];h.push({fixed:p-x.stretch,stretch:x.stretch}),h.push({fixed:p-x.stretch,stretch:x.stretch+(v-p)})}return h.push({fixed:s+Hg,stretch:l}),h}function w1(c,s,l,h){return c/s*l+h}function S1(c,s,l,h){return c-s*l/h}function Lte(c,s,l,h){const p=s+c.positionedLines[h].lineOffset;return h===0?l+p/2:l+(p+(s+c.positionedLines[h-1].lineOffset))/2}function Rte(c,s=1,l=!1){let h=1/0,p=1/0,v=-1/0,x=-1/0;const P=c[0];for(let te=0;te<P.length;te++){const re=P[te];(!te||re.x<h)&&(h=re.x),(!te||re.y<p)&&(p=re.y),(!te||re.x>v)&&(v=re.x),(!te||re.y>x)&&(x=re.y)}const I=Math.min(v-h,x-p);let R=I/2;const $=new Af([],jte);if(I===0)return new Qt(h,p);for(let te=h;te<v;te+=I)for(let re=p;re<x;re+=I)$.push(new tv(te+R,re+R,R,c));let U=function(te){let re=0,le=0,ve=0;const _e=te[0];for(let Ce=0,Ee=_e.length,ue=Ee-1;Ce<Ee;ue=Ce++){const we=_e[Ce],Te=_e[ue],Ie=we.x*Te.y-Te.x*we.y;le+=(we.x+Te.x)*Ie,ve+=(we.y+Te.y)*Ie,re+=3*Ie}return new tv(le/re,ve/re,0,te)}(c),W=$.length;for(;$.length;){const te=$.pop();(te.d>U.d||!U.d)&&(U=te,l&&console.log("found best %d after %d probes",Math.round(1e4*te.d)/1e4,W)),te.max-U.d<=s||(R=te.h/2,$.push(new tv(te.p.x-R,te.p.y-R,R,c)),$.push(new tv(te.p.x+R,te.p.y-R,R,c)),$.push(new tv(te.p.x-R,te.p.y+R,R,c)),$.push(new tv(te.p.x+R,te.p.y+R,R,c)),W+=4)}return l&&(console.log(`num probes: ${W}`),console.log(`best distance: ${U.d}`)),U.p}function jte(c,s){return s.max-c.max}class tv{constructor(s,l,h,p){this.p=new Qt(s,l),this.h=h,this.d=function(v,x){let P=!1,I=1/0;for(let R=0;R<x.length;R++){const $=x[R];for(let U=0,W=$.length,te=W-1;U<W;te=U++){const re=$[U],le=$[te];re.y>v.y!=le.y>v.y&&v.x<(le.x-re.x)*(v.y-re.y)/(le.y-re.y)+re.x&&(P=!P),I=Math.min(I,kn(v,re,le))}}return(P?1:-1)*Math.sqrt(I)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const Dte=Object.keys,AT=Number.POSITIVE_INFINITY,Nte=Math.sqrt(2);function Y3(c,[s,l]){let h=0,p=0;if(l===AT){s<0&&(s=0);const v=s/Nte;switch(c){case"top-right":case"top-left":p=v-7;break;case"bottom-right":case"bottom-left":p=7-v;break;case"bottom":p=7-s;break;case"top":p=s-7}switch(c){case"top-right":case"bottom-right":h=-v;break;case"top-left":case"bottom-left":h=v;break;case"left":h=s;break;case"right":h=-s}}else{switch(s=Math.abs(s),l=Math.abs(l),c){case"top-right":case"top-left":case"top":p=l-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-l}switch(c){case"top-right":case"bottom-right":case"right":h=-s;break;case"top-left":case"bottom-left":case"left":h=s}}return[h,p]}function E1(c,s,l,h,p,v,x,P,I){if(!s||!s.usvg)return;const R=N3(h),$=N3(p),U=v!=="both"&&v!=="width"||!j3(h)?1:Math.max(1,$.width/R.width),W=v!=="both"&&v!=="height"||!D3(h)?1:Math.max(1,$.height/R.height);l.scaleSelf(U,W);const te=l.toString();x.set(te,l),P.set(te,s);const{imagePosition:re}=TT(te,s,Gg);I.set(te,re)}function J3(c,s,l,h,p,v,x,P){if(!c)return;const I=function(R,$,U,W,te){if(R.kind==="camera")return R.maxSize;if(R.kind==="composite"){const re=$.possiblyEvaluate(new ni(R.maxZoom),U).evaluate(te,{},U),le=$.possiblyEvaluate(new ni(R.minZoom),U).evaluate(te,{},U);return Math.max(re,le)}return $.possiblyEvaluate(new ni(W)).evaluate(te,{},U)}(s,l,h,p,v);return c.scaleSelf(I*P*x)}function Q3(c,s,l,h,p,v,x,P){return{iconPrimary:J3(c.getPrimary(),s,l,h,p,v,x,P),iconSecondary:J3(c.getSecondary(),s,l,h,p,v,x,P)}}function ez(c,s,l,h){if(!c)return;const p=s.get(l.toString());if(c.imagePrimary=p,h){const v=s.get(h.toString());c.imageSecondary=v}}function zte(c,s){for(const l in c.horizontal)tz(c.horizontal[l],s);tz(c.vertical,s)}function tz(c,s){if(c){for(const l of c.positionedLines)for(const h of l.positionedGlyphs)if(h.image!==null){const p=h.image.toString();h.rect=s.get(p).paddedRect}}}function PT(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Fte(c,s,l,h,p,v,x,P,I){const R=MT(v.horizontal)||v.vertical,$=l.get("icon-text-fit-padding").evaluate(h,{},p);let U,W=s;return s&&I!=="none"&&(c.allowVerticalPlacement&&v.vertical&&(U=R3(s,v.vertical,I,$,P,x)),R&&(W=R3(s,R,I,$,P,x))),{defaultShapedIcon:W,verticallyShapedIcon:U}}function Bte(c,s,l,h,p,v,x,P,I,R,$,U,W,te,re,le,ve,_e,Ce,Ee){let ue=x.textMaxSize.evaluate(s,{},W);ue===void 0?ue=P*x.textScaleFactor:ue*=x.textScaleFactor;const we=c.layers[0].layout,Te=MT(l.horizontal)||l.vertical,Ie=te.name==="globe",Ge=Co,Qe=c.tilePixelRatio*ue/Ge,it=(Xt=c.overscaling,c.zoom>18&&Xt>2&&(Xt>>=1),Math.max(or/(512*Xt),1)*we.get("symbol-spacing")),ct=we.get("text-padding")*c.tilePixelRatio,St=we.get("icon-padding")*c.tilePixelRatio,Vt=ae(we.get("text-max-angle")),Nt=we.get("icon-rotation-alignment")==="map"&&Ee!=="point",Bt=it/2;var Xt;c.hasAnyIconTextFit===!1&&ve!=="none"&&(c.hasAnyIconTextFit=!0);const xt=s.properties?+s.properties[$g]:null,Ft=xt&&c.elevationFeatureIdToIndex?c.elevationFeatureIdToIndex.get(xt):65535,_t=(wt,Yt,tr)=>{if(Yt.x<0||Yt.x>=or||Yt.y<0||Yt.y>=or)return;let Or=null;if(Ie){const{x:Tr,y:hr,z:Kt}=te.projectTilePoint(Yt.x,Yt.y,tr);Or={anchor:new ip(Tr,hr,Kt,0,void 0),up:te.upVector(tr,Yt.x,Yt.y)}}(function(Tr,hr,Kt,tn,Pr,Mr,Kr,dn,mn,An,bn,yn,gi,Ii,Me,Oe,Pt,ir,pr,fr,Ir,Wr,Ln,Rn,vn,ui,Ei,jn,Yi){const ki=Tr.addToLineVertexArray(hr,tn);let ai,hs,Ni,Ti,Oi,fi,Sn,mi=0,Ji=0,Gr=0,Hn=0,zi=-1,as=-1;const Fi={};let Us=ko("");const yi=Kt?Kt.anchor:hr,Ns=jn!=="none";let fl=0,ta=0;if(mn._unevaluatedLayout.getValue("text-radial-offset")===void 0){const qs=mn.layout.get("text-offset").evaluate(Ir,{},vn);fl=qs[0]*Co,ta=qs[1]*Co}else fl=mn.layout.get("text-radial-offset").evaluate(Ir,{},vn)*Co,ta=AT;if(Tr.allowVerticalPlacement&&Pr.vertical){const qs=Pr.vertical;if(Me)fi=IT(qs),dn&&(Sn=IT(dn));else{const lo=mn.layout.get("text-rotate").evaluate(Ir,{},vn)+90;Ni=T1(An,yi,hr,bn,yn,gi,qs,Ii,lo,Oe),dn&&(Ti=T1(An,yi,hr,bn,yn,gi,dn,ir,lo))}}if(Mr){const qs=Tr.iconSizeData,lo=mn.layout.get("icon-rotate").evaluate(Ir,{},vn),ra=X3(Mr,lo,Ln,Ns,Wr.iconScaleFactor),Ca=dn?X3(dn,lo,Ln,Ns,Wr.iconScaleFactor):void 0;hs=T1(An,yi,hr,bn,yn,gi,Mr,ir,lo,null),mi=4*ra.length;let ga=null;qs.kind==="source"?(ga=[Kh*mn.layout.get("icon-size").evaluate(Ir,{},vn)*Wr.iconScaleFactor],ga[0]>xm&&sn(`${Tr.layerIds[0]}: Value for "icon-size" is >= ${g0}. Reduce your "icon-size".`)):qs.kind==="composite"&&(ga=[Kh*Wr.compositeIconSizes[0].evaluate(Ir,{},vn)*Wr.iconScaleFactor,Kh*Wr.compositeIconSizes[1].evaluate(Ir,{},vn)*Wr.iconScaleFactor],(ga[0]>xm||ga[1]>xm)&&sn(`${Tr.layerIds[0]}: Value for "icon-size" is >= ${g0}. Reduce your "icon-size".`)),Tr.addSymbols(Tr.icon,ra,ga,fr,pr,Ir,void 0,Kt,hr,ki.lineStartIndex,ki.lineLength,-1,Rn,vn,ui,Ei),zi=Tr.icon.placedSymbolArray.length-1,Ca&&(Ji=4*Ca.length,Tr.addSymbols(Tr.icon,Ca,ga,fr,pr,Ir,Dl.vertical,Kt,hr,ki.lineStartIndex,ki.lineLength,-1,Rn,vn,ui,Ei),as=Tr.icon.placedSymbolArray.length-1)}for(const qs in Pr.horizontal){const lo=qs,ra=Pr.horizontal[lo];ai||(Us=ko(ra.text),Me?Oi=IT(ra):ai=T1(An,yi,hr,bn,yn,gi,ra,Ii,mn.layout.get("text-rotate").evaluate(Ir,{},vn),Oe));const Ca=ra.positionedLines.length===1;if(Gr+=rz(Tr,Kt,hr,ra,Kr,mn,Me,Ir,Oe,ki,Pr.vertical?Dl.horizontal:Dl.horizontalOnly,Ca?Dte(Pr.horizontal):[lo],Fi,zi,Wr,Rn,vn,ui),Ca)break}Pr.vertical&&(Hn+=rz(Tr,Kt,hr,Pr.vertical,Kr,mn,Me,Ir,Oe,ki,Dl.vertical,["vertical"],Fi,as,Wr,Rn,vn,ui));let No=-1;const pl=(qs,lo)=>qs?Math.max(qs,lo):lo;No=pl(Oi,No),No=pl(fi,No),No=pl(Sn,No);const Yh=No>-1?1:0;Tr.glyphOffsetArray.length>=65535&&sn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ir.sortKey!==void 0&&Tr.addToSortKeyRanges(Tr.symbolInstances.length,Ir.sortKey),Tr.symbolInstances.emplaceBack(hr.x,hr.y,yi.x,yi.y,yi.z,Fi.right>=0?Fi.right:-1,Fi.center>=0?Fi.center:-1,Fi.left>=0?Fi.left:-1,Fi.vertical>=0?Fi.vertical:-1,zi,as,Us,ai!==void 0?ai:Tr.collisionBoxArray.length,ai!==void 0?ai+1:Tr.collisionBoxArray.length,Ni!==void 0?Ni:Tr.collisionBoxArray.length,Ni!==void 0?Ni+1:Tr.collisionBoxArray.length,hs!==void 0?hs:Tr.collisionBoxArray.length,hs!==void 0?hs+1:Tr.collisionBoxArray.length,Ti||Tr.collisionBoxArray.length,Ti?Ti+1:Tr.collisionBoxArray.length,bn,Gr,Hn,mi,Ji,Yh,0,fl,ta,No,0,Ns?1:0,Yi)})(c,Yt,Or,wt,l,h,v,p,c.layers[0],c.collisionBoxArray,s.index,s.sourceLayerIndex,c.index,ct,Ce,R,0,St,Nt,_e,s,x,$,U,W,re,le,ve,Ft)};if(Ee==="line")for(const wt of y1(s.geometry,0,0,or,or)){const Yt=Ote(wt,it,Vt,l.vertical||Te,h,Ge,Qe,c.overscaling,or);for(const tr of Yt)Te&&$te(c,Te.text,Bt,tr)||_t(wt,tr,W)}else if(Ee==="line-center"){for(const wt of s.geometry)if(wt.length>1){const Yt=kte(wt,Vt,l.vertical||Te,h,Ge,Qe);Yt&&_t(wt,Yt,W)}}else if(s.type==="Polygon")for(const wt of u1(s.geometry,0)){const Yt=Rte(wt,16);_t(wt[0],new ip(Yt.x,Yt.y,0,0,void 0),W)}else if(s.type==="LineString")for(const wt of s.geometry)_t(wt,new ip(wt[0].x,wt[0].y,0,0,void 0),W);else if(s.type==="Point")for(const wt of s.geometry)for(const Yt of wt)_t([Yt],new ip(Yt.x,Yt.y,0,0,void 0),W)}const g0=255,xm=g0*Kh;function rz(c,s,l,h,p,v,x,P,I,R,$,U,W,te,re,le,ve,_e){const Ce=function(we,Te,Ie,Ge,Qe,it,ct,St){const Vt=[];if(Te.positionedLines.length===0)return Vt;const Nt=Ge.layout.get("text-rotate").evaluate(it,{})*Math.PI/180,Bt=function(wt){const Yt=wt[0],tr=wt[1],Or=Yt*tr;return Or>0?[Yt,-tr]:Or<0?[-Yt,tr]:Yt===0?[tr,Yt]:[tr,-Yt]}(Ie);let Xt=Math.abs(Te.top-Te.bottom);for(const wt of Te.positionedLines)Xt-=wt.lineOffset;const xt=Te.positionedLines.length,Ft=Xt/xt;let _t=Te.top-Ie[1];for(let wt=0;wt<xt;++wt){const Yt=Te.positionedLines[wt];_t=Lte(Te,Ft,_t,wt);for(const tr of Yt.positionedGlyphs){if(!tr.rect)continue;const Or=tr.rect||{};let Tr=Ate+1,hr=!0,Kt=1,tn=0;if(tr.image){const Ir=ct.get(tr.image.toString());if(!Ir)continue;if(Ir.sdf){sn("SDF images are not supported in formatted text and will be ignored.");continue}hr=!1,Kt=Ir.pixelRatio,Tr=Gg/Kt}const Pr=(Qe||St)&&tr.vertical,Mr=tr.metrics.advance*tr.scale/2,Kr=tr.metrics,dn=tr.rect;if(dn===null)continue;St&&Te.verticalizable&&(tn=tr.image?Mr-tr.metrics.width*tr.scale/2:0);const mn=Qe?[tr.x+Mr,tr.y]:[0,0];let An=[0,0],bn=[0,0],yn=!1;Qe||(Pr?(bn=[tr.x+Mr+Bt[0],tr.y+Bt[1]-tn],yn=!0):An=[tr.x+Mr+Ie[0],tr.y+Ie[1]-tn]);const gi=dn.w*tr.scale/(Kt*(tr.localGlyph?zd:1)),Ii=dn.h*tr.scale/(Kt*(tr.localGlyph?zd:1));let Me,Oe,Pt,ir;if(Pr){const Ir=tr.y-_t,Wr=new Qt(-Mr,Mr-Ir),Ln=-Math.PI/2,Rn=new Qt(...bn);Me=new Qt(-Mr+An[0],An[1]),Me._rotateAround(Ln,Wr)._add(Rn),Me.x+=-Ir+Mr,Me.y-=(Kr.left-Tr)*tr.scale;const vn=tr.image?Kr.advance*tr.scale:Co*tr.scale,ui=String.fromCodePoint(tr.glyph);bte(ui)?Me.x+=(1-Tr)*tr.scale:wte(ui)?Me.x+=vn-Kr.height*tr.scale+(-Tr-1)*tr.scale:Me.x+=tr.image||Kr.width+2*Tr===dn.w&&Kr.height+2*Tr===dn.h?(vn-Ii)/2:(vn-(Kr.height+2*Tr)*tr.scale)/2,Oe=new Qt(Me.x,Me.y-gi),Pt=new Qt(Me.x+Ii,Me.y),ir=new Qt(Me.x+Ii,Me.y-gi)}else{const Ir=(Kr.left-Tr)*tr.scale-Mr+An[0],Wr=(-Kr.top-Tr)*tr.scale+An[1],Ln=Ir+gi,Rn=Wr+Ii;Me=new Qt(Ir,Wr),Oe=new Qt(Ln,Wr),Pt=new Qt(Ir,Rn),ir=new Qt(Ln,Rn)}if(Nt){let Ir;Ir=Qe?new Qt(0,0):yn?new Qt(Bt[0],Bt[1]):new Qt(Ie[0],Ie[1]),Me._rotateAround(Nt,Ir),Oe._rotateAround(Nt,Ir),Pt._rotateAround(Nt,Ir),ir._rotateAround(Nt,Ir)}const pr=new Qt(0,0),fr=new Qt(0,0);Vt.push({tl:Me,tr:Oe,bl:Pt,br:ir,texPrimary:Or,texSecondary:void 0,writingMode:Te.writingMode,glyphOffset:mn,sectionIndex:tr.sectionIndex,isSDF:hr,pixelOffsetTL:pr,pixelOffsetBR:fr,minFontScaleX:0,minFontScaleY:0})}}return Vt}(0,h,I,v,x,P,p,c.allowVerticalPlacement),Ee=c.textSizeData;let ue=null;Ee.kind==="source"?(ue=[Kh*v.layout.get("text-size").evaluate(P,{},ve)*re.textScaleFactor],ue[0]>xm&&sn(`${c.layerIds[0]}: Value for "text-size" is >= ${g0}. Reduce your "text-size".`)):Ee.kind==="composite"&&(ue=[Kh*re.compositeTextSizes[0].evaluate(P,{},ve)*re.textScaleFactor,Kh*re.compositeTextSizes[1].evaluate(P,{},ve)*re.textScaleFactor],(ue[0]>xm||ue[1]>xm)&&sn(`${c.layerIds[0]}: Value for "text-size" is >= ${g0}. Reduce your "text-size".`)),c.addSymbols(c.text,Ce,ue,I,x,P,$,s,l,R.lineStartIndex,R.lineLength,te,le,ve,_e,!1);for(const we of U)W[we]=c.text.placedSymbolArray.length-1;return 4*Ce.length}function MT(c){for(const s in c)return c[s];return null}function T1(c,s,l,h,p,v,x,P,I,R){let $=x.top,U=x.bottom,W=x.left,te=x.right;if(L3(x)&&x.collisionPadding){const re=x.collisionPadding;W-=re[0],$-=re[1],te+=re[2],U+=re[3]}if(I){const re=new Qt(W,$),le=new Qt(te,$),ve=new Qt(W,U),_e=new Qt(te,U),Ce=ae(I);let Ee=new Qt(0,0);R&&(Ee=new Qt(R[0],R[1])),re._rotateAround(Ce,Ee),le._rotateAround(Ce,Ee),ve._rotateAround(Ce,Ee),_e._rotateAround(Ce,Ee),W=Math.min(re.x,le.x,ve.x,_e.x),te=Math.max(re.x,le.x,ve.x,_e.x),$=Math.min(re.y,le.y,ve.y,_e.y),U=Math.max(re.y,le.y,ve.y,_e.y)}return c.emplaceBack(s.x,s.y,s.z,l.x,l.y,W,$,te,U,P,h,p,v),c.length-1}function IT(c){L3(c)&&c.collisionPadding&&(c.top-=c.collisionPadding[1],c.bottom+=c.collisionPadding[3]);const s=c.bottom-c.top;return s>0?Math.max(10,s):null}function $te(c,s,l,h){const p=c.compareText;if(s in p){const v=p[s];for(let x=v.length-1;x>=0;x--)if(h.dist(v[x])<l)return!0}else p[s]=[];return p[s].push(h),!1}function nz(c,s){const l=c.fovAboveCenter,h=c.elevation?c.elevation.getMinElevationBelowMSL()*s:0,p=(c._camera.position[2]*c.worldSize-h)/Math.cos(c._pitch),v=Math.sin(l)*p/Math.sin(Math.max(Math.PI/2-c._pitch-l,.01));let x=Math.sin(c._pitch)*v+p;const P=p*(1/c._horizonShift);if(!c.elevation||c.elevation.exaggeration()===0){let I=Math.max(c.zoom-17,0);c.isOrthographic&&(I/=10),x*=1+I}return Math.min(1.01*x,P)}function y0(c,s){if(!s.isReprojectedInTileSpace)return{scale:1<<c.z,x:c.x,y:c.y,x2:c.x+1,y2:c.y+1,projection:s};const l=Math.pow(2,-c.z),h=c.x*l,p=(c.x+1)*l,v=c.y*l,x=(c.y+1)*l,P=qe(h),I=qe(p),R=Ze(v),$=Ze(x),U=s.project(P,R),W=s.project(I,R),te=s.project(I,$),re=s.project(P,$);let le=Math.min(U.x,W.x,te.x,re.x),ve=Math.min(U.y,W.y,te.y,re.y),_e=Math.max(U.x,W.x,te.x,re.x),Ce=Math.max(U.y,W.y,te.y,re.y);const Ee=l/16;function ue(Te,Ie,Ge,Qe,it,ct){const St=(Ge+it)/2,Vt=(Qe+ct)/2,Nt=s.project(qe(St),Ze(Vt)),Bt=Math.max(0,le-Nt.x,ve-Nt.y,Nt.x-_e,Nt.y-Ce);le=Math.min(le,Nt.x),_e=Math.max(_e,Nt.x),ve=Math.min(ve,Nt.y),Ce=Math.max(Ce,Nt.y),Bt>Ee&&(ue(Te,Nt,Ge,Qe,St,Vt),ue(Nt,Ie,St,Vt,it,ct))}ue(U,W,h,v,p,v),ue(W,te,p,v,p,x),ue(te,re,p,x,h,x),ue(re,U,h,x,h,v),le-=Ee,ve-=Ee,_e+=Ee,Ce+=Ee;const we=1/Math.max(_e-le,Ce-ve);return{scale:we,x:le*we,y:ve*we,x2:_e*we,y2:Ce*we,projection:s}}function iz(c,{x:s,y:l},h=0){return new Qt(((s-h)*c.scale-c.x)*or,(l*c.scale-c.y)*or)}const Vte=O(new Float32Array(16));class bm{constructor(s){this.spec=s,this.name=s.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(s,l){return{x:0,y:0,z:0}}unproject(s,l){return new he(0,0)}projectTilePoint(s,l,h){return{x:s,y:l,z:0}}locationPoint(s,l,h,p=!0){return s._coordinatePoint(s.locationCoordinate(l,h),p)}pixelsPerMeter(s,l){return ke(1,s)*l}pixelSpaceConversion(s,l,h){return 1}farthestPixelDistance(s){return nz(s,s.pixelsPerMeter)}pointCoordinate(s,l,h,p){const v=s.horizonLineFromTop(!1),x=new Qt(l,Math.max(v,h));return s.rayIntersectionCoordinate(s.pointRayIntersection(x,p))}pointCoordinate3D(s,l,h){const p=new Qt(l,h);if(s.elevation)return s.elevation.pointCoordinate(p);{const v=this.pointCoordinate(s,p.x,p.y,0);return[v.x,v.y,v.z]}}isPointAboveHorizon(s,l){if(s.elevation&&s.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(s,l.x,l.y);const h=s.horizonLineFromTop();return l.y<h}createInversionMatrix(s,l){return Vte}createTileMatrix(s,l,h){let p,v,x;const P=h.canonical,I=O(new Float64Array(16));if(this.isReprojectedInTileSpace){const R=y0(P,this);p=1,v=R.x+h.wrap*R.scale,x=R.y,Z(I,I,[p/R.scale,p/R.scale,s.pixelsPerMeter/l])}else p=l/s.zoomScale(P.z),v=(P.x+Math.pow(2,P.z)*h.wrap)*p,x=P.y*p;return H(I,I,[v,x,0]),Z(I,I,[p/or,p/or,1]),I}upVector(s,l,h){return[0,0,1]}upVectorScale(s,l,h){return{metersToTile:1}}}class Ute extends bm{constructor(s){super(s),this.range=[4,7],this.center=s.center||[-96,37.5];const[l,h]=this.parallels=s.parallels||[29.5,45.5],p=Math.sin(ae(l));this.n=(p+Math.sin(ae(h)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(s,l){const{n:h,c:p,r0:v}=this,x=ae(s-this.center[0]),P=ae(l),I=Math.sqrt(p-2*h*Math.sin(P))/h;return{x:I*Math.sin(x*h),y:I*Math.cos(x*h)-v,z:0}}unproject(s,l){const{n:h,c:p,r0:v}=this,x=v+l;let P=Math.atan2(s,Math.abs(x))*Math.sign(x);x*h<0&&(P-=Math.PI*Math.sign(s)*Math.sign(x));const I=ae(this.center[0])*h;P=mt(P,-Math.PI-I,Math.PI-I);const R=rt(oe(P/h)+this.center[0],-180,180),$=Math.asin(rt((p-(s*s+x*x)*h*h)/(2*h),-1,1)),U=rt(oe($),-85.051129,ut);return new he(R,U)}}const v0=1.340264,_0=-.081106,x0=893e-6,b0=.003796,C1=Math.sqrt(3)/2;class qte extends bm{project(s,l){l=l/180*Math.PI,s=s/180*Math.PI;const h=Math.asin(C1*Math.sin(l)),p=h*h,v=p*p*p;return{x:.5*(s*Math.cos(h)/(C1*(v0+3*_0*p+v*(7*x0+9*b0*p)))/Math.PI+.5),y:1-.5*(h*(v0+_0*p+v*(x0+b0*p))/Math.PI+1),z:0}}unproject(s,l){s=(2*s-.5)*Math.PI;let h=l=(2*(1-l)-1)*Math.PI,p=h*h,v=p*p*p;for(let $,U,W,te=0;te<12&&(U=h*(v0+_0*p+v*(x0+b0*p))-l,W=v0+3*_0*p+v*(7*x0+9*b0*p),$=U/W,h=rt(h-$,-Math.PI/3,Math.PI/3),p=h*h,v=p*p*p,!(Math.abs($)<1e-12));++te);const x=C1*s*(v0+3*_0*p+v*(7*x0+9*b0*p))/Math.cos(h),P=Math.asin(Math.sin(h)/C1),I=rt(180*x/Math.PI,-180,180),R=rt(180*P/Math.PI,-85.051129,ut);return new he(I,R)}}class Gte extends bm{constructor(s){super(s),this.wrap=!0,this.supportsWorldCopies=!0}project(s,l){return{x:.5+s/360,y:.5-l/360,z:0}}unproject(s,l){const h=360*(s-.5),p=rt(360*(.5-l),-85.051129,ut);return new he(h,p)}}const rv=Math.PI/2;function A1(c){return Math.tan((rv+c)/2)}class Hte extends bm{constructor(s){super(s),this.center=s.center||[0,30];const[l,h]=this.parallels=s.parallels||[30,30];let p=ae(l),v=ae(h);this.southernCenter=p+v<0,this.southernCenter&&(p=-p,v=-v);const x=Math.cos(p),P=A1(p);this.n=p===v?Math.sin(p):Math.log(x/Math.cos(v))/Math.log(A1(v)/P),this.f=x*Math.pow(A1(p),this.n)/this.n}project(s,l){l=ae(l),this.southernCenter&&(l=-l),s=ae(s-this.center[0]);const h=1e-6,{n:p,f:v}=this;v>0?l<-rv+h&&(l=-rv+h):l>rv-h&&(l=rv-h);const x=v/Math.pow(A1(l),p);let P=x*Math.sin(p*s),I=v-x*Math.cos(p*s);return P=.5*(P/Math.PI+.5),I=.5*(I/Math.PI+.5),{x:P,y:this.southernCenter?I:1-I,z:0}}unproject(s,l){s=(2*s-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;const{n:h,f:p}=this,v=p-l,x=Math.sign(v),P=Math.sign(h)*Math.sqrt(s*s+v*v);let I=Math.atan2(s,Math.abs(v))*x;v*h<0&&(I-=Math.PI*Math.sign(s)*x);const R=rt(oe(I/h)+this.center[0],-180,180),$=rt(oe(2*Math.atan(Math.pow(p/P,1/h))-rv),-85.051129,ut);return new he(R,this.southernCenter?-$:$)}}class sz extends bm{constructor(s){super(s),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(s,l){return{x:Fe(s),y:je(l),z:0}}unproject(s,l){const h=qe(s),p=Ze(l);return new he(h,p)}}const oz=ae(ut);class Wte extends bm{project(s,l){const h=(l=ae(l))*l,p=h*h;return{x:.5*((s=ae(s))*(.8707-.131979*h+p*(p*(.003971*h-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+h*(.015085+p*(.028874*h-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(s,l){s=(2*s-.5)*Math.PI;let h=l=(2*(1-l)-1)*Math.PI,p=25,v=0,x=h*h;do{x=h*h;const R=x*x;v=(h*(1.007226+x*(.015085+R*(.028874*x-.044475-.005916*R)))-l)/(1.007226+x*(.045255+R*(.259866*x-.311325-.005916*11*R))),h=rt(h-v,-oz,oz)}while(Math.abs(v)>1e-6&&--p>0);x=h*h;const P=rt(oe(s/(.8707+x*(x*(x*x*x*(.003971-.001529*x)-.013791)-.131979))),-180,180),I=oe(h);return new he(P,I)}}const az=ae(ut);class Zte extends bm{project(s,l){l=ae(l),s=ae(s);const h=Math.cos(l),p=2/Math.PI,v=Math.acos(h*Math.cos(s/2)),x=Math.sin(v)/v,P=.5*(s*p+2*h*Math.sin(s/2)/x)||0,I=.5*(l+Math.sin(l)/x)||0;return{x:.5*(P/Math.PI+.5),y:1-.5*(I/Math.PI+1),z:0}}unproject(s,l){let h=s=(2*s-.5)*Math.PI,p=l=(2*(1-l)-1)*Math.PI,v=25;const x=1e-6;let P=0,I=0;do{const R=Math.cos(p),$=Math.sin(p),U=2*$*R,W=$*$,te=R*R,re=Math.cos(h/2),le=Math.sin(h/2),ve=2*re*le,_e=le*le,Ce=1-te*re*re,Ee=Ce?1/Ce:0,ue=Ce?Math.acos(R*re)*Math.sqrt(1/Ce):0,we=.5*(2*ue*R*le+2*h/Math.PI)-s,Te=.5*(ue*$+p)-l,Ie=.5*Ee*(te*_e+ue*R*re*W)+1/Math.PI,Ge=Ee*(ve*U/4-ue*$*le),Qe=.125*Ee*(U*le-ue*$*te*ve),it=.5*Ee*(W*re+ue*_e*R)+.5,ct=Ge*Qe-it*Ie;P=(Te*Ge-we*it)/ct,I=(we*Qe-Te*Ie)/ct,h=rt(h-P,-Math.PI,Math.PI),p=rt(p-I,-az,az)}while((Math.abs(P)>x||Math.abs(I)>x)&&--v>0);return new he(oe(h),oe(p))}}class lz extends bm{constructor(s){super(s),this.center=s.center||[0,0],this.parallels=s.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ae(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(s,l){const{scale:h,cosPhi:p}=this;return{x:ae(s)*p*h+.5,y:-Math.sin(ae(l))/p*h+.5,z:0}}unproject(s,l){const{scale:h,cosPhi:p}=this,v=-(l-.5)/h,x=rt(oe((s-.5)/h)/p,-180,180),P=Math.asin(rt(v*p,-1,1)),I=rt(oe(P),-85.051129,ut);return new he(x,I)}}class Xte extends sz{constructor(s){super(s),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(s,l,h){const p=Wh(s,l,h);return Tt(p,p,zg(jl(h))),{x:p[0],y:p[1],z:p[2]}}locationPoint(s,l,h){const p=fe(l.lat,l.lng),v=Ve([],p),x=h?s._centerAltitude+h:s.elevation?s.elevation.getAtPointOrZero(s.locationCoordinate(l),s._centerAltitude):s._centerAltitude;De(p,p,v,ke(1,0)*or*x);const P=O(new Float64Array(16));return V(P,s.pixelMatrix,s.globeMatrix),Tt(p,p,P),new Qt(p[0],p[1])}pixelsPerMeter(s,l){return ke(1,0)*l}pixelSpaceConversion(s,l,h){const p=ke(1,s)*l,v=Br(ke(1,45)*l,p,h);return this.pixelsPerMeter(s,l)/v}createTileMatrix(s,l,h){const p=r0(jl(h.canonical));return V(new Float64Array(16),s.globeMatrix,p)}createInversionMatrix(s,l){const{center:h}=s,p=zg(jl(l));return G(p,p,ae(h.lng)),J(p,p,ae(h.lat)),Z(p,p,[s._pixelsPerMercatorPixel,s._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(s,l,h,p){return t0(s,l,h,!0)||new gt(0,0)}pointCoordinate3D(s,l,h){const p=this.pointCoordinate(s,l,h,0);return[p.x,p.y,p.z]}isPointAboveHorizon(s,l){return!t0(s,l.x,l.y,!1)}farthestPixelDistance(s){const l=function(p,v){const x=p.cameraToCenterDistance,P=p._centerAltitude*v,I=p._camera,R=p._camera.forward(),$=Je([],Ue([],R,-x),[0,0,P]),U=p.worldSize/(2*Math.PI),W=[0,0,-U],te=p.width/p.height,re=Math.tan(p.fovAboveCenter),le=Ue([],I.up(),re),ve=Ue([],I.right(),re*te),_e=Ve([],Je([],Je([],R,le),ve)),Ce=[];let Ee;if(new Rl($,_e).closestPointOnSphere(W,U,Ce)){const ue=Je([],Ce,W),we=Rt([],ue,$);Ee=Math.cos(p.fovAboveCenter)*ze(we)}else{const ue=Rt([],$,W),we=Rt([],W,$);Ve(we,we);const Te=ze(ue)-U;Ee=Math.sqrt(Te*(Te+2*U));const Ie=Math.acos(Ee/(U+Te))-Math.acos(Et(R,we));Ee*=Math.cos(Ie)}return 1.01*Ee}(s,this.pixelsPerMeter(s.center.lat,s.worldSize)),h=Zh(s.zoom);if(h>0){const p=nz(s,ke(1,s.center.lat)*s.worldSize),v=s.worldSize/(2*Math.PI),x=Math.max(s.width,s.height)/s.worldSize*Math.PI;return Br(l,p+v*(1-Math.cos(x)),Math.pow(h,10))}return l}upVector(s,l,h){return Wh(l,h,s,1)}upVectorScale(s){return{metersToTile:Fu(mm(jl(s)))}}}function cz(c){const s=c.parallels,l=!!s&&Math.abs(s[0]+s[1])<.01;switch(c.name){case"mercator":return new sz(c);case"equirectangular":return new Gte(c);case"naturalEarth":return new Wte(c);case"equalEarth":return new qte(c);case"winkelTripel":return new Zte(c);case"albers":return l?new lz(c):new Ute(c);case"lambertConformalConic":return l?new lz(c):new Hte(c);case"globe":return new Xte(c)}throw new Error(`Invalid projection name: ${c.name}`)}const Kte=vm.VectorTileFeature.types,Yte=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function P1(c,s,l,h,p,v,x,P,I,R,$,U,W){const te=P?Math.min(xm,Math.round(P[0])):0,re=P?Math.min(xm,Math.round(P[1])):0;c.emplaceBack(s,l,Math.round(32*h),Math.round(32*p),v,x,(te<<1)+(I?1:0),re,16*R,16*$,256*U,256*W)}function M1(c,s,l){c.emplaceBack(s,l)}function I1(c,s,l,h,p,v,x){c.emplaceBack(s,l,h,p,v,x)}function k1(c,s,l,h,p){c.emplaceBack(s,l,h,p),c.emplaceBack(s,l,h,p),c.emplaceBack(s,l,h,p),c.emplaceBack(s,l,h,p)}function Jte(c){for(const s of c.sections)if(Gy(s.text))return!0;return!1}class kT{constructor(s){this.layoutVertexArray=new Vh,this.indexArray=new bs,this.programConfigurations=s,this.segments=new ji,this.dynamicLayoutVertexArray=new so,this.opacityVertexArray=new Wf,this.placedSymbolArray=new im,this.iconTransitioningVertexArray=new kl,this.globeExtVertexArray=new pa,this.zOffsetVertexArray=new Bh}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(s,l,h,p,v){this.isEmpty()||(h&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,hte.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,pte.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,Yte,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=s.createVertexBuffer(this.iconTransitioningVertexArray,gte.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=s.createVertexBuffer(this.globeExtVertexArray,fte.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||v)&&(this.zOffsetVertexBuffer=s.createVertexBuffer(this.zOffsetVertexArray,mte.members,!0)),this.opacityVertexBuffer.itemSize=1),(h||p)&&this.programConfigurations.upload(s))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}yr(kT,"SymbolBuffers");class OT{constructor(s,l,h){this.layoutVertexArray=new s,this.layoutAttributes=l,this.indexArray=new h,this.segments=new ji,this.collisionVertexArray=new Xf,this.collisionVertexArrayExt=new so}upload(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,yte.members,!0),this.collisionVertexBufferExt=s.createVertexBuffer(this.collisionVertexArrayExt,vte.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}yr(OT,"CollisionBuffers");class O1{constructor(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.lut=s.lut,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(x=>x.fqid),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=O([]),this.placementViewportMatrix=O([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=z3(this.zoom,l["text-size"]),this.iconSizeData=z3(this.zoom,l["icon-size"]);const h=this.layers[0].layout,p=h.get("symbol-sort-key"),v=h.get("symbol-z-order");this.canOverlap=h.get("text-allow-overlap")||h.get("icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=h.get("text-writing-mode").map(x=>Dl[x]),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=s.sourceID,this.projection=s.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new kT(new Kc(this.layers,{zoom:this.zoom,lut:this.lut},s=>s.startsWith("text")||s.startsWith("symbol"))),this.icon=new kT(new Kc(this.layers,{zoom:this.zoom,lut:this.lut},s=>s.startsWith("icon")||s.startsWith("symbol"))),this.glyphOffsetArray=new om,this.lineVertexArray=new kg,this.symbolInstances=new sm}calculateGlyphDependencies(s,l,h,p,v){for(const x of s){const P=x.codePointAt(0);if(P===void 0)break;if(l[P]=!0,p&&v&&P<=65535){const I=h0[x];I&&(l[I.charCodeAt(0)]=!0)}}}updateFootprints(s,l){}updateReplacement(s,l){if(l.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=l.updateTime;const h=l.getReplacementRegionsForTile(s.toUnwrapped(),!0);return!hT(this.activeReplacements,h)&&(this.activeReplacements=h,!0)}populate(s,l,h,p){const v=this.layers[0],x=v.layout,P=this.projection.name==="globe",I=x.get("text-font"),R=x.get("text-field"),$=x.get("icon-image"),[U,W]=x.get("icon-size-scale-range"),te=rt(l.scaleFactor||1,U,W),re=(R.value.kind!=="constant"||R.value.value instanceof Xo&&!R.value.value.isEmpty()||R.value.value.toString().length>0)&&(I.value.kind!=="constant"||I.value.value.length>0),le=$.value.kind!=="constant"||!!$.value.value||Object.keys($.parameters).length>0,ve=x.get("symbol-sort-key");if(this.features=[],!re&&!le)return;const _e=l.iconDependencies,Ce=l.glyphDependencies,Ee=l.availableImages,ue=new ni(this.zoom);for(const{feature:we,id:Te,index:Ie,sourceLayerIndex:Ge}of s){const Qe=v._featureFilter.needGeometry,it=Ar(we,Qe);if(!v._featureFilter.filter(ue,it,h))continue;if(Qe||(it.geometry=wr(we,h,p)),P&&we.type!==1&&h.z<=5){const Bt=it.geometry,Xt=.98078528056,xt=(Ft,_t)=>Et(Wh(Ft.x,Ft.y,h,1),Wh(_t.x,_t.y,h,1))<Xt;for(let Ft=0;Ft<Bt.length;Ft++)Bt[Ft]=zt(Bt[Ft],xt)}let ct,St;if(re){const Bt=v.getValueAndResolveTokens("text-field",it,h,Ee),Xt=Xo.factory(Bt);Jte(Xt)&&(this.hasRTLText=!0),(!this.hasRTLText||us()==="unavailable"||this.hasRTLText&&Sa.isParsed())&&(ct=xte(Xt,v,it))}if(le){const Bt=v.getValueAndResolveTokens("icon-image",it,h,Ee);St=typeof Bt=="string"?ca.build(Bt):Bt}if(!ct&&!St)continue;const Vt=this.sortFeaturesByKey?ve.evaluate(it,{},h):void 0,Nt={id:Te,text:ct,icon:St,index:Ie,sourceLayerIndex:Ge,geometry:it.geometry,properties:we.properties,type:Kte[we.type],sortKey:Vt};if(this.features.push(Nt),St){const Bt=this.layers[0]._unevaluatedLayout._values,{iconPrimary:Xt,iconSecondary:xt}=Q3(St,this.iconSizeData,Bt["icon-size"],h,this.zoom,Nt,this.pixelRatio,te),Ft=Xt.id.toString();if(_e.has(Ft)?_e.get(Ft).push(Xt):_e.set(Ft,[Xt]),xt){const _t=xt.id.toString();_e.has(_t)?_e.get(_t).push(xt):_e.set(_t,[xt])}}if(ct){const Bt=I.evaluate(it,{},h).join(","),Xt=x.get("text-rotation-alignment")==="map"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Dl.vertical)>=0;for(const xt of ct.sections)if(xt.image){const Ft=xt.image.getPrimary().scaleSelf(this.pixelRatio),_t=Ft.id.toString(),wt=_e.get(_t)||[];wt.push(Ft),_e.set(_t,wt)}else{const Ft=ic(ct.toString()),_t=xt.fontStack||Bt,wt=Ce[_t]=Ce[_t]||{};this.calculateGlyphDependencies(xt.text,wt,Xt,this.allowVerticalPlacement,Ft)}}}if(x.get("symbol-placement")==="line"&&(this.features=function(we){const Te={},Ie={},Ge=[];let Qe=0;function it(Nt){Ge.push(we[Nt]),Qe++}function ct(Nt,Bt,Xt){const xt=Ie[Nt];return delete Ie[Nt],Ie[Bt]=xt,Ge[xt].geometry[0].pop(),Ge[xt].geometry[0]=Ge[xt].geometry[0].concat(Xt[0]),xt}function St(Nt,Bt,Xt){const xt=Te[Bt];return delete Te[Bt],Te[Nt]=xt,Ge[xt].geometry[0].shift(),Ge[xt].geometry[0]=Xt[0].concat(Ge[xt].geometry[0]),xt}function Vt(Nt,Bt,Xt){const xt=Xt?Bt[0][Bt[0].length-1]:Bt[0][0];return`${Nt}:${xt.x}:${xt.y}`}for(let Nt=0;Nt<we.length;Nt++){const Bt=we[Nt],Xt=Bt.geometry,xt=Bt.text?Bt.text.toString():null;if(!xt){it(Nt);continue}const Ft=Vt(xt,Xt),_t=Vt(xt,Xt,!0);if(Ft in Ie&&_t in Te&&Ie[Ft]!==Te[_t]){const wt=St(Ft,_t,Xt),Yt=ct(Ft,_t,Ge[wt].geometry);delete Te[Ft],delete Ie[_t],Ie[Vt(xt,Ge[Yt].geometry,!0)]=Yt,Ge[wt].geometry=null}else Ft in Ie?ct(Ft,_t,Xt):_t in Te?St(Ft,_t,Xt):(it(Nt),Te[Ft]=Qe-1,Ie[_t]=Qe-1)}return Ge.filter(Nt=>Nt.geometry)}(this.features)),x.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",l.elevationFeatures){!this.elevationFeatures&&l.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const we of l.elevationFeatures)this.elevationFeatureIdToIndex.set(we.id,this.elevationFeatures.length),this.elevationFeatures.push(we)}}else x.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((we,Te)=>we.sortKey-Te.sortKey)}update(s,l,h,p,v,x,P){this.text.programConfigurations.updatePaintArrays(s,l,v,h,p,x,P),this.icon.programConfigurations.updatePaintArrays(s,l,v,h,p,x,P)}updateRoadElevation(){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let s=!1;for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l);if(h.elevationFeatureIndex===65535)continue;const p=this.elevationFeatures[h.elevationFeatureIndex];if(p){const v=.05+p.pointElevation(new Qt(h.tileAnchorX,h.tileAnchorY));h.zOffset!==v&&(s=!0,h.zOffset=v)}}s&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const s=(v,x,P)=>{h+=x,h>v.length&&v.resize(h);for(let I=-x;I<0;I++)v.emplace(I+h,P)},l=(v,x,P)=>{p+=x,p>v.length&&v.resize(p);for(let I=-x;I<0;I++)v.emplace(I+p,P)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let h=0,p=0;for(let v=0;v<this.symbolInstances.length;v++){const x=this.symbolInstances.get(v),{numHorizontalGlyphVertices:P,numVerticalGlyphVertices:I,numIconVertices:R}=x,$=x.zOffset,U=R>0;if((P>0||I>0)&&(s(this.text.zOffsetVertexArray,P,$),s(this.text.zOffsetVertexArray,I,$)),U){const{placedIconSymbolIndex:W,verticalPlacedIconSymbolIndex:te}=x;W>=0&&l(this.icon.zOffsetVertexArray,R,$),te>=0&&l(this.icon.zOffsetVertexArray,x.numVerticalIconVertices,$)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=cz(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(s,l){const h=this.lineVertexArray.length;if(s.segment!==void 0)for(const{x:p,y:v}of l)this.lineVertexArray.emplaceBack(p,v);return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(s,l,h,p,v,x,P,I,R,$,U,W,te,re,le,ve){const _e=s.indexArray,Ce=s.layoutVertexArray,Ee=s.globeExtVertexArray,ue=s.segments.prepareSegment(4*l.length,Ce,_e,this.canOverlap?x.sortKey:void 0),we=this.glyphOffsetArray.length,Te=ue.vertexLength,Ie=this.allowVerticalPlacement&&P===Dl.vertical?Math.PI/2:0,Ge=x.text&&x.text.sections;for(let it=0;it<l.length;it++){const{tl:ct,tr:St,bl:Vt,br:Nt,texPrimary:Bt,texSecondary:Xt,pixelOffsetTL:xt,pixelOffsetBR:Ft,minFontScaleX:_t,minFontScaleY:wt,glyphOffset:Yt,isSDF:tr,sectionIndex:Or}=l[it],Tr=ue.vertexLength,hr=Yt[1];if(P1(Ce,R.x,R.y,ct.x,hr+ct.y,Bt.x,Bt.y,h,tr,xt.x,xt.y,_t,wt),P1(Ce,R.x,R.y,St.x,hr+St.y,Bt.x+Bt.w,Bt.y,h,tr,Ft.x,xt.y,_t,wt),P1(Ce,R.x,R.y,Vt.x,hr+Vt.y,Bt.x,Bt.y+Bt.h,h,tr,xt.x,Ft.y,_t,wt),P1(Ce,R.x,R.y,Nt.x,hr+Nt.y,Bt.x+Bt.w,Bt.y+Bt.h,h,tr,Ft.x,Ft.y,_t,wt),I){const{x:Kt,y:tn,z:Pr}=I.anchor,[Mr,Kr,dn]=I.up;I1(Ee,Kt,tn,Pr,Mr,Kr,dn),I1(Ee,Kt,tn,Pr,Mr,Kr,dn),I1(Ee,Kt,tn,Pr,Mr,Kr,dn),I1(Ee,Kt,tn,Pr,Mr,Kr,dn),k1(s.dynamicLayoutVertexArray,Kt,tn,Pr,Ie)}else k1(s.dynamicLayoutVertexArray,R.x,R.y,R.z,Ie);if(ve){const Kt=Xt||Bt;M1(s.iconTransitioningVertexArray,Kt.x,Kt.y),M1(s.iconTransitioningVertexArray,Kt.x+Kt.w,Kt.y),M1(s.iconTransitioningVertexArray,Kt.x,Kt.y+Kt.h),M1(s.iconTransitioningVertexArray,Kt.x+Kt.w,Kt.y+Kt.h)}_e.emplaceBack(Tr,Tr+1,Tr+2),_e.emplaceBack(Tr+1,Tr+2,Tr+3),ue.vertexLength+=4,ue.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Yt[0]),it!==l.length-1&&Or===l[it+1].sectionIndex||s.programConfigurations.populatePaintArrays(Ce.length,x,x.index,{},te,re,le,Ge&&Ge[Or])}const Qe=I?I.anchor:R;s.placedSymbolArray.emplaceBack(Qe.x,Qe.y,Qe.z,R.x,R.y,we,this.glyphOffsetArray.length-we,Te,$,U,R.segment,h?h[0]:0,h?h[1]:0,p[0],p[1],P,0,0,0,W,0)}_commitLayoutVertex(s,l,h,p,v,x,P){s.emplaceBack(l,h,p,v,x,Math.round(P.x),Math.round(P.y))}_addCollisionDebugVertices(s,l,h,p,v,x,P){const I=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),R=I.vertexLength,$=P.tileAnchorX,U=P.tileAnchorY;for(let te=0;te<4;te++)h.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(h.collisionVertexArrayExt,l,s.padding,P.zOffset),this._commitLayoutVertex(h.layoutVertexArray,p,v,x,$,U,new Qt(s.x1,s.y1)),this._commitLayoutVertex(h.layoutVertexArray,p,v,x,$,U,new Qt(s.x2,s.y1)),this._commitLayoutVertex(h.layoutVertexArray,p,v,x,$,U,new Qt(s.x2,s.y2)),this._commitLayoutVertex(h.layoutVertexArray,p,v,x,$,U,new Qt(s.x1,s.y2)),I.vertexLength+=4;const W=h.indexArray;W.emplaceBack(R,R+1),W.emplaceBack(R+1,R+2),W.emplaceBack(R+2,R+3),W.emplaceBack(R+3,R),I.primitiveLength+=4}_addTextDebugCollisionBoxes(s,l,h,p,v,x){for(let P=p;P<v;P++){const I=h.get(P),R=this.getSymbolInstanceTextSize(s,x,l,P);this._addCollisionDebugVertices(I,R,this.textCollisionBox,I.projectedAnchorX,I.projectedAnchorY,I.projectedAnchorZ,x)}}_addIconDebugCollisionBoxes(s,l,h,p,v,x){for(let P=p;P<v;P++){const I=h.get(P),R=this.getSymbolInstanceIconSize(s,l,x.placedIconSymbolIndex);this._addCollisionDebugVertices(I,R,this.iconCollisionBox,I.projectedAnchorX,I.projectedAnchorY,I.projectedAnchorZ,x)}}generateCollisionDebugBuffers(s,l,h){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new OT(Zf,E3.members,kl),this.iconCollisionBox=new OT(Zf,E3.members,kl);const p=p0(this.iconSizeData,s),v=p0(this.textSizeData,s,h);for(let x=0;x<this.symbolInstances.length;x++){const P=this.symbolInstances.get(x);this._addTextDebugCollisionBoxes(v,s,l,P.textBoxStartIndex,P.textBoxEndIndex,P),this._addTextDebugCollisionBoxes(v,s,l,P.verticalTextBoxStartIndex,P.verticalTextBoxEndIndex,P),this._addIconDebugCollisionBoxes(p,s,l,P.iconBoxStartIndex,P.iconBoxEndIndex,P),this._addIconDebugCollisionBoxes(p,s,l,P.verticalIconBoxStartIndex,P.verticalIconBoxEndIndex,P)}}getSymbolInstanceTextSize(s,l,h,p){const v=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:p),x=ET(this.textSizeData,s,v)/Co;return this.tilePixelRatio*x}getSymbolInstanceIconSize(s,l,h){const p=this.icon.placedSymbolArray.get(h),v=ET(this.iconSizeData,s,p);return this.tilePixelRatio*v}_commitDebugCollisionVertexUpdate(s,l,h,p){s.emplaceBack(l,-h,-h,p),s.emplaceBack(l,h,-h,p),s.emplaceBack(l,h,h,p),s.emplaceBack(l,-h,h,p)}_updateTextDebugCollisionBoxes(s,l,h,p,v,x,P){for(let I=p;I<v;I++){const R=h.get(I),$=this.getSymbolInstanceTextSize(s,x,l,I);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,$,R.padding,x.zOffset)}}_updateIconDebugCollisionBoxes(s,l,h,p,v,x,P){for(let I=p;I<v;I++){const R=h.get(I),$=this.getSymbolInstanceIconSize(s,l,x.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,$,R.padding,x.zOffset)}}updateCollisionDebugBuffers(s,l,h,p){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const v=p0(this.iconSizeData,s,p),x=p0(this.textSizeData,s,h);for(let P=0;P<this.symbolInstances.length;P++){const I=this.symbolInstances.get(P);this._updateTextDebugCollisionBoxes(x,s,l,I.textBoxStartIndex,I.textBoxEndIndex,I,h),this._updateTextDebugCollisionBoxes(x,s,l,I.verticalTextBoxStartIndex,I.verticalTextBoxEndIndex,I,h),this._updateIconDebugCollisionBoxes(v,s,l,I.iconBoxStartIndex,I.iconBoxEndIndex,I,p),this._updateIconDebugCollisionBoxes(v,s,l,I.verticalIconBoxStartIndex,I.verticalIconBoxEndIndex,I,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(s,l,h,p,v,x,P,I,R){const $={};if(l<h){const{x1:U,y1:W,x2:te,y2:re,padding:le,projectedAnchorX:ve,projectedAnchorY:_e,projectedAnchorZ:Ce,tileAnchorX:Ee,tileAnchorY:ue,featureIndex:we}=s.get(l);$.textBox={x1:U,y1:W,x2:te,y2:re,padding:le,projectedAnchorX:ve,projectedAnchorY:_e,projectedAnchorZ:Ce,tileAnchorX:Ee,tileAnchorY:ue},$.textFeatureIndex=we}if(p<v){const{x1:U,y1:W,x2:te,y2:re,padding:le,projectedAnchorX:ve,projectedAnchorY:_e,projectedAnchorZ:Ce,tileAnchorX:Ee,tileAnchorY:ue,featureIndex:we}=s.get(p);$.verticalTextBox={x1:U,y1:W,x2:te,y2:re,padding:le,projectedAnchorX:ve,projectedAnchorY:_e,projectedAnchorZ:Ce,tileAnchorX:Ee,tileAnchorY:ue},$.verticalTextFeatureIndex=we}if(x<P){const{x1:U,y1:W,x2:te,y2:re,padding:le,projectedAnchorX:ve,projectedAnchorY:_e,projectedAnchorZ:Ce,tileAnchorX:Ee,tileAnchorY:ue,featureIndex:we}=s.get(x);$.iconBox={x1:U,y1:W,x2:te,y2:re,padding:le,projectedAnchorX:ve,projectedAnchorY:_e,projectedAnchorZ:Ce,tileAnchorX:Ee,tileAnchorY:ue},$.iconFeatureIndex=we}if(I<R){const{x1:U,y1:W,x2:te,y2:re,padding:le,projectedAnchorX:ve,projectedAnchorY:_e,projectedAnchorZ:Ce,tileAnchorX:Ee,tileAnchorY:ue,featureIndex:we}=s.get(I);$.verticalIconBox={x1:U,y1:W,x2:te,y2:re,padding:le,projectedAnchorX:ve,projectedAnchorY:_e,projectedAnchorZ:Ce,tileAnchorX:Ee,tileAnchorY:ue},$.verticalIconFeatureIndex=we}return $}deserializeCollisionBoxes(s){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(s,l){const h=s.placedSymbolArray.get(l),p=h.vertexStartIndex+4*h.numGlyphs;for(let v=h.vertexStartIndex;v<p;v+=4)s.indexArray.emplaceBack(v,v+1,v+2),s.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(s),h=Math.cos(s),p=[],v=[],x=[];for(let P=0;P<this.symbolInstances.length;++P){x.push(P);const I=this.symbolInstances.get(P);p.push(0|Math.round(l*I.tileAnchorX+h*I.tileAnchorY)),v.push(I.featureIndex)}return x.sort((P,I)=>p[P]-p[I]||v[I]-v[P]),x}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let s=0;s<this.symbolInstances.length;++s)this.symbolInstanceIndexesSortedZOffset.push(s)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((s,l)=>this.symbolInstances.get(l).zOffset-this.symbolInstances.get(s).zOffset)}addToSortKeyRanges(s,l){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===l?h.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:s,symbolInstanceEnd:s+1})}sortFeatures(s){if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const h=this.symbolInstances.get(l);this.featureSortOrder.push(h.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:v,leftJustifiedTextSymbolIndex:x,verticalPlacedTextSymbolIndex:P,placedIconSymbolIndex:I,verticalPlacedIconSymbolIndex:R}=h;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),v>=0&&v!==p&&this.addIndicesForPlacedSymbol(this.text,v),x>=0&&x!==v&&x!==p&&this.addIndicesForPlacedSymbol(this.text,x),P>=0&&this.addIndicesForPlacedSymbol(this.text,P),I>=0&&this.addIndicesForPlacedSymbol(this.icon,I),R>=0&&this.addIndicesForPlacedSymbol(this.icon,R)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let uz,dz,LT;yr(O1,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),O1.addDynamicAttributes=k1;class hz{constructor(s){this.type=s.property.overrides?s.property.overrides.runtimeType:kc,this.defaultValue=s}evaluate(s){if(s.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(s.formattedSection))return l.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default}eachChild(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}yr(hz,"FormatSectionOverride",{omit:["defaultValue"]});const RT=()=>LT||(LT={layout:uz||(uz=new qi({"symbol-placement":new er(ft.layout_symbol["symbol-placement"]),"symbol-spacing":new er(ft.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new er(ft.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new br(ft.layout_symbol["symbol-sort-key"]),"symbol-z-order":new er(ft.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new er(ft.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new er(ft.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new er(ft.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new er(ft.layout_symbol["icon-ignore-placement"]),"icon-optional":new er(ft.layout_symbol["icon-optional"]),"icon-rotation-alignment":new er(ft.layout_symbol["icon-rotation-alignment"]),"icon-size":new br(ft.layout_symbol["icon-size"]),"icon-size-scale-range":new er(ft.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new br(ft.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new br(ft.layout_symbol["icon-text-fit-padding"]),"icon-image":new br(ft.layout_symbol["icon-image"]),"icon-rotate":new br(ft.layout_symbol["icon-rotate"]),"icon-padding":new er(ft.layout_symbol["icon-padding"]),"icon-keep-upright":new er(ft.layout_symbol["icon-keep-upright"]),"icon-offset":new br(ft.layout_symbol["icon-offset"]),"icon-anchor":new br(ft.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new er(ft.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new er(ft.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new er(ft.layout_symbol["text-rotation-alignment"]),"text-field":new br(ft.layout_symbol["text-field"]),"text-font":new br(ft.layout_symbol["text-font"]),"text-size":new br(ft.layout_symbol["text-size"]),"text-size-scale-range":new er(ft.layout_symbol["text-size-scale-range"]),"text-max-width":new br(ft.layout_symbol["text-max-width"]),"text-line-height":new br(ft.layout_symbol["text-line-height"]),"text-letter-spacing":new br(ft.layout_symbol["text-letter-spacing"]),"text-justify":new br(ft.layout_symbol["text-justify"]),"text-radial-offset":new br(ft.layout_symbol["text-radial-offset"]),"text-variable-anchor":new er(ft.layout_symbol["text-variable-anchor"]),"text-anchor":new br(ft.layout_symbol["text-anchor"]),"text-max-angle":new er(ft.layout_symbol["text-max-angle"]),"text-writing-mode":new er(ft.layout_symbol["text-writing-mode"]),"text-rotate":new br(ft.layout_symbol["text-rotate"]),"text-padding":new er(ft.layout_symbol["text-padding"]),"text-keep-upright":new er(ft.layout_symbol["text-keep-upright"]),"text-transform":new br(ft.layout_symbol["text-transform"]),"text-offset":new br(ft.layout_symbol["text-offset"]),"text-allow-overlap":new er(ft.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new er(ft.layout_symbol["text-ignore-placement"]),"text-optional":new er(ft.layout_symbol["text-optional"]),visibility:new er(ft.layout_symbol.visibility)})),paint:dz||(dz=new qi({"icon-opacity":new br(ft.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new br(ft.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new br(ft.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new br(ft.paint_symbol["text-emissive-strength"]),"icon-color":new br(ft.paint_symbol["icon-color"]),"icon-halo-color":new br(ft.paint_symbol["icon-halo-color"]),"icon-halo-width":new br(ft.paint_symbol["icon-halo-width"]),"icon-halo-blur":new br(ft.paint_symbol["icon-halo-blur"]),"icon-translate":new er(ft.paint_symbol["icon-translate"]),"icon-translate-anchor":new er(ft.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new er(ft.paint_symbol["icon-image-cross-fade"]),"text-opacity":new br(ft.paint_symbol["text-opacity"]),"text-occlusion-opacity":new br(ft.paint_symbol["text-occlusion-opacity"]),"text-color":new br(ft.paint_symbol["text-color"],{runtimeType:Oo,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new br(ft.paint_symbol["text-halo-color"]),"text-halo-width":new br(ft.paint_symbol["text-halo-width"]),"text-halo-blur":new br(ft.paint_symbol["text-halo-blur"]),"text-translate":new er(ft.paint_symbol["text-translate"]),"text-translate-anchor":new er(ft.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new er(ft.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new er(ft.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new er(ft.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new er(ft.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new br(ft.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new br({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new br({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new br({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new br({type:"string",default:"default","property-type":"data-driven"})}))},LT);class L1 extends To{constructor(s,l,h,p){super(s,RT(),l,h,p),this._colorAdjustmentMatrix=O([]),this.hasInitialOcclusionOpacityProperties=s.paint!==void 0&&("icon-occlusion-opacity"in s.paint||"text-occlusion-opacity"in s.paint)}recalculate(s,l){super.recalculate(s,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const h=this.layout.get("text-writing-mode");if(h){const p=[];for(const v of h)p.indexOf(v)<0&&p.push(v);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(s,l,h,p){return this._saturation===s&&this._contrast===l&&this._brightnessMin===h&&this._brightnessMax===p||(this._colorAdjustmentMatrix=function(v,x,P,I){v=xs(v),x=Qs(x);const R=D(),$=v/3,U=1-2*$,W=[U,$,$,0,$,U,$,0,$,$,U,0,0,0,0,1],te=.5-.5*x,re=I-P;return V(R,[re,0,0,0,0,re,0,0,0,0,re,0,P,P,P,1],[x,0,0,0,0,x,0,0,0,0,x,0,te,te,te,1]),V(R,R,W),R}(s,l,h,p),this._saturation=s,this._contrast=l,this._brightnessMin=h,this._brightnessMax=p),this._colorAdjustmentMatrix}getValueAndResolveTokens(s,l,h,p){const v=this.layout.get(s).evaluate(l,{},h,p),x=this._unevaluatedLayout._values[s];return x.isDataDriven()||Ed(x.value)||!v?v:function(P,I){return I.replace(/{([^{}]+)}/g,(R,$)=>$ in P?String(P[$]):"")}(l.properties,v)}createBucket(s){return new O1(s)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const s of RT().paint.overridableProperties){if(!L1.hasPaintOverride(this.layout,s))continue;const l=this.paint.get(s),h=new hz(l),p=new Sd(h,l.property.specification,this.scope,this.options);let v=null;v=l.value.kind==="constant"||l.value.kind==="source"?new Cu("source",p):new Pl("composite",p,l.value.zoomStops,l.value.interpolationType),this.paint._values[s]=new Wc(l.property,v,l.parameters)}}_handleOverridablePaintPropertyUpdate(s,l,h){return!(!this.layout||l.isDataDriven()||h.isDataDriven())&&L1.hasPaintOverride(this.layout,s)}static hasPaintOverride(s,l){const h=s.get("text-field"),p=RT().paint.properties[l];let v=!1;const x=P=>{for(const I of P)if(p.overrides&&p.overrides.hasOverride(I))return void(v=!0)};if(h.value.kind==="constant"&&h.value.value instanceof Xo)x(h.value.value.sections);else if(h.value.kind==="source"){const P=R=>{v||(R instanceof gn&&Fs(R.value)===xf?x(R.value.sections):R instanceof fd?x(R.sections):R.eachChild(P))},I=h.value;I._styleExpression&&P(I._styleExpression.expression)}return v}getProgramIds(){return["symbol"]}getDefaultProgramParams(s,l,h){return{config:new hc(this,{zoom:l,lut:h}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let fz,pz,mz,gz;var jT=qn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function DT(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function NT(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class zT{constructor(s,l,h,p){this.context=s,this.format=h,this.useMipmap=p&&p.useMipmap,this.texture=s.gl.createTexture(),this.update(l,{premultiply:p&&p.premultiply})}update(s,l){const h=s&&s instanceof HTMLVideoElement&&s.width===0?s.videoWidth:s.width,p=s&&s instanceof HTMLVideoElement&&s.height===0?s.videoHeight:s.height,{context:v}=this,{gl:x}=v,{x:P,y:I}=l&&l.position?l.position:{x:0,y:0},R=P+h,$=I+p;!this.size||this.size[0]===R&&this.size[1]===$||(x.bindTexture(x.TEXTURE_2D,null),x.deleteTexture(this.texture),this.texture=x.createTexture(),this.size=null),x.bindTexture(x.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA8&&(!l||l.premultiply!==!1));const U=s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||ImageBitmap&&s instanceof ImageBitmap;if(!this.size&&R>0&&$>0){const W=this.useMipmap?Math.floor(Math.log2(Math.max(R,$)))+1:1;x.texStorage2D(x.TEXTURE_2D,W,this.format,R,$),this.size=[R,$]}if(this.size)if(U)x.texSubImage2D(x.TEXTURE_2D,0,P,I,DT(this.format),NT(this.format),s);else{const W=s.data;W&&x.texSubImage2D(x.TEXTURE_2D,0,P,I,h,p,DT(this.format),NT(this.format),W)}this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(s,l,h=!1){const{context:p}=this,{gl:v}=p;v.bindTexture(v.TEXTURE_2D,this.texture),s!==this.minFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,s),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,this.useMipmap&&!h?s===v.NEAREST?v.NEAREST_MIPMAP_NEAREST:v.LINEAR_MIPMAP_LINEAR:s),this.minFilter=s),l!==this.wrapS&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,l),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,l),this.wrapS=l)}bindExtraParam(s,l,h,p){const{context:v}=this,{gl:x}=v;x.bindTexture(x.TEXTURE_2D,this.texture),l!==this.magFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,l),this.magFilter=l),s!==this.minFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,this.useMipmap?s===x.NEAREST?x.NEAREST_MIPMAP_NEAREST:x.LINEAR_MIPMAP_LINEAR:s),this.minFilter=s),h!==this.wrapS&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,h),this.wrapS=h),p!==this.wrapT&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,p),this.wrapT=p)}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}class R1{constructor(s,l){this.context=s,this.texture=l}bind(s,l){const{context:h}=this,{gl:p}=h;p.bindTexture(p.TEXTURE_2D,this.texture),s!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,s),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,s),this.minFilter=s),l!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,l),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,l),this.wrapS=l)}}function j1(c,s,l,h,p,v,x,P){const I=[c,s,1,l,h,1,p,v,1],R=[x,P,1],$=k([],I),[U,W,te]=Ht(R,R,$);return F(I,I,[U,0,0,0,W,0,0,0,te])}function yz(c,s,l,h,p,v,x,P){const I=function(R,$,U,W,te,re,le,ve){const _e=j1(0,0,1,0,1,1,0,1),Ce=j1(R,$,U,W,te,re,le,ve);return F(Ce,Ce,k([],_e))}(c,s,l,h,p,v,x,P);return[I[2]/I[8]/or,I[5]/I[8]/or]}function D1(c){return[c[0],Math.min(Math.max(c[1],-85.051129),ut)]}class vz extends Zl{constructor(s,l,h,p){super(),this.id=s,this.dispatcher=h,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(p),this.options=l,this._dirty=!1}load(s,l){if(this._loaded=l||!1,this.fire(new Hl("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return s&&(this.coordinates=s),this._loaded=!0,void this._finishLoading();this._imageRequest=oh(this.map._requestManager.transformRequest(this.url,hu.Image),(h,p)=>{this._imageRequest=null,this._loaded=!0,h?this.fire(new Rp(h)):p&&(this.image=p instanceof HTMLImageElement?Ia.getImageData(p):p,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,s&&(this.coordinates=s),this._finishLoading())})}loaded(){return this._loaded}updateImage(s){return s.url?(this._imageRequest&&s.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=s.url,this.load(s.coordinates,this._loaded),this):this}setTexture(s){if(!(s.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new R1(this.map.painter.context,s.handle),this.width=s.dimensions[0],this.height=s.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Hl("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(s){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof R1||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(s){if(this.coordinates=s,this._boundsArray=void 0,this._unsupportedCoords=!1,!s.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let l=s[0][1],h=s[0][1];for(const v of s)v[1]>h&&(h=v[1]),v[1]<l&&(l=v[1]);const p=(h+l)/2;if(p>ut?this.onNorthPole=!0:p<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const v=s.map(gt.fromLngLat);this.tileID=function(x){let P=1/0,I=1/0,R=-1/0,$=-1/0;for(const le of x)P=Math.min(P,le.x),I=Math.min(I,le.y),R=Math.max(R,le.x),$=Math.max($,le.y);const U=Math.max(R-P,$-I),W=Math.max(0,Math.floor(-Math.log(U)/Math.LN2)),te=Math.pow(2,W);let re=Math.floor((P+R)/2*te);return re>1&&(re-=1),new Mn(W,re,Math.floor((I+$)/2*te))}(v),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Hl("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(s){for(const _e in this.tiles){const Ce=this.tiles[_e];Ce.state!=="loaded"&&(Ce.state="loaded",Ce.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const l=y0(new Mn(0,0,0),this.map.transform.projection),h=[l.projection.project(this.coordinates[0][0],this.coordinates[0][1]),l.projection.project(this.coordinates[1][0],this.coordinates[1][1]),l.projection.project(this.coordinates[2][0],this.coordinates[2][1]),l.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(_e){const Ce=_e[1].x-_e[0].x,Ee=_e[1].y-_e[0].y,ue=_e[2].x-_e[1].x,we=_e[2].y-_e[1].y,Te=_e[3].x-_e[2].x,Ie=_e[3].y-_e[2].y,Ge=_e[0].x-_e[3].x,Qe=_e[0].y-_e[3].y,it=Ce*we-ue*Ee,ct=ue*Ie-Te*we,St=Te*Qe-Ge*Ie,Vt=Ge*Ee-Ce*Qe;return it>0&&ct>0&&St>0&&Vt>0||it<0&&ct<0&&St<0&&Vt<0}(h))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const p=y0(this.tileID,this.map.transform.projection),[v,x,P,I]=this.coordinates.map(_e=>{const Ce=p.projection.project(_e[0],_e[1]);return iz(p,Ce)._round()});this.perspectiveTransform=yz(v.x,v.y,x.x,x.y,P.x,P.y,I.x,I.y);const R=this._boundsArray=new Lu;R.emplaceBack(v.x,v.y,0,0),R.emplaceBack(x.x,x.y,or,0),R.emplaceBack(I.x,I.y,0,or),R.emplaceBack(P.x,P.y,or,or),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=s.createVertexBuffer(R,jT.members),this.boundsSegments=ji.simpleSegment(0,0,4,2);const $=[],U=[D1((W=this.coordinates)[0]),D1(W[1]),D1(W[2]),D1(W[3])];var W;const[te,re,le,ve]=function(_e){let Ce=_e[0][0],Ee=Ce,ue=_e[0][1],we=ue;for(let Te=1;Te<_e.length;Te++)_e[Te][0]<Ce?Ce=_e[Te][0]:_e[Te][0]>Ee&&(Ee=_e[Te][0]),_e[Te][1]<ue?ue=_e[Te][1]:_e[Te][1]>we&&(we=_e[Te][1]);return[Ce,ue,Ee-Ce,we-ue]}(U);{const _e=new Lu,[Ce,Ee,ue,we]=function(xt){let Ft=xt[0].x,_t=Ft,wt=xt[0].y,Yt=wt;for(let tr=1;tr<xt.length;tr++)xt[tr].x<Ft?Ft=xt[tr].x:xt[tr].x>_t&&(_t=xt[tr].x),xt[tr].y<wt?wt=xt[tr].y:xt[tr].y>Yt&&(Yt=xt[tr].y);return[Ft,wt,_t-Ft,Yt-wt]}(h),Te=xt=>[(xt.x-Ce)/ue,(xt.y-Ee)/we],[Ie,Ge,Qe,it]=h.map(Te),ct=function(xt,Ft,_t,wt,Yt,tr,Or,Tr){const hr=j1(0,0,1,0,1,1,0,1);return F(hr,hr,k([],j1(xt,Ft,_t,wt,Yt,tr,Or,Tr)))}(Ie[0],Ie[1],Ge[0],Ge[1],Qe[0],Qe[1],it[0],it[1]);this.elevatedGlobePerspectiveTransform=yz(Ie[0],Ie[1],Ge[0],Ge[1],Qe[0],Qe[1],it[0],it[1]);const St=(xt,Ft)=>{$.push(xt.lng);const _t=Math.round((xt.lng-te)/le*or),wt=Math.round((xt.lat-re)/ve*or),Yt=Te(Ft),tr=Ht([],[Yt[0],Yt[1],1],ct),Or=Math.round(tr[0]/tr[2]*or),Tr=Math.round(tr[1]/tr[2]*or);_e.emplaceBack(_t,wt,Or,Tr)},Vt=h[3].x-h[0].x,Nt=h[3].y-h[0].y,Bt=h[2].x-h[1].x,Xt=h[2].y-h[1].y;for(let xt=0;xt<65;xt++){const Ft=xt/64,_t=[h[0].x+Ft*Vt,h[0].y+Ft*Nt],wt=[h[1].x+Ft*Bt,h[1].y+Ft*Xt],Yt=wt[0]-_t[0],tr=wt[1]-_t[1];for(let Or=0;Or<65;Or++){const Tr=Or/64,hr={x:_t[0]+Yt*Tr,y:_t[1]+tr*Tr};St(l.projection.unproject(hr.x,hr.y),hr)}}this.elevatedGlobeVertexBuffer=s.createVertexBuffer(_e,jT.members)}{this.maxLongitudeTriangleSize=0;let _e=[],Ce=new bs;const Ee=(ue,we,Te)=>{Ce.emplaceBack(ue,we,Te);const Ie=$[ue],Ge=$[we],Qe=$[Te],it=Math.min(Math.min(Ie,Ge),Qe),ct=Math.max(Math.max(Ie,Ge),Qe)-it;ct>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=ct),_e.push(it+ct/2)};for(let ue=0;ue<64;ue++)for(let we=0;we<64;we++){const Te=65*ue+we,Ie=Te+1,Ge=Te+65,Qe=Ge+1;Ee(Te,Ge,Ie),Ee(Ie,Ge,Qe)}[_e,Ce]=function(ue,we){const Te=Array.from({length:ue.length},(Qe,it)=>it);Te.sort((Qe,it)=>ue[Qe]-ue[it]);const Ie=[],Ge=new bs;for(let Qe=0;Qe<Te.length;Qe++){const it=Te[Qe];Ie.push(ue[it]);const ct=3*it,St=ct+1;Ge.emplaceBack(we.uint16[ct],we.uint16[St],we.uint16[St+1])}return[Ie,Ge]}(_e,Ce),this.elevatedGlobeTrianglesCenterLongitudes=_e,this.elevatedGlobeIndexBuffer=s.createIndexBuffer(Ce)}this.elevatedGlobeSegments=ji.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,le/or,0,ve/or,0,0,re,te,0])}prepare(){const s=Object.keys(this.tiles).length!==0;if(this.tileID&&!s)return;const l=this.map.painter.context,h=l.gl;!this._dirty||this.texture instanceof R1||(this.texture?this.texture.update(this.image):(this.texture=new zT(l,this.image,h.RGBA8),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._dirty=!1),s&&this._prepareData(l)}loadTile(s,l){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},l(null)):(s.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(s){const l=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!l)return null;const h=this.elevatedGlobeTrianglesCenterLongitudes;let p=(v=s+180)+360*Math.round((h[0]-v)/360);var v;const x=new ji,P=(U,W)=>{x.segments.push({vertexOffset:0,primitiveOffset:U,vertexLength:l.segments[0].vertexLength,primitiveLength:W,sortKey:void 0,vaos:{}})},I=.51*this.maxLongitudeTriangleSize;if(Math.abs(h[0]-p)<=I){const U=Ho(h,0,h.length,p+I);return U===h.length||P(U,Ki(h,U+1,h.length,p+360-I)-U),x}p<h[0]&&(p+=360);const R=Ki(h,0,h.length,p-I);if(R===h.length)return P(0,h.length),x;P(0,R-0);const $=Ho(h,R+1,h.length,p+I);return $!==h.length&&P($,h.length-$),x}}const Qte=(Math.pow(256,2)-1)/16907520;class _z extends To{constructor(s,l,h,p){super(s,{layout:mz||(mz=new qi({visibility:new er(ft.layout_raster.visibility)})),paint:gz||(gz=new qi({"raster-opacity":new er(ft.paint_raster["raster-opacity"]),"raster-color":new $s(ft.paint_raster["raster-color"]),"raster-color-mix":new er(ft.paint_raster["raster-color-mix"]),"raster-color-range":new er(ft.paint_raster["raster-color-range"]),"raster-hue-rotate":new er(ft.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new er(ft.paint_raster["raster-brightness-min"]),"raster-brightness-max":new er(ft.paint_raster["raster-brightness-max"]),"raster-saturation":new er(ft.paint_raster["raster-saturation"]),"raster-contrast":new er(ft.paint_raster["raster-contrast"]),"raster-resampling":new er(ft.paint_raster["raster-resampling"]),"raster-fade-duration":new er(ft.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new er(ft.paint_raster["raster-emissive-strength"]),"raster-array-band":new er(ft.paint_raster["raster-array-band"]),"raster-elevation":new er(ft.paint_raster["raster-elevation"]),"raster-color-use-theme":new br({type:"string",default:"default","property-type":"data-driven"})}))},l,h,p),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(s){return!(s&&s._source instanceof vz&&(s._source.onNorthPole||s._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(s){s!=="raster-color"&&s!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(s){if(!this.hasColorMap()||!this._curRampRange)return;const l=this._transitionablePaint._values["raster-color"].value.expression,[h,p]=s||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(h)&&isNaN(p)||h===this._curRampRange[0]&&p===this._curRampRange[1]||(this.colorRamp=Nn({expression:l,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:h,end:p}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[h,p])}}let xz,bz,wz,Sz,Ez;class Tz extends To{constructor(s,l,h,p){super(s,{layout:xz||(xz=new qi({visibility:new er(ft["layout_raster-particle"].visibility)})),paint:bz||(bz=new qi({"raster-particle-array-band":new er(ft["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new er(ft["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new $s(ft["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new er(ft["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new er(ft["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new er(ft["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new er(ft["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new er(ft["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new br({type:"string",default:"default","property-type":"data-driven"})}))},l,h,p),this._updateColorRamp(),this.lastInvalidatedAt=Ia.now()}onRemove(s){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(s){return!1}_handleSpecialPaintPropertyUpdate(s){s!=="raster-particle-color"&&s!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),s==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const s=this._transitionablePaint._values["raster-particle-color"].value.expression,l=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Nn({expression:s,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:l}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Ia.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class ere extends To{constructor(s,l){super(s,{},l,null),this.implementation=s,s.slot&&(this.slot=s.slot)}is3D(s){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(s){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(s){this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)}onRemove(s){this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)}}function FT(c,s,l){const h=[0,0,1],p=un([]);return vi(p,p,l?-ae(c)+Math.PI:ae(c)),Fn(p,p,-ae(s)),ur(h,h,p),Ve(h,h)}function Cz(c,s){const l=N1(c.projection,c.zoom,c.width,c.height),h=function(v,x,P,I,R){const $=new he(P.lng-180*wm,P.lat),U=new he(P.lng+180*wm,P.lat),W=v.project($.lng,$.lat),te=v.project(U.lng,U.lat),re=-Math.atan2(te.y-W.y,te.x-W.x),le=gt.fromLngLat(P);le.y=rt(le.y,-1+wm,1-wm);const ve=le.toLngLat(),_e=v.project(ve.lng,ve.lat),Ce=gt.fromLngLat(ve);Ce.x+=wm;const Ee=Ce.toLngLat(),ue=v.project(Ee.lng,Ee.lat),we=Pz(ue.x-_e.x,ue.y-_e.y,re),Te=gt.fromLngLat(ve);Te.y+=wm;const Ie=Te.toLngLat(),Ge=v.project(Ie.lng,Ie.lat),Qe=Pz(Ge.x-_e.x,Ge.y-_e.y,re),it=Math.abs(we.x)/Math.abs(Qe.y),ct=O([]);Y(ct,ct,-re*(1-(R?0:I)));const St=O([]);return Z(St,St,[1,1-(1-it)*I,1]),St[4]=-Qe.x/Qe.y*I,Y(St,St,re),V(St,ct,St),St}(c.projection,0,c.center,l,s),p=Az(c);return Z(h,h,[p,p,1]),h}function Az(c){const s=c.projection,l=N1(c.projection,c.zoom,c.width,c.height),h=BT(s,c.center),p=BT(s,he.convert(s.center));return Math.pow(2,h*l+(1-l)*p)}function N1(c,s,l,h,p=1/0){const v=c.range;if(!v)return 0;const x=Math.min(p,Math.max(l,h)),P=Math.log(x/1024)/Math.LN2;return nt(v[0]+P,v[1]+P,s)}const wm=1/4e4;function BT(c,s){const l=rt(s.lat,-85.051129,ut),h=new he(s.lng-180*wm,l),p=new he(s.lng+180*wm,l),v=c.project(h.lng,l),x=c.project(p.lng,l),P=gt.fromLngLat(h),I=gt.fromLngLat(p),R=x.x-v.x,$=x.y-v.y,U=I.x-P.x,W=I.y-P.y,te=Math.sqrt((U*U+W*W)/(R*R+$*$));return Math.log(te)/Math.LN2}function Pz(c,s,l){const h=Math.cos(l),p=Math.sin(l);return{x:c*h-s*p,y:c*p+s*h}}function Mz(c,s,l){O(c),Y(c,c,ae(s[2])),J(c,c,ae(s[0])),G(c,c,ae(s[1])),Z(c,c,l),V(c,c,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function z1(c,s,l,h,p,v,x,P){const I=[l[0]-s[0],l[1]-s[1],0],R=[h[0]-s[0],h[1]-s[1],0];if(ze(I)<1e-12||ze(R)<1e-12)return un(c);const $=kt([],I,R);Ve($,$),tt(R,h,s),I[2]=(v-p)*P,R[2]=(x-p)*P;const U=I;return kt(U,I,R),Ve(U,U),js(c,$,U)}function $T(c,s,l=!1){const h=Zh(s.zoom),p=function(v,x,P){const I=x.worldSize,R=[v[12],v[13],v[14]],$=Ze(R[1]/I),U=qe(R[0]/I),W=O([]),te=ke(1,$)*I,re=ke(1,0)*I*Mt($,x.zoom),le=1/gm(I);let ve=re*le;if(P){const ue=N1(x.projection,x.zoom,x.width,x.height,1024);ve=le*x.projection.pixelSpaceConversion(x.center.lat,I,ue)}const _e=fe($,U);Je(_e,_e,Ue([],Ve([],_e),te*ve*R[2]));const Ce=function(ue){const we=[ue[0],ue[1],ue[2]];let Te=[0,1,0];const Ie=kt([],Te,we);return kt(Te,we,Ie),lt(Te)===0&&(Te=[0,1,0],kt(Ie,we,Te)),Ve(Ie,Ie),Ve(Te,Te),Ve(we,we),[Ie[0],Ie[1],Ie[2],0,Te[0],Te[1],Te[2],0,we[0],we[1],we[2],0,ue[0],ue[1],ue[2],1]}(_e);Z(W,W,[ve,ve,ve*te]),H(W,W,[-R[0],-R[1],-R[2]]);const Ee=V([],x.globeMatrix,Ce);return V(Ee,Ee,W),V(Ee,Ee,v),Ee}(c,s,l);if(h>0){const v=function(x,P){const I=P.worldSize,R=ke(1,0)*I*Mt(P.center.lat,P.zoom)/gm(I),$=ke(1,P.center.lat)*I,U=O([]);return G(U,U,ae(P.center.lng)),J(U,U,ae(P.center.lat)),H(U,U,[0,0,C]),Z(U,U,[R,R,R*$]),H(U,U,[P.point.x-.5*I,P.point.y-.5*I,0]),V(U,U,x),V(U,P.globeMatrix,U)}(c,s);return function(x,P,I){const R=(re,le,ve)=>{const _e=ze(re),Ce=ze(le),Ee=Bu(re,le,ve);return Ue(Ee,Ee,1/ze(Ee)*Br(_e,Ce,ve))},$=R([x[0],x[1],x[2]],[P[0],P[1],P[2]],I),U=R([x[4],x[5],x[6]],[P[4],P[5],P[6]],I),W=R([x[8],x[9],x[10]],[P[8],P[9],P[10]],I),te=Bu([x[12],x[13],x[14]],[P[12],P[13],P[14]],I);return[$[0],$[1],$[2],0,U[0],U[1],U[2],0,W[0],W[1],W[2],0,te[0],te[1],te[2],1]}(p,v,h)}return p}function Iz(c,s,l,h){const p=Mi.projectAabbCorners(h,l);let v=Number.MAX_VALUE,x=-1;for(let R=0;R<p.length;++R){const $=p[R];$[0]=(.5*$[0]+.5)*s.width,$[1]=(.5-.5*$[1])*s.height,$[2]<v&&(x=R,v=$[2])}const P=R=>new Qt(p[R][0],p[R][1]);let I;switch(x){case 0:case 6:I=[P(1),P(5),P(4),P(7),P(3),P(2),P(1)];break;case 1:case 7:I=[P(0),P(4),P(5),P(6),P(2),P(3),P(0)];break;case 3:case 5:I=[P(1),P(0),P(4),P(7),P(6),P(2),P(1)];break;default:I=[P(1),P(5),P(6),P(7),P(3),P(0),P(1)]}if(jr(c,I))return v}const tre=qn([{name:"a_pos_3f",components:3,type:"Float32"}]),rre=qn([{name:"a_color_3f",components:3,type:"Float32"}]),nre=qn([{name:"a_color_4f",components:4,type:"Float32"}]),ire=qn([{name:"a_uv_2f",components:2,type:"Float32"}]),sre=qn([{name:"a_normal_3f",components:3,type:"Float32"}]),ore=qn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),are=qn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),kz={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class F1{constructor(s,l,h,p){this.message=(s?`${s}: `:"")+h,p&&(this.identifier=p),l!=null&&l.__line__&&(this.line=l.__line__)}}function VT(c,s){const l=c.indexOf("://")===-1;try{return new URL(c,l&&s?"http://example.com":void 0),!0}catch{return!1}}class Oz{constructor(s,l){this.feature=s,this.instancedDataOffset=l,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Lz{constructor(){this.instancedDataArray=new fo,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class UT{constructor(s){this.zoom=s.zoom,this.canonical=s.canonical,this.layers=s.layers,this.layerIds=this.layers.map(l=>l.fqid),this.projection=s.projection,this.index=s.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=s.styleDefinedModelURLs}updateFootprints(s,l){}populate(s,l,h,p){this.tileToMeter=at(h);const v=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:x,id:P,index:I,sourceLayerIndex:R}of s){const $=P??(x.properties&&x.properties.hasOwnProperty("id")?x.properties.id:void 0),U=Ar(x,v);if(!this.layers[0]._featureFilter.filter(new ni(this.zoom),U,h))continue;const W={id:$,sourceLayerIndex:R,index:I,geometry:v?U.geometry:wr(x,h,p),properties:x.properties,type:x.type,patterns:{}},te=this.addFeature(W,W.geometry,U);te&&l.featureIndex.insert(x,W.geometry,I,R,this.index,this.instancesPerModel[te].instancedDataArray.length,or/32)}this.lookup=null}update(s,l,h,p){for(const v in this.instancesPerModel){const x=this.instancesPerModel[v];for(const P in s)x.idToFeaturesIndex.hasOwnProperty(P)&&(this.evaluate(x.features[x.idToFeaturesIndex[P]],s[P],x,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let s=!1;for(const l in this.instancesPerModel){const h=this.instancesPerModel[l];for(const p of h.features){const v=this.layers[0],x=p.feature,P=this.canonical,I=v.paint.get("model-rotation").evaluate(x,{},P),R=v.paint.get("model-scale").evaluate(x,{},P),$=v.paint.get("model-translation").evaluate(x,{},P);Jt(p.rotation,I)&&Jt(p.scale,R)&&Jt(p.translation,$)||(this.evaluate(p,p.featureStates,h,!0),s=!0)}}return s}updateReplacement(s,l,h,p){if(l.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=l.updateTime;const v=l.getReplacementRegionsForTile(s.toUnwrapped(),!0);if(hT(this.activeReplacements,v))return!1;this.activeReplacements=v;let x=!1;for(const P in this.instancesPerModel){const I=this.instancesPerModel[P],R=I.instancedDataArray;for(const $ of I.features){const U=$.instancedDataOffset,W=$.instancedDataCount;for(let te=0;te<W;te++){const re=16*(te+U);let le=R.float32[re+0];const ve=le>or;le=ve?le-or:le;const _e=Math.floor(le),Ce=R.float32[re+1];let Ee=!1;for(const ue of this.activeReplacements)if(!zN(ue,h,kz.Model,p)&&!(ue.min.x>_e||_e>ue.max.x||ue.min.y>Ce||Ce>ue.max.y)&&(Ee=qN(UN(_e,Ce,s.canonical,ue.footprintTileId.canonical),ue.footprint),Ee))break;R.float32[re]=Ee?le+or:le,x=x||Ee!==ve}}}return x}isEmpty(){for(const s in this.instancesPerModel)if(this.instancesPerModel[s].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(s){if(!this.uploaded)for(const l in this.instancesPerModel){const h=this.instancesPerModel[l];h.instancedDataArray.length<0||h.instancedDataArray.length===0||(h.instancedDataBuffer?h.instancedDataBuffer.updateData(h.instancedDataArray):h.instancedDataBuffer=s.createVertexBuffer(h.instancedDataArray,ore.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const l in this.instancesPerModel){const h=this.instancesPerModel[l];h.instancedDataArray.length!==0&&h.instancedDataBuffer&&h.instancedDataBuffer.destroy()}const s=this.layers[0].modelManager;if(s&&this.modelUris&&this.modelsRequested)for(const l of this.modelUris)s.removeModel(l,"",!0)}addFeature(s,l,h){const p=this.layers[0],v=p.layout.get("model-id").evaluate(h,{},this.canonical);if(!v)return sn(`modelId is not evaluated for layer ${p.id} and it is not going to get rendered.`),v;(VT(v,!1)||this.styleDefinedModelURLs[v]!==void 0)&&(this.modelUris.includes(v)||this.modelUris.push(v)),this.instancesPerModel[v]||(this.instancesPerModel[v]=new Lz);const x=this.instancesPerModel[v],P=x.instancedDataArray,I=new Oz(h,P.length);for(const R of l)for(const $ of R){if($.x<0||$.x>=or||$.y<0||$.y>=or)continue;const U=(this.lookupDim-1)/or,W=this.lookupDim*($.y*U|0)+$.x*U|0;if(this.lookup){if(this.lookup[W]!==0)continue;this.lookup[W]=1}this.instanceCount++;const te=P.length;P.resize(te+1),x.instancesEvaluatedElevation.push(0),P.float32[16*te]=$.x,P.float32[16*te+1]=$.y}return I.instancedDataCount=x.instancedDataArray.length-I.instancedDataOffset,I.instancedDataCount>0&&(s.id&&(x.idToFeaturesIndex[s.id]=x.features.length),x.features.push(I),this.evaluate(I,{},x,!1)),v}getModelUris(){return this.modelUris}evaluate(s,l,h,p){const v=this.layers[0],x=s.feature,P=this.canonical,I=s.rotation=v.paint.get("model-rotation").evaluate(x,l,P),R=s.scale=v.paint.get("model-scale").evaluate(x,l,P),$=s.translation=v.paint.get("model-translation").evaluate(x,l,P),U=v.paint.get("model-color").evaluate(x,l,P);U.a=v.paint.get("model-color-mix-intensity").evaluate(x,l,P);const W=[];this.maxVerticalOffset<$[2]&&(this.maxVerticalOffset=$[2]),this.maxScale=Math.max(Math.max(this.maxScale,R[0]),Math.max(R[1],R[2])),Mz(W,I,R);const te=Math.round(100*U.a)+U.b/1.05;for(let re=0;re<s.instancedDataCount;++re){const le=s.instancedDataOffset+re,ve=16*le,_e=h.instancedDataArray.float32;let Ce=0;p&&(Ce=_e[ve+6]-h.instancesEvaluatedElevation[le]);const Ee=0|_e[ve+1];_e[ve]=(0|_e[ve])+U.r/1.05,_e[ve+1]=Ee+U.g/1.05,_e[ve+2]=te,_e[ve+3]=1/(P.z>10?this.tileToMeter:at(P,Ee)),_e[ve+4]=$[0],_e[ve+5]=$[1],_e[ve+6]=$[2]+Ce,_e[ve+7]=W[0],_e[ve+8]=W[1],_e[ve+9]=W[2],_e[ve+10]=W[4],_e[ve+11]=W[5],_e[ve+12]=W[6],_e[ve+13]=W[8],_e[ve+14]=W[9],_e[ve+15]=W[10],h.instancesEvaluatedElevation[le]=$[2]}}}let Rz,jz;yr(UT,"ModelBucket",{omit:["layers"]}),yr(Lz,"PerModelAttributes"),yr(Oz,"ModelFeature");const Wg=64,nv={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Dz(c,s,l,h,p,v,x,P,I,R=!1){const $=l.zoom,U=l.project(h),W=Mt(h.lat,$),te=1/W;O(c),H(c,c,[U.x+x[0]*te,U.y+x[1]*te,x[2]]);let re=1,le=1;const ve=l.worldSize;if(R){if(l.projection.name==="mercator"){let ue=0;l.elevation&&(ue=l.elevation.getAtPointOrZero(new gt(U.x/ve,U.y/ve),0));const we=$r([],[U.x,U.y,ue,1],l.projMatrix)[3]/l.cameraToCenterDistance;re=we,le=we*Mt(l.center.lat,$)}else if(l.projection.name==="globe"){const ue=$T(c,l),we=[0,0,0,1];$r(we,we,V([],l.projMatrix,ue));const Te=we[3]/l.cameraToCenterDistance,Ie=Zh($),Ge=l.projection.pixelsPerMeter(h.lat,ve)*Mt(h.lat,$),Qe=l.projection.pixelsPerMeter(l.center.lat,ve)*Mt(l.center.lat,$);re=Te/Br(Ge,At(l.center.lat),Ie),le=Te*W/Ge,re*=Qe,le*=Qe}}else re=te;Z(c,c,[re,re,le]);const _e=[...c],Ce=s.orientation,Ee=[];if(Mz(Ee,[Ce[0]+p[0],Ce[1]+p[1],Ce[2]+p[2]],v),V(c,_e,Ee),P&&l.elevation){let ue=0;const we=[];if(I&&l.elevation){ue=function(Ie,Ge,Qe,it,ct){const St=Ge.elevation;if(!St)return 0;const Vt=Mi.projectAabbCorners(Qe,it),Nt=ke(1,ct.lat)*Ge.worldSize,Bt=function(Kt,tn){const Pr=[0,0,1],Mr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Kr of Mr){const dn=Kt[Kr.corners[0]],mn=Kt[Kr.corners[1]],An=Kt[Kr.corners[2]],bn=[mn[0]-dn[0],mn[1]-dn[1],tn*(mn[2]-dn[2])],yn=kt(bn,bn,[An[0]-dn[0],An[1]-dn[1],tn*(An[2]-dn[2])]);Ve(yn,yn),Kr.dotProductWithUp=Et(yn,Pr)}return Mr.sort((Kr,dn)=>Kr.dotProductWithUp-dn.dotProductWithUp),Mr[0].corners}(Vt,Nt),Xt=Vt[Bt[0]],xt=Vt[Bt[1]],Ft=Vt[Bt[2]],_t=Vt[Bt[3]],wt=St.getAtPointOrZero(new gt(Xt[0]/Ge.worldSize,Xt[1]/Ge.worldSize),0),Yt=St.getAtPointOrZero(new gt(xt[0]/Ge.worldSize,xt[1]/Ge.worldSize),0),tr=St.getAtPointOrZero(new gt(Ft[0]/Ge.worldSize,Ft[1]/Ge.worldSize),0),Or=St.getAtPointOrZero(new gt(_t[0]/Ge.worldSize,_t[1]/Ge.worldSize),0),Tr=(wt+Or)/2,hr=(Yt+tr)/2;return Tr>hr?Yt<tr?z1(Ie,xt,_t,Xt,Yt,Or,wt,Nt):z1(Ie,Ft,Xt,_t,tr,wt,Or,Nt):wt<Or?z1(Ie,Xt,xt,Ft,wt,Yt,tr,Nt):z1(Ie,_t,Ft,xt,Or,tr,Yt,Nt),Math.max(Tr,hr)}(we,l,s.aabb,c,h);const Te=V([],ge([],we),Ee);V(c,_e,Te)}else ue=l.elevation.getAtPointOrZero(new gt(U.x/ve,U.y/ve),0);ue!==0&&(c[14]+=ue)}}function w0(c,s,l=!1){c.uploaded||(c.gfxTexture=new zT(s,c.image,l?s.gl.R8:s.gl.RGBA8,{useMipmap:c.sampler.minFilter>=s.gl.NEAREST_MIPMAP_NEAREST}),c.uploaded=!0,c.image=null)}function lre(c,s,l){c.indexBuffer=s.createIndexBuffer(c.indexArray,!1,!0),c.vertexBuffer=s.createVertexBuffer(c.vertexArray,tre.members,!1,!0),c.normalArray&&(c.normalBuffer=s.createVertexBuffer(c.normalArray,sre.members,!1,!0)),c.texcoordArray&&(c.texcoordBuffer=s.createVertexBuffer(c.texcoordArray,ire.members,!1,!0)),c.colorArray&&(c.colorBuffer=s.createVertexBuffer(c.colorArray,(c.colorArray.bytesPerElement===12?rre:nre).members,!1,!0)),c.featureArray&&(c.pbrBuffer=s.createVertexBuffer(c.featureArray,are.members,!0)),c.segments=ji.simpleSegment(0,0,c.vertexArray.length,c.indexArray.length);const h=c.material;h.pbrMetallicRoughness.baseColorTexture&&w0(h.pbrMetallicRoughness.baseColorTexture,s),h.pbrMetallicRoughness.metallicRoughnessTexture&&w0(h.pbrMetallicRoughness.metallicRoughnessTexture,s),h.normalTexture&&w0(h.normalTexture,s),h.occlusionTexture&&w0(h.occlusionTexture,s,l),h.emissionTexture&&w0(h.emissionTexture,s)}function qT(c,s,l){if(c.meshes)for(const h of c.meshes)lre(h,s,l);if(c.children)for(const h of c.children)qT(h,s,l)}function B1(c){if(c.meshes)for(const s of c.meshes)s.indexArray.destroy(),s.vertexArray.destroy(),s.colorArray&&s.colorArray.destroy(),s.normalArray&&s.normalArray.destroy(),s.texcoordArray&&s.texcoordArray.destroy(),s.featureArray&&s.featureArray.destroy();if(c.children)for(const s of c.children)B1(s)}function GT(c){if(c.meshes)for(const l of c.meshes)l.vertexBuffer&&(l.vertexBuffer.destroy(),l.indexBuffer.destroy(),l.normalBuffer&&l.normalBuffer.destroy(),l.texcoordBuffer&&l.texcoordBuffer.destroy(),l.colorBuffer&&l.colorBuffer.destroy(),l.pbrBuffer&&l.pbrBuffer.destroy(),l.segments.destroy(),l.material&&((s=l.material).pbrMetallicRoughness.baseColorTexture&&s.pbrMetallicRoughness.baseColorTexture.gfxTexture&&s.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),s.pbrMetallicRoughness.metallicRoughnessTexture&&s.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&s.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),s.normalTexture&&s.normalTexture.gfxTexture&&s.normalTexture.gfxTexture.destroy(),s.emissionTexture&&s.emissionTexture.gfxTexture&&s.emissionTexture.gfxTexture.destroy(),s.occlusionTexture&&s.occlusionTexture.gfxTexture&&s.occlusionTexture.gfxTexture.destroy()));var s;if(c.children)for(const l of c.children)GT(l)}class iv{constructor(s,l,h){this._demTile=s,this._dem=this._demTile.dem,this._scale=l,this._offset=h}static create(s,l,h){const p=h||s.findDEMTileFor(l);if(!p||!p.dem)return;const v=p.dem,x=p.tileID,P=1<<l.canonical.z-x.canonical.z;return new iv(p,v.dim/or/P,[(l.canonical.x/P-x.canonical.x)*v.dim,(l.canonical.y/P-x.canonical.y)*v.dim])}tileCoordToPixel(s,l){const h=l*this._scale+this._offset[1],p=Math.floor(s*this._scale+this._offset[0]),v=Math.floor(h);return new Qt(p,v)}getElevationAt(s,l,h,p){const v=s*this._scale+this._offset[0],x=l*this._scale+this._offset[1],P=Math.floor(v),I=Math.floor(x),R=this._dem;return p=!!p,h?Br(Br(R.get(P,I,p),R.get(P,I+1,p),x-I),Br(R.get(P+1,I,p),R.get(P+1,I+1,p),x-I),v-P):R.get(P,I,p)}getElevationAtPixel(s,l,h){return this._dem.get(s,l,!!h)}getMeterToDEM(s){return(1<<this._demTile.tileID.canonical.z)*ke(1,s)*this._dem.stride}}const HT=new Float32Array(262144),Zg=new Uint8Array(262144);function Nz(c){let s=0;if(c.meshes)for(const l of c.meshes)s=Math.max(s,l.aabb.max[2]);if(c.children)for(const l of c.children)s=Math.max(s,Nz(l));return s}function zz(c,s,l){if(c.meshes)for(const h of c.meshes){if(h.aabb.min[0]===1/0)continue;const p=Mi.applyTransform(h.aabb,c.matrix);l.insert(s,p.min[0],p.min[1],p.max[0],p.max[1])}if(c.children)for(const h of c.children)zz(h,s,l)}const Fz=["","wall","door","roof","window","lamp","logo"];class Bz{constructor(s){this.node=s,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:s.id,geometry:[],properties:{height:Nz(s)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Mi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let s=0;const l=new Mi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const h of this.node.meshes)this.node.lightMeshIndex!==s&&(h.transformedAabb=Mi.applyTransformFast(h.aabb,this.node.matrix),l.encapsulate(h.transformedAabb)),s++;this.aabb=l}return this.aabb}}class $1{constructor(s,l,h,p,v,x,P){this.id=h,this.layers=s,this.layerIds=this.layers.map(I=>I.fqid),this.stateDependentLayerIds=this.layers.filter(I=>I.isStateDependent()).map(I=>I.id),this.modelTraits|=nv.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,p&&(this.modelTraits|=nv.HasMapboxMeshFeatures),v&&(this.modelTraits|=nv.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=x,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const I of l)this.nodesInfo.push(new Bz(I)),zz(I,P.featureIndexArray.length,P.grid),P.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,P.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(s,l){for(const h of this.getNodesInfo()){const p=h.node;p.footprint&&l.push({footprint:p.footprint,id:s})}}update(s){const l=Object.keys(s).length!==0;if(l&&!this.stateDependentLayers.length)return;const h=l?this.stateDependentLayers:this.layers;if(!Hs(s,this.states))for(const p of h)this.evaluate(p,s);this.states=structuredClone(s)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(s){if(!this.needsUpload)return;const l=this.getNodesInfo();for(const h of l){const p=h.node;this.uploaded?this.updatePbrBuffer(p):qT(p,s,!0)}for(const h of l)B1(h.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(s){let l=!1;if(!s.meshes)return l;for(const h of s.meshes)h.pbrBuffer&&(h.pbrBuffer.updateData(h.featureArray),l=!0);return l}needsReEvaluation(s,l,h){const p=s.transform.projectionOptions,v=s.style.getBrightness(),x=this.brightness!==v;if(!this.uploaded||this.dirty||p.name!==this.projection.name||S0(h.paint.get("model-color").value,x)||S0(h.paint.get("model-color-mix-intensity").value,x)||S0(h.paint.get("model-roughness").value,x)||S0(h.paint.get("model-emissive-strength").value,x)||S0(h.paint.get("model-height-based-emissive-strength-multiplier").value,x)){this.projection=p,this.brightness=v;const P=this.getNodesInfo();for(const I of P)I.state=null;return!0}return!1}evaluateScale(s,l){if(s.transform.zoom===this.zoom)return;this.zoom=s.transform.zoom;const h=this.getNodesInfo(),p=this.id.canonical;for(const v of h){const x=v.feature;v.evaluatedScale=l.paint.get("model-scale").evaluate(x,{},p)}}evaluate(s,l){const h=this.getNodesInfo();for(const p of h){if(!p.node.meshes)continue;const v=p.feature,x=l&&l[v.id];if(Hs(x,p.state))continue;p.state=structuredClone(x);const P=p.node.meshes&&p.node.meshes[0].featureData,I=p.evaluatedColor[2],R=p.evaluatedRMEA[2],$=this.id.canonical;if(p.hasTranslucentParts=!1,P){for(let U=0;U<Fz.length;U++){const W=Fz[U];W.length&&(v.properties.part=W);const te=s.paint.get("model-color").evaluate(v,x,$).toRenderColor(null),re=s.paint.get("model-color-mix-intensity").evaluate(v,x,$);p.evaluatedColor[U]=[te.r,te.g,te.b,re],p.evaluatedRMEA[U][0]=s.paint.get("model-roughness").evaluate(v,x,$),p.evaluatedRMEA[U][2]=s.paint.get("model-emissive-strength").evaluate(v,x,$),p.evaluatedRMEA[U][3]=te.a,p.emissionHeightBasedParams[U]=s.paint.get("model-height-based-emissive-strength-multiplier").evaluate(v,x,$),!p.hasTranslucentParts&&te.a<1&&(p.hasTranslucentParts=!0)}delete v.properties.part,ure(p,I!==p.evaluatedColor[2]||R!==p.evaluatedRMEA[2],this.modelTraits)}else p.evaluatedRMEA[0][2]=s.paint.get("model-emissive-strength").evaluate(v,x,$);p.evaluatedScale=s.paint.get("model-scale").evaluate(v,x,$),this.updatePbrBuffer(p.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(s,l,h,p){const v=s.findDEMTileFor(h);if(v&&(v.tileID.canonical!==this.terrainTile||l!==this.terrainExaggeration)){if(v.dem&&v.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=v.tileID.overscaledZ;const x=iv.create(s,h,v);if(!x)return;this.modelTraits&nv.HasMapboxMeshFeatures&&this.updateDEM(s,x,h,p);for(const P of this.getNodesInfo()){const I=P.node;if(!I.footprint||!I.footprint.vertices||!I.footprint.vertices.length)continue;const R=I.footprint.vertices;let $=x.getElevationAt(R[0].x,R[0].y,!0,!0);for(let U=1;U<R.length;U++)$=Math.min($,x.getElevationAt(R[U].x,R[U].y,!0,!0));I.elevation=$}}this.terrainTile=v.tileID.canonical,this.terrainExaggeration=l}}updateDEM(s,l,h,p){let v=l._dem._modifiedForSources[p];if(v===void 0&&(l._dem._modifiedForSources[p]=[],v=l._dem._modifiedForSources[p]),v.includes(h.canonical))return;const x=l._dem.dim;v.push(h.canonical);let P=!1;for(const I of this.getNodesInfo()){const R=I.node;if(!R.footprint||!R.footprint.grid)continue;const $=R.footprint.grid,U=l.tileCoordToPixel($.min.x,$.min.y),W=l.tileCoordToPixel($.max.x,$.max.y),te=Math.min(Math.min(x-W.y,U.x),Math.min(U.y,x-W.x));if(te<0)continue;const re=rt(te,2,5);let le=Math.max(0,U.x-re),ve=Math.max(0,U.y-re),_e=Math.min(W.x+re,x-1),Ce=Math.min(W.y+re,x-1);for(let Te=ve;Te<=Ce;++Te)for(let Ie=le;Ie<=_e;++Ie)Zg[Te*x+Ie]=255;let Ee=0,ue=0;for(let Te=0;Te<$.cellsY;++Te)for(let Ie=0;Ie<$.cellsX;++Ie){if(!$.cells[Te*$.cellsX+Ie])continue;const Ge=l.tileCoordToPixel($.min.x+Ie/$.xScale,$.min.y+Te/$.yScale),Qe=l.tileCoordToPixel($.min.x+(Ie+1)/$.xScale,$.min.y+(Te+1)/$.yScale);for(let it=Ge.y;it<=Math.min(Qe.y+1,x-1);++it)for(let ct=Ge.x;ct<=Math.min(Qe.x+1,x-1);++ct)Zg[it*x+ct]===255&&(Zg[it*x+ct]=0,Ee+=l.getElevationAtPixel(ct,it),ue++)}const we=Ee/ue;le=Math.max(1,U.x-re),ve=Math.max(1,U.y-re),_e=Math.min(W.x+re,x-2),Ce=Math.min(W.y+re,x-2),P=!0;for(let Te=ve;Te<=Ce;++Te)for(let Ie=le;Ie<=_e;++Ie)Zg[Te*x+Ie]===0&&(HT[Te*x+Ie]=l._dem.set(Ie,Te,we));for(let Te=1;Te<re;++Te){le=Math.max(1,U.x-Te),ve=Math.max(1,U.y-Te),_e=Math.min(W.x+Te,x-2),Ce=Math.min(W.y+Te,x-2);for(let Ie=ve;Ie<=Ce;++Ie)for(let Ge=le;Ge<=_e;++Ge){const Qe=Ie*x+Ge;if(Zg[Qe]===255){let it=0,ct=0,St=-1,Vt=-1;for(let Nt=-1;Nt<=1;++Nt)for(let Bt=-1;Bt<=1;++Bt){const Xt=(Ie+Nt)*x+Ge+Bt;if(Zg[Xt]>=Te)continue;const xt=HT[Xt],Ft=Math.abs(xt);Ft>ct&&(it=xt,ct=Ft,St=Bt,Vt=Nt)}if(ct>.1){const Nt=1-(Te+.5*Math.abs(St*Vt))/re;let Bt=l._dem.get(Ge,Ie)+it*Nt;const Xt=l._dem.get(Ge+St,Ie+Vt),xt=l._dem.get(Ge-St,Ie-Vt,!0);(Bt-Xt)*(Bt-xt)>0&&(Bt=(Xt+xt)/2),HT[Qe]=l._dem.set(Ge,Ie,Bt),Zg[Qe]=Te}}}}}P&&(l._demTile.needsDEMTextureUpload=!0,l._dem._timestamp=Ia.now())}setFilter(s){this.filter=s?kd(s):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(s=>this.filter.filter(new ni(this.id.overscaledZ),s.feature,this.id.canonical)):this.nodesInfo}destroy(){const s=this.getNodesInfo();for(const l of s)B1(l.node),GT(l.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(s,l){if(l.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=l.updateTime;const h=l.getReplacementRegionsForTile(s.toUnwrapped()),p=this.getNodesInfo();for(let v=0;v<this.nodesInfo.length;v++){const x=p[v].node;p[v].hiddenByReplacement=!!x.footprint&&!h.find(P=>P.footprint===x.footprint)}}getHeightAtTileCoord(s,l){const h=this.getNodesInfo(),p=[],v=[0,0,0],x=O([]);for(let P=0;P<this.nodesInfo.length;P++){const I=h[P],R=I.node.meshes[0],$=R.transformedAabb;if(s<$.min[0]||l<$.min[1]||s>$.max[0]||l>$.max[1])continue;if(I.node.hidden===!0)return{height:1/0,maxHeight:I.feature.properties.height,hidden:!1,verticalScale:I.evaluatedScale[2]};N(x,I.node.matrix),v[0]=s,v[1]=l,Tt(v,v,x);const U=(v[0]-R.aabb.min[0])/(R.aabb.max[0]-R.aabb.min[0])*Wg|0,W=Math.min(63,(v[1]-R.aabb.min[1])/(R.aabb.max[1]-R.aabb.min[1])*Wg|0)*Wg+Math.min(63,U),te=R.heightmap[W];if(!(te<0&&I.node.footprint))return I.hiddenByReplacement?void 0:{height:te,maxHeight:I.feature.properties.height,hidden:!1,verticalScale:I.evaluatedScale[2]};if(I.node.footprint.grid.query(new Qt(s,l),new Qt(s,l),p),p.length>0)return{height:void 0,maxHeight:I.feature.properties.height,hidden:I.hiddenByReplacement,verticalScale:I.evaluatedScale[2]}}}}function S0(c,s){return c instanceof Cu&&!c.isLightConstant&&s}function cre(c,s,l,h,p,v,x,P){let I=(61440&s|(61440&s)>>4)>>8,R=(3840&s|(3840&s)>>4)>>4,$=240&s|(240&s)>>4;l[3]>0&&(I=Br(I,255*l[0],l[3]),R=Br(R,255*l[1],l[3]),$=Br($,255*l[2],l[3]));const U=I<<8|R,W=$<<8|Math.floor(255*h[3]),te=function(Te){const Ie=rt(Te,0,2);return Math.min(Math.round(.5*Ie*255),255)}(h[2])<<8|15*h[0]<<4|15*h[1],re=rt(p[0],0,1),le=rt(p[1],0,1),ve=rt(p[2],0,1),_e=rt(p[3],0,1);let Ce,Ee,ue,we;if(re!==le&&x!==v&&le!==re){const Te=x-v;Ee=1/(Te*(le-re)),ue=-(v+Te*re)/(Te*(le-re));const Ie=rt(p[4],-1,1);we=Math.pow(10,Ie),Ce=255*ve<<8|255*_e}else Ce=65535,Ee=0,ue=1,we=1;if(c.emplaceBack(U,W,te,Ce,Ee,ue,we),P){const Te=P.length;P.clear();for(let Ie=0;Ie<Te;Ie++)P.emplaceBack(U,W,te,Ce,Ee,ue,we)}}function ure(c,s,l){const h=c.node;let p=0;const v=l&nv.HasMeshoptCompression;for(const x of h.meshes){if(h.lights&&h.lightMeshIndex===p||!x.featureData)continue;x.featureArray=new po,x.featureArray.reserve(x.featureData.length);let P=s;for(const I of x.featureData){const R=v?65535&I:I>>16&65535,$=v?I>>16&65535:65535&I,U=(15&$)<8?15&$:0,W=c.evaluatedRMEA[U],te=c.evaluatedColor[U],re=c.emissionHeightBasedParams[U];let le;if(P&&U===2&&h.lights&&(le=new po,le.resize(10*h.lights.length)),cre(x.featureArray,R,te,W,re,x.aabb.min[2],x.aabb.max[2],le),le&&P){P=!1;const ve=h.meshes[h.lightMeshIndex];ve.featureArray=le,ve.featureArray._trim()}}x.featureArray._trim(),p++}}function $z(c,s,l,h){const p=1<<c.z;s.lat=Ze((h/or+c.y)/p),s.lng=qe((l/or+c.x)/p)}yr($1,"Tiled3dModelBucket",{omit:["layers"]}),yr(Bz,"Tiled3dModelFeature");const dre={circle:class extends To{constructor(c,s,l,h){super(c,{layout:Zn||(Zn=new qi({"circle-sort-key":new br(ft.layout_circle["circle-sort-key"]),"circle-elevation-reference":new er(ft.layout_circle["circle-elevation-reference"]),visibility:new er(ft.layout_circle.visibility)})),paint:pi||(pi=new qi({"circle-radius":new br(ft.paint_circle["circle-radius"]),"circle-color":new br(ft.paint_circle["circle-color"]),"circle-blur":new br(ft.paint_circle["circle-blur"]),"circle-opacity":new br(ft.paint_circle["circle-opacity"]),"circle-translate":new er(ft.paint_circle["circle-translate"]),"circle-translate-anchor":new er(ft.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new er(ft.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new er(ft.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new br(ft.paint_circle["circle-stroke-width"]),"circle-stroke-color":new br(ft.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new br(ft.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new er(ft.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new br({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new br({type:"string",default:"default","property-type":"data-driven"})}))},s,l,h)}createBucket(c){return new vr(c)}queryRadius(c){const s=c;return pn("circle-radius",this,s)+pn("circle-stroke-width",this,s)+Si(this.paint.get("circle-translate"))}queryIntersectsFeature(c,s,l,h,p,v,x,P){const I=ci(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),v.angle,c.pixelToTileUnitsFactor),R=this.paint.get("circle-radius").evaluate(s,l)+this.paint.get("circle-stroke-width").evaluate(s,l);return Re(c,h,v,x,P,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",I,R)}getProgramIds(){return["circle"]}getDefaultProgramParams(c,s,l){const h=me(this);return{config:new hc(this,{zoom:s,lut:l}),defines:h,overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends To{createBucket(c){return new Fr(c)}constructor(c,s,l,h){super(c,{layout:Lr||(Lr=new qi({visibility:new er(ft.layout_heatmap.visibility)})),paint:ln||(ln=new qi({"heatmap-radius":new br(ft.paint_heatmap["heatmap-radius"]),"heatmap-weight":new br(ft.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new er(ft.paint_heatmap["heatmap-intensity"]),"heatmap-color":new $s(ft.paint_heatmap["heatmap-color"]),"heatmap-opacity":new er(ft.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new br({type:"string",default:"default","property-type":"data-driven"})}))},s,l,h),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Nn({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(c){return pn("heatmap-radius",this,c)}queryIntersectsFeature(c,s,l,h,p,v,x,P){const I=this.paint.get("heatmap-radius").evaluate(s,l);return Re(c,h,v,x,P,!0,!0,new Qt(0,0),I)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(c,s,l){return c==="heatmap"?{config:new hc(this,{zoom:s,lut:l}),overrideFog:!1}:{}}},hillshade:class extends To{constructor(c,s,l,h){super(c,{layout:xn||(xn=new qi({visibility:new er(ft.layout_hillshade.visibility)})),paint:Cn||(Cn=new qi({"hillshade-illumination-direction":new er(ft.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new er(ft.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new er(ft.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new er(ft.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new er(ft.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new er(ft.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new er(ft.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new br({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new br({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new br({type:"string",default:"default","property-type":"data-driven"})}))},s,l,h)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(c,s,l){return{overrideFog:!1}}},fill:class extends To{constructor(c,s,l,h){super(c,{layout:LN||(LN=new qi({"fill-sort-key":new br(ft.layout_fill["fill-sort-key"]),visibility:new er(ft.layout_fill.visibility),"fill-elevation-reference":new er(ft.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new br(ft.layout_fill["fill-construct-bridge-guard-rail"])})),paint:RN||(RN=new qi({"fill-antialias":new er(ft.paint_fill["fill-antialias"]),"fill-opacity":new br(ft.paint_fill["fill-opacity"]),"fill-color":new br(ft.paint_fill["fill-color"]),"fill-outline-color":new br(ft.paint_fill["fill-outline-color"]),"fill-translate":new er(ft.paint_fill["fill-translate"]),"fill-translate-anchor":new er(ft.paint_fill["fill-translate-anchor"]),"fill-pattern":new br(ft.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new er(ft.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new er(ft.paint_fill["fill-emissive-strength"]),"fill-z-offset":new br(ft.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new br(ft.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new br(ft.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new br({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new br({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new br({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new br({type:"string",default:"default","property-type":"data-driven"})}))},s,l,h)}getProgramIds(){const c=this.paint.get("fill-pattern"),s=c&&c.constantOr(1),l=[s?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(s&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getDefaultProgramParams(c,s,l){return{config:new hc(this,{zoom:s,lut:l}),overrideFog:!1}}recalculate(c,s){super.recalculate(c,s);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new cT(c)}queryRadius(){return Si(this.paint.get("fill-translate"))}queryIntersectsFeature(c,s,l,h,p,v){return!c.queryGeometry.isAboveHorizon&&_n(zn(c.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),v.angle,c.pixelToTileUnitsFactor),h)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(c){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const s=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return c!=null?s&&!c:s}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends To{constructor(c,s,l,h){super(c,{layout:s3||(s3=new qi({visibility:new er(ft["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new er(ft["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:o3||(o3=new qi({"fill-extrusion-opacity":new er(ft["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new br(ft["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new er(ft["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new er(ft["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new br(ft["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new er(ft["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new br(ft["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new br(ft["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new er(ft["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new er(ft["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new er(ft["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new er(ft["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new er(ft["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new er(ft["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new er(ft["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new er(ft["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new er(ft["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new er(ft["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new br(ft["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new br(ft["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new er(ft["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new er(ft["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new er(ft["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new er(ft["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new br(ft["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new br(ft["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new er(ft["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new br({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new br({type:"string",default:"default","property-type":"data-driven"})}))},s,l,h),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new g1(c)}queryRadius(){return Si(this.paint.get("fill-extrusion-translate"))}is3D(c){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(c,s,l,h,p,v,x,P,I){const R=ci(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),v.angle,c.pixelToTileUnitsFactor),$=this.paint.get("fill-extrusion-height").evaluate(s,l),U=this.paint.get("fill-extrusion-base").evaluate(s,l),W=[0,0],te=P&&v.elevation,re=v.elevation?v.elevation.exaggeration():1,le=c.tile.getBucket(this);if(te&&le instanceof g1){const ue=le.centroidVertexArray,we=I+1;we<ue.length&&(W[0]=ue.geta_centroid_pos0(we),W[1]=ue.geta_centroid_pos1(we))}if(W[0]===0&&W[1]===1)return!1;v.projection.name==="globe"&&(h=i3([h],[new Qt(0,0),new Qt(or,or)],c.tileID.canonical).map(ue=>ue.polygon).flat());const ve=te?P:null,[_e,Ce]=function(ue,we,Te,Ie,Ge,Qe,it,ct,St,Vt,Nt){return ue.projection.name==="globe"?function(Bt,Xt,xt,Ft,_t,wt,Yt,tr,Or,Tr,hr){const Kt=[],tn=[],Pr=Bt.projection.upVectorScale(hr,Bt.center.lat,Bt.worldSize).metersToTile,Mr=[0,0,0,1],Kr=[0,0,0,1],dn=(An,bn,yn,gi)=>{An[0]=bn,An[1]=yn,An[2]=gi,An[3]=1},mn=n3();xt>0&&(xt+=mn),Ft+=mn;for(const An of Xt){const bn=[],yn=[];for(const gi of An){const Ii=gi.x+_t.x,Me=gi.y+_t.y,Oe=Bt.projection.projectTilePoint(Ii,Me,hr),Pt=Bt.projection.upVector(hr,gi.x,gi.y);let ir=xt,pr=Ft;if(Yt){const fr=h3(Ii,Me,xt,Ft,Yt,tr,Or,Tr);ir+=fr.base,pr+=fr.top}xt!==0?dn(Mr,Oe.x+Pt[0]*Pr*ir,Oe.y+Pt[1]*Pr*ir,Oe.z+Pt[2]*Pr*ir):dn(Mr,Oe.x,Oe.y,Oe.z),dn(Kr,Oe.x+Pt[0]*Pr*pr,Oe.y+Pt[1]*Pr*pr,Oe.z+Pt[2]*Pr*pr),Tt(Mr,Mr,wt),Tt(Kr,Kr,wt),bn.push(new qg(Mr[0],Mr[1],Mr[2])),yn.push(new qg(Kr[0],Kr[1],Kr[2]))}Kt.push(bn),tn.push(yn)}return[Kt,tn]}(ue,we,Te,Ie,Ge,Qe,it,ct,St,Vt,Nt):it?function(Bt,Xt,xt,Ft,_t,wt,Yt,tr,Or){const Tr=[],hr=[],Kt=[0,0,0,1];for(const tn of Bt){const Pr=[],Mr=[];for(const Kr of tn){const dn=Kr.x+Ft.x,mn=Kr.y+Ft.y,An=h3(dn,mn,Xt,xt,wt,Yt,tr,Or);Kt[0]=dn,Kt[1]=mn,Kt[2]=An.base,Kt[3]=1,$r(Kt,Kt,_t),Kt[3]=Math.max(Kt[3],1e-5);const bn=new qg(Kt[0]/Kt[3],Kt[1]/Kt[3],Kt[2]/Kt[3]);Kt[0]=dn,Kt[1]=mn,Kt[2]=An.top,Kt[3]=1,$r(Kt,Kt,_t),Kt[3]=Math.max(Kt[3],1e-5);const yn=new qg(Kt[0]/Kt[3],Kt[1]/Kt[3],Kt[2]/Kt[3]);Pr.push(bn),Mr.push(yn)}Tr.push(Pr),hr.push(Mr)}return[Tr,hr]}(we,Te,Ie,Ge,Qe,it,ct,St,Vt):function(Bt,Xt,xt,Ft,_t){const wt=[],Yt=[],tr=_t[8]*Xt,Or=_t[9]*Xt,Tr=_t[10]*Xt,hr=_t[11]*Xt,Kt=_t[8]*xt,tn=_t[9]*xt,Pr=_t[10]*xt,Mr=_t[11]*xt;for(const Kr of Bt){const dn=[],mn=[];for(const An of Kr){const bn=An.x+Ft.x,yn=An.y+Ft.y,gi=_t[0]*bn+_t[4]*yn+_t[12],Ii=_t[1]*bn+_t[5]*yn+_t[13],Me=_t[2]*bn+_t[6]*yn+_t[14],Oe=_t[3]*bn+_t[7]*yn+_t[15],Pt=gi+tr,ir=Ii+Or,pr=Me+Tr,fr=Math.max(Oe+hr,1e-5),Ir=gi+Kt,Wr=Ii+tn,Ln=Me+Pr,Rn=Math.max(Oe+Mr,1e-5);dn.push(new qg(Pt/fr,ir/fr,pr/fr)),mn.push(new qg(Ir/Rn,Wr/Rn,Ln/Rn))}wt.push(dn),Yt.push(mn)}return[wt,Yt]}(we,Te,Ie,Ge,Qe)}(v,h,U,$,R,x,ve,W,re,v.center.lat,c.tileID.canonical),Ee=c.queryGeometry;return function(ue,we,Te){let Ie=1/0;_n(Te,we)&&(Ie=d3(Te,we[0]));for(let Ge=0;Ge<we.length;Ge++){const Qe=we[Ge],it=ue[Ge];for(let ct=0;ct<Qe.length-1;ct++){const St=Qe[ct],Vt=[St,Qe[ct+1],it[ct+1],it[ct],St];jr(Te,Vt)&&(Ie=Math.min(Ie,d3(Te,Vt)))}}return Ie!==1/0&&Ie}(_e,Ce,Ee.isPointQuery()?Ee.screenBounds:Ee.screenGeometry)}},line:class extends To{constructor(c,s,l,h){const p=w3();super(c,p,s,l,h),p.layout&&(this.layout=new Ml(p.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const s=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=s._styleExpression&&s._styleExpression.expression instanceof vd,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(c,s){super.recalculate(c,s),this.paint._values["line-floorwidth"]=(()=>{if(d0)return d0;const l=w3();return d0=new dte(l.paint.properties["line-width"].specification),d0.useIntegerZoom=!0,d0})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new gT(c)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(c,s,l){const h=x3(this);return{config:new hc(this,{zoom:s,lut:l}),defines:h,overrideFog:!1}}queryRadius(c){const s=c,l=S3(pn("line-width",this,s),pn("line-gap-width",this,s)),h=pn("line-offset",this,s);return l/2+Math.abs(h)+Si(this.paint.get("line-translate"))}queryIntersectsFeature(c,s,l,h,p,v){if(c.queryGeometry.isAboveHorizon)return!1;const x=zn(c.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),v.angle,c.pixelToTileUnitsFactor),P=c.pixelToTileUnitsFactor/2*S3(this.paint.get("line-width").evaluate(s,l),this.paint.get("line-gap-width").evaluate(s,l)),I=this.paint.get("line-offset").evaluate(s,l);return I&&(h=function(R,$){const U=[],W=new Qt(0,0);for(let te=0;te<R.length;te++){const re=R[te],le=[];for(let ve=0;ve<re.length;ve++){const _e=re[ve],Ce=re[ve+1],Ee=ve===0?W:_e.sub(re[ve-1])._unit()._perp(),ue=ve===re.length-1?W:Ce.sub(_e)._unit()._perp(),we=Ee._add(ue)._unit();we._mult(1/(we.x*ue.x+we.y*ue.y)),le.push(we._mult($)._add(_e))}U.push(le)}return U}(h,I*c.pixelToTileUnitsFactor)),function(R,$,U){for(let W=0;W<$.length;W++){const te=$[W];if(R.length>=3){for(let re=0;re<te.length;re++)if(oi(R,te[re]))return!0}if(ii(R,te,U))return!0}return!1}(x,h,P)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(c){return!this.hasElevatedBuckets}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:L1,background:class extends To{constructor(c,s,l,h){super(c,{layout:fz||(fz=new qi({visibility:new er(ft.layout_background.visibility)})),paint:pz||(pz=new qi({"background-pitch-alignment":new er(ft.paint_background["background-pitch-alignment"]),"background-color":new er(ft.paint_background["background-color"]),"background-pattern":new er(ft.paint_background["background-pattern"]),"background-opacity":new er(ft.paint_background["background-opacity"]),"background-emissive-strength":new er(ft.paint_background["background-emissive-strength"]),"background-color-use-theme":new br({type:"string",default:"default","property-type":"data-driven"})}))},s,l,h)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(c,s,l){return{overrideFog:!1}}is3D(c){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:_z,"raster-particle":Tz,sky:class extends To{constructor(c,s,l,h){super(c,{layout:wz||(wz=new qi({visibility:new er(ft.layout_sky.visibility)})),paint:Sz||(Sz=new qi({"sky-type":new er(ft.paint_sky["sky-type"]),"sky-atmosphere-sun":new er(ft.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new er(ft.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new er(ft.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new er(ft.paint_sky["sky-gradient-radius"]),"sky-gradient":new $s(ft.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new er(ft.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new er(ft.paint_sky["sky-atmosphere-color"]),"sky-opacity":new er(ft.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new br({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new br({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new br({type:"string",default:"default","property-type":"data-driven"})}))},s,l,h),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="sky-gradient"?this._updateColorRamp():c!=="sky-atmosphere-sun"&&c!=="sky-atmosphere-halo-color"&&c!=="sky-atmosphere-color"&&c!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Nn({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(c){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const s=c.style.light.properties.get("position");return this._lightPosition.azimuthal!==s.azimuthal||this._lightPosition.polar!==s.polar}return!1}getCenter(c,s){if(this.paint.get("sky-type")==="atmosphere"){const h=this.paint.get("sky-atmosphere-sun"),p=!h,v=c.style.light,x=v.properties.get("position");return p&&v.properties.get("anchor")==="viewport"&&sn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?FT(x.azimuthal,90-x.polar,s):FT(h[0],90-h[1],s)}const l=this.paint.get("sky-gradient-center");return FT(l[0],90-l[1],s)}isSky(){return!0}markSkyboxValid(c){this._skyboxInvalidated=!1,this._lightPosition=c.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const c=this.paint.get("sky-type");return c==="atmosphere"?["skyboxCapture","skybox"]:c==="gradient"?["skyboxGradient"]:null}},slot:class extends To{constructor(c,s,l,h){super(c,{paint:Ez||(Ez=new qi({}))},s,null)}},model:class extends To{constructor(c,s,l,h){super(c,{layout:Rz||(Rz=new qi({visibility:new er(ft.layout_model.visibility),"model-id":new br(ft.layout_model["model-id"])})),paint:jz||(jz=new qi({"model-opacity":new br(ft.paint_model["model-opacity"]),"model-rotation":new br(ft.paint_model["model-rotation"]),"model-scale":new br(ft.paint_model["model-scale"]),"model-translation":new br(ft.paint_model["model-translation"]),"model-color":new br(ft.paint_model["model-color"]),"model-color-mix-intensity":new br(ft.paint_model["model-color-mix-intensity"]),"model-type":new er(ft.paint_model["model-type"]),"model-cast-shadows":new er(ft.paint_model["model-cast-shadows"]),"model-receive-shadows":new er(ft.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new er(ft.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new br(ft.paint_model["model-emissive-strength"]),"model-roughness":new br(ft.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new br(ft.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new er(ft.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new er(ft.paint_model["model-front-cutoff"]),"model-color-use-theme":new br({type:"string",default:"default","property-type":"data-driven"})}))},s,l,h),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new UT(c)}getProgramIds(){return["model"]}is3D(c){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(c){return c instanceof $1?or-1:0}queryIntersectsFeature(c,s,l,h,p,v){if(!this.modelManager)return!1;const x=this.modelManager,P=c.tile.getBucket(this);if(!(P&&P instanceof UT))return!1;for(const I in P.instancesPerModel){const R=P.instancesPerModel[I],$=s.id!==void 0?s.id:s.properties&&s.properties.hasOwnProperty("id")?s.properties.id:void 0;if(R.idToFeaturesIndex.hasOwnProperty($)){const U=R.features[R.idToFeaturesIndex[$]],W=x.getModel(I,this.scope);if(!W)return!1;let te=D();const re=new he(0,0),le=P.canonical;let ve=Number.MAX_VALUE;for(let _e=0;_e<U.instancedDataCount;++_e){const Ce=16*(U.instancedDataOffset+_e),Ee=R.instancedDataArray.float32,ue=[Ee[Ce+4],Ee[Ce+5],Ee[Ce+6]];$z(le,re,Ee[Ce],0|Ee[Ce+1]),Dz(te,W,v,re,U.rotation,U.scale,ue,!1,!1,!1),v.projection.name==="globe"&&(te=$T(te,v));const we=V([],v.projMatrix,te),Te=c.queryGeometry,Ie=Iz(Te.isPointQuery()?Te.screenBounds:Te.screenGeometry,v,we,W.aabb);Ie!=null&&(ve=Math.min(Ie,ve))}return ve!==Number.MAX_VALUE&&ve}}return!1}_handleOverridablePaintPropertyUpdate(c,s,l){return!(!this.layout||s.isDataDriven()||l.isDataDriven()||c!=="model-color"&&c!=="model-color-mix-intensity"&&c!=="model-rotation"&&c!=="model-scale"&&c!=="model-translation"&&c!=="model-emissive-strength")}_isPropertyZoomDependent(c){const s=this._transitionablePaint._values[c];return s!=null&&s.value!=null&&s.value.expression!=null&&s.value.expression instanceof Pl}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends To{constructor(c,s,l,h){super(c,{layout:jN||(jN=new qi({"clip-layer-types":new er(ft.layout_clip["clip-layer-types"]),"clip-layer-scope":new er(ft.layout_clip["clip-layer-scope"])})),paint:DN||(DN=new qi({}))},s,l,h)}recalculate(c,s){super.recalculate(c,s)}createBucket(c){return new NN(c)}is3D(c){return!0}}};class hre{constructor(s){this._callback=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class fre{constructor(){this.tasks={},this.taskQueue=[],Ur(["process"],this),this.invoker=new hre(this.process),this.nextId=0}add(s,l){const h=this.nextId++,p=function({type:v,isSymbolTile:x,zoom:P}){return P=P||0,v==="message"?0:v!=="maybePrepare"||x?v!=="parseTile"||x?v==="parseTile"&&x?300-P:v==="maybePrepare"&&x?400-P:500:200-P:100-P}(l);if(p===0){try{s()}finally{}return null}return this.tasks[h]={fn:s,metadata:l,priority:p,id:h},this.taskQueue.push(h),this.invoker.trigger(),{cancel:()=>{delete this.tasks[h]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(h=>!!this.tasks[h]),!this.taskQueue.length)return;const s=this.pick();if(s===null)return;const l=this.tasks[s];if(delete this.tasks[s],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let s=null,l=1/0;for(let p=0;p<this.taskQueue.length;p++){const v=this.tasks[this.taskQueue[p]];v.priority<l&&(l=v.priority,s=p)}if(s===null)return null;const h=this.taskQueue[s];return this.taskQueue.splice(s,1),h}remove(){this.invoker.remove()}}class Vz{constructor(s,l,h){this.target=s,this.parent=l,this.mapId=h,this.callbacks={},this.cancelCallbacks={},Ur(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new fre}send(s,l,h,p,v=!1,x){const P=Math.round(1e18*Math.random()).toString(36).substring(0,10);h&&(h.metadata=x,this.callbacks[P]=h);const I=new Set;return this.target.postMessage({id:P,type:s,hasCallback:!!h,targetMapId:p,mustQueue:v,sourceMapId:this.mapId,data:nc(l,I)},I),{cancel:()=>{h&&delete this.callbacks[P],this.target.postMessage({id:P,type:"<cancel>",targetMapId:p,sourceMapId:this.mapId})}}}receive(s){const l=s.data;if(!l)return;const h=l.id;if(h&&(!l.targetMapId||this.mapId===l.targetMapId))if(l.type==="<cancel>"){const p=this.cancelCallbacks[h];delete this.cancelCallbacks[h],p&&p.cancel()}else if(l.mustQueue||Vn(self)){const p=this.callbacks[h],v=this.scheduler.add(()=>this.processTask(h,l),p&&p.metadata||{type:"message"});v&&(this.cancelCallbacks[h]=v)}else this.processTask(h,l)}processTask(s,l){if(delete this.cancelCallbacks[s],l.type==="<response>"){const h=this.callbacks[s];delete this.callbacks[s],h&&(l.error?h(Gc(l.error)):h(null,Gc(l.data)))}else{const h=new Set,p=l.hasCallback?(x,P)=>{this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:x?nc(x):null,data:nc(P,h)},h)}:()=>{},v=Gc(l.data);if(this.parent[l.type])this.parent[l.type](l.sourceMapId,v,p);else if(this.parent.getWorkerSource){const x=l.type.split("."),{source:P,scope:I}=v;this.parent.getWorkerSource(l.sourceMapId,x[0],P,I)[x[1]](v,p)}else p(new Error(`Could not find function ${l.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var E0={workerUrl:"",workerClass:null,workerParams:void 0};const WT="mapboxgl_preloaded_worker_pool";class Xg{constructor(){this.active={}}acquire(s,l=Xg.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<l;)this.workers.push(E0.workerClass!=null?new E0.workerClass:new self.Worker(E0.workerUrl,E0.workerParams));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.workers&&this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[WT]}numActive(){return Object.keys(this.active).length}}Xg.workerCount=2;class sv{constructor(s,l,h="Worker",p=Xg.workerCount){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=ar();const v=this.workerPool.acquire(this.id,p);for(let x=0;x<v.length;x++){const P=new sv.Actor(v[x],l,this.id);P.name=`${h} ${x}`,this.actors.push(P)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(s,l,h){Ct(this.actors,(p,v)=>{p.send(s,l,v)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(s=>{s.remove()}),this.actors=[],this.workerPool.release(this.id)}}let T0,ZT;function V1(){return T0||(T0=new Xg),T0}sv.Actor=Vz;const XT=new Pn(0,0,0),KT={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},YT={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},U1={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},pre={PAINT_ORDER_FILL_AND_STROKE:1},C0={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},Uz={MASK_TYPE_LUMINANCE:1};function mre(c,s,l){c===1&&s.icons.push(function(h,p){return function(v){if(v.usvg_tree.height||(v.usvg_tree.height=v.usvg_tree.width),!v.metadata)return v;const{metadata:x}=v;if(x.content_area){const{content_area:P}=x;P.top==null&&(P.top=P.left),P.width==null&&(P.width=v.usvg_tree.width),P.height==null&&(P.height=P.width)}return x.stretch_x&&x.stretch_x.length&&qz(x,"x"),x.stretch_y&&x.stretch_y.length&&qz(x,"y"),v}(h.readFields(gre,{name:void 0},p))}(l,l.readVarint()+l.pos))}function qz(c,s){const l=[],h=c[`stretch_${s}`];let p=null;for(let v=0;v<h.length;v++)p===null?p=l.length===0?h[0]:l[l.length-1][1]+h[v]:(l.push([p,p+h[v]]),p=null);c[`stretch_${s}_areas`]=l}function gre(c,s,l){c===1?s.name=l.readString():c===2?s.metadata=function(h,p){return h.readFields(yre,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},p)}(l,l.readVarint()+l.pos):c===3&&(s.usvg_tree=function(h,p){return h.readFields(xre,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},p)}(l,l.readVarint()+l.pos),s.data="usvg_tree")}function yre(c,s,l){c===1?s.stretch_x=l.readPackedVarint():c===2?s.stretch_y=l.readPackedVarint():c===3?s.content_area=function(h,p){return h.readFields(vre,{left:0},p)}(l,l.readVarint()+l.pos):c===4&&s.variables.push(function(h,p){return h.readFields(_re,{name:void 0},p)}(l,l.readVarint()+l.pos))}function vre(c,s,l){c===1?s.left=l.readVarint():c===2?s.width=l.readVarint():c===3?s.top=l.readVarint():c===4&&(s.height=l.readVarint())}function _re(c,s,l){c===1?s.name=l.readString():c===2&&(s.rgb_color=H1(l.readVarint()),s.value="rgb_color")}function xre(c,s,l){c===1?s.width=s.height=l.readVarint():c===2?s.height=l.readVarint():c===3?s.children.push(q1(l,l.readVarint()+l.pos)):c===4?s.linear_gradients.push(function(h,p){return h.readFields(Are,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},p)}(l,l.readVarint()+l.pos)):c===5?s.radial_gradients.push(function(h,p){return h.readFields(Mre,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},p)}(l,l.readVarint()+l.pos)):c===7?s.clip_paths.push(function(h,p){return h.readFields(Ire,{children:[]},p)}(l,l.readVarint()+l.pos)):c===8&&s.masks.push(function(h,p){const v=h.readFields(kre,{left:0,width:20,mask_type:Uz.MASK_TYPE_LUMINANCE,children:[]},p);return v.height==null&&(v.height=v.width),v.top==null&&(v.top=v.left),v}(l,l.readVarint()+l.pos))}function q1(c,s){return c.readFields(bre,{},s)}function bre(c,s,l){c===1?(s.group=function(h,p){return h.readFields(wre,{opacity:255,children:[]},p)}(l,l.readVarint()+l.pos),s.node="group"):c===2&&(s.path=function(h,p){return h.readFields(Ere,{paint_order:1,commands:[],step:1,diffs:[],rule:KT.PATH_RULE_NON_ZERO},p)}(l,l.readVarint()+l.pos),s.node="path")}function wre(c,s,l){c===1?s.transform=G1(l,l.readVarint()+l.pos):c===2?s.opacity=l.readVarint():c===5?s.clip_path_idx=l.readVarint():c===6?s.mask_idx=l.readVarint():c===7&&s.children.push(q1(l,l.readVarint()+l.pos))}function G1(c,s){return c.readFields(Sre,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},s)}function Sre(c,s,l){c===1?s.sx=l.readFloat():c===2?s.ky=l.readFloat():c===3?s.kx=l.readFloat():c===4?s.sy=l.readFloat():c===5?s.tx=l.readFloat():c===6&&(s.ty=l.readFloat())}function Ere(c,s,l){c===1?s.fill=function(h,p){return h.readFields(Tre,{rgb_color:XT,paint:"rgb_color",opacity:255},p)}(l,l.readVarint()+l.pos):c===2?s.stroke=function(h,p){return h.readFields(Cre,{rgb_color:XT,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},p)}(l,l.readVarint()+l.pos):c===3?s.paint_order=l.readVarint():c===5?l.readPackedVarint(s.commands):c===6?s.step=l.readFloat():c===7?l.readPackedSVarint(s.diffs):c===8&&(s.rule=l.readVarint())}function Tre(c,s,l){c===1?(s.rgb_color=H1(l.readVarint()),s.paint="rgb_color"):c===2?(s.linear_gradient_idx=l.readVarint(),s.paint="linear_gradient_idx"):c===3?(s.radial_gradient_idx=l.readVarint(),s.paint="radial_gradient_idx"):c===5&&(s.opacity=l.readVarint())}function H1(c){return new Pn((c>>16&255)/255,(c>>8&255)/255,(255&c)/255,1)}function Cre(c,s,l){c===1?(s.rgb_color=H1(l.readVarint()),s.paint="rgb_color"):c===2?(s.linear_gradient_idx=l.readVarint(),s.paint="linear_gradient_idx"):c===3?(s.radial_gradient_idx=l.readVarint(),s.paint="radial_gradient_idx"):c===5?l.readPackedFloat(s.dasharray):c===6?s.dashoffset=l.readFloat():c===7?s.miterlimit=l.readFloat():c===8?s.opacity=l.readVarint():c===9?s.width=l.readFloat():c===10?s.linecap=l.readVarint():c===11&&(s.linejoin=l.readVarint())}function Are(c,s,l){c===1?s.transform=G1(l,l.readVarint()+l.pos):c===2?s.spread_method=l.readVarint():c===3?s.stops.push(Gz(l,l.readVarint()+l.pos)):c===4?s.x1=l.readFloat():c===5?s.y1=l.readFloat():c===6?s.x2=l.readFloat():c===7&&(s.y2=l.readFloat())}function Gz(c,s){return c.readFields(Pre,{offset:0,opacity:255,rgb_color:XT},s)}function Pre(c,s,l){c===1?s.offset=l.readFloat():c===2?s.opacity=l.readVarint():c===3&&(s.rgb_color=H1(l.readVarint()))}function Mre(c,s,l){c===1?s.transform=G1(l,l.readVarint()+l.pos):c===2?s.spread_method=l.readVarint():c===3?s.stops.push(Gz(l,l.readVarint()+l.pos)):c===4?s.cx=l.readFloat():c===5?s.cy=l.readFloat():c===6?s.r=l.readFloat():c===7?s.fx=l.readFloat():c===8?s.fy=l.readFloat():c===9&&(s.fr=l.readFloat())}function Ire(c,s,l){c===1?s.transform=G1(l,l.readVarint()+l.pos):c===2?s.clip_path_idx=l.readVarint():c===3&&s.children.push(q1(l,l.readVarint()+l.pos))}function kre(c,s,l){c===1?s.left=s.top=l.readFloat():c===2?s.width=s.height=l.readFloat():c===3?s.top=l.readFloat():c===4?s.height=l.readFloat():c===5?s.mask_type=l.readVarint():c===6?s.mask_idx=l.readVarint():c===7&&s.children.push(q1(l,l.readVarint()+l.pos))}class Ore{static calculate(s={},l=[]){const h=new Map,p=new Map;if(Object.keys(s).length===0)return h;l.forEach(v=>{p.set(v.name,v.rgb_color||new Pn(0,0,0))});for(const[v,x]of Object.entries(s))p.has(v)?h.set(p.get(v).toStringPremultipliedAlpha(),x):console.warn(`Ignoring unknown image variable "${v}"`);return h}}function ov(c,s=255,l){const h=s/255,p=c.toStringPremultipliedAlpha(),v=l.has(p)?l.get(p).clone():c.clone();return v.a*=h,v.toString()}function A0(c,s){if(!sg()){const l=document.createElement("canvas");return l.width=c,l.height=s,l}return new OffscreenCanvas(c,s)}function Lre(c,s){const l=Ore.calculate(s.params,c.metadata?c.metadata.variables:[]),h=c.usvg_tree,p=h.width,v=h.height,x=s.transform?s.transform:new DOMMatrix,P=Math.max(1,Math.round(p*x.a)),I=Math.max(1,Math.round(v*x.d)),R=new DOMMatrix([P/p,0,0,I/v,0,0]),$=A0(P,I).getContext("2d");return JT($,R,h,h,l),$.getImageData(0,0,P,I)}function JT(c,s,l,h,p){for(const v of h.children)Hz(c,s,l,v,p)}function Hz(c,s,l,h,p){h.group?(c.save(),function(v,x,P,I,R){const $=I.mask_idx!=null?P.masks[I.mask_idx]:null,U=I.clip_path_idx!=null?P.clip_paths[I.clip_path_idx]:null;if(I.transform&&(x=W1(I.transform).preMultiplySelf(x)),!function(re,le,ve){return re.opacity!==255||le||ve}(I,U!=null,$!=null))return void JT(v,x,P,I,R);const W=A0(v.canvas.width,v.canvas.height),te=W.getContext("2d");JT(te,x,P,I,R),U&&Qz(te,x,P,U),$&&eF(te,x,P,$,R),v.globalAlpha=I.opacity/255,v.drawImage(W,0,0)}(c,s,l,h.group,p),c.restore()):h.path&&(c.save(),function(v,x,P,I,R){const $=tF(I);v.setTransform(x),I.paint_order===pre.PAINT_ORDER_FILL_AND_STROKE?(Wz(v,P,I,$,R),Xz(v,P,I,$,R)):(Xz(v,P,I,$,R),Wz(v,P,I,$,R))}(c,s,l,h.path,p),c.restore())}function Wz(c,s,l,h,p){const v=l.fill;if(!v)return;const x=v.opacity/255;switch(v.paint){case"rgb_color":c.fillStyle=ov(v.rgb_color,v.opacity,p);break;case"linear_gradient_idx":c.fillStyle=Kz(c,s.linear_gradients[v.linear_gradient_idx],x,p);break;case"radial_gradient_idx":c.fillStyle=Yz(c,s.radial_gradients[v.radial_gradient_idx],x,p)}c.fill(h,Zz(l))}function Zz(c){return c.rule===KT.PATH_RULE_NON_ZERO?"nonzero":c.rule===KT.PATH_RULE_EVEN_ODD?"evenodd":void 0}function Xz(c,s,l,h,p){const v=l.stroke;if(!v)return;c.lineWidth=v.width,c.miterLimit=v.miterlimit,c.setLineDash(v.dasharray),c.lineDashOffset=v.dashoffset;const x=v.opacity/255;switch(v.paint){case"rgb_color":c.strokeStyle=ov(v.rgb_color,v.opacity,p);break;case"linear_gradient_idx":c.strokeStyle=Kz(c,s.linear_gradients[v.linear_gradient_idx],x,p);break;case"radial_gradient_idx":c.strokeStyle=Yz(c,s.radial_gradients[v.radial_gradient_idx],x,p)}switch(v.linejoin){case U1.LINE_JOIN_MITER_CLIP:case U1.LINE_JOIN_MITER:c.lineJoin="miter";break;case U1.LINE_JOIN_ROUND:c.lineJoin="round";break;case U1.LINE_JOIN_BEVEL:c.lineJoin="bevel"}switch(v.linecap){case YT.LINE_CAP_BUTT:c.lineCap="butt";break;case YT.LINE_CAP_ROUND:c.lineCap="round";break;case YT.LINE_CAP_SQUARE:c.lineCap="square"}c.stroke(h)}function Kz(c,s,l,h){if(s.stops.length===1){const W=s.stops[0];return ov(W.rgb_color,W.opacity*l,h)}const p=W1(s.transform),{x1:v,y1:x,x2:P,y2:I}=s,R=p.transformPoint(new DOMPoint(v,x)),$=p.transformPoint(new DOMPoint(P,I)),U=c.createLinearGradient(R.x,R.y,$.x,$.y);for(const W of s.stops)U.addColorStop(W.offset,ov(W.rgb_color,W.opacity*l,h));return U}function Yz(c,s,l,h){if(s.stops.length===1){const W=s.stops[0];return ov(W.rgb_color,W.opacity*l,h)}const p=W1(s.transform),{fx:v,fy:x,cx:P,cy:I}=s,R=p.transformPoint(new DOMPoint(v,x)),$=p.transformPoint(new DOMPoint(P,I)),U=c.createRadialGradient(R.x,R.y,0,$.x,$.y,s.r*((p.a+p.d)/2));for(const W of s.stops)U.addColorStop(W.offset,ov(W.rgb_color,W.opacity*l,h));return U}function Jz(c,s,l,h){const p=h.transform?W1(h.transform).preMultiplySelf(s):s,v=A0(c.canvas.width,c.canvas.height),x=v.getContext("2d");for(const I of h.children)if(I.group)Jz(x,p,l,I.group);else if(I.path){const R=I.path,$=new Path2D;$.addPath(tF(R),p),x.fill($,Zz(R))}const P=h.clip_path_idx!=null?l.clip_paths[h.clip_path_idx]:null;P&&Qz(x,p,l,P),c.globalCompositeOperation="source-over",c.drawImage(v,0,0)}function Qz(c,s,l,h){const p=A0(c.canvas.width,c.canvas.height);Jz(p.getContext("2d"),s,l,h),c.globalCompositeOperation="destination-in",c.drawImage(p,0,0)}function eF(c,s,l,h,p){if(h.children.length===0)return;const v=h.mask_idx!=null?l.masks[h.mask_idx]:null;v&&eF(c,s,l,v,p);const x=c.canvas.width,P=c.canvas.height,I=A0(x,P),R=I.getContext("2d"),$=h.width,U=h.height,W=h.left,te=h.top,re=new Path2D,le=new Path2D;le.rect(W,te,$,U),re.addPath(le,s),R.clip(re);for(const Ce of h.children)Hz(R,s,l,Ce,p);const ve=R.getImageData(0,0,x,P),_e=ve.data;if(h.mask_type===Uz.MASK_TYPE_LUMINANCE)for(let Ce=0;Ce<_e.length;Ce+=4)_e[Ce+3]=_e[Ce+3]/255*(.2126*_e[Ce]+.7152*_e[Ce+1]+.0722*_e[Ce+2]);R.putImageData(ve,0,0),c.globalCompositeOperation="destination-in",c.drawImage(I,0,0)}function W1(c){return c?new DOMMatrix([c.sx,c.ky,c.kx,c.sy,c.tx,c.ty]):new DOMMatrix}function tF(c){const s=new Path2D,l=c.step;let h=c.diffs[0]*l,p=c.diffs[1]*l;s.moveTo(h,p);for(let v=0,x=2;v<c.commands.length;v++)switch(c.commands[v]){case C0.PATH_COMMAND_MOVE:h+=c.diffs[x++]*l,p+=c.diffs[x++]*l,s.moveTo(h,p);break;case C0.PATH_COMMAND_LINE:h+=c.diffs[x++]*l,p+=c.diffs[x++]*l,s.lineTo(h,p);break;case C0.PATH_COMMAND_QUAD:{const P=h+c.diffs[x++]*l,I=p+c.diffs[x++]*l;h=P+c.diffs[x++]*l,p=I+c.diffs[x++]*l,s.quadraticCurveTo(P,I,h,p);break}case C0.PATH_COMMAND_CUBIC:{const P=h+c.diffs[x++]*l,I=p+c.diffs[x++]*l,R=P+c.diffs[x++]*l,$=I+c.diffs[x++]*l;h=R+c.diffs[x++]*l,p=$+c.diffs[x++]*l,s.bezierCurveTo(P,I,R,$,h,p);break}case C0.PATH_COMMAND_CLOSE:s.closePath()}return s}class Z1{constructor(s){this.capacity=s,this.cache=new Map}get(s){if(!this.cache.has(s))return;const l=this.cache.get(s);return this.cache.delete(s),this.cache.set(s,l),l}put(s,l){this.cache.has(s)?this.cache.delete(s):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(s,l)}delete(s){this.cache.delete(s)}}yr(Z1,"LRUCache");class QT{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(s){return new kr(s,s.data)}getFromCache(s,l,h){return this.cacheMap.has(h)||this.cacheMap.set(h,new Z1(150)),this.cacheMap.get(h).get(ac(s.toString(),l))}setInCache(s,l,h,p){this.cacheDependenciesMap.has(p)||this.cacheDependenciesMap.set(p,new Map),this.cacheMap.has(p)||this.cacheMap.set(p,new Z1(150));const v=this.cacheDependenciesMap.get(p),x=ac(s.id.toString(),h);v.get(x)||v.set(x,new Set);const P=this.cacheMap.get(p),I=s.toString();v.get(x).add(I),P.put(ac(s.toString(),h),l)}removeImagesFromCacheByIds(s,l,h=0){if(!this.cacheMap.has(h)||!this.cacheDependenciesMap.has(h))return;const p=this.cacheMap.get(h),v=this.cacheDependenciesMap.get(h);for(const x of s){const P=ac(x.toString(),l);if(v.has(P)){for(const I of v.get(P))p.delete(I);v.delete(P)}}}rasterize(s,l,h,p,v=Lre){const x=this.getFromCache(s,h,p);if(x)return x.clone();const P=v(l.icon,s.options),I=QT._getImage(P);return this.setInCache(s,I,h,p),I.clone()}}class rF{constructor(s){this.size=s,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(s,l){const h=this.toIdx(s,l);return{min:this.minimums[h],max:this.maximums[h]}}isLeaf(s,l){return this.leaves[this.toIdx(s,l)]}toIdx(s,l){return l*this.size+s}}function nF(c,s,l,h){let p=0,v=Number.MAX_VALUE;for(let x=0;x<3;x++)if(Math.abs(h[x])<1e-15){if(l[x]<c[x]||l[x]>s[x])return null}else{const P=1/h[x];let I=(c[x]-l[x])*P,R=(s[x]-l[x])*P;if(I>R){const $=I;I=R,R=$}if(I>p&&(p=I),R<v&&(v=R),p>v)return null}return p}function iF(c,s,l,h,p,v,x,P,I,R,$){const U=h-c,W=p-s,te=v-l,re=x-c,le=P-s,ve=I-l,_e=$[1]*ve-$[2]*le,Ce=$[2]*re-$[0]*ve,Ee=$[0]*le-$[1]*re,ue=U*_e+W*Ce+te*Ee;if(Math.abs(ue)<1e-15)return null;const we=1/ue,Te=R[0]-c,Ie=R[1]-s,Ge=R[2]-l,Qe=(Te*_e+Ie*Ce+Ge*Ee)*we;if(Qe<0||Qe>1)return null;const it=Ie*te-Ge*W,ct=Ge*U-Te*te,St=Te*W-Ie*U,Vt=($[0]*it+$[1]*ct+$[2]*St)*we;return Vt<0||Qe+Vt>1?null:(re*it+le*ct+ve*St)*we}function sF(c,s,l){return(c-s)/(l-s)}function oF(c,s,l,h,p,v,x,P,I){const R=1<<l,$=v-h,U=x-p,W=(c+1)/R*$+h,te=(s+0)/R*U+p,re=(s+1)/R*U+p;P[0]=(c+0)/R*$+h,P[1]=te,I[0]=W,I[1]=re}class aF{constructor(s){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=s,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(v){const x=Math.ceil(Math.log2(v.dim/8)),P=[];let I=Math.ceil(Math.pow(2,x));const R=1/I,$=(te,re,le,ve,_e)=>{const Ce=ve?1:0,Ee=(te+1)*le-Ce,ue=re*le,we=(re+1)*le-Ce;_e[0]=te*le,_e[1]=ue,_e[2]=Ee,_e[3]=we};let U=new rF(I);const W=[];for(let te=0;te<I*I;te++){$(te%I,Math.floor(te/I),R,!1,W);const re=Sm(W[0],W[1],v),le=Sm(W[2],W[1],v),ve=Sm(W[2],W[3],v),_e=Sm(W[0],W[3],v);U.minimums.push(Math.min(re,le,ve,_e)),U.maximums.push(Math.max(re,le,ve,_e)),U.leaves.push(1)}for(P.push(U),I/=2;I>=1;I/=2){const te=P[P.length-1];U=new rF(I);for(let re=0;re<I*I;re++){$(re%I,Math.floor(re/I),2,!0,W);const le=te.getElevation(W[0],W[1]),ve=te.getElevation(W[2],W[1]),_e=te.getElevation(W[2],W[3]),Ce=te.getElevation(W[0],W[3]),Ee=te.isLeaf(W[0],W[1]),ue=te.isLeaf(W[2],W[1]),we=te.isLeaf(W[2],W[3]),Te=te.isLeaf(W[0],W[3]),Ie=Math.min(le.min,ve.min,_e.min,Ce.min),Ge=Math.max(le.max,ve.max,_e.max,Ce.max),Qe=Ee&&ue&&we&&Te;U.maximums.push(Ge),U.minimums.push(Ie),U.leaves.push(Ge-Ie<=5&&Qe?1:0)}P.push(U)}return P}(this.dem),h=l.length-1,p=l[h];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(l,0,0,h,0)}raycastRoot(s,l,h,p,v,x,P=1){return nF([s,l,-100],[h,p,this.maximums[0]*P],v,x)}raycast(s,l,h,p,v,x,P=1){if(!this.nodeCount)return null;const I=this.raycastRoot(s,l,h,p,v,x,P);if(I==null)return null;const R=[],$=[],U=[],W=[],te=[{idx:0,t:I,nodex:0,nodey:0,depth:0}];for(;te.length>0;){const{idx:re,t:le,nodex:ve,nodey:_e,depth:Ce}=te.pop();if(this.leaves[re]){oF(ve,_e,Ce,s,l,h,p,U,W);const ue=1<<Ce,we=(ve+0)/ue,Te=(ve+1)/ue,Ie=(_e+0)/ue,Ge=(_e+1)/ue,Qe=Sm(we,Ie,this.dem)*P,it=Sm(Te,Ie,this.dem)*P,ct=Sm(Te,Ge,this.dem)*P,St=Sm(we,Ge,this.dem)*P,Vt=iF(U[0],U[1],Qe,W[0],U[1],it,W[0],W[1],ct,v,x),Nt=iF(W[0],W[1],ct,U[0],W[1],St,U[0],U[1],Qe,v,x),Bt=Math.min(Vt!==null?Vt:Number.MAX_VALUE,Nt!==null?Nt:Number.MAX_VALUE);if(Bt!==Number.MAX_VALUE)return Bt;{const Xt=De([],v,x,le);if(lF(Qe,it,St,ct,sF(Xt[0],U[0],W[0]),sF(Xt[1],U[1],W[1]))>=Xt[2])return le}continue}let Ee=0;for(let ue=0;ue<this._siblingOffset.length;ue++){oF((ve<<1)+this._siblingOffset[ue][0],(_e<<1)+this._siblingOffset[ue][1],Ce+1,s,l,h,p,U,W),U[2]=-100,W[2]=this.maximums[this.childOffsets[re]+ue]*P;const we=nF(U,W,v,x);if(we!=null){const Te=we;R[ue]=Te;let Ie=!1;for(let Ge=0;Ge<Ee&&!Ie;Ge++)Te>=R[$[Ge]]&&($.splice(Ge,0,ue),Ie=!0);Ie||($[Ee]=ue),Ee++}}for(let ue=0;ue<Ee;ue++){const we=$[ue];te.push({idx:this.childOffsets[re]+we,t:R[we],nodex:(ve<<1)+this._siblingOffset[we][0],nodey:(_e<<1)+this._siblingOffset[we][1],depth:Ce+1})}}return null}_addNode(s,l,h){return this.minimums.push(s),this.maximums.push(l),this.leaves.push(h),this.childOffsets.push(0),this.nodeCount++}_construct(s,l,h,p,v){if(s[p].isLeaf(l,h)===1)return;this.childOffsets[v]||(this.childOffsets[v]=this.nodeCount);const x=p-1,P=s[x];let I=0,R=0;for(let $=0;$<this._siblingOffset.length;$++){const U=2*l+this._siblingOffset[$][0],W=2*h+this._siblingOffset[$][1],te=P.getElevation(U,W),re=P.isLeaf(U,W),le=this._addNode(te.min,te.max,re);re&&(I|=1<<$),R||(R=le)}for(let $=0;$<this._siblingOffset.length;$++)I&1<<$||this._construct(s,2*l+this._siblingOffset[$][0],2*h+this._siblingOffset[$][1],x,R+$)}}function lF(c,s,l,h,p,v){return Br(Br(c,l,v),Br(s,h,v),p)}function Sm(c,s,l){const h=l.dim,p=rt(c*h-.5,0,h-1),v=rt(s*h-.5,0,h-1),x=Math.floor(p),P=Math.floor(v),I=Math.min(x+1,h-1),R=Math.min(P+1,h-1);return lF(l.get(x,P),l.get(I,P),l.get(x,R),l.get(I,R),p-x,v-P)}const Rre={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function jre(c,s,l){return(256*c*256+256*s+l)/10-1e4}function Dre(c,s,l){return 256*c+s+l/256-32768}class X1{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(s,l,h,p=!1){if(this.uid=s,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(h&&h!=="mapbox"&&h!=="terrarium")return void sn(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const v=this.dim=l.height-2,x=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.floatView=new Float32Array(l.data.buffer),this.borderReady=p,this._modifiedForSources={},!p){for(let I=0;I<v;I++)x[this._idx(-1,I)]=x[this._idx(0,I)],x[this._idx(v,I)]=x[this._idx(v-1,I)],x[this._idx(I,-1)]=x[this._idx(I,0)],x[this._idx(I,v)]=x[this._idx(I,v-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(v,-1)]=x[this._idx(v-1,0)],x[this._idx(-1,v)]=x[this._idx(0,v-1)],x[this._idx(v,v)]=x[this._idx(v-1,v-1)]}const P=h==="terrarium"?Dre:jre;for(let I=0;I<x.length;++I){const R=4*I;this.floatView[I]=P(this.pixels[R],this.pixels[R+1],this.pixels[R+2])}this._timestamp=Ia.now()}_buildQuadTree(){this._tree=new aF(this)}get(s,l,h=!1){h&&(s=rt(s,-1,this.dim),l=rt(l,-1,this.dim));const p=this._idx(s,l);return this.floatView[p]}set(s,l,h){const p=this._idx(s,l),v=this.floatView[p];return this.floatView[p]=h,h-v}static getUnpackVector(s){return Rre[s]}_idx(s,l){if(s<-1||s>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(s+1)}static pack(s,l){const h=[0,0,0,0],p=X1.getUnpackVector(l);let v=Math.floor((s+p[3])/p[2]);return h[2]=v%256,v=Math.floor(v/256),h[1]=v%256,v=Math.floor(v/256),h[0]=v,h}getPixels(){return new In({width:this.stride,height:this.stride},this.pixels)}backfillBorder(s,l,h){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");let p=l*this.dim,v=l*this.dim+this.dim,x=h*this.dim,P=h*this.dim+this.dim;switch(l){case-1:p=v-1;break;case 1:v=p+1}switch(h){case-1:x=P-1;break;case 1:P=x+1}const I=-l*this.dim,R=-h*this.dim;for(let $=x;$<P;$++)for(let U=p;U<v;U++){const W=4*this._idx(U,$),te=4*this._idx(U+I,$+R);this.pixels[W+0]=s.pixels[te+0],this.pixels[W+1]=s.pixels[te+1],this.pixels[W+2]=s.pixels[te+2],this.pixels[W+3]=s.pixels[te+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function Nre(c,s,l){c===1?s.headerLength=l.readFixed32():c===2?s.x=l.readVarint():c===3?s.y=l.readVarint():c===4?s.z=l.readVarint():c===5&&s.layers.push(function(h,p){return h.readFields(Vre,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},p)}(l,l.readVarint()+l.pos))}function zre(c,s,l){c===1?(s.delta_filter=function(h,p){return h.readFields(Fre,{blockSize:0},p)}(l,l.readVarint()+l.pos),s.filter="delta_filter"):c===2?(l.readVarint(),s.filter="zigzag_filter"):c===3?(l.readVarint(),s.filter="bitshuffle_filter"):c===4&&(l.readVarint(),s.filter="byteshuffle_filter")}function Fre(c,s,l){c===1&&(s.blockSize=l.readVarint())}function Bre(c,s,l){c===1?(l.readVarint(),s.codec="gzip_data"):c===2?(l.readVarint(),s.codec="jpeg_image"):c===3?(l.readVarint(),s.codec="webp_image"):c===4&&(l.readVarint(),s.codec="png_image")}function $re(c,s,l){let h=0,p=0;c===1?s.firstByte=l.readFixed64():c===2?s.lastByte=l.readFixed64():c===3?s.filters.push(function(v,x){return v.readFields(zre,{},x)}(l,l.readVarint()+l.pos)):c===4?s.codec=function(v,x){return v.readFields(Bre,{},x)}(l,l.readVarint()+l.pos):c===5?p=l.readFloat():c===6?h=l.readFloat():c===7?s.bands.push(l.readString()):c===8?s.offset=l.readDouble():c===9&&(s.scale=l.readDouble()),s.offset===0&&(s.offset=p),s.scale===0&&(s.scale=h)}function Vre(c,s,l){c===1?s.version=l.readVarint():c===2?s.name=l.readString():c===3?s.units=l.readString():c===4?s.tileSize=l.readVarint():c===5?s.buffer=l.readVarint():c===6?s.pixelFormat=l.readVarint():c===7&&s.dataIndex.push(function(h,p){return h.readFields($re,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},p)}(l,l.readVarint()+l.pos))}function Ure(c,s,l){if(c===2)(function(h,p,v){h.readFields(qre,v,p)})(l,l.readVarint()+l.pos,s);else if(c===3)throw new Error("Not implemented")}function qre(c,s,l){if(c===1){let h=0;const p=l.readVarint()+l.pos;for(;l.pos<p;)s[h++]=l.readVarint()}}function Gre(c,s){if(s.length!==4)throw new Error(`Expected data of dimension 4 but got ${s.length}.`);let l=s[3];for(let h=2;h>=1;h--){const p=h===1?1:0,v=h===2?1:0;for(let x=0;x<s[0];x++){const P=s[1]*x;for(let I=p;I<s[1];I++){const R=s[2]*(I+P);for(let $=v;$<s[2];$++){const U=s[3]*($+R);for(let W=0;W<s[3];W++){const te=U+W;c[te]+=c[te-l]}}}}l*=s[h]}return c}function Hre(c){for(let s=0,l=c.length;s<l;s++)c[s]=c[s]>>>1^-(1&c[s]);return c}function Wre(c,s){switch(s){case"uint32":return c;case"uint16":for(let l=0;l<c.length;l+=2){const h=c[l],p=c[l+1];c[l]=(240&h)>>4|(61440&h)>>8|(240&p)<<4|61440&p,c[l+1]=15&h|(3840&h)>>4|(15&p)<<8|(3840&p)<<4}return c;case"uint8":for(let l=0;l<c.length;l+=4){const h=c[l],p=c[l+1],v=c[l+2],x=c[l+3];c[l+0]=(192&h)>>6|(192&p)>>4|(192&v)>>2|192&x,c[l+1]=(48&h)>>4|(48&p)>>2|48&v|(48&x)<<2,c[l+2]=(12&h)>>2|12&p|(12&v)<<2|(12&x)<<4,c[l+3]=3&h|(3&p)<<2|(3&v)<<4|(3&x)<<6}return c;default:throw new Error(`Invalid pixel format, "${s}"`)}}yr(X1,"DEMData"),yr(aF,"DemMinMaxQuadTree",{omit:["dem"]});var Yc=Uint8Array,P0=Uint16Array,Zre=Int32Array,cF=new Yc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),uF=new Yc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Xre=new Yc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),dF=function(c,s){for(var l=new P0(31),h=0;h<31;++h)l[h]=s+=1<<c[h-1];var p=new Zre(l[30]);for(h=1;h<30;++h)for(var v=l[h];v<l[h+1];++v)p[v]=v-l[h]<<5|h;return{b:l,r:p}},hF=dF(cF,2),fF=hF.b,Kre=hF.r;fF[28]=258,Kre[258]=28;for(var Yre=dF(uF,0).b,pF=new P0(32768),Zs=0;Zs<32768;++Zs){var av=(43690&Zs)>>1|(21845&Zs)<<1;pF[Zs]=((65280&(av=(61680&(av=(52428&av)>>2|(13107&av)<<2))>>4|(3855&av)<<4))>>8|(255&av)<<8)>>1}var M0=function(c,s,l){for(var h=c.length,p=0,v=new P0(s);p<h;++p)c[p]&&++v[c[p]-1];var x,P=new P0(s);for(p=1;p<s;++p)P[p]=P[p-1]+v[p-1]<<1;x=new P0(1<<s);var I=15-s;for(p=0;p<h;++p)if(c[p])for(var R=p<<4|c[p],$=s-c[p],U=P[c[p]-1]++<<$,W=U|(1<<$)-1;U<=W;++U)x[pF[U]>>I]=R;return x},I0=new Yc(288);for(Zs=0;Zs<144;++Zs)I0[Zs]=8;for(Zs=144;Zs<256;++Zs)I0[Zs]=9;for(Zs=256;Zs<280;++Zs)I0[Zs]=7;for(Zs=280;Zs<288;++Zs)I0[Zs]=8;var mF=new Yc(32);for(Zs=0;Zs<32;++Zs)mF[Zs]=5;var Jre=M0(I0,9),Qre=M0(mF,5),eC=function(c){for(var s=c[0],l=1;l<c.length;++l)c[l]>s&&(s=c[l]);return s},Fd=function(c,s,l){var h=s/8|0;return(c[h]|c[h+1]<<8)>>(7&s)&l},tC=function(c,s){var l=s/8|0;return(c[l]|c[l+1]<<8|c[l+2]<<16)>>(7&s)},ene=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Bd=function(c,s,l){var h=new Error(s||ene[c]);if(h.code=c,Error.captureStackTrace&&Error.captureStackTrace(h,Bd),!l)throw h;return h},tne=new Yc(0),rne=typeof TextDecoder<"u"&&new TextDecoder;try{rne.decode(tne,{stream:!0})}catch{}const nne={gzip_data:"gzip"};class $u extends Error{constructor(s){super(s),this.name="MRTError"}}const ine={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},gF={uint32:1,uint16:2,uint8:4},sne={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let rC;class K1{constructor(s=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=s}getLayer(s){const l=this.layers[s];if(!l)throw new $u(`Layer '${s}' not found`);return l}getHeaderLength(s){const l=new Uint8Array(s),h=new DataView(s);if(l[0]!==13)throw new $u("File is not a valid MRT.");return h.getUint32(1,!0)}parseHeader(s){const l=new Uint8Array(s),h=this.getHeaderLength(s);if(l.length<h)throw new $u(`Expected header with length >= ${h} but got buffer of length ${l.length}`);const p=function(v,x){return v.readFields(Nre,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new rC(l.subarray(0,h)));if(!isNaN(this.x)&&(this.x!==p.x||this.y!==p.y||this.z!==p.z))throw new $u(`Invalid attempt to parse header ${p.z}/${p.x}/${p.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=p.x,this.y=p.y,this.z=p.z;for(const v of p.layers)this.layers[v.name]=new yF(v,{cacheSize:this._cacheSize});return this}createDecodingTask(s){const l=[],h=this.getLayer(s.layerName);for(let p of s.blockIndices){const v=h.dataIndex[p],x=v.firstByte-s.firstByte,P=v.lastByte-s.firstByte;if(h._blocksInProgress.has(p))continue;const I={layerName:h.name,firstByte:x,lastByte:P,pixelFormat:h.pixelFormat,blockIndex:p,blockShape:[v.bands.length].concat(h.bandShape),buffer:h.buffer,codec:v.codec.codec,filters:v.filters.map(R=>R.filter)};h._blocksInProgress.add(p),l.push(I)}return new vF(l,()=>{l.forEach(p=>h._blocksInProgress.delete(p.blockIndex))},(p,v)=>{if(l.forEach(x=>h._blocksInProgress.delete(x.blockIndex)),p)throw p;v.forEach(x=>{this.getLayer(x.layerName).processDecodedData(x)})})}}class yF{constructor({version:s,name:l,units:h,tileSize:p,pixelFormat:v,buffer:x,dataIndex:P},I){if(this.version=s,this.version!==1)throw new $u(`Cannot parse raster layer encoded with MRT version ${s}`);this.name=l,this.units=h,this.tileSize=p,this.buffer=x,this.pixelFormat=ine[v],this.dataIndex=P,this.bandShape=[p+2*x,p+2*x,gF[this.pixelFormat]],this._decodedBlocks=new Z1(I?I.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return gF[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:s})=>s).flat()}processDecodedData(s){const l=s.blockIndex.toString();this._decodedBlocks.get(l)||this._decodedBlocks.put(l,s.data)}getBlockForBand(s){let l=0;switch(typeof s){case"string":for(const[h,p]of this.dataIndex.entries()){for(const[v,x]of p.bands.entries())if(x===s)return{bandIndex:l+v,blockIndex:h,blockBandIndex:v};l+=p.bands.length}break;case"number":for(const[h,p]of this.dataIndex.entries()){if(s>=l&&s<l+p.bands.length)return{bandIndex:s,blockIndex:h,blockBandIndex:s-l};l+=p.bands.length}break;default:throw new $u(`Invalid band \`${JSON.stringify(s)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(s){let l=1/0,h=-1/0;const p=[],v=new Set;for(const x of s){const{blockIndex:P}=this.getBlockForBand(x);if(P<0)throw new $u(`Invalid band: ${JSON.stringify(x)}`);const I=this.dataIndex[P];p.includes(P)||p.push(P),v.add(P),l=Math.min(l,I.firstByte),h=Math.max(h,I.lastByte)}if(v.size>this.cacheSize)throw new $u(`Number of blocks to decode (${v.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:l,lastByte:h,blockIndices:p}}hasBand(s){const{blockIndex:l}=this.getBlockForBand(s);return l>=0}hasDataForBand(s){const{blockIndex:l}=this.getBlockForBand(s);return l>=0&&!!this._decodedBlocks.get(l.toString())}getBandView(s){const{blockIndex:l,blockBandIndex:h}=this.getBlockForBand(s);if(l<0)throw new $u(`Band not found: ${JSON.stringify(s)}`);const p=this._decodedBlocks.get(l.toString());if(!p)throw new $u(`Data for band ${JSON.stringify(s)} of layer "${this.name}" not decoded.`);const v=this.dataIndex[l],x=this.bandShape.reduce((R,$)=>R*$,1),P=h*x,I=p.subarray(P,P+x);return{data:I,bytes:new Uint8Array(I.buffer).subarray(I.byteOffset,I.byteOffset+I.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:v.offset,scale:v.scale}}}K1.setPbf=function(c){rC=c};class vF{constructor(s,l,h){this.tasks=s,this._onCancel=l,this._onComplete=h,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(s,l){this._finalized||(this._onComplete(s,l),this._finalized=!0)}}K1.performDecoding=function(c,s){const l=new Uint8Array(c);return Promise.all(s.tasks.map(h=>{const{layerName:p,firstByte:v,lastByte:x,pixelFormat:P,blockShape:I,blockIndex:R,filters:$,codec:U}=h,W=l.subarray(v,x+1),te=new Uint32Array(I[0]*I[1]*I[2]);let re;if(U!=="gzip_data")throw new $u(`Unhandled codec: ${U}`);return re=function(le,ve){if(!globalThis.DecompressionStream&&ve==="gzip_data")return Promise.resolve(((ue=function(Ie){Ie[0]==31&&Ie[1]==139&&Ie[2]==8||Bd(6,"invalid gzip data");var Ge=Ie[3],Qe=10;4&Ge&&(Qe+=2+(Ie[10]|Ie[11]<<8));for(var it=(Ge>>3&1)+(Ge>>4&1);it>0;it-=!Ie[Qe++]);return Qe+(2&Ge)}(Ee=le))+8>Ee.length&&Bd(6,"invalid gzip data"),function(Ie,Ge,Qe,it){var ct=Ie.length;if(!ct||Ge.f&&!Ge.l)return Qe||new Yc(0);var St=!Qe,Vt=St||Ge.i!=2,Nt=Ge.i;St&&(Qe=new Yc(3*ct));var Bt,Xt,xt=function(hs){var Ni=Qe.length;if(hs>Ni){var Ti=new Yc(Math.max(2*Ni,hs));Ti.set(Qe),Qe=Ti}},Ft=Ge.f||0,_t=Ge.p||0,wt=Ge.b||0,Yt=Ge.l,tr=Ge.d,Or=Ge.m,Tr=Ge.n,hr=8*ct;do{if(!Yt){Ft=Fd(Ie,_t,1);var Kt=Fd(Ie,_t+1,3);if(_t+=3,!Kt){var tn=Ie[(Me=4+((_t+7)/8|0))-4]|Ie[Me-3]<<8,Pr=Me+tn;if(Pr>ct){Nt&&Bd(0);break}Vt&&xt(wt+tn),Qe.set(Ie.subarray(Me,Pr),wt),Ge.b=wt+=tn,Ge.p=_t=8*Pr,Ge.f=Ft;continue}if(Kt==1)Yt=Jre,tr=Qre,Or=9,Tr=5;else if(Kt==2){var Mr=Fd(Ie,_t,31)+257,Kr=Fd(Ie,_t+10,15)+4,dn=Mr+Fd(Ie,_t+5,31)+1;_t+=14;for(var mn=new Yc(dn),An=new Yc(19),bn=0;bn<Kr;++bn)An[Xre[bn]]=Fd(Ie,_t+3*bn,7);_t+=3*Kr;var yn=eC(An),gi=(1<<yn)-1,Ii=M0(An,yn);for(bn=0;bn<dn;){var Me,Oe=Ii[Fd(Ie,_t,gi)];if(_t+=15&Oe,(Me=Oe>>4)<16)mn[bn++]=Me;else{var Pt=0,ir=0;for(Me==16?(ir=3+Fd(Ie,_t,3),_t+=2,Pt=mn[bn-1]):Me==17?(ir=3+Fd(Ie,_t,7),_t+=3):Me==18&&(ir=11+Fd(Ie,_t,127),_t+=7);ir--;)mn[bn++]=Pt}}var pr=mn.subarray(0,Mr),fr=mn.subarray(Mr);Or=eC(pr),Tr=eC(fr),Yt=M0(pr,Or),tr=M0(fr,Tr)}else Bd(1);if(_t>hr){Nt&&Bd(0);break}}Vt&&xt(wt+131072);for(var Ir=(1<<Or)-1,Wr=(1<<Tr)-1,Ln=_t;;Ln=_t){var Rn=(Pt=Yt[tC(Ie,_t)&Ir])>>4;if((_t+=15&Pt)>hr){Nt&&Bd(0);break}if(Pt||Bd(2),Rn<256)Qe[wt++]=Rn;else{if(Rn==256){Ln=_t,Yt=null;break}var vn=Rn-254;Rn>264&&(vn=Fd(Ie,_t,(1<<(jn=cF[bn=Rn-257]))-1)+fF[bn],_t+=jn);var ui=tr[tC(Ie,_t)&Wr],Ei=ui>>4;if(ui||Bd(3),_t+=15&ui,fr=Yre[Ei],Ei>3){var jn=uF[Ei];fr+=tC(Ie,_t)&(1<<jn)-1,_t+=jn}if(_t>hr){Nt&&Bd(0);break}Vt&&xt(wt+131072);var Yi=wt+vn;if(wt<fr){var ki=0-fr,ai=Math.min(fr,Yi);for(ki+wt<0&&Bd(3);wt<ai;++wt)Qe[wt]=(void 0)[ki+wt]}for(;wt<Yi;++wt)Qe[wt]=Qe[wt-fr]}}Ge.l=Yt,Ge.p=Ln,Ge.b=wt,Ge.f=Ft,Yt&&(Ft=1,Ge.m=Or,Ge.d=tr,Ge.n=Tr)}while(!Ft);return wt!=Qe.length&&St?(Bt=Qe,((Xt=wt)==null||Xt>Bt.length)&&(Xt=Bt.length),new Yc(Bt.subarray(0,Xt))):Qe.subarray(0,wt)}(Ee.subarray(ue,-8),{i:2},new Yc(((_e=Ee)[(Ce=_e.length)-4]|_e[Ce-3]<<8|_e[Ce-2]<<16|_e[Ce-1]<<24)>>>0))));var _e,Ce,Ee,ue;const we=nne[ve];if(!we)throw new Error(`Unhandled codec: ${ve}`);const Te=new globalThis.DecompressionStream(we);return new Response(new Blob([le]).stream().pipeThrough(Te)).arrayBuffer().then(Ie=>new Uint8Array(Ie))}(W,U).then(le=>(function(ve,_e){ve.readFields(Ure,_e)}(new rC(le),te),new sne[P](te.buffer))),re.then(le=>{for(let ve=$.length-1;ve>=0;ve--)switch($[ve]){case"delta_filter":Gre(le,I);break;case"zigzag_filter":Hre(le);break;case"bitshuffle_filter":Wre(le,P);break;default:throw new $u(`Unhandled filter "${$[ve]}"`)}return{layerName:p,blockIndex:R,data:le}}).catch(le=>{throw le})}))},yr(vF,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),yr(K1,"MapboxRasterTile"),yr(yF,"MapboxRasterLayer",{omit:["_blocksInProgress"]});let k0,nC,$d,lv,iC,cv=null;function _F(){return Vn(self)&&self.worker.dracoUrl?self.worker.dracoUrl:nC||cs.DRACO_URL}function xF(){if(Vn(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(lv)return lv;const c=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return lv=WebAssembly.validate(c)?cs.MESHOPT_SIMD_URL:cs.MESHOPT_URL,lv}const Y1={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},one={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},O0={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function bF(c,s,l){const h=l.json.bufferViews.length,p=l.buffers.length;s.bufferView=h,l.json.bufferViews[h]={buffer:p,byteLength:c.byteLength},l.buffers[p]=c}const sC="KHR_draco_mesh_compression";function ane(c,s){const l=c.extensions&&c.extensions[sC];if(!l)return;const h=new $d.Decoder,p=TF(s,l.bufferView),v=new $d.Mesh;if(!h.DecodeArrayToMesh(p,p.byteLength,v))throw new Error("Failed to decode Draco mesh");const x=s.json.accessors[c.indices],P=Y1[x.componentType],I=x.count*P.BYTES_PER_ELEMENT,R=$d._malloc(I);P===Uint16Array?h.GetTrianglesUInt16Array(v,I,R):h.GetTrianglesUInt32Array(v,I,R),bF($d.memory.buffer.slice(R,R+I),x,s),$d._free(R);for(const $ of Object.keys(l.attributes)){const U=h.GetAttributeByUniqueId(v,l.attributes[$]),W=s.json.accessors[c.attributes[$]],te=one[W.componentType],re=W.count*O0[W.type]*Y1[W.componentType].BYTES_PER_ELEMENT,le=$d._malloc(re);h.GetAttributeDataArrayForAllPoints(v,U,$d[te],re,le),bF($d.memory.buffer.slice(le,le+re),W,s),$d._free(le)}h.destroy(),v.destroy(),delete c.extensions[sC]}const J1="EXT_meshopt_compression";function lne(c,s){if(!c.extensions||!c.extensions[J1])return;const l=c.extensions[J1],h=new Uint8Array(s.buffers[l.buffer],l.byteOffset||0,l.byteLength||0),p=new Uint8Array(l.count*l.byteStride);iC.decodeGltfBuffer(p,l.count,l.byteStride,h,l.mode,l.filter),c.buffer=s.buffers.length,c.byteOffset=0,s.buffers[c.buffer]=p.buffer,delete c.extensions[J1]}const wF=1179937895,SF=new TextDecoder("utf8");function EF(c,s){return new URL(c,s).href}function cne(c,s,l,h){return fetch(EF(c.uri,h)).then(p=>p.arrayBuffer()).then(p=>{s.buffers[l]=p})}function TF(c,s){const l=c.json.bufferViews[s];return new Uint8Array(c.buffers[l.buffer],l.byteOffset||0,l.byteLength)}function une(c,s,l,h){if(c.uri){const p=EF(c.uri,h);return fetch(p).then(v=>v.blob()).then(v=>createImageBitmap(v)).then(v=>{s.images[l]=v})}if(c.bufferView!==void 0){const p=TF(s,c.bufferView),v=new Blob([p],{type:c.mimeType});return createImageBitmap(v).then(x=>{s.images[l]=x})}}function CF(c,s=0,l){const h={json:null,images:[],buffers:[]};if(new Uint32Array(c,s,1)[0]===wF){const $=new Uint32Array(c,s);let U=2;const W=($[U++]>>2)-3,te=$[U++]>>2;if(U++,h.json=JSON.parse(SF.decode($.subarray(U,U+te))),U+=te,U<W){const re=$[U++];U++;const le=s+(U<<2);h.buffers[0]=c.slice(le,le+re)}}else h.json=JSON.parse(SF.decode(new Uint8Array(c,s)));const{buffers:p,images:v,meshes:x,extensionsUsed:P,bufferViews:I}=h.json;let R=Promise.resolve();if(p){const $=[];for(let U=0;U<p.length;U++){const W=p[U];W.uri?$.push(cne(W,h,U,l)):h.buffers[U]||(h.buffers[U]=null)}R=Promise.all($)}return R.then(()=>{const $=[],U=P&&P.includes(sC),W=P&&P.includes(J1);if(U&&$.push(function(){if(!$d)return k0??(k0=function(te){let re,le=null;function ve(){re=new Uint8Array(le.buffer)}function _e(){throw new Error("Unexpected Draco error.")}const Ce={a:{a:_e,d:function(Ee,ue,we){return re.copyWithin(Ee,ue,ue+we)},c:function(Ee){const ue=re.length,we=Math.max(Ee>>>0,Math.ceil(1.2*ue)),Te=Math.ceil((we-ue)/65536);try{return le.grow(Te),ve(),!0}catch{return!1}},b:_e}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(te,Ce):te.then(Ee=>Ee.arrayBuffer()).then(Ee=>WebAssembly.instantiate(Ee,Ce))).then(Ee=>{const{Rb:ue,Qb:we,P:Te,T:Ie,X:Ge,Ja:Qe,La:it,Qa:ct,Va:St,Wa:Vt,eb:Nt,jb:Bt,f:Xt,e:xt,yb:Ft,zb:_t,Ab:wt,Bb:Yt,Db:tr,Gb:Or}=Ee.instance.exports;le=xt;const Tr=(()=>{let hr=0,Kt=0,tn=0,Pr=0;return Mr=>{tn&&(ue(Pr),ue(hr),Kt+=tn,tn=hr=0),hr||(Kt+=128,hr=we(Kt));const Kr=Mr.length+7&-8;let dn=hr;Kr>=Kt&&(tn=Kr,dn=Pr=we(Kr));for(let mn=0;mn<Mr.length;mn++)re[dn+mn]=Mr[mn];return dn}})();return ve(),Xt(),{memory:xt,_free:ue,_malloc:we,Mesh:class{constructor(){this.ptr=Te()}destroy(){Ie(this.ptr)}},Decoder:class{constructor(){this.ptr=Qe()}destroy(){Bt(this.ptr)}DecodeArrayToMesh(hr,Kt,tn){const Pr=Tr(hr),Mr=it(this.ptr,Pr,Kt,tn.ptr);return!!Ge(Mr)}GetAttributeByUniqueId(hr,Kt){return{ptr:ct(this.ptr,hr.ptr,Kt)}}GetTrianglesUInt16Array(hr,Kt,tn){St(this.ptr,hr.ptr,Kt,tn)}GetTrianglesUInt32Array(hr,Kt,tn){Vt(this.ptr,hr.ptr,Kt,tn)}GetAttributeDataArrayForAllPoints(hr,Kt,tn,Pr,Mr){Nt(this.ptr,hr.ptr,Kt.ptr,tn,Pr,Mr)}},DT_INT8:Ft(),DT_UINT8:_t(),DT_INT16:wt(),DT_UINT16:Yt(),DT_UINT32:tr(),DT_FLOAT32:Or()}})}(fetch(_F())),k0.then(te=>{$d=te,k0=void 0}))}()),W&&$.push(function(){if(iC)return;const te=function(re){let le;const ve=WebAssembly.instantiateStreaming(re,{}).then(Ee=>{le=Ee.instance,le.exports.__wasm_call_ctors()}),_e={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Ce={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:ve,supported:!0,decodeGltfBuffer(Ee,ue,we,Te,Ie,Ge){(function(Qe,it,ct,St,Vt,Nt,Bt){const Xt=Qe.exports.sbrk,xt=St+3&-4,Ft=Xt(xt*Vt),_t=Xt(Nt.length),wt=new Uint8Array(Qe.exports.memory.buffer);wt.set(Nt,_t);const Yt=it(Ft,St,Vt,_t,Nt.length);if(Yt===0&&Bt&&Bt(Ft,xt,Vt),ct.set(wt.subarray(Ft,Ft+St*Vt)),Xt(Ft-Xt(0)),Yt!==0)throw new Error(`Malformed buffer data: ${Yt}`)})(le,le.exports[Ce[Ie]],Ee,ue,we,Te,le.exports[_e[Ge]])}}}(fetch(xF()));return te.ready.then(()=>{iC=te})}()),v)for(let te=0;te<v.length;te++)$.push(une(v[te],h,te,l));return($.length?Promise.all($):Promise.resolve()).then(()=>{if(U&&x)for(const{primitives:te}of x)for(const re of te)ane(re,h);if(W&&x&&I)for(const te of I)lne(te,h);return h})})}function Kg(c,s){const l=c.json.bufferViews[s.bufferView],h=Y1[s.componentType];return new h(c.buffers[l.buffer],(s.byteOffset||0)+(l.byteOffset||0),s.count*(l.byteStride&&l.byteStride!==O0[s.type]*h.BYTES_PER_ELEMENT?l.byteStride/h.BYTES_PER_ELEMENT:O0[s.type]))}function oC(c,s,l,h){const p=Y1[s.componentType],v=function($){switch($){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(p),x=c.json.bufferViews[s.bufferView],P=x.byteStride?x.byteStride/p.BYTES_PER_ELEMENT:O0[s.type],I=l.float32,R=I.length/l.capacity;for(let $=0,U=0;$<s.count*P;$+=P,U+=R)for(let W=0;W<R;W++)I[U+W]=h[$+W]*v;l._trim()}function dne(c,s,l){const h=c.indices,p=c.attributes,v={};v.indexArray=new bs;const x=s.json.accessors[h],P=x.count/3;v.indexArray.reserve(P);const I=Kg(s,x);for(let W=0;W<P;W++)v.indexArray.emplaceBack(I[3*W],I[3*W+1],I[3*W+2]);v.indexArray._trim(),v.vertexArray=new Il;const R=s.json.accessors[p.POSITION];v.vertexArray.reserve(R.count);const $=Kg(s,R);for(let W=0;W<R.count;W++)v.vertexArray.emplaceBack($[3*W],$[3*W+1],$[3*W+2]);if(v.vertexArray._trim(),v.aabb=new Mi(R.min,R.max),v.centroid=function(W,te){const re=[0,0,0],le=W.length;if(le>0){for(let ve=0;ve<le;ve++){const _e=3*W[ve];re[0]+=te[_e],re[1]+=te[_e+1],re[2]+=te[_e+2]}re[0]/=le,re[1]/=le,re[2]/=le}return re}(I,$),p.COLOR_0!==void 0){const W=s.json.accessors[p.COLOR_0],te=O0[W.type],re=Kg(s,W);v.colorArray=te===3?new Il:new so,v.colorArray.resize(W.count),oC(s,W,v.colorArray,re)}if(p.NORMAL!==void 0){v.normalArray=new Il;const W=s.json.accessors[p.NORMAL];v.normalArray.resize(W.count);const te=Kg(s,W);oC(s,W,v.normalArray,te)}if(p.TEXCOORD_0!==void 0&&l.length>0){v.texcoordArray=new ju;const W=s.json.accessors[p.TEXCOORD_0];v.texcoordArray.resize(W.count);const te=Kg(s,W);oC(s,W,v.texcoordArray,te)}if(p._FEATURE_ID_RGBA4444!==void 0){const W=s.json.accessors[p._FEATURE_ID_RGBA4444];s.json.extensionsUsed&&s.json.extensionsUsed.includes("EXT_meshopt_compression")&&(v.featureData=Kg(s,W))}p._FEATURE_RGBA4444!==void 0&&(v.featureData=new Uint32Array(Kg(s,s.json.accessors[p._FEATURE_RGBA4444]).buffer));const U=c.material;return v.material=function(W,te){const{emissiveFactor:re=[0,0,0],alphaMode:le="OPAQUE",alphaCutoff:ve=.5,normalTexture:_e,occlusionTexture:Ce,emissiveTexture:Ee,doubleSided:ue}=W,{baseColorFactor:we=[1,1,1,1],metallicFactor:Te=1,roughnessFactor:Ie=1,baseColorTexture:Ge,metallicRoughnessTexture:Qe}=W.pbrMetallicRoughness||{},it=Ce?te[Ce.index]:void 0;if(Ce&&Ce.extensions&&Ce.extensions.KHR_texture_transform&&it){const ct=Ce.extensions.KHR_texture_transform;it.offsetScale=[ct.offset[0],ct.offset[1],ct.scale[0],ct.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Pn(...we),metallicFactor:Te,roughnessFactor:Ie,baseColorTexture:Ge?te[Ge.index]:void 0,metallicRoughnessTexture:Qe?te[Qe.index]:void 0},doubleSided:ue,emissiveFactor:re,alphaMode:le,alphaCutoff:ve,normalTexture:_e?te[_e.index]:void 0,occlusionTexture:it,emissionTexture:Ee?te[Ee.index]:void 0,defined:W.defined===void 0}}(U!==void 0?s.json.materials[U]:{defined:!1},l),v}function AF(c,s,l){const{matrix:h,rotation:p,translation:v,scale:x,mesh:P,extras:I,children:R}=c,$={};if($.matrix=h||function(U,W,te,re){var le=W[0],ve=W[1],_e=W[2],Ce=W[3],Ee=le+le,ue=ve+ve,we=_e+_e,Te=le*Ee,Ie=le*ue,Ge=le*we,Qe=ve*ue,it=ve*we,ct=_e*we,St=Ce*Ee,Vt=Ce*ue,Nt=Ce*we,Bt=re[0],Xt=re[1],xt=re[2];return U[0]=(1-(Qe+ct))*Bt,U[1]=(Ie+Nt)*Bt,U[2]=(Ge-Vt)*Bt,U[3]=0,U[4]=(Ie-Nt)*Xt,U[5]=(1-(Te+ct))*Xt,U[6]=(it+St)*Xt,U[7]=0,U[8]=(Ge+Vt)*xt,U[9]=(it-St)*xt,U[10]=(1-(Te+Qe))*xt,U[11]=0,U[12]=te[0],U[13]=te[1],U[14]=te[2],U[15]=1,U}([],p||[0,0,0,1],v||[0,0,0],x||[1,1,1]),P!==void 0){$.meshes=l[P];const U=$.anchor=[0,0];for(const W of $.meshes){const{min:te,max:re}=W.aabb;U[0]+=te[0]+re[0],U[1]+=te[1]+re[1]}U[0]=Math.floor(U[0]/$.meshes.length/2),U[1]=Math.floor(U[1]/$.meshes.length/2)}if(I&&(I.id&&($.id=I.id),I.lights&&($.lights=function(U){if(!U.length)return[];const W=function(_e){const Ce=atob(_e),Ee=new Uint8Array(Ce.length);for(let ue=0;ue<Ce.length;ue++)Ee[ue]=Ce.codePointAt(ue);return Ee}(U),te=[],re=W.length/24,le=new Uint16Array(W.buffer),ve=new Float32Array(W.buffer);for(let _e=0;_e<re;_e++){const Ce=le[2*_e*6]/30,Ee=le[2*_e*6+1]/30,ue=le[2*_e*6+10]/100,we=ve[6*_e+1],Te=ve[6*_e+2],Ie=ve[6*_e+3],Ge=ve[6*_e+4],Qe=Ie-we,it=Ge-Te,ct=Math.hypot(Qe,it);te.push({pos:[we+.5*Qe,Te+.5*it,Ee],normal:[it/ct,-Qe/ct,0],width:ct,height:Ce,depth:ue,points:[we,Te,Ie,Ge]})}return te}(I.lights))),R){const U=[];for(const W of R)U.push(AF(s.json.nodes[W],s,l));$.children=U}return $}function hne(c){if(c.vertices.length===0||c.indices.length===0)return null;const s=new uT(c.vertices,c.indices,8,256),[l,h]=[s.min.clone(),s.max.clone()];return{vertices:c.vertices,indices:c.indices,grid:s,min:l,max:h}}function fne(c){if(!c.extras||!c.extras.ground)return null;const s=c.extras.ground;if(!s||!Array.isArray(s)||s.length===0)return null;const l=s[0];if(!l||!Array.isArray(l)||l.length===0)return null;const h=[];for(const x of l){if(!Array.isArray(x)||x.length!==2)continue;const P=x[0],I=x[1];typeof P=="number"&&typeof I=="number"&&h.push(new Qt(P,I))}if(h.length<3)return null;h.length>1&&h[h.length-1].equals(h[0])&&h.pop();let p=0;for(let x=0;x<h.length;x++){const P=h[x],I=h[(x+1)%h.length],R=h[(x+2)%h.length];p+=(P.x-I.x)*(R.y-I.y)-(R.x-I.x)*(P.y-I.y)}p>0&&h.reverse();const v=gc(h.flatMap(x=>[x.x,x.y]),[]);return v.length===0?null:{vertices:h,indices:v}}function pne(c,s){const l=[],h=[];let p=0;const v=[];for(const x of c){p=l.length;const P=x.vertexArray.float32,I=x.indexArray.uint16;for(let R=0;R<x.vertexArray.length;R++)v[0]=P[3*R+0],v[1]=P[3*R+1],v[2]=P[3*R+2],Tt(v,v,s),l.push(new Qt(v[0],v[1]));for(let R=0;R<3*x.indexArray.length;R++)h.push(I[R]+p)}if(h.length%3!=0)return null;for(let x=0;x<h.length;x+=3){const P=l[h[x+0]],I=l[h[x+1]],R=l[h[x+2]];(P.x-I.x)*(R.y-I.y)-(R.x-I.x)*(P.y-I.y)>0&&([h[x+1],h[x+2]]=[h[x+2],h[x+1]])}return{vertices:l,indices:h}}function PF(c){const s=function(I,R){const $=[],U=WebGL2RenderingContext;if(I.json.textures)for(const W of I.json.textures){const te={magFilter:U.LINEAR,minFilter:U.NEAREST,wrapS:U.REPEAT,wrapT:U.REPEAT};W.sampler!==void 0&&Object.assign(te,I.json.samplers[W.sampler]),$.push({image:R[W.source],sampler:te,uploaded:!1})}return $}(c,c.images),l=function(I,R){const $=[];for(const U of I.json.meshes){const W=[];for(const te of U.primitives)W.push(dne(te,I,R));$.push(W)}return $}(c,s),{scenes:h,scene:p,nodes:v}=c.json,x=h?h[p||0].nodes:v,P=[];for(const I of x)P.push(AF(v[I],c,l));return function(I,R,$){const U={},W=new Set;for(let te=0;te<I.length;te++){const re=$[R[te]];if(!re.extras)continue;const le=re.extras["mapbox:footprint:version"],ve=re.extras["mapbox:footprint:id"];(le||ve)&&W.add(te),le==="1.0.0"&&ve&&(U[ve]=te)}for(let te=0;te<I.length;te++){if(W.has(te))continue;const re=I[te],le=$[R[te]];if(!le.extras)continue;let ve=null;re.id in U&&(ve=pne(I[U[re.id]].meshes,re.matrix)),ve||(ve=fne(le)),ve&&(re.footprint=hne(ve))}if(W.size>0){const te=Array.from(W.values()).sort((re,le)=>re-le);for(let re=te.length-1;re>=0;re--)I.splice(te[re],1)}}(P,x,c.json.nodes),P}function mne(c){c.heightmap=new Float32Array(4096),c.heightmap.fill(-1);const s=c.vertexArray.float32,l=c.aabb.min[0]-1,h=c.aabb.min[1]-1,p=Wg/(c.aabb.max[0]-l+2),v=Wg/(c.aabb.max[1]-h+2);for(let x=0;x<s.length;x+=3){const P=s[x+2],I=(s[x+0]-l)*p|0,R=(s[x+1]-h)*v|0;P>c.heightmap[R*Wg+I]&&(c.heightmap[R*Wg+I]=P)}}function gne(c,s){const l={};l.indexArray=new bs,l.indexArray.reserve(4*c.length),l.vertexArray=new Il,l.vertexArray.reserve(10*c.length),l.colorArray=new so,l.vertexArray.reserve(10*c.length);let h=0;for(const x of c){const P=Math.min(10,Math.max(4,1.3*x.height))*s,I=[-x.normal[1],x.normal[0],0],R=Math.min(.29,.1*x.width/x.depth),$=x.width-2*x.depth*s*(R+.01),U=De([],x.pos,I,$/2),W=De([],x.pos,I,-$/2),te=[U[0],U[1],U[2]+x.height],re=[W[0],W[1],W[2]+x.height],le=De([],x.normal,I,R);Ue(le,le,P);const ve=De([],x.normal,I,-R);Ue(ve,ve,P),Je(le,U,le),Je(ve,W,ve),U[2]+=.1,W[2]+=.1,l.vertexArray.emplaceBack(le[0],le[1],le[2]),l.vertexArray.emplaceBack(ve[0],ve[1],ve[2]),l.vertexArray.emplaceBack(U[0],U[1],U[2]),l.vertexArray.emplaceBack(W[0],W[1],W[2]),l.vertexArray.emplaceBack(te[0],te[1],te[2]),l.vertexArray.emplaceBack(re[0],re[1],re[2]),l.vertexArray.emplaceBack(U[0],U[1],U[2]),l.vertexArray.emplaceBack(W[0],W[1],W[2]),l.vertexArray.emplaceBack(le[0],le[1],le[2]),l.vertexArray.emplaceBack(ve[0],ve[1],ve[2]);const _e=$/P/2;l.colorArray.emplaceBack(-_e-R,-1,_e,.8),l.colorArray.emplaceBack(_e+R,-1,_e,.8),l.colorArray.emplaceBack(-_e,0,_e,1.3),l.colorArray.emplaceBack(_e,0,_e,1.3),l.colorArray.emplaceBack(_e+R,-.8,_e,.7),l.colorArray.emplaceBack(_e+R,-.8,_e,.7),l.colorArray.emplaceBack(0,0,_e,1.3),l.colorArray.emplaceBack(0,0,_e,1.3),l.colorArray.emplaceBack(_e+R,-1.2,_e,.8),l.colorArray.emplaceBack(_e+R,-1.2,_e,.8),l.indexArray.emplaceBack(6+h,4+h,8+h),l.indexArray.emplaceBack(7+h,9+h,5+h),l.indexArray.emplaceBack(0+h,1+h,2+h),l.indexArray.emplaceBack(1+h,3+h,2+h),h+=10}const p={defined:!0,emissiveFactor:[0,0,0]},v={};return v.baseColorFactor=Pn.white,p.pbrMetallicRoughness=v,l.material=p,l.aabb=new Mi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),l}class MF{constructor(s){this._stringToNumber={},this._numberToString=[];for(let l=0;l<s.length;l++){const h=s[l];this._stringToNumber[h]=l,this._numberToString[l]=h}}encode(s){return this._stringToNumber[s]}decode(s){return this._numberToString[s]}}const yne=["id","tile","layer","source","sourceLayer","state"];class uv{constructor(s,l,h,p,v){this.type="Feature",this._vectorTileFeature=s,this._z=l,this._x=h,this._y=p,this.properties=s.properties,this.id=v}clone(){const s=new uv(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(s.state=Object.assign({},this.state)),this.layer&&(s.layer=Object.assign({},this.layer)),this.source&&(s.source=this.source),this.sourceLayer&&(s.sourceLayer=this.sourceLayer),s}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(s){this._geometry=s}toJSON(){const s={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const l of yne)this[l]!==void 0&&(s[l]=this[l]);return s}}class IF{constructor(s,l){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new Mu(or,16,0),this.featureIndexArray=new lm,this.promoteId=l,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(s,l,h,p,v,x=0,P=0){const I=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,p,v,x);const R=this.grid;for(let $=0;$<l.length;$++){const U=l[$],W=[1/0,1/0,-1/0,-1/0];for(let te=0;te<U.length;te++){const re=U[te];W[0]=Math.min(W[0],re.x),W[1]=Math.min(W[1],re.y),W[2]=Math.max(W[2],re.x),W[3]=Math.max(W[3],re.y)}P!==0&&(W[0]-=P,W[1]-=P,W[2]+=P,W[3]+=P),W[0]<or&&W[1]<or&&W[2]>=0&&W[3]>=0&&R.insert(I,W[0],W[1],W[2],W[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new vm.VectorTile(new v1(this.rawTileData)).layers,this.sourceLayerCoder=new MF(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const s in this.vtLayers)this.vtFeatures[s]=[]}return this.vtLayers}query(s,l){const{tilespaceGeometry:h,transform:p,tileTransform:v,pixelPosMatrix:x,availableImages:P}=l;this.loadVTLayers(),this.serializedLayersCache.clear();const I=h.bufferedTilespaceBounds,R=this.grid.query(I.min.x,I.min.y,I.max.x,I.max.y,(te,re,le,ve)=>Ss(h.bufferedTilespaceGeometry,te,re,le,ve));R.sort(vne);let $=null;p.elevation&&R.length>0&&($=iv.create(p.elevation,this.tileID));const U={};let W;for(let te=0;te<R.length;te++){const re=R[te];if(re===W)continue;W=re;const le=this.featureIndexArray.get(re);let ve=null;this.is3DTile?this.loadMatchingModelFeature(U,le,s,h,p):this.loadMatchingFeature(U,le,s,P,(_e,Ce,Ee,ue=0)=>(ve||(ve=wr(_e,this.tileID.canonical,v)),Ce.queryIntersectsFeature(h,_e,Ee,ve,this.z,p,x,$,ue)))}return U}loadMatchingFeature(s,l,h,p,v){const{featureIndex:x,bucketIndex:P,sourceLayerIndex:I,layoutVertexArrayOffset:R}=l,$=this.bucketLayerIDs[P],U=h.layers,W=Object.keys(U);if(W.length&&!function(_e,Ce){for(let Ee=0;Ee<_e.length;Ee++)if(Ce.indexOf(_e[Ee])>=0)return!0;return!1}(W,$))return;const te=h.sourceCache,re=this.sourceLayerCoder.decode(I),le=this.vtLayers[re].feature(x),ve=this.getId(le,re);for(let _e=0;_e<$.length;_e++){const Ce=$[_e];if(!U[Ce])continue;const{styleLayer:Ee,targets:ue}=U[Ce];let we={};ve!==void 0&&(we=te.getFeatureState(Ee.sourceLayer,ve));const Te=!v||v(le,Ee,we,R);if(!Te)continue;const Ie=new uv(le,this.z,this.x,this.y,ve);Ie.tile=this.tileID.canonical,Ie.state=we;let Ge=this.serializedLayersCache.get(Ce);Ge||(Ge=Ee.serialize(),Ge.id=Ce,this.serializedLayersCache.set(Ce,Ge)),Ie.source=Ge.source,Ie.sourceLayer=Ge["source-layer"],Ie.layer=pt({},Ge),Ie.layer.paint=kF(Ge.paint,Ee.paint,le,we,p),Ie.layer.layout=kF(Ge.layout,Ee.layout,le,we,p);let Qe=!1;for(const it of ue){this.updateFeatureProperties(Ie,it);const{filter:ct}=it;if(ct){if(le.properties=Ie.properties,ct.needGeometry){const St=Ar(le,!0);if(!ct.filter(new ni(this.tileID.overscaledZ),St,this.tileID.canonical))continue}else if(!ct.filter(new ni(this.tileID.overscaledZ),le))continue}Qe=!0,it.targetId&&this.addFeatureVariant(Ie,it)}Qe&&this.appendToResult(s,Ce,x,Ie,Te)}}loadMatchingModelFeature(s,l,h,p,v){const x=this.bucketLayerIDs[0][0],P=h.layers;if(!P[x])return;const{styleLayer:I,targets:R}=P[x];if(I.type!=="model")return;const $=p.tile,U=l.featureIndex,W=$.getBucket(I);if(!(W&&W instanceof $1))return;const te=function(Ge,Qe,it,ct){const St=Ge.getNodesInfo()[Qe];if(St.hiddenByReplacement||!St.node.meshes)return;let Vt=Number.MAX_VALUE;const Nt=St.node,Bt=it.tile,Xt=ct.calculatePosMatrix(Bt.tileID.toUnwrapped(),ct.worldSize),xt=St.evaluatedScale;let Ft=0;ct.elevation&&Nt.elevation&&(Ft=Nt.elevation*ct.elevation.exaggeration()),H(Xt,Xt,[(Nt.anchor?Nt.anchor[0]:0)*(xt[0]-1),(Nt.anchor?Nt.anchor[1]:0)*(xt[1]-1),Ft]),Z(Xt,Xt,xt);const _t=it.queryGeometry,wt=_t.isPointQuery()?_t.screenBounds:_t.screenGeometry,Yt=function(Or){const Tr=V([],Xt,Or.matrix);V(Tr,ct.expandedFarZProjMatrix,Tr);for(let hr=0;hr<Or.meshes.length;++hr){const Kt=Or.meshes[hr];if(hr===Or.lightMeshIndex)continue;const tn=Iz(wt,ct,Tr,Kt.aabb);tn!=null&&(Vt=Math.min(tn,Vt))}if(Or.children)for(const hr of Or.children)Yt(hr)};if(Yt(Nt),Vt===Number.MAX_VALUE)return;const tr=new he(0,0);return $z(Bt.tileID.canonical,tr,St.node.anchor[0],St.node.anchor[1]),{intersectionZ:Vt,position:tr,feature:St.feature}}(W,U,p,v);if(!te)return;const{z:re,x:le,y:ve}=$.tileID.canonical,{feature:_e,intersectionZ:Ce,position:Ee}=te;let ue={};_e.id!==void 0&&(ue=h.sourceCache.getFeatureState(I.sourceLayer,_e.id));const we=new uv({},re,le,ve,_e.id);we.tile=this.tileID.canonical,we.state=ue,we.properties=_e.properties,we.geometry={type:"Point",coordinates:[Ee.lng,Ee.lat]};let Te=this.serializedLayersCache.get(x);Te||(Te=I.serialize(),Te.id=x,this.serializedLayersCache.set(x,Te)),we.source=Te.source,we.sourceLayer=Te["source-layer"],we.layer=pt({},Te);let Ie=!1;for(const Ge of R){this.updateFeatureProperties(we,Ge);const{filter:Qe}=Ge;if(Qe){if(_e.properties=we.properties,Qe.needGeometry){if(!Qe.filter(new ni(this.tileID.overscaledZ),_e,this.tileID.canonical))continue}else if(!Qe.filter(new ni(this.tileID.overscaledZ),_e))continue}Ie=!0,Ge.targetId&&this.addFeatureVariant(we,Ge)}Ie&&this.appendToResult(s,x,U,we,Ce)}updateFeatureProperties(s,l,h){if(l.properties){const p={};for(const v in l.properties){const x=l.properties[v].evaluate({zoom:this.z},s._vectorTileFeature,s.state,s.tile,h);x!=null&&(p[v]=x)}s.properties=p}}addFeatureVariant(s,l,h){const p={target:l.target,namespace:l.namespace,uniqueFeatureID:l.uniqueFeatureID};l.properties&&(p.properties=s.properties),s.variants=s.variants||{},s.variants[l.targetId]=s.variants[l.targetId]||[],s.variants[l.targetId].push(p)}appendToResult(s,l,h,p,v){let x=s[l];x===void 0&&(x=s[l]=[]),x.push({featureIndex:h,feature:p,intersectionZ:v})}lookupSymbolFeatures(s,l,h,p,v){const x={};this.loadVTLayers();for(const P of s)this.loadMatchingFeature(x,{bucketIndex:l,sourceLayerIndex:h,featureIndex:P,layoutVertexArrayOffset:0},p,v);return x}loadFeature(s){const{featureIndex:l,sourceLayerIndex:h}=s;this.loadVTLayers();const p=this.sourceLayerCoder.decode(h),v=this.vtFeatures[p];if(v[l])return v[l];const x=this.vtLayers[p].feature(l);return v[l]=x,x}hasLayer(s){for(const l of this.bucketLayerIDs)for(const h of l)if(s===h)return!0;return!1}getId(s,l){let h=s.id;if(this.promoteId){const p=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[l];if(p!=null)if(Array.isArray(p)){if(!this.promoteIdExpression){const v=Td(p);if(v.result!=="success"){const x=v.value.map(P=>`${P.key}: ${P.message}`).join(", ");return void sn(`Failed to create expression for promoteId: ${x}`)}this.promoteIdExpression=v.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Oc),h=this.promoteIdExpression.evaluate({zoom:0},s)}else h=s.properties[p];typeof h=="boolean"&&(h=Number(h))}return h}}function kF(c,s,l,h,p){return Xr(c,(v,x)=>{const P=s instanceof Ml?s.get(x):null;return P&&P.evaluate?P.evaluate(l,h,void 0,p):P})}function vne(c,s){return s-c}yr(IF,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const OF=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class aC{static from(s){if(!(s instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,h]=new Uint8Array(s,0,2);if(l!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=h>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const v=OF[15&h];if(!v)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(s,2,1),[P]=new Uint32Array(s,4,1);return new aC(P,x,v,s)}constructor(s,l=64,h=Float64Array,p){if(isNaN(s)||s<0)throw new Error(`Unpexpected numItems value: ${s}.`);this.numItems=+s,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=h,this.IndexArrayType=s<65536?Uint16Array:Uint32Array;const v=OF.indexOf(this.ArrayType),x=2*s*this.ArrayType.BYTES_PER_ELEMENT,P=s*this.IndexArrayType.BYTES_PER_ELEMENT,I=(8-P%8)%8;if(v<0)throw new Error(`Unexpected typed array class: ${h}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+P+I,2*s),this._pos=2*s,this._finished=!0):(this.data=new ArrayBuffer(8+x+P+I),this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+P+I,2*s),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+v]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=s)}add(s,l){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=s,this.coords[this._pos++]=l,h}finish(){const s=this._pos>>1;if(s!==this.numItems)throw new Error(`Added ${s} items when expected ${this.numItems}.`);return lC(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(s,l,h,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:x,nodeSize:P}=this,I=[0,v.length-1,0],R=[];for(;I.length;){const $=I.pop()||0,U=I.pop()||0,W=I.pop()||0;if(U-W<=P){for(let ve=W;ve<=U;ve++){const _e=x[2*ve],Ce=x[2*ve+1];_e>=s&&_e<=h&&Ce>=l&&Ce<=p&&R.push(v[ve])}continue}const te=W+U>>1,re=x[2*te],le=x[2*te+1];re>=s&&re<=h&&le>=l&&le<=p&&R.push(v[te]),($===0?s<=re:l<=le)&&(I.push(W),I.push(te-1),I.push(1-$)),($===0?h>=re:p>=le)&&(I.push(te+1),I.push(U),I.push(1-$))}return R}within(s,l,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:v,nodeSize:x}=this,P=[0,p.length-1,0],I=[],R=h*h;for(;P.length;){const $=P.pop()||0,U=P.pop()||0,W=P.pop()||0;if(U-W<=x){for(let ve=W;ve<=U;ve++)RF(v[2*ve],v[2*ve+1],s,l)<=R&&I.push(p[ve]);continue}const te=W+U>>1,re=v[2*te],le=v[2*te+1];RF(re,le,s,l)<=R&&I.push(p[te]),($===0?s-h<=re:l-h<=le)&&(P.push(W),P.push(te-1),P.push(1-$)),($===0?s+h>=re:l+h>=le)&&(P.push(te+1),P.push(U),P.push(1-$))}return I}}function lC(c,s,l,h,p,v){if(p-h<=l)return;const x=h+p>>1;LF(c,s,x,h,p,v),lC(c,s,l,h,x-1,1-v),lC(c,s,l,x+1,p,1-v)}function LF(c,s,l,h,p,v){for(;p>h;){if(p-h>600){const R=p-h+1,$=l-h+1,U=Math.log(R),W=.5*Math.exp(2*U/3),te=.5*Math.sqrt(U*W*(R-W)/R)*($-R/2<0?-1:1);LF(c,s,l,Math.max(h,Math.floor(l-$*W/R+te)),Math.min(p,Math.floor(l+(R-$)*W/R+te)),v)}const x=s[2*l+v];let P=h,I=p;for(L0(c,s,h,l),s[2*p+v]>x&&L0(c,s,h,p);P<I;){for(L0(c,s,P,I),P++,I--;s[2*P+v]<x;)P++;for(;s[2*I+v]>x;)I--}s[2*h+v]===x?L0(c,s,h,I):(I++,L0(c,s,I,p)),I<=l&&(h=I+1),l<=I&&(p=I-1)}}function L0(c,s,l,h){cC(c,l,h),cC(s,2*l,2*h),cC(s,2*l+1,2*h+1)}function cC(c,s,l){const h=c[s];c[s]=c[l],c[l]=h}function RF(c,s,l,h){const p=c-l,v=s-h;return p*p+v*v}i.$=Ro,i.A=Hl,i.B=Qa,i.C=ac,i.D=sv,i.E=Zl,i.F=2,i.G=m0,i.H=q3,i.I=la,i.J=class extends F1{},i.K=Zr,i.L=ud,i.M=Va,i.N=zf,i.O=ys,i.P=Qt,i.Q=Gp,i.R=hu,i.S=Ed,i.T=zT,i.U=Ua,i.V=F1,i.W=Rh,i.X=Td,i.Y=Sh,i.Z=Eu,i._=Su,i.a=function(c){return cs.API_CDN_URL_REGEX.test(c)},i.a$=ar,i.a0=dh,i.a1=fa,i.a2=Oh,i.a3=sl,i.a4=function(c){const s=c.value;let l=[];if(!s)return l;const h=Zr(s);return h!=="string"?(l=l.concat([new F1(c.key,s,`string expected, "${h}" found`)]),l):(VT(s,!0)||(l=l.concat([new F1(c.key,s,`invalid url "${s}"`)])),l)},i.a5=ft,i.a6=ku,i.a7=qi,i.a8=er,i.a9=class{constructor(c){this.specification=c}possiblyEvaluate(c,s){return on(c.expression.evaluate(s))}interpolate(c,s,l){return{x:Br(c.x,s.x,l),y:Br(c.y,s.y,l),z:Br(c.z,s.z,l),azimuthal:Br(c.azimuthal,s.azimuthal,l),polar:Br(c.polar,s.polar,l)}}},i.aA=$r,i.aB=oi,i.aC=Lt,i.aD=rt,i.aE=C,i.aF=function(c,s){const l={};for(let h=0;h<s.length;h++){const p=s[h];p in c&&(l[p]=c[p])}return l},i.aG=Se,i.aH=je,i.aI=class{constructor(c){this.entries={},this.scheduler=c}request(c,s,l,h){const p=this.entries[c]=this.entries[c]||{callbacks:[]};if(p.result){const[v,x]=p.result;return this.scheduler?this.scheduler.add(()=>{h(v,x)},s):h(v,x),()=>{}}return p.callbacks.push(h),p.cancel||(p.cancel=l((v,x)=>{p.result=[v,x];for(const P of p.callbacks)this.scheduler?this.scheduler.add(()=>{P(v,x)},s):P(v,x);setTimeout(()=>delete this.entries[c],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(v=>v!==h),p.callbacks.length||(p.cancel(),delete this.entries[c]))}}},i.aJ=function(c,s,l){const h=JSON.stringify(c.request);return c.data&&(this.deduped.entries[h]={result:[null,c.data]}),this.deduped.request(h,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom},p=>{const v=ql(c.request,(x,P,I,R)=>{x?p(x):P&&p(null,{vectorTile:l?void 0:new vm.VectorTile(new v1(P)),rawData:P,cacheControl:I,expires:R})});return()=>{v.cancel(),p()}},s)},i.aK=function(c){ih++,ih>ka&&(c.getActor().send("enforceCacheSizeLimit",Mc),ih=0)},i.aL=function(c){return c<=1?1:Math.pow(2,Math.floor(Math.log(c)/Math.LN2))},i.aM=ds,i.aN=_z,i.aO=Tz,i.aP=vz,i.aQ=function(c,s){const l=document.createElement("video");l.muted=!0,l.onloadstart=function(){s(null,l)};for(let h=0;h<c.length;h++){const p=document.createElement("source");q_(c[h])||(l.crossOrigin="Anonymous"),p.src=c[h],l.appendChild(p)}return{cancel:()=>{}}},i.aR=R1,i.aS=function(c){return fetch(c).then(s=>s.arrayBuffer()).then(s=>CF(s,0,c))},i.aT=PF,i.aU=class{constructor(c,s,l,h){this.id=c,this.position=s!=null?new he(s[0],s[1]):new he(0,0),this.orientation=l??[0,0,0],this.nodes=h,this.uploaded=!1,this.aabb=new Mi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(c,s){if(V(c.matrix,s,c.matrix),c.meshes)for(const l of c.meshes){const h=Mi.applyTransformFast(l.aabb,c.matrix);this.aabb.encapsulate(h)}if(c.children)for(const l of c.children)this._applyTransformations(l,c.matrix)}computeBoundsAndApplyParent(){const c=O([]);for(const s of this.nodes)this._applyTransformations(s,c)}computeModelMatrix(c,s,l,h,p,v,x=!1){Dz(this.matrix,this,c.transform,this.position,s,l,h,p,v,x)}upload(c){if(!this.uploaded){for(const s of this.nodes)qT(s,c);for(const s of this.nodes)B1(s);this.uploaded=!0}}destroy(){for(const c of this.nodes)GT(c)}},i.aV=Ur,i.aW=y0,i.aX=qe,i.aY=Ze,i.aZ=Lu,i.a_=bs,i.aa=ni,i.ab=Pl,i.ac=gt,i.ad=Tt,i.ae=ze,i.af=nt,i.ag=Ml,i.ah=Zh,i.ai=Br,i.aj=or,i.ak=hh,i.al=ae,i.am=Pn,i.an=class{constructor(c){this.specification=c}possiblyEvaluate(c,s){return function([l,h]){const p=on([1,l,h]);return{x:p.x,y:p.y,z:p.z}}(c.expression.evaluate(s))}interpolate(c,s,l){return{x:Br(c.x,s.x,l),y:Br(c.y,s.y,l),z:Br(c.z,s.z,l)}}},i.ao=function(c,s,l=0,h=!0){const p=new Qt(l,l),v=c.sub(p),x=s.add(p),P=[v,new Qt(x.x,v.y),x,new Qt(v.x,x.y)];return h&&P.push(v.clone()),P},i.ap=function(c,s){const l=[];for(let h=0;h<c.length;h++){const p=mt(h-1,-1,c.length-1),v=mt(h+1,-1,c.length-1),x=c[h],P=c[v],I=c[p].sub(x).unit(),R=P.sub(x).unit(),$=R.angleWithSep(I.x,I.y),U=I.add(R).unit().mult(-1*s/Math.sin($/2));l.push(x.add(U))}return l},i.aq=iz,i.ar=Ss,i.as=function(c,s,l=0){return Xe(((s.x-l)*c.scale-c.x)*or,(s.y*c.scale-c.y)*or,yt(s.z,s.y))},i.at=Rt,i.au=Ve,i.av=Rl,i.aw=g3,i.ax=function(c){let s=1/0,l=1/0,h=-1/0,p=-1/0;for(const v of c)s=Math.min(s,v.x),l=Math.min(l,v.y),h=Math.max(h,v.x),p=Math.max(p,v.y);return{min:new Qt(s,l),max:new Qt(h,p)}},i.ay=Fe,i.az=V,i.b=function(c){return cs.API_FONTS_REGEX.test(c)},i.b$=Ue,i.b0=tp,i.b1=O1,i.b2=function(){Sa.isLoading()||Sa.isLoaded()||us()!=="deferred"||Vf()},i.b3=kd,i.b4=Ar,i.b5=uv,i.b6=li,i.b7=gT,i.b8=cT,i.b9=wr,i.bA=function(c,s){const{x:l,y:h}=c.point,p=ym(l,h,c.worldSize/c._pixelsPerMercatorPixel,0,0);return V(p,p,r0(jl(s)))},i.bB=T,i.bC=function(c){return c[0]=0,c[1]=0,c[2]=0,c},i.bD=function(c,s){return Math.hypot(s[0]-c[0],s[1]-c[1],s[2]-c[2])},i.bE=Et,i.bF=De,i.bG=kt,i.bH=p0,i.bI=Dl,i.bJ=ET,i.bK=function(c,s,l,h,p){const v=5*s+2;c.float32[v+0]=l,c.float32[v+1]=h,c.float32[v+2]=p},i.bL=k1,i.bM=y1,i.bN=jr,i.bO=Co,i.bP=zN,i.bQ=kz,i.bR=UN,i.bS=qN,i.bT=PT,i.bU=Y3,i.bV=ST,i.bW=aC,i.bX=mt,i.bY=un,i.bZ=function(c,s,l){l*=.5;var h=s[0],p=s[1],v=s[2],x=s[3],P=Math.sin(l),I=Math.cos(l);return c[0]=h*I+p*P,c[1]=p*I-h*P,c[2]=v*I+x*P,c[3]=x*I-v*P,c},i.b_=Fn,i.ba=lc,i.bb=Qf,i.bc=Ws,i.bd=ji,i.be=gc,i.bf=jT,i.bg=function(c,s){const l=Zh(s.zoom);if(l===0)return jl(c);const h=jg(c),p=Dg(h),v=Fe(h.getWest())*s.worldSize,x=Fe(h.getEast())*s.worldSize,P=je(h.getNorth())*s.worldSize,I=je(h.getSouth())*s.worldSize,R=[v,P,0],$=[x,P,0],U=[v,I,0],W=[x,I,0],te=N([],s.globeMatrix);return Tt(R,R,te),Tt($,$,te),Tt(U,U,te),Tt(W,W,te),p[0]=Bu(p[0],U,l),p[1]=Bu(p[1],W,l),p[2]=Bu(p[2],$,l),p[3]=Bu(p[3],R,l),Mi.fromPoints(p)},i.bh=zg,i.bi=N,i.bj=Wh,i.bk=Bu,i.bl=Gf,i.bm=dl,i.bn=ie,i.bo=H,i.bp=K1,i.bq=v1,i.br=ql,i.bs=function(c,s){const l=[];for(const h in c)h in s||l.push(h);return l},i.bt=Ct,i.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.bv=Hs,i.bw=function(c){var s=new w(16);return s[0]=c[0],s[1]=c[1],s[2]=c[2],s[3]=c[3],s[4]=c[4],s[5]=c[5],s[6]=c[6],s[7]=c[7],s[8]=c[8],s[9]=c[9],s[10]=c[10],s[11]=c[11],s[12]=c[12],s[13]=c[13],s[14]=c[14],s[15]=c[15],s},i.bx=O,i.by=Y,i.bz=D,i.c=nd,i.c$=function(c){return c({pluginStatus:no,pluginURL:sc}),Dh.on("pluginStateChange",c),c},i.c0=sr,i.c1=Ci,i.c2=function(c,s){return c[0]=-s[0],c[1]=-s[1],c[2]=-s[2],c[3]=s[3],c},i.c3=ge,i.c4=function(c,s,l,h,p){var v,x=1/Math.tan(s/2);return c[0]=x/l,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=x,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,p!=null&&p!==1/0?(c[10]=(p+h)*(v=1/(h-p)),c[14]=2*p*h*v):(c[10]=-1,c[14]=-2*h),c},i.c5=function(c,s,l,h,p,v,x){var P=1/(s-l),I=1/(h-p),R=1/(v-x);return c[0]=-2*P,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*I,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*R,c[11]=0,c[12]=(s+l)*P,c[13]=(p+h)*I,c[14]=(x+v)*R,c[15]=1,c},i.c6=ke,i.c7=function(c,s,l){c[4*s+0]=l[0],c[4*s+1]=l[1],c[4*s+2]=l[2],c[4*s+3]=l[3]},i.c8=uc,i.c9=Ol,i.cA=N1,i.cB=be,i.cC=Cz,i.cD=function(c){const s=Cz(c,!0);return T([],[s[0],s[1],s[4],s[5]])},i.cE=Z,i.cF=qa,i.cG=J,i.cH=function(c){const{x:s,y:l}=c.point,{lng:h,lat:p}=c._center;return ym(s,l,c.worldSize,h,p)},i.cI=st,i.cJ=oe,i.cK=yo,i.cL=M,i.cM=function(c,s,l){let h=0;for(let p=0;p<2;++p)c[p]>0&&(h+=(c[p]-0)*(c[p]-0)),s[p]<0&&(h+=(0-s[p])*(0-s[p]));return h},i.cN=45,i.cO=jp,i.cP=Be,i.cQ=go,i.cR=function(c,s,l){const h=Math.sqrt(c*c+s*s+l*l),p=h>0?Math.acos(l/h)*dt:0;let v=c!==0||s!==0?Math.atan2(-s,-c)*dt+90:0;return v<0&&(v+=360),[h,v,p]},i.cS=Xe,i.cT=at,i.cU=Je,i.cV=Mi,i.cW=on,i.cX=function(c){return[Math.pow(c[0],1/2.2),Math.pow(c[1],1/2.2),Math.pow(c[2],1/2.2)]},i.cY=tt,i.cZ=VT,i.c_=function(c,s){return c.readFields(mre,{icons:[]},s)},i.ca=Du,i.cb=ws,i.cc=mo,i.cd=he,i.ce=cz,i.cf=function(){var c=new w(4);return w!=Float32Array&&(c[1]=0,c[2]=0),c[0]=1,c[3]=1,c},i.cg=function(c,s,l){var h=s[0],p=s[1],v=s[2],x=s[3],P=Math.sin(l),I=Math.cos(l);return c[0]=h*I+v*P,c[1]=p*I+x*P,c[2]=h*-P+v*I,c[3]=p*-P+x*I,c},i.ch=function(c,s){return c[0]===s[0]&&c[1]===s[1]&&c[2]===s[2]&&c[3]===s[3]},i.ci=Jt,i.cj=function(c){return Math.hypot(c[0],c[1],c[2],c[3])},i.ck=Ui,i.cl=ur,i.cm=oo,i.cn=Nd,i.co=Az,i.cp=Mn,i.cq=s1,i.cr=function(c,s,l,h,p,v,x,P,I){if(I.name==="globe")return s1(c,s,new Mn(l,h,p),!1);const R=y0({z:l,x:h,y:p},I);return new Mi([(v+R.x/R.scale)*s,s*(R.y/R.scale),x],[(v+R.x2/R.scale)*s,s*(R.y2/R.scale),P])},i.cs=function(c,s,l){return c[0]=Math.min(s[0],l[0]),c[1]=Math.min(s[1],l[1]),c[2]=Math.min(s[2],l[2]),c[3]=Math.min(s[3],l[3]),c},i.ct=function(c,s,l){return c[0]=Math.max(s[0],l[0]),c[1]=Math.max(s[1],l[1]),c[2]=Math.max(s[2],l[2]),c[3]=Math.max(s[3],l[3]),c},i.cu=function(c){const s=Math.round((c+45+360)%360/90)%4;return pe[s]},i.cv=ut,i.cw=Vr,i.cx=L,i.cy=function(c){const s=O(new Float64Array(16));V(s,c.pixelMatrix,c.globeMatrix);const l=[0,ee,0],h=[0,Q,0];return Tt(l,l,s),Tt(h,h,s),[l[0]>0&&l[0]<=c.width&&l[1]>0&&l[1]<=c.height&&!_(c,new he(c.center.lat,90)),h[0]>0&&h[0]<=c.width&&h[1]>0&&h[1]<=c.height&&!_(c,new he(c.center.lat,-90))]},i.cz=function(c,s){const{scale:l}=c.tileTransform,h=l*or/(c.tileSize*Math.pow(2,s.zoom-c.tileID.overscaledZ+c.tileID.canonical.z));return function(p,v,x){var P=v[1],I=v[2],R=v[3],$=x[0],U=x[1];return p[0]=v[0]*$,p[1]=P*$,p[2]=I*U,p[3]=R*U,p}(new Float32Array(4),s.inverseAdjustmentMatrix,[h,h])},i.d=function(c){return cs.API_TILEJSON_REGEX.test(c)},i.d$=nm,i.d0=V1,i.d1=ev,i.d2=CT,i.d3=Un,i.d4=al,i.d5=Wo,i.d6=ko,i.d7=nn,i.d8=function(c){const s=c.indexOf(Nh);return s>=0?c.slice(0,s):c},i.d9=function(c){return c.indexOf(Nh)>=0},i.dA=o1,i.dB=xs,i.dC=Qs,i.dD=256,i.dE=function(c,s){const l=[0,0,0];return Tt(l,l,zg(jl(s.canonical))),Tt(l,l,c),l},i.dF=c=>({u_camera_to_center_distance:new ws(c),u_extrude_scale:new ll(c),u_device_pixel_ratio:new ws(c),u_matrix:new uc(c),u_inv_rot_matrix:new uc(c),u_merc_center:new Ol(c),u_tile_id:new Du(c),u_zoom_transition:new ws(c),u_up_dir:new Du(c),u_emissive_strength:new ws(c)}),i.dG=c=>({u_matrix:new uc(c),u_pixels_to_tile_units:new ll(c),u_device_pixel_ratio:new ws(c),u_width_scale:new ws(c),u_floor_width_scale:new ws(c),u_units_to_pixels:new Ol(c),u_dash_image:new mo(c),u_gradient_image:new mo(c),u_image_height:new ws(c),u_texsize:new Ol(c),u_tile_units_to_pixels:new ws(c),u_alpha_discard_threshold:new ws(c),u_trim_offset:new Ol(c),u_trim_fade_range:new Ol(c),u_trim_color:new go(c),u_emissive_strength:new ws(c),u_zbias_factor:new ws(c),u_tile_to_meter:new ws(c),u_ground_shadow_factor:new Du(c)}),i.dH=c=>({u_matrix:new uc(c),u_texsize:new Ol(c),u_pixels_to_tile_units:new ll(c),u_device_pixel_ratio:new ws(c),u_width_scale:new ws(c),u_floor_width_scale:new ws(c),u_image:new mo(c),u_units_to_pixels:new Ol(c),u_tile_units_to_pixels:new ws(c),u_alpha_discard_threshold:new ws(c),u_trim_offset:new Ol(c),u_trim_fade_range:new Ol(c),u_trim_color:new go(c),u_emissive_strength:new ws(c),u_zbias_factor:new ws(c),u_tile_to_meter:new ws(c),u_ground_shadow_factor:new Du(c),u_pattern_transition:new ws(c)}),i.dI=Uh,i.dJ=_te,i.dK=me,i.dL=(c,s,l,h,p,v)=>{const x=c.transform,P=x.projection.name==="globe";let I;if(v.paint.get("circle-pitch-alignment")==="map")if(P){const $=o1(x.zoom,s.canonical)*x._pixelsPerMercatorPixel;I=Float32Array.from([$,0,0,$])}else I=x.calculatePixelsToTileUnitsMatrix(l);else I=new Float32Array([x.pixelsToGLUnits[0],0,0,x.pixelsToGLUnits[1]]);const R={u_camera_to_center_distance:c.transform.getCameraToCenterDistance(x.projection),u_matrix:c.translatePosMatrix(s.projMatrix,l,v.paint.get("circle-translate"),v.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Ia.devicePixelRatio,u_extrude_scale:I,u_inv_rot_matrix:se,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:v.paint.get("circle-emissive-strength")};if(P){R.u_inv_rot_matrix=h,R.u_merc_center=p,R.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],R.u_zoom_transition=Zh(x.zoom);const $=p[0]*or,U=p[1]*or;R.u_up_dir=x.projection.upVector(new Mn(0,0,0),$,U)}return R},i.dM=x3,i.dN=ca,i.dO=(c,s,l,h,p,v,x,P,I,R)=>{const $=c.transform,U=$.pitch<15?y3(.07,.7,rt((14-$.zoom)/5,0,1)):.07,W=l.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:_3(c,s,l,h),u_texsize:s.imageAtlasTexture?s.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:$.calculatePixelsToTileUnitsMatrix(s),u_device_pixel_ratio:p,u_width_scale:v,u_floor_width_scale:x,u_image:0,u_tile_units_to_pixels:v3(s,$),u_units_to_pixels:[1/$.pixelsToGLUnits[0],1/$.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:P,u_trim_fade_range:l.paint.get("line-trim-fade-range"),u_trim_color:l.paint.get("line-trim-color").toRenderColor(W?null:l.lut).toArray01(),u_emissive_strength:l.paint.get("line-emissive-strength"),u_zbias_factor:U,u_tile_to_meter:at(s.tileID.canonical,0),u_ground_shadow_factor:I,u_pattern_transition:R}},i.dP=(c,s,l,h,p,v,x,P,I,R)=>{const $=c.transform,U=$.calculatePixelsToTileUnitsMatrix(s),W=l.paint.get("line-trim-color-use-theme").constantOr("default")==="none",te=$.pitch<15?y3(.07,.7,rt((14-$.zoom)/5,0,1)):.07;return{u_matrix:_3(c,s,l,h),u_pixels_to_tile_units:U,u_device_pixel_ratio:v,u_width_scale:x,u_floor_width_scale:P,u_units_to_pixels:[1/$.pixelsToGLUnits[0],1/$.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:p,u_texsize:b3(l)&&s.lineAtlasTexture?s.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:v3(s,c.transform),u_alpha_discard_threshold:0,u_trim_offset:I,u_trim_fade_range:l.paint.get("line-trim-fade-range"),u_trim_color:l.paint.get("line-trim-color").toRenderColor(W?null:l.lut).toArray01(),u_emissive_strength:l.paint.get("line-emissive-strength"),u_zbias_factor:te,u_tile_to_meter:at(s.tileID.canonical,0),u_ground_shadow_factor:R}},i.dQ=gr,i.dR=Nn,i.dS=yt,i.dT=n3,i.dU=Ll,i.dV=g1,i.dW=_m,i.dX=450,i.dY=7,i.dZ=Qte,i.d_=qn,i.da=function(c){const s=c.lastIndexOf(Nh);return s>=0?c.slice(s+1):""},i.db=function(c){const s=[],l=c.id;return l===void 0&&s.push({message:`layers.${l}: missing required property "id"`}),c.render===void 0&&s.push({message:`layers.${l}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&s.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),s},i.dc=function(c,s,l,h){return c.type==="custom"?new ere(c,s):new dre[c.type](c,s,l,h)},i.dd=Jr,i.de=function(c){const s=c.indexOf(Nh);return s>=0?c.slice(s+1):""},i.df=class extends uv{constructor(c,s){super(c._vectorTileFeature,c._z,c._x,c._y,c.id),c.state&&(this.state=Object.assign({},c.state)),this.target=s.target,this.namespace=s.namespace,s.properties&&(this.properties=s.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=c.source,this.sourceLayer=c.sourceLayer,this.layer=c.layer)}toJSON(){const c=super.toJSON();return c.target=this.target,c.namespace=this.namespace,c}},i.dg=Dh,i.dh=od,i.di=Ky,i.dj=class extends Ta{constructor(c){super(c),this.current=hm}set(c,s,l){if(this.fetchUniformLocation(c,s)){for(let h=0;h<9;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}}},i.dk=$e,i.dl=function(c,s,l){const h=Zh(l.zoom),p=c.style.map._antialias,v=c.terrain&&c.terrain.exaggeration()>0;return h===0&&!p&&!v},i.dm=function(c){const s=c.pixelsPerMeter,l=s/ke(1,c.center.lat),h=O(new Float64Array(16));return H(h,h,[c.point.x,c.point.y,0]),Z(h,h,[l,l,s]),Float32Array.from(h)},i.dn=jg,i.dp=function(c){const s=ut-5;c=rt(c,-80.051129,s)/s*90;const l=Math.pow(Math.abs(Math.sin(ae(c))),3);return Math.round(l*(X.length-1))},i.dq=function(c,s,l,h){const p=s.getNorth(),v=s.getSouth(),x=s.getWest(),P=s.getEast(),I=1<<c.z,R=P-x,$=p-v,U=R/q,W=-$/X[l],te=[0,U,0,W,0,0,p,x,0];if(c.z>0){const re=180/h;F(te,te,[re/R+1,0,0,0,re/$+1,0,-.5*re/U,.5*re/W,1])}return te[2]=I,te[5]=c.x,te[8]=c.y,te},i.dr=jl,i.ds=function(c,s,l){const h=O(new Float64Array(16)),p=(s/(1<<c)-.5)*Math.PI*2;return G(h,l.globeMatrix,p),Float32Array.from(h)},i.dt=class{isDataAvailableAtPoint(c){const s=this._source();if(this.isUsingMockSource()||!s||c.y<0||c.y>1)return!1;const l=s.getSource().maxzoom,h=1<<l,p=Math.floor(c.x),v=Math.floor((c.x-p)*h),x=Math.floor(c.y*h),P=this.findDEMTileFor(new ds(l,p,l,v,x));return!(!P||!P.dem)}getAtPointOrZero(c,s=0){return this.getAtPoint(c,s)||0}getAtPoint(c,s,l=!0){if(this.isUsingMockSource())return null;s==null&&(s=null);const h=this._source();if(!h||c.y<0||c.y>1)return s;const p=h.getSource().maxzoom,v=1<<p,x=Math.floor(c.x),P=c.x-x,I=new ds(p,x,p,Math.floor(P*v),Math.floor(c.y*v)),R=this.findDEMTileFor(I);if(!R||!R.dem)return s;const $=R.dem,U=1<<R.tileID.canonical.z,W=(P*U-R.tileID.canonical.x)*$.dim,te=(c.y*U-R.tileID.canonical.y)*$.dim,re=Math.floor(W),le=Math.floor(te);return(l?this.exaggeration():1)*Br(Br($.get(re,le),$.get(re,le+1),te-le),Br($.get(re+1,le),$.get(re+1,le+1),te-le),W-re)}getAtTileOffset(c,s,l){const h=1<<c.canonical.z;return this.getAtPointOrZero(new gt(c.wrap+(c.canonical.x+s/or)/h,(c.canonical.y+l/or)/h))}getAtTileOffsetFunc(c,s,l,h){return p=>{const v=this.getAtTileOffset(c,p.x,p.y),x=h.upVector(c.canonical,p.x,p.y);return Ue(x,x,v*h.upVectorScale(c.canonical,s,l).metersToTile),x}}getForTilePoints(c,s,l,h){if(this.isUsingMockSource())return!1;const p=iv.create(this,c,h);return!!p&&(s.forEach(v=>{v[2]=this.exaggeration()*p.getElevationAt(v[0],v[1],l)}),!0)}getMinMaxForTile(c){if(this.isUsingMockSource())return null;const s=this.findDEMTileFor(c);if(!s||!s.dem)return null;const l=s.dem.tree,h=s.tileID,p=1<<c.canonical.z-h.canonical.z;let v=c.canonical.x/p-h.canonical.x,x=c.canonical.y/p-h.canonical.y,P=0;for(let I=0;I<c.canonical.z-h.canonical.z&&!l.leaves[P];I++){v*=2,x*=2;const R=2*Math.floor(x)+Math.floor(v);P=l.childOffsets[P]+R,v%=1,x%=1}return{min:this.exaggeration()*l.minimums[P],max:this.exaggeration()*l.maximums[P]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(c,s,l){throw new Error("Pure virtual method called.")}pointCoordinate(c){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(c){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const c=this.visibleDemTiles;if(c.length===0)return null;let s=!1,l=Number.MAX_VALUE,h=Number.MIN_VALUE;for(const p of c){const v=this.getMinMaxForTile(p.tileID);v&&(l=Math.min(l,v.min),h=Math.max(h,v.max),s=!0)}return s?{min:l,max:h}:null}},i.du=In,i.dv=Fu,i.dw=function(c,s){return[Math.pow(c[0],2.2)*s,Math.pow(c[1],2.2)*s,Math.pow(c[2],2.2)*s]},i.dx=A,i.dy=function(c,s){var l=Math.sin(s),h=Math.cos(s);return c[0]=h,c[1]=l,c[2]=0,c[3]=-l,c[4]=h,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},i.dz=Ht,i.e=cs,i.e$=MF,i.e0=256,i.e1=r0,i.e2=Il,i.e3=G,i.e4=function(c,s){return c[0]=s[0],c[1]=s[1],c[2]=s[2],c[3]=s[4],c[4]=s[5],c[5]=s[6],c[6]=s[8],c[7]=s[9],c[8]=s[10],c},i.e5=Ru,i.e6=qh,i.e7=function(c,s,l,h,p){return rt((c-s)/(l-s)*(p-h)+h,h,p)},i.e8=vi,i.e9=function(c,s){var l=s[0],h=s[1],p=s[2],v=s[3],x=s[4],P=s[5],I=s[6],R=s[7],$=s[8],U=$*x-P*R,W=-$*v+P*I,te=R*v-x*I,re=l*U+h*W+p*te;return re?(c[0]=U*(re=1/re),c[1]=(-$*h+p*R)*re,c[2]=(P*h-p*x)*re,c[3]=W*re,c[4]=($*l-p*I)*re,c[5]=(-P*l+p*v)*re,c[6]=te*re,c[7]=(-R*l+h*I)*re,c[8]=(x*l-h*v)*re,c):null},i.eA=function(c,s,l){return c[0]=s[0]/l[0],c[1]=s[1]/l[1],c[2]=s[2]/l[2],c},i.eB=Dt,i.eC=fe,i.eD=lt,i.eE=function(c,s,l,h){return c[0]=s,c[1]=l,c[2]=h,c},i.eF=function([c,s,l]){const h=Math.hypot(c,s,l),p=Math.atan2(c,l),v=.5*Math.PI-Math.acos(-s/h);return new he(oe(p),oe(v))},i.eG=rn,i.eH=BT,i.eI=function(c){const s=c.navigator?c.navigator.userAgent:null;return!!function(l){if(bi==null){const h=l.navigator?l.navigator.userAgent:null;bi=!!l.safari||!(!h||!(/\b(iPad|iPhone|iPod)\b/.test(h)||h.match("Safari")&&!h.match("Chrome")))}return bi}(c)&&!(!s||!(s.match("Version/15.4")||s.match("Version/15.5")||s.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},i.eJ=function(c,s){Mc=c,ka=s},i.eK=_,i.eL=Fg,i.eM=function(c){const s=[0,0,0],l=O(new Float64Array(16));return V(l,c.pixelMatrix,c.globeMatrix),Tt(s,s,l),new Qt(s[0],s[1])},i.eN=function(c,s,l=!1){if(no===Pd||no===ol||no===Md)throw new Error("setRTLTextPlugin cannot be called multiple times.");sc=Ia.resolveURL(c),no=Pd,Id=s,$f(),l||Vf()},i.eO=us,i.eP=function(){V1().acquire(WT)},i.eQ=function(){const c=T0;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(WT),T0=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.eR=Xg,i.eS=function(c){const s=vf();if(!s)return;const l=s.delete(aa);c&&l.then(()=>c()).catch(c)},i.eT=E0,i.eU=_F,i.eV=function(c){nC=Ia.resolveURL(c),cv||(cv=new sv(V1(),new Zl)),cv.broadcast("setDracoUrl",nC)},i.eW=xF,i.eX=function(c){lv=Ia.resolveURL(c),cv||(cv=new sv(V1(),new Zl)),cv.broadcast("setMeshoptUrl",lv)},i.eY=yr,i.eZ=Gt,i.e_=zd,i.ea=za,i.eb=Ye,i.ec=Mt,i.ed=class{constructor(c,s,l,h){this.context=c,this.format=h,this.size=l,this.texture=c.gl.createTexture();const[p,v,x]=this.size,{gl:P}=c;P.bindTexture(P.TEXTURE_3D,this.texture),c.pixelStoreUnpackFlipY.set(!1),c.pixelStoreUnpack.set(1),c.pixelStoreUnpackPremultiplyAlpha.set(!1),P.texImage3D(P.TEXTURE_3D,0,this.format,p,v,x,0,DT(this.format),NT(this.format),s.data)}bind(c,s){const{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_3D,this.texture),c!==this.minFilter&&(h.texParameteri(h.TEXTURE_3D,h.TEXTURE_MAG_FILTER,c),h.texParameteri(h.TEXTURE_3D,h.TEXTURE_MIN_FILTER,c),this.minFilter=c),s!==this.wrapS&&(h.texParameteri(h.TEXTURE_3D,h.TEXTURE_WRAP_S,s),h.texParameteri(h.TEXTURE_3D,h.TEXTURE_WRAP_T,s),this.wrapS=s)}destroy(){const{gl:c}=this.context;c.deleteTexture(this.texture),this.texture=null}},i.ee=function(c,s){if(c===s){var l=s[1],h=s[2],p=s[3],v=s[6],x=s[7],P=s[11];c[1]=s[4],c[2]=s[8],c[3]=s[12],c[4]=l,c[6]=s[9],c[7]=s[13],c[8]=h,c[9]=v,c[11]=s[14],c[12]=p,c[13]=x,c[14]=P}else c[0]=s[0],c[1]=s[4],c[2]=s[8],c[3]=s[12],c[4]=s[1],c[5]=s[5],c[6]=s[9],c[7]=s[13],c[8]=s[2],c[9]=s[6],c[10]=s[10],c[11]=s[14],c[12]=s[3],c[13]=s[7],c[14]=s[11],c[15]=s[15];return c},i.ef=$T,i.eg=xe,i.eh=[1,1,1],i.ei=function(c,s,l,h){var p=new w(4);return p[0]=c,p[1]=s,p[2]=l,p[3]=h,p},i.ej=mr,i.ek=function(c,s,l,h){var p=s[0],v=s[1],x=s[2],P=s[3];return c[0]=p+h*(l[0]-p),c[1]=v+h*(l[1]-v),c[2]=x+h*(l[2]-x),c[3]=P+h*(l[3]-P),c},i.el=iv,i.em=nv,i.en=kl,i.eo=ju,i.ep=function(c,s,l,h,p,v,x,P,I,R,$,U,W,te,re,le){var ve=new w(16);return ve[0]=c,ve[1]=s,ve[2]=l,ve[3]=h,ve[4]=p,ve[5]=v,ve[6]=x,ve[7]=P,ve[8]=I,ve[9]=R,ve[10]=$,ve[11]=U,ve[12]=W,ve[13]=te,ve[14]=re,ve[15]=le,ve},i.eq=de,i.er=Jf,i.es=tm,i.et=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Qt(1/0,1/0),max:new Qt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(c,s=!1){const l=BN(new Qt(0,0),new Qt(or,or),c),h=[];if(s&&!dT(l,this._globalClipBounds))return h;for(const p of this._activeRegions){if(p.hiddenByOverlap||!dT(l,p))continue;const v=Gee(p.min,p.max,c);h.push({min:v.min,max:v.max,sourceId:this._sourceIds[p.priority],footprint:p.footprint,footprintTileId:p.tileId,order:p.order,clipMask:p.clipMask,clipScope:p.clipScope})}return h}setSources(c){this._setSources(c.map(s=>({getSourceId:()=>s.cache.id,getFootprints:()=>{const l=[];for(const h of s.cache.getVisibleCoordinates()){const p=s.cache.getTile(h).buckets[s.layer];p&&p.updateFootprints(h.toUnwrapped(),l)}return l},getOrder:()=>s.order,getClipMask:()=>s.clipMask,getClipScope:()=>s.clipScope})))}_addSource(c){const s=c.getFootprints();if(s.length===0)return;const l=c.getOrder(),h=c.getClipMask(),p=c.getClipScope();for(const v of s){if(!v.footprint)continue;const x=BN(v.footprint.min,v.footprint.max,v.id);this._activeRegions.push({min:x.min,max:x.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:v.id,footprint:v.footprint,order:l,clipMask:h,clipScope:p})}this._sourceIds.push(c.getSourceId())}_computeReplacement(){this._activeRegions.sort((s,l)=>s.priority-l.priority||p1(s.min,l.min)||p1(s.max,l.max)||s.order-l.order||s.clipMask-l.clipMask||function(h,p){const v=(x,P)=>x+P;return h.length-p.length||h.reduce(v,"").localeCompare(p.reduce(v,""))}(s.clipScope,l.clipScope));let c=this._activeRegions.length!==this._prevRegions.length;if(!c){let s=0;for(;!c&&s!==this._activeRegions.length;){const l=this._activeRegions[s],h=this._prevRegions[s];c=l.priority!==h.priority||!FN(l,h)||l.order!==h.order||l.clipMask!==h.clipMask||!Hs(l.clipScope,h.clipScope),++s}}if(c){++this._updateTime;for(const l of this._activeRegions)l.order!==f1&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,l.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,l.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,l.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,l.max.y));const s=l=>{const h=this._activeRegions;if(l>=h.length)return l;const p=h[l].priority;for(;l<h.length&&h[l].priority===p;)++l;return l};if(this._sourceIds.length>1){let l=0,h=s(l);for(;l!==h;){let p=l;const v=l;for(;p!==h;){const x=this._activeRegions[p];x.hiddenByOverlap=!1;for(let P=0;P<v;P++){const I=this._activeRegions[P];if(!I.hiddenByOverlap&&x.order===f1&&dT(x,I)&&(x.hiddenByOverlap=VN(x.footprint,x.tileId,I.footprint,I.tileId),x.hiddenByOverlap))break}++p}l=h,h=s(l)}}}}_setSources(c){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let s=c.length-1;s>=0;s--)this._addSource(c[s]);this._computeReplacement()}},i.eu=class{constructor(c){this._createGrid(c),this._createPoles(c)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const c of this._poleSegments)c.destroy();for(const c of this._gridSegments)c.withSkirts.destroy(),c.withoutSkirts.destroy()}_fillGridMeshWithLods(c,s){const l=new lc,h=new bs,p=[],v=c+1+2,x=s[0]+1,P=s[0]+1+(1+s.length),I=(R,$,U)=>{let W=R===v-1?R-2:R===0?R:R-1;return W+=U?24575:0,[W,$]};for(let R=0;R<v;++R)l.emplaceBack(...I(R,0,!0));for(let R=0;R<x;++R)for(let $=0;$<v;++$)l.emplaceBack(...I($,R,($===0||$===v-1)&&!0));for(let R=0;R<s.length;++R){const $=s[R];for(let U=0;U<v;++U)l.emplaceBack(...I(U,$,!0))}for(let R=0;R<s.length;++R){const $=h.length,U=s[R]+1+2,W=new bs;for(let le=0;le<U-1;le++){const ve=le===U-2,_e=ve?v*(P-s.length+R-le):v;for(let Ce=0;Ce<v-1;Ce++){const Ee=le*v+Ce;le===0||ve||Ce===0||Ce===v-2?(W.emplaceBack(Ee+1,Ee,Ee+_e),W.emplaceBack(Ee+_e,Ee+_e+1,Ee+1)):(h.emplaceBack(Ee+1,Ee,Ee+_e),h.emplaceBack(Ee+_e,Ee+_e+1,Ee+1))}}const te=ji.simpleSegment(0,$,l.length,h.length-$);for(let le=0;le<W.uint16.length;le+=3)h.emplaceBack(W.uint16[le],W.uint16[le+1],W.uint16[le+2]);const re=ji.simpleSegment(0,$,l.length,h.length-$);p.push({withoutSkirts:te,withSkirts:re})}return{vertices:l,indices:h,segments:p}}_createGrid(c){const s=this._fillGridMeshWithLods(q,X);this._gridSegments=s.segments,this._gridBuffer=c.createVertexBuffer(s.vertices,Ws.members),this._gridIndexBuffer=c.createIndexBuffer(s.indices,!0)}_createPoles(c){const s=new bs;for(let x=0;x<=q;x++)s.emplaceBack(0,x+1,x+2);this._poleIndexBuffer=c.createIndexBuffer(s,!0);const l=new Ru,h=new Ru,p=new Ru,v=new Ru;this._poleSegments=[];for(let x=0,P=0;x<M;x++){const I=360/(1<<x);l.emplaceBack(0,-C,0,.5,0),h.emplaceBack(0,-C,0,.5,1),p.emplaceBack(0,-C,0,.5,.5),v.emplaceBack(0,-C,0,.5,.5);for(let R=0;R<=q;R++){let $=R/q,U=0;const W=Br(0,I,$),[te,re,le]=ne(z,K,W,C);l.emplaceBack(te,re,le,$,U),h.emplaceBack(te,re,le,$,1-U);const ve=ae(W);$=.5+.5*Math.sin(ve),U=.5+.5*Math.cos(ve),p.emplaceBack(te,re,le,$,U),v.emplaceBack(te,re,le,$,1-U)}this._poleSegments.push(ji.simpleSegment(P,0,66,64)),P+=66}this._poleNorthVertexBuffer=c.createVertexBuffer(l,ma,!1),this._poleSouthVertexBuffer=c.createVertexBuffer(h,ma,!1),this._texturedPoleNorthVertexBuffer=c.createVertexBuffer(p,ma,!1),this._texturedPoleSouthVertexBuffer=c.createVertexBuffer(v,ma,!1)}getGridBuffers(c,s){return[this._gridBuffer,this._gridIndexBuffer,s?this._gridSegments[c].withSkirts:this._gridSegments[c].withoutSkirts]}getPoleBuffers(c,s){return[s?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,s?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[c]]}},i.ev=f1,i.ew=He,i.ex=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.ey=et,i.ez=Zt,i.f=function(c){return c.indexOf("mapbox:")===0},i.f0=IF,i.f1=f3,i.f2=$g,i.f3="hd_road_elevation",i.f4=oT,i.f5=Xr,i.f6=Ug,i.f7=TT,i.f8=Gg,i.f9=function(c,s,l,h,p,v,x,P=1,I,R){c.createArrays(),c.tilePixelRatio=or/(512*c.overscaling),c.compareText={},c.iconsNeedLinear=!1;const $=c.layers[0].layout,U=c.layers[0]._unevaluatedLayout._values,W={};W.scaleFactor=P,W.textSizeScaleRange=$.get("text-size-scale-range"),W.iconSizeScaleRange=$.get("icon-size-scale-range");const[te,re]=W.textSizeScaleRange,[le,ve]=W.iconSizeScaleRange;W.textScaleFactor=rt(W.scaleFactor,te,re),W.iconScaleFactor=rt(W.scaleFactor,le,ve);const _e=U["text-size"],Ce=U["icon-size"];if(c.textSizeData.kind==="composite"){const{minZoom:Ge,maxZoom:Qe}=c.textSizeData;W.compositeTextSizes=[_e.possiblyEvaluate(new ni(Ge),v),_e.possiblyEvaluate(new ni(Qe),v)]}if(c.iconSizeData.kind==="composite"){const{minZoom:Ge,maxZoom:Qe}=c.iconSizeData;W.compositeIconSizes=[Ce.possiblyEvaluate(new ni(Ge),v),Ce.possiblyEvaluate(new ni(Qe),v)]}W.layoutTextSize=_e.possiblyEvaluate(new ni(x+1),v),W.layoutIconSize=Ce.possiblyEvaluate(new ni(x+1),v),W.textMaxSize=_e.possiblyEvaluate(new ni(18),v);const Ee=$.get("symbol-placement"),ue=$.get("text-rotation-alignment")==="map"&&Ee!=="point",we=$.get("text-size");let Te=!1;const Ie=[];for(const Ge of c.features){const Qe=$.get("text-font").evaluate(Ge,{},v).join(","),it=we.evaluate(Ge,{},v)*W.textScaleFactor,ct=W.layoutTextSize.evaluate(Ge,{},v)*W.textScaleFactor,St=W.layoutIconSize.evaluate(Ge,{},v)*W.iconScaleFactor,Vt={horizontal:{},vertical:void 0},Nt=Ge.text;let Bt,Xt=[0,0];if(Nt){const Mr=Nt.toString(),Kr=$.get("text-letter-spacing").evaluate(Ge,{},v)*Co,dn=$.get("text-line-height").evaluate(Ge,{},v)*Co,mn=wg(Mr)?Kr:0,An=$.get("text-anchor").evaluate(Ge,{},v),bn=$.get("text-variable-anchor");if(!bn){const Oe=$.get("text-radial-offset").evaluate(Ge,{},v);if(Oe)Xt=Y3(An,[Oe*Co,AT]);else{const Pt=$.get("text-offset").evaluate(Ge,{},v);Xt=[Pt[0]*Co,Pt[1]*Co]}}let yn=ue?"center":$.get("text-justify").evaluate(Ge,{},v);const gi=Ee==="point",Ii=gi?$.get("text-max-width").evaluate(Ge,{},v)*Co:1/0,Me=Oe=>{c.allowVerticalPlacement&&ic(Mr)&&(Vt.vertical=wT(Nt,s,l,p,Qe,Ii,dn,An,Oe,mn,Xt,Dl.vertical,!0,ct,it,I))};if(!ue&&bn){const Oe=yn==="auto"?bn.map(ir=>PT(ir)):[yn];let Pt=!1;for(let ir=0;ir<Oe.length;ir++){const pr=Oe[ir];if(!Vt.horizontal[pr])if(Pt)Vt.horizontal[pr]=Vt.horizontal[0];else{const fr=wT(Nt,s,l,p,Qe,Ii,dn,"center",pr,mn,Xt,Dl.horizontal,!1,ct,it,I);fr&&(Vt.horizontal[pr]=fr,Pt=fr.positionedLines.length===1)}}Me("left")}else{if(yn==="auto"&&(yn=PT(An)),gi||$.get("text-writing-mode").indexOf("horizontal")>=0||!ic(Mr)){const Oe=wT(Nt,s,l,p,Qe,Ii,dn,An,yn,mn,Xt,Dl.horizontal,!1,ct,it,I);Oe&&(Vt.horizontal[yn]=Oe)}Me(gi?"left":yn)}}let xt,Ft,_t,wt,Yt,tr,Or,Tr=!1;if(Ge.icon&&Ge.icon.hasPrimary()){const Mr=Q3(Ge.icon,c.iconSizeData,U["icon-size"],v,c.zoom,Ge,I,W.iconScaleFactor);xt=Mr.iconPrimary,_t=Mr.iconSecondary;const Kr=xt.toString();if(Ft=h.get(Kr),Ft&&(Yt=$.get("icon-offset").evaluate(Ge,{},v),tr=$.get("icon-anchor").evaluate(Ge,{},v),Or=$.get("icon-text-fit").evaluate(Ge,{},v),Bt=Ite(p.get(Kr),_t?p.get(_t.toString()):void 0,Yt,tr),Tr=Ft.sdf,c.sdfIcons===void 0?c.sdfIcons=Ft.sdf:c.sdfIcons!==Ft.sdf&&sn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ft.pixelRatio!==c.pixelRatio||$.get("icon-rotate").constantOr(1)!==0)&&(c.iconsNeedLinear=!0)),_t){const dn=_t.toString();wt=h.get(dn)}}Te=Te||!(!Ge.icon||!Ge.icon.hasSecondary());const hr=MT(Vt.horizontal)||Vt.vertical;c.iconsInText||(c.iconsInText=!!hr&&hr.iconsInText);const Kt=ct*W.textScaleFactor/Co,{defaultShapedIcon:tn,verticallyShapedIcon:Pr}=Fte(c,Bt,$,Ge,v,Vt,Kt,Yt,Or);Or!=="none"&&Bt&&(j3(Bt)||D3(Bt))&&(E1(0,Ft,xt,Bt,tn,Or,R,h,p),E1(0,wt,_t,Bt,tn,Or,R,h,p),Pr&&(E1(0,Ft,xt,Bt,Pr,Or,R,h,p),E1(0,wt,_t,Bt,Pr,Or,R,h,p))),Bt=tn,Ie.push({feature:Ge,shapedTextOrientations:Vt,shapedText:hr,shapedIcon:Bt,iconPrimary:xt,iconSecondary:_t,iconOffset:Yt,iconAnchor:tr,verticallyShapedIcon:Pr,layoutTextSize:ct,layoutIconSize:St,textOffset:Xt,isSDFIcon:Tr,iconTextFit:Or})}return{featureData:Ie,sizes:W,hasAnySecondaryIcon:Te,textAlongLine:ue,symbolPlacement:Ee}},i.fa=G3,i.fb=function(c,s,l,h,p,v,x,P,I,R){const{featureData:$,hasAnySecondaryIcon:U,sizes:W,textAlongLine:te,symbolPlacement:re}=s;for(const le of $){const{shapedIcon:ve,verticallyShapedIcon:_e,feature:Ce,shapedTextOrientations:Ee,shapedText:ue,layoutTextSize:we,textOffset:Te,isSDFIcon:Ie,iconPrimary:Ge,iconSecondary:Qe,iconTextFit:it,iconOffset:ct}=le;ez(ve,R.iconPositions,Ge,Qe),ez(_e,R.iconPositions,Ge,Qe),zte(Ee,R.iconPositions),(ue||ve)&&Bte(c,Ce,Ee,ve,_e,I,W,we,0,Te,Ie,h,p,x,P,U,it,ct,te,re)}l&&c.generateCollisionDebugBuffers(v,c.collisionBoxArray,W.textScaleFactor)},i.fc=vm,i.fd=X1,i.fe=oa,i.ff=SN,i.fg=A3,i.fh=Ds,i.fi=function(c){let s=0;if(new Uint32Array(c,0,1)[0]!==wF){const l=new Uint32Array(c,0,7),[,,h,p,v,x]=l;s=l.byteLength+p+v+x+v,(h!==c.byteLength||s>=c.byteLength)&&sn("Invalid b3dm header information.")}return CF(c,s)},i.fj=function(c,s){const l=PF(c);for(const h of l){for(const p of h.meshes)mne(p);h.lights&&(h.lightMeshIndex=h.meshes.length,h.meshes.push(gne(h.lights,s)))}return l},i.fk=$1,i.fl=Vn,i.fm=Vz,i.fn=Sa,i.fo=function(c){Ul(),Oa!=null&&Oa.then(s=>{s.keys().then(l=>{for(let h=0;h<l.length-c;h++)s.delete(l[h]).catch(p=>sn(p.message))}).catch(l=>sn(l.message))}).catch(s=>sn(s.message))},i.g=function(c,s){return od(pt(c,{method:"GET"}),s)},i.h=$l,i.i=function(c){return cs.API_STYLE_REGEX.test(c)&&!nd(c)},i.j=function(c){return decodeURIComponent(atob(c).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join(""))},i.k=function(c){return btoa(encodeURIComponent(c).replace(/%([0-9A-F]{2})/g,(s,l)=>String.fromCharCode(+("0x"+l))))},i.l=pt,i.m=Op,i.n=function(c,s){return od(pt(c,{type:"json"}),s)},i.o=oh,i.p=function(c,s){return od(pt(c,{method:"POST"}),s)},i.q=Ia,i.r=kr,i.s=function(c){try{const s=self[c];return s.setItem("_mapbox_test_",1),s.removeItem("_mapbox_test_"),!0}catch{return!1}},i.t=sg,i.u=function(){return function c(s){return s?(s^Math.random()*(16>>s/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,c)}()},i.v=function(c){return!!c&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(c)},i.w=sn,i.x=function(){return ZT||(ZT=new Xg),ZT},i.y=QT,i.z=Rp}),u(["./shared"],function(i){function y(dt){const ae=dt?dt.url.toString():void 0;return ae?performance.getEntriesByName(ae):[]}function w(dt){if(typeof dt=="number"||typeof dt=="boolean"||typeof dt=="string"||dt==null)return JSON.stringify(dt);if(Array.isArray(dt)){let oe="[";for(const pe of dt)oe+=`${w(pe)},`;return`${oe}]`}let ae="{";for(const oe of Object.keys(dt).sort())ae+=`${oe}:${w(dt[oe])},`;return`${ae}}`}function T(dt){let ae="";for(const oe of i.bu)(dt.type!=="model"||oe!=="minzoom"&&oe!=="maxzoom")&&(ae+=`/${w(dt[oe])}`);return ae}class A{constructor(ae){this.keyCache={},this._layers={},this._layerConfigs={},ae&&this.replace(ae)}replace(ae,oe){this._layerConfigs={},this._layers={},this.update(ae,[],oe)}update(ae,oe,pe){this._options=pe;for(const He of ae)this._layerConfigs[He.id]=He,(this._layers[He.id]=i.dc(He,this.scope,null,this._options)).compileFilter(pe),this.keyCache[He.id]&&delete this.keyCache[He.id];for(const He of oe)delete this.keyCache[He],delete this._layerConfigs[He],delete this._layers[He];this.familiesBySource={};const $e=function(He,et){const rt={};for(let mt=0;mt<He.length;mt++){const Ct=He[mt];let pt=et&&et[Ct.id];pt||(Ct.type==="symbol"?pt=Ct.id:(pt=T(Ct),Ct.type==="line"&&Ct.paint&&function ar(gr){return typeof gr=="string"&&gr==="line-progress"||(Array.isArray(gr)?gr.some(ar):!(!gr||typeof gr!="object")&&Object.values(gr).some(ar))}(Ct.paint["line-width"])&&(pt+=`/${w(Ct.paint["line-width"])}`))),et&&(et[Ct.id]=pt);let rr=rt[pt];rr||(rr=rt[pt]=[]),rr.push(Ct)}const nt=[];for(const mt in rt)nt.push(rt[mt]);return nt}(Object.values(this._layerConfigs),this.keyCache);for(const He of $e){const et=He.map(rr=>this._layers[rr.id]),rt=et[0];if(rt.visibility==="none")continue;const nt=rt.source||"";let mt=this.familiesBySource[nt];mt||(mt=this.familiesBySource[nt]={});const Ct=rt.sourceLayer||"_geojsonTileLayer";let pt=mt[Ct];pt||(pt=mt[Ct]=[]),pt.push(et)}}}const k=1*i.e_;class F{constructor(ae){const oe={},pe=[];for(const rt in ae){const nt=ae[rt],mt=oe[rt]={};for(const Ct in nt.glyphs){const pt=nt.glyphs[+Ct];if(!pt||pt.bitmap.width===0||pt.bitmap.height===0)continue;const rr=pt.metrics.localGlyph?k:1,ar={x:0,y:0,w:pt.bitmap.width+2*rr,h:pt.bitmap.height+2*rr};pe.push(ar),mt[Ct]=ar}}const{w:$e,h:He}=i.H(pe),et=new i.eZ({width:$e||1,height:He||1});for(const rt in ae){const nt=ae[rt];for(const mt in nt.glyphs){const Ct=nt.glyphs[+mt];if(!Ct||Ct.bitmap.width===0||Ct.bitmap.height===0)continue;const pt=oe[rt][mt],rr=Ct.metrics.localGlyph?k:1;i.eZ.copy(Ct.bitmap,et,{x:0,y:0},{x:pt.x+rr,y:pt.y+rr},Ct.bitmap)}}this.image=et,this.positions=oe}}i.eY(F,"GlyphAtlas");class D{constructor(ae){this.tileID=new i.aM(ae.tileID.overscaledZ,ae.tileID.wrap,ae.tileID.canonical.z,ae.tileID.canonical.x,ae.tileID.canonical.y),this.tileZoom=ae.tileZoom,this.uid=ae.uid,this.zoom=ae.zoom,this.lut=ae.lut,this.canonical=ae.tileID.canonical,this.pixelRatio=ae.pixelRatio,this.tileSize=ae.tileSize,this.source=ae.source,this.scope=ae.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ae.showCollisionBoxes,this.collectResourceTiming=!!ae.request&&ae.request.collectResourceTiming,this.promoteId=ae.promoteId,this.isSymbolTile=ae.isSymbolTile,this.tileTransform=i.aW(ae.tileID.canonical,ae.projection),this.projection=ae.projection,this.worldview=ae.worldview,this.localizableLayerIds=ae.localizableLayerIds,this.brightness=ae.brightness,this.extraShadowCaster=!!ae.extraShadowCaster,this.tessellationStep=ae.tessellationStep,this.scaleFactor=ae.scaleFactor}parse(ae,oe,pe,$e,He,et){this.status="parsing",this.data=ae,this.collisionBoxArray=new i.b0;const rt=new i.e$(Object.keys(ae.layers).sort()),nt=new i.f0(this.tileID,this.promoteId);nt.bucketLayerIDs=[];const mt={},Ct=new i.f1(256,256),pt={featureIndex:nt,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Ct,availableImages:pe,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},rr=oe.familiesBySource[this.source];for(const Tn in rr){const on=ae.layers[Tn];if(!on)continue;let Vn=!1,li=!1,bi=!1;for(const Qs of rr[Tn])Qs[0].type==="symbol"?Vn=!0:li=!0,Qs[0].is3D()&&Qs[0].type!=="model"&&(bi=!0);if(this.extraShadowCaster&&!bi||this.isSymbolTile===!0&&!Vn||this.isSymbolTile===!1&&!li)continue;on.version===1&&i.w(`Vector tile source "${this.source}" layer "${Tn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ci=rt.encode(Tn),Ki=[];let Ho=!1;for(let Qs=0,xs=0;Qs<on.length;Qs++){const eo=on.feature(Qs),cs=nt.getId(eo,Tn);if(this.localizableLayerIds&&this.localizableLayerIds.has(Tn)){const $l=eo.properties?eo.properties.worldview:null;if(this.worldview&&typeof $l=="string")if($l==="all")eo.properties.$localized=!0;else{if(!$l.split(",").includes(this.worldview))continue;eo.properties.$localized=!0,eo.properties.worldview=this.worldview}}!Ho&&eo.properties&&eo.properties.hasOwnProperty(i.f2)&&(Ho=!0),Ki.push({feature:eo,id:cs,index:xs,sourceLayerIndex:Ci}),xs++}Ho&&!pt.elevationFeatures&&ae.layers.hasOwnProperty(i.f3)&&(pt.elevationFeatures=i.f4.parseFrom(ae.layers[i.f3],this.canonical));for(const Qs of rr[Tn]){const xs=Qs[0];(!this.extraShadowCaster||xs.is3D()&&xs.type!=="model")&&(this.isSymbolTile!==void 0&&xs.type==="symbol"!==this.isSymbolTile||xs.minzoom&&this.zoom<Math.floor(xs.minzoom)||xs.maxzoom&&this.zoom>=xs.maxzoom||xs.visibility!=="none"&&(O(Qs,this.zoom,pt.brightness,pe),(mt[xs.id]=xs.createBucket({index:nt.bucketLayerIDs.length,layers:Qs,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ci,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:$e})).populate(Ki,pt,this.tileID.canonical,this.tileTransform),nt.bucketLayerIDs.push(Qs.map(eo=>i.C(eo.id,eo.scope)))))}}let ar,gr,Ur,Xr,Jr,nn;Ct.trim();const Qn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},sn=()=>{if(ar)return this.status="done",et(ar);if(this.extraShadowCaster)this.status="done",et(null,{buckets:Object.values(mt).filter(Tn=>!Tn.isEmpty()),featureIndex:nt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:pt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(gr&&Ur&&Xr){const Tn=new F(gr),on=new Map;for(const[bi,Ci]of Ur.entries()){const{imagePosition:Ki}=i.f7(bi,Ci,i.f8);on.set(bi,Ki)}const Vn={};for(const bi in mt){const Ci=mt[bi];Ci instanceof i.b1&&(O(Ci.layers,this.zoom,pt.brightness,pe),Vn[bi]=i.f9(Ci,gr,Tn.positions,Ur,on,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Jr))}const li={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(He,Ur,Jr,()=>{li.iconsPending=!1,Bn(Vn,Tn,li)}),this.rasterizeIfNeeded(He,Xr,nn,()=>{li.patternsPending=!1,Bn(Vn,Tn,li)})}},Bn=(Tn,on,Vn,li)=>{if(Vn.iconsPending||Vn.patternsPending)return;const bi=new i.fa(Ur,Xr,this.lut);for(const Ci in mt){const Ki=mt[Ci];if(Ci in Tn)i.fb(Ki,Tn[Ci],this.showCollisionBoxes,pe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Ur,bi);else if(Ki.hasPattern&&(Ki instanceof i.b7||Ki instanceof i.b8||Ki instanceof i.dV)){O(Ki.layers,this.zoom,pt.brightness,pe);const Ho=Object.fromEntries(bi.patternPositions);Ki.addFeatures(pt,this.tileID.canonical,Ho,pe,this.tileTransform,this.brightness)}}this.status="done",et(null,{buckets:Object.values(mt).filter(Ci=>!Ci.isEmpty()),featureIndex:nt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:on.image,lineAtlas:Ct,imageAtlas:bi,brightness:pt.brightness})};if(!this.extraShadowCaster){const Tn=i.f5(pt.glyphDependencies,li=>Object.keys(li).map(Number));Object.keys(Tn).length?He.send("getGlyphs",{uid:this.uid,stacks:Tn,scope:this.scope},(li,bi)=>{ar||(ar=li,gr=bi,sn())},void 0,!1,Qn):gr={};const on=Array.from(pt.iconDependencies.keys()).map(li=>i.I.parse(li));on.length?He.send("getImages",{images:on,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(li,bi)=>{ar||(ar=li,Ur=new Map,Jr=this.updateImageMapAndGetImageTaskQueue(Ur,bi,pt.iconDependencies),sn())},void 0,!1,Qn):(Ur=new Map,Jr=new Map);const Vn=Array.from(pt.patternDependencies.keys()).map(li=>i.I.parse(li));Vn.length?He.send("getImages",{images:Vn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(li,bi)=>{ar||(ar=li,Xr=new Map,nn=this.updateImageMapAndGetImageTaskQueue(Xr,bi,pt.patternDependencies),sn())},void 0,!1,Qn):(Xr=new Map,nn=new Map)}if(pt.elevationFeatures&&pt.elevationFeatures.length>0){const Tn=[];for(const Vn of Object.values(mt))if(Vn instanceof i.b8){const li=Vn.getUnevaluatedPortalGraph();li&&Tn.push(li)}const on=i.f6.evaluate(Tn);for(const Vn of Object.values(mt))Vn instanceof i.b8&&Vn.setEvaluatedPortalGraph(on)}sn()}rasterizeIfNeeded(ae,oe,pe,$e){Array.from(oe.values()).some(He=>He.usvg)?this.rasterize(ae,oe,pe,$e):$e()}updateImageMapAndGetImageTaskQueue(ae,oe,pe){const $e=new Map;for(const He of oe.keys()){const et=pe.get(He)||[];for(const rt of et){const nt=rt.toString(),mt=oe.get(rt.id.toString());mt.usvg?$e.has(nt)||($e.set(nt,rt),ae.set(nt,Object.assign({},mt))):ae.set(nt,mt)}}return $e}rasterize(ae,oe,pe,$e){this.rasterizeTask=ae.send("rasterizeImages",{scope:this.scope,tasks:pe},(He,et)=>{if(!He)for(const[rt,nt]of et.entries()){const mt=Object.assign(oe.get(rt),{data:nt});oe.set(rt,mt)}$e()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function O(dt,ae,oe,pe){const $e=new i.aa(ae,{brightness:oe});for(const He of dt)He.recalculate($e,pe)}class N extends i.E{constructor(ae,oe,pe,$e,He,et,rt){super(),this.actor=ae,this.layerIndex=oe,this.availableImages=pe,this.availableModels=$e,this.loadVectorData=et||i.aJ,this.loading={},this.loaded={},this.deduped=new i.aI(ae.scheduler),this.isSpriteLoaded=He,this.scheduler=ae.scheduler,this.brightness=rt}loadTile(ae,oe){const pe=ae.uid,$e=ae&&ae.request,He=$e&&$e.collectResourceTiming,et=this.loading[pe]=new D(ae);et.abort=this.loadVectorData(ae,(rt,nt)=>{const mt=!this.loading[pe];if(delete this.loading[pe],et.cancelRasterize(),mt||rt||!nt)return et.status="done",mt||(this.loaded[pe]=et),oe(rt);const Ct=nt.rawData,pt={};nt.expires&&(pt.expires=nt.expires),nt.cacheControl&&(pt.cacheControl=nt.cacheControl),et.vectorTile=nt.vectorTile||new i.fc.VectorTile(new i.bq(Ct));const rr=()=>{et.parse(et.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(ar,gr)=>{if(ar||!gr)return oe(ar);const Ur={};if(He){const Xr=y($e);Xr.length>0&&(Ur.resourceTiming=JSON.parse(JSON.stringify(Xr)))}oe(null,i.l({rawTileData:Ct.slice(0)},gr,pt,Ur))})};this.isSpriteLoaded?rr():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(rr,{type:"parseTile",isSymbolTile:ae.isSymbolTile,zoom:ae.tileZoom}):rr()}),this.loaded=this.loaded||{},this.loaded[pe]=et})}reloadTile(ae,oe){const pe=this.loaded,$e=ae.uid;if(pe&&pe[$e]){const He=pe[$e];He.scaleFactor=ae.scaleFactor,He.showCollisionBoxes=ae.showCollisionBoxes,He.projection=ae.projection,He.brightness=ae.brightness,He.tileTransform=i.aW(ae.tileID.canonical,ae.projection),He.extraShadowCaster=ae.extraShadowCaster,He.lut=ae.lut;const et=(rt,nt)=>{const mt=He.reloadCallback;mt&&(delete He.reloadCallback,He.parse(He.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,mt)),oe(rt,nt)};He.status==="parsing"?He.reloadCallback=et:He.status==="done"&&(He.vectorTile?He.parse(He.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,et):et())}else oe(null,void 0)}abortTile(ae,oe){const pe=ae.uid,$e=this.loading[pe];$e&&($e.abort&&$e.abort(),delete this.loading[pe]),oe()}removeTile(ae,oe){const pe=this.loaded,$e=ae.uid;pe&&pe[$e]&&delete pe[$e],oe()}}class V{loadTile(ae,oe){const{uid:pe,encoding:$e,rawImageData:He,padding:et}=ae,rt=ImageBitmap&&He instanceof ImageBitmap?this.getImageData(He,et):He;oe(null,new i.fd(pe,rt,$e,et<1))}reloadTile(ae,oe){oe(null,null)}abortTile(ae,oe){oe()}removeTile(ae,oe){oe()}getImageData(ae,oe){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ae.width,ae.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ae.width,this.offscreenCanvas.height=ae.height,this.offscreenCanvasContext.drawImage(ae,0,0,ae.width,ae.height);const pe=this.offscreenCanvasContext.getImageData(-oe,-oe,ae.width+2*oe,ae.height+2*oe);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),pe}}i.bp.setPbf(i.bq);class H{constructor(ae){this._mrt=new i.bp(ae.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=ae.uid,this.tileID=ae.tileID,this.source=ae.source}parse(ae,oe){const pe=this._mrt;this.status="parsing",this._entireBuffer=ae;try{pe.parseHeader(ae),this._isHeaderLoaded=!0;const $e=[];for(const He in pe.layers){const et=pe.getLayer(He),rt=et.getDataRange(et.getBandList()),nt=pe.createDecodingTask(rt),mt=ae.slice(rt.firstByte,rt.lastByte+1),Ct=i.bp.performDecoding(mt,nt).then(pt=>nt.complete(null,pt)).catch(pt=>nt.complete(pt,null));$e.push(Ct)}Promise.allSettled($e).then(()=>oe(null,pe)).catch(He=>oe(He))}catch($e){oe($e)}}}class Z{constructor(ae){this.actor=ae,this.loading={},this.loaded={}}loadTile(ae,oe){const pe=ae.uid,$e=ae.request,He=this.loading[pe]=new H(ae),{cancel:et}=i.br($e,(rt,nt,mt,Ct)=>{const pt=!this.loading[pe];if(delete this.loading[pe],pt||rt||!nt)return He.status="done",pt||(this.loaded[pe]=He),oe(rt);He.parse(nt,(rr,ar)=>{if(rr||!ar)return oe(rr);oe(null,ar,mt,Ct)}),this.loaded[pe]=He});He.abort=et}reloadTile(ae,oe){oe(null,void 0)}abortTile(ae,oe){const pe=ae.uid,$e=this.loading[pe];$e&&($e.abort&&$e.abort(),delete this.loading[pe]),oe()}removeTile(ae,oe){const pe=ae.uid;this.loaded[pe]&&delete this.loaded[pe],oe()}decodeRasterArray(ae,oe){i.bp.performDecoding(ae.buffer,ae.task).then(pe=>oe(null,pe)).catch(pe=>oe(pe))}}const J=i.fc.VectorTileFeature.prototype.toGeoJSON;class G{constructor(ae){this._feature=ae,this.extent=i.aj,this.type=ae.type,this.properties=ae.tags,"id"in ae&&!isNaN(ae.id)&&(this.id=parseInt(ae.id,10))}loadGeometry(){if(this._feature.type===1){const ae=[];for(const oe of this._feature.geometry)ae.push([new i.P(oe[0],oe[1])]);return ae}{const ae=[];for(const oe of this._feature.geometry){const pe=[];for(const $e of oe)pe.push(new i.P($e[0],$e[1]));ae.push(pe)}return ae}}toGeoJSON(ae,oe,pe){return J.call(this,ae,oe,pe)}}class Y{constructor(ae){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.aj,this.length=ae.length,this._features=ae}feature(ae){return new G(this._features[ae])}}const ie=64/4096,ce=128;class ge{constructor(){this.features=new Map}clear(){this.features.clear()}load(ae=[],oe){for(const pe of ae){const $e=pe.id;if($e==null)continue;let He=this.features.get($e);He&&this.updateCache(He,oe),pe.geometry?(He=xe(pe),this.updateCache(He,oe),this.features.set($e,He)):this.features.delete($e),this.updateCache(He,oe)}}updateCache(ae,oe){for(const{canonical:pe,uid:$e}of Object.values(oe)){const{z:He,x:et,y:rt}=pe;be(ae,Math.pow(2,He),et,rt)&&delete oe[$e]}}getTile(ae,oe,pe){const $e=Math.pow(2,ae),He=[];for(const et of this.features.values())be(et,$e,oe,pe)&&He.push(Je(et,$e,oe,pe));return{features:He}}getFeatures(){return[...this.features.values()]}}function be({minX:dt,minY:ae,maxX:oe,maxY:pe},$e,He,et){return dt<(He+1+ie)/$e&&ae<(et+1+ie)/$e&&oe>(He-ie)/$e&&pe>(et-ie)/$e}function xe(dt){const{id:ae,geometry:oe,properties:pe}=dt;if(!oe)return;if(oe.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:$e,coordinates:He}=oe,et={id:ae,type:1,geometry:[],tags:pe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},rt=et.geometry;if($e==="Point")Le(He,rt,et);else if($e==="MultiPoint")for(const nt of He)Le(nt,rt,et);else if($e==="LineString")et.type=2,ze(He,rt,et);else if($e==="MultiLineString")et.type=2,Xe(He,rt,et);else if($e==="Polygon")et.type=3,Xe(He,rt,et,!0);else{if($e!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");et.type=3;for(const nt of He)Xe(nt,rt,et,!0)}return et}function Le([dt,ae],oe,pe){const $e=i.ay(dt);let He=i.aH(ae);He=He<0?0:He>1?1:He,oe.push($e,He),pe.minX=Math.min(pe.minX,$e),pe.minY=Math.min(pe.minY,He),pe.maxX=Math.max(pe.maxX,$e),pe.maxY=Math.max(pe.maxY,He)}function ze(dt,ae,oe,pe=!1,$e=!1){const He=[];for(const et of dt)Le(et,He,oe);ae.push(He),pe&&function(et,rt){let nt=0;for(let mt=0,Ct=et.length,pt=Ct-2;mt<Ct;pt=mt,mt+=2)nt+=(et[mt]-et[pt])*(et[mt+1]+et[pt+1]);if(nt>0===rt)for(let mt=0,Ct=et.length;mt<Ct/2;mt+=2){const pt=et[mt],rr=et[mt+1];et[mt]=et[Ct-2-mt],et[mt+1]=et[Ct-1-mt],et[Ct-2-mt]=pt,et[Ct-1-mt]=rr}}(He,$e)}function Xe(dt,ae,oe,pe=!1){for(let $e=0;$e<dt.length;$e++)ze(dt[$e],ae,oe,pe,$e===0)}function Je(dt,ae,oe,pe){const{id:$e,type:He,geometry:et,tags:rt}=dt,nt=[];if(He===1)(function(mt,Ct,pt,rr,ar){for(let gr=0;gr<mt.length;gr+=2){const Ur=Math.round(i.aj*(mt[gr+0]*Ct-pt)),Xr=Math.round(i.aj*(mt[gr+1]*Ct-rr));ar.push([Ur,Xr])}})(et,ae,oe,pe,nt);else for(const mt of et)tt(mt,ae,oe,pe,nt);return{id:$e,type:He,geometry:nt,tags:rt}}function tt(dt,ae,oe,pe,$e){const et=i.aj+ce;let rt;for(let nt=0;nt<dt.length-2;nt+=2){let mt=Math.round(i.aj*(dt[nt+0]*ae-oe)),Ct=Math.round(i.aj*(dt[nt+1]*ae-pe)),pt=Math.round(i.aj*(dt[nt+2]*ae-oe)),rr=Math.round(i.aj*(dt[nt+3]*ae-pe));const ar=pt-mt,gr=rr-Ct;mt<-128&&pt<-128||(mt<-128?(Ct+=Math.round(gr*((-128-mt)/ar)),mt=-128):pt<-128&&(rr=Ct+Math.round(gr*((-128-mt)/ar)),pt=-128),Ct<-128&&rr<-128||(Ct<-128?(mt+=Math.round(ar*((-128-Ct)/gr)),Ct=-128):rr<-128&&(pt=mt+Math.round(ar*((-128-Ct)/gr)),rr=-128),mt>=et&&pt>=et||(mt>=et?(Ct+=Math.round(gr*((et-mt)/ar)),mt=et):pt>=et&&(rr=Ct+Math.round(gr*((et-mt)/ar)),pt=et),Ct>=et&&rr>=et||(Ct>=et?(mt+=Math.round(ar*((et-Ct)/gr)),Ct=et):rr>=et&&(pt=mt+Math.round(ar*((et-Ct)/gr)),rr=et),rt&&mt===rt[rt.length-1][0]&&Ct===rt[rt.length-1][1]||(rt=[[mt,Ct]],$e.push(rt)),rt.push([pt,rr])))))}}var st,Ne,We,Ue={exports:{}},De=function(){if(We)return Ue.exports;We=1;var dt=i.fg(),ae=function(){if(Ne)return st;Ne=1;var Ct=i.fe(),pt=i.ff().VectorTileFeature;function rr(gr,Ur){this.options=Ur||{},this.features=gr,this.length=gr.length}function ar(gr,Ur){this.id=typeof gr.id=="number"?gr.id:void 0,this.type=gr.type,this.rawGeometry=gr.type===1?[gr.geometry]:gr.geometry,this.properties=gr.tags,this.extent=Ur||4096}return st=rr,rr.prototype.feature=function(gr){return new ar(this.features[gr],this.options.extent)},ar.prototype.loadGeometry=function(){var gr=this.rawGeometry;this.geometry=[];for(var Ur=0;Ur<gr.length;Ur++){for(var Xr=gr[Ur],Jr=[],nn=0;nn<Xr.length;nn++)Jr.push(new Ct(Xr[nn][0],Xr[nn][1]));this.geometry.push(Jr)}return this.geometry},ar.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var gr=this.geometry,Ur=1/0,Xr=-1/0,Jr=1/0,nn=-1/0,Qn=0;Qn<gr.length;Qn++)for(var sn=gr[Qn],Bn=0;Bn<sn.length;Bn++){var Tn=sn[Bn];Ur=Math.min(Ur,Tn.x),Xr=Math.max(Xr,Tn.x),Jr=Math.min(Jr,Tn.y),nn=Math.max(nn,Tn.y)}return[Ur,Jr,Xr,nn]},ar.prototype.toGeoJSON=pt.prototype.toGeoJSON,st}();function oe(Ct){var pt=new dt;return function(rr,ar){for(var gr in rr.layers)ar.writeMessage(3,pe,rr.layers[gr])}(Ct,pt),pt.finish()}function pe(Ct,pt){var rr;pt.writeVarintField(15,Ct.version||1),pt.writeStringField(1,Ct.name||""),pt.writeVarintField(5,Ct.extent||4096);var ar={keys:[],values:[],keycache:{},valuecache:{}};for(rr=0;rr<Ct.length;rr++)ar.feature=Ct.feature(rr),pt.writeMessage(2,$e,ar);var gr=ar.keys;for(rr=0;rr<gr.length;rr++)pt.writeStringField(3,gr[rr]);var Ur=ar.values;for(rr=0;rr<Ur.length;rr++)pt.writeMessage(4,mt,Ur[rr])}function $e(Ct,pt){var rr=Ct.feature;rr.id!==void 0&&pt.writeVarintField(1,rr.id),pt.writeMessage(2,He,Ct),pt.writeVarintField(3,rr.type),pt.writeMessage(4,nt,rr)}function He(Ct,pt){var rr=Ct.feature,ar=Ct.keys,gr=Ct.values,Ur=Ct.keycache,Xr=Ct.valuecache;for(var Jr in rr.properties){var nn=rr.properties[Jr],Qn=Ur[Jr];if(nn!==null){Qn===void 0&&(ar.push(Jr),Ur[Jr]=Qn=ar.length-1),pt.writeVarint(Qn);var sn=typeof nn;sn!=="string"&&sn!=="boolean"&&sn!=="number"&&(nn=JSON.stringify(nn));var Bn=sn+":"+nn,Tn=Xr[Bn];Tn===void 0&&(gr.push(nn),Xr[Bn]=Tn=gr.length-1),pt.writeVarint(Tn)}}}function et(Ct,pt){return(pt<<3)+(7&Ct)}function rt(Ct){return Ct<<1^Ct>>31}function nt(Ct,pt){for(var rr=Ct.loadGeometry(),ar=Ct.type,gr=0,Ur=0,Xr=rr.length,Jr=0;Jr<Xr;Jr++){var nn=rr[Jr],Qn=1;ar===1&&(Qn=nn.length),pt.writeVarint(et(1,Qn));for(var sn=ar===3?nn.length-1:nn.length,Bn=0;Bn<sn;Bn++){Bn===1&&ar!==1&&pt.writeVarint(et(2,sn-1));var Tn=nn[Bn].x-gr,on=nn[Bn].y-Ur;pt.writeVarint(rt(Tn)),pt.writeVarint(rt(on)),gr+=Tn,Ur+=on}ar===3&&pt.writeVarint(et(7,1))}}function mt(Ct,pt){var rr=typeof Ct;rr==="string"?pt.writeStringField(1,Ct):rr==="boolean"?pt.writeBooleanField(7,Ct):rr==="number"&&(Ct%1!=0?pt.writeDoubleField(3,Ct):Ct<0?pt.writeSVarintField(6,Ct):pt.writeVarintField(5,Ct))}return Ue.exports=oe,Ue.exports.fromVectorTileJs=oe,Ue.exports.fromGeojsonVt=function(Ct,pt){pt=pt||{};var rr={};for(var ar in Ct)rr[ar]=new ae(Ct[ar].features,pt),rr[ar].name=ar,rr[ar].version=pt.version,rr[ar].extent=pt.extent;return oe({layers:rr})},Ue.exports.GeoJSONWrapper=ae,Ue.exports}(),Ke=i.fh(De);const lt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:dt=>dt},Ye=Math.fround||(Ve=new Float32Array(1),dt=>(Ve[0]=+dt,Ve[0]));var Ve;const Et=3,kt=5,Wt=6;class Tt{constructor(ae){this.options=Object.assign(Object.create(lt),ae),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ae){const{log:oe,minZoom:pe,maxZoom:$e}=this.options;oe&&console.time("total time");const He=`prepare ${ae.length} points`;oe&&console.time(He),this.points=ae;const et=[];for(let nt=0;nt<ae.length;nt++){const mt=ae[nt];if(!mt.geometry)continue;const[Ct,pt]=mt.geometry.coordinates,rr=Ye(Jt(Ct)),ar=Ye(Rt(pt));et.push(rr,ar,1/0,nt,-1,1),this.options.reduce&&et.push(0)}let rt=this.trees[$e+1]=this._createTree(et);oe&&console.timeEnd(He);for(let nt=$e;nt>=pe;nt--){const mt=+Date.now();rt=this.trees[nt]=this._createTree(this._cluster(rt,nt)),oe&&console.log("z%d: %d clusters in %dms",nt,rt.numItems,+Date.now()-mt)}return oe&&console.timeEnd("total time"),this}getClusters(ae,oe){let pe=((ae[0]+180)%360+360)%360-180;const $e=Math.max(-90,Math.min(90,ae[1]));let He=ae[2]===180?180:((ae[2]+180)%360+360)%360-180;const et=Math.max(-90,Math.min(90,ae[3]));if(ae[2]-ae[0]>=360)pe=-180,He=180;else if(pe>He){const pt=this.getClusters([pe,$e,180,et],oe),rr=this.getClusters([-180,$e,He,et],oe);return pt.concat(rr)}const rt=this.trees[this._limitZoom(oe)],nt=rt.range(Jt(pe),Rt(et),Jt(He),Rt($e)),mt=rt.data,Ct=[];for(const pt of nt){const rr=this.stride*pt;Ct.push(mt[rr+kt]>1?Ht(mt,rr,this.clusterProps):this.points[mt[rr+Et]])}return Ct}getChildren(ae){const oe=this._getOriginId(ae),pe=this._getOriginZoom(ae),$e="No cluster with the specified id.",He=this.trees[pe];if(!He)throw new Error($e);const et=He.data;if(oe*this.stride>=et.length)throw new Error($e);const rt=this.options.radius/(this.options.extent*Math.pow(2,pe-1)),nt=He.within(et[oe*this.stride],et[oe*this.stride+1],rt),mt=[];for(const Ct of nt){const pt=Ct*this.stride;et[pt+4]===ae&&mt.push(et[pt+kt]>1?Ht(et,pt,this.clusterProps):this.points[et[pt+Et]])}if(mt.length===0)throw new Error($e);return mt}getLeaves(ae,oe,pe){const $e=[];return this._appendLeaves($e,ae,oe=oe||10,pe=pe||0,0),$e}getTile(ae,oe,pe){const $e=this.trees[this._limitZoom(ae)],He=Math.pow(2,ae),{extent:et,radius:rt}=this.options,nt=rt/et,mt=(pe-nt)/He,Ct=(pe+1+nt)/He,pt={features:[]};return this._addTileFeatures($e.range((oe-nt)/He,mt,(oe+1+nt)/He,Ct),$e.data,oe,pe,He,pt),oe===0&&this._addTileFeatures($e.range(1-nt/He,mt,1,Ct),$e.data,He,pe,He,pt),oe===He-1&&this._addTileFeatures($e.range(0,mt,nt/He,Ct),$e.data,-1,pe,He,pt),pt.features.length?pt:null}getClusterExpansionZoom(ae){let oe=this._getOriginZoom(ae)-1;for(;oe<=this.options.maxZoom;){const pe=this.getChildren(ae);if(oe++,pe.length!==1)break;ae=pe[0].properties.cluster_id}return oe}_appendLeaves(ae,oe,pe,$e,He){const et=this.getChildren(oe);for(const rt of et){const nt=rt.properties;if(nt&&nt.cluster?He+nt.point_count<=$e?He+=nt.point_count:He=this._appendLeaves(ae,nt.cluster_id,pe,$e,He):He<$e?He++:ae.push(rt),ae.length===pe)break}return He}_createTree(ae){const oe=new i.bW(ae.length/this.stride|0,this.options.nodeSize,Float32Array);for(let pe=0;pe<ae.length;pe+=this.stride)oe.add(ae[pe],ae[pe+1]);return oe.finish(),oe.data=ae,oe}_addTileFeatures(ae,oe,pe,$e,He,et){for(const rt of ae){const nt=rt*this.stride,mt=oe[nt+kt]>1;let Ct,pt,rr;if(mt)Ct=ur(oe,nt,this.clusterProps),pt=oe[nt],rr=oe[nt+1];else{const Ur=this.points[oe[nt+Et]];Ct=Ur.properties;const[Xr,Jr]=Ur.geometry.coordinates;pt=Jt(Xr),rr=Rt(Jr)}const ar={type:1,geometry:[[Math.round(this.options.extent*(pt*He-pe)),Math.round(this.options.extent*(rr*He-$e))]],tags:Ct};let gr;gr=mt||this.options.generateId?oe[nt+Et]:this.points[oe[nt+Et]].id,gr!==void 0&&(ar.id=gr),et.features.push(ar)}}_limitZoom(ae){return Math.max(this.options.minZoom,Math.min(Math.floor(+ae),this.options.maxZoom+1))}_cluster(ae,oe){const{radius:pe,extent:$e,reduce:He,minPoints:et}=this.options,rt=pe/($e*Math.pow(2,oe)),nt=ae.data,mt=[],Ct=this.stride;for(let pt=0;pt<nt.length;pt+=Ct){if(nt[pt+2]<=oe)continue;nt[pt+2]=oe;const rr=nt[pt],ar=nt[pt+1],gr=ae.within(nt[pt],nt[pt+1],rt),Ur=nt[pt+kt];let Xr=Ur;for(const Jr of gr){const nn=Jr*Ct;nt[nn+2]>oe&&(Xr+=nt[nn+kt])}if(Xr>Ur&&Xr>=et){let Jr,nn=rr*Ur,Qn=ar*Ur,sn=-1;const Bn=(pt/Ct<<5)+(oe+1)+this.points.length;for(const Tn of gr){const on=Tn*Ct;if(nt[on+2]<=oe)continue;nt[on+2]=oe;const Vn=nt[on+kt];nn+=nt[on]*Vn,Qn+=nt[on+1]*Vn,nt[on+4]=Bn,He&&(Jr||(Jr=this._map(nt,pt,!0),sn=this.clusterProps.length,this.clusterProps.push(Jr)),He(Jr,this._map(nt,on)))}nt[pt+4]=Bn,mt.push(nn/Xr,Qn/Xr,1/0,Bn,-1,Xr),He&&mt.push(sn)}else{for(let Jr=0;Jr<Ct;Jr++)mt.push(nt[pt+Jr]);if(Xr>1)for(const Jr of gr){const nn=Jr*Ct;if(!(nt[nn+2]<=oe)){nt[nn+2]=oe;for(let Qn=0;Qn<Ct;Qn++)mt.push(nt[nn+Qn])}}}}return mt}_getOriginId(ae){return ae-this.points.length>>5}_getOriginZoom(ae){return(ae-this.points.length)%32}_map(ae,oe,pe){if(ae[oe+kt]>1){const et=this.clusterProps[ae[oe+Wt]];return pe?Object.assign({},et):et}const $e=this.points[ae[oe+Et]].properties,He=this.options.map($e);return pe&&He===$e?Object.assign({},He):He}}function Ht(dt,ae,oe){return{type:"Feature",id:dt[ae+Et],properties:ur(dt,ae,oe),geometry:{type:"Point",coordinates:[(pe=dt[ae],360*(pe-.5)),Dt(dt[ae+1])]}};var pe}function ur(dt,ae,oe){const pe=dt[ae+kt],$e=pe>=1e4?`${Math.round(pe/1e3)}k`:pe>=1e3?Math.round(pe/100)/10+"k":pe,He=dt[ae+Wt],et=He===-1?{}:Object.assign({},oe[He]);return Object.assign(et,{cluster:!0,cluster_id:dt[ae+Et],point_count:pe,point_count_abbreviated:$e})}function Jt(dt){return dt/360+.5}function Rt(dt){const ae=Math.sin(dt*Math.PI/180),oe=.5-.25*Math.log((1+ae)/(1-ae))/Math.PI;return oe<0?0:oe>1?1:oe}function Dt(dt){const ae=(180-360*dt)*Math.PI/180;return 360*Math.atan(Math.exp(ae))/Math.PI-90}function sr(dt,ae,oe,pe){let $e=pe;const He=ae+(oe-ae>>1);let et,rt=oe-ae;const nt=dt[ae],mt=dt[ae+1],Ct=dt[oe],pt=dt[oe+1];for(let rr=ae+3;rr<oe;rr+=3){const ar=mr(dt[rr],dt[rr+1],nt,mt,Ct,pt);if(ar>$e)et=rr,$e=ar;else if(ar===$e){const gr=Math.abs(rr-He);gr<rt&&(et=rr,rt=gr)}}$e>pe&&(et-ae>3&&sr(dt,ae,et,pe),dt[et+2]=$e,oe-et>3&&sr(dt,et,oe,pe))}function mr(dt,ae,oe,pe,$e,He){let et=$e-oe,rt=He-pe;if(et!==0||rt!==0){const nt=((dt-oe)*et+(ae-pe)*rt)/(et*et+rt*rt);nt>1?(oe=$e,pe=He):nt>0&&(oe+=et*nt,pe+=rt*nt)}return et=dt-oe,rt=ae-pe,et*et+rt*rt}function Vr(dt,ae,oe,pe){const $e={id:dt??null,type:ae,geometry:oe,tags:pe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ae==="Point"||ae==="MultiPoint"||ae==="LineString")rn($e,oe);else if(ae==="Polygon")rn($e,oe[0]);else if(ae==="MultiLineString")for(const He of oe)rn($e,He);else if(ae==="MultiPolygon")for(const He of oe)rn($e,He[0]);return $e}function rn(dt,ae){for(let oe=0;oe<ae.length;oe+=3)dt.minX=Math.min(dt.minX,ae[oe]),dt.minY=Math.min(dt.minY,ae[oe+1]),dt.maxX=Math.max(dt.maxX,ae[oe]),dt.maxY=Math.max(dt.maxY,ae[oe+1])}function $r(dt,ae,oe,pe){if(!ae.geometry)return;const $e=ae.geometry.coordinates;if($e&&$e.length===0)return;const He=ae.geometry.type,et=Math.pow(oe.tolerance/((1<<oe.maxZoom)*oe.extent),2);let rt=[],nt=ae.id;if(oe.promoteId?nt=ae.properties[oe.promoteId]:oe.generateId&&(nt=pe||0),He==="Point")Yr($e,rt);else if(He==="MultiPoint")for(const mt of $e)Yr(mt,rt);else if(He==="LineString")un($e,rt,et,!1);else if(He==="MultiLineString"){if(oe.lineMetrics){for(const mt of $e)rt=[],un(mt,rt,et,!1),dt.push(Vr(nt,"LineString",rt,ae.properties));return}Fn($e,rt,et,!1)}else if(He==="Polygon")Fn($e,rt,et,!0);else{if(He!=="MultiPolygon"){if(He==="GeometryCollection"){for(const mt of ae.geometry.geometries)$r(dt,{id:nt,geometry:mt,properties:ae.properties},oe,pe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const mt of $e){const Ct=[];Fn(mt,Ct,et,!0),rt.push(Ct)}}dt.push(Vr(nt,He,rt,ae.properties))}function Yr(dt,ae){ae.push(vi(dt[0]),xr(dt[1]),0)}function un(dt,ae,oe,pe){let $e,He,et=0;for(let nt=0;nt<dt.length;nt++){const mt=vi(dt[nt][0]),Ct=xr(dt[nt][1]);ae.push(mt,Ct,0),nt>0&&(et+=pe?($e*Ct-mt*He)/2:Math.sqrt(Math.pow(mt-$e,2)+Math.pow(Ct-He,2))),$e=mt,He=Ct}const rt=ae.length-3;ae[2]=1,sr(ae,0,rt,oe),ae[rt+2]=1,ae.size=Math.abs(et),ae.start=0,ae.end=ae.size}function Fn(dt,ae,oe,pe){for(let $e=0;$e<dt.length;$e++){const He=[];un(dt[$e],He,oe,pe),ae.push(He)}}function vi(dt){return dt/360+.5}function xr(dt){const ae=Math.sin(dt*Math.PI/180),oe=.5-.25*Math.log((1+ae)/(1-ae))/Math.PI;return oe<0?0:oe>1?1:oe}function Hr(dt,ae,oe,pe,$e,He,et,rt){if(pe/=ae,He>=(oe/=ae)&&et<pe)return dt;if(et<oe||He>=pe)return null;const nt=[];for(const mt of dt){const Ct=mt.geometry;let pt=mt.type;const rr=$e===0?mt.minX:mt.minY,ar=$e===0?mt.maxX:mt.maxY;if(rr>=oe&&ar<pe){nt.push(mt);continue}if(ar<oe||rr>=pe)continue;let gr=[];if(pt==="Point"||pt==="MultiPoint")wn(Ct,gr,oe,pe,$e);else if(pt==="LineString")xi(Ct,gr,oe,pe,$e,!1,rt.lineMetrics);else if(pt==="MultiLineString")Ui(Ct,gr,oe,pe,$e,!1);else if(pt==="Polygon")Ui(Ct,gr,oe,pe,$e,!0);else if(pt==="MultiPolygon")for(const Ur of Ct){const Xr=[];Ui(Ur,Xr,oe,pe,$e,!0),Xr.length&&gr.push(Xr)}if(gr.length){if(rt.lineMetrics&&pt==="LineString"){for(const Ur of gr)nt.push(Vr(mt.id,pt,Ur,mt.tags));continue}pt!=="LineString"&&pt!=="MultiLineString"||(gr.length===1?(pt="LineString",gr=gr[0]):pt="MultiLineString"),pt!=="Point"&&pt!=="MultiPoint"||(pt=gr.length===3?"Point":"MultiPoint"),nt.push(Vr(mt.id,pt,gr,mt.tags))}}return nt.length?nt:null}function wn(dt,ae,oe,pe,$e){for(let He=0;He<dt.length;He+=3){const et=dt[He+$e];et>=oe&&et<=pe&&js(ae,dt[He],dt[He+1],dt[He+2])}}function xi(dt,ae,oe,pe,$e,He,et){let rt=ms(dt);const nt=$e===0?es:Uo;let mt,Ct,pt=dt.start;for(let Xr=0;Xr<dt.length-3;Xr+=3){const Jr=dt[Xr],nn=dt[Xr+1],Qn=dt[Xr+2],sn=dt[Xr+3],Bn=dt[Xr+4],Tn=$e===0?Jr:nn,on=$e===0?sn:Bn;let Vn=!1;et&&(mt=Math.sqrt(Math.pow(Jr-sn,2)+Math.pow(nn-Bn,2))),Tn<oe?on>oe&&(Ct=nt(rt,Jr,nn,sn,Bn,oe),et&&(rt.start=pt+mt*Ct)):Tn>pe?on<pe&&(Ct=nt(rt,Jr,nn,sn,Bn,pe),et&&(rt.start=pt+mt*Ct)):js(rt,Jr,nn,Qn),on<oe&&Tn>=oe&&(Ct=nt(rt,Jr,nn,sn,Bn,oe),Vn=!0),on>pe&&Tn<=pe&&(Ct=nt(rt,Jr,nn,sn,Bn,pe),Vn=!0),!He&&Vn&&(et&&(rt.end=pt+mt*Ct),ae.push(rt),rt=ms(dt)),et&&(pt+=mt)}let rr=dt.length-3;const ar=dt[rr],gr=dt[rr+1],Ur=$e===0?ar:gr;Ur>=oe&&Ur<=pe&&js(rt,ar,gr,dt[rr+2]),rr=rt.length-3,He&&rr>=3&&(rt[rr]!==rt[0]||rt[rr+1]!==rt[1])&&js(rt,rt[0],rt[1],rt[2]),rt.length&&ae.push(rt)}function ms(dt){const ae=[];return ae.size=dt.size,ae.start=dt.start,ae.end=dt.end,ae}function Ui(dt,ae,oe,pe,$e,He){for(const et of dt)xi(et,ae,oe,pe,$e,He,!1)}function js(dt,ae,oe,pe){dt.push(ae,oe,pe)}function es(dt,ae,oe,pe,$e,He){const et=(He-ae)/(pe-ae);return js(dt,He,oe+($e-oe)*et,1),et}function Uo(dt,ae,oe,pe,$e,He){const et=(He-oe)/($e-oe);return js(dt,ae+(pe-ae)*et,He,1),et}function Ys(dt,ae){const oe=[];for(let pe=0;pe<dt.length;pe++){const $e=dt[pe],He=$e.type;let et;if(He==="Point"||He==="MultiPoint"||He==="LineString")et=Js($e.geometry,ae);else if(He==="MultiLineString"||He==="Polygon"){et=[];for(const rt of $e.geometry)et.push(Js(rt,ae))}else if(He==="MultiPolygon"){et=[];for(const rt of $e.geometry){const nt=[];for(const mt of rt)nt.push(Js(mt,ae));et.push(nt)}}oe.push(Vr($e.id,He,et,$e.tags))}return oe}function Js(dt,ae){const oe=[];oe.size=dt.size,dt.start!==void 0&&(oe.start=dt.start,oe.end=dt.end);for(let pe=0;pe<dt.length;pe+=3)oe.push(dt[pe]+ae,dt[pe+1],dt[pe+2]);return oe}function bo(dt,ae){if(dt.transformed)return dt;const oe=1<<dt.z,pe=dt.x,$e=dt.y;for(const He of dt.features){const et=He.geometry,rt=He.type;if(He.geometry=[],rt===1)for(let nt=0;nt<et.length;nt+=2)He.geometry.push(wo(et[nt],et[nt+1],ae,oe,pe,$e));else for(let nt=0;nt<et.length;nt++){const mt=[];for(let Ct=0;Ct<et[nt].length;Ct+=2)mt.push(wo(et[nt][Ct],et[nt][Ct+1],ae,oe,pe,$e));He.geometry.push(mt)}}return dt.transformed=!0,dt}function wo(dt,ae,oe,pe,$e,He){return[Math.round(oe*(dt*pe-$e)),Math.round(oe*(ae*pe-He))]}function So(dt,ae,oe,pe,$e){const He=ae===$e.maxZoom?0:$e.tolerance/((1<<ae)*$e.extent),et={features:[],numPoints:0,numSimplified:0,numFeatures:dt.length,source:null,x:oe,y:pe,z:ae,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const rt of dt)Jn(et,rt,He,$e);return et}function Jn(dt,ae,oe,pe){const $e=ae.geometry,He=ae.type,et=[];if(dt.minX=Math.min(dt.minX,ae.minX),dt.minY=Math.min(dt.minY,ae.minY),dt.maxX=Math.max(dt.maxX,ae.maxX),dt.maxY=Math.max(dt.maxY,ae.maxY),He==="Point"||He==="MultiPoint")for(let rt=0;rt<$e.length;rt+=3)et.push($e[rt],$e[rt+1]),dt.numPoints++,dt.numSimplified++;else if(He==="LineString")Ds(et,$e,dt,oe,!1,!1);else if(He==="MultiLineString"||He==="Polygon")for(let rt=0;rt<$e.length;rt++)Ds(et,$e[rt],dt,oe,He==="Polygon",rt===0);else if(He==="MultiPolygon")for(let rt=0;rt<$e.length;rt++){const nt=$e[rt];for(let mt=0;mt<nt.length;mt++)Ds(et,nt[mt],dt,oe,!0,mt===0)}if(et.length){let rt=ae.tags||null;if(He==="LineString"&&pe.lineMetrics){rt={};for(const mt in ae.tags)rt[mt]=ae.tags[mt];rt.mapbox_clip_start=$e.start/$e.size,rt.mapbox_clip_end=$e.end/$e.size}const nt={geometry:et,type:He==="Polygon"||He==="MultiPolygon"?3:He==="LineString"||He==="MultiLineString"?2:1,tags:rt};ae.id!==null&&(nt.id=ae.id),dt.features.push(nt)}}function Ds(dt,ae,oe,pe,$e,He){const et=pe*pe;if(pe>0&&ae.size<($e?et:pe))return void(oe.numPoints+=ae.length/3);const rt=[];for(let nt=0;nt<ae.length;nt+=3)(pe===0||ae[nt+2]>et)&&(oe.numSimplified++,rt.push(ae[nt],ae[nt+1])),oe.numPoints++;$e&&function(nt,mt){let Ct=0;for(let pt=0,rr=nt.length,ar=rr-2;pt<rr;ar=pt,pt+=2)Ct+=(nt[pt]-nt[ar])*(nt[pt+1]+nt[ar+1]);if(Ct>0===mt)for(let pt=0,rr=nt.length;pt<rr/2;pt+=2){const ar=nt[pt],gr=nt[pt+1];nt[pt]=nt[rr-2-pt],nt[pt+1]=nt[rr-1-pt],nt[rr-2-pt]=ar,nt[rr-1-pt]=gr}}(rt,He),dt.push(rt)}const Io={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class _s{constructor(ae,oe){const pe=(oe=this.options=function(He,et){for(const rt in et)He[rt]=et[rt];return He}(Object.create(Io),oe)).debug;if(pe&&console.time("preprocess data"),oe.maxZoom<0||oe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(oe.promoteId&&oe.generateId)throw new Error("promoteId and generateId cannot be used together.");let $e=function(He,et){const rt=[];if(He.type==="FeatureCollection")for(let nt=0;nt<He.features.length;nt++)$r(rt,He.features[nt],et,nt);else $r(rt,He.type==="Feature"?He:{geometry:He},et);return rt}(ae,oe);this.tiles={},this.tileCoords=[],pe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",oe.indexMaxZoom,oe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),$e=function(He,et){const rt=et.buffer/et.extent;let nt=He;const mt=Hr(He,1,-1-rt,rt,0,-1,2,et),Ct=Hr(He,1,1-rt,2+rt,0,-1,2,et);return(mt||Ct)&&(nt=Hr(He,1,-rt,1+rt,0,-1,2,et)||[],mt&&(nt=Ys(mt,1).concat(nt)),Ct&&(nt=nt.concat(Ys(Ct,-1)))),nt}($e,oe),$e.length&&this.splitTile($e,0,0,0),pe&&($e.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ae,oe,pe,$e,He,et,rt){const nt=[ae,oe,pe,$e],mt=this.options,Ct=mt.debug;for(;nt.length;){$e=nt.pop(),pe=nt.pop(),oe=nt.pop(),ae=nt.pop();const pt=1<<oe,rr=uo(oe,pe,$e);let ar=this.tiles[rr];if(!ar&&(Ct>1&&console.time("creation"),ar=this.tiles[rr]=So(ae,oe,pe,$e,mt),this.tileCoords.push({z:oe,x:pe,y:$e}),Ct)){Ct>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",oe,pe,$e,ar.numFeatures,ar.numPoints,ar.numSimplified),console.timeEnd("creation"));const Vn=`z${oe}`;this.stats[Vn]=(this.stats[Vn]||0)+1,this.total++}if(ar.source=ae,He==null){if(oe===mt.indexMaxZoom||ar.numPoints<=mt.indexMaxPoints)continue}else{if(oe===mt.maxZoom||oe===He)continue;if(He!=null){const Vn=He-oe;if(pe!==et>>Vn||$e!==rt>>Vn)continue}}if(ar.source=null,ae.length===0)continue;Ct>1&&console.time("clipping");const gr=.5*mt.buffer/mt.extent,Ur=.5-gr,Xr=.5+gr,Jr=1+gr;let nn=null,Qn=null,sn=null,Bn=null,Tn=Hr(ae,pt,pe-gr,pe+Xr,0,ar.minX,ar.maxX,mt),on=Hr(ae,pt,pe+Ur,pe+Jr,0,ar.minX,ar.maxX,mt);ae=null,Tn&&(nn=Hr(Tn,pt,$e-gr,$e+Xr,1,ar.minY,ar.maxY,mt),Qn=Hr(Tn,pt,$e+Ur,$e+Jr,1,ar.minY,ar.maxY,mt),Tn=null),on&&(sn=Hr(on,pt,$e-gr,$e+Xr,1,ar.minY,ar.maxY,mt),Bn=Hr(on,pt,$e+Ur,$e+Jr,1,ar.minY,ar.maxY,mt),on=null),Ct>1&&console.timeEnd("clipping"),nt.push(nn||[],oe+1,2*pe,2*$e),nt.push(Qn||[],oe+1,2*pe,2*$e+1),nt.push(sn||[],oe+1,2*pe+1,2*$e),nt.push(Bn||[],oe+1,2*pe+1,2*$e+1)}}getTile(ae,oe,pe){ae=+ae,oe=+oe,pe=+pe;const $e=this.options,{extent:He,debug:et}=$e;if(ae<0||ae>24)return null;const rt=1<<ae,nt=uo(ae,oe=oe+rt&rt-1,pe);if(this.tiles[nt])return bo(this.tiles[nt],He);et>1&&console.log("drilling down to z%d-%d-%d",ae,oe,pe);let mt,Ct=ae,pt=oe,rr=pe;for(;!mt&&Ct>0;)Ct--,pt>>=1,rr>>=1,mt=this.tiles[uo(Ct,pt,rr)];return mt&&mt.source?(et>1&&(console.log("found parent tile z%d-%d-%d",Ct,pt,rr),console.time("drilling down")),this.splitTile(mt.source,Ct,pt,rr,ae,oe,pe),et>1&&console.timeEnd("drilling down"),this.tiles[nt]?bo(this.tiles[nt],He):null):null}}function uo(dt,ae,oe){return 32*((1<<dt)*oe+ae)+dt}function qo(dt,ae){const oe=dt.tileID.canonical;if(!this._geoJSONIndex)return void ae(null,null);const pe=this._geoJSONIndex.getTile(oe.z,oe.x,oe.y);if(!pe)return void ae(null,null);const $e=new Y(pe.features);let He=Ke($e);He.byteOffset===0&&He.byteLength===He.buffer.byteLength||(He=new Uint8Array(He)),ae(null,{vectorTile:$e,rawData:He.buffer})}class oa extends N{constructor(ae,oe,pe,$e,He,et,rt){super(ae,oe,pe,$e,He,qo,rt),et&&(this.loadGeoJSON=et),this._dynamicIndex=new ge}loadData(ae,oe){const pe=ae&&ae.request,$e=pe&&pe.collectResourceTiming;this.loadGeoJSON(ae,(He,et)=>{if(He||!et)return oe(He);if(typeof et!="object")return oe(new Error(`Input data given to '${ae.source}' is not a valid GeoJSON object.`));{try{if(ae.filter){const nt=i.X(ae.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(nt.result==="error")throw new Error(nt.value.map(mt=>`${mt.key}: ${mt.message}`).join(", "));et.features=et.features.filter(mt=>nt.value.evaluate({zoom:0},mt))}ae.dynamic?(et.type==="Feature"&&(et={type:"FeatureCollection",features:[et]}),ae.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(et.features,this.loaded),ae.cluster&&(et.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ae.cluster?new Tt(function({superclusterOptions:nt,clusterProperties:mt}){if(!mt||!nt)return nt;const Ct={},pt={},rr={accumulated:null,zoom:0},ar={properties:null},gr=Object.keys(mt);for(const Ur of gr){const[Xr,Jr]=mt[Ur],nn=i.X(Jr),Qn=i.X(typeof Xr=="string"?[Xr,["accumulated"],["get",Ur]]:Xr);Ct[Ur]=nn.value,pt[Ur]=Qn.value}return nt.map=Ur=>{ar.properties=Ur;const Xr={};for(const Jr of gr)Xr[Jr]=Ct[Jr].evaluate(rr,ar);return Xr},nt.reduce=(Ur,Xr)=>{ar.properties=Xr;for(const Jr of gr)rr.accumulated=Ur[Jr],Ur[Jr]=pt[Jr].evaluate(rr,ar)},nt}(ae)).load(et.features):ae.dynamic?this._dynamicIndex:function(nt,mt){return new _s(nt,mt)}(et,ae.geojsonVtOptions)}catch(nt){return oe(nt)}const rt={};if($e){const nt=y(pe);nt&&(rt.resourceTiming={},rt.resourceTiming[ae.source]=JSON.parse(JSON.stringify(nt)))}oe(null,rt)}})}reloadTile(ae,oe){const pe=this.loaded;return pe&&pe[ae.uid]?ae.partial?oe(null,void 0):super.reloadTile(ae,oe):this.loadTile(ae,oe)}loadGeoJSON(ae,oe){if(ae.request)i.n(ae.request,oe);else{if(typeof ae.data!="string")return oe(new Error(`Input data given to '${ae.source}' is not a valid GeoJSON object.`));try{return oe(null,JSON.parse(ae.data))}catch{return oe(new Error(`Input data given to '${ae.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ae,oe){try{oe(null,this._geoJSONIndex.getClusterExpansionZoom(ae.clusterId))}catch(pe){oe(pe)}}getClusterChildren(ae,oe){try{oe(null,this._geoJSONIndex.getChildren(ae.clusterId))}catch(pe){oe(pe)}}getClusterLeaves(ae,oe){try{oe(null,this._geoJSONIndex.getLeaves(ae.clusterId,ae.limit,ae.offset))}catch(pe){oe(pe)}}}class Qt{constructor(ae,oe){this.tileID=new i.aM(ae.tileID.overscaledZ,ae.tileID.wrap,ae.tileID.canonical.z,ae.tileID.canonical.x,ae.tileID.canonical.y),this.tileZoom=ae.tileZoom,this.uid=ae.uid,this.zoom=ae.zoom,this.canonical=ae.tileID.canonical,this.pixelRatio=ae.pixelRatio,this.tileSize=ae.tileSize,this.source=ae.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ae.projection,this.brightness=oe}parse(ae,oe,pe,$e){this.status="parsing";const He=new i.aM(pe.tileID.overscaledZ,pe.tileID.wrap,pe.tileID.canonical.z,pe.tileID.canonical.x,pe.tileID.canonical.y),et=[],rt=oe.familiesBySource[pe.source],nt=new i.f0(He,pe.promoteId);nt.bucketLayerIDs=[],nt.is3DTile=!0,i.fi(ae).then(mt=>{if(!mt)return $e(new Error("Could not parse tile"));const Ct=i.fj(mt,1/i.cT(pe.tileID.canonical)),pt=mt.json.extensionsUsed&&mt.json.extensionsUsed.includes("MAPBOX_mesh_features")||mt.json.asset.extras&&mt.json.asset.extras.MAPBOX_mesh_features,rr=mt.json.extensionsUsed&&mt.json.extensionsUsed.includes("EXT_meshopt_compression"),ar=new i.aa(this.zoom,{brightness:this.brightness});for(const gr in rt)for(const Ur of rt[gr]){const Xr=Ur[0];nt.bucketLayerIDs.push(Ur.map(nn=>i.C(nn.id,nn.scope))),Xr.recalculate(ar,[]);const Jr=new i.fk(Ur,Ct,He,pt,rr,this.brightness,nt);pt||(Jr.needsUpload=!0),et.push(Jr),Jr.evaluate(Xr)}this.status="done",$e(null,{buckets:et,featureIndex:nt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(mt=>$e(new Error(mt.message)))}}class Hs{constructor(ae,oe,pe,$e,He,et,rt){this.actor=ae,this.layerIndex=oe,this.availableImages=pe,this.availableModels=$e,this.brightness=rt,this.loading={},this.loaded={}}loadTile(ae,oe){const pe=ae.uid,$e=this.loading[pe]=new Qt(ae,this.brightness);i.br(ae.request,(He,et)=>{const rt=!this.loading[pe];return delete this.loading[pe],rt||He?($e.status="done",rt||(this.loaded[pe]=$e),oe(He)):et&&et.byteLength!==0?void $e.parse(et,this.layerIndex,ae,(nt,mt)=>{$e.status="done",this.loaded=this.loaded||{},this.loaded[pe]=$e,nt||!mt?oe(nt):oe(null,mt)}):($e.status="done",this.loaded[pe]=$e,oe())})}reloadTile(ae,oe){const pe=this.loaded,$e=ae.uid;if(pe&&pe[$e]){const He=pe[$e];He.projection=ae.projection,He.brightness=ae.brightness;const et=(rt,nt)=>{He.reloadCallback&&(delete He.reloadCallback,this.loadTile(ae,oe)),oe(rt,nt)};He.status==="parsing"?He.reloadCallback=et:He.status==="done"&&this.loadTile(ae,oe)}}abortTile(ae,oe){const pe=ae.uid;this.loading[pe]&&delete this.loading[pe],oe()}removeTile(ae,oe){const pe=this.loaded,$e=ae.uid;pe&&pe[$e]&&delete pe[$e],oe()}}class Go{constructor(ae){this.self=ae,this.actor=new i.fm(ae,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new i.y,this.projections={},this.defaultProjection=i.ce({name:"mercator"}),this.workerSourceTypes={vector:N,geojson:oa,"raster-dem":V,"raster-array":Z,"batched-model":Hs},this.workerSources={},this.self.registerWorkerSource=(oe,pe)=>{if(this.workerSourceTypes[oe])throw new Error(`Worker source with name "${oe}" already registered.`);this.workerSourceTypes[oe]=pe},this.self.registerRTLTextPlugin=oe=>{if(i.fn.isParsed())throw new Error("RTL text plugin already registered.");i.fn.applyArabicShaping=oe.applyArabicShaping,i.fn.processBidirectionalText=oe.processBidirectionalText,i.fn.processStyledBidirectionalText=oe.processStyledBidirectionalText}}clearCaches(ae,oe,pe){delete this.layerIndexes[ae],delete this.availableImages[ae],delete this.availableModels[ae],delete this.workerSources[ae],pe()}checkIfReady(ae,oe,pe){pe()}setReferrer(ae,oe){this.referrer=oe}spriteLoaded(ae,oe){this.isSpriteLoaded[ae]||(this.isSpriteLoaded[ae]={});const{scope:pe,isLoaded:$e}=oe;if(this.isSpriteLoaded[ae][pe]=$e,this.workerSources[ae]&&this.workerSources[ae][pe])for(const He in this.workerSources[ae][pe]){const et=this.workerSources[ae][pe][He];for(const rt in et){const nt=et[rt];nt instanceof N&&(nt.isSpriteLoaded=$e,nt.fire(new i.A("isSpriteLoaded")))}}}setImages(ae,oe,pe){this.availableImages[ae]||(this.availableImages[ae]={});const{scope:$e,images:He}=oe;if(this.availableImages[ae][$e]=He,this.workerSources[ae]&&this.workerSources[ae][$e]){for(const et in this.workerSources[ae][$e]){const rt=this.workerSources[ae][$e][et];for(const nt in rt)rt[nt].availableImages=He}pe()}else pe()}setModels(ae,{scope:oe,models:pe},$e){if(this.availableModels[ae]||(this.availableModels[ae]={}),this.availableModels[ae][oe]=pe,this.workerSources[ae]&&this.workerSources[ae][oe]){for(const He in this.workerSources[ae][oe]){const et=this.workerSources[ae][oe][He];for(const rt in et)et[rt].availableModels=pe}$e()}else $e()}setProjection(ae,oe){this.projections[ae]=i.ce(oe)}setBrightness(ae,oe,pe){this.brightness=oe,pe()}setLayers(ae,oe,pe){this.getLayerIndex(ae,oe.scope).replace(oe.layers,oe.options),pe()}updateLayers(ae,oe,pe){this.getLayerIndex(ae,oe.scope).update(oe.layers,oe.removedIds,oe.options),pe()}loadTile(ae,oe,pe){oe.projection=this.projections[ae]||this.defaultProjection,this.getWorkerSource(ae,oe.type,oe.source,oe.scope).loadTile(oe,pe)}decodeRasterArray(ae,oe,pe){this.getWorkerSource(ae,oe.type,oe.source,oe.scope).decodeRasterArray(oe,pe)}reloadTile(ae,oe,pe){oe.projection=this.projections[ae]||this.defaultProjection,this.getWorkerSource(ae,oe.type,oe.source,oe.scope).reloadTile(oe,pe)}abortTile(ae,oe,pe){this.getWorkerSource(ae,oe.type,oe.source,oe.scope).abortTile(oe,pe)}removeTile(ae,oe,pe){this.getWorkerSource(ae,oe.type,oe.source,oe.scope).removeTile(oe,pe)}removeSource(ae,oe,pe){if(!(this.workerSources[ae]&&this.workerSources[ae][oe.scope]&&this.workerSources[ae][oe.scope][oe.type]&&this.workerSources[ae][oe.scope][oe.type][oe.source]))return;const $e=this.workerSources[ae][oe.scope][oe.type][oe.source];delete this.workerSources[ae][oe.scope][oe.type][oe.source],$e.removeSource!==void 0?$e.removeSource(oe,pe):pe()}loadWorkerSource(ae,oe,pe){try{this.self.importScripts(oe.url),pe()}catch($e){pe($e.toString())}}syncRTLPluginState(ae,oe,pe){try{i.fn.setState(oe);const $e=i.fn.getPluginURL();if(i.fn.isLoaded()&&!i.fn.isParsed()&&$e!=null){this.self.importScripts($e);const He=i.fn.isParsed();pe(He?void 0:new Error(`RTL Text Plugin failed to import scripts from ${$e}`),He)}}catch($e){pe($e.toString())}}setDracoUrl(ae,oe){this.dracoUrl=oe}getAvailableImages(ae,oe){this.availableImages[ae]||(this.availableImages[ae]={});let pe=this.availableImages[ae][oe];return pe||(pe=[]),pe}getAvailableModels(ae,oe){this.availableModels[ae]||(this.availableModels[ae]={});let pe=this.availableModels[ae][oe];return pe||(pe={}),pe}getLayerIndex(ae,oe){this.layerIndexes[ae]||(this.layerIndexes[ae]={});let pe=this.layerIndexes[ae][oe];return pe||(pe=this.layerIndexes[ae][oe]=new A,pe.scope=oe),pe}getWorkerSource(ae,oe,pe,$e){const He=this.workerSources;return He[ae]||(He[ae]={}),He[ae][$e]||(He[ae][$e]={}),He[ae][$e][oe]||(He[ae][$e][oe]={}),this.isSpriteLoaded[ae]||(this.isSpriteLoaded[ae]={}),He[ae][$e][oe][pe]||(He[ae][$e][oe][pe]=new this.workerSourceTypes[oe]({send:(et,rt,nt,mt,Ct,pt)=>this.actor.send(et,rt,nt,ae,Ct,pt),scheduler:this.actor.scheduler},this.getLayerIndex(ae,$e),this.getAvailableImages(ae,$e),this.getAvailableModels(ae,$e),this.isSpriteLoaded[ae][$e],void 0,this.brightness)),He[ae][$e][oe][pe]}rasterizeImagesWorker(ae,oe,pe){const $e=new Map;for(const[He,{image:et,imageVariant:rt}]of oe.tasks.entries()){const nt=this.imageRasterizer.rasterize(rt,et,oe.scope,ae);$e.set(He,nt)}pe(void 0,$e)}removeRasterizedImages(ae,oe,pe){this.imageRasterizer.removeImagesFromCacheByIds(oe.imageIds,oe.scope,ae),pe()}enforceCacheSizeLimit(ae,oe){i.fo(oe)}getWorkerPerformanceMetrics(ae,oe,pe){pe(void 0,void 0)}}return i.fl(self)&&(self.worker=new Go(self)),Go}),u(["./shared"],function(i){var y="3.12.0";const w={create:"create",load:"load",fullLoad:"fullLoad"},T={mark(m){performance.mark(m)},measure(m,o,d){performance.measure(m,o,d)}};function A(m){const o=m.name.split("?")[0];return i.a(o)&&o.includes("mapbox-gl.js")?"javascript":i.a(o)&&o.includes("mapbox-gl.css")?"css":i.b(o)?"fontRange":i.c(o)?"sprite":i.i(o)?"style":i.d(o)?"tilejson":"other"}var k,F={},D=function(){if(k)return F;function m(g){return!o(g)}function o(g){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var C,M,L=new Blob([""],{type:"text/javascript"}),B=URL.createObjectURL(L);try{M=new Worker(B),C=!0}catch{C=!1}return M&&M.terminate(),URL.revokeObjectURL(B),C}()?function(){var C=document.createElement("canvas");C.width=C.height=1;var M=C.getContext("2d");if(!M)return!1;var L=M.getImageData(0,0,1,1);return L&&L.width===C.width}()?(d[S=g&&g.failIfMajorPerformanceCaveat]===void 0&&(d[S]=function(C){var M,L=function(B){var q=document.createElement("canvas"),X=Object.create(m.webGLContextAttributes);return X.failIfMajorPerformanceCaveat=B,q.getContext("webgl2",X)}(C);if(!L)return!1;try{M=L.createShader(L.VERTEX_SHADER)}catch{return!1}return!(!M||L.isContextLost())&&(L.shaderSource(M,"void main() {}"),L.compileShader(M),L.getShaderParameter(M,L.COMPILE_STATUS)===!0)}(S)),d[S]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var S}k=1,F.supported=m,F.notSupportedReason=o;var d={};return m.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},F}();function O(m,o,d){const g=document.createElement(m);return o!=null&&(g.className=o),d&&d.appendChild(g),g}function N(m,o,d){const g=document.createElementNS("http://www.w3.org/2000/svg",m);for(const S of Object.keys(o))g.setAttributeNS(null,S,String(o[S]));return d&&d.appendChild(g),g}const V=typeof document<"u"?document.documentElement&&document.documentElement.style:null,H=V&&V.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Z;function J(){V&&H&&(Z=V[H],V[H]="none")}function G(){V&&H&&(V[H]=Z)}function Y(m){m.preventDefault(),m.stopPropagation(),window.removeEventListener("click",Y,!0)}function ie(){window.addEventListener("click",Y,!0),window.setTimeout(()=>{window.removeEventListener("click",Y,!0)},0)}function ce(m,o){const d=m.getBoundingClientRect();return xe(m,d,o)}function ge(m,o){const d=m.getBoundingClientRect(),g=[];for(let S=0;S<o.length;S++)g.push(xe(m,d,o[S]));return g}function be(m){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&m.button===2&&m.ctrlKey?0:m.button}function xe(m,o,d){const g=m.offsetWidth===o.width?1:m.offsetWidth/o.width;return new i.P((d.clientX-o.left)*g,(d.clientY-o.top)*g)}const Le="01",ze="NO_ACCESS_TOKEN";class Xe{constructor(o,d,g){this._transformRequestFn=o,this._customAccessToken=d,this._silenceAuthErrors=!!g,this._createSkuToken()}_createSkuToken(){const o=function(){let d="";for(let g=0;g<10;g++)d+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Le,d].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,d){return this._transformRequestFn&&this._transformRequestFn(o,d)||{url:o}}normalizeStyleURL(o,d){if(!i.f(o))return o;const g=tt(o);return g.params.push(`sdk=js-${y}`),g.path=`/styles/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||d)}normalizeGlyphsURL(o,d){if(!i.f(o))return o;const g=tt(o);return g.path=`/fonts/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||d)}normalizeModelURL(o,d){if(!i.f(o))return o;const g=tt(o);return g.path=`/models/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||d)}normalizeSourceURL(o,d,g,S){if(!i.f(o))return o;const C=tt(o);return C.path=`/v4/${C.authority}.json`,C.params.push("secure"),g&&C.params.push(`language=${g}`),S&&C.params.push(`worldview=${S}`),this._makeAPIURL(C,this._customAccessToken||d)}normalizeIconsetURL(o,d){const g=tt(o);return i.f(o)?(g.path=`/styles/v1${g.path}/iconset.pbf`,this._makeAPIURL(g,this._customAccessToken||d)):st(g)}normalizeSpriteURL(o,d,g,S){const C=tt(o);return i.f(o)?(C.path=`/styles/v1${C.path}/sprite${d}${g}`,this._makeAPIURL(C,this._customAccessToken||S)):(C.path+=`${d}${g}`,st(C))}normalizeTileURL(o,d,g){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!i.f(o))return o;const S=tt(o);S.path=S.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${d||g&&S.authority!=="raster"&&g===512?"@2x":""}${i.m.supported?".webp":"$1"}`),S.authority==="raster"?S.path=`/${i.e.RASTER_URL_PREFIX}${S.path}`:S.authority==="rasterarrays"?S.path=`/${i.e.RASTERARRAYS_URL_PREFIX}${S.path}`:S.authority==="3dtiles"?S.path=`/${i.e.TILES3D_URL_PREFIX}${S.path}`:(S.path=S.path.replace(/^.+\/v4\//,"/"),S.path=`/${i.e.TILE_URL_VERSION}${S.path}`);const C=this._customAccessToken||function(M){for(const L of M){const B=L.match(/^access_token=(.*)$/);if(B)return B[1]}return null}(S.params)||i.e.ACCESS_TOKEN;return i.e.REQUIRE_ACCESS_TOKEN&&C&&this._skuToken&&S.params.push(`sku=${this._skuToken}`),this._makeAPIURL(S,C)}canonicalizeTileURL(o,d){const g=tt(o);if(!g.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!g.path.match(/\.[\w]+$/))return o;let S="mapbox://";g.path.match(/^\/raster\/v1\//)?S+=`raster/${g.path.replace(`/${i.e.RASTER_URL_PREFIX}/`,"")}`:g.path.match(/^\/rasterarrays\/v1\//)?S+=`rasterarrays/${g.path.replace(`/${i.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:S+=`tiles/${g.path.replace(`/${i.e.TILE_URL_VERSION}/`,"")}`;let C=g.params;return d&&(C=C.filter(M=>!M.match(/^access_token=/))),C.length&&(S+=`?${C.join("&")}`),S}canonicalizeTileset(o,d){const g=!!d&&i.f(d),S=[];for(const C of o.tiles||[])i.h(C)?S.push(this.canonicalizeTileURL(C,g)):S.push(C);return S}_makeAPIURL(o,d){const g="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",S=tt(i.e.API_URL);if(o.protocol=S.protocol,o.authority=S.authority,o.protocol==="http"){const C=o.params.indexOf("secure");C>=0&&o.params.splice(C,1)}if(S.path!=="/"&&(o.path=`${S.path}${o.path}`),!i.e.REQUIRE_ACCESS_TOKEN)return st(o);if(d=d||i.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!d)throw new Error(`An API access token is required to use Mapbox GL. ${g}`);if(d[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${g}`)}return o.params=o.params.filter(C=>C.indexOf("access_token")===-1),o.params.push(`access_token=${d||""}`),st(o)}}const Je=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function tt(m){const o=m.match(Je);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function st(m){const o=m.params.length?`?${m.params.join("&")}`:"";return`${m.protocol}://${m.authority}${m.path}${o}`}const Ne="mapbox.eventData";function We(m){if(!m)return null;const o=m.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(i.j(o[1]))}catch{return null}}class Ue{constructor(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){const d=We(i.e.ACCESS_TOKEN);let g="";return g=d&&d.u?i.k(d.u):i.e.ACCESS_TOKEN||"",o?`${Ne}.${o}:${g}`:`${Ne}:${g}`}fetchEventData(){const o=i.s("localStorage"),d=this.getStorageKey(),g=this.getStorageKey("uuid");if(o)try{const S=localStorage.getItem(d);S&&(this.eventData=JSON.parse(S));const C=localStorage.getItem(g);C&&(this.anonId=C)}catch{i.w("Unable to read from LocalStorage")}}saveEventData(){const o=i.s("localStorage"),d=this.getStorageKey(),g=this.getStorageKey("uuid"),S=this.anonId;if(o&&S)try{localStorage.setItem(g,S),Object.keys(this.eventData).length>=1&&localStorage.setItem(d,JSON.stringify(this.eventData))}catch{i.w("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,d,g,S){if(!i.e.EVENTS_URL)return;const C=tt(i.e.EVENTS_URL);C.params.push(`access_token=${S||i.e.ACCESS_TOKEN||""}`);const M={event:this.type,created:new Date(o).toISOString()},L=d?i.l(M,d):M,B={url:st(C),headers:{"Content-Type":"text/plain"},body:JSON.stringify([L])};this.pendingRequest=i.p(B,q=>{this.pendingRequest=null,g(q),this.saveEventData(),this.processRequests(S)})}queueRequest(o,d){this.queue.push(o),this.processRequests(d)}}const De=new class extends Ue{constructor(m){super("appUserTurnstile"),this._customAccessToken=m}postTurnstileEvent(m,o){i.e.EVENTS_URL&&i.e.ACCESS_TOKEN&&Array.isArray(m)&&m.some(d=>i.f(d)||i.h(d))&&this.queueRequest(Date.now(),o)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const o=We(i.e.ACCESS_TOKEN),d=o?o.u:i.e.ACCESS_TOKEN;let g=d!==this.eventData.tokenU;i.v(this.anonId)||(this.anonId=i.u(),g=!0);const S=this.queue.shift();if(this.eventData.lastSuccess){const C=new Date(this.eventData.lastSuccess),M=new Date(S),L=(S-this.eventData.lastSuccess)/864e5;g=g||L>=1||L<-1||C.getDate()!==M.getDate()}else g=!0;g?this.postEvent(S,{sdkIdentifier:"mapbox-gl-js",sdkVersion:y,skuId:Le,"enabled.telemetry":!1,userId:this.anonId},C=>{C||(this.eventData.lastSuccess=S,this.eventData.tokenU=d)},m):this.processRequests()}},Ke=De.postTurnstileEvent.bind(De),lt=new class extends Ue{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(m,o,d,g){this.skuToken=o,this.errorCb=g,i.e.EVENTS_URL&&(d||i.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},d):this.errorCb(new Error(ze)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:o,timestamp:d}=this.queue.shift();o&&this.success[o]||(this.anonId||this.fetchEventData(),i.v(this.anonId)||(this.anonId=i.u()),this.postEvent(d,{sdkIdentifier:"mapbox-gl-js",sdkVersion:y,skuId:Le,skuToken:this.skuToken,userId:this.anonId},g=>{g?this.errorCb(g):o&&(this.success[o]=!0)},m))}remove(){this.errorCb=null}},Ye=lt.postMapLoadEvent.bind(lt),Ve=new class extends Ue{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(m){let o=this.mapInstanceIdMap.get(m);return o||(o=i.u(),this.mapInstanceIdMap.set(m,o)),o}getEventId(m){const o=this.eventIdPerMapInstanceMap.get(m)||0;return this.eventIdPerMapInstanceMap.set(m,o+1),o}postStyleLoadEvent(m,o){const{map:d,style:g,importedStyles:S}=o;if(!i.e.EVENTS_URL||!m&&!i.e.ACCESS_TOKEN)return;const C=this.getMapInstanceId(d),M={mapInstanceId:C,eventId:this.getEventId(C),style:g};S.length&&(M.importedStyles=S),this.queueRequest({timestamp:Date.now(),payload:M},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,payload:d}=this.queue.shift();this.postEvent(o,d,()=>{},m)}},Et=Ve.postStyleLoadEvent.bind(Ve),kt=new class extends Ue{constructor(){super("gljs.performance")}postPerformanceEvent(m,o){i.e.EVENTS_URL&&(m||i.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,performanceData:d}=this.queue.shift(),g=function(S){const C=performance.getEntriesByType("resource"),M=performance.getEntriesByType("mark"),L=function(ne){const fe={};if(ne){for(const de in ne)if(de!=="other")for(const ye of ne[de]){const he=`${de}ResolveRangeMin`,Se=`${de}ResolveRangeMax`,Ae=`${de}RequestCount`,Pe=`${de}RequestCachedCount`;fe[he]=Math.min(fe[he]||1/0,ye.startTime),fe[Se]=Math.max(fe[Se]||-1/0,ye.responseEnd);const Be=Fe=>{fe[Fe]===void 0&&(fe[Fe]=0),++fe[Fe]};ye.transferSize!==void 0&&ye.transferSize===0&&Be(Pe),Be(Ae)}}return fe}(function(ne,fe){const de={};if(ne)for(const ye of ne){const he=fe(ye);de[he]===void 0&&(de[he]=[]),de[he].push(ye)}return de}(C,A)),B=window.devicePixelRatio,q=navigator.connection||navigator.mozConnection||navigator.webkitConnection,X=q?q.effectiveType:void 0,ee={counters:[],metadata:[],attributes:[]},Q=(ne,fe,de)=>{de!=null&&ne.push({name:fe,value:de.toString()})};for(const ne in L)Q(ee.counters,ne,L[ne]);if(S.interactionRange[0]!==1/0&&S.interactionRange[1]!==-1/0&&(Q(ee.counters,"interactionRangeMin",S.interactionRange[0]),Q(ee.counters,"interactionRangeMax",S.interactionRange[1])),M)for(const ne of Object.keys(w)){const fe=w[ne],de=M.find(ye=>ye.name===fe);de&&Q(ee.counters,fe,de.startTime)}return Q(ee.counters,"visibilityHidden",S.visibilityHidden),Q(ee.attributes,"style",function(ne){if(ne)for(const fe of ne){const de=fe.name.split("?")[0];if(i.i(de)){const ye=de.split("/").slice(-2);if(ye.length===2)return`mapbox://styles/${ye[0]}/${ye[1]}`}}}(C)),Q(ee.attributes,"terrainEnabled",S.terrainEnabled?"true":"false"),Q(ee.attributes,"fogEnabled",S.fogEnabled?"true":"false"),Q(ee.attributes,"projection",S.projection),Q(ee.attributes,"zoom",S.zoom),Q(ee.metadata,"devicePixelRatio",B),Q(ee.metadata,"connectionEffectiveType",X),Q(ee.metadata,"navigatorUserAgent",navigator.userAgent),Q(ee.metadata,"screenWidth",window.screen.width),Q(ee.metadata,"screenHeight",window.screen.height),Q(ee.metadata,"windowWidth",window.innerWidth),Q(ee.metadata,"windowHeight",window.innerHeight),Q(ee.metadata,"mapWidth",S.width/B),Q(ee.metadata,"mapHeight",S.height/B),Q(ee.metadata,"webglRenderer",S.renderer),Q(ee.metadata,"webglVendor",S.vendor),Q(ee.metadata,"sdkVersion",y),Q(ee.metadata,"sdkIdentifier","mapbox-gl-js"),ee}(d);for(const S of g.metadata);for(const S of g.counters);for(const S of g.attributes);this.postEvent(o,g,()=>{},m)}},Wt=kt.postPerformanceEvent.bind(kt),Tt=new class extends Ue{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(m,o,d,g){if(!i.e.API_URL||!i.e.SESSION_PATH)return;const S=tt(i.e.API_URL+i.e.SESSION_PATH);S.params.push(`sku=${o||""}`),S.params.push(`access_token=${g||i.e.ACCESS_TOKEN||""}`);const C={url:st(S),headers:{"Content-Type":"text/plain"}};this.pendingRequest=i.g(C,M=>{this.pendingRequest=null,d(M),this.saveEventData(),this.processRequests(g)})}getSessionAPI(m,o,d,g){this.skuToken=o,this.errorCb=g,i.e.SESSION_PATH&&i.e.API_URL&&(d||i.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},d):this.errorCb(new Error(ze)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:o,timestamp:d}=this.queue.shift();o&&this.success[o]||this.getSession(d,this.skuToken,g=>{g?this.errorCb(g):o&&(this.success[o]=!0)},m)}remove(){this.errorCb=null}},Ht=Tt.getSessionAPI.bind(Tt),ur=new Set;function Jt(m,o){o?ur.add(m):ur.delete(m)}class Rt{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(o,d){this._updatedSourceCaches[o]=d,this.setDirty()}discardSourceCacheUpdate(o){delete this._updatedSourceCaches[o]}updateLayer(o){const d=o.scope;this._updatedLayers[d]=this._updatedLayers[d]||new Set,this._updatedLayers[d].add(o.id),this.setDirty()}removeLayer(o){const d=o.scope;this._removedLayers[d]=this._removedLayers[d]||{},this._updatedLayers[d]=this._updatedLayers[d]||new Set,this._removedLayers[d][o.id]=o,this._updatedLayers[d].delete(o.id),this._updatedPaintProps.delete(o.fqid),this.setDirty()}getRemovedLayer(o){return this._removedLayers[o.scope]?this._removedLayers[o.scope][o.id]:null}discardLayerRemoval(o){this._removedLayers[o.scope]&&delete this._removedLayers[o.scope][o.id]}getLayerUpdatesByScope(){const o={};for(const d in this._updatedLayers)o[d]=o[d]||{},o[d].updatedIds=Array.from(this._updatedLayers[d].values());for(const d in this._removedLayers)o[d]=o[d]||{},o[d].removedIds=Object.keys(this._removedLayers[d]);return o}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(o){this._updatedPaintProps.add(o.fqid),this.setDirty()}getUpdatedImages(o){return this._updatedImages[o]?Array.from(this._updatedImages[o].values()):[]}updateImage(o,d){this._updatedImages[d]=this._updatedImages[d]||new Set,this._updatedImages[d].add(i.I.toString(o)),this.setDirty()}resetUpdatedImages(o){this._updatedImages[o]&&this._updatedImages[o].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Dt(m){const{userImage:o}=m;return!!(o&&o.render&&o.render())&&(m.data.replace(new Uint8Array(o.data.buffer)),!0)}class sr extends i.E{constructor(o){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=o,o!=="raster"&&i.t()&&(this.imageRasterizerDispatcher=new i.D(i.x(),this,"Image Rasterizer Worker",1))}addScope(o){this.loaded.set(o,!1),this.imageProviders.set(o,new Map),this.images.set(o,new Map),this.updatedImages.set(o,new Set),this.callbackDispatchedThisFrame.set(o,new Set),this.patterns.set(o,new Map),this.atlasImage.set(o,new i.r({width:1,height:1}))}removeScope(o){this.loaded.delete(o),this.imageProviders.delete(o),this.images.delete(o),this.updatedImages.delete(o),this.callbackDispatchedThisFrame.delete(o),this.patterns.delete(o),this.atlasImage.delete(o);const d=this.atlasTexture.get(o);d&&(d.destroy(),this.atlasTexture.delete(o))}addImageProvider(o,d){this.imageProviders.has(d)||this.imageProviders.set(d,new Map),this.imageProviders.get(d).set(o.id,o)}removeImageProvider(o,d){this.imageProviders.has(d)&&this.imageProviders.get(d).delete(o)}getPendingImageProviders(){const o=[];for(const d of this.imageProviders.values())for(const g of d.values())g.hasPendingRequests()&&o.push(g);return o}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new i.y),this._imageRasterizer}isLoaded(){for(const o of this.loaded.keys())if(!this.loaded.get(o))return!1;return!0}setLoaded(o,d){if(this.loaded.get(d)!==o&&(this.loaded.set(d,o),o)){for(const{ids:g,callback:S}of this.requestors)this._notify(g,d,S);this.requestors=[]}}hasImage(o,d){return!!this.getImage(o,d)}getImage(o,d){return this.images.get(d).get(o.toString())}addImage(o,d,g){this._validate(o,g)&&this.images.get(d).set(o.toString(),g)}_validate(o,d){let g=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new i.z(new Error(`Image "${o.name}" has invalid "stretchX" value`))),g=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new i.z(new Error(`Image "${o.name}" has invalid "stretchY" value`))),g=!1),this._validateContent(d.content,d)||(this.fire(new i.z(new Error(`Image "${o.name}" has invalid "content" value`))),g=!1),g}_validateStretch(o,d){if(!o)return!0;let g=0;for(const S of o){if(S[0]<g||S[1]<S[0]||d<S[1])return!1;g=S[1]}return!0}_validateContent(o,d){return o?o.length!==4||!d.usvg&&(o[0]<0||d.data.width<o[0]||o[1]<0||d.data.height<o[1]||o[2]<0||d.data.width<o[2]||o[3]<0||d.data.height<o[3])?!1:!(o[2]<o[0]||o[3]<o[1]):!0}updateImage(o,d,g){const S=this.images.get(d).get(o.toString());g.version=S.version+1,this.images.get(d).set(o.toString(),g),this.updatedImages.get(d).add(o),this.removeFromImageRasterizerCache(o,d)}clearUpdatedImages(o){this.updatedImages.get(o).clear()}removeFromImageRasterizerCache(o,d){this.spriteFormat!=="raster"&&(i.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[o],scope:d}):this.imageRasterizer.removeImagesFromCacheByIds([o],d))}removeImage(o,d){const g=this.images.get(d),S=g.get(o.toString());g.delete(o.toString()),this.patterns.get(d).delete(o.toString()),this.removeFromImageRasterizerCache(o,d),S.userImage&&S.userImage.onRemove&&S.userImage.onRemove()}listImages(o){return Array.from(this.images.get(o).keys()).map(d=>i.I.from(d))}getImages(o,d,g){const S=[],C=[],M=this.imageProviders.get(d);for(const X of o){if(!X.iconsetId){S.push(X);continue}const ee=M.get(X.iconsetId);ee&&(this.getImage(X,d)?C.push(X):ee.addPendingRequest(X))}if(S.length===0)return void this._notify(C,d,g);let L=!0;const B=!!this.loaded.get(d),q=this.images.get(d);if(!B)for(const X of S)q.has(X.toString())||(L=!1);B||L?this._notify(S,d,g):this.requestors.push({ids:S,scope:d,callback:g})}rasterizeImages(o,d){const g=new Map,{tasks:S,scope:C}=o;for(const[M,L]of S.entries()){const B=this.getImage(L.id,C);B&&g.set(M,{image:B,imageVariant:L})}this._rasterizeImages(C,g,d)}_rasterizeImages(o,d,g){if(i.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:d,scope:o},g);else{const S=new Map;for(const[C,{image:M,imageVariant:L}]of d.entries())S.set(C,this.imageRasterizer.rasterize(L,M,o,0));g(void 0,S)}}getUpdatedImages(o){return this.updatedImages.get(o)||new Set}_notify(o,d,g){const S=this.images.get(d),C=new Map;for(const M of o){if(!S.get(M.toString())){if(M.iconsetId)continue;this.fire(new i.A("styleimagemissing",{id:M.name}))}const L=S.get(M.toString());if(!L){i.w(`Image "${M.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const B={data:L.usvg?null:L.data.clone(),pixelRatio:L.pixelRatio,sdf:L.sdf,usvg:L.usvg,version:L.version,stretchX:L.stretchX,stretchY:L.stretchY,content:L.content,hasRenderCallback:!!(L.userImage&&L.userImage.render)};L.usvg&&Object.assign(B,{width:L.icon.usvg_tree.width,height:L.icon.usvg_tree.height}),C.set(i.I.toString(M),B)}g(null,C)}getPixelSize(o){const{width:d,height:g}=this.atlasImage.get(o);return{width:d,height:g}}getPattern(o,d,g){const S=o.toString(),C=this.patterns.get(d),M=C.get(S),L=this.getImage(o,d);if(!L)return null;if(M){if(M.position.version===L.version)return M.position;M.position.version=L.version}else{if(L.usvg&&!L.data){const B=this.getPatternInFlightId(S,d);if(this.patternsInFlight.has(B))return null;this.patternsInFlight.add(B);const q=new i.B(o).scaleSelf(i.q.devicePixelRatio),X=new Map([[q.toString(),{image:L,imageVariant:q}]]);return this._rasterizeImages(d,X,(ee,Q)=>this.storePatternImage(q,d,L,g,Q)),null}this.storePattern(o,d,L)}return this._updatePatternAtlas(d,g),C.get(S).position}getPatternInFlightId(o,d){return i.C(o,d)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(o,d,g,S,C){const M=o.toString(),L=C?C.get(M):void 0;L&&(g.data=L,this.storePattern(o.id,d,g),this._updatePatternAtlas(d,S),this.patternsInFlight.delete(this.getPatternInFlightId(o.id.toString(),d)))}storePattern(o,d,g){const S={w:g.data.width+2*i.F,h:g.data.height+2*i.F,x:0,y:0},C=new i.G(S,g,i.F);this.patterns.get(d).set(o.toString(),{bin:S,position:C})}bind(o,d){const g=o.gl;let S=this.atlasTexture.get(d);S?this.dirty&&(S.update(this.atlasImage.get(d)),this.dirty=!1):(S=new i.T(o,this.atlasImage.get(d),g.RGBA8),this.atlasTexture.set(d,S)),S.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(o,d){const g=this.patterns.get(o),S=Array.from(g.values()).map(({bin:q})=>q),{w:C,h:M}=i.H(S),L=this.atlasImage.get(o);L.resize({width:C||1,height:M||1});const B=this.images.get(o);for(const[q,{bin:X,position:ee}]of g.entries()){let Q=ee.padding;const ne=X.x+Q,fe=X.y+Q,de=B.get(q).data,ye=de.width,he=de.height;Q=Q>1?Q-1:Q,i.r.copy(de,L,{x:0,y:0},{x:ne,y:fe},{width:ye,height:he},d),i.r.copy(de,L,{x:0,y:he-Q},{x:ne,y:fe-Q},{width:ye,height:Q},d),i.r.copy(de,L,{x:0,y:0},{x:ne,y:fe+he},{width:ye,height:Q},d),i.r.copy(de,L,{x:ye-Q,y:0},{x:ne-Q,y:fe},{width:Q,height:he},d),i.r.copy(de,L,{x:0,y:0},{x:ne+ye,y:fe},{width:Q,height:he},d),i.r.copy(de,L,{x:ye-Q,y:he-Q},{x:ne-Q,y:fe-Q},{width:Q,height:Q},d),i.r.copy(de,L,{x:0,y:he-Q},{x:ne+ye,y:fe-Q},{width:Q,height:Q},d),i.r.copy(de,L,{x:0,y:0},{x:ne+ye,y:fe+he},{width:Q,height:Q},d),i.r.copy(de,L,{x:ye-Q,y:0},{x:ne-Q,y:fe+he},{width:Q,height:Q},d)}this.dirty=!0}beginFrame(){for(const o of this.images.keys())this.callbackDispatchedThisFrame.set(o,new Set)}dispatchRenderCallbacks(o,d){const g=this.images.get(d);for(const S of o){if(this.callbackDispatchedThisFrame.get(d).has(S.toString()))continue;this.callbackDispatchedThisFrame.get(d).add(S.toString());const C=g.get(S.toString());Dt(C)&&this.updateImage(S,d,C)}}}function mr(m){const o=m.key,d=m.value,g=m.valueSpec||{},S=m.objectElementValidators||{},C=m.style,M=m.styleSpec;let L=[];const B=i.K(d);if(B!=="object")return[new i.V(o,d,`object expected, ${B} found`)];for(const q in d){const X=q.split(".")[0];let ee;S[X]?ee=S[X]:g[X]?ee=Jn:S["*"]?ee=S["*"]:g["*"]&&(ee=Jn),ee?L=L.concat(ee({key:(o&&`${o}.`)+q,value:d[q],valueSpec:g[X]||g["*"],style:C,styleSpec:M,object:d,objectKey:q},d)):L.push(new i.J(o,d[q],`unknown property "${q}"`))}for(const q in g)S[q]||g[q].required&&g[q].default===void 0&&d[q]===void 0&&L.push(new i.V(o,d,`missing required property "${q}"`));return L}function Vr(m){const o=m.value,d=m.valueSpec,g=m.style,S=m.styleSpec,C=m.key,M=m.arrayElementValidator||Jn;if(i.K(o)!=="array")return[new i.V(C,o,`array expected, ${i.K(o)} found`)];if(d.length&&o.length!==d.length)return[new i.V(C,o,`array length ${d.length} expected, length ${o.length} found`)];if(d["min-length"]&&o.length<d["min-length"])return[new i.V(C,o,`array length at least ${d["min-length"]} expected, length ${o.length} found`)];let L={type:d.value,values:d.values,minimum:d.minimum,maximum:d.maximum,function:void 0};S.$version<7&&(L.function=d.function),i.K(d.value)==="object"&&(L=d.value);let B=[];for(let q=0;q<o.length;q++)B=B.concat(M({array:o,arrayIndex:q,value:o[q],valueSpec:L,style:g,styleSpec:S,key:`${C}[${q}]`},!0));return B}function rn(m){const o=m.key,d=m.value,g=m.valueSpec;let S=i.K(d);if(S==="number"&&d!=d&&(S="NaN"),S!=="number")return[new i.V(o,d,`number expected, ${S} found`)];if("minimum"in g){let C=g.minimum;if(i.K(g.minimum)==="array"&&(C=g.minimum[m.arrayIndex]),d<C)return[new i.V(o,d,`${d} is less than the minimum value ${C}`)]}if("maximum"in g){let C=g.maximum;if(i.K(g.maximum)==="array"&&(C=g.maximum[m.arrayIndex]),d>C)return[new i.V(o,d,`${d} is greater than the maximum value ${C}`)]}return[]}function $r(m){const o=m.valueSpec,d=i.M(m.value.type);let g,S,C,M={};const L=d!=="categorical"&&m.value.property===void 0,B=!L,q=i.K(m.value.stops)==="array"&&i.K(m.value.stops[0])==="array"&&i.K(m.value.stops[0][0])==="object",X=mr({key:m.key,value:m.value,valueSpec:m.styleSpec.function,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{stops:function(ne){if(d==="identity")return[new i.V(ne.key,ne.value,'identity function may not have a "stops" property')];let fe=[];const de=ne.value;return fe=fe.concat(Vr({key:ne.key,value:de,valueSpec:ne.valueSpec,style:ne.style,styleSpec:ne.styleSpec,arrayElementValidator:ee})),i.K(de)==="array"&&de.length===0&&fe.push(new i.V(ne.key,de,"array must have at least one stop")),fe},default:function(ne){return Jn({key:ne.key,value:ne.value,valueSpec:o,style:ne.style,styleSpec:ne.styleSpec})}}});return d==="identity"&&L&&X.push(new i.V(m.key,m.value,'missing required property "property"')),d==="identity"||m.value.stops||X.push(new i.V(m.key,m.value,'missing required property "stops"')),d==="exponential"&&m.valueSpec.expression&&!i.N(m.valueSpec)&&X.push(new i.V(m.key,m.value,"exponential functions not supported")),m.styleSpec.$version>=8&&(B&&!i.O(m.valueSpec)?X.push(new i.V(m.key,m.value,"property functions not supported")):L&&!i.Q(m.valueSpec)&&X.push(new i.V(m.key,m.value,"zoom functions not supported"))),d!=="categorical"&&!q||m.value.property!==void 0||X.push(new i.V(m.key,m.value,'"property" property is required')),X;function ee(ne){let fe=[];const de=ne.value,ye=ne.key;if(i.K(de)!=="array")return[new i.V(ye,de,`array expected, ${i.K(de)} found`)];if(de.length!==2)return[new i.V(ye,de,`array length 2 expected, length ${de.length} found`)];if(q){if(i.K(de[0])!=="object")return[new i.V(ye,de,`object expected, ${i.K(de[0])} found`)];if(de[0].zoom===void 0)return[new i.V(ye,de,"object stop key must have zoom")];if(de[0].value===void 0)return[new i.V(ye,de,"object stop key must have value")];const he=i.M(de[0].zoom);if(typeof he!="number")return[new i.V(ye,de[0].zoom,"stop zoom values must be numbers")];if(C&&C>he)return[new i.V(ye,de[0].zoom,"stop zoom values must appear in ascending order")];he!==C&&(C=he,S=void 0,M={}),fe=fe.concat(mr({key:`${ye}[0]`,value:de[0],valueSpec:{zoom:{}},style:ne.style,styleSpec:ne.styleSpec,objectElementValidators:{zoom:rn,value:Q}}))}else fe=fe.concat(Q({key:`${ye}[0]`,value:de[0],style:ne.style,styleSpec:ne.styleSpec},de));return i.S(i.U(de[1]))?fe.concat([new i.V(`${ye}[1]`,de[1],"expressions are not allowed in function stops.")]):fe.concat(Jn({key:`${ye}[1]`,value:de[1],valueSpec:o,style:ne.style,styleSpec:ne.styleSpec}))}function Q(ne,fe){const de=i.K(ne.value),ye=i.M(ne.value),he=ne.value!==null?ne.value:fe;if(g){if(de!==g)return[new i.V(ne.key,he,`${de} stop domain type must match previous stop domain type ${g}`)]}else g=de;if(de!=="number"&&de!=="string"&&de!=="boolean"&&typeof ye!="number"&&typeof ye!="string"&&typeof ye!="boolean")return[new i.V(ne.key,he,"stop domain value must be a number, string, or boolean")];if(de!=="number"&&d!=="categorical"){let Se=`number expected, ${de} found`;return i.O(o)&&d===void 0&&(Se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(ne.key,he,Se)]}return d!=="categorical"||de!=="number"||typeof ye=="number"&&isFinite(ye)&&Math.floor(ye)===ye?d!=="categorical"&&de==="number"&&typeof ye=="number"&&typeof S=="number"&&S!==void 0&&ye<S?[new i.V(ne.key,he,"stop domain values must appear in ascending order")]:(S=ye,d==="categorical"&&ye in M?[new i.V(ne.key,he,"stop domain values must be unique")]:(M[ye]=!0,[])):[new i.V(ne.key,he,`integer expected, found ${String(ye)}`)]}}function Yr(m){const o=(m.expressionContext==="property"?i.W:i.X)(i.U(m.value),m.valueSpec);if(o.result==="error")return o.value.map(g=>new i.V(`${m.key}${g.key}`,m.value,g.message));const d=o.value.expression||o.value._styleExpression.expression;if(m.expressionContext==="property"&&m.propertyKey==="text-font"&&!d.outputDefined())return[new i.V(m.key,m.value,`Invalid data expression for "${m.propertyKey}". Output values must be contained as literals within the expression.`)];if(m.expressionContext==="property"&&m.propertyType==="layout"&&!i.Y(d))return[new i.V(m.key,m.value,'"feature-state" data expressions are not supported with layout properties.')];if(m.expressionContext==="filter")return un(d,m);if(m.expressionContext&&m.expressionContext.indexOf("cluster")===0){if(!i.Z(d,["zoom","feature-state"]))return[new i.V(m.key,m.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(m.expressionContext==="cluster-initial"&&!i._(d))return[new i.V(m.key,m.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function un(m,o){const d=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(const S of o.valueSpec.expression.parameters)d.delete(S);if(d.size===0)return[];const g=[];return m instanceof i.$&&d.has(m.name)?[new i.V(o.key,o.value,`["${m.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(m.eachChild(S=>{g.push(...un(S,o))}),g)}function Fn(m){const o=m.key,d=m.value,g=m.valueSpec,S=[];return Array.isArray(g.values)?g.values.indexOf(i.M(d))===-1&&S.push(new i.V(o,d,`expected one of [${g.values.join(", ")}], ${JSON.stringify(d)} found`)):Object.keys(g.values).indexOf(i.M(d))===-1&&S.push(new i.V(o,d,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(d)} found`)),S}function vi(m){return i.a1(i.U(m.value))?Yr(i.L({},m,{expressionContext:"filter",valueSpec:m.styleSpec[`filter_${m.layerType||"fill"}`]})):xr(m)}function xr(m){const o=m.value,d=m.key;if(i.K(o)!=="array")return[new i.V(d,o,`array expected, ${i.K(o)} found`)];const g=m.styleSpec;let S,C=[];if(o.length<1)return[new i.V(d,o,"filter array must have at least 1 element")];switch(C=C.concat(Fn({key:`${d}[0]`,value:o[0],valueSpec:g.filter_operator,style:m.style,styleSpec:m.styleSpec})),i.M(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&i.M(o[1])==="$type"&&C.push(new i.V(d,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":o.length!==3&&C.push(new i.V(d,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(S=i.K(o[1]),S!=="string"&&C.push(new i.V(`${d}[1]`,o[1],`string expected, ${S} found`)));for(let M=2;M<o.length;M++)S=i.K(o[M]),i.M(o[1])==="$type"?C=C.concat(Fn({key:`${d}[${M}]`,value:o[M],valueSpec:g.geometry_type,style:m.style,styleSpec:m.styleSpec})):S!=="string"&&S!=="number"&&S!=="boolean"&&C.push(new i.V(`${d}[${M}]`,o[M],`string, number, or boolean expected, ${S} found`));break;case"any":case"all":case"none":for(let M=1;M<o.length;M++)C=C.concat(xr({key:`${d}[${M}]`,value:o[M],style:m.style,styleSpec:m.styleSpec}));break;case"has":case"!has":S=i.K(o[1]),o.length!==2?C.push(new i.V(d,o,`filter array for "${o[0]}" operator must have 2 elements`)):S!=="string"&&C.push(new i.V(`${d}[1]`,o[1],`string expected, ${S} found`))}return C}function Hr(m,o){const d=m.key,g=m.style,S=m.layer,C=m.styleSpec,M=m.value,L=m.objectKey,B=C[`${o}_${m.layerType}`];if(!B)return[];const q=L.match(/^(.*)-use-theme$/);if(o==="paint"&&q&&B[q[1]])return i.S(M)?[].concat(Jn({key:m.key,value:M,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:g,styleSpec:C,expressionContext:"property",propertyType:o,propertyKey:L})):Jn({key:d,value:M,valueSpec:{type:"string"},style:g,styleSpec:C});const X=L.match(/^(.*)-transition$/);if(o==="paint"&&X&&B[X[1]]&&B[X[1]].transition)return Jn({key:d,value:M,valueSpec:C.transition,style:g,styleSpec:C});const ee=m.valueSpec||B[L];if(!ee)return[new i.J(d,M,`unknown property "${L}"`)];let Q;if(i.K(M)==="string"&&i.O(ee)&&!ee.tokens&&(Q=/^{([^}]+)}$/.exec(M))){const fe=`\`{ "type": "identity", "property": ${Q?JSON.stringify(Q[1]):'"_"'} }\``;return[new i.V(d,M,`"${L}" does not support interpolation syntax
Use an identity property function instead: ${fe}.`)]}const ne=[];if(m.layerType==="symbol")L!=="text-field"||!g||g.glyphs||g.imports||ne.push(new i.V(d,M,'use of "text-field" requires a style "glyphs" property')),L==="text-font"&&i.a2(i.U(M))&&i.M(M.type)==="identity"&&ne.push(new i.V(d,M,'"text-font" does not support identity functions'));else if(m.layerType==="model"&&o==="paint"&&S&&S.layout&&S.layout.hasOwnProperty("model-id")&&i.O(ee)&&(i.a3(ee)||i.Q(ee))){const fe=i.W(i.U(M),ee),de=fe.value.expression||fe.value._styleExpression.expression;de&&!i.Z(de,["measure-light"])&&(L==="model-emissive-strength"&&i._(de)&&i.Y(de)||ne.push(new i.V(d,M,`${L} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return ne.concat(Jn({key:m.key,value:M,valueSpec:ee,style:g,styleSpec:C,expressionContext:"property",propertyType:o,propertyKey:L}))}function wn(m){return Hr(m,"paint")}function xi(m){return Hr(m,"layout")}function ms(m){let o=[];const d=m.value,g=m.key,S=m.style,C=m.styleSpec;d.type||d.ref||o.push(new i.V(g,d,'either "type" or "ref" is required'));let M=i.M(d.type);const L=i.M(d.ref);if(d.id){const B=i.M(d.id);for(let q=0;q<m.arrayIndex;q++){const X=S.layers[q];i.M(X.id)===B&&o.push(new i.V(g,d.id,`duplicate layer id "${d.id}", previously used at line ${X.id.__line__}`))}}if("ref"in d){let B;["type","source","source-layer","filter","layout"].forEach(q=>{q in d&&o.push(new i.V(g,d[q],`"${q}" is prohibited for ref layers`))}),S.layers.forEach(q=>{i.M(q.id)===L&&(B=q)}),B?B.ref?o.push(new i.V(g,d.ref,"ref cannot reference another ref layer")):M=i.M(B.type):typeof L=="string"&&o.push(new i.V(g,d.ref,`ref layer "${L}" not found`))}else if(M!=="background"&&M!=="sky"&&M!=="slot")if(d.source){const B=S.sources&&S.sources[d.source],q=B&&i.M(B.type);B?q==="vector"&&M==="raster"?o.push(new i.V(g,d.source,`layer "${d.id}" requires a raster source`)):q==="raster"&&M!=="raster"?o.push(new i.V(g,d.source,`layer "${d.id}" requires a vector source`)):q!=="vector"||d["source-layer"]?q==="raster-dem"&&M!=="hillshade"?o.push(new i.V(g,d.source,"raster-dem source can only be used with layer type 'hillshade'.")):q!=="raster-array"||["raster","raster-particle"].includes(M)?M==="line"&&d.paint&&(d.paint["line-gradient"]||d.paint["line-trim-offset"])&&q==="geojson"&&!B.lineMetrics?o.push(new i.V(g,d,`layer "${d.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):M==="raster-particle"&&q!=="raster-array"&&o.push(new i.V(g,d.source,`layer "${d.id}" requires a 'raster-array' source.`)):o.push(new i.V(g,d.source,"raster-array source can only be used with layer type 'raster'.")):o.push(new i.V(g,d,`layer "${d.id}" must specify a "source-layer"`)):o.push(new i.V(g,d.source,`source "${d.source}" not found`))}else o.push(new i.V(g,d,'missing required property "source"'));return o=o.concat(mr({key:g,value:d,valueSpec:C.layer,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Jn({key:`${g}.type`,value:d.type,valueSpec:C.layer.type,style:m.style,styleSpec:m.styleSpec,object:d,objectKey:"type"}),filter:B=>vi(i.L({layerType:M},B)),layout:B=>mr({layer:d,key:B.key,value:B.value,valueSpec:{},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{"*":q=>xi(i.L({layerType:M},q))}}),paint:B=>mr({layer:d,key:B.key,value:B.value,valueSpec:{},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{"*":q=>wn(i.L({layerType:M,layer:d},q))}})}})),o}function Ui(m){const o=m.value,d=m.key,g=i.K(o);return g!=="string"?[new i.V(d,o,`string expected, ${g} found`)]:[]}const js={promoteId:function m({key:o,value:d}){if(i.K(d)==="string")return Ui({key:o,value:d});if(Array.isArray(d)){const g=[],S=i.U(d),C=i.X(S);return C.result==="error"&&C.value.forEach(M=>{g.push(new i.V(`${o}${M.key}`,null,`${M.message}`))}),i.Z(C.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||g.push(new i.V(`${o}`,null,"promoteId expression should be only feature dependent")),g}{const g=[];for(const S in d)g.push(...m({key:`${o}.${S}`,value:d[S]}));return g}}};function es(m){const o=m.value,d=m.key,g=m.styleSpec,S=m.style;if(!o.type)return[new i.V(d,o,'"type" is required')];const C=i.M(o.type);let M=[];switch(["vector","raster","raster-dem","raster-array"].includes(C)&&(o.url||o.tiles||M.push(new i.J(d,o,'Either "url" or "tiles" is required.'))),C){case"vector":case"raster":case"raster-dem":case"raster-array":return M=M.concat(mr({key:d,value:o,valueSpec:g[`source_${C.replace("-","_")}`],style:m.style,styleSpec:g,objectElementValidators:js})),M;case"geojson":if(M=mr({key:d,value:o,valueSpec:g.source_geojson,style:S,styleSpec:g,objectElementValidators:js}),o.cluster)for(const L in o.clusterProperties){const[B,q]=o.clusterProperties[L],X=typeof B=="string"?[B,["accumulated"],["get",L]]:B;M.push(...Yr({key:`${d}.${L}.map`,value:q,expressionContext:"cluster-map"})),M.push(...Yr({key:`${d}.${L}.reduce`,value:X,expressionContext:"cluster-reduce"}))}return M;case"video":return mr({key:d,value:o,valueSpec:g.source_video,style:S,styleSpec:g});case"image":return mr({key:d,value:o,valueSpec:g.source_image,style:S,styleSpec:g});case"canvas":return[new i.V(d,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Fn({key:`${d}.type`,value:o.type,valueSpec:{values:Uo(g)}})}}function Uo(m){return m.source.reduce((o,d)=>{const g=m[d];return g.type.type==="enum"&&(o=o.concat(Object.keys(g.type.values))),o},[])}function Ys(m){const o=m.value,d=m.styleSpec,g=d.light,S=m.style;let C=[];const M=i.K(o);if(o===void 0)return C;if(M!=="object")return C=C.concat([new i.V("light",o,`object expected, ${M} found`)]),C;for(const L in o){const B=L.match(/^(.*)-transition$/),q=L.match(/^(.*)-use-theme$/);C=C.concat(q&&g[q[1]]?Jn({key:L,value:o[L],valueSpec:{type:"string"},style:S,styleSpec:d}):B&&g[B[1]]&&g[B[1]].transition?Jn({key:L,value:o[L],valueSpec:d.transition,style:S,styleSpec:d}):g[L]?Jn({key:L,value:o[L],valueSpec:g[L],style:S,styleSpec:d}):[new i.V(L,o[L],`unknown property "${L}"`)])}return C}function Js(m){const o=m.value;let d=[];if(!o)return d;const g=i.K(o);if(g!=="object")return d=d.concat([new i.V("light-3d",o,`object expected, ${g} found`)]),d;const S=m.styleSpec,C=S["light-3d"],M=m.key,L=m.style,B=m.style.lights;for(const ee of["type","id"])if(!(ee in o))return d=d.concat([new i.V("light-3d",o,`missing property ${ee} on light`)]),d;if(o.type&&B)for(let ee=0;ee<m.arrayIndex;ee++){const Q=i.M(o.type),ne=B[ee];i.M(ne.type)===Q&&d.push(new i.V(M,o.id,`duplicate light type "${o.type}", previously defined at line ${ne.id.__line__}`))}const q=`properties_light_${o.type}`;if(!(q in S))return d=d.concat([new i.V("light-3d",o,`Invalid light type ${o.type}`)]),d;const X=S[q];for(const ee in o)if(ee==="properties"){const Q=o[ee],ne=i.K(Q);if(ne!=="object")return d=d.concat([new i.V("properties",Q,`object expected, ${ne} found`)]),d;for(const fe in Q)d=d.concat(X[fe]?Jn({key:fe,value:Q[fe],valueSpec:X[fe],style:L,styleSpec:S}):[new i.J(m.key,Q[fe],`unknown property "${fe}"`)])}else{const Q=ee.match(/^(.*)-transition$/),ne=ee.match(/^(.*)-use-theme$/);d=d.concat(ne&&C[ne[1]]?Jn({key:ee,value:o[ee],valueSpec:{type:"string"},style:L,styleSpec:S}):Q&&C[Q[1]]&&C[Q[1]].transition?Jn({key:ee,value:o[ee],valueSpec:S.transition,style:L,styleSpec:S}):C[ee]?Jn({key:ee,value:o[ee],valueSpec:C[ee],style:L,styleSpec:S}):[new i.J(ee,o[ee],`unknown property "${ee}"`)])}return d}function bo(m){const o=m.value,d=m.key,g=m.style,S=m.styleSpec,C=S.terrain;let M=[];const L=i.K(o);if(o===void 0||L==="null")return M;if(L!=="object")return M=M.concat([new i.V("terrain",o,`object expected, ${L} found`)]),M;for(const B in o){const q=B.match(/^(.*)-transition$/),X=B.match(/^(.*)-use-theme$/);M=M.concat(X&&C[X[1]]?Jn({key:B,value:o[B],valueSpec:{type:"string"},style:g,styleSpec:S}):q&&C[q[1]]&&C[q[1]].transition?Jn({key:B,value:o[B],valueSpec:S.transition,style:g,styleSpec:S}):C[B]?Jn({key:B,value:o[B],valueSpec:C[B],style:g,styleSpec:S}):[new i.J(B,o[B],`unknown property "${B}"`)])}if(o.source){const B=g.sources&&g.sources[o.source],q=B&&i.M(B.type);B?q!=="raster-dem"&&M.push(new i.V(d,o.source,`terrain cannot be used with a source of type ${String(q)}, it only be used with a "raster-dem" source type`)):M.push(new i.V(d,o.source,`source "${o.source}" not found`))}else M.push(new i.V(d,o,'terrain is missing required property "source"'));return M}function wo(m){const o=m.value,d=m.style,g=m.styleSpec,S=g.fog;let C=[];const M=i.K(o);if(o===void 0)return C;if(M!=="object")return C=C.concat([new i.V("fog",o,`object expected, ${M} found`)]),C;for(const L in o){const B=L.match(/^(.*)-transition$/),q=L.match(/^(.*)-use-theme$/);C=C.concat(q&&S[q[1]]?Jn({key:L,value:o[L],valueSpec:{type:"string"},style:d,styleSpec:g}):B&&S[B[1]]&&S[B[1]].transition?Jn({key:L,value:o[L],valueSpec:g.transition,style:d,styleSpec:g}):S[L]?Jn({key:L,value:o[L],valueSpec:S[L],style:d,styleSpec:g}):[new i.J(L,o[L],`unknown property "${L}"`)])}return C}const So={"*":()=>[],array:Vr,boolean:function(m){const o=m.value,d=m.key,g=i.K(o);return g!=="boolean"?[new i.V(d,o,`boolean expected, ${g} found`)]:[]},number:rn,color:function(m){const o=m.key,d=m.value,g=i.K(d);return g!=="string"?[new i.V(o,d,`color expected, ${g} found`)]:i.a0.parseCSSColor(d)===null?[new i.V(o,d,`color expected, "${d}" found`)]:[]},enum:Fn,filter:vi,function:$r,layer:ms,object:mr,source:es,model:i.a4,light:Ys,"light-3d":Js,terrain:bo,fog:wo,string:Ui,formatted:function(m){return Ui(m).length===0?[]:Yr(m)},resolvedImage:function(m){return Ui(m).length===0?[]:Yr(m)},projection:function(m){const o=m.value,d=m.styleSpec,g=d.projection,S=m.style;let C=[];const M=i.K(o);if(M==="object")for(const L in o)C=C.concat(Jn({key:L,value:o[L],valueSpec:g[L],style:S,styleSpec:d}));else M!=="string"&&(C=C.concat([new i.V("projection",o,`object or string expected, ${M} found`)]));return C},import:function(m){const{value:o,styleSpec:d}=m,{data:g,...S}=o;Object.defineProperty(S,"__line__",{value:o.__line__,enumerable:!1});let C=mr(i.L({},m,{value:S,valueSpec:d.import}));return i.M(S.id)===""&&C.push(new i.V(`${m.key}.id`,S,"import id can't be an empty string")),g&&(C=C.concat(Io(g,d,{key:`${m.key}.data`}))),C},iconset:function(m){const o=m.value,d=m.key,g=m.styleSpec,S=m.style;if(!o.type)return[new i.V(d,o,'"type" is required')];const C=i.M(o.type);let M=[];if(M=M.concat(mr({key:d,value:o,valueSpec:g[`iconset_${C}`],style:S,styleSpec:g})),C==="source"&&o.source){const L=S.sources&&S.sources[o.source],B=L&&i.M(L.type);L?B!=="raster-array"&&M.push(new i.V(d,o.source,`iconset cannot be used with a source of type ${String(B)}, it only be used with a "raster-array" source type`)):M.push(new i.V(d,o.source,`source "${o.source}" not found`))}return M}};function Jn(m,o=!1){const d=m.value,g=m.valueSpec,S=m.styleSpec;if(g.expression&&i.a2(i.M(d)))return $r(m);if(g.expression&&i.S(i.U(d)))return Yr(m);if(g.type&&So[g.type]){const C=So[g.type](m);return o===!0&&C.length>0&&i.K(m.value)==="array"?Yr(m):C}return mr(i.L({},m,{valueSpec:g.type?S[g.type]:g}))}function Ds(m){const o=m.value,d=m.key,g=Ui(m);return g.length||(o.indexOf("{fontstack}")===-1&&g.push(new i.V(d,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&g.push(new i.V(d,o,'"glyphs" url must include a "{range}" token'))),g}function Io(m,o=i.a5,d={}){return Jn({key:d.key||"",value:m,valueSpec:o.$root,styleSpec:o,style:m,objectElementValidators:{glyphs:Ds,"*":()=>[]}})}function _s(m,o=i.a5){return et(Io(m,o))}const uo=m=>et(es(m)),qo=m=>et(Ys(m)),oa=m=>et(Js(m)),Qt=m=>et(bo(m)),Hs=m=>et(wo(m)),Go=m=>et(function(o){const d=o.value,g=o.style,S=o.styleSpec,C=S.snow;let M=[];const L=i.K(d);if(d===void 0)return M;if(L!=="object")return M=M.concat([new i.V("snow",d,`object expected, ${L} found`)]),M;for(const B in d){const q=B.match(/^(.*)-transition$/);M=M.concat(q&&C[q[1]]&&C[q[1]].transition?Jn({key:B,value:d[B],valueSpec:S.transition,style:g,styleSpec:S}):C[B]?Jn({key:B,value:d[B],valueSpec:C[B],style:g,styleSpec:S}):[new i.J(B,d[B],`unknown property "${B}"`)])}return M}(m)),dt=m=>et(function(o){const d=o.value,g=o.style,S=o.styleSpec,C=S.rain;let M=[];const L=i.K(d);if(d===void 0)return M;if(L!=="object")return M=M.concat([new i.V("rain",d,`object expected, ${L} found`)]),M;for(const B in d){const q=B.match(/^(.*)-transition$/);M=M.concat(q&&C[q[1]]&&C[q[1]].transition?Jn({key:B,value:d[B],valueSpec:S.transition,style:g,styleSpec:S}):C[B]?Jn({key:B,value:d[B],valueSpec:C[B],style:g,styleSpec:S}):[new i.J(B,d[B],`unknown property "${B}"`)])}return M}(m)),ae=m=>et(ms(m)),oe=m=>et(vi(m)),pe=m=>et(wn(m)),$e=m=>et(xi(m)),He=m=>et(i.a4(m));function et(m){return m.slice().sort((o,d)=>o.line&&d.line?o.line-d.line:0)}function rt(m,o){let d=!1;if(o&&o.length)for(const g of o)g instanceof i.J?i.w(g.message):(m.fire(new i.z(new Error(g.message))),d=!0);return d}let nt;class mt extends i.E{constructor(o,d="flat"){super(),this._transitionable=new i.a6(nt||(nt=new i.a7({anchor:new i.a8(i.a5.light.anchor),position:new i.a9(i.a5.light.position),color:new i.a8(i.a5.light.color),intensity:new i.a8(i.a5.light.intensity)}))),this.setLight(o,d),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,d,g={}){this._validate(qo,o,g)||(this._transitionable.setTransitionOrValue(o),this.id=d)}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,d,g){return(!g||g.validate!==!1)&&rt(this,o.call(_s,i.l({value:d,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}}let Ct=class extends i.E{constructor(m,o,d,g){super(),this.scope=d,this._transitionable=new i.a6(new i.a7({source:new i.a8(i.a5.terrain.source),exaggeration:new i.a8(i.a5.terrain.exaggeration)}),d,g),this._transitionable.setTransitionOrValue(m,g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=o}get(){return this._transitionable.serialize()}set(m,o){this._transitionable.setTransitionOrValue(m,o)}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}getExaggeration(m){return this._transitioning.possiblyEvaluate(new i.aa(m)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const m=this._transitionable._values.exaggeration;if(!m)return null;const o=m.value.expression;if(!o)return null;let d=-1,g=-1,S=1;for(const C of o.zoomStops)S=o.evaluate(new i.aa(C)),S>.01?(d=C,g=-1):g=C;return S<.01&&d>0&&g>d?[d,g]:null}isZoomDependent(){const m=this._transitionable._values.exaggeration;return m!=null&&m.value!=null&&m.value.expression!=null&&m.value.expression instanceof i.ab}};const pt=45,rr=65,ar=.05;function gr(m,o,d,g){const S=i.af(pt,rr,d),[C,M]=Ur(m,g);let L=1-Math.min(1,Math.exp((o-C)/(M-C)*-6));return L*=L*L,L=Math.min(1,1.00747*L),L*S*m.alpha}function Ur(m,o){const d=.5/Math.tan(.5*o);return[m.range[0]+d,m.range[1]+d]}function Xr(m,o,d,g,S){const C=i.ad([],[o,d,g],S.mercatorFogMatrix);return gr(m,i.ae(C),S.pitch,S._fov)}function Jr(m,o,d,g,S,C,M){const L=[[d,g,0],[S,g,0],[S,C,0],[d,C,0]];let B=Number.MAX_VALUE,q=-Number.MAX_VALUE;for(const X of L){const ee=i.ad([],X,o),Q=i.ae(ee);B=Math.min(B,Q),q=Math.max(q,Q)}return[gr(m,B,M.pitch,M._fov),gr(m,q,M.pitch,M._fov)]}class nn extends i.E{constructor(o,d,g,S){super();const C=new i.a7({range:new i.a8(i.a5.fog.range),color:new i.a8(i.a5.fog.color),"color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new i.a8(i.a5.fog["high-color"]),"high-color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new i.a8(i.a5.fog["space-color"]),"space-color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new i.a8(i.a5.fog["horizon-blend"]),"star-intensity":new i.a8(i.a5.fog["star-intensity"]),"vertical-range":new i.a8(i.a5.fog["vertical-range"])});this._transitionable=new i.a6(C,g,new Map(S)),this.set(o,S),this._transitioning=this._transitionable.untransitioned(),this._transform=d,this.properties=new i.ag(C),this.scope=g}get state(){const o=this._transform,d=o.projection.name==="globe",g=i.ah(o.zoom),S=this.properties.get("range"),C=[.5,3];return{range:d?[i.ai(C[0],S[0],g),i.ai(C[1],S[1],g)]:S,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,d,g={}){if(this._validate(Hs,o,g))return;const S=i.l({},o);for(const C of Object.keys(i.a5.fog))S[C]===void 0&&(S[C]=i.a5.fog[C].default);this._options=S,this._transitionable.setTransitionOrValue(this._options,d)}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const d=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.af(pt,rr,o))*d.a}getOpacityAtLatLng(o,d){return this._transform.projection.supportsFog?function(g,S,C){const M=i.ac.fromLngLat(S),L=C.elevation?C.elevation.getAtPointOrZero(M):0;return Xr(g,M.x,M.y,L,C)}(this.state,o,d):0}getOpacityForTile(o){if(!this._transform.projection.supportsFog)return[1,1];const d=this._transform.calculateFogTileMatrix(o.toUnwrapped());return Jr(this.state,d,0,0,i.aj,i.aj,this._transform)}getOpacityForBounds(o,d,g,S,C){return this._transform.projection.supportsFog?Jr(this.state,o,d,g,S,C,this._transform):[1,1]}getFovAdjustedRange(o){return this._transform.projection.supportsFog?Ur(this.state,o):[0,1]}isVisibleOnFrustum(o){if(!this._transform.projection.supportsFog)return!1;const d=[4,5,6,7];for(const g of d){const S=o.points[g];let C;if(S[2]>=0)C=S;else{const M=o.points[g-4];C=i.ak(M,S,M[2]/(M[2]-S[2]))}if(Xr(this.state,C[0],C[1],0,this._transform)>=ar)return!0}return!1}updateConfig(o){this._transitionable.setTransitionOrValue(this._options,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,d,g){return(!g||g.validate!==!1)&&rt(this,o.call(_s,i.l({value:d,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}}let Qn,sn,Bn,Tn,on=class extends i.E{constructor(m,o,d,g){super();const S=Qn||(Qn=new i.a7({density:new i.a8(i.a5.snow.density),intensity:new i.a8(i.a5.snow.intensity),color:new i.a8(i.a5.snow.color),opacity:new i.a8(i.a5.snow.opacity),vignette:new i.a8(i.a5.snow.vignette),"vignette-color":new i.a8(i.a5.snow["vignette-color"]),"center-thinning":new i.a8(i.a5.snow["center-thinning"]),direction:new i.a8(i.a5.snow.direction),"flake-size":new i.a8(i.a5.snow["flake-size"])}));this._transitionable=new i.a6(S,d,new Map(g)),this.set(m,g),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ag(S),this.scope=d}get state(){const m=this.properties.get("opacity"),o=this.properties.get("color"),d=this.properties.get("direction"),g=i.al(d[0]),S=-Math.max(i.al(d[1]),.01),C=[Math.cos(g)*Math.cos(S),Math.sin(g)*Math.cos(S),Math.sin(S)],M=this.properties.get("vignette"),L=this.properties.get("vignette-color");return L.a=M,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.am(o.r,o.g,o.b,o.a*m),direction:C,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:L}}get(){return this._transitionable.serialize()}set(m,o,d={}){if(this._validate(Go,m,d))return;const g=i.l({},m);for(const S of Object.keys(i.a5.snow))g[S]===void 0&&(g[S]=i.a5.snow[S].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,o,d){return(!d||d.validate!==!1)&&rt(this,m.call(_s,i.l({value:o,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}},Vn=class extends i.E{constructor(m,o,d,g){super();const S=sn||(sn=new i.a7({density:new i.a8(i.a5.rain.density),intensity:new i.a8(i.a5.rain.intensity),color:new i.a8(i.a5.rain.color),opacity:new i.a8(i.a5.rain.opacity),vignette:new i.a8(i.a5.rain.vignette),"vignette-color":new i.a8(i.a5.rain["vignette-color"]),"center-thinning":new i.a8(i.a5.rain["center-thinning"]),direction:new i.a8(i.a5.rain.direction),"droplet-size":new i.a8(i.a5.rain["droplet-size"]),"distortion-strength":new i.a8(i.a5.rain["distortion-strength"])}));this._transitionable=new i.a6(S,d,new Map(g)),this.set(m,g),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ag(S),this.scope=d}get state(){const m=this.properties.get("opacity"),o=this.properties.get("color"),d=this.properties.get("direction"),g=i.al(d[0]),S=-Math.max(i.al(d[1]),.01),C=[Math.cos(g)*Math.cos(S),Math.sin(g)*Math.cos(S),Math.sin(S)],M=this.properties.get("vignette-color");return M.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.am(o.r,o.g,o.b,o.a*m),direction:C,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:M}}get(){return this._transitionable.serialize()}set(m,o,d={}){if(this._validate(dt,m,d))return;const g=i.l({},m);for(const S of Object.keys(i.a5.rain))g[S]===void 0&&(g[S]=i.a5.rain[S].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,o,d){return(!d||d.validate!==!1)&&rt(this,m.call(_s,i.l({value:o,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}};class li extends i.E{constructor(o,d,g,S){super(),this.scope=g,this._options=o,this.properties=new i.ag(d),this._transitionable=new i.a6(d,g,new Map(S)),this._transitionable.setTransitionOrValue(o.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(o){this._transitionable.setTransitionOrValue(this._options.properties,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(o,d){this._options=o,this._transitionable.setTransitionOrValue(o.properties,d)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class bi{constructor(o,d,g,S){this.screenBounds=o,this.cameraPoint=d,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,S)}static createFromScreenPoints(o,d){let g,S;if(o instanceof i.P||typeof o[0]=="number"){const C=i.P.convert(o);g=[C],S=d.isPointAboveHorizon(C)}else{const C=i.P.convert(o[0]),M=i.P.convert(o[1]),L=C.add(M)._div(2);g=[C,M],S=i.ao(C,M).every(B=>d.isPointAboveHorizon(B))&&d.isPointAboveHorizon(L)}return new bi(g,d.getCameraPoint(),S,d)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(o){return i.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const d=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],S=i.ao(d,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>d.x&&this.cameraPoint.x<g.x?S.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?S[2]=this.cameraPoint:this.cameraPoint.x<=d.x&&(S[3]=this.cameraPoint)),i.ap(S,o)}bufferedCameraGeometryGlobe(o){const d=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],S=i.ao(d,g,o),C=this.cameraPoint.clone();switch(3*((C.y>d.y)+(C.y>g.y))+((C.x>d.x)+(C.x>g.x))){case 0:S[0]=C,S[4]=C.clone();break;case 1:S.splice(1,0,C);break;case 2:S[1]=C;break;case 3:S.splice(4,0,C);break;case 5:S.splice(2,0,C);break;case 6:S[3]=C;break;case 7:S.splice(3,0,C);break;case 8:S[2]=C}return S}containsTile(o,d,g,S=0){const C=o.queryPadding/d._pixelsPerMercatorPixel+1,M=g?this._bufferedCameraMercator(C,d):this._bufferedScreenMercator(C,d);let L=o.tileID.wrap+(M.unwrapped?S:0);const B=M.polygon.map(ye=>i.aq(o.tileTransform,ye,L));if(!i.ar(B,0,0,i.aj,i.aj))return;L=o.tileID.wrap+(this.screenGeometryMercator.unwrapped?S:0);const q=this.screenGeometryMercator.polygon.map(ye=>i.as(o.tileTransform,ye,L)),X=q.map(ye=>new i.P(ye[0],ye[1])),ee=d.getFreeCameraOptions().position||new i.ac(0,0,0),Q=i.as(o.tileTransform,ee,L),ne=q.map(ye=>{const he=i.at(ye,ye,Q);return i.au(he,he),new i.av(Q,he)}),fe=i.aw(o,1,d.zoom)*d._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:X,tilespaceRays:ne,bufferedTilespaceGeometry:B,bufferedTilespaceBounds:(de=i.ax(B),de.min.x=i.aD(de.min.x,0,i.aj),de.min.y=i.aD(de.min.y,0,i.aj),de.max.x=i.aD(de.max.x,0,i.aj),de.max.y=i.aD(de.max.y,0,i.aj),de),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:fe};var de}_bufferedScreenMercator(o,d){const g=Ho(o);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let S;return S=d.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(o),d):{polygon:this.bufferedScreenGeometry(o).map(C=>d.pointCoordinate3D(C)),unwrapped:!0},this._screenRaycastCache[g]=S,S}}_bufferedCameraMercator(o,d){const g=Ho(o);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let S;return S=d.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(o),d):{polygon:this.bufferedCameraGeometry(o).map(C=>d.pointCoordinate3D(C)),unwrapped:!0},this._cameraRaycastCache[g]=S,S}}_projectAndResample(o,d){const g=function(C,M){const L=i.az([],M.pixelMatrix,M.globeMatrix),B=[0,-i.aE,0,1],q=[0,i.aE,0,1],X=[0,0,0,1];i.aA(B,B,L),i.aA(q,q,L),i.aA(X,X,L);const ee=new i.P(B[0]/B[3],B[1]/B[3]),Q=new i.P(q[0]/q[3],q[1]/q[3]),ne=i.aB(C,ee)&&B[3]<X[3],fe=i.aB(C,Q)&&q[3]<X[3];if(!ne&&!fe)return null;const de=function(je,ke,qe){for(let Ze=1;Ze<je.length;Ze++){const yt=Ki(ke.pointCoordinate3D(je[Ze-1]).x),ut=Ki(ke.pointCoordinate3D(je[Ze]).x);if(qe<0){if(yt<ut)return{idx:Ze,t:-yt/(ut-1-yt)}}else if(ut<yt)return{idx:Ze,t:(1-yt)/(ut+1-yt)}}return null}(C,M,ne?-1:1);if(!de)return null;const{idx:ye,t:he}=de;let Se=ye>1?Ci(C.slice(0,ye),M):[],Ae=ye<C.length?Ci(C.slice(ye),M):[];Se=Se.map(je=>new i.P(Ki(je.x),je.y)),Ae=Ae.map(je=>new i.P(Ki(je.x),je.y));const Pe=[...Se];Pe.length===0&&Pe.push(Ae[Ae.length-1]);const Be=i.ai(Pe[Pe.length-1].y,(Ae.length===0?Se[0]:Ae[0]).y,he);let Fe;return Fe=ne?[new i.P(0,Be),new i.P(0,0),new i.P(1,0),new i.P(1,Be)]:[new i.P(1,Be),new i.P(1,1),new i.P(0,1),new i.P(0,Be)],Pe.push(...Fe),Ae.length===0?Pe.push(Se[0]):Pe.push(...Ae),{polygon:Pe.map(je=>new i.ac(je.x,je.y)),unwrapped:!1}}(o,d);if(g)return g;const S=function(C,M){let L=!1,B=-1/0,q=0;for(let ee=0;ee<C.length-1;ee++)C[ee].x>B&&(B=C[ee].x,q=ee);for(let ee=0;ee<C.length-1;ee++){const Q=(q+ee)%(C.length-1),ne=C[Q],fe=C[Q+1];Math.abs(ne.x-fe.x)>.5&&(ne.x<fe.x?(ne.x+=1,Q===0&&(C[C.length-1].x+=1)):(fe.x+=1,Q+1===C.length-1&&(C[0].x+=1)),L=!0)}const X=i.ay(M.center.lng);return L&&X<Math.abs(X-1)&&C.forEach(ee=>{ee.x-=1}),{polygon:C,unwrapped:L}}(Ci(o,d).map(C=>new i.P(Ki(C.x),C.y)),d);return{polygon:S.polygon.map(C=>new i.ac(C.x,C.y)),unwrapped:S.unwrapped}}}function Ci(m,o){return i.aC(m,d=>{const g=o.pointCoordinate3D(d);d.x=g.x,d.y=g.y},1/256)}function Ki(m){return m<0?1+m%1:m%1}function Ho(m){return 100*m|0}function Qs(m,o,d,g,S){const C=function(L,B){if(L)return S(L);if(B){if(m.url&&B.tiles&&m.tiles&&delete m.tiles,B.variants){if(!Array.isArray(B.variants))return S(new Error("variants must be an array"));for(const X of B.variants){if(X==null||typeof X!="object"||X.constructor!==Object)return S(new Error("variant must be an object"));if(!Array.isArray(X.capabilities))return S(new Error("capabilities must be an array"));if(X.capabilities.length===1&&X.capabilities[0]==="meshopt"){B=i.l(B,X);break}}}const q=i.aF(i.l({},B,m),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);q.tiles=o.canonicalizeTileset(q,m.url),S(null,q)}},M=function(L,B,q){if(!L)return null;if(!B&&!q)return L;q=q||L.worldview_default;const X=Object.values(L.language||{});if(X.length===0)return null;const ee=Object.values(L.worldview||{});if(ee.length===0)return null;const Q=X.every(fe=>fe===B),ne=ee.every(fe=>fe===q);return Q&&ne?L:B in(L.language_options||{})||q in(L.worldview_options||{})?null:L.language_options&&L.worldview_options?L:null}(m.data,d,g);return M?i.q.frame(()=>C(null,M)):m.url?i.n(o.transformRequest(o.normalizeSourceURL(m.url,null,d,g),i.R.Source),C):i.q.frame(()=>{const{data:L,...B}=m;C(null,B)})}function xs(m,o){const d=Math.pow(2,o.z),g=Math.floor(i.ay(m.getWest())*d),S=Math.floor(i.aH(m.getNorth())*d),C=Math.ceil(i.ay(m.getEast())*d),M=Math.ceil(i.aH(m.getSouth())*d);return o.x>=g&&o.x<C&&o.y>=S&&o.y<M}class eo{constructor(o,d,g){this.bounds=o?i.aG.convert(this.validateBounds(o)):null,this.minzoom=d||0,this.maxzoom=g||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}addExtraBounds(o){if(o){this.extraBounds||(this.extraBounds=[]);for(const d of o)this.extraBounds.push(i.aG.convert(this.validateBounds(d)))}}contains(o){if(o.z>this.maxzoom||o.z<this.minzoom||this.bounds&&!xs(this.bounds,o))return!1;if(!this.extraBounds)return!0;for(const d of this.extraBounds)if(xs(d,o))return!0;return!1}static fromTileJSON(o){if(!o.bounds&&!o.extra_bounds)return null;const d=new eo(o.bounds,o.minzoom,o.maxzoom);return d.addExtraBounds(o.extra_bounds),d}}class cs extends i.E{constructor(o,d,g,S){if(super(),this.id=o,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,i.l(this,i.aF(d,["url","scheme","tileSize","promoteId"])),this._options=i.l({type:"vector"},d),this._collectResourceTiming=!!d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(S),this._tileWorkers={},this._deduped=new i.aI}load(o){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"}));const d=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map.getWorldview();this._tileJSONRequest=Qs(this._options,this.map._requestManager,d,g,(S,C)=>{if(this._tileJSONRequest=null,this._loaded=!0,S)d&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${d}`),g&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new i.z(S));else if(C){if(i.l(this,C),this.hasWorldviews=!!C.worldview_options,C.worldview_default&&(this.worldviewDefault=C.worldview_default),C.vector_layers){this.vectorLayers=C.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const M of C.vector_layers)this.vectorLayerIds.push(M.id),C.worldview&&C.worldview[M.source]&&this.localizableLayerIds.add(M.id)}this.tileBounds=eo.fromTileJSON(C),Ke(C.tiles,this.map._requestManager._customAccessToken),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}o&&o(S)})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();const o=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return i.l({},this._options)}loadTile(o,d){const g=o.tileID.canonical.url(this.tiles,this.scheme),S=this.map._requestManager.normalizeTileURL(g),C=this.map._requestManager.transformRequest(S,i.R.Tile),M=this.map.style?this.map.style.getLut(this.scope):null,L=M?{image:M.image.clone()}:null,B={request:C,data:void 0,uid:o.uid,tileID:o.tileID,tileZoom:o.tileZoom,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,lut:L,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:o.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:o.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&i.f(g)&&(B.worldview=this.map.getWorldview()||this.worldviewDefault,B.localizableLayerIds=this.localizableLayerIds),B.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired")o.state==="loading"?o.reloadCallback=d:o.request=o.actor.send("reloadTile",B,q.bind(this));else if(o.actor=this._tileWorkers[S]=this._tileWorkers[S]||this.dispatcher.getActor(),this.dispatcher.ready)o.request=o.actor.send("loadTile",B,q.bind(this),void 0,!0);else{const X=i.aJ.call({deduped:this._deduped},B,(ee,Q)=>{ee||!Q?q.call(this,ee):(B.data={cacheControl:Q.cacheControl,expires:Q.expires,rawData:Q.rawData.slice(0)},o.actor&&o.actor.send("loadTile",B,q.bind(this),void 0,!0))},!0);o.request={cancel:X}}function q(X,ee){return delete o.request,o.aborted?d(null):X&&X.status!==404?d(X):(ee&&ee.resourceTiming&&(o.resourceTiming=ee.resourceTiming),this.map._refreshExpiredTiles&&ee&&o.setExpiryData(ee),o.loadVectorData(ee,this.map.painter),i.aK(this.dispatcher),d(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,d){o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope}),o.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class $l extends i.E{constructor(o,d,g,S){super(),this.id=o,this.dispatcher=g,this.setEventedParent(S),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=i.l({type:"raster"},d),i.l(this,i.aF(d,["url","scheme","tileSize"]))}load(o){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"})),this._tileJSONRequest=Qs(this._options,this.map._requestManager,null,null,(d,g)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new i.z(d)):g&&(i.l(this,g),g.raster_layers&&(this.rasterLayers=g.raster_layers,this.rasterLayerIds=this.rasterLayers.map(S=>S.id)),this.tileBounds=eo.fromTileJSON(g),Ke(g.tiles),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))),o&&o(d)})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();const o=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return i.l({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,d){const g=i.q.devicePixelRatio>=2,S=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);o.request=i.o(this.map._requestManager.transformRequest(S,i.R.Tile),(C,M,L,B)=>(delete o.request,o.aborted?(o.state="unloaded",d(null)):C?(o.state="errored",d(C)):M?(this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:L,expires:B}),o.setTexture(M,this.map.painter),o.state="loaded",i.aK(this.dispatcher),void d(null)):d(null)))}abortTile(o,d){o.request&&(o.request.cancel(),delete o.request),d&&d()}unloadTile(o,d){o.texture&&o.texture instanceof i.T?(o.destroy(!0),o.texture&&o.texture instanceof i.T&&this.map.painter.saveTileTexture(o.texture)):o.destroy(),d&&d()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class nd extends $l{constructor(o,d,g,S){super(o,d,g,S),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=i.l({type:"raster-array"},d)}triggerRepaint(o){const d=this.map.painter._terrain,g=this.map.style.getSourceCache(this.id);d&&d.enabled&&g&&d._clearRenderCacheForTile(g.id,o.tileID),this.map.triggerRepaint()}loadTile(o,d){const g=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),S=this.map._requestManager.transformRequest(g,i.R.Tile),C={request:S,uid:o.uid,tileID:o.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};o.source=this.id,o.scope=this.scope,o.requestParams=S,o.actor||(o.actor=this.dispatcher.getActor());const M=(L,B,q,X)=>{if(delete o.request,o.aborted)return o.state="unloaded",d(null);if(L)return L.name==="AbortError"?void 0:(o.state="errored",d(L));if(this.map._refreshExpiredTiles&&B&&o.setExpiryData({cacheControl:q,expires:X}),this.partial)o.state="empty";else{if(!B)return d(null);o.state="loaded",o._isHeaderLoaded=!0,o._mrt=B}d(null)};o.request=this.partial?o.fetchHeader(void 0,M.bind(this)):o.actor.send("loadTile",C,M.bind(this),void 0,!0)}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,d){const g=o.texture;g&&g instanceof i.T?(o.destroy(!0),this.map.painter.saveTileTexture(g)):(o.destroy(),o.flushQueues(),o._isHeaderLoaded=!1,delete o._mrt,delete o.textureDescriptor),o.fbo&&(o.fbo.destroy(),delete o.fbo),delete o.request,delete o.requestParams,delete o.neighboringTiles,o.state="unloaded"}prepareTile(o,d,g){o._isHeaderLoaded&&(o.state!=="empty"&&(o.state="reloading"),o.fetchBand(d,g,(S,C)=>{if(S)return o.state="errored",this.fire(new i.z(S)),void this.triggerRepaint(o);C&&(o._isHeaderLoaded=!0,o.setTexture(C,this.map.painter),o.state="loaded",this.triggerRepaint(o))}))}getInitialBand(o){if(!this.rasterLayers)return 0;const d=this.rasterLayers.find(({id:C})=>C===o),g=d&&d.fields,S=g&&g.bands&&g.bands;return S?S[0]:0}getTextureDescriptor(o,d,g){if(!o)return;const S=d.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!S)return;let C=null;d instanceof i.aN?C=d.paint.get("raster-array-band"):d instanceof i.aO&&(C=d.paint.get("raster-particle-array-band"));const M=C||this.getInitialBand(S);if(M!=null)if(o.textureDescriptor){if(!o.updateNeeded(S,M)||g)return Object.assign({},o.textureDescriptor,{texture:o.texture})}else this.prepareTile(o,S,M)}getImages(o,d){const g=new Map;for(const S of o)for(const C of d){const[M,L]=C.split("/"),B=S.getLayer(M);if(!B||!B.hasBand(L)||!B.hasDataForBand(L))continue;const{bytes:q,tileSize:X,buffer:ee}=B.getBandView(L),Q=X+2*ee,ne={data:new i.r({width:Q,height:Q},q),pixelRatio:2,sdf:!1,usvg:!1,version:0};g.set(C,ne)}return g}}const gf={vector:cs,raster:$l,"raster-dem":class extends $l{constructor(m,o,d,g){super(m,o,d,g),this.type="raster-dem",this.maxzoom=22,this._options=i.l({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(m,o){const d=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(S,C){S&&(m.state="errored",o(S)),C&&(m.dem=C,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",o(null))}m.request=i.o(this.map._requestManager.transformRequest(d,i.R.Tile),(function(S,C,M,L){if(delete m.request,m.aborted)m.state="unloaded",o(null);else if(S)m.state="errored",o(S);else if(C){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:M,expires:L});const B=ImageBitmap&&C instanceof ImageBitmap&&i.t(),q=1-(C.width-i.aL(C.width))/2;q<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const X=B?C:i.q.getImageData(C,q),ee={uid:m.uid,tileID:m.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:X,encoding:this.encoding,padding:q};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadTile",ee,g.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(m){const o=m.canonical,d=Math.pow(2,o.z),g=(o.x-1+d)%d,S=o.x===0?m.wrap-1:m.wrap,C=(o.x+1+d)%d,M=o.x+1===d?m.wrap+1:m.wrap,L={};return L[new i.aM(m.overscaledZ,S,o.z,g,o.y).key]={backfilled:!1},L[new i.aM(m.overscaledZ,M,o.z,C,o.y).key]={backfilled:!1},o.y>0&&(L[new i.aM(m.overscaledZ,S,o.z,g,o.y-1).key]={backfilled:!1},L[new i.aM(m.overscaledZ,m.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},L[new i.aM(m.overscaledZ,M,o.z,C,o.y-1).key]={backfilled:!1}),o.y+1<d&&(L[new i.aM(m.overscaledZ,S,o.z,g,o.y+1).key]={backfilled:!1},L[new i.aM(m.overscaledZ,m.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},L[new i.aM(m.overscaledZ,M,o.z,C,o.y+1).key]={backfilled:!1}),L}},"raster-array":nd,geojson:class extends i.E{constructor(m,o,d,g){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=d.getActor(),this.setEventedParent(g),this._data=o.data,this._options=i.l({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.minzoom!==void 0&&(this.minzoom=o.minzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const S=i.aj/this.tileSize;this.workerOptions=i.l({source:this.id,scope:this.scope,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*S,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*S,extent:i.aj,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:i.aj,radius:(o.clusterRadius!==void 0?o.clusterRadius:50)*S,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter,dynamic:o.dynamic},o.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}updateData(m){if(!this._options.dynamic)return this.fire(new i.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof m!="string"&&(m.type==="Feature"&&(m={type:"FeatureCollection",features:[m]}),m.type!=="FeatureCollection"))return this.fire(new i.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof m!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const o=new Map;for(const d of this._data.features)o.set(d.id,d);for(const d of m.features)o.set(d.id,d);this._data.features=[...o.values()]}else this._data=m;return this._updateWorkerData(!0),this}getClusterExpansionZoom(m,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id,scope:this.scope},o),this}getClusterChildren(m,o){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id,scope:this.scope},o),this}getClusterLeaves(m,o,d,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:m,limit:o,offset:d},g),this}_updateWorkerData(m=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.A("dataloading",{dataType:"source"})),this._loaded=!1;const o=i.l({append:m},this.workerOptions);o.scope=this.scope;const d=this._data;typeof d=="string"?(o.request=this.map._requestManager.transformRequest(i.q.resolveURL(d),i.R.Source),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(d),this._pendingLoad=this.actor.send(`${this.type}.loadData`,o,(g,S)=>{if(this._loaded=!0,this._pendingLoad=null,g)this.fire(new i.z(g));else{const C={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&S&&S.resourceTiming&&S.resourceTiming[this.id]&&(C.resourceTiming=S.resourceTiming[this.id]),m&&(this._partialReload=!0),this.fire(new i.A("data",C)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(m),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const m=i.C(this.id,this.scope);this.map.style.clearSource(m),this._updateWorkerData()}loadTile(m,o){const d=m.actor?"reloadTile":"loadTile";m.actor=this.actor;const g=this.map.style?this.map.style.getLut(this.scope):null,S=g?{image:g.image.clone()}:null,C=this._partialReload,M={type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:S,scope:this.scope,pixelRatio:i.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:m.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:C};m.request=this.actor.send(d,M,(L,B)=>C&&!B?(m.state="loaded",o(null)):(delete m.request,m.destroy(),m.aborted?o(null):L?o(L):(m.loadVectorData(B,this.map.painter,d==="reloadTile"),o(null))),void 0,d==="loadTile")}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m,o){this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id,scope:this.scope}),m.destroy()}onRemove(m){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return i.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.aP{constructor(m,o,d,g){super(m,o,d,g),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const o of m.urls)this.urls.push(this.map._requestManager.transformRequest(o,i.R.Source).url);i.aQ(this.urls,(o,d)=>{this._loaded=!0,o?this.fire(new i.z(o)):d&&(this.video=d,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const o=this.video.seekable;m<o.start(0)||m>o.end(0)?this.fire(new i.z(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const m=this.map.painter.context,o=m.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(m,this.video,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.aP,model:class extends i.E{constructor(m,o,d,g){super(),this.id=m,this.type="model",this.models=[],this._loaded=!1,this._options=o}load(){const m=[];for(const o in this._options.models){const d=this._options.models[o],g=i.aS(this.map._requestManager.transformRequest(d.uri,i.R.Model).url).then(S=>{if(!S)return;const C=i.aT(S),M=new i.aU(o,d.position,d.orientation,C);M.computeBoundsAndApplyParent(),this.models.push(M)}).catch(S=>{this.fire(new i.z(new Error(`Could not load model ${o} from ${d.uri}: ${S.message}`)))});m.push(g)}Promise.allSettled(m).then(()=>{this._loaded=!0,this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(o=>{this._loaded=!0,this.fire(new i.z(new Error(`Could not load models: ${o.message}`)))})}onAdd(m){this.map=m,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(m,o){}serialize(){return this._options}},"batched-model":class extends i.E{constructor(m,o,d,g){super(),this.type="batched-model",this.id=m,this.tileSize=512,this._options=o,this.tiles=this._options.tiles,this.maxzoom=o.maxzoom||19,this.minzoom=o.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=d,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(g)}onAdd(m){this.map=m,this.load()}reload(){this.cancelTileJSONRequest();const m=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(m))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(m){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map.getWorldview();this._tileJSONRequest=Qs(this._options,this.map._requestManager,o,d,(g,S)=>{this._tileJSONRequest=null,this._loaded=!0,g?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),d&&d.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new i.z(g))):S&&(i.l(this,S),S.bounds&&(this.tileBounds=new eo(S.bounds,this.minzoom,this.maxzoom)),Ke(S.tiles,this.map._requestManager._customAccessToken),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))),m&&m(g)})}hasTransition(){return!1}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}loaded(){return this._loaded}loadTile(m,o){const d=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(d,i.R.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:m.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:i.q.devicePixelRatio,promoteId:this.promoteId};if(m.actor&&m.state!=="expired")if(m.state==="loading")m.reloadCallback=o;else{if(m.buckets){const C=Object.values(m.buckets);for(const M of C)M.dirty=!0;return void(m.state="loaded")}m.request=m.actor.send("reloadTile",g,S.bind(this))}else m.actor=this.dispatcher.getActor(),m.request=m.actor.send("loadTile",g,S.bind(this),void 0,!0);function S(C,M){return m.aborted?o(null):C&&C.status!==404?o(C):(this.map._refreshExpiredTiles&&M&&m.setExpiryData(M),m.loadModelData(M,this.map.painter),m.state="loaded",void o(null))}}serialize(){return i.l({},this._options)}},canvas:class extends i.aP{constructor(m,o,d,g){super(m,o,d,g),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(S=>!Array.isArray(S)||S.length!==2||S.some(C=>typeof C!="number"))||this.fire(new i.z(new i.V(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.z(new i.V(`sources.${m}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new i.z(new i.V(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new i.z(new i.V(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.z(new i.V(`sources.${m}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(m){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context;this.texture?!m&&!this._playing||this.texture instanceof i.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(o,this.canvas,o.gl.RGBA8,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends i.E{constructor(m,o,d,g){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=d,this._implementation=o,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new eo(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.clearTiles=this._clearTiles.bind(this),o.coveringTiles=this._coveringTiles.bind(this),i.l(this,i.aF(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this.map=m,this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:o,y:d,z:g}=m.canonical;return this._implementation.hasTile({x:o,y:d,z:g})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,o){const{x:d,y:g,z:S}=m.tileID.canonical,C=new AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:d,y:g,z:S},{signal:C.signal})).then((function(M){return delete m.request,m.aborted?(m.state="unloaded",o(null)):M===void 0?(m.state="errored",o(null)):M===null?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",o(null)):function(L){return L instanceof ImageData||L instanceof HTMLCanvasElement||L instanceof ImageBitmap||L instanceof HTMLImageElement}(M)?(this.loadTileData(m,M),m.state="loaded",void o(null)):(m.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(M=>{M.name!=="AbortError"&&(m.state="errored",o(M))}),m.request.cancel=()=>C.abort()}loadTileData(m,o){m.setTexture(o,this.map.painter)}unloadTile(m,o){if(m.texture&&m.texture instanceof i.T?(m.destroy(!0),m.texture&&m.texture instanceof i.T&&this.map.painter.saveTileTexture(m.texture)):m.destroy(),this._implementation.unloadTile){const{x:d,y:g,z:S}=m.tileID.canonical;this._implementation.unloadTile({x:d,y:g,z:S})}o&&o()}abortTile(m,o){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),o&&o()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){const m=i.C(this.id,this.scope);this.map.style.clearSource(m)}_update(){this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}}},Ac=function(m,o,d,g){const S=new gf[o.type](m,o,d,g);if(S.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${S.id}`);return i.aV(["load","abort","unload","serialize","prepare"],S),S};function id(m,o,d=""){return`${d}:${o.id||""}:${o.layer.id}:${function(g){if("layerId"in g)return`layer:${g.layerId}`;{const{featuresetId:S,importId:C}=g;return`featureset:${S}${C?`:import:${C}`:""}`}}(m.target)}`}function Pc(m,o,d,g=""){if(m.uniqueFeatureID){const S=id(m,o,g);if(d.has(S))return!0;d.add(S)}return!1}function Vl(m,o,d,g,S=!1){const C=o.sourceCache.transform,M=o.sourceCache.tilesIn(m,o.has3DLayers,S);M.sort(Ia);const L=[];for(const B of M){const q=B.tile.queryRenderedFeatures(o,B,d,g,C,S);Object.keys(q).length&&L.push({wrappedTileID:B.tile.tileID.wrapped().key,queryResults:q})}return L.length===0?{}:function(B){const q={},X={};for(const ee of B){const Q=ee.queryResults,ne=ee.wrappedTileID,fe=X[ne]=X[ne]||{};for(const de in Q){const ye=Q[de],he=fe[de]=fe[de]||{},Se=q[de]=q[de]||[];for(const Ae of ye)he[Ae.featureIndex]||(he[Ae.featureIndex]=!0,Se.push(Ae))}}return q}(L)}function yf(m,o,d,g,S){const C={},M=g.queryRenderedSymbols(m),L=[];for(const B of Object.keys(M).map(Number))L.push(S[B]);L.sort(Ia);for(const B of L){const q=B.featureIndex.lookupSymbolFeatures(M[B.bucketInstanceId],B.bucketIndex,B.sourceLayerIndex,o,d);for(const X in q){const ee=C[X]=C[X]||[],Q=q[X];Q.sort((ne,fe)=>{const de=B.featureSortOrder;if(de){const ye=de.indexOf(ne.featureIndex);return de.indexOf(fe.featureIndex)-ye}return fe.featureIndex-ne.featureIndex});for(const ne of Q)ee.push(ne)}}return C}function sg(m,o){const d=m.getRenderableIds().map(C=>m.getTileByID(C)),g=[],S={};for(let C=0;C<d.length;C++){const M=d[C],L=M.tileID.canonical.key;S[L]||(S[L]=!0,M.querySourceFeatures(g,o))}return g}function Ia(m,o){const d=m.tileID,g=o.tileID;return d.overscaledZ-g.overscaledZ||d.canonical.y-g.canonical.y||d.wrap-g.wrap||d.canonical.x-g.canonical.x}function kp(m,o){const d={};if(!o)return d;for(const g of m){const S=g.layerIds.map(C=>o.getLayer(C)).filter(Boolean);if(S.length!==0){g.layers=S,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(C=>S.filter(M=>M.id===C)[0]));for(const C of S)d[C.fqid]=g}}return d}const Wo=32,aa=33,Mc=new Uint16Array(8184);for(let m=0;m<2046;m++){let o=m+2,d=0,g=0,S=0,C=0,M=0,L=0;for(1&o?S=C=M=Wo:d=g=L=Wo;(o>>=1)>1;){const q=d+S>>1,X=g+C>>1;1&o?(S=d,C=g,d=M,g=L):(d=S,g=C,S=M,C=L),M=q,L=X}const B=4*m;Mc[B+0]=d,Mc[B+1]=g,Mc[B+2]=S,Mc[B+3]=C}const ka=new Uint16Array(2178),wi=new Uint8Array(1089),Oa=new Uint16Array(1089);function nh(m){return m===0?-.03125:m===32?.03125:0}const vf={type:2,extent:i.aj,loadGeometry:()=>[[new i.P(0,0),new i.P(i.aj+1,0),new i.P(i.aj+1,i.aj+1),new i.P(0,i.aj+1),new i.P(0,0)]]};class Ul{constructor(o,d,g,S,C){this.tileID=o,this.uid=i.a$(),this.uses=0,this.tileSize=d,this.tileZoom=g,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=C,S&&S.style&&(this._lastUpdatedBrightness=S.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",S&&S.transform&&(this.projection=S.transform.projection)}registerFadeDuration(o){const d=o+this.timeAdded;d<i.q.now()||this.fadeEndTime&&d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=i.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,d,g){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=kp(o.buckets,d.style),this.hasSymbolBuckets=!1;for(const S in this.buckets){const C=this.buckets[S];if(C instanceof i.b1){if(this.hasSymbolBuckets=!0,!g)break;C.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const S in this.buckets){const C=this.buckets[S];if(C instanceof i.b1&&C.hasRTLText){this.hasRTLText=!0,i.b2();break}}this.queryPadding=0;for(const S in this.buckets){const C=this.buckets[S],M=d.style.getOwnLayer(S);if(!M)continue;const L=M.queryRadius(C);this.queryPadding=Math.max(this.queryPadding,L)}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas),this._lastUpdatedBrightness=o.brightness}else this.collisionBoxArray=new i.b0}unloadVectorData(){if(this.hasData()){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(o,d,g){o&&(o.resourceTiming&&(this.resourceTiming=o.resourceTiming),this.buckets=Object.assign({},this.buckets,kp(o.buckets,d.style)),o.featureIndex&&(this.latestFeatureIndex=o.featureIndex))}getBucket(o){return this.buckets[o.fqid]}upload(o){for(const S in this.buckets){const C=this.buckets[S];C.uploadPending()&&C.upload(o)}const d=o.gl,g=this.imageAtlas;g&&!g.uploaded&&(this.imageAtlasTexture=new i.T(o,g.image,d.RGBA8,{useMipmap:!!g.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new i.T(o,this.glyphAtlasImage,d.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new i.T(o,this.lineAtlas.image,d.R8),this.lineAtlas.uploaded=!0)}prepare(o,d,g){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture,g),!d||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const S=d.style.getBrightness();(this._lastUpdatedBrightness||S)&&(this._lastUpdatedBrightness&&S&&Math.abs(this._lastUpdatedBrightness-S)<.001||(this.updateBuckets(d,this._lastUpdatedBrightness!==S),this._lastUpdatedBrightness=S))}queryRenderedFeatures(o,d,g,S,C,M){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const L=function(B,q){const X=i.bn([],[.5*B.width,.5*-B.height,1]);return i.bo(X,X,[1,-1,0]),i.az(X,X,B.calculateProjMatrix(q.toUnwrapped())),Float32Array.from(X)}(C,this.tileID);return this.latestFeatureIndex.query(o,{tilespaceGeometry:d,pixelPosMatrix:L,transform:S,availableImages:g,tileTransform:this.tileTransform})}querySourceFeatures(o,d){const g=this.latestFeatureIndex;if(!g||!g.rawTileData)return;const S=g.loadVTLayers(),C=d?d.sourceLayer:"",M=S._geojsonTileLayer||S[C];if(!M)return;const L=i.b3(d&&d.filter),{z:B,x:q,y:X}=this.tileID.canonical,ee={z:B,x:q,y:X};for(let Q=0;Q<M.length;Q++){const ne=M.feature(Q);if(L.needGeometry){const ye=i.b4(ne,!0);if(!L.filter(new i.aa(this.tileID.overscaledZ),ye,this.tileID.canonical))continue}else if(!L.filter(new i.aa(this.tileID.overscaledZ),ne))continue;const fe=g.getId(ne,C),de=new i.b5(ne,B,q,X,fe);de.tile=ee,o.push(de)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(o){const d=this.expirationTime;if(o.cacheControl){const g=i.b6(o.cacheControl);g["max-age"]&&(this.expirationTime=Date.now()+1e3*g["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const g=Date.now();let S=!1;if(this.expirationTime>g)S=!1;else if(d)if(this.expirationTime<d)S=!0;else{const C=this.expirationTime-d;C?this.expirationTime=g+Math.max(C,3e4):S=!0}else S=!0;S?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(o){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&o&&this.updateBuckets(o)}updateBuckets(o,d){if(!this.latestFeatureIndex||!o.style)return;const g=this.latestFeatureIndex.loadVTLayers(),S=o.style.listImages(),C=o.style.getBrightness();for(const M in this.buckets){if(!o.style.hasLayer(M))continue;const L=this.buckets[M],B=L.layers[0],q=B.sourceLayer||"_geojsonTileLayer",X=g[q],ee=o.style.getLayerSourceCache(B);let Q={};ee&&(Q=ee._state.getState(q,void 0));const ne=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},fe=Object.keys(Q).length>0&&!d;fe&&!L.stateDependentLayers.length&&!d||L.update(Q,X,S,ne,fe?L.stateDependentLayers:L.layers,d,C),(L instanceof i.b7||L instanceof i.b8)&&o._terrain&&o._terrain.enabled&&ee&&L.uploadPending()&&o._terrain._clearRenderCacheForTile(ee.id,this.tileID);const de=o&&o.style&&o.style.getOwnLayer(M);de&&(this.queryPadding=Math.max(this.queryPadding,de.queryRadius(L)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=i.q.now()+o}setTexture(o,d){const g=d.context,S=g.gl;this.texture=this.texture||d.getTileTexture(o.width),this.texture&&this.texture instanceof i.T?this.texture.update(o):(this.texture=new i.T(g,o,S.RGBA8,{useMipmap:!0}),this.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE))}setDependencies(o,d){const g={};for(const S of d)g[S]=!0;this.dependencies[o]=g}hasDependency(o,d){for(const g of o){const S=this.dependencies[g];if(S){for(const C of d)if(S[C])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,d){if(!d||d.name==="mercator"||this._tileDebugBuffer)return;const g=i.b9(vf,this.tileID.canonical,this.tileTransform)[0],S=new i.ba,C=new i.bb;for(let M=0;M<g.length;M++){const{x:L,y:B}=g[M];S.emplaceBack(L,B),C.emplaceBack(M)}C.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(C),this._tileDebugBuffer=o.createVertexBuffer(S,i.bc.members),this._tileDebugSegments=i.bd.simpleSegment(0,0,S.length,C.length)}_makeTileBoundsBuffers(o,d){if(this._tileBoundsBuffer||!d||d.name==="mercator")return;const g=i.b9(vf,this.tileID.canonical,this.tileTransform)[0];let S,C;if(this.isRaster){const M=function(L,B){const q=i.aW(L,B),X=Math.pow(2,L.z);for(let ye=0;ye<aa;ye++)for(let he=0;he<aa;he++){const Se=i.aX((L.x+(he+nh(he))/Wo)/X),Ae=i.aY((L.y+(ye+nh(ye))/Wo)/X),Pe=B.project(Se,Ae),Be=ye*aa+he;ka[2*Be+0]=Math.round((Pe.x*q.scale-q.x)*i.aj),ka[2*Be+1]=Math.round((Pe.y*q.scale-q.y)*i.aj)}wi.fill(0),Oa.fill(0);for(let ye=2045;ye>=0;ye--){const he=4*ye,Se=Mc[he+0],Ae=Mc[he+1],Pe=Mc[he+2],Be=Mc[he+3],Fe=Se+Pe>>1,je=Ae+Be>>1,ke=Fe+je-Ae,qe=je+Se-Fe,Ze=Ae*aa+Se,yt=Be*aa+Pe,ut=je*aa+Fe,At=Math.hypot((ka[2*Ze+0]+ka[2*yt+0])/2-ka[2*ut+0],(ka[2*Ze+1]+ka[2*yt+1])/2-ka[2*ut+1])>=16;wi[ut]=wi[ut]||(At?1:0),ye<1022&&(wi[ut]=wi[ut]||wi[(Ae+qe>>1)*aa+(Se+ke>>1)]||wi[(Be+qe>>1)*aa+(Pe+ke>>1)])}const ee=new i.aZ,Q=new i.a_;let ne=0;function fe(ye,he){const Se=he*aa+ye;return Oa[Se]===0&&(ee.emplaceBack(ka[2*Se+0],ka[2*Se+1],ye*i.aj/Wo,he*i.aj/Wo),Oa[Se]=++ne),Oa[Se]-1}function de(ye,he,Se,Ae,Pe,Be){const Fe=ye+Se>>1,je=he+Ae>>1;if(Math.abs(ye-Pe)+Math.abs(he-Be)>1&&wi[je*aa+Fe])de(Pe,Be,ye,he,Fe,je),de(Se,Ae,Pe,Be,Fe,je);else{const ke=fe(ye,he),qe=fe(Se,Ae),Ze=fe(Pe,Be);Q.emplaceBack(ke,qe,Ze)}}return de(0,0,Wo,Wo,Wo,0),de(Wo,Wo,0,0,0,Wo),{vertices:ee,indices:Q}}(this.tileID.canonical,d);S=M.vertices,C=M.indices}else{S=new i.aZ,C=new i.a_;for(const{x:L,y:B}of g)S.emplaceBack(L,B,0,0);const M=i.be(S.int16.subarray(0,4*S.length),void 0,4);for(let L=0;L<M.length;L+=3)C.emplaceBack(M[L],M[L+1],M[L+2])}this._tileBoundsBuffer=o.createVertexBuffer(S,i.bf.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(C),this._tileBoundsSegments=i.bd.simpleSegment(0,0,S.length,C.length)}_makeGlobeTileDebugBuffers(o,d){const g=d.projection;if(!g||g.name!=="globe"||d.freezeTileCoverage)return;const S=this.tileID.canonical,C=i.bg(S,d),M=i.bh(C),L=i.ah(d.zoom);let B;L>0&&(B=i.bi(new Float64Array(16),d.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,S,d,M,B,L),this._makeGlobeTileDebugTextBuffer(o,S,d,M,B,L)}_globePoint(o,d,g,S,C,M,L){let B=i.bj(o,d,g);if(M){const q=1<<g.z,X=i.ay(S.center.lng),ee=i.aH(S.center.lat),Q=(g.x+.5)/q-X;let ne=0;Q>.5?ne=-1:Q<-.5&&(ne=1);let fe=(o/i.aj+g.x)/q+ne,de=(d/i.aj+g.y)/q;fe=(fe-X)*S._pixelsPerMercatorPixel+X,de=(de-ee)*S._pixelsPerMercatorPixel+ee;const ye=[fe*S.worldSize,de*S.worldSize,0];i.ad(ye,ye,M),B=i.bk(B,ye,L)}return i.ad(B,B,C)}_makeGlobeTileDebugBorderBuffer(o,d,g,S,C,M){const L=new i.ba,B=new i.bb,q=new i.bl,X=(Q,ne,fe,de,ye)=>{const he=(fe-Q)/(ye-1),Se=(de-ne)/(ye-1),Ae=L.length;for(let Pe=0;Pe<ye;Pe++){const Be=Q+Pe*he,Fe=ne+Pe*Se;L.emplaceBack(Be,Fe);const je=this._globePoint(Be,Fe,d,g,S,C,M);q.emplaceBack(je[0],je[1],je[2]),B.emplaceBack(Ae+Pe)}},ee=i.aj;X(0,0,ee,0,16),X(ee,0,ee,ee,16),X(ee,ee,0,ee,16),X(0,ee,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(B),this._tileDebugBuffer=o.createVertexBuffer(L,i.bc.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(q,i.bm.members),this._tileDebugSegments=i.bd.simpleSegment(0,0,L.length,B.length)}_makeGlobeTileDebugTextBuffer(o,d,g,S,C,M){const L=i.aj/4,B=new i.ba,q=new i.a_,X=new i.bl,ee=25;q.reserve(32),B.reserve(ee),X.reserve(ee);const Q=(ne,fe)=>ee*ne+fe;for(let ne=0;ne<ee;ne++){const fe=ne*L;for(let de=0;de<ee;de++){const ye=de*L;B.emplaceBack(ye,fe);const he=this._globePoint(ye,fe,d,g,S,C,M);X.emplaceBack(he[0],he[1],he[2])}}for(let ne=0;ne<4;ne++)for(let fe=0;fe<4;fe++){const de=Q(ne,fe),ye=Q(ne,fe+1),he=Q(ne+1,fe),Se=Q(ne+1,fe+1);q.emplaceBack(de,ye,he),q.emplaceBack(he,ye,Se)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(q),this._tileDebugTextBuffer=o.createVertexBuffer(B,i.bc.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(X,i.bm.members),this._tileDebugTextSegments=i.bd.simpleSegment(0,0,ee,32)}destroy(o=!1){for(const d in this.buckets)this.buckets[d].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!o&&this.texture&&this.texture instanceof i.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}i.bp.setPbf(i.bq);class ih extends Ul{constructor(o,d,g,S,C){super(o,d,g,S,C),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(o){return this._mrt&&this._mrt.getLayer(o)}setTexture(o,d){const g=d.context,S=g.gl;this.texture=this.texture||d.getTileTexture(o.width),this.texture&&this.texture instanceof i.T?this.texture.update(o,{premultiply:!1}):this.texture=new i.T(g,o,S.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(o=16384,d){const g=this._mrt=new i.bp(30),S=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(o-1)}});return this.entireBuffer=null,this.request=i.br(S,(C,M,L,B)=>{if(C)d(C);else try{const q=g.getHeaderLength(M);if(q>o)return void(this.request=this.fetchHeader(q,d));g.parseHeader(M),this._isHeaderLoaded=!0;let X=0;for(const ee of Object.values(g.layers))X=Math.max(X,ee.dataIndex[ee.dataIndex.length-1].lastByte);M.byteLength>=X&&(this.entireBuffer=M),d(null,this.entireBuffer||M,L,B)}catch(q){d(q)}}),this.request}fetchBand(o,d,g){const S=this._mrt;if(!this._isHeaderLoaded||!S)return void g(new Error("Tile header is not ready"));const C=this.actor;if(!C)return void g(new Error("Can't fetch tile band without an actor"));let M;const L=(ee,Q)=>{M.complete(ee,Q),ee?g(ee):(this.updateTextureDescriptor(o,d),g(null,this.textureDescriptor&&this.textureDescriptor.img))},B=(ee,Q)=>{if(ee)return g(ee);const ne=C.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:Q,task:M},L,void 0,!0);this._workQueue.push(()=>{ne&&ne.cancel(),M.cancel()})},q=S.getLayer(o);if(!q)return void g(new Error(`Unknown sourceLayer "${o}"`));if(q.hasDataForBand(d))return this.updateTextureDescriptor(o,d),void g(null,this.textureDescriptor?this.textureDescriptor.img:null);const X=q.getDataRange([d]);if(M=S.createDecodingTask(X),!M||M.tasks.length)if(this.flushQueues(),this.entireBuffer)B(null,this.entireBuffer.slice(X.firstByte,X.lastByte+1));else{const ee=Object.assign({},this.requestParams,{headers:{Range:`bytes=${X.firstByte}-${X.lastByte}`}}),Q=i.br(ee,B);this._fetchQueue.push(()=>{Q.cancel(),M.cancel()})}else g(null)}updateNeeded(o,d){return(!this.textureDescriptor||this.textureDescriptor.band!==d||this.textureDescriptor.layer!==o)&&this.state!=="errored"}updateTextureDescriptor(o,d){if(!this._mrt)return;const g=this._mrt.getLayer(o);if(!g||!g.hasBand(d)||!g.hasDataForBand(d))return;const{bytes:S,tileSize:C,buffer:M,offset:L,scale:B}=g.getBandView(d),q=C+2*M,X=new i.r({width:q,height:q},S),ee=this.texture;ee&&ee instanceof i.T&&ee.update(X,{premultiply:!1}),this.textureDescriptor={layer:o,band:d,img:X,buffer:M,offset:L,tileSize:C,format:g.pixelFormat,mix:[B,256*B,65536*B,16777216*B]}}}class Op{constructor(o,d){this.max=o,this.onRemove=d,this.reset()}reset(){for(const o in this.data)for(const d of this.data[o])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(o,d,g){const S=o.wrapped().key;this.data[S]===void 0&&(this.data[S]=[]);const C={value:d,timeout:void 0};if(g!==void 0&&(C.timeout=setTimeout(()=>{this.remove(o,C)},g)),this.data[S].push(C),this.order.push(S),this.order.length>this.max){const M=this._getAndRemoveByKey(this.order[0]);M&&this.onRemove(M)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const d=this.data[o].shift();return d.timeout&&clearTimeout(d.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),d.value}getByKey(o){const d=this.data[o];return d?d[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,d){if(!this.has(o))return this;const g=o.wrapped().key,S=d===void 0?0:this.data[g].indexOf(d),C=this.data[g][S];return this.data[g].splice(S,1),C.timeout&&clearTimeout(C.timeout),this.data[g].length===0&&delete this.data[g],this.onRemove(C.value),this.order.splice(this.order.indexOf(g),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(o){const d=[];for(const g in this.data)for(const S of this.data[g])o(S.value)||d.push(S);for(const g of d)this.remove(g.value.tileID,g)}}class sd{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,d,g){const S=String(d);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][S]=this.stateChanges[o][S]||{},i.l(this.stateChanges[o][S],g),this.deletedStates[o]===null){this.deletedStates[o]={};for(const C in this.state[o])C!==S&&(this.deletedStates[o][C]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][S]===null){this.deletedStates[o][S]={};for(const C in this.state[o][S])g[C]||(this.deletedStates[o][S][C]=null)}else for(const C in g)this.deletedStates[o]&&this.deletedStates[o][S]&&this.deletedStates[o][S][C]===null&&delete this.deletedStates[o][S][C]}removeFeatureState(o,d,g){if(this.deletedStates[o]===null)return;const S=String(d);if(this.deletedStates[o]=this.deletedStates[o]||{},g&&d!==void 0)this.deletedStates[o][S]!==null&&(this.deletedStates[o][S]=this.deletedStates[o][S]||{},this.deletedStates[o][S][g]=null);else if(d!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][S])for(g in this.deletedStates[o][S]={},this.stateChanges[o][S])this.deletedStates[o][S][g]=null;else this.deletedStates[o][S]=null;else this.deletedStates[o]=null}getState(o,d){const g=this.state[o]||{},S=this.stateChanges[o]||{},C=this.deletedStates[o];if(C===null)return{};if(d!==void 0){const L=String(d),B=i.l({},g[L],S[L]);if(C){const q=C[d];if(q===null)return{};for(const X in q)delete B[X]}return B}const M=i.l({},g,S);if(C)for(const L in C)delete M[L];return M}initializeTileState(o,d){o.refreshFeatureState(d)}coalesceChanges(o,d){const g={};for(const S in this.stateChanges){this.state[S]=this.state[S]||{};const C={};for(const M in this.stateChanges[S])this.state[S][M]||(this.state[S][M]={}),i.l(this.state[S][M],this.stateChanges[S][M]),C[M]=this.state[S][M];g[S]=C}for(const S in this.deletedStates){this.state[S]=this.state[S]||{};const C={};if(this.deletedStates[S]===null)for(const M in this.state[S])C[M]={},this.state[S][M]={};else for(const M in this.deletedStates[S]){if(this.deletedStates[S][M]===null)this.state[S][M]={};else if(this.state[S][M])for(const L of Object.keys(this.deletedStates[S][M]))delete this.state[S][M][L];C[M]=this.state[S][M]}g[S]=g[S]||{},i.l(g[S],C)}if(this.stateChanges={},this.deletedStates={},Object.keys(g).length!==0)for(const S in o)o[S].refreshFeatureState(d)}}class ho extends i.E{constructor(o,d,g){super(),this.id=o,this._onlySymbols=g,d.on("data",S=>{S.dataType==="source"&&S.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&S.dataType==="source"&&S.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),d.on("error",()=>{this._sourceErrored=!0}),this._source=d,this._tiles={},this._cache=new Op(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new sd,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(o){this.map=o,this._minTileCacheSize=this._minTileCacheSize===void 0&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles)if(!this._tiles[o].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,d){return o.isSymbolTile=this._onlySymbols,o.isExtraShadowCaster=this._shadowCasterTiles[o.tileID.key],this._source.loadTile(o,d)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o)}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o)}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const g=this._tiles[d];g.upload(o),g.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(bl).map(o=>o.key)}getRenderableIds(o,d){const g=[];for(const S in this._tiles)this._isIdRenderable(+S,o,d)&&g.push(this._tiles[S]);return o?g.sort((S,C)=>{const M=S.tileID,L=C.tileID,B=new i.P(M.canonical.x,M.canonical.y)._rotate(this.transform.angle),q=new i.P(L.canonical.x,L.canonical.y)._rotate(this.transform.angle);return M.overscaledZ-L.overscaledZ||q.y-B.y||q.x-B.x}).map(S=>S.tileID.key):g.map(S=>S.tileID).sort(bl).map(S=>S.key)}hasRenderableParent(o){const d=this.findLoadedParent(o,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(o,d,g){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(d||!this._tiles[o].holdingForFade())&&(g||!this._shadowCasterTiles[o])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(+o,"reloading")}}_reloadTile(o,d){const g=this._tiles[o];g&&(g.state!=="loading"&&(g.state=d),this._loadTile(g,this._tileLoaded.bind(this,g,o,d)))}_tileLoaded(o,d,g,S){if(S)if(o.state="errored",S.status!==404)this._source.fire(new i.z(S,{tile:o}));else{if(this._source.fire(new i.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:o})),!(o.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const C=this.map.painter.terrain;this.update(this.transform,C.getScaledDemTileSize(),!0),C.resetTileLookupCache(this.id)}else this.update(this.transform)}else o.timeAdded=i.q.now(),g==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(d,o),this._source.type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new i.A("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id}))}_backfillDEM(o){const d=this.getRenderableIds();for(let S=0;S<d.length;S++){const C=d[S];if(o.neighboringTiles&&o.neighboringTiles[C]){const M=this.getTileByID(C);g(o,M),g(M,o)}}function g(S,C){if(!S.dem||S.dem.borderReady)return;S.needsHillshadePrepare=!0,S.needsDEMTextureUpload=!0;let M=C.tileID.canonical.x-S.tileID.canonical.x;const L=C.tileID.canonical.y-S.tileID.canonical.y,B=Math.pow(2,S.tileID.canonical.z),q=C.tileID.key;M===0&&L===0||Math.abs(L)>1||(Math.abs(M)>1&&(Math.abs(M+B)===1?M+=B:Math.abs(M-B)===1&&(M-=B)),C.dem&&S.dem&&(S.dem.backfillBorder(C.dem,M,L),S.neighboringTiles&&S.neighboringTiles[q]&&(S.neighboringTiles[q].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,d,g,S){for(const C in this._tiles){let M=this._tiles[C];if(S[C]||!M.hasData()||M.tileID.overscaledZ<=d||M.tileID.overscaledZ>g)continue;let L=M.tileID;for(;M&&M.tileID.overscaledZ>d+1;){const q=M.tileID.scaledTo(M.tileID.overscaledZ-1);M=this._tiles[q.key],M&&M.hasData()&&(L=q)}let B=L;for(;B.overscaledZ>d;)if(B=B.scaledTo(B.overscaledZ-1),o[B.key]){S[L.key]=L;break}}}findLoadedParent(o,d){if(o.key in this._loadedParentTiles){const g=this._loadedParentTiles[o.key];return g&&g.tileID.overscaledZ>=d?g:null}for(let g=o.overscaledZ-1;g>=d;g--){const S=o.scaledTo(g),C=this._getLoadedTile(S);if(C)return C}}_getLoadedTile(o){const d=this._tiles[o.key];return d&&d.hasData()?d:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,d){d=d||this._source.tileSize;const g=Math.ceil(o.width/d)+1,S=Math.ceil(o.height/d)+1,C=Math.floor(g*S*5),M=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,C):C,L=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,M):M;this._cache.setMaxSize(L)}handleWrapJump(o){const d=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,d){const g={};for(const S in this._tiles){const C=this._tiles[S];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+d),g[C.tileID.key]=C}this._tiles=g;for(const S in this._timers)clearTimeout(this._timers[S]),delete this._timers[S];for(const S in this._tiles)this._setTileReloadTimer(+S,this._tiles[S])}}update(o,d,g,S,C){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!g)return;this.updateCacheSize(o,d),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const M=this._source.type==="batched-model";let L,B=this._source.maxzoom;const q=this.map&&this.map.painter?this.map.painter._terrain:null;if(q&&q.sourceCache===this&&q.attenuationRange()){const Q=q.attenuationRange()[0],ne=Math.floor(Q)-Math.log2(q.getDemUpscale());B>ne&&(B=ne)}if(this.used||this.usedForTerrain){if(this._source.tileID)L=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(Q=>new i.aM(Q.canonical.z,Q.wrap,Q.canonical.z,Q.canonical.x,Q.canonical.y));else if(this.tileCoverLift!==0){const Q=o.clone();Q.tileCoverLift=this.tileCoverLift,L=Q.coveringTiles({tileSize:d||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:B,roundZoom:this._source.roundZoom&&!g,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:M}),this._source.minzoom<=1&&o.projection.name==="globe"&&(L.push(new i.aM(1,0,1,0,0)),L.push(new i.aM(1,0,1,1,0)),L.push(new i.aM(1,0,1,0,1)),L.push(new i.aM(1,0,1,1,1)))}else if(L=o.coveringTiles({tileSize:d||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:B,roundZoom:this._source.roundZoom&&!g,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:M}),this._source.hasTile){const Q=this._source.hasTile.bind(this._source);L=L.filter(ne=>Q(ne))}}else L=[];if(L.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!wl(this._source.type)){const Q=o.coveringZoomLevel({tileSize:d||this._source.tileSize,roundZoom:this._source.roundZoom&&!g}),ne=Math.min(Q,this._source.maxzoom);if(M){const fe=o.extendTileCover(L,ne);for(const de of fe)L.push(de)}else if(C){const fe=o.extendTileCover(L,ne,this.transform._camera.forward());for(const de of fe)L.push(de)}else if(this.castsShadows&&S){const fe=o.extendTileCover(L,ne,S);for(const de of fe)this._shadowCasterTiles[de.key]=!0,L.push(de)}}const X=this._updateRetainedTiles(L);if(wl(this._source.type)&&L.length!==0){const Q={},ne={},fe=Object.keys(X);for(const ye of fe){const he=X[ye],Se=this._tiles[ye];if(!Se||Se.fadeEndTime&&Se.fadeEndTime<=i.q.now())continue;const Ae=this.findLoadedParent(he,Math.max(he.overscaledZ-ho.maxOverzooming,this._source.minzoom));Ae&&(this._addTile(Ae.tileID),Q[Ae.tileID.key]=Ae.tileID),ne[ye]=he}const de=L[L.length-1].overscaledZ;for(const ye in this._tiles){const he=this._tiles[ye];if(X[ye]||!he.hasData())continue;let Se=he.tileID;for(;Se.overscaledZ>de;){Se=Se.scaledTo(Se.overscaledZ-1);const Ae=this._tiles[Se.key];if(Ae&&Ae.hasData()&&ne[Se.key]){X[ye]=he.tileID;break}}}for(const ye in Q)X[ye]||(this._coveredTiles[ye]=!0,X[ye]=Q[ye])}for(const Q in X)this._tiles[Q].clearFadeHold();const ee=i.bs(this._tiles,X);for(const Q of ee){const ne=this._tiles[Q];ne.hasSymbolBuckets&&!ne.holdingForFade()?ne.setHoldDuration(this.map._fadeDuration):ne.hasSymbolBuckets&&!ne.symbolFadeFinished()||this._removeTile(+Q)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){const d={};if(o.length===0)return d;const g={},S=o.reduce((q,X)=>Math.min(q,X.overscaledZ),1/0),C=o[0].overscaledZ,M=Math.max(C-ho.maxOverzooming,this._source.minzoom),L=Math.max(C+ho.maxUnderzooming,this._source.minzoom),B={};for(const q of o){const X=this._addTile(q);d[q.key]=q,X.hasData()||S<this._source.maxzoom&&(B[q.key]=q)}this._retainLoadedChildren(B,S,L,d);for(const q of o){let X=this._tiles[q.key];if(X.hasData())continue;if(q.canonical.z>=this._source.maxzoom){const Q=q.children(this._source.maxzoom)[0],ne=this.getTile(Q);if(ne&&ne.hasData()){d[Q.key]=Q;continue}}else{const Q=q.children(this._source.maxzoom);if(d[Q[0].key]&&d[Q[1].key]&&d[Q[2].key]&&d[Q[3].key])continue}let ee=X.wasRequested();for(let Q=q.overscaledZ-1;Q>=M;--Q){const ne=q.scaledTo(Q);if(g[ne.key]||(g[ne.key]=!0,X=this.getTile(ne),!X&&ee&&(X=this._addTile(ne)),X&&(d[ne.key]=ne,ee=X.wasRequested(),X.hasData())))break}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const d=[];let g,S=this._tiles[o].tileID;for(;S.overscaledZ>0;){if(S.key in this._loadedParentTiles){g=this._loadedParentTiles[S.key];break}d.push(S.key);const C=S.scaledTo(S.overscaledZ-1);if(g=this._getLoadedTile(C),g)break;S=C}for(const C of d)this._loadedParentTiles[C]=g}}_addTile(o){let d=this._tiles[o.key];if(d)return d.isExtraShadowCaster!==!0||this._shadowCasterTiles[o.key]||this._reloadTile(o.key,"reloading"),d;d=this._cache.getAndRemove(o),d&&(this._setTileReloadTimer(o.key,d),d.tileID=o,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,d)));const g=!!d;if(!g){const S=this.map?this.map.painter:null,C=this._source.tileSize*o.overscaleFactor();d=this._source.type==="raster-array"?new ih(o,C,this.transform.tileZoom,S,this._isRaster):new Ul(o,C,this.transform.tileZoom,S,this._isRaster),this._loadTile(d,this._tileLoaded.bind(this,d,o.key,d.state))}return d.uses++,this._tiles[o.key]=d,g||this._source.fire(new i.A("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(o,d){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const g=d.getExpiryTimeout();g&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},g))}_removeTile(o){const d=this._tiles[o];d&&(d.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),d.uses>0||(d.hasData()&&d.state!=="reloading"||d.state==="empty"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,d,g){const S=[],C=this.transform;if(!C)return S;const M=C.projection.name==="globe",L=i.ay(C.center.lng);for(const B in this._tiles){const q=this._tiles[B];if(g&&q.clearQueryDebugViz(),q.holdingForFade())continue;let X;if(M){const ee=q.tileID.canonical;if(ee.z===0){const Q=[Math.abs(i.aD(L,...La(ee,-1))-L),Math.abs(i.aD(L,...La(ee,1))-L)];X=[0,2*Q.indexOf(Math.min(...Q))-1]}else{const Q=[Math.abs(i.aD(L,...La(ee,-1))-L),Math.abs(i.aD(L,...La(ee,0))-L),Math.abs(i.aD(L,...La(ee,1))-L)];X=[Q.indexOf(Math.min(...Q))-1]}}else X=[0];for(const ee of X){const Q=o.containsTile(q,C,d,ee);Q&&S.push(Q)}}return S}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(o){return this._getRenderableCoordinates(o)}_getRenderableCoordinates(o,d){const g=this.getRenderableIds(o,d).map(C=>this._tiles[C].tileID),S=this.transform.projection.name==="globe";for(const C of g)C.projMatrix=this.transform.calculateProjMatrix(C.toUnwrapped()),C.expandedProjMatrix=S?this.transform.calculateProjMatrix(C.toUnwrapped(),!1,!0):C.projMatrix;return g}sortCoordinatesByDistance(o){const d=o.slice(),g=this.transform._camera.position,S=this.transform._camera.forward(),C={};for(const M of d){const L=1/(1<<M.canonical.z);C[M.key]=((M.canonical.x+.5)*L+M.wrap-g[0])*S[0]+((M.canonical.y+.5)*L-g[1])*S[1]-g[2]*S[2]}return d.sort((M,L)=>C[M.key]-C[L.key]),d}hasTransition(){if(this._source.hasTransition())return!0;if(wl(this._source.type))for(const o in this._tiles){const d=this._tiles[o];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=i.q.now())return!0}return!1}setFeatureState(o,d,g){this._state.updateState(o=o||"_geojsonTileLayer",d,g)}removeFeatureState(o,d,g){this._state.removeFeatureState(o=o||"_geojsonTileLayer",d,g)}getFeatureState(o,d){return this._state.getState(o=o||"_geojsonTileLayer",d)}setDependencies(o,d,g){const S=this._tiles[o];S&&S.setDependencies(d,g)}reloadTilesForDependencies(o,d){for(const g in this._tiles)this._tiles[g].hasDependency(o,d)&&this._reloadTile(+g,"reloading");this._cache.filter(g=>!g.hasDependency(o,d))}_preloadTiles(o,d){if(!this._sourceLoaded){const B=()=>{this._sourceLoaded&&(this._source.off("data",B),this._preloadTiles(o,d))};return void this._source.on("data",B)}const g=new Map,S=Array.isArray(o)?o:[o],C=this.map.painter.terrain,M=this.usedForTerrain&&C?C.getScaledDemTileSize():this._source.tileSize;for(const B of S){const q=B.coveringTiles({tileSize:M,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const X of q)g.set(X.key,X);this.usedForTerrain&&B.updateElevation(!1)}const L=Array.from(g.values());i.bt(L,(B,q)=>{const X=new Ul(B,this._source.tileSize*B.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(X,ee=>{this._source.type==="raster-dem"&&X.dem&&this._backfillDEM(X),q(ee,X)})},d)}}function bl(m,o){const d=Math.abs(2*m.wrap)-+(m.wrap<0),g=Math.abs(2*o.wrap)-+(o.wrap<0);return m.overscaledZ-o.overscaledZ||g-d||o.canonical.y-m.canonical.y||o.canonical.x-m.canonical.x}function wl(m){return m==="raster"||m==="image"||m==="video"||m==="custom"}function La(m,o){const d=1<<m.z;return[m.x/d+o,(m.x+1)/d+o]}ho.maxOverzooming=10,ho.maxUnderzooming=3;class sh{constructor(o){this.style=o,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const o=!1,d=!1;for(const g in this.style._mergedLayers){const S=this.style._mergedLayers[g];if(S.type==="fill-extrusion")this.layers.push({layer:S,visible:o,visibilityChanged:d});else if(S.type==="model"){const C=this.style.getLayerSource(S);C&&C.type==="batched-model"&&this.layers.push({layer:S,visible:o,visibilityChanged:d})}}}onNewFrame(o){this.layersGotHidden=!1;for(const d of this.layers){const g=d.layer;let S=!1;g.type==="fill-extrusion"?S=!g.isHidden(o)&&g.paint.get("fill-extrusion-opacity")>0:g.type==="model"&&(S=!g.isHidden(o)&&g.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!S&&d.visible,d.visible=S}}updateZOffset(o,d){this.currentBuildingBuckets=[];for(const S of this.layers){const C=S.layer,M=this.style.getLayerSourceCache(C);let L=1;C.type==="fill-extrusion"&&(L=S.visible?C.paint.get("fill-extrusion-vertical-scale"):0);let B=M?M.getTile(d):null;if(!B&&M&&d.canonical.z>M.getSource().minzoom){let q=d.scaledTo(Math.min(M.getSource().maxzoom,d.overscaledZ-1));for(;q.overscaledZ>=M.getSource().minzoom&&(B=M.getTile(q),!B&&q.overscaledZ!==0);)q=q.scaledTo(q.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:B?B.getBucket(C):null,tileID:B?B.tileID:d,verticalScale:L})}o.hasAnyZOffset=!1;let g=!1;for(let S=0;S<o.symbolInstances.length;S++){const C=o.symbolInstances.get(S),M=C.zOffset,L=this._getHeightAtTileOffset(d,C.tileAnchorX,C.tileAnchorY);C.zOffset=L!==Number.NEGATIVE_INFINITY?L:M,g||M===C.zOffset||(g=!0),o.hasAnyZOffset||C.zOffset===0||(o.hasAnyZOffset=!0)}g&&(o.zOffsetBuffersNeedUpload=!0,o.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(o,d,g,S){let C=d,M=g;if(o.canonical.z!==S.canonical.z){const L=S.canonical,B=1/(1<<o.canonical.z-L.z);C=(d+o.canonical.x*i.aj)*B-L.x*i.aj|0,M=(g+o.canonical.y*i.aj)*B-L.y*i.aj|0}return{tileX:C,tileY:M}}_getHeightAtTileOffset(o,d,g){let S,C;for(let M=0;M<this.layers.length;++M){if(this.layers[M].layer.type!=="fill-extrusion")continue;const{bucket:L,tileID:B,verticalScale:q}=this.currentBuildingBuckets[M];if(!L)continue;const{tileX:X,tileY:ee}=this._mapCoordToOverlappingTile(o,d,g,B),Q=L.getHeightAtTileCoord(X,ee);Q&&Q.height!==void 0&&(Q.hidden?S=Q.height:C=Math.max(Q.height*q,C||0))}if(C!==void 0)return C;for(let M=0;M<this.layers.length;++M){const L=this.layers[M];if(L.layer.type!=="model"||!L.visible)continue;const{bucket:B,tileID:q}=this.currentBuildingBuckets[M];if(!B)continue;const{tileX:X,tileY:ee}=this._mapCoordToOverlappingTile(o,d,g,q),Q=B.getHeightAtTileCoord(X,ee);if(Q&&!Q.hidden)return Q.height===void 0&&S!==void 0?Math.min(Q.maxHeight,S)*Q.verticalScale:Q.height?Q.height*Q.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function hu(m,o){const d={};for(const g in m)g!=="ref"&&(d[g]=m[g]);return i.bu.forEach(g=>{g in o&&(d[g]=o[g])}),d}function Sl(m){m=m.slice();const o=Object.create(null);for(let d=0;d<m.length;d++)o[m[d].id]=m[d];for(let d=0;d<m.length;d++)"ref"in m[d]&&(m[d]=hu(m[d],o[m[d].ref]));return m}const Un={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function od(m,o,d){d.push({command:Un.addSource,args:[m,o[m]]})}function ql(m,o,d){o.push({command:Un.removeSource,args:[m]}),d[m]=!0}function q_(m,o,d,g){ql(m,d,g),od(m,o,d)}function og(m,o,d){let g;for(g in m[d])if(m[d].hasOwnProperty(g)&&g!=="data"&&!i.bv(m[d][g],o[d][g]))return!1;for(g in o[d])if(o[d].hasOwnProperty(g)&&g!=="data"&&!i.bv(m[d][g],o[d][g]))return!1;return!0}function Gl(m,o,d,g,S,C){let M;for(M in o=o||{},m=m||{})m.hasOwnProperty(M)&&(i.bv(m[M],o[M])||d.push({command:C,args:[g,M,o[M],S]}));for(M in o)o.hasOwnProperty(M)&&!m.hasOwnProperty(M)&&(i.bv(m[M],o[M])||d.push({command:C,args:[g,M,o[M],S]}))}function Ic(m){return m.id}function oh(m,o){return m[o.id]=o,m}class ah{constructor(o,d){this.reset(o,d)}reset(o,d){this.points=o||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=i.aD(o,0,1);let d=1,g=this._distances[d];const S=o*this.paddedLength+this.padding;for(;g<S&&d<this._distances.length;)g=this._distances[++d];const C=d-1,M=this._distances[C],L=g-M,B=L>0?(S-M)/L:0;return this.points[C].mult(1-B).add(this.points[d].mult(B))}}class ad{constructor(o,d,g){const S=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(o/g),this.yCellCount=Math.ceil(d/g);for(let M=0;M<this.xCellCount*this.yCellCount;M++)S.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=d,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,d,g,S,C){this._forEachCell(d,g,S,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(S),this.bboxes.push(C)}insertCircle(o,d,g,S){this._forEachCell(d-S,g-S,d+S,g+S,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(d),this.circles.push(g),this.circles.push(S)}_insertBoxCell(o,d,g,S,C,M){this.boxCells[C].push(M)}_insertCircleCell(o,d,g,S,C,M){this.circleCells[C].push(M)}_query(o,d,g,S,C,M){if(g<0||o>this.width||S<0||d>this.height)return!C&&[];const L=[];if(o<=0&&d<=0&&this.width<=g&&this.height<=S){if(C)return!0;for(let B=0;B<this.boxKeys.length;B++)L.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(let B=0;B<this.circleKeys.length;B++){const q=this.circles[3*B],X=this.circles[3*B+1],ee=this.circles[3*B+2];L.push({key:this.circleKeys[B],x1:q-ee,y1:X-ee,x2:q+ee,y2:X+ee})}return M?L.filter(M):L}return this._forEachCell(o,d,g,S,this._queryCell,L,{hitTest:C,seenUids:{box:{},circle:{}}},M),C?L.length>0:L}_queryCircle(o,d,g,S,C){const M=o-g,L=o+g,B=d-g,q=d+g;if(L<0||M>this.width||q<0||B>this.height)return!S&&[];const X=[];return this._forEachCell(M,B,L,q,this._queryCellCircle,X,{hitTest:S,circle:{x:o,y:d,radius:g},seenUids:{box:{},circle:{}}},C),S?X.length>0:X}query(o,d,g,S,C){return this._query(o,d,g,S,!1,C)}hitTest(o,d,g,S,C){return this._query(o,d,g,S,!0,C)}hitTestCircle(o,d,g,S){return this._queryCircle(o,d,g,!0,S)}_queryCell(o,d,g,S,C,M,L,B){const q=L.seenUids,X=this.boxCells[C];if(X!==null){const Q=this.bboxes;for(const ne of X)if(!q.box[ne]){q.box[ne]=!0;const fe=4*ne;if(o<=Q[fe+2]&&d<=Q[fe+3]&&g>=Q[fe+0]&&S>=Q[fe+1]&&(!B||B(this.boxKeys[ne]))){if(L.hitTest)return M.push(!0),!0;M.push({key:this.boxKeys[ne],x1:Q[fe],y1:Q[fe+1],x2:Q[fe+2],y2:Q[fe+3]})}}}const ee=this.circleCells[C];if(ee!==null){const Q=this.circles;for(const ne of ee)if(!q.circle[ne]){q.circle[ne]=!0;const fe=3*ne;if(this._circleAndRectCollide(Q[fe],Q[fe+1],Q[fe+2],o,d,g,S)&&(!B||B(this.circleKeys[ne]))){if(L.hitTest)return M.push(!0),!0;{const de=Q[fe],ye=Q[fe+1],he=Q[fe+2];M.push({key:this.circleKeys[ne],x1:de-he,y1:ye-he,x2:de+he,y2:ye+he})}}}}}_queryCellCircle(o,d,g,S,C,M,L,B){const q=L.circle,X=L.seenUids,ee=this.boxCells[C];if(ee!==null){const ne=this.bboxes;for(const fe of ee)if(!X.box[fe]){X.box[fe]=!0;const de=4*fe;if(this._circleAndRectCollide(q.x,q.y,q.radius,ne[de+0],ne[de+1],ne[de+2],ne[de+3])&&(!B||B(this.boxKeys[fe])))return M.push(!0),!0}}const Q=this.circleCells[C];if(Q!==null){const ne=this.circles;for(const fe of Q)if(!X.circle[fe]){X.circle[fe]=!0;const de=3*fe;if(this._circlesCollide(ne[de],ne[de+1],ne[de+2],q.x,q.y,q.radius)&&(!B||B(this.circleKeys[fe])))return M.push(!0),!0}}}_forEachCell(o,d,g,S,C,M,L,B){const q=this._convertToXCellCoord(o),X=this._convertToYCellCoord(d),ee=this._convertToXCellCoord(g),Q=this._convertToYCellCoord(S);for(let ne=q;ne<=ee;ne++)for(let fe=X;fe<=Q;fe++)if(C.call(this,o,d,g,S,this.xCellCount*fe+ne,M,L,B))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,d,g,S,C,M){const L=S-o,B=C-d,q=g+M;return q*q>L*L+B*B}_circleAndRectCollide(o,d,g,S,C,M,L){const B=(M-S)/2,q=Math.abs(o-(S+B));if(q>B+g)return!1;const X=(L-C)/2,ee=Math.abs(d-(C+X));if(ee>X+g)return!1;if(q<=B||ee<=X)return!0;const Q=q-B,ne=ee-X;return Q*Q+ne*ne<=g*g}}const Ja={unknown:0,flipRequired:1,flipNotRequired:2},fu=Math.tan(85*Math.PI/180);function lh(m,o,d,g,S,C,M){const L=i.bz();if(d)if(C.name==="globe"){const B=i.bA(S,o);i.az(L,L,B)}else{const B=i.bB([],M);L[0]=B[0],L[1]=B[1],L[4]=B[2],L[5]=B[3],g||i.by(L,L,S.angle)}else i.az(L,S.labelPlaneMatrix,m);return L}function Lp(m,o,d,g,S,C,M){const L=lh(m,o,d,g,S,C,M);return C.name==="globe"&&d||(L[2]=L[6]=L[10]=L[14]=0),L}function _f(m,o,d,g,S,C,M){if(d){if(C.name==="globe"){const L=lh(m,o,d,g,S,C,M);return i.bi(L,L),i.az(L,m,L),L}{const L=i.bw(m),B=i.bx([]);return B[0]=M[0],B[1]=M[1],B[4]=M[2],B[5]=M[3],i.az(L,L,B),g||i.by(L,L,-S.angle),L}}return S.glCoordMatrix}function ko(m,o,d,g){const S=[m,o,d,1];d?i.aA(S,S,g):cd(S,S,g);const C=S[3];return S[0]/=C,S[1]/=C,S[2]/=C,S}function Hl(m,o){return Math.min(.5+m/o*.5,1.5)}function Rp(m,o){const d=m[0]/m[3],g=m[1]/m[3];return d>=-o[0]&&d<=o[0]&&g>=-o[1]&&g<=o[1]}function Wl(m,o,d,g,S,C,M,L,B,q){const X=d.transform,ee=g?m.textSizeData:m.iconSizeData,Q=i.bH(ee,d.transform.zoom),ne=X.projection.name==="globe",fe=[256/d.width*2+1,256/d.height*2+1],de=g?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;de.clear();let ye=null;ne&&(ye=g?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const he=m.lineVertexArray,Se=g?m.text.placedSymbolArray:m.icon.placedSymbolArray,Ae=d.transform.width/d.transform.height;let Pe,Be=!1;for(let Fe=0;Fe<Se.length;Fe++){const je=Se.get(Fe),{numGlyphs:ke,writingMode:qe}=je;if(qe!==i.bI.vertical||Be||Pe===i.bI.horizontal||(Be=!0),Pe=qe,(je.hidden||qe===i.bI.vertical)&&!Be){Pn(ke,de);continue}Be=!1;const Ze=new i.P(je.tileAnchorX,je.tileAnchorY);let{x:yt,y:ut,z:At}=X.projection.projectTilePoint(Ze.x,Ze.y,q.canonical);if(B){const[wr,Ar,dr]=B(Ze);yt+=wr,ut+=Ar,At+=dr}const Mt=[yt,ut,At,1];if(i.aA(Mt,Mt,o),!Rp(Mt,fe)){Pn(ke,de);continue}const Zt=Mt[3],at=Hl(d.transform.getCameraToCenterDistance(X.projection),Zt),gt=i.bJ(ee,Q,je),ot=M?gt/at:gt*at,Lt=ko(yt,ut,At,S);if(Lt[3]<=0){Pn(ke,de);continue}let vt={};const zt=i.al(m.layers[0].layout.get("text-max-angle")),Ot=Math.cos(zt),$t=M?null:B,Ut=la(je,ot,!1,L,o,S,C,m.glyphOffsetArray,he,de,ye,Lt,Ze,vt,Ae,$t,X.projection,q,M,Ot);Be=Ut.useVertical,$t&&Ut.needsFlipping&&(vt={}),(Ut.notEnoughRoom||Be||Ut.needsFlipping&&la(je,ot,!0,L,o,S,C,m.glyphOffsetArray,he,de,ye,Lt,Ze,vt,Ae,$t,X.projection,q,M,Ot).notEnoughRoom)&&Pn(ke,de)}g?(m.text.dynamicLayoutVertexBuffer.updateData(de),ye&&m.text.globeExtVertexBuffer&&m.text.globeExtVertexBuffer.updateData(ye)):(m.icon.dynamicLayoutVertexBuffer.updateData(de),ye&&m.icon.globeExtVertexBuffer&&m.icon.globeExtVertexBuffer.updateData(ye))}function ch(m,o,d,g,S,C,M,L,B,q,X,ee,Q,ne,fe,de,ye){const{lineStartIndex:he,glyphStartIndex:Se,segment:Ae}=L,Pe=Se+L.numGlyphs,Be=he+L.lineLength,Fe=o.getoffsetX(Se),je=o.getoffsetX(Pe-1),ke=dh(m*Fe,d,g,S,C,M,Ae,he,Be,B,q,X,ee,Q,!0,ne,fe,de,ye);if(!ke)return null;const qe=dh(m*je,d,g,S,C,M,Ae,he,Be,B,q,X,ee,Q,!0,ne,fe,de,ye);return qe?{first:ke,last:qe}:null}function Zl(m,o,d,g){return m===i.bI.horizontal&&Math.abs(g)>Math.abs(d)?{useVertical:!0}:m===i.bI.vertical?g>0?{needsFlipping:!0}:null:o!==Ja.unknown&&function(S,C){return S===0||Math.abs(C/S)>fu}(d,g)?o===Ja.flipRequired?{needsFlipping:!0}:null:d<0?{needsFlipping:!0}:null}function la(m,o,d,g,S,C,M,L,B,q,X,ee,Q,ne,fe,de,ye,he,Se,Ae){const Pe=o/24,Be=m.lineOffsetX*Pe,Fe=m.lineOffsetY*Pe,{lineStartIndex:je,glyphStartIndex:ke,numGlyphs:qe,segment:Ze,writingMode:yt,flipState:ut}=m,At=je+m.lineLength,Mt=Zt=>{if(X){const[Lt,vt,zt]=Zt.up,Ot=q.length;i.bK(X,Ot+0,Lt,vt,zt),i.bK(X,Ot+1,Lt,vt,zt),i.bK(X,Ot+2,Lt,vt,zt),i.bK(X,Ot+3,Lt,vt,zt)}const[at,gt,ot]=Zt.point;i.bL(q,at,gt,ot,Zt.angle)};if(qe>1){const Zt=ch(Pe,L,Be,Fe,d,ee,Q,m,B,C,ne,de,!1,ye,he,Se,Ae);if(!Zt)return{notEnoughRoom:!0};if(g&&!d){let[at,gt,ot]=Zt.first.point,[Lt,vt,zt]=Zt.last.point;[at,gt]=ko(at,gt,ot,M),[Lt,vt]=ko(Lt,vt,zt,M);const Ot=Zl(yt,ut,(Lt-at)*fe,vt-gt);if(m.flipState=Ot&&Ot.needsFlipping?Ja.flipRequired:Ja.flipNotRequired,Ot)return Ot}Mt(Zt.first);for(let at=ke+1;at<ke+qe-1;at++){const gt=dh(Pe*L.getoffsetX(at),Be,Fe,d,ee,Q,Ze,je,At,B,C,ne,de,!1,!1,ye,he,Se,Ae);if(!gt)return q.length-=4*(at-ke),{notEnoughRoom:!0};Mt(gt)}Mt(Zt.last)}else{if(g&&!d){const at=ko(Q.x,Q.y,0,S),gt=je+Ze+1,ot=new i.P(B.getx(gt),B.gety(gt)),Lt=ko(ot.x,ot.y,0,S),vt=Lt[3]>0?Lt:ld(Q,ot,at,1,S,void 0,ye,he.canonical),zt=Zl(yt,ut,(vt[0]-at[0])*fe,vt[1]-at[1]);if(m.flipState=zt&&zt.needsFlipping?Ja.flipRequired:Ja.flipNotRequired,zt)return zt}const Zt=dh(Pe*L.getoffsetX(ke),Be,Fe,d,ee,Q,Ze,je,At,B,C,ne,de,!1,!1,ye,he,Se,Ae);if(!Zt)return{notEnoughRoom:!0};Mt(Zt)}return{}}function uh(m,o,d,g,S){const{x:C,y:M,z:L}=g.projectTilePoint(m.x,m.y,o);if(!S)return ko(C,M,L,d);const[B,q,X]=S(m);return ko(C+B,M+q,L+X,d)}function ld(m,o,d,g,S,C,M,L){const B=uh(m.sub(o)._unit()._add(m),L,S,M,C);return i.at(B,d,B),i.au(B,B),i.bF(B,d,B,g)}function dh(m,o,d,g,S,C,M,L,B,q,X,ee,Q,ne,fe,de,ye,he,Se){const Ae=g?m-o:m+o;let Pe=Ae>0?1:-1,Be=0;g&&(Pe*=-1,Be=Math.PI),Pe<0&&(Be+=Math.PI);let Fe=L+M+(Pe>0?0:1)|0,je=S,ke=S,qe=0,Ze=0;const yt=Math.abs(Ae),ut=[],At=[];let Mt=C,Zt=Mt,at=i.bC([]);const gt=()=>ld(Zt,Mt,ke,yt-qe+1,X,Q,de,ye.canonical);for(;qe+Ze<=yt;){if(Fe+=Pe,Fe<L||Fe>=B)return null;if(ke=je,Zt=Mt,ut.push(ke),ne&&At.push(Zt),Mt=new i.P(q.getx(Fe),q.gety(Fe)),je=ee[Fe],!je){const dr=uh(Mt,ye.canonical,X,de,Q);je=dr[3]>0?ee[Fe]=dr:gt()}qe+=Ze;const wr=i.at([],je,ke),Ar=i.bD(ke,je);if(d&&Ar>0&&Ze>0&&i.bE(at,wr)/(Ze*Ar)<Se)return null;Ze=Ar,at=wr}fe&&Q&&(ee[Fe]&&(je=gt(),Ze=i.bD(ke,je),at=i.at([],je,ke)),ee[Fe]=je);const ot=(yt-qe)/Ze,Lt=Mt.sub(Zt)._mult(ot)._add(Zt),vt=i.bF([],ke,at,ot);let zt=[0,0,1],Ot=at[0],$t=at[1];if(he&&(zt=de.upVector(ye.canonical,Lt.x,Lt.y),zt[0]!==0||zt[1]!==0||zt[2]!==1)){const wr=[zt[2],0,-zt[0]],Ar=i.bG([],zt,wr);i.au(wr,wr),i.au(Ar,Ar),Ot=i.bE(at,wr),$t=i.bE(at,Ar)}if(d){const wr=i.bG([],zt,at);i.au(wr,wr),i.bF(vt,vt,wr,d*Pe)}const Ut=Be+Math.atan2($t,Ot);return ut.push(vt),ne&&At.push(Lt),{point:vt,angle:Ut,path:ut,tilePath:At,up:zt}}function Pn(m,o){const d=o.length,g=d+4*m;o.resize(g),o.float32.fill(-1/0,4*d,4*g)}function cd(m,o,d){const g=o[0],S=o[1];return m[0]=d[0]*g+d[4]*S+d[12],m[1]=d[1]*g+d[5]*S+d[13],m[3]=d[3]*g+d[7]*S+d[15],m}const Br=100;class hh{constructor(o,d,g=new ad(o.width+200,o.height+200,25),S=new ad(o.width+200,o.height+200,25)){this.transform=o,this.grid=g,this.ignoredGrid=S,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+Br,this.screenBottomBoundary=o.height+Br,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=d}placeCollisionBox(o,d,g,S,C,M,L,B){let q=g.projectedAnchorX,X=g.projectedAnchorY,ee=g.projectedAnchorZ;const Q=g.elevation,ne=g.tileID,fe=o.getProjection();if(Q&&ne){const[Fe,je,ke]=fe.upVector(ne.canonical,g.tileAnchorX,g.tileAnchorY),qe=fe.upVectorScale(ne.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;q+=Fe*Q*qe,X+=je*Q*qe,ee+=ke*Q*qe}const de=this.projectAndGetPerspectiveRatio(L,q,X,ee,g.tileID,fe.name==="globe"||!!Q||this.transform.pitch>0,fe),ye=M*de.perspectiveRatio,he=(g.x1*d+S.x-g.padding)*ye+de.point.x,Se=(g.y1*d+S.y-g.padding)*ye+de.point.y,Ae=(g.x2*d+S.x+g.padding)*ye+de.point.x,Pe=(g.y2*d+S.y+g.padding)*ye+de.point.y,Be=de.perspectiveRatio<=.55||de.occluded;return!this.isInsideGrid(he,Se,Ae,Pe)||!C&&this.grid.hitTest(he,Se,Ae,Pe,B)||Be?{box:[],offscreen:!1,occluded:de.occluded}:{box:[he,Se,Ae,Pe],offscreen:this.isOffscreen(he,Se,Ae,Pe),occluded:!1}}placeCollisionCircles(o,d,g,S,C,M,L,B,q,X,ee,Q,ne,fe,de){const ye=[],he=this.transform.elevation,Se=o.getProjection(),Ae=he?he.getAtTileOffsetFunc(de,this.transform.center.lat,this.transform.worldSize,Se):null,Pe=new i.P(g.tileAnchorX,g.tileAnchorY);let{x:Be,y:Fe,z:je}=Se.projectTilePoint(Pe.x,Pe.y,de.canonical);if(Ae){const[zt,Ot,$t]=Ae(Pe);Be+=zt,Fe+=Ot,je+=$t}const ke=Se.name==="globe",qe=this.projectAndGetPerspectiveRatio(L,Be,Fe,je,de,ke||!!he||this.transform.pitch>0,Se),{perspectiveRatio:Ze}=qe,yt=(ee?M/Ze:M*Ze)/i.bO,ut=ko(Be,Fe,je,B),At=g.lineOffsetX*yt,Mt=g.lineOffsetY*yt,Zt=i.al(o.layers[0].layout.get("text-max-angle")),at=Math.cos(Zt),gt=qe.signedDistanceFromCamera>0?ch(yt,C,At,Mt,!1,ut,Pe,g,S,B,{},he&&!ee?Ae:null,ee&&!!he,Se,de,ee,at):null;let ot=!1,Lt=!1,vt=!0;if(gt&&!qe.occluded){const zt=.5*ne*Ze+fe,Ot=new i.P(-100,-100),$t=new i.P(this.screenRightBoundary,this.screenBottomBoundary),Ut=new ah,{first:wr,last:Ar}=gt,dr=wr.path.length;let Cr=[];for(let Qr=dr-1;Qr>=1;Qr--)Cr.push(wr.path[Qr]);for(let Qr=1;Qr<Ar.path.length;Qr++)Cr.push(Ar.path[Qr]);const vr=2.5*zt;q&&(Cr=Cr.map(([Qr,_n,ii],si)=>(Ae&&!ke&&(ii=Ae(si<dr-1?wr.tilePath[dr-1-si]:Ar.tilePath[si-dr+2])[2]),ko(Qr,_n,ii,q))),Cr.some(Qr=>Qr[3]<=0)&&(Cr=[]));let jr=[];if(Cr.length>0){let Qr=1/0,_n=-1/0,ii=1/0,si=-1/0;for(const fn of Cr)Qr=Math.min(Qr,fn[0]),ii=Math.min(ii,fn[1]),_n=Math.max(_n,fn[0]),si=Math.max(si,fn[1]);_n>=Ot.x&&Qr<=$t.x&&si>=Ot.y&&ii<=$t.y&&(jr=[Cr.map(fn=>new i.P(fn[0],fn[1]))],(Qr<Ot.x||_n>$t.x||ii<Ot.y||si>$t.y)&&(jr=i.bM(jr,Ot.x,Ot.y,$t.x,$t.y)))}for(const Qr of jr){Ut.reset(Qr,.25*zt);let _n=0;_n=Ut.length<=.5*zt?1:Math.ceil(Ut.paddedLength/vr)+1;for(let ii=0;ii<_n;ii++){const si=ii/Math.max(_n-1,1),fn=Ut.lerp(si),Gi=fn.x+Br,Pi=fn.y+Br;ye.push(Gi,Pi,zt,0);const en=Gi-zt,kn=Pi-zt,On=Gi+zt,oi=Pi+zt;if(vt=vt&&this.isOffscreen(en,kn,On,oi),Lt=Lt||this.isInsideGrid(en,kn,On,oi),!d&&this.grid.hitTestCircle(Gi,Pi,zt,Q)&&(ot=!0,!X))return{circles:[],offscreen:!1,collisionDetected:ot,occluded:!1}}}}return{circles:!X&&ot||!Lt?[]:ye,offscreen:vt,collisionDetected:ot,occluded:qe.occluded}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let g=1/0,S=1/0,C=-1/0,M=-1/0;for(const X of o){const ee=new i.P(X.x+Br,X.y+Br);g=Math.min(g,ee.x),S=Math.min(S,ee.y),C=Math.max(C,ee.x),M=Math.max(M,ee.y),d.push(ee)}const L=this.grid.query(g,S,C,M).concat(this.ignoredGrid.query(g,S,C,M)),B={},q={};for(const X of L){const ee=X.key;if(B[ee.bucketInstanceId]===void 0&&(B[ee.bucketInstanceId]={}),B[ee.bucketInstanceId][ee.featureIndex])continue;const Q=[new i.P(X.x1,X.y1),new i.P(X.x2,X.y1),new i.P(X.x2,X.y2),new i.P(X.x1,X.y2)];i.bN(d,Q)&&(B[ee.bucketInstanceId][ee.featureIndex]=!0,q[ee.bucketInstanceId]===void 0&&(q[ee.bucketInstanceId]=[]),q[ee.bucketInstanceId].push(ee.featureIndex))}return q}insertCollisionBox(o,d,g,S,C){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:S,collisionGroupID:C},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,d,g,S,C){const M=d?this.ignoredGrid:this.grid,L={bucketInstanceId:g,featureIndex:S,collisionGroupID:C};for(let B=0;B<o.length;B+=4)M.insertCircle(L,o[B],o[B+1],o[B+2])}projectAndGetPerspectiveRatio(o,d,g,S,C,M,L){const B=[d,g,S,1];let q=!1;S||this.transform.pitch>0?(i.aA(B,B,o),this.fogState&&C&&L.name!=="globe"&&(q=function(Q,ne,fe,de,ye,he){const Se=he.calculateFogTileMatrix(ye),Ae=[ne,fe,de];return i.ad(Ae,Ae,Se),gr(Q,i.ae(Ae),he.pitch,he._fov)}(this.fogState,d,g,S,C.toUnwrapped(),this.transform)>.9)):cd(B,B,o);const X=B[3];return{point:new i.P((B[0]/X+1)/2*this.transform.width+Br,(-B[1]/X+1)/2*this.transform.height+Br),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(L)/X*.5,1.5),signedDistanceFromCamera:X,occluded:M&&B[2]>X||q}}isOffscreen(o,d,g,S){return g<Br||o>=this.screenRightBoundary||S<Br||d>this.screenBottomBoundary}isInsideGrid(o,d,g,S){return g>=0&&o<this.gridRightBoundary&&S>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const o=i.bx([]);return i.bo(o,o,[-100,-100,0]),o}}function jp(m,o,d){const g=o.createTileMatrix(m,m.worldSize,d.toUnwrapped());return i.az(new Float32Array(16),m.projMatrix,g)}function fh(m,o,d){if(o.projection.name===d.projection.name)return m.projMatrix;const g=d.clone();return g.setProjection(o.projection),jp(g,o.getProjection(),m)}function ud(m,o,d){return o.name===d.projection.name?m.projMatrix:jp(d,o,m)}class Zo{constructor(o,d,g,S){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?d:-d))):S&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class Xl{constructor(o,d,g,S,C,M=!1){this.text=new Zo(o?o.text:null,d,g,C),this.icon=new Zo(o?o.icon:null,d,S,C),this.clipped=M}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class kc{constructor(o,d,g,S=!1){this.text=o,this.icon=d,this.skipFade=g,this.clipped=S}}class Rr{constructor(){this.invProjMatrix=i.bz(),this.viewportMatrix=i.bz(),this.circles=[]}}class hi{constructor(o,d,g,S,C){this.bucketInstanceId=o,this.featureIndex=d,this.sourceLayerIndex=g,this.bucketIndex=S,this.tileID=C}}class ri{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const d=++this.maxGroupID;this.collisionGroups[o]={ID:d,predicate:g=>g.collisionGroupID===d}}return this.collisionGroups[o]}}function Oo(m,o,d,g,S){const{horizontalAlign:C,verticalAlign:M}=i.bV(m),L=-(C-.5)*o,B=-(M-.5)*d,q=i.bU(m,g);return new i.P(L+q[0]*S,B+q[1]*S)}function pu(m,o,d,g,S){const C=new i.P(m,o);return d&&C._rotate(g?S:-S),C}class ei{constructor(o,d,g,S,C,M){this.transform=o.clone(),this.projection=o.projection.name,this.collisionIndex=new hh(this.transform,C),this.buildingIndex=M,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new ri(g),this.collisionCircleArrays={},this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,d,g,S,C=1){const M=g.getBucket(d),L=g.latestFeatureIndex;if(!M||!L||d.fqid!==M.layerIds[0])return;const B=M.layers[0].layout,q=M.layers[0].paint,X=g.collisionBoxArray,ee=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),Q=g.tileSize/i.aj,ne=g.tileID.toUnwrapped();this.transform.setProjection(M.projection);const fe=(de=g.tileID,ye=M.getProjection(),he=this.transform,ye.name===this.projection?he.calculateProjMatrix(de.toUnwrapped()):jp(he,ye,de));var de,ye,he;const Se=B.get("text-pitch-alignment")==="map",Ae=B.get("text-rotation-alignment")==="map";d.compileFilter(d.options);const Pe=d.dynamicFilter(),Be=d.dynamicFilterNeedsFeature(),Fe=this.transform.calculatePixelsToTileUnitsMatrix(g),je=Lp(fe,g.tileID.canonical,Se,Ae,this.transform,M.getProjection(),Fe);let ke=null;if(Se){const gt=_f(fe,g.tileID.canonical,Se,Ae,this.transform,M.getProjection(),Fe);ke=i.az([],this.transform.labelPlaneMatrix,gt)}let qe=null;Pe&&g.latestFeatureIndex&&(qe={unwrappedTileID:ne,dynamicFilter:Pe,dynamicFilterNeedsFeature:Be}),this.retainedQueryData[M.bucketInstanceId]=new hi(M.bucketInstanceId,L,M.sourceLayerIndex,M.index,g.tileID);const[Ze,yt]=M.layers[0].layout.get("text-size-scale-range"),ut=i.aD(C,Ze,yt),[At,Mt]=B.get("icon-size-scale-range"),Zt=i.aD(C,At,Mt),at={bucket:M,layout:B,paint:q,posMatrix:fe,textLabelPlaneMatrix:je,labelToScreenMatrix:ke,clippingData:qe,scale:ee,textPixelRatio:Q,holdingForFade:g.holdingForFade(),collisionBoxArray:X,partiallyEvaluatedTextSize:i.bH(M.textSizeData,this.transform.zoom,ut),partiallyEvaluatedIconSize:i.bH(M.iconSizeData,this.transform.zoom,Zt),collisionGroup:this.collisionGroups.get(M.sourceID),latestFeatureIndex:g.latestFeatureIndex};if(S)for(const gt of M.sortKeyRanges){const{sortKey:ot,symbolInstanceStart:Lt,symbolInstanceEnd:vt}=gt;o.push({sortKey:ot,symbolInstanceStart:Lt,symbolInstanceEnd:vt,parameters:at})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:M.symbolInstances.length,parameters:at})}attemptAnchorPlacement(o,d,g,S,C,M,L,B,q,X,ee,Q,ne,fe,de,ye,he,Se){const{textOffset0:Ae,textOffset1:Pe,crossTileID:Be}=Q,Fe=[Ae,Pe],je=Oo(o,g,S,Fe,C),ke=this.collisionIndex.placeCollisionBox(fe,C,d,pu(je.x,je.y,M,L,this.transform.angle),ee,B,q,X.predicate);if(ye){const qe=fe.getSymbolInstanceIconSize(Se,this.transform.zoom,Q.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(fe,qe,ye,pu(je.x,je.y,M,L,this.transform.angle),ee,B,q,X.predicate).box.length===0)return}if(ke.box.length>0){let qe;return this.prevPlacement&&this.prevPlacement.variableOffsets[Be]&&this.prevPlacement.placements[Be]&&this.prevPlacement.placements[Be].text&&(qe=this.prevPlacement.variableOffsets[Be].anchor),this.variableOffsets[Be]={textOffset:Fe,width:g,height:S,anchor:o,textScale:C,prevAnchor:qe},this.markUsedJustification(fe,o,Q,de),fe.allowVerticalPlacement&&(this.markUsedOrientation(fe,de,Q),this.placedOrientations[Be]=de),{shift:je,placedGlyphBoxes:ke}}}placeLayerBucketPart(o,d,g,S,C=1){const{bucket:M,layout:L,paint:B,posMatrix:q,textLabelPlaneMatrix:X,labelToScreenMatrix:ee,clippingData:Q,textPixelRatio:ne,holdingForFade:fe,collisionBoxArray:de,partiallyEvaluatedTextSize:ye,partiallyEvaluatedIconSize:he,collisionGroup:Se,latestFeatureIndex:Ae}=o.parameters,Pe=L.get("text-optional"),Be=L.get("icon-optional"),Fe=L.get("text-allow-overlap"),je=L.get("icon-allow-overlap"),ke=L.get("text-rotation-alignment")==="map",qe=L.get("text-pitch-alignment")==="map",Ze=B.get("symbol-z-offset"),yt=L.get("symbol-elevation-reference")==="sea",[ut,At]=L.get("text-size-scale-range"),[Mt,Zt]=L.get("icon-size-scale-range"),at=i.aD(C,ut,At),gt=i.aD(C,Mt,Zt);this.transform.setProjection(M.projection);let ot=Fe&&(je||!M.hasIconData()||Be),Lt=je&&(Fe||!M.hasTextData()||Pe);const vt=!Ze.isConstant();!M.collisionArrays&&de&&M.deserializeCollisionBoxes(de),g&&S&&M.updateCollisionDebugBuffers(this.transform.zoom,de,at,gt);const zt=(Ot,$t,Ut)=>{const{crossTileID:wr,numVerticalGlyphVertices:Ar}=Ot;let dr=null;if(Q&&Q.dynamicFilterNeedsFeature||vt){const zn=this.retainedQueryData[M.bucketInstanceId];dr=Ae.loadFeature({featureIndex:Ot.featureIndex,bucketIndex:zn.bucketIndex,sourceLayerIndex:zn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(Q&&!(0,Q.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},dr,this.retainedQueryData[M.bucketInstanceId].tileID.canonical,new i.P(Ot.tileAnchorX,Ot.tileAnchorY),this.transform.calculateDistanceTileData(Q.unwrappedTileID)))return this.placements[wr]=new kc(!1,!1,!1,!0),void d.add(wr);const Cr=Ze.evaluate(dr,{});if(d.has(wr))return;if(fe)return void(this.placements[wr]=new kc(!1,!1,!1));let vr=!1,jr=!1,Qr=!0,_n=!1,ii=!1,si=null,fn={box:null,offscreen:null,occluded:null},Gi={box:null},Pi=null,en=null,kn=null,On=0,oi=0,Ss=0;Ut.textFeatureIndex?On=Ut.textFeatureIndex:Ot.useRuntimeCollisionCircles&&(On=Ot.featureIndex),Ut.verticalTextFeatureIndex&&(oi=Ut.verticalTextFeatureIndex);const Hi=zn=>{zn.tileID=this.retainedQueryData[M.bucketInstanceId].tileID;const ci=this.transform.elevation;zn.elevation=yt?Cr:Cr+(ci?ci.getAtTileOffset(zn.tileID,zn.tileAnchorX,zn.tileAnchorY):0),zn.elevation+=Ot.zOffset},os=Ut.textBox;if(os){Hi(os);const zn=Zn=>{let pi=i.bI.horizontal;if(M.allowVerticalPlacement&&!Zn&&this.prevPlacement){const Vs=this.prevPlacement.placedOrientations[wr];Vs&&(this.placedOrientations[wr]=Vs,pi=Vs,this.markUsedOrientation(M,pi,Ot))}return pi},ci=(Zn,pi)=>{if(M.allowVerticalPlacement&&Ar>0&&Ut.verticalTextBox){for(const Vs of M.writingModes)if(Vs===i.bI.vertical?(fn=pi(),Gi=fn):fn=Zn(),fn&&fn.box&&fn.box.length)break}else fn=Zn()};if(L.get("text-variable-anchor")){let Zn=L.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[wr]){const Mn=this.prevPlacement.variableOffsets[wr];Zn.indexOf(Mn.anchor)>0&&(Zn=Zn.filter(oo=>oo!==Mn.anchor),Zn.unshift(Mn.anchor))}const pi=(Mn,oo,ds)=>{const yo=M.getSymbolInstanceTextSize(ye,Ot,this.transform.zoom,$t),Ll=(Mn.x2-Mn.x1)*yo+2*Mn.padding,fc=(Mn.y2-Mn.y1)*yo+2*Mn.padding,ma=Ot.hasIconTextFit&&!je?oo:null;ma&&Hi(ma);let dl={box:[],offscreen:!1,occluded:!1};const Ws=Fe?2*Zn.length:Zn.length;for(let hl=0;hl<Ws;++hl){const Rl=this.attemptAnchorPlacement(Zn[hl%Zn.length],Mn,Ll,fc,yo,ke,qe,ne,q,Se,hl>=Zn.length,Ot,$t,M,ds,ma,ye,he);if(Rl&&(dl=Rl.placedGlyphBoxes,dl&&dl.box&&dl.box.length)){vr=!0,si=Rl.shift;break}}return dl};ci(()=>pi(os,Ut.iconBox,i.bI.horizontal),()=>{const Mn=Ut.verticalTextBox;return Mn&&Hi(Mn),M.allowVerticalPlacement&&!(fn&&fn.box&&fn.box.length)&&Ar>0&&Mn?pi(Mn,Ut.verticalIconBox,i.bI.vertical):{box:null,offscreen:null,occluded:null}}),fn&&(vr=fn.box,Qr=fn.offscreen,_n=fn.occluded);const Vs=zn(!(!fn||!fn.box));if(!vr&&this.prevPlacement){const Mn=this.prevPlacement.variableOffsets[wr];Mn&&(this.variableOffsets[wr]=Mn,this.markUsedJustification(M,Mn.anchor,Ot,Vs))}}else{const Zn=(pi,Vs)=>{const Mn=M.getSymbolInstanceTextSize(ye,Ot,this.transform.zoom,$t,C),oo=this.collisionIndex.placeCollisionBox(M,Mn,pi,new i.P(0,0),Fe,ne,q,Se.predicate);return oo&&oo.box&&oo.box.length&&(this.markUsedOrientation(M,Vs,Ot),this.placedOrientations[wr]=Vs),oo};ci(()=>Zn(os,i.bI.horizontal),()=>{const pi=Ut.verticalTextBox;return M.allowVerticalPlacement&&Ar>0&&pi?(Hi(pi),Zn(pi,i.bI.vertical)):{box:null,offscreen:null,occluded:null}}),zn(!!(fn&&fn.box&&fn.box.length))}}if(Pi=fn,vr=Pi&&Pi.box&&Pi.box.length>0,Qr=Pi&&Pi.offscreen,_n=Pi&&Pi.occluded,Ot.useRuntimeCollisionCircles){const zn=M.text.placedSymbolArray.get(Ot.centerJustifiedTextSymbolIndex>=0?Ot.centerJustifiedTextSymbolIndex:Ot.verticalPlacedTextSymbolIndex),ci=i.bJ(M.textSizeData,ye,zn),Zn=L.get("text-padding");en=this.collisionIndex.placeCollisionCircles(M,Fe,zn,M.lineVertexArray,M.glyphOffsetArray,ci,q,X,ee,g,qe,Se.predicate,Ot.collisionCircleDiameter*ci/i.bO,Zn,this.retainedQueryData[M.bucketInstanceId].tileID),vr=Fe||en.circles.length>0&&!en.collisionDetected,Qr=Qr&&en.offscreen,_n=en.occluded}if(Ut.iconFeatureIndex&&(Ss=Ut.iconFeatureIndex),Ut.iconBox){const zn=ci=>{Hi(ci);const Zn=Ot.hasIconTextFit&&si?pu(si.x,si.y,ke,qe,this.transform.angle):new i.P(0,0),pi=M.getSymbolInstanceIconSize(he,this.transform.zoom,Ot.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(M,pi,ci,Zn,je,ne,q,Se.predicate)};Gi&&Gi.box&&Gi.box.length&&Ut.verticalIconBox?(kn=zn(Ut.verticalIconBox),jr=kn.box.length>0):(kn=zn(Ut.iconBox),jr=kn.box.length>0),Qr=Qr&&kn.offscreen,ii=kn.occluded}const Di=Pe||Ot.numHorizontalGlyphVertices===0&&Ar===0,pn=Be||Ot.numIconVertices===0;if(Di||pn?pn?Di||(jr=jr&&vr):vr=jr&&vr:jr=vr=jr&&vr,vr&&Pi&&Pi.box&&this.collisionIndex.insertCollisionBox(Pi.box,L.get("text-ignore-placement"),M.bucketInstanceId,Gi&&Gi.box&&oi?oi:On,Se.ID),jr&&kn&&this.collisionIndex.insertCollisionBox(kn.box,L.get("icon-ignore-placement"),M.bucketInstanceId,Ss,Se.ID),en&&(vr&&this.collisionIndex.insertCollisionCircles(en.circles,L.get("text-ignore-placement"),M.bucketInstanceId,On,Se.ID),g)){const zn=M.bucketInstanceId;let ci=this.collisionCircleArrays[zn];ci===void 0&&(ci=this.collisionCircleArrays[zn]=new Rr);for(let Zn=0;Zn<en.circles.length;Zn+=4)ci.circles.push(en.circles[Zn+0]),ci.circles.push(en.circles[Zn+1]),ci.circles.push(en.circles[Zn+2]),ci.circles.push(en.collisionDetected?1:0)}const Si=M.projection.name!=="globe";ot=ot&&(Si||!_n),Lt=Lt&&(Si||!ii),this.placements[wr]=new kc(vr||ot,jr||Lt,Qr||M.justReloaded),d.add(wr)};if(M.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(M,this.retainedQueryData[M.bucketInstanceId].tileID),M.elevationType==="road"&&M.updateRoadElevation(),M.updateZOffset(),M.sortFeaturesByY){const Ot=M.getSortedSymbolIndexes(this.transform.angle);for(let $t=Ot.length-1;$t>=0;--$t){const Ut=Ot[$t];zt(M.symbolInstances.get(Ut),Ut,M.collisionArrays[Ut])}M.hasAnyZOffset&&i.w(`${M.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(M.hasAnyZOffset){const Ot=M.getSortedIndexesByZOffset();for(let $t=0;$t<Ot.length;++$t){const Ut=Ot[$t];zt(M.symbolInstances.get(Ut),Ut,M.collisionArrays[Ut])}}else for(let Ot=o.symbolInstanceStart;Ot<o.symbolInstanceEnd;Ot++)zt(M.symbolInstances.get(Ot),Ot,M.collisionArrays[Ot]);if(g&&M.bucketInstanceId in this.collisionCircleArrays){const Ot=this.collisionCircleArrays[M.bucketInstanceId];i.bi(Ot.invProjMatrix,q),Ot.viewportMatrix=this.collisionIndex.getViewportMatrix()}M.justReloaded=!1}markUsedJustification(o,d,g,S){const{leftJustifiedTextSymbolIndex:C,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:L,verticalPlacedTextSymbolIndex:B,crossTileID:q}=g,X=i.bT(d),ee=S===i.bI.vertical?B:X==="left"?C:X==="center"?M:X==="right"?L:-1;C>=0&&(o.text.placedSymbolArray.get(C).crossTileID=ee>=0&&C!==ee?0:q),M>=0&&(o.text.placedSymbolArray.get(M).crossTileID=ee>=0&&M!==ee?0:q),L>=0&&(o.text.placedSymbolArray.get(L).crossTileID=ee>=0&&L!==ee?0:q),B>=0&&(o.text.placedSymbolArray.get(B).crossTileID=ee>=0&&B!==ee?0:q)}markUsedOrientation(o,d,g){const S=d===i.bI.horizontal||d===i.bI.horizontalOnly?d:0,C=d===i.bI.vertical?d:0,{leftJustifiedTextSymbolIndex:M,centerJustifiedTextSymbolIndex:L,rightJustifiedTextSymbolIndex:B,verticalPlacedTextSymbolIndex:q}=g,X=o.text.placedSymbolArray;M>=0&&(X.get(M).placedOrientation=S),L>=0&&(X.get(L).placedOrientation=S),B>=0&&(X.get(B).placedOrientation=S),q>=0&&(X.get(q).placedOrientation=C)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let g=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const S=d?d.symbolFadeChange(o):1,C=d?d.opacities:{},M=d?d.variableOffsets:{},L=d?d.placedOrientations:{};for(const B in this.placements){const q=this.placements[B],X=C[B];X?(this.opacities[B]=new Xl(X,S,q.text,q.icon,null,q.clipped),g=g||q.text!==X.text.placed||q.icon!==X.icon.placed):(this.opacities[B]=new Xl(null,S,q.text,q.icon,q.skipFade,q.clipped),g=g||q.text||q.icon)}for(const B in C){const q=C[B];if(!this.opacities[B]){const X=new Xl(q,S,!1,!1);X.isHidden()||(this.opacities[B]=X,g=g||q.text.placed||q.icon.placed)}}for(const B in M)this.variableOffsets[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.variableOffsets[B]=M[B]);for(const B in L)this.placedOrientations[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.placedOrientations[B]=L[B]);g?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:o)}updateLayerOpacities(o,d,g,S){const C=new Set;for(const M of d){const L=M.getBucket(o);L&&M.latestFeatureIndex&&o.fqid===L.layerIds[0]&&(this.updateBucketOpacities(L,C,M,M.collisionBoxArray,g,S,M.tileID,o.scope),L.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(L,M.tileID),L.elevationType==="road"&&L.updateRoadElevation(),L.updateZOffset())}}updateBucketOpacities(o,d,g,S,C,M,L,B){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const q=o.layers[0].layout,X=o.layers[0].paint,ee=!!o.layers[0].dynamicFilter(),Q=new Xl(null,0,!1,!1,!0),ne=q.get("text-allow-overlap"),fe=q.get("icon-allow-overlap"),de=q.get("text-variable-anchor"),ye=q.get("text-rotation-alignment")==="map",he=q.get("text-pitch-alignment")==="map",Se=X.get("symbol-z-offset"),Ae=q.get("symbol-elevation-reference")==="sea",Pe=!Se.isConstant(),Be=new Xl(null,0,ne&&(fe||!o.hasIconData()||q.get("icon-optional")),fe&&(ne||!o.hasTextData()||q.get("text-optional")),!0);!o.collisionArrays&&S&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(S);const Fe=(ke,qe,Ze)=>{for(let yt=0;yt<qe/4;yt++)ke.opacityVertexArray.emplaceBack(Ze)};let je=0;M&&o.updateReplacement(L,M);for(let ke=0;ke<o.symbolInstances.length;ke++){const qe=o.symbolInstances.get(ke),{numHorizontalGlyphVertices:Ze,numVerticalGlyphVertices:yt,crossTileID:ut,numIconVertices:At,tileAnchorX:Mt,tileAnchorY:Zt}=qe;let at=null;const gt=this.retainedQueryData[o.bucketInstanceId];Pe&&qe&&gt&&(at=g.latestFeatureIndex.loadFeature({featureIndex:qe.featureIndex,bucketIndex:gt.bucketIndex,sourceLayerIndex:gt.sourceLayerIndex,layoutVertexArrayOffset:0}));const ot=Se.evaluate(at,{}),Lt=d.has(ut);let vt=this.opacities[ut];Lt?vt=Q:vt||(vt=Be,this.opacities[ut]=vt),d.add(ut);const zt=Ze>0||yt>0,Ot=At>0,$t=this.placedOrientations[ut],Ut=$t===i.bI.vertical,wr=$t===i.bI.horizontal||$t===i.bI.horizontalOnly;!zt&&!Ot||vt.isHidden()||je++;let Ar=!1;if((zt||Ot)&&M)for(const dr of o.activeReplacements){if(i.bP(dr,C,i.bQ.Symbol,B)||dr.min.x>Mt||Mt>dr.max.x||dr.min.y>Zt||Zt>dr.max.y)continue;const Cr=i.bR(Mt,Zt,L.canonical,dr.footprintTileId.canonical);if(Ar=i.bS(Cr,dr.footprint),Ar)break}if(zt){const dr=Ar?gu:mu(vt.text);Fe(o.text,Ze,Ut?gu:dr),Fe(o.text,yt,wr?gu:dr);const Cr=vt.text.isHidden(),{leftJustifiedTextSymbolIndex:vr,centerJustifiedTextSymbolIndex:jr,rightJustifiedTextSymbolIndex:Qr,verticalPlacedTextSymbolIndex:_n}=qe,ii=o.text.placedSymbolArray,si=Cr||Ut?1:0;vr>=0&&(ii.get(vr).hidden=si),jr>=0&&(ii.get(jr).hidden=si),Qr>=0&&(ii.get(Qr).hidden=si),_n>=0&&(ii.get(_n).hidden=Cr||wr?1:0);const fn=this.variableOffsets[ut];fn&&this.markUsedJustification(o,fn.anchor,qe,$t);const Gi=this.placedOrientations[ut];Gi&&(this.markUsedJustification(o,"left",qe,Gi),this.markUsedOrientation(o,Gi,qe))}if(Ot){const dr=Ar?gu:mu(vt.icon),{placedIconSymbolIndex:Cr,verticalPlacedIconSymbolIndex:vr}=qe,jr=o.icon.placedSymbolArray,Qr=vt.icon.isHidden()?1:0;Cr>=0&&(Fe(o.icon,At,Ut?gu:dr),jr.get(Cr).hidden=Qr),vr>=0&&(Fe(o.icon,qe.numVerticalIconVertices,wr?gu:dr),jr.get(vr).hidden=Qr)}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const dr=o.collisionArrays[ke];if(dr){let Cr=new i.P(0,0),vr=!0;if(dr.textBox||dr.verticalTextBox){if(de){const Qr=this.variableOffsets[ut];Qr?(Cr=Oo(Qr.anchor,Qr.width,Qr.height,Qr.textOffset,Qr.textScale),ye&&Cr._rotate(he?this.transform.angle:-this.transform.angle)):vr=!1}ee&&(vr=!vt.clipped),dr.textBox&&dd(o.textCollisionBox.collisionVertexArray,vt.text.placed,!vr||Ut,ot,Ae,Cr.x,Cr.y),dr.verticalTextBox&&dd(o.textCollisionBox.collisionVertexArray,vt.text.placed,!vr||wr,ot,Ae,Cr.x,Cr.y)}const jr=vr&&!!(!wr&&dr.verticalIconBox);dr.iconBox&&dd(o.iconCollisionBox.collisionVertexArray,vt.icon.placed,jr,ot,Ae,qe.hasIconTextFit?Cr.x:0,qe.hasIconTextFit?Cr.y:0),dr.verticalIconBox&&dd(o.iconCollisionBox.collisionVertexArray,vt.icon.placed,!jr,ot,Ae,qe.hasIconTextFit?Cr.x:0,qe.hasIconTextFit?Cr.y:0)}}}if(o.fullyClipped=je===0,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const ke=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=ke.invProjMatrix,o.placementViewportMatrix=ke.viewportMatrix,o.collisionCircleArray=ke.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,d){const g=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*g>o}setStale(){this.stale=!0}}function dd(m,o,d,g,S,C,M){m.emplaceBack(o?1:0,d?1:0,C||0,M||0,g,S?1:0),m.emplaceBack(o?1:0,d?1:0,C||0,M||0,g,S?1:0),m.emplaceBack(o?1:0,d?1:0,C||0,M||0,g,S?1:0),m.emplaceBack(o?1:0,d?1:0,C||0,M||0,g,S?1:0)}const xf=Math.pow(2,25),bf=Math.pow(2,24),Lo=Math.pow(2,17),Ps=Math.pow(2,16),G_=Math.pow(2,9),wf=Math.pow(2,8),ag=Math.pow(2,1);function mu(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const o=m.placed?1:0,d=Math.floor(127*m.opacity);return d*xf+o*bf+d*Lo+o*Ps+d*G_+o*wf+d*ag+o}const gu=0;class Dp{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&o.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(o,d,g,S,C,M){const L=this._bucketParts;for(;this._currentTileIndex<o.length;)if(d.getBucketParts(L,S,o[this._currentTileIndex],this._sortAcrossTiles,M),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,L.sort((B,q)=>B.sortKey-q.sortKey));this._currentPartIndex<L.length;){const B=L[this._currentPartIndex];if(d.placeLayerBucketPart(B,this._seenCrossTileIDs,g,B.symbolInstanceStart===0,M),this._currentPartIndex++,C())return!0}return!1}}class Xo{constructor(o,d,g,S,C,M,L,B,q){this.placement=new ei(o,C,M,L,B,q),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=S,this._done=!1}isDone(){return this._done}continuePlacement(o,d,g,S,C){const M=i.q.now(),L=()=>{const B=i.q.now()-M;return!this._forceFullPlacement&&B>2};for(;this._currentPlacementIndex>=0;){const B=d[o[this._currentPlacementIndex]],q=this.placement.collisionIndex.transform.zoom;if(B.type==="symbol"&&(!B.minzoom||B.minzoom<=q)&&(!B.maxzoom||B.maxzoom>q)){const X=B,ee=X.layout.get("symbol-z-elevate"),Q=X.layout.get("symbol-sort-key").constantOr(1)!==void 0,ne=X.layout.get("symbol-z-order"),fe=ne==="viewport-y"||ne==="auto"&&!(ne!=="viewport-y"&&Q),de=X.layout.get("text-allow-overlap")||X.layout.get("icon-allow-overlap")||X.layout.get("text-ignore-placement")||X.layout.get("icon-ignore-placement"),ye=fe&&de,he=this._inProgressLayer=this._inProgressLayer||new Dp(X),Se=i.C(B.source,B.scope);if(he.continuePlacement(ee||ye?S[Se]:g[Se],this.placement,this._showCollisionBoxes,B,L,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const Qa=512/i.aj/2;class ca{constructor(o,d,g){this.tileID=o,this.bucketInstanceId=g,this.index=new i.bW(d.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const S=o.canonical.x*i.aj,C=o.canonical.y*i.aj;for(let M=0;M<d.length;M++){const{key:L,crossTileID:B,tileAnchorX:q,tileAnchorY:X}=d.get(M),ee=Math.floor((S+q)*Qa),Q=Math.floor((C+X)*Qa);this.index.add(ee,Q),this.keys.push(L),this.crossTileIDs.push(B)}this.index.finish()}findMatches(o,d,g){const S=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),C=Qa/Math.pow(2,d.canonical.z-this.tileID.canonical.z),M=d.canonical.x*i.aj,L=d.canonical.y*i.aj;for(let B=0;B<o.length;B++){const q=o.get(B);if(q.crossTileID)continue;const{key:X,tileAnchorX:ee,tileAnchorY:Q}=q,ne=Math.floor((M+ee)*C),fe=Math.floor((L+Q)*C),de=this.index.range(ne-S,fe-S,ne+S,fe+S).sort((ye,he)=>ye-he);for(const ye of de){const he=this.crossTileIDs[ye];if(this.keys[ye]===X&&!g.has(he)){g.add(he),q.crossTileID=he;break}}}}}class zy{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ph{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const d=Math.round((o-this.lng)/360);if(d!==0)for(const g in this.indexes){const S=this.indexes[g],C={};for(const M in S){const L=S[M];L.tileID=L.tileID.unwrapTo(L.tileID.wrap+d),C[L.tileID.key]=L}this.indexes[g]=C}this.lng=o}addBucket(o,d,g){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let C=0;C<d.symbolInstances.length;C++)d.symbolInstances.get(C).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]=new Set);const S=this.usedCrossTileIDs[o.overscaledZ];for(const C in this.indexes){const M=this.indexes[C];if(Number(C)>o.overscaledZ)for(const L in M){const B=M[L];B.tileID.isChildOf(o)&&B.findMatches(d.symbolInstances,o,S)}else{const L=M[o.scaledTo(Number(C)).key];L&&L.findMatches(d.symbolInstances,o,S)}}for(let C=0;C<d.symbolInstances.length;C++){const M=d.symbolInstances.get(C);M.crossTileID||(M.crossTileID=g.generate(),S.add(M.crossTileID))}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new ca(o,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(o,d){for(const g of d.crossTileIDs)this.usedCrossTileIDs[o].delete(g)}removeStaleBuckets(o){let d=!1;for(const g in this.indexes){const S=this.indexes[g];for(const C in S)o[S[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,S[C]),delete S[C],d=!0)}return d}}class Fs{constructor(){this.layerIndexes={},this.crossTileIDs=new zy,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,d,g,S){let C=this.layerIndexes[o.fqid];C===void 0&&(C=this.layerIndexes[o.fqid]=new ph);let M=!1;const L={};S.name!=="globe"&&C.handleWrapJump(g);for(const B of d){const q=B.getBucket(o);q&&o.fqid===q.layerIds[0]&&(q.bucketInstanceId||(q.bucketInstanceId=++this.maxBucketInstanceId),C.addBucket(B.tileID,q,this.crossTileIDs)&&(M=!0),L[q.bucketInstanceId]=!0)}return C.removeStaleBuckets(L)&&(M=!0),M}pruneUnusedLayers(o){const d={};o.forEach(g=>{d[g]=!0});for(const g in this.layerIndexes)d[g]||delete this.layerIndexes[g]}}const Ko=771;class gn{constructor(o,d,g,S){this.blendFunction=o,this.blendColor=d,this.mask=g,this.blendEquation=S}}gn.Replace=[1,0,1,0],gn.disabled=new gn(gn.Replace,i.am.transparent,[!1,!1,!1,!1]),gn.unblended=new gn(gn.Replace,i.am.transparent,[!0,!0,!0,!0]),gn.alphaBlended=new gn([1,Ko,1,Ko],i.am.transparent,[!0,!0,!0,!0]),gn.alphaBlendedNonPremultiplied=new gn([770,Ko,770,Ko],i.am.transparent,[!0,!0,!0,!0]),gn.multiply=new gn([774,0,774,0],i.am.transparent,[!0,!0,!0,!0]);class Er{constructor(o,d,g){this.func=o,this.mask=d,this.range=g}}Er.ReadOnly=!1,Er.ReadWrite=!0,Er.disabled=new Er(519,Er.ReadOnly,[0,1]);const hd=7680;class qr{constructor(o,d,g,S,C,M){this.test=o,this.ref=d,this.mask=g,this.fail=S,this.depthFail=C,this.pass=M}}qr.disabled=new qr({func:519,mask:0},0,0,hd,hd,hd);const fd=1029,pd=2305;class Zr{constructor(o,d,g){this.enable=o,this.mode=d,this.frontFace=g}}function lg(m,o){const d=i.c1(m,3);i.c3(m,o),i.c7(m,3,d)}function el(m,o){const d=i.bY([]);return i.bZ(d,d,-o),i.b_(d,d,-m),d}function cg(m,o){const d=[m[0],m[1],0],g=[o[0],o[1],0];if(i.ae(d)>=1e-15){const M=i.au([],d);i.b$(g,M,i.bE(g,M)),o[0]=g[0],o[1]=g[1]}const S=i.bG([],o,m);if(i.c0(S)<1e-15)return null;const C=Math.atan2(-S[1],S[0]);return el(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),C)}Zr.disabled=new Zr(!1,fd,pd),Zr.backCCW=new Zr(!0,fd,pd),Zr.backCW=new Zr(!0,fd,2304),Zr.frontCW=new Zr(!0,1028,2304),Zr.frontCCW=new Zr(!0,1028,pd);class Oc{constructor(o,d){this.position=o,this.orientation=d}get position(){return this._position}set position(o){if(o){const d=o instanceof i.ac?o:new i.ac(o[0],o[1],o[2]);this._renderWorldCopies&&(d.x=i.bX(d.x,0,1)),this._position=d}else this._position=null}lookAtPoint(o,d){if(this.orientation=null,!this.position)return;const g=this.position,S=this._elevation?this._elevation.getAtPointOrZero(i.ac.fromLngLat(o)):0,C=i.ac.fromLngLat(o,S),M=[C.x-g.x,C.y-g.y,C.z-g.z];d||(d=[0,0,1]),d[2]=Math.abs(d[2]),this.orientation=cg(M,d)}setPitchBearing(o,d){this.orientation=el(i.al(o),i.al(-d))}}class Ro{constructor(o,d){this._transform=i.bx([]),this.orientation=d,this.position=o}get mercatorPosition(){const o=this.position;return new i.ac(o[0],o[1],o[2])}get position(){const o=i.c1(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var d;o&&i.c7(this._transform,3,[(d=o)[0],d[1],d[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||i.bY([]),o&&lg(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),d=this.right();return{bearing:Math.atan2(-d[1],d[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,d){this._orientation=el(o,d),lg(this._transform,this._orientation)}forward(){const o=i.c1(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=i.c1(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=i.c1(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,d){const g=new Float64Array(16);return i.bi(g,this.getWorldToCamera(o,d)),g}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(o,d,g){const S=this.position;i.b$(S,S,-o);const C=new Float64Array(16);return i.bn(C,[g,g,g]),i.bo(C,C,S),C[10]*=d,C}getWorldToCamera(o,d){const g=new Float64Array(16),S=new Float64Array(4),C=this.position;return i.c2(S,this._orientation),i.b$(C,C,-o),i.c3(g,S),i.bo(g,g,C),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=d,g[9]*=d,g[10]*=d,g[11]*=d,g}getCameraToClipPerspective(o,d,g,S){const C=new Float64Array(16);return i.c4(C,o,d,g,S),C}getCameraToClipOrthographic(o,d,g,S,C,M){const L=new Float64Array(16);return i.c5(L,o,d,g,S,C,M),L}getDistanceToElevation(o,d=!1){const g=o===0?0:i.c6(o,d?i.aY(this.position[1]):this.position[1]),S=this.forward();return(g-this.position[2])/S[2]}clone(){return new Ro([...this.position],[...this.orientation])}}const Yo={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class mh{constructor(o=0,d=0,g=0,S=0){if(isNaN(o)||o<0||isNaN(d)||d<0||isNaN(g)||g<0||isNaN(S)||S<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=d,this.left=g,this.right=S}interpolate(o,d,g){return d.top!=null&&o.top!=null&&(this.top=i.ai(o.top,d.top,g)),d.bottom!=null&&o.bottom!=null&&(this.bottom=i.ai(o.bottom,d.bottom,g)),d.left!=null&&o.left!=null&&(this.left=i.ai(o.left,d.left,g)),d.right!=null&&o.right!=null&&(this.right=i.ai(o.right,d.right,g)),this}getCenter(o,d){const g=i.aD((this.left+o-this.right)/2,0,o),S=i.aD((this.top+d-this.bottom)/2,0,d);return new i.P(g,S)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new mh(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Lc=15;class yu{constructor(o,d,g,S,C,M,L){this.tileSize=512,this._renderWorldCopies=C===void 0||C,this._minZoom=o||0,this._maxZoom=d||22,this._minPitch=g??0,this._maxPitch=S??60,this.setProjection(M),this.setMaxBounds(L),this.width=0,this.height=0,this._center=new i.cd(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new mh,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Ro,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const o=new yu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.mercatorFromTransition=this.mercatorFromTransition,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o.frustumCorners=this.frustumCorners,o._allowWorldUnderZoom=this._allowWorldUnderZoom,o}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Lc}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(o,d=!1){const g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||g)&&this._updateCameraOnTerrain(),(o||g)&&this._constrainCamera(d),this._calcMatrices()}getProjection(){return i.aF(this.projection,["name","center","parallels"])}setProjection(o){this.projectionOptions=o||{name:"mercator"};const d=this.projection?this.getProjection():void 0;this.projection=i.ce(this.projectionOptions);const g=this.getProjection(),S=!i.bv(d,g);return S&&this._calcMatrices(),this.mercatorFromTransition=!1,S}setOrthographicProjectionAtLowPitch(o){return this._orthographicProjectionAtLowPitch!==o&&(this._orthographicProjectionAtLowPitch=o,this._calcMatrices(),!0)}setMercatorFromTransition(){const o=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.ce({name:"mercator"});const d=o!==this.projection.name;return d&&this._calcMatrices(),d}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.c6(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.bX(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const d=-o*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=i.cf(),i.cg(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const d=i.aD(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=i.al(o),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const o=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/o)}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){const d=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._setZoom(d),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(o){this._tileCoverLift!==o&&(this._tileCoverLift=o)}_updateCameraOnTerrain(){const o=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,d=this.elevation&&o===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||o===Number.NEGATIVE_INFINITY&&(!d||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const g=this._elevation;d||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&g.exaggeration()&&this._centerAltitudeValidForExaggeration!==g.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*g.exaggeration(),this._centerAltitudeValidForExaggeration=g.exaggeration()):(this._centerAltitude=o||0,this._centerAltitudeValidForExaggeration=g.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,d=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let S=0,C=0;for(let M=0;M<d.length;M++){const L=new i.P(d[M][0]*this.width,g+d[M][1]*(this.height-g)),B=o.pointCoordinate(L);if(!B)continue;const q=1/Math.hypot(B[0]-this._camera.position[0],B[1]-this._camera.position[1]);S+=B[3]*q,C+=q}return C===0?NaN:S/C}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const o=this._seaLevelZoom,d=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*d,S=this._mercatorZfromZoom(o),C=this._mercatorZfromZoom(this._maxZoom),M=Math.max(S-g,C);this._setZoom(this._zoomFromMercatorZ(M))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){const d=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let g;g=o.z<this._camera.position[2]?[d.x,d.y,d.z]:[o.x,o.y,o.z];const S=i.ae(i.at([],this._camera.position,g));return i.aD(this._zoomFromMercatorZ(S),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let d=!1;if(o.orientation&&!i.ch(o.orientation,this._camera.orientation)&&(d=this._setCameraOrientation(o.orientation)),o.position){const g=[o.position.x,o.position.y,o.position.z];i.ci(g,this._camera.position)||(this._setCameraPosition(g),d=!0)}d&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,d=new Oc;return d.position=new i.ac(o[0],o[1],o[2]),d.orientation=this._camera.orientation,d._elevation=this.elevation,d._renderWorldCopies=this.renderWorldCopies,d}_setCameraOrientation(o){if(!i.cj(o))return!1;i.ck(o,o);const d=i.cl([],[0,0,-1],o),g=i.cl([],[0,-1,0],o);if(g[2]<0)return!1;const S=cg(d,g);return!!S&&(this._camera.orientation=S,!0)}_setCameraPosition(o){const d=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,S=this.cameraToCenterDistance;o[2]=i.aD(o[2],S/g,S/d),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,d,g){this._unmodified=!1,this._edgeInsets.interpolate(o,d,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const d=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(o){const d=[new i.cm(0,o)];if(this.renderWorldCopies){const g=this.pointCoordinate(new i.P(0,0)),S=this.pointCoordinate(new i.P(this.width,0)),C=this.pointCoordinate(new i.P(this.width,this.height)),M=this.pointCoordinate(new i.P(0,this.height)),L=Math.floor(Math.min(g.x,S.x,C.x,M.x)),B=Math.floor(Math.max(g.x,S.x,C.x,M.x)),q=1;for(let X=L-q;X<=B+q;X++)X!==0&&d.push(new i.cm(X,o))}return d}isLODDisabled(o){return(!o||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(o,d,g){let S=[];const C=g!=null,M=!C;if(M&&this.zoom<d||C&&g[0]===0&&g[1]===0)return S;const L=new Set,B=(X,ee,Q,ne,fe)=>{const de=i.cK(ee,X,Q,ne,fe);L.has(de)||(S.push(new i.aM(X,ee,Q,ne,fe)),L.add(de))};for(let X=0;X<o.length;X++){const ee=o[X];if(M&&ee.canonical.z!==d)continue;const Q=ee.canonical,ne=ee.overscaledZ,fe=ee.wrap,de=1<<Q.z,ye=Q.x+1<de,he=Q.x>0,Se=Q.y+1<de,Ae=Q.y>0,Pe=ee.wrap-(he?0:1),Be=ee.wrap+(ye?0:1),Fe=he?Q.x-1:de-1,je=ye?Q.x+1:0;if(C)g[0]<0?(B(ne,Be,Q.z,je,Q.y),g[1]<0&&Se&&(B(ne,fe,Q.z,Q.x,Q.y+1),B(ne,Be,Q.z,je,Q.y+1)),g[1]>0&&Ae&&(B(ne,fe,Q.z,Q.x,Q.y-1),B(ne,Be,Q.z,je,Q.y-1))):g[0]>0?(B(ne,Pe,Q.z,Fe,Q.y),g[1]<0&&Se&&(B(ne,fe,Q.z,Q.x,Q.y+1),B(ne,Pe,Q.z,Fe,Q.y+1)),g[1]>0&&Ae&&(B(ne,fe,Q.z,Q.x,Q.y-1),B(ne,Pe,Q.z,Fe,Q.y-1))):g[1]<0&&Se?B(ne,fe,Q.z,Q.x,Q.y+1):Ae&&B(ne,fe,Q.z,Q.x,Q.y-1);else{const ke=ee.visibleQuadrants;1&ke&&(B(ne,Pe,Q.z,Fe,Q.y),Ae&&(B(ne,fe,Q.z,Q.x,Q.y-1),B(ne,Pe,Q.z,Fe,Q.y-1))),2&ke&&(B(ne,Be,Q.z,je,Q.y),Ae&&(B(ne,fe,Q.z,Q.x,Q.y-1),B(ne,Be,Q.z,je,Q.y-1))),4&ke&&(B(ne,Pe,Q.z,Fe,Q.y),Se&&(B(ne,fe,Q.z,Q.x,Q.y+1),B(ne,Pe,Q.z,Fe,Q.y+1))),8&ke&&(B(ne,Be,Q.z,je,Q.y),Se&&(B(ne,fe,Q.z,Q.x,Q.y+1),B(ne,Be,Q.z,je,Q.y+1)))}}const q=[];for(const X of S)S.some(ee=>X.isChildOf(ee))||q.push(X);if(S=q.filter(X=>!o.some(ee=>!!(X.overscaledZ<d&&ee.isChildOf(X))||X.equals(ee)||X.isChildOf(ee))),M){const X=1<<d,ee=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Q=[X*ee.x,X*ee.y],ne=4,fe=ne*ne;S=S.filter(de=>{const ye=de.canonical.x+.5-Q[0],he=de.canonical.y+.5-Q[1];return ye*ye+he*he<fe})}return S}coveringTiles(o){let d=this.coveringZoomLevel(o);const g=d,S=this.elevation&&this.elevation.exaggeration(),C=S&&!o.isTerrainDEM,M=this.projection.name==="mercator";if(o.minzoom!==void 0&&d<o.minzoom)return[];o.maxzoom!==void 0&&d>o.maxzoom&&(d=o.maxzoom);const L=this.locationCoordinate(this.center),B=this.center.lat,q=1<<d,X=[q*L.x,q*L.y,0],ee=this.projection.name==="globe",Q=!ee,ne=i.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d,Q),fe=ee?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),de=q*i.c6(1,this.center.lat),ye=this._camera.position[2]/i.c6(1,this.center.lat),he=[q*fe.x,q*fe.y,ye*(Q?1:de)],Se=ee||S,Ae=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),Pe=this.isLODDisabled(!0)?d:0;let Be;if(this._elevation&&o.isTerrainDEM)Be=1e4*this._elevation.exaggeration();else if(this._elevation){const ot=this._elevation.getMinMaxForVisibleTiles();Be=ot?ot.max:this._centerAltitude}else Be=this._centerAltitude;const Fe=o.isTerrainDEM?-Be:this._elevation?this._elevation.getMinElevationBelowMSL():0,je=this.projection.isReprojectedInTileSpace?i.co(this):1,ke=ot=>{const vt=new i.ac(ot.x+25e-6,ot.y,ot.z),zt=new i.ac(ot.x,ot.y+25e-6,ot.z),Ot=ot.toLngLat(),$t=vt.toLngLat(),Ut=zt.toLngLat(),wr=this.locationCoordinate(Ot),Ar=this.locationCoordinate($t),dr=this.locationCoordinate(Ut),Cr=Math.hypot(Ar.x-wr.x,Ar.y-wr.y),vr=Math.hypot(dr.x-wr.x,dr.y-wr.y);return Math.sqrt(Cr*vr)*je/25e-6},qe=ot=>{const Lt=Be,vt=Fe;return{aabb:i.cr(this,q,0,0,0,ot,vt,Lt,this.projection),zoom:0,x:0,y:0,minZ:vt,maxZ:Lt,wrap:ot,fullyVisible:!1}},Ze=[];let yt=[];const ut=d,At=o.reparseOverscaled?g:d,Mt=(ye-this._centerAltitude)*de,Zt=ot=>{if(!this._elevation||!ot.tileID||!M)return;const Lt=this._elevation.getMinMaxForTile(ot.tileID),vt=ot.aabb;Lt?(vt.min[2]=Lt.min,vt.max[2]=Lt.max,vt.center[2]=(vt.min[2]+vt.max[2])/2):(ot.shouldSplit=gt(ot),ot.shouldSplit||(vt.min[2]=vt.max[2]=vt.center[2]=this._centerAltitude))},at=(ot,Lt)=>{if(.707*Lt<ot)return 1;const vt=Lt/ot;return vt/(1.4144271570014144+(Math.pow(1.1,vt-1.4144271570014144+1)-1)/(1.1-1)-1)},gt=ot=>{if(ot.zoom<Pe)return!0;if(ot.zoom===ut)return!1;if(ot.shouldSplit!=null)return ot.shouldSplit;const Lt=ot.aabb.distanceX(he),vt=ot.aabb.distanceY(he);let zt=Mt,Ot=1;if(ee){zt=ot.aabb.distanceZ(he);const vr=Math.pow(2,ot.zoom),jr=i.aY((ot.y+1)/vr),Qr=i.aY(ot.y/vr),_n=Math.min(Math.max(B,jr),Qr),ii=i.cP(_n)/i.cP(B);if(Ot=_n===B?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ii/this._mercatorScaleRatio),this.zoom<=i.cL&&ot.zoom===ut-1&&ii>=.9)return!0}else if(C&&(zt=ot.aabb.distanceZ(he)*de),this.projection.isReprojectedInTileSpace&&g<=5){const vr=Math.pow(2,ot.zoom),jr=ke(new i.ac((ot.x+.5)/vr,(ot.y+.5)/vr));Ot=jr>.85?1:jr}if(!M){const vr=Math.sqrt(Lt*Lt+vt*vt+zt*zt);let jr=(1<<ut-ot.zoom)*Ae*Ot;return jr*=at(Math.max(zt,Mt),vr),vr<jr}let $t=Number.MAX_VALUE,Ut=0;const wr=ot.aabb.getCorners(),Ar=[];for(const vr of wr){i.at(Ar,vr,he),ee||(C?Ar[2]*=de:Ar[2]=Mt);const jr=i.bE(Ar,this._camera.forward());jr<$t&&($t=jr,Ut=Math.abs(Ar[2]))}let dr=(1<<ut-ot.zoom)*Ae*Ot;if(dr*=at(Math.max(Ut,Mt),$t),$t<dr)return!0;const Cr=ot.aabb.closestPoint(X);return Cr[0]===X[0]&&Cr[1]===X[1]};if(this.renderWorldCopies)for(let ot=1;ot<=3;ot++)Ze.push(qe(-ot)),Ze.push(qe(ot));for(Ze.push(qe(0));Ze.length>0;){const ot=Ze.pop(),Lt=ot.x,vt=ot.y;let zt=ot.fullyVisible;const Ot=()=>this.projection.name==="globe"&&(ot.y===0||ot.y===(1<<ot.zoom)-1);if(!zt){let $t=Se?ot.aabb.intersects(ne):ot.aabb.intersectsFlat(ne);if($t===0&&Ot()){const Ut=new i.cp(ot.zoom,Lt,vt);$t=i.cq(this,q,Ut,!0).intersects(ne)}if($t===0)continue;zt=$t===2}if(ot.zoom!==ut&&gt(ot))for(let $t=0;$t<4;$t++){const Ut=(Lt<<1)+$t%2,wr=(vt<<1)+($t>>1),Ar={aabb:M?ot.aabb.quadrant($t):i.cr(this,q,ot.zoom+1,Ut,wr,ot.wrap,ot.minZ,ot.maxZ,this.projection),zoom:ot.zoom+1,x:Ut,y:wr,wrap:ot.wrap,fullyVisible:zt,tileID:void 0,shouldSplit:void 0,minZ:ot.minZ,maxZ:ot.maxZ};C&&!ee&&(Ar.tileID=new i.aM(ot.zoom+1===ut?At:ot.zoom+1,ot.wrap,ot.zoom+1,Ut,wr),Zt(Ar)),Ze.push(Ar)}else{const $t=ot.zoom===ut?At:ot.zoom;if(o.minzoom&&o.minzoom>$t)continue;let Ut=0;if(!zt){let Cr=Se?ot.aabb.intersectsPrecise(ne):ot.aabb.intersectsPreciseFlat(ne);if(Cr===0&&Ot()){const vr=new i.cp(ot.zoom,Lt,vt);Cr=i.cq(this,q,vr,!0).intersectsPrecise(ne)}if(Cr===0)continue;if(o.calculateQuadrantVisibility)if(ne.containsPoint(ot.aabb.center))Ut=15;else for(let vr=0;vr<4;vr++)ot.aabb.quadrant(vr).intersects(ne)!==0&&(Ut|=1<<vr)}const wr=X[0]-(.5+Lt+(ot.wrap<<ot.zoom))*(1<<d-ot.zoom),Ar=X[1]-.5-vt,dr=ot.tileID?ot.tileID:new i.aM($t,ot.wrap,ot.zoom,Lt,vt);o.calculateQuadrantVisibility&&(dr.visibleQuadrants=Ut),yt.push({tileID:dr,distanceSq:wr*wr+Ar*Ar})}}if(this.fogCullDistSq){const ot=this.fogCullDistSq,Lt=this.horizonLineFromTop();yt=yt.filter(vt=>{const zt=[0,0,0,1],Ot=[i.aj,i.aj,0,1],$t=this.calculateFogTileMatrix(vt.tileID.toUnwrapped());i.aA(zt,zt,$t),i.aA(Ot,Ot,$t);const Ut=i.cs([],zt,Ot),wr=i.ct([],zt,Ot),Ar=i.cM(Ut,wr);if(Ar===0)return!0;let dr=!1;const Cr=this._elevation;if(Cr&&Ar>ot&&Lt!==0){const vr=this.calculateProjMatrix(vt.tileID.toUnwrapped());let jr;o.isTerrainDEM||(jr=Cr.getMinMaxForTile(vt.tileID)),jr||(jr={min:Fe,max:Be});const Qr=i.cu(this.rotation),_n=[Qr[0]*i.aj,Qr[1]*i.aj,jr.max];i.ad(_n,_n,vr),dr=(1-_n[1])*this.height*.5<Lt}return Ar<ot||dr})}return yt.sort((ot,Lt)=>ot.distanceSq-Lt.distanceSq).map(ot=>ot.tileID)}resize(o,d){this.width=o,this.height=d,this.pixelsToGLUnits=[2/o,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const d=i.aD(o.lat,-i.cv,i.cv),g=this.projection.project(o.lng,d);return new i.P(g.x*this.worldSize,g.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.c6(1,this.center.lat)/this.worldSize}setLocationAtPoint(o,d){let g,S;const C=this.centerPoint;if(this.projection.name==="globe"){const L=this.worldSize;g=(d.x-C.x)/L,S=(d.y-C.y)/L}else{const L=this.pointCoordinate(d),B=this.pointCoordinate(C);g=L.x-B.x,S=L.y-B.y}const M=this.locationCoordinate(o);this.setLocation(new i.ac(M.x-g,M.y-S))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o,d){return this.projection.locationPoint(this,o,d)}locationPoint3D(o,d){return this.projection.locationPoint(this,o,d,!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o,d){return this.coordinateLocation(this.pointCoordinate3D(o,d))}locationCoordinate(o,d){const g=d?i.c6(d,o.lat):void 0,S=this.projection.project(o.lng,o.lat);return new i.ac(S.x,S.y,g)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,d){const g=d??this._centerAltitude,S=[o.x,o.y,0,1],C=[o.x,o.y,1,1];i.aA(S,S,this.pixelMatrixInverse),i.aA(C,C,this.pixelMatrixInverse);const M=C[3];i.cw(S,S,1/S[3]),i.cw(C,C,1/M);const L=S[2],B=C[2];return{p0:S,p1:C,t:L===B?0:(g-L)/(B-L)}}screenPointToMercatorRay(o){const d=[o.x,o.y,0,1],g=[o.x,o.y,1,1];return i.aA(d,d,this.pixelMatrixInverse),i.aA(g,g,this.pixelMatrixInverse),i.cw(d,d,1/d[3]),i.cw(g,g,1/g[3]),d[2]=i.c6(d[2],this._center.lat)*this.worldSize,g[2]=i.c6(g[2],this._center.lat)*this.worldSize,i.cw(d,d,1/this.worldSize),i.cw(g,g,1/this.worldSize),new i.av([d[0],d[1],d[2]],i.au([],i.at([],g,d)))}rayIntersectionCoordinate(o){const{p0:d,p1:g,t:S}=o,C=i.c6(d[2],this._center.lat),M=i.c6(g[2],this._center.lat);return new i.ac(i.ai(d[0],g[0],S)/this.worldSize,i.ai(d[1],g[1],S)/this.worldSize,i.ai(C,M,S))}pointCoordinate(o,d=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,d)}pointCoordinate3D(o,d){if(!this.elevation)return this.pointCoordinate(o,d);let g=this.projection.pointCoordinate3D(this,o.x,o.y);if(g)return new i.ac(g[0],g[1],g[2]);let S=0,C=this.horizonLineFromTop();if(o.y>C)return this.pointCoordinate(o,d);const M=.02*C,L=o.clone();for(let B=0;B<10&&C-S>M;B++){L.y=i.ai(S,C,.66);const q=this.projection.pointCoordinate3D(this,L.x,L.y);q?(C=L.y,g=q):S=L.y}return g?new i.ac(g[0],g[1],g[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){return this.projection.isPointAboveHorizon(this,o)}isPointOnSurface(o){if(o.y<0||o.y>this.height||o.x<0||o.x>this.width)return!1;if(this.elevation||this.zoom>=i.cx)return!this.isPointAboveHorizon(o);const d=this.pointCoordinate(o);return d.y>=0&&d.y<=1}_coordinatePoint(o,d){const g=d&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,S=[o.x*this.worldSize,o.y*this.worldSize,g+o.toAltitude(),1];return i.aA(S,S,this.pixelMatrix),S[3]>0?new i.P(S[0]/S[3],S[1]/S[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:o,left:d}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,C=this.pointLocation3D(new i.P(d,o)),M=this.pointLocation3D(new i.P(S,o)),L=this.pointLocation3D(new i.P(S,g)),B=this.pointLocation3D(new i.P(d,g));let q=Math.min(C.lng,M.lng,L.lng,B.lng),X=Math.max(C.lng,M.lng,L.lng,B.lng),ee=Math.min(C.lat,M.lat,L.lat,B.lat),Q=Math.max(C.lat,M.lat,L.lat,B.lat);const ne=Math.pow(2,-this.zoom)/16*270,fe=this.projection.name==="globe"?1:4,de=(ye,he,Se,Ae,Pe)=>{const Be=(ye+Se)/2,Fe=(he+Ae)/2,je=new i.P(Be,Fe),{lng:ke,lat:qe}=this.pointLocation3D(je),Ze=Math.max(0,q-ke,ee-qe,ke-X,qe-Q);q=Math.min(q,ke),X=Math.max(X,ke),ee=Math.min(ee,qe),Q=Math.max(Q,qe),(Pe<fe||Ze>ne)&&(de(ye,he,Be,Fe,Pe+1),de(Be,Fe,Se,Ae,Pe+1))};if(de(d,o,S,o,1),de(S,o,S,g,1),de(S,g,d,g,1),de(d,g,d,o,1),this.projection.name==="globe"){const[ye,he]=i.cy(this);ye?(Q=90,X=180,q=-180):he&&(ee=-90,X=180,q=-180)}return new i.aG(new i.cd(q,ee),new i.cd(X,Q))}_getBoundsRectangular(o,d){const{top:g,left:S}=this._edgeInsets,C=this.height-this._edgeInsets.bottom,M=this.width-this._edgeInsets.right,L=new i.P(S,g),B=new i.P(M,g),q=new i.P(M,C),X=new i.P(S,C);let ee=this.pointCoordinate(L,o),Q=this.pointCoordinate(B,o);const ne=this.pointCoordinate(q,d),fe=this.pointCoordinate(X,d),de=(ye,he)=>(he.y-ye.y)/(he.x-ye.x);return ee.y>1&&Q.y>=0?ee=new i.ac((1-fe.y)/de(fe,ee)+fe.x,1):ee.y<0&&Q.y<=1&&(ee=new i.ac(-fe.y/de(fe,ee)+fe.x,0)),Q.y>1&&ee.y>=0?Q=new i.ac((1-ne.y)/de(ne,Q)+ne.x,1):Q.y<0&&ee.y<=1&&(Q=new i.ac(-ne.y/de(ne,Q)+ne.x,0)),new i.aG().extend(this.coordinateLocation(ee)).extend(this.coordinateLocation(Q)).extend(this.coordinateLocation(fe)).extend(this.coordinateLocation(ne))}_getBoundsRectangularTerrain(){const o=this.elevation;if(!o.visibleDemTiles.length||o.isUsingMockSource())return this._getBoundsRectangular(0,0);const d=o.visibleDemTiles.reduce((g,S)=>{if(S.dem){const C=S.dem.tree;g.min=Math.min(g.min,C.minimums[0]),g.max=Math.max(g.max,C.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(d.min*o.exaggeration(),d.max*o.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(o=!0){const d=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,g=this.height/2-d*(1-this._horizonShift);return o?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-i.cv,this.maxLat=i.cv,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.ay(this.minLng)*this.tileSize,this.worldMaxX=i.ay(this.maxLng)*this.tileSize,this.worldMinY=i.aH(this.maxLat)*this.tileSize,this.worldMaxY=i.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,d){return this.projection.createTileMatrix(this,d,o)}calculateDistanceTileData(o){const d=o.key,g=this._distanceTileDataCache;if(g[d])return g[d];const S=o.canonical,C=1/this.height,M=this.cameraWorldSize,L=M/this.zoomScale(S.z),B=(S.x+Math.pow(2,S.z)*o.wrap)*L,q=S.y*L,X=this.point;X.x*=M/this.worldSize,X.y*=M/this.worldSize;const ee=this.angle,Q=Math.sin(-ee),ne=-Math.cos(-ee);return g[d]={bearing:[Q,ne],center:[(X.x-B)*C,(X.y-q)*C],scale:L/i.aj*C},g[d]}calculateFogTileMatrix(o){const d=o.key,g=this._fogTileMatrixCache;if(g[d])return g[d];const S=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,o);return i.az(S,this.worldToFogMatrix,S),g[d]=new Float32Array(S),g[d]}calculateProjMatrix(o,d=!1,g=!1){const S=o.key;let C;if(C=g?this._expandedProjMatrixCache:d?this._alignedProjMatrixCache:this._projMatrixCache,C[S])return C[S];const M=this.calculatePosMatrix(o,this.worldSize);let L;return L=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:g?this.expandedFarZProjMatrix:d?this.alignedProjMatrix:this.projMatrix,i.az(M,L,M),C[S]=new Float32Array(M),C[S]}calculatePixelsToTileUnitsMatrix(o){const d=o.tileID.key,g=this._pixelsToTileUnitsCache;if(g[d])return g[d];const S=i.cz(o,this);return g[d]=S,g[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const o=1/this.worldSize,d=i.bn([],[o,o,o]);return i.az(d,d,this.globeMatrix),d}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const o=this._elevation;this._updateCameraState();const d=i.c6(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(d),S=this._camera.forward(),C=i.c6(1,this._center.lat);g[2]/=C,S[2]/=C,i.au(S,S);const M=o.raycast(g,S,o.exaggeration());if(M){const L=i.bF([],g,S,M),B=new i.ac(L[0],L[1],i.c6(L[2],i.aY(L[1]))),q=(B.z+i.ae([B.x-g[0],B.y-g[1],B.z-g[2]*C]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(q),this._centerAltitude=B.toAltitude(),this._center=this.coordinateLocation(B),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(o=!1){if(!this._elevation)return;const d=this._elevation,g=i.c6(1,this._center.lat)*this.worldSize,S=this._computeCameraPosition(g),C=d.getAtPointOrZero(new i.ac(...S)),M=this.pixelsPerMeter/this.worldSize*C,L=this._minimumHeightOverTerrain(),B=S[2]-M;if(B<=L)if(B<0||o){const q=this.locationCoordinate(this._center,this._centerAltitude),X=[S[0],S[1],q.z-S[2]],ee=i.ae(X);X[2]-=(L-B)/this._pixelsPerMercatorPixel;const Q=i.ae(X);if(Q===0)return;i.b$(X,X,ee/Q*this._pixelsPerMercatorPixel),this._camera.position=[S[0],S[1],q.z*this._pixelsPerMercatorPixel-X[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||o){const Q=this.center;return Q.lat=i.aD(Q.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!o)&&(Q.lng=i.aD(Q.lng,this.minLng,this.maxLng)),this.center=Q,void(this._constraining=!1)}const d=this._unmodified,{x:g,y:S}=this.point;let C=0,M=g,L=S;const B=this.width/2,q=this.height/2,X=this.worldMinY*this.scale,ee=this.worldMaxY*this.scale;if(S-q<X&&(L=X+q),S+q>ee&&(L=ee-q),ee-X<this.height&&(C=Math.max(C,this.height/(ee-X)),L=(ee+X)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Q=this.worldMinX*this.scale,ne=this.worldMaxX*this.scale,fe=this.worldSize/2-(Q+ne)/2;M=(g+fe+this.worldSize)%this.worldSize-fe,M-B<Q&&(M=Q+B),M+B>ne&&(M=ne-B),ne-Q<this.width&&(C=Math.max(C,this.width/(ne-Q)),M=(ne+Q)/2)}M===g&&L===S||this._allowWorldUnderZoom||(this.center=this.unproject(new i.P(M,L))),C&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(C)),this._constrainCamera(),this._unmodified=d,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,d=this.projection.name==="globe",g=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.c6(1,this.center.lat)/i.c6(1,i.cN));const S=i.cA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,S),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const C=this.projection.zAxisUnit==="meters"?g:1,M=this._camera.getWorldToCamera(this.worldSize,C);let L;const B=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(B[8]=2*-o.x/this.width,B[9]=2*o.y/this.height,this.isOrthographic){let qe=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ze=qe*this.aspect,yt=-Ze,ut=-qe;Ze-=o.x,yt-=o.x,qe+=o.y,ut+=o.y,L=this._camera.getCameraToClipOrthographic(yt,Ze,ut,qe,this._nearZ,this._farZ),((At,Mt,Zt,at)=>{for(let gt=0;gt<16;gt++)At[gt]=i.ai(Mt[gt],Zt[gt],at)})(L,L,B,i.cO(this.pitch>=Lc?1:this.pitch/Lc))}else L=B;const q=i.cB([],B,M);let X=i.cB([],L,M);if(this.projection.isReprojectedInTileSpace){const qe=this.locationCoordinate(this.center),Ze=i.bx([]);i.bo(Ze,Ze,[qe.x*this.worldSize,qe.y*this.worldSize,0]),i.az(Ze,Ze,i.cC(this)),i.bo(Ze,Ze,[-qe.x*this.worldSize,-qe.y*this.worldSize,0]),i.az(X,X,Ze),i.az(q,q,Ze),this.inverseAdjustmentMatrix=i.cD(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.cE([],X,[this.worldSize,this.worldSize,this.worldSize/C,1]),this.projMatrix=X,this.invProjMatrix=i.bi(new Float64Array(16),this.projMatrix),d){const qe=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);qe[8]=2*-o.x/this.width,qe[9]=2*o.y/this.height,this.expandedFarZProjMatrix=i.cB([],qe,M)}else this.expandedFarZProjMatrix=this.projMatrix;const ee=i.bi([],L);this.frustumCorners=i.cF.fromInvProjectionMatrix(ee,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!d);const Q=new Float32Array(16);i.bx(Q),i.cE(Q,Q,[1,-1,1]),i.cG(Q,Q,this._pitch),i.by(Q,Q,this.angle);const ne=i.c4(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.bw(ne);const fe=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;ne[8]=2*-o.x/this.width,ne[9]=2*(o.y+fe)/this.height,this.skyboxMatrix=i.az(Q,ne,Q);const de=this.point,ye=de.x,he=de.y,Se=this.width%2/2,Ae=this.height%2/2,Pe=Math.cos(this.angle),Be=Math.sin(this.angle),Fe=ye-Math.round(ye)+Pe*Se+Be*Ae,je=he-Math.round(he)+Pe*Ae+Be*Se,ke=new Float64Array(X);if(i.bo(ke,ke,[Fe>.5?Fe-1:Fe,je>.5?je-1:je,0]),this.alignedProjMatrix=ke,X=i.bz(),i.cE(X,X,[this.width/2,-this.height/2,1]),i.bo(X,X,[1,-1,0]),this.labelPlaneMatrix=X,X=i.bz(),i.cE(X,X,[1,-1,1]),i.bo(X,X,[-1,-1,0]),i.cE(X,X,[2/this.width,2/this.height,1]),this.glCoordMatrix=X,this.pixelMatrix=i.az(new Float64Array(16),this.labelPlaneMatrix,q),this._calcFogMatrices(),this._distanceTileDataCache={},X=i.bi(new Float64Array(16),this.pixelMatrix),!X)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=X,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.cH(this);const qe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.ad(qe,qe,M),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=X;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSizeForFog,d=this.cameraPixelsPerMeter,g=this._camera.position,S=1/this.height/this._pixelsPerMercatorPixel,C=[o,o,d];i.b$(C,C,S),i.b$(g,g,-1),i.cI(g,g,C);const M=i.bz();i.bo(M,M,g),i.cE(M,M,C),this.mercatorFogMatrix=M,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,d,S)}_computeCameraPosition(o){const d=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),S=this.point,C=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*d-o/this.worldSize*this._centerAltitude;return[S.x/this.worldSize-g[0]*C,S.y/this.worldSize-g[1]*C,o/this.worldSize*this._centerAltitude-g[2]*C]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const d=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],S=o[2];let C=1;this.projection.wrap&&(this.center=this.center.wrap()),S>0&&(C=Math.min((d-g)/S,1)),this._camera.position=i.bF([],this._camera.position,o,C),this._updateStateFromCamera()}_updateStateFromCamera(){const o=this._camera.position,d=this._camera.forward(),{pitch:g,bearing:S}=this._camera.getPitchBearing(),C=i.c6(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,M=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.al(this._maxPitch)),L=Math.max((o[2]-C)/Math.cos(g),M),B=this._zoomFromMercatorZ(L);i.bF(o,o,d,L),this._pitch=i.aD(g,i.al(this.minPitch),i.al(this.maxPitch)),this.angle=i.bX(S,-Math.PI,Math.PI),this._setZoom(i.aD(B,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.ac(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(o*this.tileSize))}zoomFromMercatorZAdjusted(o){let d=0,g=i.cx,S=0,C=1/0;for(;g-d>1e-6&&g>d;){const M=d+.5*(g-d),L=this.tileSize*Math.pow(2,M),B=this.getCameraToCenterDistance(this.projection,M,L),q=this.scaleZoom(B/(o*this.tileSize)),X=Math.abs(M-q);X<C&&(C=X,S=M),M<q?d=M:g=M}return S}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(o,d){const g=Math.min(o.x,d.x),S=Math.max(o.x,d.x),C=Math.min(o.y,d.y),M=Math.max(o.y,d.y);if(C<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const L=[new i.P(g,C),new i.P(S,M),new i.P(g,M),new i.P(S,C)],B=this.renderWorldCopies?-3:0,q=this.renderWorldCopies?4:1;for(const X of L){const ee=this.pointRayIntersection(X);if(ee.t<0)return!0;const Q=this.rayIntersectionCoordinate(ee);if(Q.x<B||Q.y<0||Q.x>q||Q.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.cJ(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(o,d){const g=i.ae(i.at([],this._camera.position,o)),S=this._zoomFromMercatorZ(g)+d;return g-this._mercatorZfromZoom(S)}getCameraPoint(){if(this.projection.name==="globe"){const o=function([d,g,S],C){const M=[d,g,S,1];i.aA(M,M,C);const L=M[3]=Math.max(M[3],1e-6);return M[0]/=L,M[1]/=L,M[2]/=L,M}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(o[0],o[1])}{const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,o))}}getCameraToCenterDistance(o,d=this.zoom,g=this.worldSize){const S=i.cA(o,d,this.width,this.height,1024),C=o.pixelSpaceConversion(this.center.lat,g,S);let M=.5/Math.tan(.5*this._fov)*this.height*C;return this.isOrthographic&&(M=i.ai(1,M,i.cO(this.pitch>=Lc?1:this.pitch/Lc))),M}getWorldToCameraMatrix(){const o=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.az(o,o,this.globeMatrix),o}getFrustum(o){return i.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,this.projection.zAxisUnit==="meters")}}const El=(m,o)=>{if(o>0&&m.terrain&&i.w("Cutoff is currently disabled on terrain"),o<=0||m.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const d=m.transform,g=Math.max(Math.abs(d._zoom-(m.minCutoffZoom-1)),1),S=d.isLODDisabled(!1)?i.af(60,45,d.pitch):i.af(30,15,d.pitch),C=d._farZ-d._nearZ,M=o*d.height,L=((1-(B=S))*d.cameraToCenterDistance+B*(d._farZ+M))*g;var B;return{shouldRenderCutoff:S<1,uniformValues:{u_cutoff_params:[d._nearZ,d._farZ,(L-d._nearZ)/C,(L-M-d._nearZ)/C]}}},to={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Sf{constructor(o,d){this.aabb=o,this.lastCascade=d}}class vu{add(o,d){const g=this.receivers[o.key];g!==void 0?(g.aabb.min[0]=Math.min(g.aabb.min[0],d.min[0]),g.aabb.min[1]=Math.min(g.aabb.min[1],d.min[1]),g.aabb.min[2]=Math.min(g.aabb.min[2],d.min[2]),g.aabb.max[0]=Math.max(g.aabb.max[0],d.max[0]),g.aabb.max[1]=Math.max(g.aabb.max[1],d.max[1]),g.aabb.max[2]=Math.max(g.aabb.max[2],d.max[2])):this.receivers[o.key]=new Sf(d,null)}clear(){this.receivers={}}get(o){return this.receivers[o.key]}computeRequiredCascades(o,d,g){const S=i.cV.fromPoints(o.points);let C=0;for(const M in this.receivers){const L=this.receivers[M];if(!L||!S.intersectsAabb(L.aabb))continue;L.aabb.min=S.closestPoint(L.aabb.min),L.aabb.max=S.closestPoint(L.aabb.max);const B=L.aabb.getCorners();for(let q=0;q<g.length;q++){let X=!0;for(const ee of B){const Q=[ee[0]*d,ee[1]*d,ee[2]];if(i.ad(Q,Q,g[q].matrix),Q[0]<-1||Q[0]>1||Q[1]<-1||Q[1]>1){X=!1;break}}if(L.lastCascade=q,C=Math.max(C,q),X)break}}return C+1}}class H_{constructor(o){this.painter=o,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new vu,this._depthMode=new Er(o.context.gl.LEQUAL,Er.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,o.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),o.tp.registerParameter(to,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),o.tp.registerParameter(to,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),o.tp.registerParameter(to,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),o.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const o of this._cascades)o.texture.destroy(),o.framebuffer.destroy();this._cascades=[]}updateShadowParameters(o,d){const g=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!d||!d.properties)return;const S=d.properties.get("shadow-intensity");if(!d.shadowsEnabled()||S<=0||(this._shadowLayerCount=g.style.order.reduce((fe,de)=>{const ye=g.style._mergedLayers[de];return fe+(ye.hasShadowPass()&&!ye.isHidden(o.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const C=g.context,M=to.shadowMapResolution,L=to.shadowMapResolution;if(this._cascades.length===0||to.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let fe=0;fe<to.cascadeCount;++fe){const de=g._shadowMapDebug,ye=C.gl,he=C.createFramebuffer(M,L,de,"texture"),Se=new i.T(C,{width:M,height:L,data:null},ye.DEPTH_COMPONENT16);if(he.depthAttachment.set(Se.texture),de){const Ae=new i.T(C,{width:M,height:L,data:null},ye.RGBA8);he.colorAttachment.set(Ae.texture)}this._cascades.push({framebuffer:he,texture:Se,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.cn,scale:0})}}this.shadowDirection=Ef(d);let B=0;if(o.elevation){const fe=o.elevation,de=[1e4,-1e4];fe.visibleDemTiles.filter(ye=>ye.dem).forEach(ye=>{const he=ye.dem.tree;de[0]=Math.min(de[0],he.minimums[0]),de[1]=Math.max(de[1],he.maximums[0])}),de[0]!==1e4&&(B=(de[1]-de[0])*fe.exaggeration())}const q=1.5*o.cameraToCenterDistance,X=3*q,ee=new Float64Array(16);for(let fe=0;fe<this._cascades.length;++fe){const de=this._cascades[fe];let ye=o.height/50,he=1;to.cascadeCount===1?he=X:fe===0?he=q:(ye=q,he=X);const[Se,Ae]=Np(o,this.shadowDirection,ye,he,to.shadowMapResolution,B);de.scale=o.scale,de.matrix=Se,de.boundingSphereRadius=Ae,i.bi(ee,de.matrix),de.frustum=i.cn.fromInvProjectionMatrix(ee,1,0,!0),de.far=he}const Q=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[Q].far,this._cascades[Q].far],this._uniformValues.u_shadow_intensity=S,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/to.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=to.shadowMapResolution,this._uniformValues.u_shadowmap_0=Yo.ShadowMap0,this._uniformValues.u_shadowmap_1=Yo.ShadowMap0+1,this._groundShadowTiles=g.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const ne=g.transform.elevation;for(const fe of this._groundShadowTiles){let de={min:0,max:0};if(ne){const ye=ne.getMinMaxForTile(fe);ye&&(de=ye)}this.addShadowReceiver(fe.toUnwrapped(),de.min,de.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(o){this._enabled=o}drawShadowPass(o,d){if(!this.enabled)return;const g=this.painter,S=g.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(g.transform.getFrustum(0),g.transform.worldSize,this._cascades),S.viewport.set([0,0,to.shadowMapResolution,to.shadowMapResolution]);for(let C=0;C<this._numCascadesToRender;++C){g.currentShadowCascade=C,S.bindFramebuffer.set(this._cascades[C].framebuffer.framebuffer),S.clear({color:i.am.white,depth:1});for(const M of o.order){const L=o._mergedLayers[M];if(!L.hasShadowPass()||L.isHidden(g.transform.zoom))continue;const B=o.getLayerSourceCache(L),q=B?d[B.id]:void 0;(L.type==="model"||q&&q.length)&&g.renderLayer(g,B,L,q)}}g.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const o=this.painter,d=o.style,g=o.context,S=d.directionalLight,C=d.ambientLight;if(!S||!C)return;const M=[],L=El(o,o.longestCutoffRange);L.shouldRenderCutoff&&M.push("RENDER_CUTOFF"),M.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&M.push("NORMAL_OFFSET");const B=tl(d,S,C),q=new Er(g.gl.LEQUAL,Er.ReadOnly,o.depthRangeFor3D);for(const X of this._groundShadowTiles){const ee=X.toUnwrapped(),Q=o.isTileAffectedByFog(X),ne=o.getOrCreateProgram("groundShadow",{defines:M,overrideFog:Q});this.setupShadows(ee,ne),o.uploadCommonUniforms(g,ne,ee,null,L);const fe={u_matrix:o.transform.calculateProjMatrix(ee),u_ground_shadow_factor:B};ne.draw(o,g.gl.TRIANGLES,q,qr.disabled,gn.multiply,Zr.disabled,fe,"ground_shadow",o.tileExtentBuffer,o.quadTriangleIndexBuffer,o.tileExtentSegments,null,o.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?gn.unblended:gn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(o){const d=this.painter.transform,g=d.calculatePosMatrix(o,d.worldSize);return i.az(g,this._cascades[this.painter.currentShadowCascade].matrix,g),Float32Array.from(g)}calculateShadowPassMatrixFromMatrix(o){return i.az(o,this._cascades[this.painter.currentShadowCascade].matrix,o),Float32Array.from(o)}setupShadows(o,d,g,S=0){if(!this.enabled)return;const C=this.painter.transform,M=this.painter.context,L=M.gl,B=this._uniformValues,q=new Float64Array(16),X=C.calculatePosMatrix(o,C.worldSize);for(let ee=0;ee<this._cascades.length;ee++)i.az(q,this._cascades[ee].matrix,X),B[ee===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(q),M.activeTexture.set(L.TEXTURE0+Yo.ShadowMap0+ee),this._cascades[ee].texture.bind(L.NEAREST,L.CLAMP_TO_EDGE);if(this.useNormalOffset=!!g,this.useNormalOffset){const ee=i.cT(o.canonical),Q=2/C.tileSize*i.aj/to.shadowMapResolution,ne=Q*this._cascades[0].boundingSphereRadius,fe=Q*this._cascades[this._cascades.length-1].boundingSphereRadius,de=(g==="vector-tile"?1:3)/Math.pow(2,S-o.canonical.z-(1-C.zoom+Math.floor(C.zoom)));B.u_shadow_normal_offset=[ee,ne*de,fe*de],B.u_shadow_bias=[6e-5,.0012,.012]}else B.u_shadow_bias=[36e-5,.0012,.012];d.setShadowUniformValues(M,B)}setupShadowsFromMatrix(o,d,g=!1){if(!this.enabled)return;const S=this.painter.context,C=S.gl,M=this._uniformValues,L=new Float64Array(16);for(let B=0;B<to.cascadeCount;B++)i.az(L,this._cascades[B].matrix,o),M[B===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(L),S.activeTexture.set(C.TEXTURE0+Yo.ShadowMap0+B),this._cascades[B].texture.bind(C.NEAREST,C.CLAMP_TO_EDGE);if(this.useNormalOffset=g,g){const B=to.normalOffset;M.u_shadow_normal_offset=[1,B,B],M.u_shadow_bias=[6e-5,.0012,.012]}else M.u_shadow_bias=[36e-5,.0012,.012];d.setShadowUniformValues(S,M)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(o,d,g,S){if(S[2]>=0)return{};const C=function(B,q,X){const ee=X/(1<<B.canonical.z);return new i.cV([B.canonical.x*ee+B.wrap*X,B.canonical.y*ee+B.wrap*X,0],[(B.canonical.x+1)*ee+B.wrap*X,(B.canonical.y+1)*ee+B.wrap*X,q])}(o,d,g).getCorners(),M=d/-S[2];S[0]<0?(i.cU(C[0],C[0],[S[0]*M,0,0]),i.cU(C[3],C[3],[S[0]*M,0,0])):S[0]>0&&(i.cU(C[1],C[1],[S[0]*M,0,0]),i.cU(C[2],C[2],[S[0]*M,0,0])),S[1]<0?(i.cU(C[0],C[0],[0,S[1]*M,0]),i.cU(C[1],C[1],[0,S[1]*M,0])):S[1]>0&&(i.cU(C[2],C[2],[0,S[1]*M,0]),i.cU(C[3],C[3],[0,S[1]*M,0]));const L={};return L.vertices=C,L.planes=[Kl(C[1],C[0],C[4]),Kl(C[2],C[1],C[5]),Kl(C[3],C[2],C[6]),Kl(C[0],C[3],C[7])],L}addShadowReceiver(o,d,g){this._receivers.add(o,i.cV.fromTileIdAndHeight(o,d,g))}getMaxCascadeForTile(o){const d=this._receivers.get(o);return d&&d.lastCascade?d.lastCascade:0}}function Kl(m,o,d){const g=i.at([],d,o),S=i.at([],m,o),C=i.bG([],g,S),M=i.ae(C);return M===0?[0,0,1,0]:(i.b$(C,C,1/M),[C[0],C[1],C[2],-i.bE(C,o)])}function Ef(m){const o=m.properties.get("direction"),d=i.cR(o.x,o.y,o.z);d[2]=i.aD(d[2],0,75);const g=i.cW([d[0],d[1],d[2]]);return i.cS(g.x,g.y,g.z)}function tl(m,o,d){const g=o.properties.get("color-use-theme")==="none",S=o.properties.get("color"),C=o.properties.get("intensity"),M=o.properties.get("direction"),L=[M.x,M.y,M.z],B=d.properties.get("color-use-theme")==="none",q=d.properties.get("color"),X=d.properties.get("intensity"),ee=Math.max(i.bE([0,0,1],L),0),Q=[0,0,0];i.b$(Q,q.toRenderColor(B?null:m.getLut(o.scope)).toArray01Linear().slice(0,3),X);const ne=[0,0,0];return i.b$(ne,S.toRenderColor(g?null:m.getLut(d.scope)).toArray01Linear().slice(0,3),ee*C),i.cX([Q[0]>0?Q[0]/(Q[0]+ne[0]):0,Q[1]>0?Q[1]/(Q[1]+ne[1]):0,Q[2]>0?Q[2]/(Q[2]+ne[2]):0])}function Np(m,o,d,g,S,C){const M=m.zoom,L=m.scale,B=m.worldSize,q=1/B,X=m.aspect,ee=Math.sqrt(1+X*X)*Math.tan(.5*m.fovX),Q=ee*ee,ne=g-d,fe=g+d;let de,ye;Q>ne/fe?(de=g,ye=g*ee):(de=.5*fe*(1+Q),ye=.5*Math.sqrt(ne*ne+2*(g*g+d*d)*Q+fe*fe*Q*Q));const he=m.projection.pixelsPerMeter(m.center.lat,B),Se=m._camera.getCameraToWorldMercator(),Ae=[0,0,-de*q];i.ad(Ae,Ae,Se);let Pe=ye*q;const Be=m._edgeInsets;if(!(Be.left===0&&Be.top===0&&Be.right===0&&Be.bottom===0||Be.left===Be.right&&Be.top===Be.bottom)){const zt=m._camera.getWorldToCamera(m.worldSize,m.projection.zAxisUnit==="meters"?he:1),Ot=m._camera.getCameraToClipPerspective(m._fov,m.width/m.height,d,g);Ot[8]=2*-m.centerOffset.x/m.width,Ot[9]=2*m.centerOffset.y/m.height;const $t=new Float64Array(16);i.cB($t,Ot,zt);const Ut=new Float64Array(16);i.bi(Ut,$t);const wr=i.cn.fromInvProjectionMatrix(Ut,B,M,!0);for(const Ar of wr.points){const dr=((Fe=Ar)[0]/=L,Fe[1]/=L,Fe[2]=i.c6(Fe[2],m._center.lat),Fe);Pe=Math.max(Pe,i.c0(i.cY([],Ae,dr)))}}var Fe;Pe*=S/(S-1);const je=Math.acos(o[2]),ke=Math.atan2(-o[0],-o[1]),qe=new Ro;qe.position=Ae,qe.setPitchBearing(je,ke);const Ze=qe.getWorldToCamera(B,he),yt=Pe*B,ut=Math.min(m._mercatorZfromZoom(17)*B*-2,-2*yt),At=qe.getCameraToClipOrthographic(-yt,yt,-yt,yt,ut,(yt+C*he)/o[2]),Mt=new Float64Array(16);i.az(Mt,At,Ze);const Zt=i.cS(Math.floor(1e6*Ae[0])/1e6*B,Math.floor(1e6*Ae[1])/1e6*B,0),at=.5*S,gt=[0,0,0];i.ad(gt,Zt,Mt),i.b$(gt,gt,at);const ot=[Math.floor(gt[0]),Math.floor(gt[1]),Math.floor(gt[2])],Lt=[0,0,0];i.at(Lt,gt,ot),i.b$(Lt,Lt,-1/at);const vt=new Float64Array(16);return i.bx(vt),i.bo(vt,vt,Lt),i.az(Mt,vt,Mt),[Mt,yt]}class Rc extends i.E{constructor(o){super(),this.requestManager=o,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(o,d){return i.aS(this.requestManager.transformRequest(d,i.R.Model).url).then(g=>{if(!g)return;const S=i.aT(g),C=new i.aU(o,void 0,void 0,S);return C.computeBoundsAndApplyParent(),C}).catch(g=>{if(g&&g.status===404)return null;this.fire(new i.z(new Error(`Could not load model ${o} from ${d}: ${g.message}`)))})}load(o,d,g={forceReload:!1}){this.models[d]||(this.models[d]={});const S=Object.keys(o),C=[],M=[];for(const L of S){const B=o[L];this.hasURLBeenRequested(B)&&!g.forceReload||(this.modelByURL[B]={modelId:L,scope:d},C.push(this.loadModel(L,B)),M.push(L)),this.models[d][L]||(this.models[d][L]={model:null,numReferences:1})}this.numModelsLoading[d]=(this.numModelsLoading[d]||0)+M.length,Promise.allSettled(C).then(L=>{for(let B=0;B<L.length;B++){const{status:q}=L[B];if(q==="rejected")continue;const{value:X}=L[B];this.models[d][M[B]]||(this.models[d][M[B]]={model:null,numReferences:1}),this.models[d][M[B]].model=X}this.numModelsLoading[d]-=M.length,this.fire(new i.A("data",{dataType:"style"}))}).catch(L=>{this.fire(new i.z(new Error(`Could not load models: ${L.message}`)))})}isLoaded(){for(const o in this.numModelsLoading)if(this.numModelsLoading[o]>0)return!1;return!0}hasModel(o,d,g={exactIdMatch:!1}){return!!(g.exactIdMatch?this.getModel(o,d):this.getModelByURL(this.modelUris[d][o]))}getModel(o,d){return this.models[d]||(this.models[d]={}),this.models[d][o]?this.models[d][o].model:void 0}getModelByURL(o){if(!o)return null;const d=this.modelByURL[o];return d?this.models[d.scope][d.modelId].model:null}hasModelBeenAdded(o,d){return this.models[d]&&this.models[d][o]!==void 0}getModelURIs(o){return this.modelUris[o]||{}}addModel(o,d,g){this.models[g]||(this.models[g]={}),this.modelUris[g]||(this.modelUris[g]={});const S=this.requestManager.normalizeModelURL(d);if((this.hasModel(o,g,{exactIdMatch:!0})||this.hasModelBeenAdded(o,g))&&this.modelUris[g][o]===S)this.models[g][o].numReferences++;else if(this.hasURLBeenRequested(S)){const{scope:C,modelId:M}=this.modelByURL[S];this.models[C][M].numReferences++}else this.modelUris[g][o]=S,this.load({[o]:this.modelUris[g][o]},g)}addModelURLs(o,d){this.models[d]||(this.models[d]={}),this.modelUris[d]||(this.modelUris[d]={});const g=this.modelUris[d];for(const S in o)g[S]=this.requestManager.normalizeModelURL(o[S])}reloadModels(o){this.load(this.modelUris[o],o,{forceReload:!0})}addModelsFromBucket(o,d){this.models[d]||(this.models[d]={}),this.modelUris[d]||(this.modelUris[d]={});const g={};for(const S of o)this.hasModel(S,d,{exactIdMatch:!0})||this.hasURLBeenRequested(S)?this.models[d][S].numReferences++:this.modelUris[d][S]&&!this.hasURLBeenRequested(S)?g[S]=this.modelUris[d][S]:!this.hasURLBeenRequested(S)&&i.cZ(S,!1)&&(this.modelUris[d][S]=this.requestManager.normalizeModelURL(S),g[S]=this.modelUris[d][S]);this.load(g,d)}hasURLBeenRequested(o){return this.modelByURL[o]!==void 0}removeModel(o,d,g=!1){if(this.models[d]&&this.models[d][o]&&(this.models[d][o].numReferences--,this.models[d][o].numReferences===0)){const S=this.modelUris[d][o];g||delete this.modelUris[d][o],delete this.modelByURL[S];const C=this.models[d][o].model;if(!C)return;delete this.models[d][o],C.destroy()}}destroy(){for(const o of Object.keys(this.models))for(const d of Object.keys(this.models[o])){const g=this.models[o][d].model;delete this.models[o][d],g&&g.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(o){return this.models[o]||(this.models[o]={}),Object.keys(this.models[o])}upload(o,d){this.models[d]||(this.models[d]={});for(const g in this.models[d])this.models[d][g].model&&this.models[d][g].model.upload(o.context)}}const Fy=new i.a7({data:new i.a8(i.a5.colorTheme.data)}),W_={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function By(m){return m=m||{},Object.assign(m,W_)}class $y extends i.E{constructor(o){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},i.aV(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=o,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(o=>{o.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new i.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=o.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=o.stylesheet.indoor.buildingFeaturesetId,this._scope=o.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:o=>(o.feature&&o.feature.properties.floorplan&&this.selectFloorplan(o.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(o){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(M,L){const[B,q]=M,{center:X,radius:ee}=L,[Q,ne]=X,fe=Math.abs(B-Q);return Math.sqrt((fe>180?360-fe:fe)**2+(q-ne)**2)<=ee}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new i.A("floorplangone")));const d={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},g=new i.P(this._map.transform.width/2,this._map.transform.height/2),S=[new i.P(0,0),new i.P(this._map.transform.width,this._map.transform.height)],C=this._map.queryRenderedFeatures(o?S:g,d);C.length>0&&(this._selectedFloorplan&&C[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=C[0],this._floorplanSelected(!1)))}_floorplanSelected(o){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(C){const[[M,L],[B,q]]=C,X=(B-M+360)%360,ee=X>180?360-X:X;return{center:[(M+ee/2+360)%360,(L+q)/2],radius:Math.sqrt(ee**2+(q-L)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const d=this._floorplanStates[this._indoorData.id].selectedBuilding,g=this._floorplanStates[this._indoorData.id].selectedLevel;let S;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const C of this._indoorData.levels)C.id===this._selectedLevel.id&&(S=C.id);if(this.fire(new i.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:S})),d){const C=this._indoorData.buildings.find(M=>M.id===d);this._buildingSelected(C,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(g){const C=this._indoorData.levels.find(M=>M.id===g);this._updateLevels(C,o)}else o&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(o,d){d&&o&&o.extent&&this._map.fitBounds(o.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=o?o.id:void 0;const g=this._indoorData.levels.filter(S=>o.levels.includes(S.id));this.fire(new i.A("buildingselected",{buildingId:o.id,levels:g}))}_levelSelected(o){if(o==="overview")this._updateLevels(void 0,!0);else{const d=this._indoorData.levels.find(g=>g.id===o);this._updateLevels(d,!0)}this.fire(new i.A("levelselected",{levelId:o==="overview"?void 0:o}))}_updateLevels(o,d){if(!o)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(d&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function g(q){const X=q.indexOf("/floor/");if(X===-1)return q;const ee=X+7,Q=q.indexOf("/",ee);return Q===-1?q.slice(ee):q.slice(ee,Q)}this._selectedLevel=o,this._floorplanStates[this._indoorData.id].selectedLevel=o?o.id:void 0;const S=[],C={},M={},L={},B={};for(const q of this._indoorData.levels)if(S.push(q.id),C[q.id]=q.height,M[q.id]=q.base,o){if(this.mergeFloors){const X=g(o.id),ee=g(q.id);L[q.id]=ee===X?"true":"false"}else L[q.id]=q.id===o.id?"true":"false";B[q.id]=q.base<o.base?"true":"false"}else B[q.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",S]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",C]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",M]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",L]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",B]),o&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!o.isUnderground),d&&o.extent)){const q=this._map.cameraForBounds(o.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),X=this._map.getZoom(),ee=q.zoom?Math.abs(X-q.zoom):0;this._map.fitBounds(o.extent,ee>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:X})}}selectFloorplan(o){const d={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},g=[new i.P(0,0),new i.P(this._map.transform.width,this._map.transform.height)],S=this._map.queryRenderedFeatures(g,d);if(S.length>0){for(const C of S)if(JSON.parse(C.properties["indoor-data"]).floorplanIDs.includes(o)){this._selectedFloorplan=C,this._floorplanSelected(!0);break}}}selectBuilding(o){const d=this._indoorData.buildings.find(g=>g.id===o);this._buildingSelected(d,!0)}selectLevel(o){this._levelSelected(o)}}function Z_(m){if(!m.metadata||!m.metadata.content_area)return;const o=i.q.devicePixelRatio,{left:d,top:g,width:S,height:C}=m.metadata.content_area,M=d*o,L=g*o;return[M,L,M+S*o,L+C*o]}function zp(m){if(m)return m.map(([o,d])=>[o*i.q.devicePixelRatio,d*i.q.devicePixelRatio])}class rl{constructor(o,d,g){this.id=o,this.scope=d,this.sourceCache=g,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(o){this.missingRequests.has(o.name)||this.pendingRequests.has(o.name)||this.pendingRequests.add(o.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const o=new Map;if(!this.sourceCache.loaded())return o;const d=this.sourceCache.getVisibleCoordinates();if(d.length===0)return o;const g=this.sourceCache.getSource();if(!(g instanceof nd))return o;const S=d.map(M=>this.sourceCache.getTile(M)),C=g.getImages(S,Array.from(this.pendingRequests));for(const[M,L]of C)o.set(i.I.from({name:M,iconsetId:this.id}),L),this.pendingRequests.delete(M);for(const M of this.pendingRequests)this.missingRequests.add(M);return this.pendingRequests.clear(),o}}const nl=(m,o)=>rt(m,o&&o.filter(d=>d.identifier!=="source.canvas")),ug=i.aF(Un,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),dg=i.aF(Un,["setCenter","setZoom","setBearing","setPitch"]),Yl=new Set(["background","sky","slot","custom"]),gh={version:8,layers:[],sources:{}},Tf={duration:300,delay:0};class il extends i.E{constructor(o,d={}){super(),this.map=o,this.scope=d.scope||"",this.globalId=null,this.fragments=[],this.importDepth=d.importDepth||0,this.importsCache=d.importsCache||new Map,this.resolvedImports=d.resolvedImports||new Set,this.transition=i.l({},Tf),this._buildingIndex=new sh(this),this.crossTileSymbolIndex=new Fs,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=d.styleChanges||new Rt,this.dispatcher=d.dispatcher?d.dispatcher:new i.D(i.d0(),this),d.imageManager?this.imageManager=d.imageManager:(this.imageManager=new sr(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=d.glyphManager?d.glyphManager:new i.d1(o._requestManager,d.localFontFamily?i.d2.all:d.localIdeographFontFamily?i.d2.ideographs:i.d2.none,d.localFontFamily||d.localIdeographFontFamily),d.modelManager?this.modelManager=d.modelManager:(this.modelManager=new Rc(o._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=d.configOptions?d.configOptions:new Map,this._configDependentLayers=d.configDependentLayers?d.configDependentLayers:new Set,this._config=d.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:d.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=d.initialConfig,this.dispatcher.broadcast("setReferrer",i.d3());const g=this;this._rtlTextPluginCallback=il.registerForPluginStateChange(S=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:S.pluginStatus,pluginURL:S.pluginURL},(C,M)=>{if(i.d4(C),M&&M.every(L=>L))for(const L in g._sourceCaches){const B=g._sourceCaches[L],q=B.getSource().type;q!=="vector"&&q!=="geojson"||B.reload()}})}),this.on("data",S=>{if(S.dataType!=="source"||S.sourceDataType!=="metadata")return;const C=this.getOwnSource(S.sourceId);if(C&&C.vectorLayerIds)for(const M in this._layers){const L=this._layers[M];L.source===C.id&&this._validateLayer(L)}})}load(o){return o?(typeof o=="string"?this.loadURL(o):this.loadJSON(o),this):this}_getGlobalId(o){if(!o)return null;if(typeof o=="string"){if(i.f(o))return o;const d=i.d5(o);if(!d.startsWith("http"))try{return new URL(d,location.href).toString()}catch{return d}return d}return`json://${i.d6(JSON.stringify(o))}`}_diffStyle(o,d,g){this.globalId=this._getGlobalId(o);const S=(C,M)=>{try{M(null,this.setState(C,g))}catch(L){M(L,!1)}};if(typeof o=="string"){const C=this.map._requestManager.normalizeStyleURL(o),M=this.map._requestManager.transformRequest(C,i.R.Style);i.n(M,(L,B)=>{L?this.fire(new i.z(L)):B&&S(B,d)})}else typeof o=="object"&&S(o,d)}loadURL(o,d={}){this.fire(new i.A("dataloading",{dataType:"style"}));const g=typeof d.validate=="boolean"?d.validate:!i.f(o);this.globalId=this._getGlobalId(o),o=this.map._requestManager.normalizeStyleURL(o,d.accessToken),this.resolvedImports.add(o);const S=this.importsCache.get(o);if(S)return this._load(S,g);const C=this.map._requestManager.transformRequest(o,i.R.Style);this._request=i.n(C,(M,L)=>{if(this._request=null,M)this.fire(new i.z(M));else if(L)return this.importsCache.set(o,L),this._load(L,g)})}loadJSON(o,d={}){this.fire(new i.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(o),this._request=i.q.frame(()=>{this._request=null,this._load(o,d.validate!==!1)})}loadEmpty(){this.fire(new i.A("dataloading",{dataType:"style"})),this._load(gh,!1)}_loadImports(o,d,g){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const S=[];for(const C of o){const M=this._createFragmentStyle(C),L=new Promise(X=>{M.once("style.import.load",X),M.once("error",X)}).then(()=>this.mergeAll());if(S.push(L),this.resolvedImports.has(C.url)){M.loadEmpty();continue}const B=C.data||this.importsCache.get(C.url);B?(M.loadJSON(B,{validate:d}),this._isInternalStyle(B)&&(M.globalId=null)):C.url?M.loadURL(C.url,{validate:d}):M.loadEmpty();const q={style:M,id:C.id,config:C.config};if(g){const X=this.fragments.findIndex(({id:ee})=>ee===g);this.fragments=this.fragments.slice(0,X).concat(q).concat(this.fragments.slice(X))}else this.fragments.push(q)}return Promise.allSettled(S)}getImportGlobalIds(o=this,d=new Set){for(const g of o.fragments)g.style.globalId&&d.add(g.style.globalId),this.getImportGlobalIds(g.style,d);return[...d.values()]}_createFragmentStyle(o){const d=this.scope?i.C(o.id,this.scope):o.id;let g;const S=this._initialConfig&&this._initialConfig[d];(o.config||S)&&(g=i.l({},o.config,S));const C=new il(this.map,{scope:d,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:g,configOptions:this.options,colorThemeOverride:o["color-theme"],configDependentLayers:this._configDependentLayers});return C.setEventedParent(this.map,{style:C}),C}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(o){return this.isRootStyle()&&(o.fragment||!!o.schema&&o.fragment!==!1)}_load(o,d){const g=o.indoor?By(o.schema):o.schema;if(this._isInternalStyle(o)){const M=i.l({},gh,{imports:[{id:"basemap",data:o,url:""}]});return void this._load(M,d)}if(this.updateConfig(this._config,g),d&&nl(this,_s(o)))return;this._loaded=!0,this.stylesheet=i.d7(o);const S=()=>{for(const q in o.sources)this.addSource(q,o.sources[q],{validate:!1,isInitialLoad:!0});if(o.iconsets)for(const q in o.iconsets)this.addIconset(q,o.iconsets[q]);o.sprite?this._loadIconset(o.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(o.glyphs);const M=Sl(this.stylesheet.layers);if(this._order=M.map(q=>q.id),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const q=this.stylesheet.lights[0];this.light=new mt(q.properties,q.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new mt(this.stylesheet.light)),this._layers={};for(const q of M){const X=i.dc(q,this.scope,this._styleColorTheme.lut,this.options);X.configDependencies.size!==0&&this._configDependentLayers.add(X.fqid),X.setEventedParent(this,{layer:{id:X.id}}),this._layers[X.id]=X;const ee=this.getOwnLayerSourceCache(X),Q=!!this.directionalLight&&this.directionalLight.shadowsEnabled();ee&&X.canCastShadows()&&Q&&(ee.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const L=this.stylesheet.terrain;L&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(L,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.A("data",{dataType:"style"}));const B=this.isRootStyle();o.imports?this._loadImports(o.imports,d).then(()=>{this._reloadImports(),this.fire(new i.A(B?"style.load":"style.import.load"))}).catch(q=>{this.fire(new i.z(new Error("Failed to load imports",q))),this.fire(new i.A(B?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new i.A(B?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const C=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(C){const M=this._evaluateColorThemeData(C);this._loadColorTheme(M).then(()=>{S()}).catch(L=>{i.w(`Couldn't load color theme from the stylesheet: ${L}`),S()})}else this._styleColorTheme.lut=null,S()}isRootStyle(){return this.importDepth===0}mergeAll(){let o,d,g,S,C,M,L,B,q,X;const ee={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(Q=>{if(Q.stylesheet){if(Q.light!=null&&(o=Q.light),Q.stylesheet.lights)for(const ne of Q.stylesheet.lights)ne.type==="ambient"&&Q.ambientLight!=null&&(d=Q.ambientLight),ne.type==="directional"&&Q.directionalLight!=null&&(g=Q.directionalLight);S=this._prioritizeTerrain(S,Q.terrain,Q.stylesheet.terrain),Q.stylesheet.fog&&Q.fog!=null&&(C=Q.fog),Q.stylesheet.snow&&Q.snow!=null&&(M=Q.snow),Q.stylesheet.rain&&Q.rain!=null&&(L=Q.rain),Q.stylesheet.camera!=null&&(X=Q.stylesheet.camera),Q.stylesheet.projection!=null&&(B=Q.stylesheet.projection),Q.stylesheet.transition!=null&&(q=Q.stylesheet.transition),ee[Q.scope]=Q._styleColorTheme}}),this.light=o,this.ambientLight=d,this.directionalLight=g,this.fog=C,this.snow=M,this.rain=L,this._styleColorThemeForScope=ee,S===null?delete this.terrain:this.terrain=S,this.camera=X||{"camera-projection":"perspective"},this.projection=B||{name:"mercator"},this.transition=i.l({},Tf,q),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(o){const d=g=>{for(const S of g.fragments)d(S.style);o(g)};d(this)}_prioritizeTerrain(o,d,g){const S=o&&o.drapeRenderMode===0;return g===null?d&&d.drapeRenderMode===0?d:S?o:null:d!=null&&(!o||S||d&&d.drapeRenderMode===1)?d:o}mergeTerrain(){let o;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(d=>{o=this._prioritizeTerrain(o,d.terrain,d.stylesheet.terrain)}),o===null?delete this.terrain:this.terrain=o}mergeProjection(){let o;this.forEachFragmentStyle(d=>{d.stylesheet.projection!=null&&(o=d.stylesheet.projection)}),this.projection=o||{name:"mercator"}}mergeSources(){const o={},d={},g={};this.forEachFragmentStyle(S=>{for(const C in S._sourceCaches){const M=i.C(C,S.scope);o[M]=S._sourceCaches[C]}for(const C in S._otherSourceCaches){const M=i.C(C,S.scope);d[M]=S._otherSourceCaches[C]}for(const C in S._symbolSourceCaches){const M=i.C(C,S.scope);g[M]=S._symbolSourceCaches[C]}}),this._mergedSourceCaches=o,this._mergedOtherSourceCaches=d,this._mergedSymbolSourceCaches=g}mergeLayers(){const o={},d=[],g={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(C=>{for(const M of C._order){const L=C._layers[M];if(L.type==="slot"){const B=i.d8(M);if(o[B])continue;o[B]=[]}L.slot&&o[L.slot]?o[L.slot].push(L):d.push(L)}}),this._mergedOrder=[];const S=(C=[])=>{for(const M of C)if(M.type==="slot"){const L=i.d8(M.id);o[L]&&S(o[L]),this._mergedSlots.push(L)}else{const L=i.C(M.id,M.scope);this._mergedOrder.push(L),g[L]=M,M.is3D(!!this.terrain)&&(this._has3DLayers=!0),M.type==="circle"&&(this._hasCircleLayers=!0),M.type==="symbol"&&(this._hasSymbolLayers=!0),M.type==="clip"&&(this._clipLayerPresent=!0)}};S(d),this._mergedOrder.sort((C,M)=>{const L=g[C],B=g[M];return L.hasInitialOcclusionOpacityProperties?B.is3D(!!this.terrain)?1:0:L.is3D(!!this.terrain)&&B.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=g,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(o){return this.stylesheet.camera=i.l({},this.stylesheet.camera,o),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(o){return o.data?function(d,g,S){const C=i.l({},g);for(const L of Object.keys(i.a5.colorTheme))C[L]===void 0&&(C[L]=i.a5.colorTheme[L].default);const M=new i.a6(Fy,d,new Map(S));return M.setTransitionOrValue(C,S),M.untransitioned().possiblyEvaluate(new i.aa(0))}(this.scope,o,this.options).get("data"):null}_loadColorTheme(o){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const d=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((g,S)=>{const C="data:image/png;base64,";if(!o||o.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void g();let M=o;M.startsWith(C)||(M=C+M);const L=i.I.from("mapbox-reserved-lut"),B=new Image;B.src=M,B.onerror=()=>{this._styleColorTheme.lutLoading=!1,S(new Error("Failed to load image data"))},B.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==d)return void g();this._styleColorTheme.lutLoading=!1;const{width:q,height:X,data:ee}=i.q.getImageData(B);if(X>32)return void S(new Error("The height of the image must be less than or equal to 32 pixels."));if(q!==X*X)return void S(new Error("The width of the image must be equal to the height squared."));this.getImage(L)&&this.removeImage(L),this.addImage(L,{data:new i.r({width:q,height:X},ee),pixelRatio:1,sdf:!1,usvg:!1,version:0});const Q=this.imageManager.getImage(L,this.scope);Q?(this._styleColorTheme.lut={image:Q.data,data:o},g()):S(new Error("Missing LUT image."))}})}getLut(o){const d=this._styleColorThemeForScope[o];return d?d.lut:null}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(o){this._spriteRequest=function(d,g,S){let C,M,L;const B=i.q.devicePixelRatio>1?"@2x":"";let q=i.n(g.transformRequest(g.normalizeSpriteURL(d,B,".json"),i.R.SpriteJSON),(Q,ne)=>{q=null,L||(L=Q,C=ne,ee())}),X=i.o(g.transformRequest(g.normalizeSpriteURL(d,B,".png"),i.R.SpriteImage),(Q,ne)=>{X=null,L||(L=Q,M=ne,ee())});function ee(){if(L)S(L);else if(C&&M){const Q=i.q.getImageData(M),ne={};for(const fe in C){const{width:de,height:ye,x:he,y:Se,sdf:Ae,pixelRatio:Pe,stretchX:Be,stretchY:Fe,content:je}=C[fe],ke=new i.r({width:de,height:ye});i.r.copy(Q,ke,{x:he,y:Se},{x:0,y:0},{width:de,height:ye},null),ne[fe]={data:ke,pixelRatio:Pe,sdf:Ae,stretchX:Be,stretchY:Fe,content:je,usvg:!1}}S(null,ne)}}return{cancel(){q&&(q.cancel(),q=null),X&&(X.cancel(),X=null)}}}(o,this.map._requestManager,(d,g)=>{if(this._spriteRequest=null,d)this.fire(new i.z(d));else if(g){const S=new Map;for(const C in g)S.set(i.I.from(C),g[C]);this.addImages(S)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.A("data",{dataType:"style"}))})}addIconset(o,d){if(d.type==="sprite")return void this._loadSprite(d.url);const g=this.getOwnSourceCache(d.source);if(!g)return void this.fire(new i.z(new Error(`Source "${d.source}" as specified by iconset "${o}" does not exist and cannot be used as an iconset source`)));const S=g.getSource();if(S.type!=="raster-array")return void this.fire(new i.z(new Error(`Source "${d.source}" as specified by iconset "${o}" is not a "raster-array" source and cannot be used as an iconset source`)));S.partial=!1;const C=new rl(o,this.scope,g);this.imageManager.addImageProvider(C,this.scope)}removeIconset(o){this.imageManager.removeImageProvider(o,this.scope)}_loadIconset(o){if(!i.f(o)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(o);const d=this.map._spriteFormat==="auto";var g,S;this._spriteRequest=(S=(C,M)=>{if(this._spriteRequest=null,C)d?this._loadSprite(o):this.fire(new i.z(C));else if(M){const L=new Map;for(const B in M)L.set(i.I.from(B),M[B]);this.addImages(L)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.A("data",{dataType:"style"}))},i.br((g=this.map._requestManager).transformRequest(g.normalizeIconsetURL(o),i.R.Iconset),(C,M)=>{if(C)return void S(C);const L={},B=i.c_(new i.bq(M));for(const q of B.icons){const X={version:1,pixelRatio:i.q.devicePixelRatio,content:Z_(q),stretchX:q.metadata?zp(q.metadata.stretch_x_areas):void 0,stretchY:q.metadata?zp(q.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:q};L[q.name]=X}S(null,L)}))}_validateLayer(o){const d=this.getOwnSource(o.source);if(!d)return;const g=o.sourceLayer;g&&(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(g)===-1)&&this.fire(new i.z(new Error(`Source layer "${g}" does not exist on source "${d.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:o}of this.fragments)if(!o.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((o,d)=>{const g=this.fragments[d];return g&&g.style&&(o.data=g.style.serialize()),o})}_serializeSources(){const o={};for(const d in this._sourceCaches){const g=this._sourceCaches[d].getSource();o[g.id]||(o[g.id]=g.serialize())}return o}_serializeLayers(o){const d=[];for(const g of o){const S=this._layers[g];S&&S.type!=="custom"&&d.push(S.serialize())}return d}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(o){return o?this.order:this._mergedOrder}isLayerDraped(o){return!!this.terrain&&o.isDraped(this.getLayerSourceCache(o))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(o){const d=this.getOwnLayer(o);if(d)return d;this.fire(new i.z(new Error(`The layer '${o}' does not exist in the map's style.`)))}_checkSource(o){const d=this.getOwnSource(o);if(d)return d;this.fire(new i.z(new Error(`The source '${o}' does not exist in the map's style.`)))}precompilePrograms(o,d){const g=this.map.painter;if(g)for(let S=o.minzoom||0;S<(o.maxzoom||25.5);S++){const C=o.getProgramIds();if(C)for(const M of C){const L=o.getDefaultProgramParams(M,d.zoom,this._styleColorTheme.lut);L&&(g.style=this,this.fog&&(g._fogVisible=!0,L.overrideFog=!0,g.getOrCreateProgram(M,L)),g._fogVisible=!1,L.overrideFog=!1,g.getOrCreateProgram(M,L),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(L.overrideRtt=!0,g.getOrCreateProgram(M,L)))}}}update(o){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(o),this.directionalLight&&this.directionalLight.recalculate(o);const d=this.calculateLightsBrightness();o.brightness=d||0,d!==this._brightness&&(this._brightness=d,this.dispatcher.broadcast("setBrightness",d));const g=this._changes.isDirty();let S=!1;if(this._changes.isDirty()){const L=this._changes.getLayerUpdatesByScope();for(const B in L){const{updatedIds:q,removedIds:X}=L[B];(q||X)&&(this._updateWorkerLayers(B,q,X),S=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(o),this.light&&this.light.updateTransitions(o),this.ambientLight&&this.ambientLight.updateTransitions(o),this.directionalLight&&this.directionalLight.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this.snow&&this.snow.updateTransitions(o),this.rain&&this.rain.updateTransitions(o),this._changes.reset()}const C={};for(const L in this._mergedSourceCaches){const B=this._mergedSourceCaches[L];C[L]=B.used,B.used=!1,B.tileCoverLift=0}for(const L of this._mergedOrder){const B=this._mergedLayers[L];if(B.recalculate(o,this._availableImages),!B.isHidden(o.zoom)){const q=this.getLayerSourceCache(B);q&&(q.used=!0,q.tileCoverLift=Math.max(q.tileCoverLift,B.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(B,o)}):this.precompilePrograms(B,o))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&S&&this.mergeLayers();const M=this.imageManager.getPendingImageProviders();for(const L of M)L.sourceCache.used=!0;for(const L in C){const B=this._mergedSourceCaches[L];C[L]!==B.used&&B.getSource().fire(new i.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:B.getSource().id}))}this.light&&this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.snow&&this.snow.recalculate(o),this.rain&&this.rain.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),g&&this.fire(new i.A("data",{dataType:"style"}))}updateImageProviders(){const o=this.imageManager.getPendingImageProviders();for(const d of o){const g=d.resolvePendingRequests(),S=this.getFragmentStyle(d.scope);S&&S.addImages(g)}}_updateTilesForChangedImages(){const o={};for(const d in this._mergedSourceCaches){const g=this._mergedSourceCaches[d].getSource().scope;o[g]=o[g]||this._changes.getUpdatedImages(g),o[g].length!==0&&this._mergedSourceCaches[d].reloadTilesForDependencies(["icons","patterns"],o[g])}for(const d in o)this._changes.resetUpdatedImages(d)}_updateWorkerLayers(o,d,g){const S=this.getFragmentStyle(o);S&&this.dispatcher.broadcast("updateLayers",{layers:d?S._serializeLayers(d):[],scope:o,removedIds:g||[],options:S.options})}setState(o,d){if(this._checkLoaded(),nl(this,_s(o)))return!1;(o=i.d7(o)).layers=Sl(o.layers);const g=function(M,L){if(!M)return[{command:Un.setStyle,args:[L]}];let B=[];try{if(!i.bv(M.version,L.version))return[{command:Un.setStyle,args:[L]}];if(i.bv(M.center,L.center)||B.push({command:Un.setCenter,args:[L.center]}),i.bv(M.zoom,L.zoom)||B.push({command:Un.setZoom,args:[L.zoom]}),i.bv(M.bearing,L.bearing)||B.push({command:Un.setBearing,args:[L.bearing]}),i.bv(M.pitch,L.pitch)||B.push({command:Un.setPitch,args:[L.pitch]}),i.bv(M.sprite,L.sprite)||B.push({command:Un.setSprite,args:[L.sprite]}),i.bv(M.glyphs,L.glyphs)||B.push({command:Un.setGlyphs,args:[L.glyphs]}),i.bv(M.imports,L.imports)||function(ne=[],fe=[],de){fe=fe||[];const ye=(ne=ne||[]).map(Ic),he=fe.map(Ic),Se=ne.reduce(oh,{}),Ae=fe.reduce(oh,{}),Pe=ye.slice();let Be,Fe,je,ke;for(Be=0,Fe=0;Be<ye.length;Be++)je=ye[Be],Ae.hasOwnProperty(je)?Fe++:(de.push({command:Un.removeImport,args:[je]}),Pe.splice(Pe.indexOf(je,Fe),1));for(Be=0,Fe=0;Be<he.length;Be++)je=he[he.length-1-Be],Pe[Pe.length-1-Be]!==je&&(Se.hasOwnProperty(je)?(de.push({command:Un.removeImport,args:[je]}),Pe.splice(Pe.lastIndexOf(je,Pe.length-Fe),1)):Fe++,ke=Pe[Pe.length-Be],de.push({command:Un.addImport,args:[Ae[je],ke]}),Pe.splice(Pe.length-Be,0,je));for(const qe of fe){const Ze=Se[qe.id];Ze&&!i.bv(Ze,qe)&&de.push({command:Un.updateImport,args:[qe.id,qe]})}}(M.imports,L.imports,B),i.bv(M.transition,L.transition)||B.push({command:Un.setTransition,args:[L.transition]}),i.bv(M.light,L.light)||B.push({command:Un.setLight,args:[L.light]}),i.bv(M.fog,L.fog)||B.push({command:Un.setFog,args:[L.fog]}),i.bv(M.snow,L.snow)||B.push({command:Un.setSnow,args:[L.snow]}),i.bv(M.rain,L.rain)||B.push({command:Un.setRain,args:[L.rain]}),i.bv(M.projection,L.projection)||B.push({command:Un.setProjection,args:[L.projection]}),i.bv(M.lights,L.lights)||B.push({command:Un.setLights,args:[L.lights]}),i.bv(M.camera,L.camera)||B.push({command:Un.setCamera,args:[L.camera]}),i.bv(M.iconsets,L.iconsets)||function(ne,fe,de){let ye;for(ye in fe=fe||{},ne=ne||{})ne.hasOwnProperty(ye)&&(fe.hasOwnProperty(ye)||de.push({command:Un.removeIconset,args:[ye]}));for(ye in fe){if(!fe.hasOwnProperty(ye))continue;const he=fe[ye];ne.hasOwnProperty(ye)?i.bv(ne[ye],he)||(de.push({command:Un.removeIconset,args:[ye]}),de.push({command:Un.addIconset,args:[ye,he]})):de.push({command:Un.addIconset,args:[ye,he]})}}(M.iconsets,L.iconsets,B),!i.bv(M["color-theme"],L["color-theme"]))return[{command:Un.setStyle,args:[L]}];const q={},X=[];(function(ne,fe,de,ye){let he;for(he in fe=fe||{},ne=ne||{})ne.hasOwnProperty(he)&&(fe.hasOwnProperty(he)||ql(he,de,ye));for(he in fe){if(!fe.hasOwnProperty(he))continue;const Se=fe[he];ne.hasOwnProperty(he)?i.bv(ne[he],Se)||(ne[he].type==="geojson"&&Se.type==="geojson"&&og(ne,fe,he)?de.push({command:Un.setGeoJSONSourceData,args:[he,Se.data]}):q_(he,fe,de,ye)):od(he,fe,de)}})(M.sources,L.sources,X,q);const ee=[];M.layers&&M.layers.forEach(ne=>{ne.source&&q[ne.source]?B.push({command:Un.removeLayer,args:[ne.id]}):ee.push(ne)});let Q=M.terrain;Q&&q[Q.source]&&(B.push({command:Un.setTerrain,args:[void 0]}),Q=void 0),B=B.concat(X),i.bv(Q,L.terrain)||B.push({command:Un.setTerrain,args:[L.terrain]}),function(ne,fe,de){fe=fe||[];const ye=(ne=ne||[]).map(Ic),he=fe.map(Ic),Se=ne.reduce(oh,{}),Ae=fe.reduce(oh,{}),Pe=ye.slice(),Be=Object.create(null);let Fe,je,ke,qe,Ze,yt,ut;for(Fe=0,je=0;Fe<ye.length;Fe++)ke=ye[Fe],Ae.hasOwnProperty(ke)?je++:(de.push({command:Un.removeLayer,args:[ke]}),Pe.splice(Pe.indexOf(ke,je),1));for(Fe=0,je=0;Fe<he.length;Fe++)ke=he[he.length-1-Fe],Pe[Pe.length-1-Fe]!==ke&&(Se.hasOwnProperty(ke)?(de.push({command:Un.removeLayer,args:[ke]}),Pe.splice(Pe.lastIndexOf(ke,Pe.length-je),1)):je++,yt=Pe[Pe.length-Fe],de.push({command:Un.addLayer,args:[Ae[ke],yt]}),Pe.splice(Pe.length-Fe,0,ke),Be[ke]=!0);for(Fe=0;Fe<he.length;Fe++)if(ke=he[Fe],qe=Se[ke],Ze=Ae[ke],!Be[ke]&&!i.bv(qe,Ze))if(i.bv(qe.source,Ze.source)&&i.bv(qe["source-layer"],Ze["source-layer"])&&i.bv(qe.type,Ze.type)){for(ut in Gl(qe.layout,Ze.layout,de,ke,null,Un.setLayoutProperty),Gl(qe.paint,Ze.paint,de,ke,null,Un.setPaintProperty),i.bv(qe.slot,Ze.slot)||de.push({command:Un.setSlot,args:[ke,Ze.slot]}),i.bv(qe.filter,Ze.filter)||de.push({command:Un.setFilter,args:[ke,Ze.filter]}),i.bv(qe.minzoom,Ze.minzoom)&&i.bv(qe.maxzoom,Ze.maxzoom)||de.push({command:Un.setLayerZoomRange,args:[ke,Ze.minzoom,Ze.maxzoom]}),qe)qe.hasOwnProperty(ut)&&ut!=="layout"&&ut!=="paint"&&ut!=="filter"&&ut!=="metadata"&&ut!=="minzoom"&&ut!=="maxzoom"&&ut!=="slot"&&(ut.indexOf("paint.")===0?Gl(qe[ut],Ze[ut],de,ke,ut.slice(6),Un.setPaintProperty):i.bv(qe[ut],Ze[ut])||de.push({command:Un.setLayerProperty,args:[ke,ut,Ze[ut]]}));for(ut in Ze)Ze.hasOwnProperty(ut)&&!qe.hasOwnProperty(ut)&&ut!=="layout"&&ut!=="paint"&&ut!=="filter"&&ut!=="metadata"&&ut!=="minzoom"&&ut!=="maxzoom"&&ut!=="slot"&&(ut.indexOf("paint.")===0?Gl(qe[ut],Ze[ut],de,ke,ut.slice(6),Un.setPaintProperty):i.bv(qe[ut],Ze[ut])||de.push({command:Un.setLayerProperty,args:[ke,ut,Ze[ut]]}))}else de.push({command:Un.removeLayer,args:[ke]}),yt=Pe[Pe.lastIndexOf(ke)+1],de.push({command:Un.addLayer,args:[Ze,yt]})}(ee,L.layers,B)}catch(q){console.warn("Unable to compute style diff:",q),B=[{command:Un.setStyle,args:[L]}]}return B}(this.serialize(),o).filter(M=>!(M.command in dg));if(g.length===0)return!1;const S=g.filter(M=>!(M.command in ug));if(S.length>0)throw new Error(`Unimplemented: ${S.map(M=>M.command).join(", ")}.`);const C=[];return g.forEach(M=>{C.push(this[M.command](...M.args))}),d&&Promise.all(C).then(d).catch(d),this.stylesheet=o,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(o){for(const[d,g]of o.entries()){if(this.getImage(d))return this.fire(new i.z(new Error(`An image with the name "${d.name}" already exists.`)));this.imageManager.addImage(d,this.scope,g),this._changes.updateImage(d,this.scope)}return this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this}addImage(o,d){return this.getImage(o)?this.fire(new i.z(new Error(`An image with the name "${o.name}" already exists.`))):(this.imageManager.addImage(o,this.scope,d),this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this)}updateImage(o,d,g=!1){this.imageManager.updateImage(o,this.scope,d),g&&(this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})))}getImage(o){return this.imageManager.getImage(o,this.scope)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o,this.scope),this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this):this.fire(new i.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(o){return this.modelManager.addModelURLs(o,this.scope),this._updateWorkerModels(),this.fire(new i.A("data",{dataType:"style"})),this}addModel(o,d,g={}){return this._checkLoaded(),this._validate(He,`models.${o}`,d,null,g)||(this.modelManager.addModel(o,d,this.scope),this.fire(new i.A("data",{dataType:"style"}))),this}hasModel(o){return this.modelManager.hasModel(o,this.scope)}removeModel(o){return this.hasModel(o)?(this.modelManager.removeModel(o,this.scope),this.fire(new i.A("data",{dataType:"style"})),this):this.fire(new i.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(o,d,g={}){if(this._checkLoaded(),this.getOwnSource(o)!==void 0)throw new Error(`There is already a source with ID "${o}".`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(uo,`sources.${o}`,d,null,g))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const S=Ac(o,d,this.dispatcher,this);S.scope=this.scope,S.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(S.id),source:S.serialize(),sourceId:S.id}));const C=M=>{const L=(M?"symbol:":"other:")+S.id,B=i.C(L,this.scope),q=this._sourceCaches[L]=new ho(B,S,M);(M?this._symbolSourceCaches:this._otherSourceCaches)[S.id]=q,q.onAdd(this.map)};C(!1),d.type!=="vector"&&d.type!=="geojson"||C(!0),S.onAdd&&S.onAdd(this.map),g.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(o){this._checkLoaded();const d=this.getOwnSource(o);if(!d)throw new Error("There is no source with this ID");for(const S in this._layers)if(this._layers[S].source===o)return this.fire(new i.z(new Error(`Source "${o}" cannot be removed while layer "${S}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===o)return this.fire(new i.z(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const S=Object.entries(this.stylesheet.iconsets).find(([C,M])=>M.type==="source"&&M.source===o);if(S)return this.fire(new i.z(new Error(`Source "${o}" cannot be removed while iconset "${S[0]}" is using it.`)))}const g=this.getOwnSourceCaches(o);for(const S of g){const C=i.d8(S.id);delete this._sourceCaches[C],this._changes.discardSourceCacheUpdate(S.id),S.fire(new i.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:S.getSource().id})),S.setEventedParent(null),S.clearTiles()}return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],this.mergeSources(),d.setEventedParent(null),d.onRemove&&d.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(o,d){this._checkLoaded(),this.getOwnSource(o).setData(d),this._changes.setDirty()}getOwnSource(o){const d=this.getOwnSourceCache(o);return d&&d.getSource()}getOwnSources(){const o=[];for(const d in this._otherSourceCaches){const g=this.getOwnSourceCache(d);g&&o.push(g.getSource())}return o}areTilesLoaded(){const o=this._mergedSourceCaches;for(const d in o){const g=o[d]._tiles;for(const S in g){const C=g[S];if(C.state!=="loaded"&&C.state!=="errored")return!1}}return!0}setLights(o){if(this._checkLoaded(),!o)return delete this.ambientLight,void delete this.directionalLight;const d=this._getTransitionParameters();for(const S of o){if(this._validate(oa,"lights",S))return;switch(S.type){case"ambient":if(this.ambientLight){const C=this.ambientLight;C.set(S),C.updateTransitions(d)}else this.ambientLight=new li(S,Bn||(Bn=new i.a7({color:new i.a8(i.a5.properties_light_ambient.color),"color-use-theme":new i.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.a8(i.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const C=this.directionalLight;C.set(S),C.updateTransitions(d)}else this.directionalLight=new li(S,Tn||(Tn=new i.a7({direction:new i.an(i.a5.properties_light_directional.direction),color:new i.a8(i.a5.properties_light_directional.color),"color-use-theme":new i.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.a8(i.a5.properties_light_directional.intensity),"cast-shadows":new i.a8(i.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new i.a8(i.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new i.a8(i.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const g=new i.aa(this.z||0,d);this.ambientLight&&this.ambientLight.recalculate(g),this.directionalLight&&this.directionalLight.recalculate(g),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const o=this.directionalLight,d=this.ambientLight;if(!o||!d)return;const g=Q=>.2126*(Q[0]<=.03928?Q[0]/12.92:Math.pow((Q[0]+.055)/1.055,2.4))+.7152*(Q[1]<=.03928?Q[1]/12.92:Math.pow((Q[1]+.055)/1.055,2.4))+.0722*(Q[2]<=.03928?Q[2]/12.92:Math.pow((Q[2]+.055)/1.055,2.4)),S=o.properties.get("color").toRenderColor(null).toArray01(),C=o.properties.get("intensity"),M=o.properties.get("direction"),L=1-i.cR(M.x,M.y,M.z)[2]/90,B=g(S)*C*L,q=d.properties.get("color").toRenderColor(null).toArray01(),X=d.properties.get("intensity"),ee=g(q)*X;return Number(((B+ee)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const o=[];return this.directionalLight&&o.push(this.directionalLight.get()),this.ambientLight&&o.push(this.ambientLight.get()),o}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(o){if(o==null||o===""&&this.isRootStyle())return this;if(i.d9(o)){const d=i.da(o),g=this.fragments.find(({id:C})=>C===d);if(!g)return;const S=i.d8(o);return g.style.getFragmentStyle(S)}{const d=this.fragments.find(({id:g})=>g===o);return d?d.style:void 0}}setFeaturesetSelectors(o){if(!o)return;const d={},g=(S,C="")=>`${S}::${C}`;this._featuresetSelectors={};for(const S in o){const C=this._featuresetSelectors[S]=[];for(const M of o[S].selectors){if(M.featureNamespace){const B=this.getOwnLayer(M.layer);if(!B){i.w(`Layer is undefined for selector: ${M.layer}`);continue}const q=g(B.source,B.sourceLayer);if(q in d&&d[q]!==M.featureNamespace){i.w(`"featureNamespace ${M.featureNamespace} of featureset ${S}'s selector is not associated to the same source, skip this selector`);continue}d[q]=M.featureNamespace}let L;if(M.properties)for(const B in M.properties){const q=i.X(M.properties[B]);q.result==="success"&&(L=L||{},L[B]=q.value)}C.push({layerId:M.layer,namespace:M.featureNamespace,properties:L,uniqueFeatureID:M._uniqueFeatureID})}}}getFeaturesetDescriptors(o){const d=this.getFragmentStyle(o);if(!d||!d.stylesheet.featuresets)return[];const g=[];for(const S in d.stylesheet.featuresets)g.push({featuresetId:S,importId:d.scope?d.scope:void 0});return g}getFeaturesetLayers(o,d){const g=this.getFragmentStyle(d),S=g.stylesheet.featuresets;if(!S||!S[o])return this.fire(new i.z(new Error(`The featureset '${o}' does not exist in the map's style and cannot be queried.`))),[];const C=[];for(const M of S[o].selectors){const L=g.getOwnLayer(M.layer);L&&C.push(L)}return C}getConfigProperty(o,d){const g=this.getFragmentStyle(o);if(!g)return null;const S=i.C(d,g.scope),C=g.options.get(S),M=C?C.value||C.default:null;return M?M.serialize():null}setConfigProperty(o,d,g){const S=this.getFragmentStyle(o);if(!S)return;const C=S.stylesheet.indoor?By(S.stylesheet.schema):S.stylesheet.schema;if(!C||!C[d])return;const M=i.X(g);if(M.result!=="success")return void nl(this,M.value);const L=M.value.expression,B=i.C(d,S.scope),q=S.options.get(B);if(!q)return;let X;const{minValue:ee,maxValue:Q,stepValue:ne,type:fe,values:de}=C[d],ye=i.X(C[d].default);ye.result==="success"&&(X=ye.value.expression),X?(this.options.set(B,Object.assign({},q,{value:L,default:X,minValue:ee,maxValue:Q,stepValue:ne,type:fe,values:de})),this.updateConfigDependencies(d)):this.fire(new i.z(new Error(`No schema defined for the config option "${d}" in the "${o}" fragment.`)))}getConfig(o){const d=this.getFragmentStyle(o);if(!d)return null;const g=d.stylesheet.schema;if(!g)return null;const S={};for(const C in g){const M=i.C(C,d.scope),L=d.options.get(M),B=L?L.value||L.default:null;S[C]=B?B.serialize():null}return S}setConfig(o,d){const g=this.getFragmentStyle(o);g&&(g.updateConfig(d,g.stylesheet.schema),this.updateConfigDependencies())}getSchema(o){const d=this.getFragmentStyle(o);return d?d.stylesheet.schema:null}setSchema(o,d){const g=this.getFragmentStyle(o);g&&(g.stylesheet.schema=d,g.updateConfig(g._config,d),this.updateConfigDependencies())}updateConfig(o,d){if(this._config=o,o||d)if(d)for(const g in d){let S,C;const M=i.X(d[g].default);if(M.result==="success"&&(S=M.value.expression),o&&o[g]!==void 0){const Q=i.X(o[g]);Q.result==="success"&&(C=Q.value.expression)}const{minValue:L,maxValue:B,stepValue:q,type:X,values:ee}=d[g];if(S){const Q=i.C(g,this.scope);this.options.set(Q,{default:S,value:C,minValue:L,maxValue:B,stepValue:q,type:X,values:ee})}else this.fire(new i.z(new Error(`No schema defined for config option "${g}".`)))}else this.fire(new i.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(o){for(const d of this._configDependentLayers){const g=this.getLayer(d);if(g){if(o&&!g.configDependencies.has(o))continue;g.possiblyEvaluateVisibility(),this._updateLayer(g)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(d=>{const g=d._styleColorTheme.colorThemeOverride?d._styleColorTheme.colorThemeOverride:d._styleColorTheme.colorTheme;if(g){const S=d._evaluateColorThemeData(g);(!d._styleColorTheme.lut&&S!==""||d._styleColorTheme.lut&&S!==d._styleColorTheme.lut.data)&&d.setColorTheme(g)}}),this._changes.setDirty()}addLayer(o,d,g={}){this._checkLoaded();const S=o.id;if(this._layers[S])return void this.fire(new i.z(new Error(`Layer with id "${S}" already exists on this map`)));let C;if(o.type==="custom"){if(nl(this,i.db(o)))return;C=i.dc(o,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof o.source=="object"&&(this.addSource(S,o.source),o=i.d7(o),o=i.l(o,{source:S})),this._validate(ae,`layers.${S}`,o,{arrayIndex:-1},g))return;C=i.dc(o,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(C),C.setEventedParent(this,{layer:{id:S}})}C.configDependencies.size!==0&&this._configDependentLayers.add(C.fqid);let M=this._order.length;if(d){const X=this._order.indexOf(d);if(X===-1)return void this.fire(new i.z(new Error(`Layer with id "${d}" does not exist on this map.`)));C.slot===this._layers[d].slot?M=X:i.w(`Layer with id "${d}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(M,0,S),this._layerOrderChanged=!0,this._layers[S]=C;const L=this.getOwnLayerSourceCache(C),B=!!this.directionalLight&&this.directionalLight.shadowsEnabled();L&&C.canCastShadows()&&B&&(L.castsShadows=!0);const q=this._changes.getRemovedLayer(C);if(q&&C.source&&L&&C.type!=="custom"){this._changes.discardLayerRemoval(C);const X=i.C(C.source,C.scope);q.type!==C.type?this._changes.updateSourceCache(X,"clear"):(this._changes.updateSourceCache(X,"reload"),L.pause())}this._updateLayer(C),C.onAdd&&C.onAdd(this.map),C.scope=this.scope,this.mergeLayers()}moveLayer(o,d){this._checkLoaded();const g=this._checkLayer(o);if(!g||o===d)return;const S=this._order.indexOf(o);this._order.splice(S,1);let C=this._order.length;if(d){const M=this._order.indexOf(d);if(M===-1)return void this.fire(new i.z(new Error(`Layer with id "${d}" does not exist on this map.`)));g.slot===this._layers[d].slot?C=M:i.w(`Layer with id "${d}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(C,0,o),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(o){this._checkLoaded();const d=this._checkLayer(o);if(!d)return;d.setEventedParent(null);const g=this._order.indexOf(o);this._order.splice(g,1),delete this._layers[o],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(d.fqid),this._changes.removeLayer(d);const S=this.getOwnLayerSourceCache(d);if(S&&S.castsShadows){let C=!1;for(const M in this._layers)if(this._layers[M].source===d.source&&this._layers[M].canCastShadows()){C=!0;break}S.castsShadows=C}d.onRemove&&d.onRemove(this.map),this.mergeLayers()}getOwnLayer(o){return this._layers[o]}hasLayer(o){return o in this._mergedLayers}hasLayerType(o){for(const d in this._layers)if(this._layers[d].type===o)return!0;return!1}setLayerZoomRange(o,d,g){this._checkLoaded();const S=this._checkLayer(o);S&&(S.minzoom===d&&S.maxzoom===g||(d!=null&&(S.minzoom=d),g!=null&&(S.maxzoom=g),this._updateLayer(S)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(o,d){this._checkLoaded();const g=this._checkLayer(o);g&&g.slot!==d&&(g.slot=d,this._updateLayer(g))}setFilter(o,d,g={}){this._checkLoaded();const S=this._checkLayer(o);if(S&&!i.bv(S.filter,d))return d==null?(S.filter=void 0,void this._updateLayer(S)):void(this._validate(oe,`layers.${S.id}.filter`,d,{layerType:S.type},g)||(S.filter=i.d7(d),this._updateLayer(S)))}getFilter(o){const d=this._checkLayer(o);if(d)return i.d7(d.filter)}setLayoutProperty(o,d,g,S={}){this._checkLoaded();const C=this._checkLayer(o);if(C&&!i.bv(C.getLayoutProperty(d),g)){if(g!=null&&(!S||S.validate!==!1)&&nl(C,$e.call(_s,{key:`layers.${o}.layout.${d}`,layerType:C.type,objectKey:d,value:g,styleSpec:i.a5,style:{glyphs:!0,sprite:!0}})))return;C.setLayoutProperty(d,g),C.configDependencies.size!==0&&this._configDependentLayers.add(C.fqid),this._updateLayer(C)}}getLayoutProperty(o,d){const g=this._checkLayer(o);if(g)return g.getLayoutProperty(d)}setPaintProperty(o,d,g,S={}){this._checkLoaded();const C=this._checkLayer(o);if(!C||i.bv(C.getPaintProperty(d),g)||g!=null&&(!S||S.validate!==!1)&&nl(C,pe.call(_s,{key:`layers.${o}.paint.${d}`,layerType:C.type,objectKey:d,value:g,styleSpec:i.a5})))return;const M=C.setPaintProperty(d,g);C.configDependencies.size!==0&&this._configDependentLayers.add(C.fqid),M&&this._updateLayer(C),this._changes.updatePaintProperties(C)}getPaintProperty(o,d){const g=this._checkLayer(o);if(g)return g.getPaintProperty(d)}setFeatureState(o,d){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){const{featuresetId:B,importId:q}=o.target,X=this.getFragmentStyle(q),ee=X.getFeaturesetLayers(B);for(const{source:Q,sourceLayer:ne}of ee)X.setFeatureState({id:o.id,source:Q,sourceLayer:ne},d)}else if("layerId"in o.target){const{layerId:B}=o.target,q=this.getLayer(B);this.setFeatureState({id:o.id,source:q.source,sourceLayer:q.sourceLayer},d)}return}const g=o.source,S=o.sourceLayer,C=this._checkSource(g);if(!C)return;const M=C.type;if(M==="geojson"&&S)return void this.fire(new i.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(M==="vector"&&!S)return void this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")));o.id===void 0&&this.fire(new i.z(new Error("The feature id parameter must be provided.")));const L=this.getOwnSourceCaches(g);for(const B of L)B.setFeatureState(S,o.id,d)}removeFeatureState(o,d){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){const{featuresetId:B,importId:q}=o.target,X=this.getFragmentStyle(q),ee=X.getFeaturesetLayers(B);for(const{source:Q,sourceLayer:ne}of ee)X.removeFeatureState({id:o.id,source:Q,sourceLayer:ne},d)}else if("layerId"in o.target){const{layerId:B}=o.target,q=this.getLayer(B);this.removeFeatureState({id:o.id,source:q.source,sourceLayer:q.sourceLayer},d)}return}const g=o.source,S=this._checkSource(g);if(!S)return;const C=S.type,M=C==="vector"?o.sourceLayer:void 0;if(C==="vector"&&!M)return void this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(d&&typeof o.id!="string"&&typeof o.id!="number")return void this.fire(new i.z(new Error("A feature id is required to remove its specific state property.")));const L=this.getOwnSourceCaches(g);for(const B of L)B.removeFeatureState(M,o.id,d)}getFeatureState(o){if(this._checkLoaded(),"target"in o){let C;if("featuresetId"in o.target){const{featuresetId:M,importId:L}=o.target,B=this.getFragmentStyle(L),q=B.getFeaturesetLayers(M);for(const{source:X,sourceLayer:ee}of q){const Q=B.getFeatureState({id:o.id,source:X,sourceLayer:ee});if(Q&&!C)C=Q;else if(!i.bv(C,Q))return void this.fire(new i.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in o.target){const{layerId:M}=o.target,L=this.getLayer(M);C=this.getFeatureState({id:o.id,source:L.source,sourceLayer:L.sourceLayer})}return C}const d=o.source,g=o.sourceLayer,S=this._checkSource(d);if(S){if(S.type!=="vector"||g)return o.id===void 0&&this.fire(new i.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(d)[0].getFeatureState(g,o.id);this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(o){return this.stylesheet.transition=i.l({},this.stylesheet.transition,o),this.transition=this.stylesheet.transition,this}getTransition(){return i.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const o=this.getTerrain(),d=o&&this.terrain&&this.terrain.scope===this.scope?o:this.stylesheet.terrain;return i.dd({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:d,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},g=>g!==void 0)}_updateFilteredLayers(o){for(const d of Object.values(this._mergedLayers))o(d)&&this._updateLayer(d)}_updateLayer(o){this._changes.updateLayer(o);const d=this.getLayerSourceCache(o),g=i.C(o.source,o.scope),S=this._changes.getUpdatedSourceCaches();o.source&&!S[g]&&d&&d.getSource().type!=="raster"&&(this._changes.updateSourceCache(g,"reload"),d.pause()),o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const d=L=>this._mergedLayers[L].is3D(!!this.terrain),g=this.order,S={},C=[];for(let L=g.length-1;L>=0;L--){const B=g[L];if(d(B)){S[B]=L;for(const q of o){const X=q[B];if(X)for(const ee of X)C.push(ee)}}}C.sort((L,B)=>B.intersectionZ-L.intersectionZ);const M=[];for(let L=g.length-1;L>=0;L--){const B=g[L];if(d(B))for(let q=C.length-1;q>=0;q--){const X=C[q].feature;if(X.layer&&S[X.layer.id]<L)break;M.push(X),C.pop()}else for(const q of o){const X=q[B];if(X)for(const ee of X)M.push(ee.feature)}}return M}queryRenderedFeatures(o,d,g){let S;d&&!Array.isArray(d)&&d.filter&&(this._validate(oe,"queryRenderedFeatures.filter",d.filter,null,d),S=i.b3(d.filter));const C={},M=X=>{if(Yl.has(X.type))return;const ee=this.getOwnLayerSourceCache(X),Q=C[ee.id]=C[ee.id]||{sourceCache:ee,layers:{},has3DLayers:!1};X.is3D(!!this.terrain)&&(Q.has3DLayers=!0),Q.layers[X.fqid]=Q.layers[X.fqid]||{styleLayer:X,targets:[]},Q.layers[X.fqid].targets.push({filter:S})};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new i.z(new Error("parameters.layers must be an Array."))),[];for(const X of d.layers){const ee=this._layers[X];if(!ee)return this.fire(new i.z(new Error(`The layer '${X}' does not exist in the map's style and cannot be queried for features.`))),[];M(ee)}}else for(const X in this._layers)M(this._layers[X]);const L=this._queryRenderedFeatures(o,C,g),B=this._flattenAndSortRenderedFeatures(L),q=[];for(const X of B)i.de(X.layer.id)===this.scope&&q.push(X);return q}queryRenderedFeatureset(o,d,g){let S;d&&!Array.isArray(d)&&d.filter&&(this._validate(oe,"queryRenderedFeatures.filter",d.filter,null,d),S=i.b3(d.filter));const C="mock",M=[];if(d&&d.target)M.push(Object.assign({},d,{targetId:C,filter:S}));else{const X=this.getFeaturesetDescriptors();for(const ee of X)M.push({targetId:C,filter:S,target:ee});for(const{style:ee}of this.fragments){const Q=ee.getFeaturesetDescriptors();for(const ne of Q)M.push({targetId:C,filter:S,target:ne})}}const L=this.queryRenderedTargets(o,M,g),B=[],q=new Set;for(const X of L)for(const ee of X.variants[C])Pc(ee,X,q)||B.push(new i.df(X,ee));return B}queryRenderedTargets(o,d,g){const S={},C=(L,B,q,X)=>{const ee=S[B.id]=S[B.id]||{sourceCache:B,layers:{},has3DLayers:!1};if(ee.layers[L.fqid]=ee.layers[L.fqid]||{styleLayer:L,targets:[]},L.is3D(!!this.terrain)&&(ee.has3DLayers=!0),!X)return q.uniqueFeatureID=!1,void ee.layers[L.fqid].targets.push(q);ee.layers[L.fqid].targets.push(Object.assign({},q,{namespace:X.namespace,properties:X.properties,uniqueFeatureID:X.uniqueFeatureID}))};for(const L of d)if("featuresetId"in L.target){const{featuresetId:B,importId:q}=L.target,X=this.getFragmentStyle(q);if(!X||!X._featuresetSelectors)continue;const ee=X._featuresetSelectors[B];if(!ee){this.fire(new i.z(new Error(`The featureset '${B}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const Q of ee){const ne=X.getOwnLayer(Q.layerId);ne&&!Yl.has(ne.type)&&C(ne,X.getOwnLayerSourceCache(ne),L,Q)}}else if("layerId"in L.target){const{layerId:B}=L.target,q=this.getLayer(B);if(!q||Yl.has(q.type))continue;C(q,this.getLayerSourceCache(q),L)}const M=this._queryRenderedFeatures(o,S,g);return this._flattenAndSortRenderedFeatures(M)}_queryRenderedFeatures(o,d,g){const S=[],C=!!this.map._showQueryGeometry,M=bi.createFromScreenPoints(o,g);for(const L in d){const B=Vl(M,d[L],this._availableImages,g,C);Object.keys(B).length&&S.push(B)}if(this.placement)for(const L in d){if(!d[L].sourceCache._onlySymbols)continue;const B=yf(M.screenGeometry,d[L],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(B).length&&S.push(B)}return S}querySourceFeatures(o,d){const g=d&&d.filter;g&&this._validate(oe,"querySourceFeatures.filter",g,null,d);let S=[];const C=this.getOwnSourceCaches(o);for(const M of C)S=S.concat(sg(M,d));return S}addSourceType(o,d,g){return il.getSourceType(o)?g(new Error(`A source type called "${o}" already exists.`)):(il.setSourceType(o,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:d.workerSourceURL},g):g(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(o,d,g={}){this._checkLoaded();const S=this.light.getLight();let C=!1;for(const L in o)if(!i.bv(o[L],S[L])){C=!0;break}if(!C)return;const M=this._getTransitionParameters();this.light.setLight(o,d,g),this.light.updateTransitions(M)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(o,d=1){if(this._checkLoaded(),!o)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),d===0&&delete this.terrain,o===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let g=o;const S=o.source==null;if(d===1){if(this.disableElevatedTerrain)return;if(typeof g.source=="object"){const L="terrain-dem-src";this.addSource(L,g.source),g=i.d7(g),g=i.l(g,{source:L})}const C=i.l({},g),M={};if(this.terrain&&S){C.source=this.terrain.get().source;const L=this.terrain?this.getFragmentStyle(this.terrain.scope):null;L&&(M.style=L.serialize())}if(this._validate(Qt,"terrain",C,M))return}if(!this.terrain||this.terrain.scope!==this.scope&&!S||this.terrain&&d!==this.terrain.drapeRenderMode){if(!g)return;this._createTerrain(g,d),this.fire(new i.A("data",{dataType:"style"}))}else{const C=this.terrain,M=C.get();for(const L of Object.keys(i.a5.terrain))!g.hasOwnProperty(L)&&i.a5.terrain[L].default&&(g[L]=i.a5.terrain[L].default);for(const L in o)if(!i.bv(o[L],M[L])){C.set(o,this.options),this.stylesheet.terrain=o;const B=this._getTransitionParameters({duration:0});C.updateTransitions(B),this.fire(new i.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const d=this.fog=new nn(o,this.map.transform,this.scope,this.options);this.stylesheet.fog=d.get();const g=this._getTransitionParameters({duration:0});d.updateTransitions(g)}_createSnow(o){const d=this.snow=new on(o,this.map.transform,this.scope,this.options);this.stylesheet.snow=d.get();const g=this._getTransitionParameters({duration:0});d.updateTransitions(g)}_createRain(o){const d=this.rain=new Vn(o,this.map.transform,this.scope,this.options);this.stylesheet.rain=d.get();const g=this._getTransitionParameters({duration:0});d.updateTransitions(g)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const d=this.fog;if(!i.bv(d.get(),o)){d.set(o,this.options),this.stylesheet.fog=d.get();const g=this._getTransitionParameters({duration:0});d.updateTransitions(g)}}else this._createFog(o);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(o){if(this._checkLoaded(),!o)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const d=this.snow;if(!i.bv(d.get(),o)){d.set(o,this.options),this.stylesheet.snow=d.get();const g=this._getTransitionParameters({duration:0});d.updateTransitions(g)}}else this._createSnow(o);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(o){if(this._checkLoaded(),!o)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const d=this.rain;if(!i.bv(d.get(),o)){d.set(o,this.options),this.stylesheet.rain=d.get();const g=this._getTransitionParameters({duration:0});d.updateTransitions(g)}}else this._createRain(o);this._markersNeedUpdate=!0}_reloadColorTheme(){const o=()=>{for(const S in this._layers)this._layers[S].lut=this._styleColorTheme.lut;for(const S in this._sourceCaches)this._sourceCaches[S].clearTiles()},d=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!d)return this._styleColorTheme.lut=null,void o();const g=this._evaluateColorThemeData(d);this._loadColorTheme(g).then(()=>{this.fire(new i.A("colorthemeset")),o()}).catch(S=>{i.w(`Couldn't set color theme: ${S}`)})}setColorTheme(o){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&i.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=o,this._reloadColorTheme()}setImportColorTheme(o,d){const g=this.getFragmentStyle(o);g&&(g._styleColorTheme.colorThemeOverride=d,g._reloadColorTheme())}_getTransitionParameters(o){return{now:i.q.now(),transition:i.l(this.transition,o)}}updateDrapeFirstLayers(){if(!this.terrain)return;const o=[],d=[];for(const g of this._mergedOrder)this.isLayerDraped(this._mergedLayers[g])?o.push(g):d.push(g);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...d)}_createTerrain(o,d){const g=this.terrain=new Ct(o,d,this.scope,this.options);d===1&&(this.stylesheet.terrain=o),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const S=this._getTransitionParameters({duration:0});g.updateTransitions(S)}_force3DLayerUpdate(){for(const o in this._layers){const d=this._layers[o];d.type==="fill-extrusion"&&this._updateLayer(d)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const d=this._layers[o];d.type==="symbol"&&this._updateLayer(d)}}_validate(o,d,g,S,C={}){if(C&&C.validate===!1)return!1;const M=i.l({},this.serialize());return nl(this,o.call(_s,i.l({key:d,style:M,value:g,styleSpec:i.a5},S)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.dg.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._mergedLayers)this._mergedLayers[o].setEventedParent(null);for(const o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles(),this._mergedSourceCaches[o].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(o){const d=this.getSourceCaches(o);for(const g of d)g.clearTiles()}clearSources(){for(const o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles()}reloadSource(o){const d=this.getSourceCaches(o);for(const g of d)g.resume(),g.reload()}reloadSources(){for(const o of this.getSources())o.reload&&o.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(o=>{o.modelManager.reloadModels(o.scope)})}updateSources(o){let d;this.directionalLight&&(d=Ef(this.directionalLight));const g=new Set;for(const S in this._mergedLayers){const C=this._mergedLayers[S];C.hasElevation()&&!g.has(C.source)&&g.add(C.source)}for(const S in this._mergedSourceCaches){const C=this._mergedSourceCaches[S],M=g.has(C._source.id);C.update(o,void 0,void 0,d,M)}}_generateCollisionBoxes(){for(const o in this._sourceCaches){const d=this._sourceCaches[o];d.resume(),d.reload()}}_updatePlacement(o,d,g,S,C,M,L=!1){let B=!1,q=!1;const X={},ee={};for(const Q of this._mergedOrder){const ne=this._mergedLayers[Q];if(ne.type!=="symbol")continue;const fe=i.C(ne.source,ne.scope);let de=X[fe];if(!de){const he=this.getLayerSourceCache(ne);if(!he)continue;const Se=he.getRenderableIds(!0).map(Ae=>he.getTileByID(Ae));ee[fe]=Se.slice(),de=X[fe]=Se.sort((Ae,Pe)=>Pe.tileID.overscaledZ-Ae.tileID.overscaledZ||(Ae.tileID.isLessThan(Pe.tileID)?-1:1))}const ye=this.crossTileSymbolIndex.addLayer(ne,de,d.center.lng,d.projection);B=B||ye}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),L=L||this._layerOrderChanged||S===0,this._layerOrderChanged&&this.fire(new i.A("neworder")),(L||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.q.now(),d.zoom))&&(this.pauseablePlacement=new Xo(d,this._mergedOrder,L,g,S,C,this.placement,this.fog&&d.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,X,ee,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.q.now()),q=!0),B&&this.pauseablePlacement.placement.setStale()),q||B){this._buildingIndex.onNewFrame(d.zoom);for(let Q=0;Q<this._mergedOrder.length;Q++){const ne=this._mergedLayers[this._mergedOrder[Q]];if(ne.type!=="symbol")continue;const fe=this.isLayerClipped(ne);this.placement.updateLayerOpacities(ne,X[i.C(ne.source,ne.scope)],Q,fe?M:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.q.now())}}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}addImport(o,d){this._checkLoaded();const g=this.stylesheet.imports=this.stylesheet.imports||[];if(g.findIndex(({id:C})=>C===o.id)!==-1)return void this.fire(new i.z(new Error(`Import with id '${o.id}' already exists in the map's style.`)));if(!d)return g.push(o),this._loadImports([o],!0);const S=g.findIndex(({id:C})=>C===d);return S===-1&&this.fire(new i.z(new Error(`Import with id "${d}" does not exist on this map.`))),this.stylesheet.imports=g.slice(0,S).concat(o).concat(g.slice(S)),this._loadImports([o],!0,d)}updateImport(o,d){this._checkLoaded();const g=this.stylesheet.imports||[],S=this.getImportIndex(o);return S===-1?this:typeof d=="string"?(this.setImportUrl(o,d),this):(d.url&&d.url!==g[S].url&&this.setImportUrl(o,d.url),i.bv(d.config,g[S].config)||this.setImportConfig(o,d.config,d.data.schema),i.bv(d.data,g[S].data)||this.setImportData(o,d.data),this)}moveImport(o,d){this._checkLoaded();let g=this.stylesheet.imports||[];const S=this.getImportIndex(o);if(S===-1)return this;const C=this.getImportIndex(d);if(C===-1)return this;const M=g[S],L=this.fragments[S];return g=g.filter(({id:B})=>B!==o),this.fragments=this.fragments.filter(({id:B})=>B!==o),this.stylesheet.imports=g.slice(0,C).concat(M).concat(g.slice(C)),this.fragments=this.fragments.slice(0,C).concat(L).concat(this.fragments.slice(C)),this.mergeLayers(),this}setImportUrl(o,d){this._checkLoaded();const g=this.stylesheet.imports||[],S=this.getImportIndex(o);if(S===-1)return this;g[S].url=d;const C=this.fragments[S];return C.style=this._createFragmentStyle(g[S]),C.style.on("style.import.load",()=>this.mergeAll()),C.style.loadURL(d),this}setImportData(o,d){this._checkLoaded();const g=this.getImportIndex(o),S=this.stylesheet.imports||[];return g===-1?this:d?(this.fragments[g].style.setState(d),this._reloadImports(),this):(delete S[g].data,this.setImportUrl(o,S[g].url))}setImportConfig(o,d,g){this._checkLoaded();const S=this.getImportIndex(o),C=this.stylesheet.imports||[];if(S===-1)return this;d?C[S].config=d:delete C[S].config;const M=this.fragments[S];g&&M.style.stylesheet&&(M.style.stylesheet.schema=g);const L=M.style.stylesheet&&M.style.stylesheet.schema;return M.config=d,M.style.updateConfig(d,L),this.updateConfigDependencies(),this}removeImport(o){this._checkLoaded();const d=this.stylesheet.imports||[],g=this.getImportIndex(o);g!==-1&&(d.splice(g,1),this.fragments[g].style._remove(),this.fragments.splice(g,1),this._reloadImports())}getImportIndex(o){const d=(this.stylesheet.imports||[]).findIndex(g=>g.id===o);return d===-1&&this.fire(new i.z(new Error(`Import '${o}' does not exist in the map's style and cannot be updated.`))),d}getLayer(o){return this._mergedLayers[o]}getSources(){const o=[];for(const d in this._mergedOtherSourceCaches){const g=this._mergedOtherSourceCaches[d];g&&o.push(g.getSource())}return o}getSource(o,d){const g=this.getSourceCache(o,d);return g&&g.getSource()}getLayerSource(o){const d=this.getLayerSourceCache(o);return d&&d.getSource()}getSourceCache(o,d){const g=i.C(o,d);return this._mergedOtherSourceCaches[g]}getLayerSourceCache(o){const d=i.C(o.source,o.scope);return o.type==="symbol"?this._mergedSymbolSourceCaches[d]:this._mergedOtherSourceCaches[d]}getSourceCaches(o){if(o==null)return Object.values(this._mergedSourceCaches);const d=[];return this._mergedOtherSourceCaches[o]&&d.push(this._mergedOtherSourceCaches[o]),this._mergedSymbolSourceCaches[o]&&d.push(this._mergedSymbolSourceCaches[o]),d}updateSourceCaches(){const o=this._changes.getUpdatedSourceCaches();for(const d in o){const g=o[d];g==="reload"?this.reloadSource(d):g==="clear"&&this.clearSource(d)}}updateLayers(o){const d=this._changes.getUpdatedPaintProperties();for(const g of d){const S=this.getLayer(g);S&&S.updateTransitions(o)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(o){this.stylesheet.glyphs=o,this.glyphManager.setURL(o,this.scope)}getImages(o,d,g){this.imageManager.getImages(d.images,d.scope,g),this._updateTilesForChangedImages();const S=M=>{if(M){const L=d.images.map(B=>i.I.toString(B));M.setDependencies(d.tileID.key,d.type,L)}},C=i.C(d.source,d.scope);S(this._mergedOtherSourceCaches[C]),S(this._mergedSymbolSourceCaches[C])}rasterizeImages(o,d,g){this.imageManager.rasterizeImages(d,g)}getGlyphs(o,d,g){this.glyphManager.getGlyphs(d.stacks,d.scope,g)}getResource(o,d,g){return i.dh(d,g)}getOwnSourceCache(o){return this._otherSourceCaches[o]}getOwnLayerSourceCache(o){return o.type==="symbol"?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}getOwnSourceCaches(o){const d=[];return this._otherSourceCaches[o]&&d.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&d.push(this._symbolSourceCaches[o]),d}_isSourceCacheLoaded(o){const d=this.getOwnSourceCaches(o);return d.length===0?(this.fire(new i.z(new Error(`There is no source with ID '${o}'`))),!1):d.every(g=>g.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(o,d){if(!this._clipLayerPresent&&o.type!=="fill-extrusion")return!1;const g=o.type==="fill-extrusion"&&o.sourceLayer==="building";if(o.is3D(!!this.terrain)){if(g||d&&d.type==="batched-model"||o.type==="model")return!0}else if(o.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(o=>{o.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}il.getSourceType=function(m){return gf[m]},il.setSourceType=function(m,o){gf[m]=o},il.registerForPluginStateChange=i.c$;var yh=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Tl=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Cf=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,_u="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ua=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Af=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,or=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,xu=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,vh=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Pf=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,_h=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return clamp(mix(lerpx.x,lerpx.y,f.y),0.0,1.0);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const bu=[];ja(yh,bu),ja(Cf,bu),ja(Tl,bu);const Ra={"_prelude_fog.vertex.glsl":Af,"_prelude_terrain.vertex.glsl":ua,"_prelude_shadow.vertex.glsl":Pf,"_prelude_fog.fragment.glsl":or,"_prelude_shadow.fragment.glsl":_h,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":xu,"_prelude_raster_particle.glsl":vh},md={};Dn("",ua),Dn(or,Af),Dn(_h,Pf),Dn(xu,""),Dn(vh,"");const jc=Dn(Tl,Cf),xh=yh;var wu={background:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in highp vec3 v_normal;in highp float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 apply_lighting_linear(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec4 color=vec4(v_color.rgb,1.0);vec3 normal=normalize(v_normal);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,v_color.rgb,v_color.a);color*=u_opacity;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_height));
#endif
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_height);
#endif
glFragColor=vec4(linearTosRGB(color.rgb),color.a);
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3f;out vec4 v_color;out highp vec3 v_normal;out highp float v_height;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));vec3 pos=a_pos_3f;v_height=pos.z;gl_Position=u_matrix*vec4(pos,1.0);
#ifdef RENDER_SHADOWS
vec3 shadow_pos=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:Dn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Dn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Dn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Dn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Dn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Dn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Dn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Dn(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Dn(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
void main() {vec3 color=vec3(241.0/255.0,236.0/255.0,225.0/255.0);
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,normal);
#endif
if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(v_normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Dn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Dn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Dn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Dn(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Dn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Dn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Dn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Dn(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(abs(v_z_offset) > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
#endif
}`),terrainRaster:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Dn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Dn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,_u),skyboxGradient:Dn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,_u),skyboxCapture:Dn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Dn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Dn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Dn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Dn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Dn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Dn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Dn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function ja(m,o){const d=m.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let g of d)if(g=g.trim(),g[0]==="#"&&g.includes("if")&&!g.includes("endif")){g=g.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const S=g.split(" ");for(const C of S)o.includes(C)||o.push(C)}}function Dn(m,o){const d=/#include\s+"([^"]+)"/g,g=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let S=o.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);S&&(S=S.map(q=>{const X=q.split(" ");return X[X.length-1]}),S=[...new Set(S)]);const C={},M=[],L=[];if(m=m.replace(d,(q,X)=>(L.push(X),"")),(o=o.replace(d,(q,X)=>(M.push(X),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let B=[...bu];ja(m,B),ja(o,B);for(const q of[...M,...L])Ra[q]||console.error(`Undefined include: ${q}`),md[q]||(md[q]=[],ja(Ra[q],md[q])),B=[...B,...md[q]];return{fragmentSource:m=m.replace(g,(q,X,ee,Q,ne)=>(C[ne]=!0,X==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
in ${ee} ${Q} ${ne};
#else
uniform ${ee} ${Q} u_${ne};
#endif
`:X==="initialize"?`
#ifdef HAS_UNIFORM_u_${ne}
    ${ee} ${Q} ${ne} = u_${ne};
#endif
`:X==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${ne}
    in ${ee} ${Q} ${ne};
#endif
`:X==="initialize-attribute"?"":void 0)),vertexSource:o=o.replace(g,(q,X,ee,Q,ne)=>{const fe=Q==="float"?"vec2":Q,de=ne.match(/color/)?"color":fe;return X==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${ne}
in ${ee} ${Q} a_${ne};
#endif
`:C[ne]?X==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
uniform lowp float u_${ne}_t;
in ${ee} ${fe} a_${ne};
out ${ee} ${Q} ${ne};
#else
uniform ${ee} ${Q} u_${ne};
#endif
`:X==="initialize"?de==="vec4"?`
#ifndef HAS_UNIFORM_u_${ne}
    ${ne} = a_${ne};
#else
    ${ee} ${Q} ${ne} = u_${ne};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ne}
    ${ne} = unpack_mix_${de}(a_${ne}, u_${ne}_t);
#else
    ${ee} ${Q} ${ne} = u_${ne};
#endif
`:X==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${ne}
    in ${ee} ${Q} a_${ne};
    out ${ee} ${Q} ${ne};
#endif
`:X==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${ne}
    ${ne} = a_${ne};
#endif
`:void 0:X==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
uniform lowp float u_${ne}_t;
in ${ee} ${fe} a_${ne};
#else
uniform ${ee} ${Q} u_${ne};
#endif
`:X==="define-instanced"?de==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${ne}0;
in vec4 a_${ne}1;
in vec4 a_${ne}2;
in vec4 a_${ne}3;
#else
uniform ${ee} ${Q} u_${ne};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${ee} ${fe} a_${ne};
#else
uniform ${ee} ${Q} u_${ne};
#endif
`:X==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${ne}
    ${ee} ${Q} ${ne} = a_${ne};
#endif
`:de==="vec4"?`
#ifndef HAS_UNIFORM_u_${ne}
    ${ee} ${Q} ${ne} = a_${ne};
#else
    ${ee} ${Q} ${ne} = u_${ne};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ne}
    ${ee} ${Q} ${ne} = unpack_mix_${de}(a_${ne}, u_${ne}_t);
#else
    ${ee} ${Q} ${ne} = u_${ne};
#endif
`}),staticAttributes:S,usedDefines:B,vertexIncludes:M,fragmentIncludes:L}}class Mf{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(o,d,g,S,C,M,L,B){this.context=o;let q=this.boundPaintVertexBuffers.length!==S.length;for(let ee=0;!q&&ee<S.length;ee++)this.boundPaintVertexBuffers[ee]!==S[ee]&&(q=!0);let X=this.boundDynamicVertexBuffers.length!==L.length;for(let ee=0;!X&&ee<L.length;ee++)this.boundDynamicVertexBuffers[ee]!==L[ee]&&(X=!0);if(!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==g||q||X||this.boundIndexBuffer!==C||this.boundVertexOffset!==M)this.freshBind(d,g,S,C,M,L,B);else{o.bindVertexArrayOES.set(this.vao);for(const ee of L)ee&&(ee.bind(),B&&ee.instanceCount&&ee.setVertexAttribDivisor(o.gl,d,B));C&&C.dynamicDraw&&C.bind()}}freshBind(o,d,g,S,C,M,L){const B=o.numAttributes,q=this.context,X=q.gl;this.vao&&this.destroy(),this.vao=q.gl.createVertexArray(),q.bindVertexArrayOES.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=S,this.boundVertexOffset=C,this.boundDynamicVertexBuffers=M,d.enableAttributes(X,o),d.bind(),d.setVertexAttribPointers(X,o,C);for(const ee of g)ee.enableAttributes(X,o),ee.bind(),ee.setVertexAttribPointers(X,o,C);for(const ee of M)ee&&(ee.enableAttributes(X,o),ee.bind(),ee.setVertexAttribPointers(X,o,C),L&&ee.instanceCount&&ee.setVertexAttribDivisor(X,o,L));S&&S.bind(),q.currentNumAttributes=B}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function X_(m,o){const d=Math.pow(2,o.canonical.z),g=o.canonical.y;return[new i.ac(0,g/d).toLngLat().lat,new i.ac(0,(g+1)/d).toLngLat().lat]}function Vy(m,o,d,g,S,C,M){const L=m.context,B=L.gl,q=d.hillshadeFBO;if(!q)return;m.prepareDrawTile();const X=m.isTileAffectedByFog(o),ee=m.getOrCreateProgram("hillshade",{overrideFog:X});L.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,q.colorAttachment.get());const Q=((ye,he,Se,Ae)=>{const Pe=Se.paint.get("hillshade-shadow-color"),Be=Se.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Fe=Se.paint.get("hillshade-highlight-color"),je=Se.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ke=Se.paint.get("hillshade-accent-color"),qe=Se.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ze=Se.paint.get("hillshade-emissive-strength");let yt=i.al(Se.paint.get("hillshade-illumination-direction"));if(Se.paint.get("hillshade-illumination-anchor")==="viewport")yt-=ye.transform.angle;else if(ye.style&&ye.style.enable3dLights()&&ye.style.directionalLight){const At=ye.style.directionalLight.properties.get("direction"),Mt=i.cR(At.x,At.y,At.z);yt=i.al(Mt[1])}const ut=!ye.options.moving;return{u_matrix:Ae||ye.transform.calculateProjMatrix(he.tileID.toUnwrapped(),ut),u_image:0,u_latrange:X_(0,he.tileID),u_light:[Se.paint.get("hillshade-exaggeration"),yt],u_shadow:Pe.toRenderColor(Be?null:Se.lut),u_highlight:Fe.toRenderColor(je?null:Se.lut),u_emissive_strength:Ze,u_accent:ke.toRenderColor(qe?null:Se.lut)}})(m,d,g,m.terrain?o.projMatrix:null);m.uploadCommonUniforms(L,ee,o.toUnwrapped());const{tileBoundsBuffer:ne,tileBoundsIndexBuffer:fe,tileBoundsSegments:de}=m.getTileBoundsBuffers(d);ee.draw(m,B.TRIANGLES,S,C,M,Zr.disabled,Q,g.id,ne,fe,de)}function gd(m,o,d){if(!o.needsDEMTextureUpload)return;const g=m.context,S=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||m.getTileTexture(d.stride);const C=d.getPixels();o.demTexture?o.demTexture.update(C,{premultiply:!1}):o.demTexture=new i.T(g,C,S.R32F,{premultiply:!1}),o.needsDEMTextureUpload=!1}function hg(m,o,d){const g=m.context,S=g.gl;if(!o.dem)return;const C=o.dem;if(g.activeTexture.set(S.TEXTURE1),gd(m,o,C),!o.demTexture)return;o.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);const M=C.dim;g.activeTexture.set(S.TEXTURE0);let L=o.hillshadeFBO;if(!L){const Q=new i.T(g,{width:M,height:M,data:null},S.RGBA8);Q.bind(S.LINEAR,S.CLAMP_TO_EDGE),L=o.hillshadeFBO=g.createFramebuffer(M,M,!0,"renderbuffer"),L.colorAttachment.set(Q.texture)}g.bindFramebuffer.set(L.framebuffer),g.viewport.set([0,0,M,M]);const{tileBoundsBuffer:B,tileBoundsIndexBuffer:q,tileBoundsSegments:X}=m.getMercatorTileBoundsBuffers(),ee=[];m.linearFloatFilteringSupported()&&ee.push("TERRAIN_DEM_FLOAT_FORMAT"),m.getOrCreateProgram("hillshadePrepare",{defines:ee}).draw(m,S.TRIANGLES,Er.disabled,qr.disabled,gn.unblended,Zr.disabled,((Q,ne)=>{const fe=ne.stride,de=i.bz();return i.c5(de,0,i.aj,-i.aj,0,0,1),i.bo(de,de,[0,-i.aj,0]),{u_matrix:de,u_image:1,u_dimension:[fe,fe],u_zoom:Q.overscaledZ}})(o.tileID,C),d.id,B,q,X),o.needsHillshadePrepare=!1}class Vi{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Uy extends Vi{getDefault(){return i.am.transparent}set(o){const d=this.current;(o.r!==d.r||o.g!==d.g||o.b!==d.b||o.a!==d.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Cs extends Vi{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class fg extends Vi{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class If extends Vi{getDefault(){return[!0,!0,!0,!0]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class kf extends Vi{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class Of extends Vi{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class pg extends Vi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const d=this.current;(o.func!==d.func||o.ref!==d.ref||o.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class bh extends Vi{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class wh extends Vi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=o,this.dirty=!1}}class Dc extends Vi{getDefault(){return[0,1]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Fp extends Vi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=o,this.dirty=!1}}class yd extends Vi{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class mg extends Vi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.BLEND):d.disable(d.BLEND),this.current=o,this.dirty=!1}}class gg extends Vi{getDefault(){const o=this.gl;return[o.ONE,o.ZERO,o.ONE,o.ZERO]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.blendFuncSeparate(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Nc extends Vi{getDefault(){return i.am.transparent}set(o){const d=this.current;(o.r!==d.r||o.g!==d.g||o.b!==d.b||o.a!==d.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Su extends Vi{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(o,o),this.current=o,this.dirty=!1)}}class Sh extends Vi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=o,this.dirty=!1}}class Eh extends Vi{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Eu extends Vi{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}let Th=class extends Vi{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class yg extends Vi{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class vg extends Vi{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class _g extends Vi{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class Bp extends Vi{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class vd extends Vi{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class zc extends Vi{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class xg extends Vi{getDefault(){return null}set(o){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class _d extends Vi{getDefault(){return null}set(o){this.gl&&(o!==this.current||this.dirty)&&(this.gl.bindVertexArray(o),this.current=o,this.dirty=!1)}}class da extends Vi{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class Ch extends Vi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class Fc extends Vi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class Lf extends Vi{constructor(o,d){super(o),this.context=o,this.parent=d}getDefault(){return null}}class K_ extends Lf{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class $p extends Lf{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,this.attachment(),d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Bc extends Lf{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,this.attachment(),d.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class xd extends $p{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Tu=(m,o,d)=>({u_matrix:m,u_image0:0,u_skirt_height:o,u_ground_shadow_factor:d}),Ah=(m,o,d,g,S,C,M,L,B,q,X,ee,Q,ne,fe,de)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:o,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:d,u_zoom_transition:S,u_merc_center:C,u_image0:0,u_frustum_tl:M,u_frustum_tr:L,u_frustum_br:B,u_frustum_bl:q,u_globe_pos:X,u_globe_radius:ee,u_viewport:Q,u_grid_matrix:de?Float32Array.from(de):new Float32Array(9),u_skirt_height:ne,u_far_z_cutoff:fe});function Rf(m,o){return m!=null&&o!=null&&!(!m.hasData()||!o.hasData())&&m.demTexture!=null&&o.demTexture!=null&&m.tileID.key!==o.tileID.key}const Cl=new class{constructor(){this.operations={}}newMorphing(m,o,d,g,S){if(m in this.operations){const C=this.operations[m];C.to.tileID.key!==d.tileID.key&&(C.queued=d)}else this.operations[m]={startTime:g,phase:0,duration:S,from:o,to:d,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const o=this.operations[m];return{from:o.from,to:o.to,phase:o.phase}}update(m){for(const o in this.operations){const d=this.operations[o];for(d.phase=(m-d.startTime)/d.duration;d.phase>=1||!this._validOp(d);)if(!this._nextOp(d,m)){delete this.operations[o];break}}}_nextOp(m,o){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=o,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},Da={0:null,1:"TERRAIN_VERTEX_MORPHING"};function ts(m,o,d){if(o===0)return 0;const g=o<1&&d===514?.25/o:1;return 6*Math.pow(1.5,22-m)*Math.max(o,1)*g}function gs(m,o){const d=1<<m.z;return!o&&(m.x===0||m.x===d-1)||m.y===0||m.y===d-1}const Bs=m=>({u_matrix:m});function ro(m,o,d,g,S){if(S>0){const C=i.q.now(),M=(C-m.timeAdded)/S,L=o?(C-o.timeAdded)/S:-1,B=d.getSource(),q=g.coveringZoomLevel({tileSize:B.tileSize,roundZoom:B.roundZoom}),X=!o||Math.abs(o.tileID.overscaledZ-q)>Math.abs(m.tileID.overscaledZ-q),ee=X&&m.refreshedUponExpiration?1:i.aD(X?M:1-L,0,1);return m.refreshedUponExpiration&&M>=1&&(m.refreshedUponExpiration=!1),o?{opacity:1,mix:1-ee}:{opacity:ee,mix:0}}return{opacity:1,mix:0}}class jo extends ho{constructor(o){const d={type:"raster-dem",maxzoom:o.transform.maxZoom},g=new i.D(i.d0(),null),S=Ac("mock-dem",d,g,o.style);super("mock-dem",S,!1),S.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,d){o.state="loaded",d(null)}}class Jl extends ho{constructor(o){const d=Ac("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},new i.D(i.d0(),null),o.style);super("proxy",d,!1),d.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,d,g){if(o.freezeTileCoverage)return;this.transform=o;const S=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((C,M)=>{if(C[M.key]="",!this._tiles[M.key]){const L=new Ul(M,this._source.tileSize*M.overscaleFactor(),o.tileZoom);L.state="loaded",this._tiles[M.key]=L}return C},{});for(const C in this._tiles)C in S||(this.freeFBO(C),this._tiles[C].unloadVectorData(),delete this._tiles[C])}freeFBO(o){const d=this.proxyCachedFBO[o];if(d!==void 0){const g=Object.values(d);this.renderCachePool.push(...g),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class $c extends i.aM{constructor(o,d,g){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=d,this.projMatrix=g}}class Do extends i.dt{constructor(o,d){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},o.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),o.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),o.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,S,C]=function(B){const q=new i.ba,X=new i.a_,ee=131;q.reserve(17161),X.reserve(33800);const Q=i.aj/128,ne=i.aj+Q/2,fe=ne+Q;for(let ye=-Q;ye<fe;ye+=Q)for(let he=-Q;he<fe;he+=Q){const Se=he<0||he>ne||ye<0||ye>ne?24575:0,Ae=i.aD(Math.round(he),0,i.aj),Pe=i.aD(Math.round(ye),0,i.aj);q.emplaceBack(Ae+Se,Pe)}const de=(ye,he)=>{const Se=he*ee+ye;X.emplaceBack(Se+1,Se,Se+ee),X.emplaceBack(Se+ee,Se+ee+1,Se+1)};for(let ye=1;ye<129;ye++)for(let he=1;he<129;he++)de(he,ye);return[0,129].forEach(ye=>{for(let he=0;he<130;he++)de(he,ye),de(ye,he)}),[q,X,32768]}(),M=o.context;this.gridBuffer=M.createVertexBuffer(g,i.bc.members),this.gridIndexBuffer=M.createIndexBuffer(S),this.gridSegments=i.bd.simpleSegment(0,0,g.length,S.length),this.gridNoSkirtSegments=i.bd.simpleSegment(0,0,g.length,C),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Jl(d.map),this.orthoMatrix=i.bz(),i.c5(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.aj,0,i.aj,0,1);const L=M.gl;this._overlapStencilMode=new qr({func:L.GEQUAL,mask:255},0,255,L.KEEP,L.KEEP,L.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=d,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new jo(d.map),this._pendingGroundEffectLayers=[]}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),this._style=o,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(o,d,g){if(o&&o.terrain){this._style!==o&&(this.style=o,this._evaluationZoom=void 0);const S=o.terrain.properties,C=o.terrain.drapeRenderMode===0,M=o.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.q.now();const L=o.terrain&&o.terrain.scope,B=S.get("source"),q=C?this._mockSourceCache:o.getSourceCache(B,L);if(!q)return void i.w(`Couldn't find terrain source "${B}".`);if(this.sourceCache=q,this._attenuationRange=o.terrain.getAttenuationRange(),this._exaggeration=M?this.calculateExaggeration(d):S.get("exaggeration"),!d.projection.requiresDraping&&M&&this._exaggeration===0)return void this._disable();this.enabled=!0;const X=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const ee=this.getScaledDemTileSize();this.sourceCache.update(d,ee,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,X(),this._initializing=!0),X(),d.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(d),this._emptyDEMTextureDirty=!0,this._previousZoom=d.zoom}else this._disable()}calculateExaggeration(o){if(this._attenuationRange&&o.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(o.zoom);const d=this._previousCameraAltitude,g=o.getFreeCameraOptions().position.z/o.pixelsPerMeter*o.worldSize;this._previousCameraAltitude=g;const S=d!=null?g-d:Number.MAX_VALUE;if(Math.abs(S)<2)return this._exaggeration;const C=o.zoom,M=this._style.terrain;if(!this._previousUpdateTimestamp)return M.getExaggeration(C);let L=C-this._previousZoom;const B=this._previousUpdateTimestamp;let q=C;this._evaluationZoom!=null&&(q=this._evaluationZoom,Math.abs(C-q)>.5&&(L=.5*(C-q+L)),L*S<0&&(q+=L)),this._evaluationZoom=q;const X=M.getExaggeration(q),ee=X===M.getExaggeration(Math.max(0,q-.1));if(ee&&Math.abs(X-this._exaggeration)<.01)return X;let Q=Math.min(.1,.00375*(this._updateTimestamp-B));return(ee||X<.1||Math.abs(L)<1e-4)&&(Q=Math.min(.2,4*Q)),i.ai(this._exaggeration,X,Q)}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(o){o.coord&&o.dataType==="source"?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):o.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._mergedSourceCaches)this._style._mergedSourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const d=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=g._centerAltitude===0&&this.getAtPointOrZero(i.ac.fromLngLat(g.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const S=this.proxyCoords=d.getIds().map(B=>{const q=d.getTileByID(B).tileID;return q.projMatrix=g.calculateProjMatrix(q.toUnwrapped()),q});(function(B,q){const X=q.transform.pointCoordinate(q.transform.getCameraPoint()),ee=new i.P(X.x,X.y);B.sort((Q,ne)=>{if(ne.overscaledZ-Q.overscaledZ)return ne.overscaledZ-Q.overscaledZ;const fe=new i.P(Q.canonical.x+(1<<Q.canonical.z)*Q.wrap,Q.canonical.y),de=new i.P(ne.canonical.x+(1<<ne.canonical.z)*ne.wrap,ne.canonical.y),ye=ee.mult(1<<Q.canonical.z);return ye.x-=.5,ye.y-=.5,ye.distSqr(fe)-ye.distSqr(de)})})(S,this.painter);const C=this.proxyToSource||{};this.proxyToSource={},S.forEach(B=>{this.proxyToSource[B.key]={}}),this.terrainTileForTile={};const M=this._style._mergedSourceCaches;for(const B in M){const q=M[B];if(!q.used||(q!==this.sourceCache&&this.resetTileLookupCache(q.id),this._setupProxiedCoordsForOrtho(q,o[B],C),q.usedForTerrain))continue;const X=o[B];q.getSource().reparseOverscaled&&this._assignTerrainTiles(X)}this.proxiedCoords[d.id]=S.map(B=>new $c(B,B.key,this.orthoMatrix)),this._assignTerrainTiles(S),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(C),this.renderingToTexture=!1;const L={};this._visibleDemTiles=[];for(const B of this.proxyCoords){const q=this.terrainTileForTile[B.key];if(!q)continue;const X=q.tileID.key;X in L||(this._visibleDemTiles.push(q),L[X]=X)}}_assignTerrainTiles(o){this._initializing||o.forEach(d=>{if(this.terrainTileForTile[d.key])return;const g=this._findTileCoveringTileID(d,this.sourceCache);g&&(this.terrainTileForTile[d.key]=g)})}_prepareDEMTextures(){const o=this.painter.context,d=o.gl;for(const g in this.terrainTileForTile){const S=this.terrainTileForTile[g],C=S.dem;!C||S.demTexture&&!S.needsDEMTextureUpload||(o.activeTexture.set(d.TEXTURE1),gd(this.painter,S,C))}}_prepareDemTileUniforms(o,d,g,S){if(!d||d.demTexture==null)return!1;const C=o.tileID.canonical,M=Math.pow(2,d.tileID.canonical.z-C.z),L=S||"";return g[`u_dem_tl${L}`]=[C.x*M%1,C.y*M%1],g[`u_dem_scale${L}`]=M,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let o=0;const d=this._visibleDemTiles.reduce((g,S)=>{if(!S.dem)return g;const C=S.dem.tree.minimums[0];return C>0&&o++,g+C},0);return o?d/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,d=o.gl;o.activeTexture.set(d.TEXTURE2);const g=this._getLoadedAreaMinimum(),S=new i.du({width:1,height:1},new Float32Array([g]));this._emptyDEMTextureDirty=!1;let C=this._emptyDEMTexture;return C?C.update(S,{premultiply:!1}):C=this._emptyDEMTexture=new i.T(o,S,d.R32F,{premultiply:!1}),C}setupElevationDraw(o,d,g){const S=this.painter.context,C=S.gl,M={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};M.u_exaggeration=this.exaggeration();let L=null,B=null,q=1;if(g&&g.morphing&&this._useVertexMorphing){const ne=g.morphing.srcDemTile,fe=g.morphing.dstDemTile;q=g.morphing.phase,ne&&fe&&(this._prepareDemTileUniforms(o,ne,M,"_prev")&&(B=ne),this._prepareDemTileUniforms(o,fe,M)&&(L=fe))}const X=ne=>ne&&ne.demTexture&&this.painter.linearFloatFilteringSupported()?C.LINEAR:C.NEAREST;let ee=null;var Q;if(this.enabled?B&&L?(ee=L.demTexture,S.activeTexture.set(C.TEXTURE4),B.demTexture.bind(X(B),C.CLAMP_TO_EDGE),M.u_dem_lerp=q):(L=this.terrainTileForTile[o.tileID.key],ee=this._prepareDemTileUniforms(o,L,M)?L.demTexture:this.emptyDEMTexture):ee=this.emptyDEMTexture,S.activeTexture.set(C.TEXTURE2),ee&&(M.u_dem_size=(Q=ee).size[0]===1?1:Q.size[0]-2,ee.bind(X(L),C.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(g&&g.useDepthForOcclusion,d,M),g&&g.useMeterToDem&&L){const ne=(1<<L.tileID.canonical.z)*i.c6(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;M.u_meter_to_dem=ne}if(g&&g.labelPlaneMatrixInv&&(M.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),d.setTerrainUniformValues(S,M),this.painter.transform.projection.name==="globe"){const ne=this.globeUniformValues(this.painter.transform,o.tileID.canonical,g&&g.useDenormalizedUpVectorScale);d.setGlobeUniformValues(S,ne)}}globeUniformValues(o,d,g){const S=o.projection;return{u_tile_tl_up:S.upVector(d,0,0),u_tile_tr_up:S.upVector(d,i.aj,0),u_tile_br_up:S.upVector(d,i.aj,i.aj),u_tile_bl_up:S.upVector(d,0,i.aj),u_tile_up_scale:g?i.dv(1):S.upVectorScale(d,o.center.lat,o.worldSize).metersToTile}}renderToBackBuffer(o){const d=this.painter,g=this.painter.context;o.length!==0&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,d.width,d.height]),d.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(S,C,M,L,B){if(S.transform.projection.name==="globe")(function(q,X,ee,Q,ne){const fe=q.context,de=fe.gl;let ye,he;const Se=q.transform,Ae=i.dl(q,fe,Se),Pe=(At,Mt)=>{if(he===Mt)return;const Zt=[Da[Mt],"PROJECTION_GLOBE_VIEW"];Ae&&Zt.push("CUSTOM_ANTIALIASING");const at=q.isTileAffectedByFog(At);ye=q.getOrCreateProgram("globeRaster",{defines:Zt,overrideFog:at}),he=Mt},Be=q.colorModeForRenderPass(),Fe=new Er(de.LEQUAL,Er.ReadWrite,q.depthRangeFor3D);Cl.update(ne);const je=i.dm(Se),ke=[i.ay(Se.center.lng),i.aH(Se.center.lat)],qe=q.globeSharedBuffers,Ze=[Se.width*i.q.devicePixelRatio,Se.height*i.q.devicePixelRatio],yt=Float32Array.from(Se.globeMatrix),ut={useDenormalizedUpVectorScale:!0};{const At=q.transform,Mt=ts(At.zoom,X.exaggeration(),X.sourceCache._source.tileSize);he=-1;const Zt=de.TRIANGLES;for(const at of Q){const gt=ee.getTile(at),ot=qr.disabled,Lt=X.prevTerrainTileForTile[at.key],vt=X.terrainTileForTile[at.key];Rf(Lt,vt)&&Cl.newMorphing(at.key,Lt,vt,ne,250),fe.activeTexture.set(de.TEXTURE0),gt.texture&&gt.texture.bind(de.LINEAR,de.CLAMP_TO_EDGE);const zt=Cl.getMorphValuesForProxy(at.key),Ot=zt?1:0;zt&&i.L(ut,{morphing:{srcDemTile:zt.from,dstDemTile:zt.to,phase:i.dk(zt.phase)}});const $t=i.dn(at.canonical),Ut=i.dp($t.getCenter().lat),wr=i.dq(at.canonical,$t,Ut,At.worldSize/At._pixelsPerMercatorPixel),Ar=i.bh(i.dr(at.canonical)),dr=Ah(At.expandedFarZProjMatrix,yt,je,Ar,i.ah(At.zoom),ke,At.frustumCorners.TL,At.frustumCorners.TR,At.frustumCorners.BR,At.frustumCorners.BL,At.globeCenterInViewSpace,At.globeRadius,Ze,Mt,At._farZ,wr);if(Pe(at,Ot),ye&&(X.setupElevationDraw(gt,ye,ut),q.uploadCommonUniforms(fe,ye,at.toUnwrapped()),qe)){const[Cr,vr,jr]=qe.getGridBuffers(Ut,Mt!==0);ye.draw(q,Zt,Fe,ot,Be,Zr.backCCW,dr,"globe_raster",Cr,vr,jr)}}}if(qe&&(q.renderDefaultNorthPole||q.renderDefaultSouthPole)){const At=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Ae&&At.push("CUSTOM_ANTIALIASING"),ye=q.getOrCreateProgram("globeRaster",{defines:At});for(const Mt of Q){const{x:Zt,y:at,z:gt}=Mt.canonical,ot=at===0,Lt=at===(1<<gt)-1,[vt,zt,Ot,$t]=qe.getPoleBuffers(gt,!1);if($t&&(ot||Lt)){const Ut=ee.getTile(Mt);fe.activeTexture.set(de.TEXTURE0),Ut.texture&&Ut.texture.bind(de.LINEAR,de.CLAMP_TO_EDGE);let wr=i.ds(gt,Zt,Se);const Ar=i.bh(i.dr(Mt.canonical)),dr=(Cr,vr)=>Cr.draw(q,de.TRIANGLES,Fe,qr.disabled,Be,Zr.disabled,Ah(Se.expandedFarZProjMatrix,wr,wr,Ar,0,ke,Se.frustumCorners.TL,Se.frustumCorners.TR,Se.frustumCorners.BR,Se.frustumCorners.BL,Se.globeCenterInViewSpace,Se.globeRadius,Ze,0,Se._farZ),"globe_pole_raster",vr,Ot,$t);X.setupElevationDraw(Ut,ye,ut),q.uploadCommonUniforms(fe,ye,Mt.toUnwrapped()),ot&&q.renderDefaultNorthPole&&dr(ye,vt),Lt&&q.renderDefaultSouthPole&&(wr=i.cE(i.bz(),wr,[1,-1,1]),dr(ye,zt))}}}})(S,C,M,L,B);else{const q=S.context,X=q.gl;let ee,Q;const ne=S.shadowRenderer,fe=El(S,S.longestCutoffRange),de=Be=>{if(Q===Be)return;const Fe=[];Fe.push(Da[Be]),fe.shouldRenderCutoff&&Fe.push("RENDER_CUTOFF"),ne&&(Fe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),ne.useNormalOffset&&Fe.push("NORMAL_OFFSET")),ee=S.getOrCreateProgram("terrainRaster",{defines:Fe}),Q=Be},ye=S.colorModeForRenderPass(),he=new Er(X.LEQUAL,Er.ReadWrite,S.depthRangeFor3D);Cl.update(B);const Se=S.transform,Ae=ts(Se.zoom,C.exaggeration(),C.sourceCache._source.tileSize);let Pe=[0,0,0];if(ne){const Be=S.style.directionalLight,Fe=S.style.ambientLight;Be&&Fe&&(Pe=tl(S.style,Be,Fe))}{Q=-1;const Be=X.TRIANGLES,[Fe,je]=[C.gridIndexBuffer,C.gridSegments];for(const ke of L){const qe=M.getTile(ke),Ze=qr.disabled,yt=C.prevTerrainTileForTile[ke.key],ut=C.terrainTileForTile[ke.key];Rf(yt,ut)&&Cl.newMorphing(ke.key,yt,ut,B,250),q.activeTexture.set(X.TEXTURE0),qe.texture&&qe.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);const At=Cl.getMorphValuesForProxy(ke.key),Mt=At?1:0;let Zt;At&&(Zt={morphing:{srcDemTile:At.from,dstDemTile:At.to,phase:i.dk(At.phase)}});const at=Tu(ke.projMatrix,gs(ke.canonical,Se.renderWorldCopies)?Ae/10:Ae,Pe);if(de(Mt),!ee)continue;C.setupElevationDraw(qe,ee,Zt);const gt=ke.toUnwrapped();ne&&ne.setupShadows(gt,ee),S.uploadCommonUniforms(q,ee,gt,null,fe),ee.draw(S,Be,he,Ze,ye,Zr.backCCW,at,"terrain_raster",C.gridBuffer,Fe,je)}}}}(d,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,d.gpuTimingDeferredRenderEnd(),o.splice(0,o.length))}renderBatch(o){if(this._drapedRenderBatches.length===0)return o+1;this.renderingToTexture=!0;const d=this.painter,g=this.painter.context,S=this.proxySourceCache,C=this.proxiedCoords[S.id],M=this._drapedRenderBatches.shift(),L=d.style.order,B=[];let q=0;for(const X of C){const ee=S.getTileByID(X.proxyTileKey),Q=S.proxyCachedFBO[X.key]?S.proxyCachedFBO[X.key][o]:void 0,ne=Q!==void 0?S.renderCache[Q]:this.pool[q++],fe=Q!==void 0;if(ee.texture=ne.tex,fe&&!ne.dirty){B.push(ee.tileID);continue}let de;g.bindFramebuffer.set(ne.fb.framebuffer),this.renderedToTile=!1,ne.dirty&&(g.clear({color:i.am.transparent,stencil:0}),ne.dirty=!1);for(let ye=M.start;ye<=M.end;++ye){const he=d.style._mergedLayers[L[ye]];if(he.isHidden(d.transform.zoom))continue;const Se=d.style.getLayerSourceCache(he),Ae=Se?this.proxyToSource[X.key][Se.id]:[X];if(!Ae)continue;const Pe=Ae;g.viewport.set([0,0,ne.fb.width,ne.fb.height]),de!==(Se?Se.id:null)&&(this._setupStencil(ne,Ae,he,Se),de=Se?Se.id:null),d.renderLayer(d,Se,he,Pe)}if(this._drapedRenderBatches.length===0)for(const ye of this._pendingGroundEffectLayers){const he=d.style._mergedLayers[L[ye]];if(he.isHidden(d.transform.zoom))continue;const Se=d.style.getLayerSourceCache(he),Ae=Se?this.proxyToSource[X.key][Se.id]:[X];if(!Ae)continue;const Pe=Ae;g.viewport.set([0,0,ne.fb.width,ne.fb.height]),de!==(Se?Se.id:null)&&(this._setupStencil(ne,Ae,he,Se),de=Se?Se.id:null),d.renderLayer(d,Se,he,Pe)}this.renderedToTile?(ne.dirty=!0,B.push(ee.tileID)):fe||--q,q===5&&(q=0,this.renderToBackBuffer(B))}return this.renderToBackBuffer(B),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,d.width,d.height]),M.end+1}postRender(){}isLayerOrderingCorrect(o){const d=o.order.length;let g=-1,S=d;for(let C=0;C<d;++C)this._style.isLayerDraped(o._mergedLayers[o.order[C]])?g=Math.max(g,C):S=Math.min(S,C);return S>g}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(d=>d.dem).forEach(d=>{o=Math.min(o,d.dem.tree.minimums[0])}),o===0?o:(o-30)*this._exaggeration}raycast(o,d,g){if(!this._visibleDemTiles)return null;const S=this._visibleDemTiles.filter(C=>C.dem).map(C=>{const M=C.tileID,L=1<<M.overscaledZ,{x:B,y:q}=M.canonical,X=B/L,ee=(B+1)/L,Q=q/L,ne=(q+1)/L;return{minx:X,miny:Q,maxx:ee,maxy:ne,t:C.dem.tree.raycastRoot(X,Q,ee,ne,o,d,g),tile:C}});S.sort((C,M)=>(C.t!==null?C.t:Number.MAX_VALUE)-(M.t!==null?M.t:Number.MAX_VALUE));for(const C of S){if(C.t==null)return null;const M=C.tile.dem.tree.raycast(C.minx,C.miny,C.maxx,C.maxy,o,d,g);if(M!=null)return M}return null}_createFBO(){const o=this.painter.context,d=o.gl,g=this.drapeBufferSize;o.activeTexture.set(d.TEXTURE0);const S=new i.T(o,{width:g[0],height:g[1],data:null},d.RGBA8);S.bind(d.LINEAR,d.CLAMP_TO_EDGE);const C=o.createFramebuffer(g[0],g[1],!0,null);return C.colorAttachment.set(S.texture),C.depthAttachment=new xd(o,C.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,C.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):C.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&d.texParameterf(d.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:C,tex:S,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const o in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const d=this._style._mergedLayers[o],g=d.isHidden(this.painter.transform.zoom);return d.type==="hillshade"||d.type==="custom"?!g&&d.shouldRedrape():!g&&d.hasTransition()})}_clearLineLayersFromRenderCache(){let o=!1;for(const g of this._style.getSources())if(g instanceof cs){o=!0;break}if(!o)return;const d={};for(let g=0;g<this._style.order.length;++g){const S=this._style._mergedLayers[this._style.order[g]],C=this._style.getLayerSourceCache(S);if(C&&!d[C.id]&&!S.isHidden(this.painter.transform.zoom)&&S.type==="line"&&S.widthExpression()instanceof i.ab){d[C.id]=!0;for(const M of this.proxyCoords){const L=this.proxyToSource[M.key][C.id];if(L)for(const B of L)this._clearRenderCacheForTile(C.id,B)}}}}_clearRasterLayersFromRenderCache(){let o=!1;for(const g in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[g]._source instanceof $l){o=!0;break}if(!o)return;const d={};for(let g=0;g<this._style.order.length;++g){const S=this._style._mergedLayers[this._style.order[g]],C=this._style.getLayerSourceCache(S);if(!C||d[C.id]||S.isHidden(this.painter.transform.zoom)||S.type!=="raster")continue;const M=S.paint.get("raster-fade-duration");for(const L of this.proxyCoords){const B=this.proxyToSource[L.key][C.id];if(B)for(const q of B){const X=ro(C.getTile(q),C.findLoadedParent(q,0),C,this.painter.transform,M);(X.opacity!==1||X.mix!==0)&&this._clearRenderCacheForTile(C.id,q)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const o=this._style.order,d=o.length;if(d===0)return;const g=[];this._pendingGroundEffectLayers=[];let S,C=0,M=this._style._mergedLayers[o[C]];for(;!this._style.isLayerDraped(M)&&M.isHidden(this.painter.transform.zoom)&&++C<d;)M=this._style._mergedLayers[o[C]];for(;C<d;++C){const L=this._style._mergedLayers[o[C]];L.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(L)?S===void 0&&(S=C):(L.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(C),S!==void 0&&(g.push({start:S,end:C-1}),S=void 0)))}if(S!==void 0&&g.push({start:S,end:C-1}),g.length!==0){const L=g[g.length-1];this._pendingGroundEffectLayers.every(B=>B>L.end)||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=g}_setupRenderCache(o){const d=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,d.renderCache.length>d.renderCachePool.length){const M=Object.values(d.proxyCachedFBO);d.proxyCachedFBO={};for(let L=0;L<M.length;++L){const B=Object.values(M[L]);d.renderCachePool.push(...B)}}return}this._clearRasterLayersFromRenderCache();const g=this.proxyCoords,S=this._tilesDirty;for(let M=g.length-1;M>=0;M--){const L=g[M];if(d.getTileByID(L.key),d.proxyCachedFBO[L.key]!==void 0){const B=o[L.key],q=this.proxyToSource[L.key];let X=0;for(const ee in q){const Q=q[ee],ne=B[ee];if(!ne||ne.length!==Q.length||Q.some((fe,de)=>fe!==ne[de]||S[ee]&&S[ee].hasOwnProperty(fe.key))){X=-1;break}++X}for(const ee in d.proxyCachedFBO[L.key])d.renderCache[d.proxyCachedFBO[L.key][ee]].dirty=X<0||X!==Object.values(B).length}}const C=[...this._drapedRenderBatches];C.sort((M,L)=>L.end-L.start-(M.end-M.start));for(const M of C)for(const L of g){if(d.proxyCachedFBO[L.key])continue;let B=d.renderCachePool.pop();B===void 0&&d.renderCache.length<50&&(B=d.renderCache.length,d.renderCache.push(this._createFBO())),B!==void 0&&(d.proxyCachedFBO[L.key]={},d.proxyCachedFBO[L.key][M.start]=B,d.renderCache[B].dirty=!0)}this._tilesDirty={}}_setupStencil(o,d,g,S){if(!S||!this._sourceTilesOverlap[S.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const C=this.painter.context,M=C.gl;if(d.length<=1)return void(this._overlapStencilType=!1);let L;if(g.isTileClipped())L=d.length,this._overlapStencilMode.test={func:M.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(d[0].overscaledZ>d[d.length-1].overscaledZ))return void(this._overlapStencilType=!1);L=1,this._overlapStencilMode.test={func:M.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+L>255&&(C.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=L,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(d,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):qr.disabled}_renderTileClippingMasks(o,d){const g=this.painter,S=this.painter.context,C=S.gl;g._tileClippingMaskIDs={},S.setColorMode(gn.disabled),S.setDepthMode(Er.disabled);const M=g.getOrCreateProgram("clippingMask");for(const L of o){const B=g._tileClippingMaskIDs[L.key]=--d;M.draw(g,C.TRIANGLES,Er.disabled,new qr({func:C.ALWAYS,mask:0},B,255,C.KEEP,C.KEEP,C.REPLACE),gn.disabled,Zr.disabled,Bs(L.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(o){const d=this.painter.transform;if(o.x<0||o.x>d.width||o.y<0||o.y>d.height)return null;const g=[o.x,o.y,1,1];i.aA(g,g,d.pixelMatrixInverse),i.cw(g,g,1/g[3]),g[0]/=d.worldSize,g[1]/=d.worldSize;const S=d._camera.position,C=i.c6(1,d.center.lat),M=[S[0],S[1],S[2]/C,0],L=i.cY([],g.slice(0,3),M);i.au(L,L);const B=this.raycast(M,L,this._exaggeration);return B!==null&&B?(i.bF(M,M,L,B),M[3]=M[2],M[2]*=C,M):null}_setupProxiedCoordsForOrtho(o,d,g){if(o.getSource()instanceof i.aP)return this._setupProxiedCoordsForImageSource(o,d,g);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const S=this.proxiedCoords[o.id]=[],C=this.proxyCoords;for(let B=0;B<C.length;B++){const q=C[B],X=this._findTileCoveringTileID(q,o);if(X){const ee=this._createProxiedId(q,X,g[q.key]&&g[q.key][o.id]);S.push(ee),this.proxyToSource[q.key][o.id]=[ee]}}let M=!1;const L=new Set;for(let B=0;B<d.length;B++){const q=o.getTile(d[B]);if(!q||!q.hasData())continue;const X=this._findTileCoveringTileID(q.tileID,this.proxySourceCache);if(X&&X.tileID.canonical.z!==q.tileID.canonical.z){const ee=this.proxyToSource[X.tileID.key][o.id],Q=this._createProxiedId(X.tileID,q,g[X.tileID.key]&&g[X.tileID.key][o.id]);ee?ee.splice(ee.length-1,0,Q):this.proxyToSource[X.tileID.key][o.id]=[Q];const ne=this.proxyToSource[X.tileID.key][o.id];L.has(ne)||L.add(ne),S.push(Q),M=!0}}if(this._sourceTilesOverlap[o.id]=M,M&&this._debugParams.sortTilesHiZFirst)for(const B of L)B.sort((q,X)=>X.overscaledZ-q.overscaledZ)}_setupProxiedCoordsForImageSource(o,d,g){if(!o.getSource().loaded())return;const S=this.proxiedCoords[o.id]=[],C=this.proxyCoords,M=o.getSource(),L=M.tileID;if(!L)return;const B=new i.P(L.x,L.y)._div(1<<L.z),q=M.coordinates.map(i.ac.fromLngLat).reduce((ee,Q)=>(ee.min.x=Math.min(ee.min.x,Q.x-B.x),ee.min.y=Math.min(ee.min.y,Q.y-B.y),ee.max.x=Math.max(ee.max.x,Q.x-B.x),ee.max.y=Math.max(ee.max.y,Q.y-B.y),ee),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),X=(ee,Q)=>{const ne=ee.wrap+ee.canonical.x/(1<<ee.canonical.z),fe=ee.canonical.y/(1<<ee.canonical.z),de=i.aj/(1<<ee.canonical.z),ye=Q.wrap+Q.canonical.x/(1<<Q.canonical.z),he=Q.canonical.y/(1<<Q.canonical.z);return ne+de<ye+q.min.x||ne>ye+q.max.x||fe+de<he+q.min.y||fe>he+q.max.y};for(let ee=0;ee<C.length;ee++){const Q=C[ee];for(let ne=0;ne<d.length;ne++){const fe=o.getTile(d[ne]);if(!fe||!fe.hasData()||X(Q,fe.tileID))continue;const de=this._createProxiedId(Q,fe,g[Q.key]&&g[Q.key][o.id]),ye=this.proxyToSource[Q.key][o.id];ye?ye.push(de):this.proxyToSource[Q.key][o.id]=[de],S.push(de)}}}_createProxiedId(o,d,g){let S=this.orthoMatrix;if(g){const C=g.find(M=>M.key===d.tileID.key);if(C)return C}if(d.tileID.key!==o.key){const C=o.canonical.z-d.tileID.canonical.z;let M,L,B;S=i.bz();const q=d.tileID.wrap-o.wrap<<o.overscaledZ;C>0?(M=i.aj>>C,L=M*((d.tileID.canonical.x<<C)-o.canonical.x+q),B=M*((d.tileID.canonical.y<<C)-o.canonical.y)):(M=i.aj<<-C,L=i.aj*(d.tileID.canonical.x-(o.canonical.x+q<<-C)),B=i.aj*(d.tileID.canonical.y-(o.canonical.y<<-C))),i.c5(S,0,M,0,M,0,1),i.bo(S,S,[L,B,0])}return new $c(d.tileID,o.key,S)}_findTileCoveringTileID(o,d){let g=d.getTile(o);if(g&&g.hasData())return g;const S=this._findCoveringTileCache[d.id],C=S[o.key];if(g=C?d.getTileByID(C):null,g&&g.hasData()||C===null)return g;let M=g?g.tileID:o,L=M.overscaledZ;const B=d.getSource().minzoom,q=[];if(!C){const ee=d.getSource().maxzoom;if(o.canonical.z>=ee){const Q=o.canonical.z-ee;d.getSource().reparseOverscaled?(L=Math.max(o.canonical.z+2,d.transform.tileZoom),M=new i.aM(L,o.wrap,ee,o.canonical.x>>Q,o.canonical.y>>Q)):Q!==0&&(L=ee,M=new i.aM(L,o.wrap,ee,o.canonical.x>>Q,o.canonical.y>>Q))}M.key!==o.key&&(q.push(M.key),g=d.getTile(M))}const X=ee=>{q.forEach(Q=>{S[Q]=ee}),q.length=0};for(L-=1;L>=B&&(!g||!g.hasData());L--){g&&X(g.tileID.key);const ee=M.calculateScaledKey(L);if(g=d.getTileByID(ee),g&&g.hasData())break;const Q=S[ee];if(Q===null)break;Q===void 0?q.push(ee):g=d.getTileByID(Q)}return X(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,d){let g=this._tilesDirty[o];g||(g=this._tilesDirty[o]={}),g[d.key]=!0}}function Ph(m,o,d){const g=function(L,B,q){const X=i.bE(B,L),ee=i.bE(q,[.2126,.7152,.0722]),Q=(fe,de,ye)=>(1-ye)*fe+ye*de,ne=Q(1-.3*Math.min(ee,1),1,Math.min(X+1,1));return Q(.92,1,Math.asin(i.aD(B[2],-1,1))/Math.PI+.5)*ne}(m,[0,0,1],o),S=[0,0,0];i.b$(S,d.slice(0,3),g);const C=[0,0,0];i.b$(C,o.slice(0,3),m[2]);const M=[0,0,0];return i.cU(M,S,C),i.cX(M)}const jf=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Vp=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class bd{static cacheKey(o,d,g,S){let C=`${d}${S?S.cacheKey:""}`;for(const M of g)o.usedDefines.includes(M)&&(C+=`/${M}`);return C}constructor(o,d,g,S,C,M){const L=o.gl;this.program=L.createProgram(),this.configuration=S,this.name=d,this.fixedDefines=[...M];const B=S?S.getBinderAttributes():[],q=(g.staticAttributes||[]).concat(B);let X=S?S.defines():[];X=X.concat(M.map(ye=>`#define ${ye}`));const ee=`#version 300 es
`;let Q=ee+X.concat("precision mediump float;",xh,jc.fragmentSource).join(`
`);for(const ye of g.fragmentIncludes)Q+=`
${Ra[ye]}`;Q+=`
${g.fragmentSource}`;let ne=ee+X.concat("precision highp float;",xh,jc.vertexSource).join(`
`);for(const ye of g.vertexIncludes)ne+=`
${Ra[ye]}`;this.forceManualRenderingForInstanceIDShaders=o.forceManualRenderingForInstanceIDShaders&&g.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(ne+=`
uniform int u_instanceID;
`),ne+=`
${g.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(ne=ne.replaceAll("gl_InstanceID","u_instanceID"));const fe=L.createShader(L.FRAGMENT_SHADER);if(L.isContextLost())return void(this.failedToCreate=!0);L.shaderSource(fe,Q),L.compileShader(fe),L.attachShader(this.program,fe);const de=L.createShader(L.VERTEX_SHADER);if(L.isContextLost())this.failedToCreate=!0;else{L.shaderSource(de,ne),L.compileShader(de),L.attachShader(this.program,de),this.attributes={},this.numAttributes=q.length;for(let ye=0;ye<this.numAttributes;ye++)if(q[ye]){const he=q[ye].startsWith("a_")?q[ye]:`a_${q[ye]}`;L.bindAttribLocation(this.program,ye,he),this.attributes[he]=ye}L.linkProgram(this.program),L.deleteShader(de),L.deleteShader(fe),this.fixedUniforms=C(o),this.binderUniforms=S?S.getUniforms(o):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(ye=>({u_instanceID:new i.cc(ye)}))(o)),(M.includes("TERRAIN")||d.indexOf("symbol")!==-1||d.indexOf("circle")!==-1)&&(this.terrainUniforms=(ye=>({u_dem:new i.cc(ye),u_dem_prev:new i.cc(ye),u_dem_tl:new i.c9(ye),u_dem_scale:new i.cb(ye),u_dem_tl_prev:new i.c9(ye),u_dem_scale_prev:new i.cb(ye),u_dem_size:new i.cb(ye),u_dem_lerp:new i.cb(ye),u_exaggeration:new i.cb(ye),u_depth:new i.cc(ye),u_depth_size_inv:new i.c9(ye),u_depth_range_unpack:new i.c9(ye),u_occluder_half_size:new i.cb(ye),u_occlusion_depth_offset:new i.cb(ye),u_meter_to_dem:new i.cb(ye),u_label_plane_matrix_inv:new i.c8(ye)}))(o)),M.includes("GLOBE")&&(this.globeUniforms=(ye=>({u_tile_tl_up:new i.ca(ye),u_tile_tr_up:new i.ca(ye),u_tile_br_up:new i.ca(ye),u_tile_bl_up:new i.ca(ye),u_tile_up_scale:new i.cb(ye)}))(o)),M.includes("FOG")&&(this.fogUniforms=(ye=>({u_fog_matrix:new i.c8(ye),u_fog_range:new i.c9(ye),u_fog_color:new i.cQ(ye),u_fog_horizon_blend:new i.cb(ye),u_fog_vertical_limit:new i.c9(ye),u_fog_temporal_offset:new i.cb(ye),u_frustum_tl:new i.ca(ye),u_frustum_tr:new i.ca(ye),u_frustum_br:new i.ca(ye),u_frustum_bl:new i.ca(ye),u_globe_pos:new i.ca(ye),u_globe_radius:new i.cb(ye),u_globe_transition:new i.cb(ye),u_is_globe:new i.cc(ye),u_viewport:new i.c9(ye)}))(o)),M.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ye=>({u_cutoff_params:new i.cQ(ye)}))(o)),M.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ye=>({u_lighting_ambient_color:new i.ca(ye),u_lighting_directional_dir:new i.ca(ye),u_lighting_directional_color:new i.ca(ye),u_ground_radiance:new i.ca(ye)}))(o)),M.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ye=>({u_light_matrix_0:new i.c8(ye),u_light_matrix_1:new i.c8(ye),u_fade_range:new i.c9(ye),u_shadow_normal_offset:new i.ca(ye),u_shadow_intensity:new i.cb(ye),u_shadow_texel_size:new i.cb(ye),u_shadow_map_resolution:new i.cb(ye),u_shadow_direction:new i.ca(ye),u_shadow_bias:new i.ca(ye),u_shadowmap_0:new i.cc(ye),u_shadowmap_1:new i.cc(ye)}))(o))}}setTerrainUniformValues(o,d){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const S in d)g[S]&&g[S].set(this.program,S,d[S])}}setGlobeUniformValues(o,d){if(!this.globeUniforms)return;const g=this.globeUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const S in d)g[S]&&g[S].set(this.program,S,d[S])}}setFogUniformValues(o,d){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const S in d)g[S].set(this.program,S,d[S])}}setCutoffUniformValues(o,d){if(!this.cutoffUniforms)return;const g=this.cutoffUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const S in d)g[S].set(this.program,S,d[S])}}setLightsUniformValues(o,d){if(!this.lightsUniforms)return;const g=this.lightsUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const S in d)g[S].set(this.program,S,d[S])}}setShadowUniformValues(o,d){if(this.failedToCreate||!this.shadowUniforms)return;const g=this.shadowUniforms;o.program.set(this.program);for(const S in d)g[S].set(this.program,S,d[S])}_drawDebugWireframe(o,d,g,S,C,M,L,B,q,X){const ee=o.options.wireframe;if(ee.terrain===!1&&ee.layers2D===!1&&ee.layers3D===!1)return;const Q=o.context;if(!(!(!ee.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!ee.layers2D||o._terrain&&o._terrain.renderingToTexture||!jf.includes(this.name))||!(!ee.layers3D||!Vp.includes(this.name))))return;const ne=Q.gl,fe=o.wireframeDebugCache.getLinesFromTrianglesBuffer(o.frameCounter,C,Q);if(!fe)return;const de=[...this.fixedDefines];de.push("DEBUG_WIREFRAME");const ye=o.getOrCreateProgram(this.name,{config:this.configuration,defines:de});Q.program.set(ye.program);const he=(Pe,Be,Fe)=>{if(Be[Pe]&&Fe[Pe])for(const je in Be[Pe])Fe[Pe][je]&&Fe[Pe][je].set(Fe.program,je,Be[Pe][je].current)};q&&q.setUniforms(ye.program,Q,ye.binderUniforms,L,{zoom:B}),he("fixedUniforms",this,ye),he("terrainUniforms",this,ye),he("globeUniforms",this,ye),he("fogUniforms",this,ye),he("lightsUniforms",this,ye),he("shadowUniforms",this,ye),fe.bind(),Q.setColorMode(new gn([ne.ONE,ne.ONE_MINUS_SRC_ALPHA,ne.ZERO,ne.ONE],i.am.transparent,[!0,!0,!0,!1])),Q.setDepthMode(new Er(d.func===ne.LESS?ne.LEQUAL:d.func,Er.ReadOnly,d.range)),Q.setStencilMode(qr.disabled);const Se=3*M.primitiveLength*2,Ae=3*M.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const Pe=X||1;for(let Be=0;Be<Pe;++Be)ye.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Be),ne.drawElements(ne.LINES,Se,ne.UNSIGNED_SHORT,Ae)}else X&&X>1?ne.drawElementsInstanced(ne.LINES,Se,ne.UNSIGNED_SHORT,Ae,X):ne.drawElements(ne.LINES,Se,ne.UNSIGNED_SHORT,Ae);C.bind(),Q.program.set(this.program),Q.setDepthMode(d),Q.setStencilMode(g),Q.setColorMode(S)}checkUniforms(o,d,g){if(this.fixedDefines.includes(d)){for(const S of Object.keys(g))if(!g[S].initialized)throw new Error(`Program '${this.name}', from draw '${o}': uniform ${S} not set but required by ${d} being defined`)}}draw(o,d,g,S,C,M,L,B,q,X,ee,Q,ne,fe,de,ye){const he=o.context,Se=he.gl;if(this.failedToCreate)return;he.program.set(this.program),he.setDepthMode(g),he.setStencilMode(S),he.setColorMode(C),he.setCullFace(M);for(const Be of Object.keys(this.fixedUniforms))this.fixedUniforms[Be].set(this.program,Be,L[Be]);fe&&fe.setUniforms(this.program,he,this.binderUniforms,Q,{zoom:ne});const Ae={[Se.POINTS]:1,[Se.LINES]:2,[Se.TRIANGLES]:3,[Se.LINE_STRIP]:1}[d];this.checkUniforms(B,"RENDER_SHADOWS",this.shadowUniforms);const Pe=ye&&ye>0?1:void 0;for(const Be of ee.get()){const Fe=Be.vaos||(Be.vaos={});if((Fe[B]||(Fe[B]=new Mf)).bind(he,this,q,fe?fe.getPaintVertexBuffers():[],X,Be.vertexOffset,de||[],Pe),this.forceManualRenderingForInstanceIDShaders){const je=ye||1;for(let ke=0;ke<je;++ke)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ke),X?Se.drawElements(d,Be.primitiveLength*Ae,Se.UNSIGNED_SHORT,Be.primitiveOffset*Ae*2):Se.drawArrays(d,Be.vertexOffset,Be.vertexLength)}else ye&&ye>1?Se.drawElementsInstanced(d,Be.primitiveLength*Ae,Se.UNSIGNED_SHORT,Be.primitiveOffset*Ae*2,ye):X?Se.drawElements(d,Be.primitiveLength*Ae,Se.UNSIGNED_SHORT,Be.primitiveOffset*Ae*2):Se.drawArrays(d,Be.vertexOffset,Be.vertexLength);d===Se.TRIANGLES&&X&&this._drawDebugWireframe(o,g,S,C,X,Be,Q,ne,fe,ye)}}}function Mh(m,o,d=0){const g=Math.pow(2,o.tileID.overscaledZ),S=o.tileSize*Math.pow(2,m.transform.tileZoom)/g,C=S*(o.tileID.canonical.x+o.tileID.wrap*g),M=S*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.aw(o,1,m.transform.tileZoom),u_pixel_coord_upper:[C>>16,M>>16],u_pixel_coord_lower:[65535&C,65535&M],u_pattern_transition:d}}const Na={terrain:0,flat:1},Df=i.bz(),Vc=(m,o,d,g,S,C,M,L,B,q,X,ee,Q,ne,fe,de,ye,he)=>{const Se=o.style.light,Ae=Se.properties.get("position"),Pe=[Ae.x,Ae.y,Ae.z],Be=i.dx();Se.properties.get("anchor")==="viewport"&&(i.dy(Be,-o.transform.angle),i.dz(Pe,Pe,Be));const Fe=Se.properties.get("color"),je=o.transform,ke={u_matrix:m,u_lightpos:Pe,u_lightintensity:Se.properties.get("intensity"),u_lightcolor:[Fe.r,Fe.g,Fe.b],u_vertical_gradient:+d,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Df,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Na[q],u_base_type:Na[X],u_ao:S,u_edge_radius:C,u_width_scale:M,u_flood_light_color:fe,u_vertical_scale:de,u_flood_light_intensity:ye,u_ground_shadow_factor:he};return je.projection.name==="globe"&&(ke.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],ke.u_zoom_transition=ee,ke.u_inv_rot_matrix=ne,ke.u_merc_center=Q,ke.u_up_dir=je.projection.upVector(new i.cp(0,0,0),Q[0]*i.aj,Q[1]*i.aj),ke.u_height_lift=B),ke},qy=(m,o,d,g,S,C)=>({u_matrix:m,u_edge_radius:o,u_width_scale:d,u_vertical_scale:g,u_height_type:Na[S],u_base_type:Na[C]}),Y_=(m,o,d,g,S,C,M,L,B,q,X,ee,Q,ne,fe,de,ye,he)=>{const Se=Vc(m,o,d,g,S,C,M,L,q,X,ee,Q,ne,fe,de,ye,1,[0,0,0]),Ae={u_height_factor:-Math.pow(2,L.overscaledZ)/B.tileSize/8};return i.l(Se,Mh(o,B,he),Ae)},Uc=(m,o,d)=>({u_matrix:m,u_emissive_strength:o,u_ground_shadow_factor:d}),wd=(m,o,d,g,S,C=0)=>i.l(Uc(m,o,S),Mh(d,g,C)),Ih=(m,o,d,g)=>({u_matrix:m,u_world:d,u_emissive_strength:o,u_ground_shadow_factor:g}),Up=(m,o,d,g,S,C,M=0)=>i.l(wd(m,o,d,g,C,M),{u_world:S}),kh=(m,o)=>({u_matrix:m,u_ground_shadow_factor:o}),Jo=(m,o,d,g,S)=>({u_matrix:m,u_camera_pos:[o[0],o[1],o[2]],u_depth_bias:d,u_height_scale:g,u_reset_depth:S}),za=(m,o,d,g)=>{const S=i.aj/d.tileSize;return{u_matrix:m,u_camera_to_center_distance:o.getCameraToCenterDistance(g),u_extrude_scale:[o.pixelsToGLUnits[0]/S,o.pixelsToGLUnits[1]/S]}},Fa=(m,o,d=1)=>({u_matrix:m,u_color:o.toRenderColor(null),u_overlay:0,u_overlay_scale:d}),Ql=i.bz(),ec=(m,o,d,g,S,C,M)=>{const L=m.transform,B=L.projection.name==="globe",q=B?i.dA(L.zoom,o.canonical)*L._pixelsPerMercatorPixel:i.aw(d,1,C),X={u_matrix:o.projMatrix,u_extrude_scale:q,u_intensity:M,u_inv_rot_matrix:Ql,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(B){X.u_inv_rot_matrix=g,X.u_merc_center=S,X.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],X.u_zoom_transition=i.ah(L.zoom);const ee=S[0]*i.aj,Q=S[1]*i.aj;X.u_up_dir=L.projection.upVector(new i.cp(0,0,0),ee,Q)}return X};function qc(m,[o,d,g,S],[C,M]){if(C===M)return[0,0,0,0];const L=255*(m-1)/(m*(M-C));return[o*L,d*L,g*L,S*L]}function Nf(m,o,[d,g]){return d===g?0:.5/m+(o-d)*(m-1)/(m*(g-d))}const tc=(m,o,d,g,S,C,M,L,B,q,X,ee,Q,ne,fe,de,ye,he,Se,Ae,Pe)=>({u_matrix:m,u_normalize_matrix:o,u_globe_matrix:d,u_merc_matrix:g,u_grid_matrix:S,u_tl_parent:C,u_scale_parent:q,u_fade_t:X.mix,u_opacity:X.opacity*ee.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:ee.paint.get("raster-brightness-min"),u_brightness_high:ee.paint.get("raster-brightness-max"),u_saturation_factor:i.dB(ee.paint.get("raster-saturation")),u_contrast_factor:i.dC(ee.paint.get("raster-contrast")),u_spin_weights:qp(ee.paint.get("raster-hue-rotate")),u_perspective_transform:Q,u_raster_elevation:ne,u_zoom_transition:M,u_merc_center:L,u_cutoff_params:B,u_colorization_mix:qc(i.dD,de,he),u_colorization_offset:Nf(i.dD,ye,he),u_color_ramp:fe,u_texture_offset:[Ae/(Se+2*Ae),Se/(Se+2*Ae)],u_texture_res:[Se+2*Ae,Se+2*Ae],u_emissive_strength:Pe});function qp(m){m*=Math.PI/180;const o=Math.sin(m),d=Math.cos(m);return[(2*d+1)/3,(-Math.sqrt(3)*o-d+1)/3,(Math.sqrt(3)*o-d+1)/3]}const As=.05,ha=(m,o,d,g,S,C,M,L,B,q,X,ee)=>({u_matrix:m,u_normalize_matrix:o,u_globe_matrix:d,u_merc_matrix:g,u_grid_matrix:S,u_tl_parent:C,u_scale_parent:q,u_fade_t:X.mix,u_opacity:X.opacity,u_image0:0,u_image1:1,u_raster_elevation:ee,u_zoom_transition:M,u_merc_center:L,u_cutoff_params:B}),ys=(m,o,d,g,S,C,M,L,B,q)=>({u_particle_texture:m,u_particle_texture_side_len:o,u_tile_offset:d,u_velocity:g,u_color_ramp:C,u_velocity_res:S,u_max_speed:M,u_uv_offset:L,u_data_scale:[255*B[0],255*B[1]],u_data_offset:q,u_particle_pos_scale:1.1,u_particle_pos_offset:[As,As]}),sl=(m,o,d,g,S,C,M,L,B,q)=>({u_particle_texture:m,u_particle_texture_side_len:o,u_velocity:d,u_velocity_res:g,u_max_speed:S,u_speed_factor:C,u_reset_rate:M,u_rand_seed:Math.random(),u_uv_offset:L,u_data_scale:[255*B[0],255*B[1]],u_data_offset:q,u_particle_pos_scale:1.1,u_particle_pos_offset:[As,As]}),Gp=i.bz(),zf=(m,o,d,g,S,C,M,L,B,q,X,ee,Q,ne,fe,de,ye,he,Se,Ae,Pe,Be,Fe)=>{const je=S.transform,ke={u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:je.getCameraToCenterDistance(Se),u_rotate_symbol:+d,u_aspect_ratio:je.width/je.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:M,u_coord_matrix:L,u_is_text:+q,u_elevation_from_sea:B?1:0,u_pitch_with_map:+g,u_texsize:X,u_texsize_icon:ee,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Gp,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Gp,u_up_vector:[0,-1,0],u_color_adj_mat:Pe,u_icon_transition:Be||0,u_gamma_scale:g?S.transform.getCameraToCenterDistance(Se)*Math.cos(S.terrain?0:S.transform._pitch):1,u_device_pixel_ratio:i.q.devicePixelRatio,u_is_halo:1,u_scale_factor:Fe||1,u_ground_shadow_factor:Ae,u_inv_matrix:i.bi(i.bz(),M)};return Se.name==="globe"&&(ke.u_tile_id=[ne.canonical.x,ne.canonical.y,1<<ne.canonical.z],ke.u_zoom_transition=fe,ke.u_inv_rot_matrix=ye,ke.u_merc_center=de,ke.u_camera_forward=je._camera.forward(),ke.u_ecef_origin=i.dE(je.globeMatrix,ne.toUnwrapped()),ke.u_tile_matrix=Float32Array.from(je.globeMatrix),ke.u_up_vector=he),ke},Oh=(m,o,d,g)=>({u_matrix:m,u_emissive_strength:o,u_opacity:d,u_color:g}),Hp=(m,o,d,g,S,C,M,L,B)=>i.l(function(q,X,ee,Q,ne,fe){const{width:de,height:ye}=Q.imageManager.getPixelSize(X),he=Math.pow(2,fe.tileID.overscaledZ),Se=fe.tileSize*Math.pow(2,Q.transform.tileZoom)/he,Ae=Se*(fe.tileID.canonical.x+fe.tileID.wrap*he),Pe=Se*fe.tileID.canonical.y;return{u_image:0,u_pattern_tl:ee.tl,u_pattern_br:ee.br,u_texsize:[de,ye],u_pattern_size:ee.displaySize,u_pattern_units_to_pixels:ne?[Q.transform.width,-1*Q.transform.height]:[1/i.aw(fe,1,Q.transform.tileZoom),1/i.aw(fe,1,Q.transform.tileZoom)],u_pixel_coord_upper:[Ae>>16,Pe>>16],u_pixel_coord_lower:[65535&Ae,65535&Pe]}}(0,C,M,g,L,B),{u_matrix:m,u_emissive_strength:o,u_opacity:d}),Ff=new Float32Array(i.bx([])),rc=(m,o,d,g,S,C,M,L,B,q,X,ee,Q,ne=[0,0,0],fe)=>{const de=S.style.light,ye=de.properties.get("position"),he=[-ye.x,-ye.y,ye.z],Se=i.dx();de.properties.get("anchor")==="viewport"&&(i.dy(Se,-S.transform.angle),i.dz(he,he,Se));const Ae=X.alphaMode==="MASK",Pe=de.properties.get("color").toRenderColor(null),Be=Q.paint.get("model-ambient-occlusion-intensity"),Fe=Q.paint.get("model-color").constantOr(i.am.white).toRenderColor(null),je=Q.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:m,u_lighting_matrix:o,u_normal_matrix:d,u_node_matrix:g||Ff,u_lightpos:he,u_lightintensity:de.properties.get("intensity"),u_lightcolor:[Pe.r,Pe.g,Pe.b],u_camera_pos:ne,u_opacity:C,u_baseTextureIsAlpha:0,u_alphaMask:+Ae,u_alphaCutoff:X.alphaCutoff,u_baseColorFactor:[M.r,M.g,M.b,M.a],u_emissiveFactor:[L[0],L[1],L[2],1],u_metallicFactor:B,u_roughnessFactor:q,u_baseColorTexture:Yo.BaseColor,u_metallicRoughnessTexture:Yo.MetallicRoughness,u_normalTexture:Yo.Normal,u_occlusionTexture:Yo.Occlusion,u_emissionTexture:Yo.Emission,u_lutTexture:Yo.LUT,u_color_mix:[Fe.r,Fe.g,Fe.b,je],u_aoIntensity:Be,u_emissive_strength:ee,u_occlusionTextureTransform:fe||[0,0,0,0]}},bg=(m,o=Ff,d=Ff)=>({u_matrix:m,u_instance:o,u_node_matrix:d}),Lh={fillExtrusion:m=>({u_matrix:new i.c8(m),u_lightpos:new i.ca(m),u_lightintensity:new i.cb(m),u_lightcolor:new i.ca(m),u_vertical_gradient:new i.cb(m),u_opacity:new i.cb(m),u_edge_radius:new i.cb(m),u_width_scale:new i.cb(m),u_ao:new i.c9(m),u_height_type:new i.cc(m),u_base_type:new i.cc(m),u_tile_id:new i.ca(m),u_zoom_transition:new i.cb(m),u_inv_rot_matrix:new i.c8(m),u_merc_center:new i.c9(m),u_up_dir:new i.ca(m),u_height_lift:new i.cb(m),u_flood_light_color:new i.ca(m),u_vertical_scale:new i.cb(m),u_flood_light_intensity:new i.cb(m),u_ground_shadow_factor:new i.ca(m)}),fillExtrusionDepth:m=>({u_matrix:new i.c8(m),u_edge_radius:new i.cb(m),u_width_scale:new i.cb(m),u_vertical_scale:new i.cb(m),u_height_type:new i.cc(m),u_base_type:new i.cc(m)}),fillExtrusionPattern:m=>({u_matrix:new i.c8(m),u_lightpos:new i.ca(m),u_lightintensity:new i.cb(m),u_lightcolor:new i.ca(m),u_vertical_gradient:new i.cb(m),u_height_factor:new i.cb(m),u_edge_radius:new i.cb(m),u_width_scale:new i.cb(m),u_ao:new i.c9(m),u_height_type:new i.cc(m),u_base_type:new i.cc(m),u_tile_id:new i.ca(m),u_zoom_transition:new i.cb(m),u_inv_rot_matrix:new i.c8(m),u_merc_center:new i.c9(m),u_up_dir:new i.ca(m),u_height_lift:new i.cb(m),u_image:new i.cc(m),u_texsize:new i.c9(m),u_pixel_coord_upper:new i.c9(m),u_pixel_coord_lower:new i.c9(m),u_tile_units_to_pixels:new i.cb(m),u_opacity:new i.cb(m),u_pattern_transition:new i.cb(m)}),fillExtrusionGroundEffect:m=>({u_matrix:new i.c8(m),u_opacity:new i.cb(m),u_ao_pass:new i.cb(m),u_meter_to_tile:new i.cb(m),u_ao:new i.c9(m),u_flood_light_intensity:new i.cb(m),u_flood_light_color:new i.ca(m),u_attenuation:new i.cb(m),u_edge_radius:new i.cb(m),u_fb:new i.cc(m),u_fb_size:new i.cb(m),u_dynamic_offset:new i.cb(m)}),fill:m=>({u_matrix:new i.c8(m),u_emissive_strength:new i.cb(m),u_ground_shadow_factor:new i.ca(m)}),fillPattern:m=>({u_matrix:new i.c8(m),u_emissive_strength:new i.cb(m),u_image:new i.cc(m),u_texsize:new i.c9(m),u_pixel_coord_upper:new i.c9(m),u_pixel_coord_lower:new i.c9(m),u_tile_units_to_pixels:new i.cb(m),u_ground_shadow_factor:new i.ca(m),u_pattern_transition:new i.cb(m)}),fillOutline:m=>({u_matrix:new i.c8(m),u_emissive_strength:new i.cb(m),u_world:new i.c9(m),u_ground_shadow_factor:new i.ca(m)}),fillOutlinePattern:m=>({u_matrix:new i.c8(m),u_emissive_strength:new i.cb(m),u_world:new i.c9(m),u_image:new i.cc(m),u_texsize:new i.c9(m),u_pixel_coord_upper:new i.c9(m),u_pixel_coord_lower:new i.c9(m),u_tile_units_to_pixels:new i.cb(m),u_ground_shadow_factor:new i.ca(m),u_pattern_transition:new i.cb(m)}),building:m=>({u_matrix:new i.c8(m),u_normal_matrix:new i.c8(m),u_opacity:new i.cb(m)}),buildingDepth:m=>({u_matrix:new i.c8(m)}),elevatedStructuresDepth:m=>({u_matrix:new i.c8(m),u_depth_bias:new i.cb(m)}),elevatedStructures:m=>({u_matrix:new i.c8(m),u_ground_shadow_factor:new i.ca(m)}),elevatedStructuresDepthReconstruct:m=>({u_matrix:new i.c8(m),u_camera_pos:new i.ca(m),u_depth_bias:new i.cb(m),u_height_scale:new i.cb(m),u_reset_depth:new i.cb(m)}),circle:i.dF,collisionBox:m=>({u_matrix:new i.c8(m),u_camera_to_center_distance:new i.cb(m),u_extrude_scale:new i.c9(m)}),collisionCircle:m=>({u_matrix:new i.c8(m),u_inv_matrix:new i.c8(m),u_camera_to_center_distance:new i.cb(m),u_viewport_size:new i.c9(m)}),debug:m=>({u_color:new i.di(m),u_matrix:new i.c8(m),u_overlay:new i.cc(m),u_overlay_scale:new i.cb(m)}),clippingMask:m=>({u_matrix:new i.c8(m)}),heatmap:m=>({u_extrude_scale:new i.cb(m),u_intensity:new i.cb(m),u_matrix:new i.c8(m),u_inv_rot_matrix:new i.c8(m),u_merc_center:new i.c9(m),u_tile_id:new i.ca(m),u_zoom_transition:new i.cb(m),u_up_dir:new i.ca(m)}),heatmapTexture:m=>({u_image:new i.cc(m),u_color_ramp:new i.cc(m),u_opacity:new i.cb(m)}),hillshade:m=>({u_matrix:new i.c8(m),u_image:new i.cc(m),u_latrange:new i.c9(m),u_light:new i.c9(m),u_shadow:new i.di(m),u_highlight:new i.di(m),u_emissive_strength:new i.cb(m),u_accent:new i.di(m)}),hillshadePrepare:m=>({u_matrix:new i.c8(m),u_image:new i.cc(m),u_dimension:new i.c9(m),u_zoom:new i.cb(m)}),line:i.dG,linePattern:i.dH,raster:m=>({u_matrix:new i.c8(m),u_normalize_matrix:new i.c8(m),u_globe_matrix:new i.c8(m),u_merc_matrix:new i.c8(m),u_grid_matrix:new i.dj(m),u_tl_parent:new i.c9(m),u_scale_parent:new i.cb(m),u_fade_t:new i.cb(m),u_opacity:new i.cb(m),u_image0:new i.cc(m),u_image1:new i.cc(m),u_brightness_low:new i.cb(m),u_brightness_high:new i.cb(m),u_saturation_factor:new i.cb(m),u_contrast_factor:new i.cb(m),u_spin_weights:new i.ca(m),u_perspective_transform:new i.c9(m),u_raster_elevation:new i.cb(m),u_zoom_transition:new i.cb(m),u_merc_center:new i.c9(m),u_cutoff_params:new i.cQ(m),u_colorization_mix:new i.cQ(m),u_colorization_offset:new i.cb(m),u_color_ramp:new i.cc(m),u_texture_offset:new i.c9(m),u_texture_res:new i.c9(m),u_emissive_strength:new i.cb(m)}),rasterParticle:m=>({u_matrix:new i.c8(m),u_normalize_matrix:new i.c8(m),u_globe_matrix:new i.c8(m),u_merc_matrix:new i.c8(m),u_grid_matrix:new i.dj(m),u_tl_parent:new i.c9(m),u_scale_parent:new i.cb(m),u_fade_t:new i.cb(m),u_opacity:new i.cb(m),u_image0:new i.cc(m),u_image1:new i.cc(m),u_raster_elevation:new i.cb(m),u_zoom_transition:new i.cb(m),u_merc_center:new i.c9(m),u_cutoff_params:new i.cQ(m)}),rasterParticleTexture:m=>({u_texture:new i.cc(m),u_opacity:new i.cb(m)}),rasterParticleDraw:m=>({u_particle_texture:new i.cc(m),u_particle_texture_side_len:new i.cb(m),u_tile_offset:new i.c9(m),u_velocity:new i.cc(m),u_color_ramp:new i.cc(m),u_velocity_res:new i.c9(m),u_max_speed:new i.cb(m),u_uv_offset:new i.c9(m),u_data_scale:new i.c9(m),u_data_offset:new i.cb(m),u_particle_pos_scale:new i.cb(m),u_particle_pos_offset:new i.c9(m)}),rasterParticleUpdate:m=>({u_particle_texture:new i.cc(m),u_particle_texture_side_len:new i.cb(m),u_velocity:new i.cc(m),u_velocity_res:new i.c9(m),u_max_speed:new i.cb(m),u_speed_factor:new i.cb(m),u_reset_rate:new i.cb(m),u_rand_seed:new i.cb(m),u_uv_offset:new i.c9(m),u_data_scale:new i.c9(m),u_data_offset:new i.cb(m),u_particle_pos_scale:new i.cb(m),u_particle_pos_offset:new i.c9(m)}),symbol:m=>({u_is_size_zoom_constant:new i.cc(m),u_is_size_feature_constant:new i.cc(m),u_size_t:new i.cb(m),u_size:new i.cb(m),u_camera_to_center_distance:new i.cb(m),u_rotate_symbol:new i.cc(m),u_aspect_ratio:new i.cb(m),u_fade_change:new i.cb(m),u_matrix:new i.c8(m),u_label_plane_matrix:new i.c8(m),u_coord_matrix:new i.c8(m),u_is_text:new i.cc(m),u_elevation_from_sea:new i.cc(m),u_pitch_with_map:new i.cc(m),u_texsize:new i.c9(m),u_texsize_icon:new i.c9(m),u_texture:new i.cc(m),u_texture_icon:new i.cc(m),u_gamma_scale:new i.cb(m),u_device_pixel_ratio:new i.cb(m),u_tile_id:new i.ca(m),u_zoom_transition:new i.cb(m),u_inv_rot_matrix:new i.c8(m),u_merc_center:new i.c9(m),u_camera_forward:new i.ca(m),u_tile_matrix:new i.c8(m),u_up_vector:new i.ca(m),u_ecef_origin:new i.ca(m),u_is_halo:new i.cc(m),u_icon_transition:new i.cb(m),u_color_adj_mat:new i.c8(m),u_scale_factor:new i.cb(m),u_ground_shadow_factor:new i.ca(m),u_inv_matrix:new i.c8(m)}),background:m=>({u_matrix:new i.c8(m),u_emissive_strength:new i.cb(m),u_opacity:new i.cb(m),u_color:new i.di(m)}),backgroundPattern:m=>({u_matrix:new i.c8(m),u_emissive_strength:new i.cb(m),u_opacity:new i.cb(m),u_image:new i.cc(m),u_pattern_tl:new i.c9(m),u_pattern_br:new i.c9(m),u_texsize:new i.c9(m),u_pattern_size:new i.c9(m),u_pixel_coord_upper:new i.c9(m),u_pixel_coord_lower:new i.c9(m),u_pattern_units_to_pixels:new i.c9(m)}),terrainRaster:m=>({u_matrix:new i.c8(m),u_image0:new i.cc(m),u_skirt_height:new i.cb(m),u_ground_shadow_factor:new i.ca(m)}),skybox:m=>({u_matrix:new i.c8(m),u_sun_direction:new i.ca(m),u_cubemap:new i.cc(m),u_opacity:new i.cb(m),u_temporal_offset:new i.cb(m)}),skyboxGradient:m=>({u_matrix:new i.c8(m),u_color_ramp:new i.cc(m),u_center_direction:new i.ca(m),u_radius:new i.cb(m),u_opacity:new i.cb(m),u_temporal_offset:new i.cb(m)}),skyboxCapture:m=>({u_matrix_3f:new i.dj(m),u_sun_direction:new i.ca(m),u_sun_intensity:new i.cb(m),u_color_tint_r:new i.cQ(m),u_color_tint_m:new i.cQ(m),u_luminance:new i.cb(m)}),globeRaster:m=>({u_proj_matrix:new i.c8(m),u_globe_matrix:new i.c8(m),u_normalize_matrix:new i.c8(m),u_merc_matrix:new i.c8(m),u_zoom_transition:new i.cb(m),u_merc_center:new i.c9(m),u_image0:new i.cc(m),u_grid_matrix:new i.dj(m),u_skirt_height:new i.cb(m),u_far_z_cutoff:new i.cb(m),u_frustum_tl:new i.ca(m),u_frustum_tr:new i.ca(m),u_frustum_br:new i.ca(m),u_frustum_bl:new i.ca(m),u_globe_pos:new i.ca(m),u_globe_radius:new i.cb(m),u_viewport:new i.c9(m)}),globeAtmosphere:m=>({u_frustum_tl:new i.ca(m),u_frustum_tr:new i.ca(m),u_frustum_br:new i.ca(m),u_frustum_bl:new i.ca(m),u_horizon:new i.cb(m),u_transition:new i.cb(m),u_fadeout_range:new i.cb(m),u_color:new i.cQ(m),u_high_color:new i.cQ(m),u_space_color:new i.cQ(m),u_temporal_offset:new i.cb(m),u_horizon_angle:new i.cb(m)}),model:m=>({u_matrix:new i.c8(m),u_lighting_matrix:new i.c8(m),u_normal_matrix:new i.c8(m),u_node_matrix:new i.c8(m),u_lightpos:new i.ca(m),u_lightintensity:new i.cb(m),u_lightcolor:new i.ca(m),u_camera_pos:new i.ca(m),u_opacity:new i.cb(m),u_baseColorFactor:new i.cQ(m),u_emissiveFactor:new i.cQ(m),u_metallicFactor:new i.cb(m),u_roughnessFactor:new i.cb(m),u_baseTextureIsAlpha:new i.cc(m),u_alphaMask:new i.cc(m),u_alphaCutoff:new i.cb(m),u_baseColorTexture:new i.cc(m),u_metallicRoughnessTexture:new i.cc(m),u_normalTexture:new i.cc(m),u_occlusionTexture:new i.cc(m),u_emissionTexture:new i.cc(m),u_lutTexture:new i.cc(m),u_color_mix:new i.cQ(m),u_aoIntensity:new i.cb(m),u_emissive_strength:new i.cb(m),u_occlusionTextureTransform:new i.cQ(m)}),modelDepth:m=>({u_matrix:new i.c8(m),u_instance:new i.c8(m),u_node_matrix:new i.c8(m)}),groundShadow:m=>({u_matrix:new i.c8(m),u_ground_shadow_factor:new i.ca(m)}),stars:m=>({u_matrix:new i.c8(m),u_up:new i.ca(m),u_right:new i.ca(m),u_intensity_multiplier:new i.cb(m)}),snowParticle:m=>({u_modelview:new i.c8(m),u_projection:new i.c8(m),u_time:new i.cb(m),u_cam_pos:new i.ca(m),u_velocityConeAperture:new i.cb(m),u_velocity:new i.cb(m),u_horizontalOscillationRadius:new i.cb(m),u_horizontalOscillationRate:new i.cb(m),u_boxSize:new i.cb(m),u_billboardSize:new i.cb(m),u_simpleShapeParameters:new i.c9(m),u_screenSize:new i.c9(m),u_thinningCenterPos:new i.c9(m),u_thinningShape:new i.ca(m),u_thinningAffectedRatio:new i.cb(m),u_thinningParticleOffset:new i.cb(m),u_particleColor:new i.cQ(m),u_direction:new i.ca(m)}),rainParticle:m=>({u_modelview:new i.c8(m),u_projection:new i.c8(m),u_time:new i.cb(m),u_cam_pos:new i.ca(m),u_texScreen:new i.cc(m),u_velocityConeAperture:new i.cb(m),u_velocity:new i.cb(m),u_boxSize:new i.cb(m),u_rainDropletSize:new i.c9(m),u_distortionStrength:new i.cb(m),u_rainDirection:new i.ca(m),u_color:new i.cQ(m),u_screenSize:new i.c9(m),u_thinningCenterPos:new i.c9(m),u_thinningShape:new i.ca(m),u_thinningAffectedRatio:new i.cb(m),u_thinningParticleOffset:new i.cb(m),u_shapeDirectionalPower:new i.cb(m),u_shapeNormalPower:new i.cb(m),u_mode:new i.cb(m)}),vignette:m=>({u_vignetteShape:new i.ca(m),u_vignetteColor:new i.cQ(m)}),occlusion:m=>({u_matrix:new i.c8(m),u_anchorPos:new i.ca(m),u_screenSizePx:new i.c9(m),u_occluderSizePx:new i.c9(m),u_color:new i.cQ(m)})};class Al{constructor(o,d,g,S){this.id=Al.uniqueIdxCounter,Al.uniqueIdxCounter++,this.context=o;const C=o.gl;this.buffer=C.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),C.bufferData(C.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||S||d.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){this.id=Al.uniqueIdxCounter,Al.uniqueIdxCounter++;const d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Al.uniqueIdxCounter=0;const J_={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Sd{constructor(o,d,g,S,C,M){this.length=d.length,this.attributes=g,this.itemSize=d.bytesPerElement,this.dynamicDraw=S,this.instanceCount=M,this.context=o;const L=o.gl;this.buffer=L.createBuffer(),o.bindVertexBuffer.set(this.buffer),L.bufferData(L.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?L.DYNAMIC_DRAW:L.STATIC_DRAW),this.dynamicDraw||C||d.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,d){for(let g=0;g<this.attributes.length;g++){const S=d.attributes[this.attributes[g].name];S!==void 0&&o.enableVertexAttribArray(S)}}setVertexAttribPointers(o,d,g){for(let S=0;S<this.attributes.length;S++){const C=this.attributes[S],M=d.attributes[C.name];M!==void 0&&o.vertexAttribPointer(M,C.components,o[J_[C.type]],!1,this.itemSize,C.offset+this.itemSize*(g||0))}}setVertexAttribDivisor(o,d,g){for(let S=0;S<this.attributes.length;S++){const C=d.attributes[this.attributes[S].name];C!==void 0&&this.instanceCount&&this.instanceCount>0&&o.vertexAttribDivisor(C,g)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ed{constructor(o,d,g,S,C){this.context=o,this.width=d,this.height=g;const M=this.framebuffer=o.gl.createFramebuffer();S&&(this.colorAttachment=new K_(o,M)),C&&(this.depthAttachmentType=C,this.depthAttachment=C==="renderbuffer"?new $p(o,M):new Bc(o,M))}destroy(){const o=this.context.gl;if(this.colorAttachment){const d=this.colorAttachment.get();d&&o.deleteTexture(d)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const d=this.depthAttachment.get();d&&o.deleteRenderbuffer(d)}else{const d=this.depthAttachment.get();d&&o.deleteTexture(d)}o.deleteFramebuffer(this.framebuffer)}}class Td{constructor(o,d){this.gl=o,this.clearColor=new Uy(this),this.clearDepth=new Cs(this),this.clearStencil=new fg(this),this.colorMask=new If(this),this.depthMask=new kf(this),this.stencilMask=new Of(this),this.stencilFunc=new pg(this),this.stencilOp=new bh(this),this.stencilTest=new wh(this),this.depthRange=new Dc(this),this.depthTest=new Fp(this),this.depthFunc=new yd(this),this.blend=new mg(this),this.blendFunc=new gg(this),this.blendColor=new Nc(this),this.blendEquation=new Su(this),this.cullFace=new Sh(this),this.cullFaceSide=new Eh(this),this.frontFace=new Eu(this),this.program=new Th(this),this.activeTexture=new yg(this),this.viewport=new vg(this),this.bindFramebuffer=new _g(this),this.bindRenderbuffer=new Bp(this),this.bindTexture=new vd(this),this.bindVertexBuffer=new zc(this),this.bindElementBuffer=new xg(this),this.bindVertexArrayOES=new _d(this),this.pixelStoreUnpack=new da(this),this.pixelStoreUnpackPremultiplyAlpha=new Ch(this),this.pixelStoreUnpackFlipY=new Fc(this),this.options=d?Object.assign({},d):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=o.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=o.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=o.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=d&&!!d.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=o.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),this.maxPointSize=o.getParameter(o.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,d,g){return new Al(this,o,d,g)}createVertexBuffer(o,d,g,S,C){return new Sd(this,o,d,g,S,C)}createRenderbuffer(o,d,g){const S=this.gl,C=S.createRenderbuffer();return this.bindRenderbuffer.set(C),S.renderbufferStorage(S.RENDERBUFFER,o,d,g),this.bindRenderbuffer.set(null),C}createFramebuffer(o,d,g,S){return new Ed(this,o,d,g,S)}clear({color:o,depth:d,stencil:g,colorMask:S}){const C=this.gl;let M=0;o&&(M|=C.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set(S||[!0,!0,!0,!0])),d!==void 0&&(M|=C.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),g!==void 0&&(M|=C.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),C.clear(M)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){i.bv(o.blendFunction,gn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor),o.blendEquation?this.blendEquation.set(o.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(o.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Cu;function Pl(m,o,d,g,S,C,M){const L=m.context,B=L.gl,q=m.transform,X=m.getOrCreateProgram("collisionBox"),ee=[];let Q=0,ne=0;for(let Pe=0;Pe<g.length;Pe++){const Be=g[Pe],Fe=o.getTile(Be),je=Fe.getBucket(d);if(!je)continue;const ke=fh(Be,je,q);let qe=ke;S[0]===0&&S[1]===0||(qe=m.translatePosMatrix(ke,Fe,S,C));const Ze=M?je.textCollisionBox:je.iconCollisionBox,yt=je.collisionCircleArray;if(yt.length>0){const ut=i.bz(),At=qe;i.cB(ut,je.placementInvProjMatrix,q.glCoordMatrix),i.cB(ut,ut,je.placementViewportMatrix),ee.push({circleArray:yt,circleOffset:ne,transform:At,invTransform:ut,projection:je.getProjection()}),Q+=yt.length/4,ne=Q}Ze&&(m.terrain&&m.terrain.setupElevationDraw(Fe,X),X.draw(m,B.LINES,Er.disabled,qr.disabled,m.colorModeForRenderPass(),Zr.disabled,za(qe,q,Fe,je.getProjection()),d.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ze.segments,null,q.zoom,null,[Ze.collisionVertexBuffer,Ze.collisionVertexBufferExt]))}if(!M||!ee.length)return;const fe=m.getOrCreateProgram("collisionCircle"),de=new i.dI;de.resize(4*Q),de._trim();let ye=0;for(const Pe of ee)for(let Be=0;Be<Pe.circleArray.length/4;Be++){const Fe=4*Be,je=Pe.circleArray[Fe+0],ke=Pe.circleArray[Fe+1],qe=Pe.circleArray[Fe+2],Ze=Pe.circleArray[Fe+3];de.emplace(ye++,je,ke,qe,Ze,0),de.emplace(ye++,je,ke,qe,Ze,1),de.emplace(ye++,je,ke,qe,Ze,2),de.emplace(ye++,je,ke,qe,Ze,3)}(!Cu||Cu.length<2*Q)&&(Cu=function(Pe){const Be=2*Pe,Fe=new i.a_;Fe.resize(Be),Fe._trim();for(let je=0;je<Be;je++){const ke=6*je;Fe.uint16[ke+0]=4*je+0,Fe.uint16[ke+1]=4*je+1,Fe.uint16[ke+2]=4*je+2,Fe.uint16[ke+3]=4*je+2,Fe.uint16[ke+4]=4*je+3,Fe.uint16[ke+5]=4*je+0}return Fe}(Q));const he=L.createIndexBuffer(Cu,!0),Se=L.createVertexBuffer(de,i.dJ.members,!0);for(const Pe of ee){const Be={u_matrix:Pe.transform,u_inv_matrix:Pe.invTransform,u_camera_to_center_distance:(Ae=q).getCameraToCenterDistance(Pe.projection),u_viewport_size:[Ae.width,Ae.height]};fe.draw(m,B.TRIANGLES,Er.disabled,qr.disabled,m.colorModeForRenderPass(),Zr.disabled,Be,d.id,Se,he,i.bd.simpleSegment(0,2*Pe.circleOffset,Pe.circleArray.length,Pe.circleArray.length/2),null,q.zoom)}var Ae;Se.destroy(),he.destroy()}const Rh=i.bz();function Au(m){const o=m._camera.getWorldToCamera(m.worldSize,1),d=i.az([],o,m.globeMatrix);i.bi(d,d);const g=[0,0,0],S=[0,1,0,0];return i.aA(S,S,d),g[0]=S[0],g[1]=S[1],g[2]=S[2],i.au(g,g),g}function Cd({width:m,height:o,anchor:d,textOffset:g,textScale:S},C){const{horizontalAlign:M,verticalAlign:L}=i.bV(d),B=-(M-.5)*m,q=-(L-.5)*o,X=i.bU(d,g);return new i.P((B/S+X[0])*C,(q/S+X[1])*C)}function Pu(m,o,d,g,S,C,M,L,B,q){const X=m.text.placedSymbolArray,ee=m.text.dynamicLayoutVertexArray,Q=m.icon.dynamicLayoutVertexArray,ne={},fe=m.getProjection(),de=ud(M,fe,S),ye=S.elevation,he=fe.upVectorScale(M.canonical,S.center.lat,S.worldSize).metersToTile;ee.clear();for(let Se=0;Se<X.length;Se++){const Ae=X.get(Se),{tileAnchorX:Pe,tileAnchorY:Be,numGlyphs:Fe}=Ae,je=Ae.hidden||!Ae.crossTileID||m.allowVerticalPlacement&&!Ae.placedOrientation?null:g[Ae.crossTileID];if(je){let ke=0,qe=0,Ze=0;if(ye){const Lt=ye?ye.getAtTileOffset(M,Pe,Be):0,[vt,zt,Ot]=fe.upVector(M.canonical,Pe,Be);ke=Lt*vt*he,qe=Lt*zt*he,Ze=Lt*Ot*he}let[yt,ut,At,Mt]=ko(Ae.projectedAnchorX+ke,Ae.projectedAnchorY+qe,Ae.projectedAnchorZ+Ze,d?de:C);const Zt=Hl(S.getCameraToCenterDistance(fe),Mt);let at=i.bJ(m.textSizeData,B,Ae)*Zt/i.bO;d&&(at*=m.tilePixelRatio/L);const gt=Cd(je,at);d?({x:yt,y:ut,z:At}=fe.projectTilePoint(Pe+gt.x,Be+gt.y,M.canonical),[yt,ut,At]=ko(yt+ke,ut+qe,At+Ze,C)):(o&&gt._rotate(-S.angle),yt+=gt.x,ut+=gt.y,At=0);const ot=m.allowVerticalPlacement&&Ae.placedOrientation===i.bI.vertical?Math.PI/2:0;for(let Lt=0;Lt<Fe;Lt++)i.bL(ee,yt,ut,At,ot);q&&Ae.associatedIconIndex>=0&&(ne[Ae.associatedIconIndex]={x:yt,y:ut,z:At,angle:ot})}else Pn(Fe,ee)}if(q){Q.clear();const Se=m.icon.placedSymbolArray;for(let Ae=0;Ae<Se.length;Ae++){const Pe=Se.get(Ae),{numGlyphs:Be}=Pe,Fe=ne[Ae];if(Pe.hidden||!Fe)Pn(Be,Q);else{const{x:je,y:ke,z:qe,angle:Ze}=Fe;for(let yt=0;yt<Be;yt++)i.bL(Q,je,ke,qe,Ze)}}m.icon.dynamicLayoutVertexBuffer.updateData(Q)}m.text.dynamicLayoutVertexBuffer.updateData(ee)}function jh(m,o,d,g,S,C,M={}){const L=d.paint.get("icon-translate"),B=d.paint.get("text-translate"),q=d.paint.get("icon-translate-anchor"),X=d.paint.get("text-translate-anchor"),ee=d.layout.get("icon-rotation-alignment"),Q=d.layout.get("text-rotation-alignment"),ne=d.layout.get("icon-pitch-alignment"),fe=d.layout.get("text-pitch-alignment"),de=d.layout.get("icon-keep-upright"),ye=d.layout.get("text-keep-upright"),he=d.paint.get("icon-color-saturation"),Se=d.paint.get("icon-color-contrast"),Ae=d.paint.get("icon-color-brightness-min"),Pe=d.paint.get("icon-color-brightness-max"),Be=d.layout.get("symbol-elevation-reference")==="sea",Fe=m.context,je=Fe.gl,ke=m.transform,qe=ee==="map",Ze=Q==="map",yt=ne==="map",ut=fe==="map",At=d.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Mt=!1;const Zt=m.depthModeForSublayer(0,Er.ReadOnly),at=new Er(m.context.gl.LEQUAL,Er.ReadOnly,m.depthRangeFor3D),gt=[i.ay(ke.center.lng),i.aH(ke.center.lat)],ot=d.layout.get("text-variable-anchor"),Lt=ke.projection.name==="globe",vt=[],zt=[0,-1,0];for(const Ot of g){const $t=o.getTile(Ot),Ut=$t.getBucket(d);if(!Ut||Ut.projection.name==="mercator"&&Lt||Ut.fullyClipped)continue;const wr=Ut.projection.name==="globe",Ar=wr?i.ah(ke.zoom):0,dr=ud(Ot,Ut.getProjection(),ke),Cr=ke.calculatePixelsToTileUnitsMatrix($t),vr=ot&&Ut.hasTextData(),jr=Ut.hasIconTextFit()&&vr&&Ut.hasIconData(),Qr=Ut.elevationType==="road"?at:Zt,_n=Ut.getProjection().createInversionMatrix(ke,Ot.canonical),ii=m.shadowRenderer,si=Ut.elevationType==="road"&&!!ii&&ii.enabled;let fn=[0,0,0];if(si){const Di=m.style.directionalLight,pn=m.style.ambientLight;Di&&pn&&(fn=tl(m.style,Di,pn))}const Gi=Di=>{ke.depthOcclusionForSymbolsAndCircles&&(d.hasInitialOcclusionOpacityProperties||m.terrain)&&(Di.push("DEPTH_D24"),Di.push("DEPTH_OCCLUSION"))},Pi=()=>{const Di=qe&&d.layout.get("symbol-placement")!=="point",pn=[];Gi(pn);const Si=Di||jr,zn=d.paint.get("icon-image-cross-fade");m.terrainRenderModeElevated()&&yt&&pn.push("PITCH_WITH_MAP_TERRAIN"),wr&&(pn.push("PROJECTION_GLOBE_VIEW"),Si&&pn.push("PROJECTED_POS_ON_VIEWPORT")),zn>0&&pn.push("ICON_TRANSITION"),Ut.icon.zOffsetVertexBuffer&&pn.push("Z_OFFSET"),he===0&&Se===0&&Ae===0&&Pe===1||pn.push("COLOR_ADJUSTMENT"),Ut.sdfIcons&&pn.push("RENDER_SDF"),si&&pn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const ci=Ut.icon.programConfigurations.get(d.id),Zn=m.getOrCreateProgram("symbol",{config:ci,defines:pn}),pi=$t.imageAtlasTexture?$t.imageAtlasTexture.size:[0,0],Vs=Ut.iconSizeData,Mn=i.bH(Vs,ke.zoom),oo=yt||ke.pitch!==0,ds=lh(dr,$t.tileID.canonical,yt,qe,ke,Ut.getProjection(),Cr),yo=_f(dr,$t.tileID.canonical,yt,qe,ke,Ut.getProjection(),Cr),Ll=m.translatePosMatrix(yo,$t,L,q,!0),fc=m.translatePosMatrix(dr,$t,L,q),ma=Si?Rh:ds,dl=qe&&!yt&&!Di;let Ws=zt;!Lt&&!ke.mercatorFromTransition||qe||(Ws=Au(ke));const hl=wr?Ws:zt,Rl=d.getColorAdjustmentMatrix(he,Se,Ae,Pe),qa=zf(Vs.kind,Mn,dl,yt,m,fc,ma,Ll,Be,!1,pi,[0,0],!0,Ot,Ar,gt,_n,hl,Ut.getProjection(),fn,Rl,zn),pc=$t.imageAtlasTexture?$t.imageAtlasTexture:null,mc=d.layout.get("icon-size").constantOr(0)!==1||Ut.iconsNeedLinear,Dd=Ut.sdfIcons||m.options.rotating||m.options.zooming||mc||oo?je.LINEAR:je.NEAREST,Hh=Ut.sdfIcons&&d.paint.get("icon-halo-width").constantOr(1)!==0,Nd=m.terrain&&yt&&Di?i.bi(i.bz(),ds):Rh;if(Di&&Ut.icon){const Mi=ke.elevation,Fu=Mi?Mi.getAtTileOffsetFunc(Ot,ke.center.lat,ke.worldSize,Ut.getProjection()):null,Rg=Lp(dr,$t.tileID.canonical,yt,qe,ke,Ut.getProjection(),Cr);Wl(Ut,dr,m,!1,Rg,yo,yt,de,Fu,Ot)}return{program:Zn,buffers:Ut.icon,uniformValues:qa,atlasTexture:pc,atlasTextureIcon:null,atlasInterpolation:Dd,atlasInterpolationIcon:null,isSDF:Ut.sdfIcons,hasHalo:Hh,depthMode:Qr,tile:$t,renderWithShadows:si,labelPlaneMatrixInv:Nd}},en=()=>{const Di=Ze&&d.layout.get("symbol-placement")!=="point",pn=[],Si=Di||ot||jr;m.terrainRenderModeElevated()&&ut&&pn.push("PITCH_WITH_MAP_TERRAIN"),wr&&(pn.push("PROJECTION_GLOBE_VIEW"),Si&&pn.push("PROJECTED_POS_ON_VIEWPORT")),Ut.text.zOffsetVertexBuffer&&pn.push("Z_OFFSET"),Ut.iconsInText&&pn.push("RENDER_TEXT_AND_SYMBOL"),pn.push("RENDER_SDF"),si&&pn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Gi(pn);const zn=Ut.text.programConfigurations.get(d.id),ci=m.getOrCreateProgram("symbol",{config:zn,defines:pn});let Zn,pi=[0,0],Vs=null;const Mn=Ut.textSizeData;Ut.iconsInText&&(pi=$t.imageAtlasTexture?$t.imageAtlasTexture.size:[0,0],Vs=$t.imageAtlasTexture?$t.imageAtlasTexture:null,Zn=ut||ke.pitch!==0||m.options.rotating||m.options.zooming||Mn.kind==="composite"||Mn.kind==="camera"?je.LINEAR:je.NEAREST);const oo=$t.glyphAtlasTexture?$t.glyphAtlasTexture.size:[0,0],ds=d.layout.get("text-size-scale-range"),yo=i.aD(m.scaleFactor,ds[0],ds[1]),Ll=i.bH(Mn,ke.zoom,yo),fc=lh(dr,$t.tileID.canonical,ut,Ze,ke,Ut.getProjection(),Cr),ma=_f(dr,$t.tileID.canonical,ut,Ze,ke,Ut.getProjection(),Cr),dl=m.translatePosMatrix(ma,$t,B,X,!0),Ws=m.translatePosMatrix(dr,$t,B,X),hl=Si?Rh:fc,Rl=Ze&&!ut&&!Di;let qa=zt;!Lt&&!ke.mercatorFromTransition||Ze||(qa=Au(ke));const pc=zf(Mn.kind,Ll,Rl,ut,m,Ws,hl,dl,Be,!0,oo,pi,!0,Ot,Ar,gt,_n,wr?qa:zt,Ut.getProjection(),fn,null,null,yo),mc=$t.glyphAtlasTexture?$t.glyphAtlasTexture:null,Dd=je.LINEAR,Hh=d.paint.get("text-halo-width").constantOr(1)!==0,Nd=m.terrain&&ut&&Di?i.bi(i.bz(),fc):Rh;if(Di&&Ut.text){const Mi=ke.elevation,Fu=Mi?Mi.getAtTileOffsetFunc(Ot,ke.center.lat,ke.worldSize,Ut.getProjection()):null,Rg=Lp(dr,$t.tileID.canonical,ut,Ze,ke,Ut.getProjection(),Cr);Wl(Ut,dr,m,!0,Rg,ma,ut,ye,Fu,Ot)}return{program:ci,buffers:Ut.text,uniformValues:pc,atlasTexture:mc,atlasTextureIcon:Vs,atlasInterpolation:Dd,atlasInterpolationIcon:Zn,isSDF:!0,hasHalo:Hh,depthMode:Qr,tile:$t,renderWithShadows:si,labelPlaneMatrixInv:Nd}},kn=Ut.icon.segments.get().length,On=Ut.text.segments.get().length,oi=kn&&!M.onlyText?Pi():null,Ss=On&&!M.onlyIcons?en():null,Hi=d.paint.get("icon-opacity").constantOr(1),os=d.paint.get("text-opacity").constantOr(1);if(At&&Ut.canOverlap){Mt=!0;const Di=Hi&&!M.onlyText?Ut.icon.segments.get():[],pn=os&&!M.onlyIcons?Ut.text.segments.get():[];for(const Si of Di)vt.push({segments:new i.bd([Si]),sortKey:Si.sortKey,state:oi});for(const Si of pn)vt.push({segments:new i.bd([Si]),sortKey:Si.sortKey,state:Ss})}else M.onlyText||vt.push({segments:Hi?Ut.icon.segments:new i.bd([]),sortKey:0,state:oi}),M.onlyIcons||vt.push({segments:os?Ut.text.segments:new i.bd([]),sortKey:0,state:Ss})}Mt&&vt.sort((Ot,$t)=>Ot.sortKey-$t.sortKey);for(const Ot of vt){const $t=Ot.state;if($t)if(m.terrain?m.terrain.setupElevationDraw($t.tile,$t.program,{useDepthForOcclusion:ke.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:$t.labelPlaneMatrixInv}):m.setupDepthForOcclusion(ke.depthOcclusionForSymbolsAndCircles,$t.program),Fe.activeTexture.set(je.TEXTURE0),$t.atlasTexture&&$t.atlasTexture.bind($t.atlasInterpolation,je.CLAMP_TO_EDGE,!0),$t.atlasTextureIcon&&(Fe.activeTexture.set(je.TEXTURE1),$t.atlasTextureIcon&&$t.atlasTextureIcon.bind($t.atlasInterpolationIcon,je.CLAMP_TO_EDGE,!0)),$t.renderWithShadows&&m.shadowRenderer.setupShadows($t.tile.tileID.toUnwrapped(),$t.program,"vector-tile",$t.tile.tileID.overscaledZ),m.uploadCommonLightUniforms(m.context,$t.program),$t.hasHalo){const Ut=$t.uniformValues;Ut.u_is_halo=1,Bf($t.buffers,Ot.segments,d,m,$t.program,$t.depthMode,S,C,Ut,2),Ut.u_is_halo=0}else{if($t.isSDF){const Ut=$t.uniformValues;$t.hasHalo&&(Ut.u_is_halo=1,Bf($t.buffers,Ot.segments,d,m,$t.program,$t.depthMode,S,C,Ut,1)),Ut.u_is_halo=0}Bf($t.buffers,Ot.segments,d,m,$t.program,$t.depthMode,S,C,$t.uniformValues,1)}}}function Bf(m,o,d,g,S,C,M,L,B,q){const X=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.iconTransitioningVertexBuffer,m.globeExtVertexBuffer,m.zOffsetVertexBuffer];S.draw(g,g.context.gl.TRIANGLES,C,M,L,Zr.disabled,B,d.id,m.layoutVertexBuffer,m.indexBuffer,o,d.paint,g.transform.zoom,m.programConfigurations.get(d.id),X,q)}function Mu(m,o){const d=1<<m.canonical.z,g=(o.x*d-m.canonical.x-m.wrap*d)*i.aj,S=(o.y*d-m.canonical.y)*i.aj,C=i.dS(o.z,o.y);return i.cS(g,S,C)}function Ad(m,o,d,g,S){if(!d.layout||d.layout.get("fill-elevation-reference")==="none")return;const C=m.context.gl,M=new Er(m.context.gl.LEQUAL,Er.ReadWrite,m.depthRangeFor3D),L=new Er(m.context.gl.GREATER,Er.ReadWrite,m.depthRangeFor3D),B=function(ne){const fe=i.cJ(ne.pitch);let de=.01;return ne.isOrthographic&&(de=i.ai(1e-4,de,i.cO(fe>=Lc?1:fe/Lc))),2*de}(m.transform),q=m.transform.getFreeCameraOptions().position,X="elevatedStructuresDepthReconstruct",ee=m.getOrCreateProgram(X,{defines:["DEPTH_RECONSTRUCTION"]}),Q=m.getOrCreateProgram(X);for(const ne of g){const fe=o.getTile(ne),de=fe.getBucket(d);if(!de)continue;const ye=de.elevatedStructures;if(!ye)continue;const he=de.elevationBufferData.heightRange,Se=Mu(ne.toUnwrapped(),q),Ae=m.translatePosMatrix(ne.projMatrix,fe,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));let Pe,Be,Fe,je;if(S==="initialize"){if(!he||he.min>=1||ye.depthSegments.segments[0].primitiveLength===0)continue;Pe=Jo(Ae,Se,B,1,0),Be=M,Fe=ye.depthSegments,je=ee}else if(S==="reset"){if(!he||he.min>=0||ye.maskSegments.segments[0].primitiveLength===0)continue;Pe=Jo(Ae,Se,0,0,1),Be=L,Fe=ye.maskSegments,je=ee}else if(S==="geometry"){if(ye.depthSegments.segments[0].primitiveLength===0)continue;Pe=Jo(Ae,Se,B,1,0),Be=M,Fe=ye.depthSegments,je=Q}je.draw(m,C.TRIANGLES,Be,qr.disabled,gn.disabled,Zr.disabled,Pe,d.id,ye.vertexBuffer,ye.indexBuffer,Fe,d.paint,m.transform.zoom)}}function yr(m,o,d){const{painter:g,sourceCache:S,layer:C,coords:M,colorMode:L,elevationType:B,terrainEnabled:q,pass:X}=m,ee=g.context.gl,Q=C.paint.get("fill-pattern"),ne=C.paint.get("fill-pattern-cross-fade"),fe=Q.constantOr(null);let de=B;B!=="road"||o&&!q||(de="none");const ye=de==="road",he=m.painter.shadowRenderer,Se=ye&&!!he&&he.enabled,Ae=new Er(g.context.gl.LEQUAL,Er.ReadOnly,g.depthRangeFor3D);let Pe=[0,0,0];if(Se){const je=g.style.directionalLight,ke=g.style.ambientLight;je&&ke&&(Pe=tl(g.style,je,ke))}const Be=Q&&Q.constantOr(1),Fe=(je,ke)=>{let qe,Ze,yt,ut,At;ke?(qe=Be&&!C.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",yt=ee.LINES):(qe=Be?"fillPattern":"fill",yt=ee.TRIANGLES);for(const Mt of M){const Zt=S.getTile(Mt);if(Be&&!Zt.patternsLoaded())continue;const at=Zt.getBucket(C);if(!at)continue;const gt=o?at.elevationBufferData:at.bufferData;if(gt.isEmpty())continue;g.prepareDrawTile();const ot=gt.programConfigurations.get(C.id),Lt=g.isTileAffectedByFog(Mt),vt=[],zt=[];ye&&(vt.push("ELEVATED_ROADS"),zt.push(gt.elevatedLayoutVertexBuffer)),Se&&vt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Be&&(g.context.activeTexture.set(ee.TEXTURE0),Zt.imageAtlasTexture&&Zt.imageAtlasTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),ot.updatePaintBuffers());let Ot=!1;if(fe&&Zt.imageAtlas){const dr=Zt.imageAtlas,Cr=i.dN.from(fe),vr=Cr.getPrimary().scaleSelf(i.q.devicePixelRatio).toString(),jr=Cr.getSecondary(),Qr=dr.patternPositions.get(vr),_n=jr?dr.patternPositions.get(jr.scaleSelf(i.q.devicePixelRatio).toString()):null;Ot=!!Qr&&!!_n,Qr&&ot.setConstantPatternPositions(Qr,_n)}ne>0&&(Ot||ot.getPatternTransitionVertexBuffer("fill-pattern"))&&vt.push("FILL_PATTERN_TRANSITION");const $t=g.getOrCreateProgram(qe,{config:ot,overrideFog:Lt,defines:vt}),Ut=g.translatePosMatrix(Mt.projMatrix,Zt,C.paint.get("fill-translate"),C.paint.get("fill-translate-anchor"));Se&&he.setupShadows(Zt.tileID.toUnwrapped(),$t,"vector-tile",Zt.tileID.overscaledZ);const wr=C.paint.get("fill-emissive-strength");if(ke){ut=gt.lineIndexBuffer,At=gt.lineSegments;const dr=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[ee.drawingBufferWidth,ee.drawingBufferHeight];Ze=qe==="fillOutlinePattern"&&Be?Up(Ut,wr,g,Zt,dr,Pe,ne):Ih(Ut,wr,dr,Pe)}else ut=gt.indexBuffer,At=gt.triangleSegments,Ze=Be?wd(Ut,wr,g,Zt,Pe,ne):Uc(Ut,wr,Pe);g.uploadCommonUniforms(g.context,$t,Mt.toUnwrapped());let Ar=je;(B==="road"&&!q||B==="offset")&&(Ar=Ae),$t.draw(g,yt,Ar,d||g.stencilModeForClipping(Mt),L,Zr.disabled,Ze,C.id,gt.layoutVertexBuffer,ut,At,C.paint,g.transform.zoom,ot,zt)}};g.renderPass===X&&Fe(g.depthModeForSublayer(1,g.renderPass==="opaque"?Er.ReadWrite:Er.ReadOnly),!1),de==="none"&&g.renderPass==="translucent"&&C.paint.get("fill-antialias")&&Fe(g.depthModeForSublayer(C.getPaintProperty("fill-outline-color")?2:0,Er.ReadOnly),!0)}function Qo(m,o,d,g,S,C,M,L){d.resetLayerRenderingStats(m);const B=m.context,q=B.gl,X=m.transform,ee=d.paint.get("fill-extrusion-pattern"),Q=d.paint.get("fill-extrusion-pattern-cross-fade"),ne=ee.constantOr(null),fe=ee.constantOr(1),de=d.paint.get("fill-extrusion-opacity"),ye=m.style.enable3dLights(),he=d.paint.get(ye&&!fe?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Se=[d.paint.get("fill-extrusion-ambient-occlusion-intensity"),he],Ae=d.layout.get("fill-extrusion-edge-radius"),Pe=Ae>0&&!d.paint.get("fill-extrusion-rounded-roof"),Be=Pe?0:Ae,Fe=X.projection.name==="globe"?i.dT():0,je=X.projection.name==="globe",ke=je?i.ah(X.zoom):0,qe=[i.ay(X.center.lng),i.aH(X.center.lat)],Ze=d.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",yt=d.paint.get("fill-extrusion-flood-light-color").toRenderColor(Ze?null:d.lut).toArray01().slice(0,3),ut=d.paint.get("fill-extrusion-flood-light-intensity"),At=d.paint.get("fill-extrusion-vertical-scale"),Mt=d.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Zt=d.paint.get("fill-extrusion-height-alignment"),at=d.paint.get("fill-extrusion-base-alignment"),gt=El(m,d.paint.get("fill-extrusion-cutoff-fade-range")),ot=[];let Lt;je&&ot.push("PROJECTION_GLOBE_VIEW"),Se[0]>0&&ot.push("FAUX_AO"),Pe&&ot.push("ZERO_ROOF_RADIUS"),L&&ot.push("HAS_CENTROID"),ut>0&&ot.push("FLOOD_LIGHT"),gt.shouldRenderCutoff&&ot.push("RENDER_CUTOFF"),Mt&&ot.push("RENDER_WALL_MODE");const vt=m.renderPass==="shadow",zt=m.shadowRenderer,Ot=vt&&!!zt,$t=vt?Zr.disabled:Zr.backCCW;m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0);let Ut=[0,0,0];if(zt){const dr=m.style.directionalLight,Cr=m.style.ambientLight;dr&&Cr&&(Ut=tl(m.style,dr,Cr)),vt||(ot.push("RENDER_SHADOWS","DEPTH_TEXTURE"),zt.useNormalOffset&&ot.push("NORMAL_OFFSET")),Lt=ot.concat(["SHADOWS_SINGLE_CASCADE"])}const wr=Ot?"fillExtrusionDepth":fe?"fillExtrusionPattern":"fillExtrusion",Ar=d.getLayerRenderingStats();for(const dr of g){const Cr=o.getTile(dr),vr=Cr.getBucket(d);if(!vr||vr.projection.name!==X.projection.name)continue;let jr=!1;zt&&(jr=zt.getMaxCascadeForTile(dr.toUnwrapped())===0);const Qr=m.isTileAffectedByFog(dr),_n=vr.programConfigurations.get(d.id);let ii=!1;if(ne&&Cr.imageAtlas){const On=Cr.imageAtlas,oi=i.dN.from(ne),Ss=oi.getPrimary().scaleSelf(i.q.devicePixelRatio).toString(),Hi=oi.getSecondary(),os=On.patternPositions.get(Ss),Di=Hi?On.patternPositions.get(Hi.scaleSelf(i.q.devicePixelRatio).toString()):null;ii=!!os&&!!Di,os&&_n.setConstantPatternPositions(os,Di)}Q>0&&(ii||_n.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&ot.push("FILL_EXTRUSION_PATTERN_TRANSITION");const si=m.getOrCreateProgram(wr,{config:_n,defines:jr?Lt:ot,overrideFog:Qr});if(m.terrain&&m.terrain.setupElevationDraw(Cr,si,{useMeterToDem:!0}),!vr.centroidVertexBuffer){const On=si.attributes.a_centroid_pos;On!==void 0&&q.vertexAttrib2f(On,0,0)}!vt&&zt&&zt.setupShadows(Cr.tileID.toUnwrapped(),si,"vector-tile",Cr.tileID.overscaledZ),fe&&(m.context.activeTexture.set(q.TEXTURE0),Cr.imageAtlasTexture&&Cr.imageAtlasTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),_n.updatePaintBuffers());const fn=d.paint.get("fill-extrusion-vertical-gradient"),Gi=1/vr.tileToMeter;let Pi;if(vt&&zt){if(wg(Cr.tileID,vr,m))continue;const On=zt.calculateShadowPassMatrixFromTile(Cr.tileID.toUnwrapped());Pi=qy(On,Be,Gi,At,Zt,at)}else{const On=m.translatePosMatrix(dr.expandedProjMatrix,Cr,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),oi=X.projection.createInversionMatrix(X,dr.canonical);Pi=fe?Y_(On,m,fn,de,Se,Be,Gi,dr,Cr,Fe,Zt,at,ke,qe,oi,yt,At,Q):Vc(On,m,fn,de,Se,Be,Gi,dr,Fe,Zt,at,ke,qe,oi,yt,At,ut,Ut)}m.uploadCommonUniforms(B,si,dr.toUnwrapped(),null,gt);let en=vr.segments;if(X.projection.name==="mercator"&&!vt&&(en=vr.getVisibleSegments(Cr.tileID,m.terrain,m.transform.getFrustum(0)),!en.get().length))continue;if(Ar)if(vt)for(const On of en.get())Ar.numRenderedVerticesInShadowPass+=On.primitiveLength;else for(const On of en.get())Ar.numRenderedVerticesInTransparentPass+=On.primitiveLength;const kn=[];(m.terrain||L)&&kn.push(vr.centroidVertexBuffer),je&&kn.push(vr.layoutVertexExtBuffer),Mt&&kn.push(vr.wallVertexBuffer),si.draw(m,B.gl.TRIANGLES,S,C,M,$t,Pi,d.id,vr.layoutVertexBuffer,vr.indexBuffer,en,d.paint,m.transform.zoom,_n,kn)}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1)}function Ba(m,o,d,g,S,C,M,L,B,q,X,ee,Q,ne,fe,de,ye,he,Se){const Ae=m.context,Pe=Ae.gl,Be=m.transform,Fe=m.transform.zoom,je=[],ke=El(m,d.paint.get("fill-extrusion-cutoff-fade-range"));q==="clear"?(je.push("CLEAR_SUBPASS"),Se&&(je.push("CLEAR_FROM_TEXTURE"),Ae.activeTexture.set(Pe.TEXTURE0),Se.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE))):q==="sdf"&&je.push("SDF_SUBPASS"),ye&&je.push("HAS_CENTROID"),ke.shouldRenderCutoff&&je.push("RENDER_CUTOFF");const qe=d.layout.get("fill-extrusion-edge-radius"),Ze=(yt,ut,At,Mt,Zt)=>{const at=ut.programConfigurations.get(d.id),gt=m.isTileAffectedByFog(yt),ot=m.getOrCreateProgram("fillExtrusionGroundEffect",{config:at,defines:je,overrideFog:gt}),Lt=((zt,Ot,$t,Ut,wr,Ar,dr,Cr,vr,jr,Qr)=>({u_matrix:Ot,u_opacity:$t,u_ao_pass:Ut?1:0,u_meter_to_tile:wr,u_ao:Ar,u_flood_light_intensity:dr,u_flood_light_color:Cr,u_attenuation:vr,u_edge_radius:jr,u_fb:0,u_fb_size:Qr,u_dynamic_offset:1}))(0,Mt,X,B,Zt,[ee,Q*Zt],ne,fe,de,Fe>=17?0:qe*Zt,Se?Se.size[0]:0),vt=[];ye&&vt.push(ut.hiddenByLandmarkVertexBuffer),m.uploadCommonUniforms(Ae,ot,yt.toUnwrapped(),null,ke),ot.draw(m,Ae.gl.TRIANGLES,S,C,M,L,Lt,d.id,ut.vertexBuffer,ut.indexBuffer,At,d.paint,Fe,at,vt)};for(const yt of g){const ut=o.getTile(yt),At=ut.getBucket(d);if(!At||At.projection.name!==Be.projection.name||!At.groundEffect||At.groundEffect&&!At.groundEffect.hasData())continue;const Mt=At.groundEffect,Zt=1/At.tileToMeter;{const at=m.translatePosMatrix(yt.projMatrix,ut,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),gt=Mt.getDefaultSegment();Ze(yt,Mt,gt,at,Zt)}if(he)for(let at=0;at<4;at++){const gt=i.dU[at](yt),ot=o.getTile(gt);if(!ot)continue;const Lt=ot.getBucket(d);if(!Lt||Lt.projection.name!==Be.projection.name||!Lt.groundEffect||Lt.groundEffect&&!Lt.groundEffect.hasData())continue;const vt=Lt.groundEffect;let zt,Ot;at===0?(zt=[-i.aj,0,0],Ot=1):at===1?(zt=[i.aj,0,0],Ot=0):at===2?(zt=[0,-i.aj,0],Ot=3):(zt=[0,i.aj,0],Ot=2);const $t=vt.regionSegments[Ot];if(!$t)continue;const Ut=new Float32Array(16);i.bo(Ut,yt.projMatrix,zt),Ze(yt,vt,$t,m.translatePosMatrix(Ut,ut,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Zt)}}}function nc(m,o,d,g,S,C,M){g.centroidVertexArray.length===0&&g.createCentroidsBuffer();const L=C?C.findDEMTileFor(d):null;if(!(L&&L.dem||M))return;C&&L&&L.dem&&g.selfDEMTileTimestamp!==L.dem._timestamp&&(g.borderDoneWithNeighborZ=[-1,-1,-1,-1],g.selfDEMTileTimestamp=L.dem._timestamp);const B=he=>new i.P(Math.ceil((he+i.dX)*i.dY),0),q=he=>{const Se=o.getSource().minzoom,Ae=Be=>{const Fe=o.getTileByID(Be);if(Fe&&Fe.hasData())return Fe.getBucket(S)},Pe=[0,-1,1];for(const Be of Pe){if(he.overscaledZ+Be<Se)continue;const Fe=Ae(he.calculateScaledKey(he.overscaledZ+Be));if(Fe)return Fe}},X=[0,0,0],ee=(he,Se)=>(X[0]=Math.min(he.min.y,Se.min.y),X[1]=Math.max(he.max.y,Se.max.y),X[2]=i.aj-Se.min.x>he.max.x?Se.min.x-i.aj:he.max.x,X),Q=(he,Se)=>(X[0]=Math.min(he.min.x,Se.min.x),X[1]=Math.max(he.max.x,Se.max.x),X[2]=i.aj-Se.min.y>he.max.y?Se.min.y-i.aj:he.max.y,X),ne=[(he,Se)=>ee(he,Se),(he,Se)=>ee(Se,he),(he,Se)=>Q(he,Se),(he,Se)=>Q(Se,he)],fe=(he,Se,Ae,Pe,Be,Fe,je)=>{if(!C)return 0;const ke=[[Fe?Ae:he,Fe?he:Ae,0],[Fe?Ae:Se,Fe?Se:Ae,0]],qe=je<0?i.aj+je:je,Ze=[Fe?qe:(he+Se)/2,Fe?(he+Se)/2:qe,0];return Ae===0&&je<0||Ae!==0&&je>0?C.getForTilePoints(Be,[Ze],!0,Pe):ke.push(Ze),C.getForTilePoints(d,ke,!0,L),Math.max(ke[0][2],ke[1][2],Ze[2])/C.exaggeration()};for(let he=0;he<4;he++){const Se=g.borderFeatureIndices[he];if(Se.length===0)continue;const Ae=i.dU[he](d),Pe=q(Ae);if(!(Pe&&Pe instanceof i.dV))continue;const Be=C?C.findDEMTileFor(Ae):null;if(!(Be&&Be.dem||M)||(C&&Be&&Be.dem&&g.borderDEMTileTimestamp[he]!==Be.dem._timestamp&&(g.borderDoneWithNeighborZ[he]=-1,g.borderDEMTileTimestamp[he]=Be.dem._timestamp),g.borderDoneWithNeighborZ[he]===Pe.canonical.z))continue;Pe.centroidVertexArray.length===0&&Pe.createCentroidsBuffer();const Fe=(he<2?1:5)-he,je=Pe.borderDoneWithNeighborZ[Fe]!==g.canonical.z,ke=Pe.borderFeatureIndices[Fe];let qe=0;if(g.canonical.z!==Pe.canonical.z){for(const Ze of Se)g.showCentroid(g.featuresOnBorder[Ze]);if(je)for(const Ze of ke)Pe.showCentroid(Pe.featuresOnBorder[Ze]);g.borderDoneWithNeighborZ[he]=Pe.canonical.z,Pe.borderDoneWithNeighborZ[Fe]=g.canonical.z}for(const Ze of Se){const yt=g.featuresOnBorder[Ze],ut=g.centroidData[yt.centroidDataIndex],At=yt.borders[he];let Mt;for(;qe<ke.length;){Mt=Pe.featuresOnBorder[ke[qe]];const Zt=Mt.borders[Fe];if(Zt[1]>At[0]+3||Zt[0]>At[0]-3)break;Pe.showCentroid(Mt),qe++}if(Mt&&qe<ke.length){const Zt=qe;let at=0;for(;!(Mt.borders[Fe][0]>At[1]-3)&&(at++,++qe!==ke.length);)Mt=Pe.featuresOnBorder[ke[qe]];Mt=Pe.featuresOnBorder[ke[Zt]];let gt=!1;if(at>=1){const vt=Mt.borders[Fe];Math.abs(At[0]-vt[0])<3&&Math.abs(At[1]-vt[1])<3&&(at=1,gt=!0,qe=Zt+1)}else if(at===0){g.showCentroid(yt);continue}const ot=Pe.centroidData[Mt.centroidDataIndex];M&&gt&&(((de=ut).flags|(ye=ot).flags)&i.dW?(de.flags|=i.dW,ye.flags|=i.dW):(de.flags&=~i.dW,ye.flags&=~i.dW));const Lt=yt.intersectsCount()>1||Mt.intersectsCount()>1;if(at>1)qe=Zt,ut.centroidXY=ot.centroidXY=new i.P(0,0);else if(Be&&Be.dem&&!Lt){const vt=ne[he](ut,ot),zt=he%2?i.aj-1:0,Ot=fe(vt[0],Math.min(i.aj-1,vt[1]),zt,Be,Ae,he<2,vt[2]);ut.centroidXY=ot.centroidXY=B(Ot)}else Lt?ut.centroidXY=ot.centroidXY=new i.P(0,0):(ut.centroidXY=g.encodeBorderCentroid(yt),ot.centroidXY=Pe.encodeBorderCentroid(Mt));g.writeCentroidToBuffer(ut),Pe.writeCentroidToBuffer(ot)}else g.showCentroid(yt)}g.borderDoneWithNeighborZ[he]=Pe.canonical.z,Pe.borderDoneWithNeighborZ[Fe]=g.canonical.z}var de,ye;(g.needsCentroidUpdate||!g.centroidVertexBuffer&&g.centroidVertexArray.length!==0)&&g.uploadCentroid(m)}const Gc=[1,0,0],zr=[0,1,0],ic=[0,0,1];function wg(m,o,d){const g=d.transform,S=d.shadowRenderer;if(!S)return!0;const C=m.toUnwrapped(),M=g.tileSize*S._cascades[d.currentShadowCascade].scale;let L=o.maxHeight;if(g.elevation){const de=g.elevation.getMinMaxForTile(m);de&&(L+=de.max)}const B=[...S.shadowDirection];B[2]=-B[2];const q=S.computeSimplifiedTileShadowVolume(C,L,M,B);if(!q)return!1;const X=[Gc,zr,ic,B,[B[0],0,B[2]],[0,B[1],B[2]]],ee=g.projection.name==="globe",Q=g.scaleZoom(M),ne=i.cn.fromInvProjectionMatrix(g.invProjMatrix,g.worldSize,Q,!ee),fe=S.getCurrentCascadeFrustum();return ne.intersectsPrecise(q.vertices,q.planes,X)===0||fe.intersectsPrecise(q.vertices,q.planes,X)===0}function Sg(m){return[m[0]*i.dZ,m[1]*i.dZ,m[2]*i.dZ,0]}function $a(m,o,d,g,S,C,M,L,B){const q=g.getSource(),X=d.globeSharedBuffers;if(!X)return;let ee,Q,ne;if(o&&(ee=g.getTile(o)),q instanceof i.aP?(Q=q.texture,ne=i.ds(0,0,d.transform)):ee&&o&&(Q=ee.texture,ne=i.ds(o.canonical.z,o.canonical.x,d.transform)),!Q||!ne)return;m||(ne=i.cE(i.bz(),ne,[1,-1,1]));const fe=d.context,de=fe.gl,ye=S.paint.get("raster-resampling")==="nearest"?de.NEAREST:de.LINEAR,he=d.colorModeForDrapableLayerRenderPass(C),Se=M.defines;Se.push("GLOBE_POLES");const Ae=new Er(de.LEQUAL,Er.ReadWrite,d.depthRangeFor3D),Pe=Float32Array.from(d.transform.expandedFarZProjMatrix),Be=Float32Array.from(i.bh(i.dr(new i.cp(0,0,0))));d.terrain&&d.terrain.prepareDrawTile(),fe.activeTexture.set(de.TEXTURE0),Q.bind(ye,de.CLAMP_TO_EDGE),fe.activeTexture.set(de.TEXTURE1),Q.bind(ye,de.CLAMP_TO_EDGE),"useMipmap"in Q&&fe.extTextureFilterAnisotropic&&d.transform.pitch>20&&de.texParameterf(de.TEXTURE_2D,fe.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,fe.extTextureFilterAnisotropicMax);const[Fe,je,ke,qe]=o?X.getPoleBuffers(o.canonical.z,!1):X.getPoleBuffers(0,!0),Ze=S.paint.get("raster-elevation");let yt;m?(yt=Fe,d.renderDefaultNorthPole=Ze!==0):(yt=je,d.renderDefaultSouthPole=Ze!==0);const ut=Sg(M.mix),At=((Zt,at,gt,ot,Lt,vt,zt,Ot,$t,Ut,wr,Ar,dr)=>tc(Zt,at,gt,new Float32Array(16),new Float32Array(9),[0,0],ot,[0,0],[0,0,0,0],1,{opacity:1,mix:0},vt,[0,0],Ot,2,Ut,wr,Ar,1,0,dr))(Pe,Be,ne,i.ah(d.transform.zoom),0,S,0,Ze,0,ut,M.offset,M.range,C),Mt=d.getOrCreateProgram("raster",{defines:Se});d.uploadCommonUniforms(fe,Mt,null),Mt.draw(d,de.TRIANGLES,Ae,B,he,L,At,S.id,yt,ke,qe)}function Hc(m){const o=m._nearZ,d=m.projection.farthestPixelDistance(m),g=d-o,S=.2*m.height,C=o+S;return[o,d,(C-S-o)/g,(C-o)/g]}function Wp(m,o,d,g){if(m)return o instanceof nd&&m instanceof ih?o.getTextureDescriptor(m,d,!0):{texture:m.texture,mix:Sg(g.mix),offset:g.offset,buffer:0,tileSize:1}}var Eg=i.d_([{name:"a_index",type:"Int16",components:1}]);class Zp{constructor(o,d,g,S){const C={width:g[0],height:g[1],data:null},M=o.gl;this.targetColorTexture=new i.T(o,C,M.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new i.T(o,C,M.RGBA8,{useMipmap:!1}),this.context=o,this.updateParticleTexture(d,S),this.lastInvalidatedAt=0}updateParticleTexture(o,d){if(this.particleTextureDimension===d.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const g=this.context.gl,S=d.width*d.height;this.particleTexture0=new i.T(this.context,d,g.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,d,g.RGBA8,{premultiply:!1,useMipmap:!1});const C=new i.d$;C.reserve(S);for(let M=0;M<S;M++)C.emplaceBack(M);this.particleIndexBuffer=this.context.createVertexBuffer(C,Eg.members,!0),this.particleSegment=i.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=d.width}update(o){return!(this.lastInvalidatedAt<o&&(this.lastInvalidatedAt=i.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Gy(m,o,d){if(!m)return null;const g=o.getTextureDescriptor(m,d,!0);if(!g)return null;let{texture:S,mix:C,offset:M,tileSize:L,buffer:B,format:q}=g;if(!S||!q)return null;let X=!1;return q==="uint32"&&(X=!0,C[3]=0,C=qc(i.e0,C,[0,d.paint.get("raster-particle-max-speed")]),M=Nf(i.e0,M,[0,d.paint.get("raster-particle-max-speed")])),{texture:S,textureOffset:[B/(L+2*B),L/(L+2*B)],tileSize:L,scalarData:X,scale:C,offset:M,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[q]]}}function Pd(m){const o=m._nearZ,d=m.projection.farthestPixelDistance(m),g=d-o,S=.2*m.height,C=o+S;return[o,d,(C-S-o)/g,(C-o)/g]}const ol=new i.am(1,0,0,1),Md=new i.am(0,1,0,1),Id=new i.am(0,0,1,1),no=new i.am(1,0,1,1),sc=new i.am(0,1,1,1);function al(m,o,d,g,S,C,M){const L=m.context,B=m.transform,q=L.gl,X=B.projection.name==="globe",ee=X?["PROJECTION_GLOBE_VIEW"]:[];let Q=i.bw(d.projMatrix);if(X&&i.ah(B.zoom)>0){const ut=i.bg(d.canonical,B),At=i.e1(ut);Q=i.az(new Float32Array(16),B.globeMatrix,At),i.az(Q,B.projMatrix,Q)}const ne=i.bz();ne[12]+=2*S/(i.q.devicePixelRatio*B.width),ne[13]+=2*C/(i.q.devicePixelRatio*B.height),i.az(Q,ne,Q);const fe=m.getOrCreateProgram("debug",{defines:ee}),de=o.getTileByID(d.key);m.terrain&&m.terrain.setupElevationDraw(de,fe);const ye=Er.disabled,he=qr.disabled,Se=m.colorModeForRenderPass(),Ae="$debug";L.activeTexture.set(q.TEXTURE0),m.emptyTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),X?de._makeGlobeTileDebugBuffers(m.context,B):de._makeDebugTileBoundsBuffers(m.context,B.projection);const Pe=de._tileDebugBuffer||m.debugBuffer,Be=de._tileDebugIndexBuffer||m.debugIndexBuffer,Fe=de._tileDebugSegments||m.debugSegments;if(fe.draw(m,q.LINE_STRIP,ye,he,Se,Zr.disabled,Fa(Q,g),Ae,Pe,Be,Fe,null,null,null,[de._globeTileDebugBorderBuffer]),M){const ut=de.latestRawTileData,At=Math.floor((ut&&ut.byteLength||0)/1024);let Mt=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(Mt+=` => ${d.overscaledZ}`),Mt+=` ${de.state}`,Mt+=` ${At}kb`,function(Zt,at){Zt.initDebugOverlayCanvas();const gt=Zt.debugOverlayCanvas,ot=Zt.context.gl,Lt=Zt.debugOverlayCanvas.getContext("2d");Lt.clearRect(0,0,gt.width,gt.height),Lt.shadowColor="white",Lt.shadowBlur=2,Lt.lineWidth=1.5,Lt.strokeStyle="white",Lt.textBaseline="top",Lt.font="bold 36px Open Sans, sans-serif",Lt.fillText(at,5,5),Lt.strokeText(at,5,5),Zt.debugOverlayTexture.update(gt),Zt.debugOverlayTexture.bind(ot.LINEAR,ot.CLAMP_TO_EDGE)}(m,Mt)}const je=o.getTile(d).tileSize,ke=512/Math.min(je,512)*(d.overscaledZ/B.zoom)*.5,qe=de._tileDebugTextBuffer||m.debugBuffer,Ze=de._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,yt=de._tileDebugTextSegments||m.debugSegments;fe.draw(m,q.TRIANGLES,ye,he,gn.alphaBlended,Zr.disabled,Fa(Q,i.am.transparent,ke),Ae,qe,Ze,yt,null,null,null,[de._globeTileDebugTextBuffer])}function $f(m,o,d,g){us(m,0,o+d/2,m.transform.width,d,g)}function Dh(m,o,d,g){us(m,o-d/2,0,d,m.transform.height,g)}function us(m,o,d,g,S,C){const M=m.context,L=M.gl;L.enable(L.SCISSOR_TEST),L.scissor(o*i.q.devicePixelRatio,d*i.q.devicePixelRatio,g*i.q.devicePixelRatio,S*i.q.devicePixelRatio),M.clear({color:C}),L.disable(L.SCISSOR_TEST)}const Vf=i.d_([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Sa}=Vf;function ni(m,o,d,g){m.emplaceBack(o,d,g)}class Iu{constructor(o){this.vertexArray=new i.e2,this.indices=new i.a_,ni(this.vertexArray,-1,-1,1),ni(this.vertexArray,1,-1,1),ni(this.vertexArray,-1,1,1),ni(this.vertexArray,1,1,1),ni(this.vertexArray,-1,-1,-1),ni(this.vertexArray,1,-1,-1),ni(this.vertexArray,-1,1,-1),ni(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,Sa),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=i.bd.simpleSegment(0,0,36,12)}}function oc(m,o,d,g,S,C){const M=m.context.gl,L=o.paint.get("sky-atmosphere-color"),B=o.paint.get("sky-atmosphere-halo-color"),q=o.paint.get("sky-atmosphere-sun-intensity"),X=((ee,Q,ne,fe,de)=>({u_matrix_3f:ee,u_sun_direction:Q,u_sun_intensity:ne,u_color_tint_r:[fe.r,fe.g,fe.b,fe.a],u_color_tint_m:[de.r,de.g,de.b,de.a],u_luminance:5e-5}))(i.e4(i.dx(),g),S,q,L,B);M.framebufferTexture2D(M.FRAMEBUFFER,M.COLOR_ATTACHMENT0,M.TEXTURE_CUBE_MAP_POSITIVE_X+C,o.skyboxTexture,0),d.draw(m,M.TRIANGLES,Er.disabled,qr.disabled,gn.unblended,Zr.frontCW,X,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}const ku=i.d_([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ms{constructor(o){const d=new i.e5;d.emplaceBack(-1,1,1,0,0),d.emplaceBack(1,1,1,1,0),d.emplaceBack(1,-1,1,1,1),d.emplaceBack(-1,-1,1,0,1);const g=new i.a_;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=o.createVertexBuffer(d,ku.members),this.indexBuffer=o.createIndexBuffer(g),this.segments=i.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const io=i.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Eo{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Wc{constructor(o){this.colorModeAlphaBlendedWriteRGB=new gn([1,Ko,1,Ko],i.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new gn([1,0,1,0],i.am.transparent,[!1,!1,!1,!0]),this.params=new Eo,this.updateNeeded=!0,o.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),o.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),o.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),o.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(o){const d=o.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Ms(d);const g=this.params.sizeRange,S=this.params.intensityRange,C=function(X){const ee=i.ea(30),Q=[];for(let ne=0;ne<X;++ne){const fe=2*Math.PI*ee(),de=Math.acos(1-2*ee())-.5*Math.PI;Q.push(i.cS(Math.cos(de)*Math.cos(fe),Math.cos(de)*Math.sin(fe),Math.sin(de)))}return Q}(this.params.starsCount),M=i.ea(300),L=new i.e6,B=new i.a_;let q=0;for(let X=0;X<C.length;++X){const ee=i.b$([],C[X],200),Q=Math.max(0,1+.01*g*(1*M()-.5)),ne=Math.max(0,1+.01*S*(1*M()-.5));L.emplaceBack(ee[0],ee[1],ee[2],-1,-1,Q,ne),L.emplaceBack(ee[0],ee[1],ee[2],1,-1,Q,ne),L.emplaceBack(ee[0],ee[1],ee[2],1,1,Q,ne),L.emplaceBack(ee[0],ee[1],ee[2],-1,1,Q,ne),B.emplaceBack(q+0,q+1,q+2),B.emplaceBack(q+0,q+2,q+3),q+=4}this.starsVx=d.createVertexBuffer(L,io.members),this.starsIdx=d.createIndexBuffer(B),this.starsSegments=i.bd.simpleSegment(0,0,L.length,B.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(o,d){const g=o.context,S=g.gl,C=o.transform,M=new Er(S.LEQUAL,Er.ReadOnly,[0,1]),L=i.ah(C.zoom),B=o.style.getLut(d.scope),q=d.properties.get("color-use-theme")==="none",X=d.properties.get("color").toRenderColor(q?null:B).toArray01(),ee=d.properties.get("high-color-use-theme")==="none",Q=d.properties.get("high-color").toRenderColor(ee?null:B).toArray01(),ne=d.properties.get("space-color-use-theme")==="none",fe=d.properties.get("space-color").toRenderColor(ne?null:B).toArray01PremultipliedAlpha(),de=5e-4,ye=i.e7(d.properties.get("horizon-blend"),0,1,de,.25),he=i.dl(o,g,C)&&ye===de?C.worldSize/(2*Math.PI*1.025)-1:C.globeRadius,Se=o.frameCounter/1e3%1,Ae=i.ae(C.globeCenterInViewSpace),Pe=Math.sqrt(Math.pow(Ae,2)-Math.pow(he,2)),Be=Math.acos(Pe/Ae),Fe=je=>{const ke=C.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];je&&ke.push("ALPHA_PASS");const qe=o.getOrCreateProgram("globeAtmosphere",{defines:ke}),Ze=((ut,At,Mt,Zt,at,gt,ot,Lt,vt,zt,Ot,$t)=>({u_frustum_tl:ut,u_frustum_tr:At,u_frustum_br:Mt,u_frustum_bl:Zt,u_horizon:at,u_transition:gt,u_fadeout_range:ot,u_color:Lt,u_high_color:vt,u_space_color:zt,u_temporal_offset:Ot,u_horizon_angle:$t}))(C.frustumCorners.TL,C.frustumCorners.TR,C.frustumCorners.BR,C.frustumCorners.BL,C.frustumCorners.horizon,L,ye,X,Q,fe,Se,Be);o.uploadCommonUniforms(g,qe);const yt=this.atmosphereBuffer;yt&&qe.draw(o,S.TRIANGLES,M,qr.disabled,je?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Zr.backCW,Ze,je?"atmosphere_glow_alpha":"atmosphere_glow",yt.vertexBuffer,yt.indexBuffer,yt.segments)};Fe(!1),Fe(!0)}drawStars(o,d){const g=i.aD(d.properties.get("star-intensity"),0,1);if(g===0)return;const S=o.context,C=S.gl,M=o.transform,L=o.getOrCreateProgram("stars"),B=i.bY([]);i.b_(B,B,-M._pitch),i.bZ(B,B,-M.angle),i.b_(B,B,i.al(M._center.lat)),i.e8(B,B,-i.al(M._center.lng));const q=i.c3(new Float32Array(16),B),X=i.az([],M.starsProjMatrix,q),ee=i.e4([],q),Q=i.e9([],ee),ne=[0,1,0];i.dz(ne,ne,Q),i.b$(ne,ne,this.params.sizeMultiplier);const fe=[1,0,0];i.dz(fe,fe,Q),i.b$(fe,fe,this.params.sizeMultiplier);const de=(ye=ne,he=fe,Se=g,{u_matrix:Float32Array.from(X),u_up:ye,u_right:he,u_intensity_multiplier:Se});var ye,he,Se;o.uploadCommonUniforms(S,L),this.starsVx&&this.starsIdx&&L.draw(o,C.TRIANGLES,Er.disabled,qr.disabled,this.colorModeAlphaBlendedWriteRGB,Zr.disabled,de,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Ml(m,o){const d=[...m],g=o.cameraWorldSizeForFog/o.worldSize,S=i.bx([]);return i.cE(S,S,[g,g,1]),i.az(d,S,d),i.az(d,o.worldToFogMatrix,d),d}function er(m,o,d,g,S){const C=d.material,M=g.context,{baseColorTexture:L,metallicRoughnessTexture:B}=C.pbrMetallicRoughness,{normalTexture:q,occlusionTexture:X,emissionTexture:ee}=C;function Q(fe,de,ye){if(fe&&(m.push(de),M.activeTexture.set(M.gl.TEXTURE0+ye),fe.gfxTexture)){const{minFilter:he,magFilter:Se,wrapS:Ae,wrapT:Pe}=fe.sampler;fe.gfxTexture.bindExtraParam(he,Se,Ae,Pe)}}Q(L,"HAS_TEXTURE_u_baseColorTexture",Yo.BaseColor),Q(B,"HAS_TEXTURE_u_metallicRoughnessTexture",Yo.MetallicRoughness),Q(q,"HAS_TEXTURE_u_normalTexture",Yo.Normal),Q(X,"HAS_TEXTURE_u_occlusionTexture",Yo.Occlusion),Q(ee,"HAS_TEXTURE_u_emissionTexture",Yo.Emission),S&&(S.texture||(S.texture=new i.ed(g.context,S.image,[S.image.height,S.image.height,S.image.height],M.gl.RGBA8)),M.activeTexture.set(M.gl.TEXTURE0+Yo.LUT),S.texture&&S.texture.bind(M.gl.LINEAR,M.gl.CLAMP_TO_EDGE),m.push("APPLY_LUT_ON_GPU")),d.texcoordBuffer&&(m.push("HAS_ATTRIBUTE_a_uv_2f"),o.push(d.texcoordBuffer)),d.colorBuffer&&(m.push(d.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),o.push(d.colorBuffer)),d.normalBuffer&&(m.push("HAS_ATTRIBUTE_a_normal_3f"),o.push(d.normalBuffer)),d.pbrBuffer&&(m.push("HAS_ATTRIBUTE_a_pbr"),m.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),o.push(d.pbrBuffer)),C.alphaMode!=="OPAQUE"&&C.alphaMode!=="MASK"||m.push("UNPREMULT_TEXTURE_IN_SHADER"),C.defined||m.push("DIFFUSE_SHADED");const ne=g.shadowRenderer;ne&&(m.push("RENDER_SHADOWS","DEPTH_TEXTURE"),ne.useNormalOffset&&m.push("NORMAL_OFFSET"))}function br(m,o,d,g,S,C){const M=d.paint.get("model-opacity").constantOr(1),L=o.context,B=new Er(o.context.gl.LEQUAL,Er.ReadWrite,o.depthRangeFor3D),q=o.transform,X=m.mesh,ee=X.material,Q=ee.pbrMetallicRoughness,ne=o.style.fog;let fe;fe=o.transform.projection.zAxisUnit==="pixels"?[...m.nodeModelMatrix]:i.az([],g.zScaleMatrix,m.nodeModelMatrix),i.az(fe,g.negCameraPosMatrix,fe);const de=i.bi([],fe);i.ee(de,de);const ye=d.paint.get("model-color-use-theme").constantOr("default")==="none",he=d.paint.get("model-emissive-strength").constantOr(0),Se=rc(new Float32Array(m.worldViewProjection),new Float32Array(fe),new Float32Array(de),null,o,M,Q.baseColorFactor.toRenderColor(null),ee.emissiveFactor,Q.metallicFactor,Q.roughnessFactor,ee,he,d),Ae={defines:[]},Pe=[],Be=o.shadowRenderer;Be&&(Be.useNormalOffset=!1),er(Ae.defines,Pe,X,o,ye?null:d.lut);let Fe=null;if(ne){const qe=Ml(m.nodeModelMatrix,o.transform);if(Fe=new Float32Array(qe),q.projection.name!=="globe"){const Ze=X.aabb.min,yt=X.aabb.max,[ut,At]=ne.getOpacityForBounds(qe,Ze[0],Ze[1],yt[0],yt[1]);Ae.overrideFog=ut>=ar||At>=ar}}const je=El(o,d.paint.get("model-cutoff-fade-range"));je.shouldRenderCutoff&&Ae.defines.push("RENDER_CUTOFF");const ke=o.getOrCreateProgram("model",Ae);o.uploadCommonUniforms(L,ke,null,Fe,je),o.renderPass!=="shadow"&&Be&&Be.setupShadowsFromMatrix(m.nodeModelMatrix,ke),ke.draw(o,L.gl.TRIANGLES,B,S,C,X.material.doubleSided?Zr.disabled:Zr.backCCW,Se,d.id,X.vertexBuffer,X.indexBuffer,X.segments,d.paint,o.transform.zoom,void 0,Pe)}function $s(m,o,d,g,S,C,M){let L;L=m.projection.name==="globe"?i.ef(d,m):[...d],i.az(L,L,o.matrix);const B=i.az([],g,L);if(o.meshes)for(const q of o.meshes){if(q.material.alphaMode!=="BLEND"){M.push({mesh:q,depth:0,modelIndex:S,worldViewProjection:B,nodeModelMatrix:L});continue}const X=i.ad([],q.centroid,B);!m.isOrthographic&&X[2]<=0||C.push({mesh:q,depth:X[2],modelIndex:S,worldViewProjection:B,nodeModelMatrix:L})}if(o.children)for(const q of o.children)$s(m,q,d,g,S,C,M)}function qi(m,o,d,g){const S=d.shadowRenderer;if(!S)return;const C=S.getShadowPassDepthMode(),M=S.getShadowPassColorMode(),L=S.calculateShadowPassMatrixFromMatrix(o),B=bg(L);d.getOrCreateProgram("modelDepth",{defines:d._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(d,d.context.gl.TRIANGLES,C,qr.disabled,M,Zr.backCCW,B,g.id,m.vertexBuffer,m.indexBuffer,m.segments,g.paint,d.transform.zoom,void 0,void 0)}function ft(m,o,d){const g=o.updateZoomBasedPaintProperties(),S=function(C,M,L){let B,q,X,ee=C.terrain?C.terrain.exaggeration():0;if(C.terrain&&ee>0){const Q=C.terrain,ne=Q.findDEMTileFor(L);ne&&ne.dem?B=i.el.create(Q,L,ne):ee=0}if(ee===0&&(M.terrainElevationMin=0,M.terrainElevationMax=0),ee===M.validForExaggeration&&(ee===0||B&&B._demTile&&B._demTile.tileID===M.validForDEMTile.id&&B._dem._timestamp===M.validForDEMTile.timestamp))return!1;for(const Q in M.instancesPerModel){const ne=M.instancesPerModel[Q];for(let fe=0;fe<ne.instancedDataArray.length;++fe){const de=(B?ee*B.getElevationAt(0|ne.instancedDataArray.float32[16*fe],0|ne.instancedDataArray.float32[16*fe+1],!0,!0):0)+ne.instancesEvaluatedElevation[fe];ne.instancedDataArray.float32[16*fe+6]=de,q=q?Math.min(M.terrainElevationMin,de):de,X=X?Math.max(M.terrainElevationMax,de):de}}return M.terrainElevationMin=q||0,M.terrainElevationMax=X||0,M.validForExaggeration=ee,M.validForDEMTile=B&&B._demTile?{id:B._demTile.tileID,timestamp:B._dem._timestamp}:{id:void 0,timestamp:0},!0}(m,o,d);(g||S)&&(o.uploaded=!1,o.upload(m.context))}const Va={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.cV([0,0,0],[i.aj,i.aj,0])};function Ua(m,o){const d=1<<m.canonical.z,g=o.getFreeCameraOptions().position,S=o.elevation,C=m.canonical.x/d,M=(m.canonical.x+1)/d,L=m.canonical.y/d,B=(m.canonical.y+1)/d;let q=o._centerAltitude;if(S){const ne=S.getMinMaxForTile(m);ne&&ne.max>q&&(q=ne.max)}const X=i.aD(g.x,C,M)-g.x,ee=i.aD(g.y,L,B)-g.y,Q=i.c6(q,o.center.lat)-g.z;return o._zoomFromMercatorZ(Math.sqrt(X*X+ee*ee+Q*Q))}function fa(m,o,d,g,S,C,M){const L=m.context,B=m.renderPass==="shadow",q=m.shadowRenderer,X=B&&q?q.getShadowPassDepthMode():new Er(L.gl.LEQUAL,Er.ReadWrite,m.depthRangeFor3D),ee=m.isTileAffectedByFog(C);if(d.meshes)for(const Q of d.meshes){const ne=["MODEL_POSITION_ON_GPU"],fe=[];let de,ye,he;g.instancedDataArray.length>20&&ne.push("INSTANCED_ARRAYS");const Se=El(m,o.paint.get("model-cutoff-fade-range"));if(Se.shouldRenderCutoff&&ne.push("RENDER_CUTOFF"),B&&q)de=m.getOrCreateProgram("modelDepth",{defines:ne}),ye=bg(M.shadowTileMatrix,M.shadowTileMatrix,Float32Array.from(d.matrix)),he=q.getShadowPassColorMode();else{er(ne,fe,Q,m,o.paint.get("model-color-use-theme").constantOr("default")==="none"?null:o.lut),de=m.getOrCreateProgram("model",{defines:ne,overrideFog:ee});const Pe=Q.material,Be=Pe.pbrMetallicRoughness,Fe=o.paint.get("model-opacity").constantOr(1),je=o.paint.get("model-emissive-strength").constantOr(0);ye=rc(C.expandedProjMatrix,Float32Array.from(d.matrix),new Float32Array(16),null,m,Fe,Be.baseColorFactor.toRenderColor(null),Pe.emissiveFactor,Be.metallicFactor,Be.roughnessFactor,Pe,je,o,S),q&&(M.shadowUniformsInitialized?de.setShadowUniformValues(L,q.getShadowUniformValues()):(q.setupShadows(C.toUnwrapped(),de,"model-tile",C.overscaledZ),M.shadowUniformsInitialized=!0)),he=Se.shouldRenderCutoff||Fe<1||Pe.alphaMode!=="OPAQUE"?gn.alphaBlended:gn.unblended}m.uploadCommonUniforms(L,de,C.toUnwrapped(),null,Se);const Ae=Q.material.doubleSided?Zr.disabled:Zr.backCCW;if(g.instancedDataArray.length>20)fe.push(g.instancedDataBuffer),de.draw(m,L.gl.TRIANGLES,X,qr.disabled,he,Ae,ye,o.id,Q.vertexBuffer,Q.indexBuffer,Q.segments,o.paint,m.transform.zoom,void 0,fe,g.instancedDataArray.length);else{const Pe=B?"u_instance":"u_normal_matrix";for(let Be=0;Be<g.instancedDataArray.length;++Be)ye[Pe]=new Float32Array(g.instancedDataArray.arrayBuffer,64*Be,16),de.draw(m,L.gl.TRIANGLES,X,qr.disabled,he,Ae,ye,o.id,Q.vertexBuffer,Q.indexBuffer,Q.segments,o.paint,m.transform.zoom,void 0,fe)}}if(d.children)for(const Q of d.children)fa(m,o,Q,g,S,C,M)}const kd=[1,-1,1];function Xp(m,o,d,g){if(!d.modelManager)return!0;const S=d.modelManager;if(!d.shadowRenderer)return!0;const C=d.shadowRenderer,M=o.aabb;let L=!0,B=m.maxHeight;if(B===0){let X=0;for(const ee in m.instancesPerModel){const Q=S.getModel(ee,g);Q?X=Math.max(X,Math.max(Math.max(Q.aabb.max[0],Q.aabb.max[1]),Q.aabb.max[2])):L=!1}B=m.maxScale*X*1.41+m.maxVerticalOffset,L&&(m.maxHeight=B)}M.max[2]=B,M.min[2]+=m.terrainElevationMin,M.max[2]+=m.terrainElevationMax,i.ad(M.min,M.min,o.tileMatrix),i.ad(M.max,M.max,o.tileMatrix);const q=M.intersects(C.getCurrentCascadeFrustum());return d.currentShadowCascade===0&&(m.isInsideFirstShadowMapFrustum=q===2),q===0}function Kp(m,o){const d=m.uniformValues.u_cutoff_params[0],g=m.uniformValues.u_cutoff_params[1],S=m.uniformValues.u_cutoff_params[2],C=m.uniformValues.u_cutoff_params[3];return g===d||C===S?1:i.aD(((o-d)/(g-d)-S)/(C-S),0,1)}function Od(m,o,d,g){if(o.pitch<20)return 1;const S=o.getWorldToCameraMatrix();i.az(S,S,m);const C=i.ei(d.min[0],d.min[1],d.min[2],1);let M=i.aA(i.ej(),C,S),L=M,B=M;C[1]=d.max[1],M=i.aA(i.ej(),C,S),L=M[1]<L[1]?M:L,B=M[1]>B[1]?M:B,C[0]=d.max[0],M=i.aA(i.ej(),C,S),L=M[1]<L[1]?M:L,B=M[1]>B[1]?M:B,C[1]=d.min[1],M=i.aA(i.ej(),C,S),L=M[1]<L[1]?M:L,B=M[1]>B[1]?M:B;const q=i.aD(g[0],0,1),X=100*o.pixelsPerMeter*i.aD(g[1],0,1),ee=i.aD(g[2],0,1),Q=i.ek(i.ej(),L,B,q),ne=Math.tan(.5*o.fovX),fe=-Q[2]*ne;if(X===0)return Q[1]<-Math.abs(fe)?ee:1;const de=(-Math.abs(fe)-Q[1])/X,ye=(Se,Ae,Pe)=>(1-Pe)*Se+Pe*Ae,he=i.aD(ye(1,ee,de),ee,1);return ye(1,he,i.aD((o.pitch-20)/20,0,1))}class Hy{}class Wy{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(o,d,g){{const ee=this._storage.get(d.id);if(ee)return ee.lastUsedFrameIdx=o,ee.buf}const S=g.gl,C=S.getBufferParameter(S.ELEMENT_ARRAY_BUFFER,S.BUFFER_SIZE),M=new ArrayBuffer(C),L=new Int16Array(M);S.getBufferSubData(S.ELEMENT_ARRAY_BUFFER,0,new Int16Array(M));const B=new i.en;for(let ee=0;ee<C/2;ee+=3){const Q=L[ee],ne=L[ee+1],fe=L[ee+2];B.emplaceBack(Q,ne),B.emplaceBack(ne,fe),B.emplaceBack(fe,Q)}const q=g.bindVertexArrayOES.current,X=new Hy;return X.buf=new Al(g,B),X.lastUsedFrameIdx=o,this._storage.set(d.id,X),g.bindVertexArrayOES.set(q),X.buf}update(o){for(const[d,g]of this._storage)o-g.lastUsedFrameIdx>30&&(g.buf.destroy(),this._storage.delete(d))}destroy(){for(const[o,d]of this._storage)d.buf.destroy(),this._storage.delete(o)}}class Tg{constructor(o){this.occluderSize=30,this.depthOffset=-1e-4,o.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),o.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Uf=i.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Yp{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Jp{constructor(o,d){this.revealStart=11,this.revealRange=2,o.registerParameter(this,[...d,"Reveal"],"revealStart",{min:0,max:17,step:.05}),o.registerParameter(this,[...d,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Cg=i.d_([{type:"Float32",name:"a_pos_2f",components:2}]);class Ou{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(o,d){const g=o.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const M=new i.eo,L=new i.a_;M.emplaceBack(-1,-1),M.emplaceBack(1,-1),M.emplaceBack(1,1),M.emplaceBack(-1,1),L.emplaceBack(0,1,2),L.emplaceBack(0,2,3),this.vignetteVx=o.context.createVertexBuffer(M,Cg.members),this.vignetteIdx=o.context.createIndexBuffer(L)}const S=i.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){o.uploadCommonUniforms(o.context,g);const M={u_vignetteShape:(C={vignetteShape:[d.start,d.range,Math.pow(10,d.fadePower)],vignetteColor:[d.color.r,d.color.g,d.color.b,d.color.a*d.strength]}).vignetteShape,u_vignetteColor:C.vignetteColor};g.draw(o,o.context.gl.TRIANGLES,Er.disabled,qr.disabled,gn.alphaBlended,Zr.disabled,M,"vignette",this.vignetteVx,this.vignetteIdx,S)}var C}}class Nh{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(o,d){const g=o.getFreeCameraOptions().position,S=g.toAltitude(),C=g.toLngLat(),M=i.al(C.lng),L=i.al(C.lat),B=o.pixelsPerMeter/d,q=M*i.eq,X=i.eq*Math.log(Math.tan(Math.PI/4+L/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const ee=-this._offsetYPrev+X,Q=-this._elevationPrev+S;this._accumulatedOffsetX+=(-this._offsetXPrev+q)*B,this._accumulatedOffsetY+=ee*B,this._accumulatedElevation+=Q*B,this._offsetXPrev=q,this._offsetYPrev=X,this._elevationPrev=S}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function ac(m,o){return[-(m[0]-Math.floor(m[0]/o)*o),-(m[1]-Math.floor(m[1]/o)*o),-(m[2]-Math.floor(m[2]/o)*o)]}function zh(m){const o=i.ea(1323123451230),d=[];for(let g=0;g<m;++g){const S=2*o()-1,C=2*o()-1,M=2*o()-1;d.push(i.cS(S,C,M))}return d}function Zc(m,o,d,g,S){const C=i.aD((S-d)/(g-d),0,1);return(1-C)*m+C*o}class To{constructor(o){this._movement=new Nh,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Ou,this._ppmScaleFactor=o}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(o,d){const g=o.transform;this._movement.update(g,this._ppmScaleFactor);const S=g.starsProjMatrix,C=i.bY([]);i.b_(C,C,i.al(90)-g._pitch),i.bZ(C,C,-g.angle);const M=i.c3(new Float32Array(16),C),L=i.ep(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),B=i.ee([],L),q=i.az([],B,M),X=Date.now()/1e3;return this._accumulatedTimeFromStart+=(X-this._prevTime)*d,this._prevTime=X,{projectionMatrix:S,modelviewMatrix:q}}}class Zy extends To{constructor(o){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Jp(o.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(o){const d=o.context;if(!this.particlesVx){const g=zh(this.particlesCount),S=new i.er,C=new i.a_;let M=0;const L=i.ea(1323123451230);for(let B=0;B<g.length;++B){const q=g[B],X=[2*L()-1,L(),L(),L()];S.emplaceBack(q[0],q[1],q[2],-1,-1,...X),S.emplaceBack(q[0],q[1],q[2],1,-1,...X),S.emplaceBack(q[0],q[1],q[2],1,1,...X),S.emplaceBack(q[0],q[1],q[2],-1,1,...X),C.emplaceBack(M+0,M+1,M+2),C.emplaceBack(M+0,M+2,M+3),M+=4}this.particlesVx=d.createVertexBuffer(S,Uf.members),this.particlesIdx=d.createIndexBuffer(C)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.rain)return;const d=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},g=o.transform.zoom;if(d.revealStart>g)return;const S=Zc(0,1,d.revealStart,d.revealStart+d.revealRange,g);if(!this.particlesVx||!this.particlesIdx)return;const C=structuredClone(this._params);let M=[-C.direction.x,C.direction.y,-100];i.au(M,M);const L=structuredClone(this._vignetteParams);L.strength*=S,C.overrideStyleParameters||(C.intensity=o.style.rain.state.density,C.timeFactor=o.style.rain.state.intensity,C.color=structuredClone(o.style.rain.state.color),M=structuredClone(o.style.rain.state.direction),C.screenThinning.intensity=o.style.rain.state.centerThinning,C.dropletSizeX=o.style.rain.state.dropletSize[0],C.dropletSizeYScale=o.style.rain.state.dropletSize[1]/o.style.rain.state.dropletSize[0],C.distortionStrength=100*o.style.rain.state.distortionStrength,L.strength=1,L.color=structuredClone(o.style.rain.state.vignetteColor));const B=this.updateOnRender(o,C.timeFactor),q=o.context,X=q.gl,ee=o.transform;this.screenTexture&&this.screenTexture.size[0]===o.width&&this.screenTexture.size[1]===o.height||(this.screenTexture=new i.T(q,{width:o.width,height:o.height,data:null},X.RGBA8)),C.distortionStrength>0&&(q.activeTexture.set(X.TEXTURE0),this.screenTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),X.copyTexSubImage2D(X.TEXTURE_2D,0,0,0,0,0,o.width,o.height));const Q=o.getOrCreateProgram("rainParticle");o.uploadCommonUniforms(q,Q),q.activeTexture.set(X.TEXTURE0),this.screenTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE);const ne=[C.color.r,C.color.g,C.color.b,C.color.a],fe=(de,ye)=>{const he=ac(this._movement.getPosition(),de),Se=C.dropletSizeX,Ae=C.dropletSizeX*C.dropletSizeYScale,Pe=o.width/2,Be=o.height/2,Fe=Zc(0,C.screenThinning.start,0,1,C.screenThinning.intensity),je=Zc(.001,C.screenThinning.range,0,1,C.screenThinning.intensity),ke=Zc(0,C.screenThinning.particleOffset,0,1,C.screenThinning.intensity),qe=(Ze={modelview:B.modelviewMatrix,projection:B.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:he,velocityConeAperture:C.velocityConeAperture,velocity:C.velocity,boxSize:de,rainDropletSize:[Se,Ae],distortionStrength:C.distortionStrength,rainDirection:M,color:ne,screenSize:[ee.width,ee.height],thinningCenterPos:[Pe,Be],thinningShape:[Fe,je,Math.pow(10,C.screenThinning.fadePower)],thinningAffectedRatio:C.screenThinning.affectedRatio,thinningParticleOffset:ke,shapeDirectionalPower:C.shapeDirPower,shapeNormalPower:C.shapeNormalPower,mode:ye?0:1},{u_modelview:Float32Array.from(Ze.modelview),u_projection:Float32Array.from(Ze.projection),u_time:Ze.time,u_cam_pos:Ze.camPos,u_texScreen:0,u_velocityConeAperture:Ze.velocityConeAperture,u_velocity:Ze.velocity,u_boxSize:Ze.boxSize,u_rainDropletSize:Ze.rainDropletSize,u_distortionStrength:Ze.distortionStrength,u_rainDirection:Ze.rainDirection,u_color:Ze.color,u_screenSize:Ze.screenSize,u_thinningCenterPos:Ze.thinningCenterPos,u_thinningShape:Ze.thinningShape,u_thinningAffectedRatio:Ze.thinningAffectedRatio,u_thinningParticleOffset:Ze.thinningParticleOffset,u_shapeDirectionalPower:Ze.shapeDirectionalPower,u_shapeNormalPower:Ze.shapeNormalPower,u_mode:Ze.mode});var Ze;const yt=Math.round(C.intensity*this.particlesCount),ut=i.bd.simpleSegment(0,0,4*yt,2*yt);Q.draw(o,X.TRIANGLES,Er.disabled,qr.disabled,gn.alphaBlended,Zr.disabled,qe,"rain_particles",this.particlesVx,this.particlesIdx,ut)};C.distortionStrength>0&&fe(C.boxSize,!0),fe(C.boxSize,!1),this._vignette.draw(o,L)}}const Fh=i.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Ai extends To{constructor(o){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Jp(o.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(o){const d=o.context;if(!this.particlesVx){const g=zh(this.particlesCount),S=new i.es,C=new i.a_;let M=0;const L=i.ea(1323123451230);for(let B=0;B<g.length;++B){const q=g[B],X=L(),ee=L(),Q=L(),ne=[B/g.length,X,ee,Q],fe=[L(),L()];S.emplaceBack(q[0],q[1],q[2],-1,-1,...ne,...fe),S.emplaceBack(q[0],q[1],q[2],1,-1,...ne,...fe),S.emplaceBack(q[0],q[1],q[2],1,1,...ne,...fe),S.emplaceBack(q[0],q[1],q[2],-1,1,...ne,...fe),C.emplaceBack(M+0,M+1,M+2),C.emplaceBack(M+0,M+2,M+3),M+=4}this.particlesVx=d.createVertexBuffer(S,Fh.members),this.particlesIdx=d.createIndexBuffer(C)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.snow)return;const d=structuredClone(this._params);let g=[-d.direction.x,d.direction.y,-100];i.au(g,g);const S=structuredClone(this._vignetteParams),C=d.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},M=o.transform.zoom;if(C.revealStart>M)return;const L=Zc(0,1,C.revealStart,C.revealStart+C.revealRange,M);S.strength*=L,d.overrideStyleParameters||(d.intensity=o.style.snow.state.density,d.timeFactor=o.style.snow.state.intensity,d.color=structuredClone(o.style.snow.state.color),g=structuredClone(o.style.snow.state.direction),d.screenThinning.intensity=o.style.snow.state.centerThinning,d.billboardSize=2.79*o.style.snow.state.flakeSize,S.strength=1,S.color=structuredClone(o.style.snow.state.vignetteColor));const B=this.updateOnRender(o,d.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const q=o.context,X=q.gl,ee=o.transform,Q=o.getOrCreateProgram("snowParticle");o.uploadCommonUniforms(q,Q),((ne,fe,de)=>{const ye=ac(this._movement.getPosition(),ne),he=ee.width/2,Se=ee.height/2,Ae=Zc(0,de.screenThinning.start,0,1,de.screenThinning.intensity),Pe=Zc(.001,de.screenThinning.range,0,1,de.screenThinning.intensity),Be=Zc(0,de.screenThinning.particleOffset,0,1,de.screenThinning.intensity),Fe=(je={modelview:B.modelviewMatrix,projection:B.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ye,velocityConeAperture:de.velocityConeAperture,velocity:de.velocity,horizontalOscillationRadius:de.horizontalOscillationRadius,horizontalOscillationRate:de.horizontalOscillationRate,boxSize:ne,billboardSize:1*de.billboardSize,simpleShapeParameters:[de.shapeFadeStart,de.shapeFadePower],screenSize:[ee.width,ee.height],thinningCenterPos:[he,Se],thinningShape:[Ae,Pe,Math.pow(10,de.screenThinning.fadePower)],thinningAffectedRatio:de.screenThinning.affectedRatio,thinningParticleOffset:Be,color:[de.color.r,de.color.g,de.color.b,de.color.a],direction:g},{u_modelview:Float32Array.from(je.modelview),u_projection:Float32Array.from(je.projection),u_time:je.time,u_cam_pos:je.camPos,u_velocityConeAperture:je.velocityConeAperture,u_velocity:je.velocity,u_horizontalOscillationRadius:je.horizontalOscillationRadius,u_horizontalOscillationRate:je.horizontalOscillationRate,u_boxSize:je.boxSize,u_billboardSize:je.billboardSize,u_simpleShapeParameters:je.simpleShapeParameters,u_screenSize:je.screenSize,u_thinningCenterPos:je.thinningCenterPos,u_thinningShape:je.thinningShape,u_thinningAffectedRatio:je.thinningAffectedRatio,u_thinningParticleOffset:je.thinningParticleOffset,u_particleColor:je.color,u_direction:je.direction});var je;const ke=Math.round(de.intensity*this.particlesCount),qe=i.bd.simpleSegment(0,0,4*ke,2*ke);this.particlesVx&&this.particlesIdx&&Q.draw(o,X.TRIANGLES,Er.disabled,qr.disabled,gn.alphaBlended,Zr.disabled,Fe,"snow_particles",this.particlesVx,this.particlesIdx,qe)})(d.boxSize,0,d),this._vignette.draw(o,S)}}const qn={symbol:function(m,o,d,g,S){if(m.renderPass!=="translucent")return;const C=qr.disabled,M=m.colorModeForRenderPass(),L=d.layout.get("text-variable-anchor"),B=d.layout.get("text-size-scale-range"),q=i.aD(m.scaleFactor,B[0],B[1]);L&&function(Q,ne,fe,de,ye,he,Se,Ae){const Pe=ne.transform,Be=ye==="map",Fe=he==="map";for(const je of Q){const ke=de.getTile(je),qe=ke.getBucket(fe);if(!qe||!qe.text||!qe.text.segments.get().length)continue;const Ze=i.bH(qe.textSizeData,Pe.zoom,Ae),yt=ud(je,qe.getProjection(),Pe),ut=Pe.calculatePixelsToTileUnitsMatrix(ke),At=lh(yt,ke.tileID.canonical,Fe,Be,Pe,qe.getProjection(),ut),Mt=qe.hasIconTextFit()&&qe.hasIconData();Ze&&Pu(qe,Be,Fe,Se,Pe,At,je,Math.pow(2,Pe.zoom-ke.tileID.overscaledZ),Ze,Mt)}}(g,m,d,o,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),S,q);const X=d.paint.get("icon-opacity").constantOr(1)!==0,ee=d.paint.get("text-opacity").constantOr(1)!==0;d.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(X||ee)?jh(m,o,d,g,C,M):(X&&jh(m,o,d,g,C,M,{onlyIcons:!0}),ee&&jh(m,o,d,g,C,M,{onlyText:!0})),o.map.showCollisionBoxes&&(Pl(m,o,d,g,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),Pl(m,o,d,g,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(m,o,d,g){if(m.renderPass!=="translucent")return;const S=d.paint.get("circle-opacity"),C=d.paint.get("circle-stroke-width"),M=d.paint.get("circle-stroke-opacity"),L=d.layout.get("circle-sort-key").constantOr(1)!==void 0,B=d.paint.get("circle-emissive-strength");if(S.constantOr(1)===0&&(C.constantOr(1)===0||M.constantOr(1)===0))return;const q=m.context,X=q.gl,ee=m.transform,Q=m.depthModeForSublayer(0,Er.ReadOnly),ne=qr.disabled,fe=m.colorModeForDrapableLayerRenderPass(B),de=ee.projection.name==="globe",ye=[i.ay(ee.center.lng),i.aH(ee.center.lat)],he=[];for(let Ae=0;Ae<g.length;Ae++){const Pe=g[Ae],Be=o.getTile(Pe),Fe=Be.getBucket(d);if(!Fe||Fe.projection.name!==ee.projection.name)continue;const je=Fe.programConfigurations.get(d.id),ke=i.dK(d),qe=m.isTileAffectedByFog(Pe);de&&ke.push("PROJECTION_GLOBE_VIEW"),ke.push("DEPTH_D24"),m.terrain&&ee.depthOcclusionForSymbolsAndCircles&&ke.push("DEPTH_OCCLUSION");const Ze=m.getOrCreateProgram("circle",{config:je,defines:ke,overrideFog:qe}),yt=Fe.layoutVertexBuffer,ut=Fe.globeExtVertexBuffer,At=Fe.indexBuffer,Mt=ee.projection.createInversionMatrix(ee,Pe.canonical),Zt={programConfiguration:je,program:Ze,layoutVertexBuffer:yt,globeExtVertexBuffer:ut,indexBuffer:At,uniformValues:i.dL(m,Pe,Be,Mt,ye,d),tile:Be};if(L){const at=Fe.segments.get();for(const gt of at)he.push({segments:new i.bd([gt]),sortKey:gt.sortKey,state:Zt})}else he.push({segments:Fe.segments,sortKey:0,state:Zt})}L&&he.sort((Ae,Pe)=>Ae.sortKey-Pe.sortKey);const Se={useDepthForOcclusion:ee.depthOcclusionForSymbolsAndCircles};for(const Ae of he){const{programConfiguration:Pe,program:Be,layoutVertexBuffer:Fe,globeExtVertexBuffer:je,indexBuffer:ke,uniformValues:qe,tile:Ze}=Ae.state,yt=Ae.segments;m.terrain&&m.terrain.setupElevationDraw(Ze,Be,Se),m.uploadCommonUniforms(q,Be,Ze.tileID.toUnwrapped()),Be.draw(m,X.TRIANGLES,Q,ne,fe,Zr.disabled,qe,d.id,Fe,ke,yt,d.paint,ee.zoom,Pe,[je])}},heatmap:function(m,o,d,g){if(d.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const S=m.context,C=S.gl,M=qr.disabled,L=new gn([C.ONE,C.ONE,C.ONE,C.ONE],i.am.transparent,[!0,!0,!0,!0]);(function(ne,fe,de,ye){const he=ne.gl,Se=fe.width*ye,Ae=fe.height*ye;ne.activeTexture.set(he.TEXTURE1),ne.viewport.set([0,0,Se,Ae]);let Pe=de.heatmapFbo;if(!Pe||Pe&&(Pe.width!==Se||Pe.height!==Ae)){Pe&&Pe.destroy();const Be=he.createTexture();he.bindTexture(he.TEXTURE_2D,Be),he.texParameteri(he.TEXTURE_2D,he.TEXTURE_WRAP_S,he.CLAMP_TO_EDGE),he.texParameteri(he.TEXTURE_2D,he.TEXTURE_WRAP_T,he.CLAMP_TO_EDGE),he.texParameteri(he.TEXTURE_2D,he.TEXTURE_MIN_FILTER,he.LINEAR),he.texParameteri(he.TEXTURE_2D,he.TEXTURE_MAG_FILTER,he.LINEAR),Pe=de.heatmapFbo=ne.createFramebuffer(Se,Ae,!0,null),function(Fe,je,ke,qe,Ze,yt){const ut=Fe.gl;ut.texImage2D(ut.TEXTURE_2D,0,Fe.extRenderToTextureHalfFloat?ut.RGBA16F:ut.RGBA,Ze,yt,0,ut.RGBA,Fe.extRenderToTextureHalfFloat?ut.HALF_FLOAT:ut.UNSIGNED_BYTE,null),qe.colorAttachment.set(ke)}(ne,0,Be,Pe,Se,Ae)}else he.bindTexture(he.TEXTURE_2D,Pe.colorAttachment.get()),ne.bindFramebuffer.set(Pe.framebuffer)})(S,m,d,m.transform.projection.name==="globe"?.5:.25),S.clear({color:i.am.transparent});const B=m.transform,q=B.projection.name==="globe",X=q?["PROJECTION_GLOBE_VIEW"]:[],ee=q?Zr.frontCCW:Zr.disabled,Q=[i.ay(B.center.lng),i.aH(B.center.lat)];for(let ne=0;ne<g.length;ne++){const fe=g[ne];if(o.hasRenderableParent(fe))continue;const de=o.getTile(fe),ye=de.getBucket(d);if(!ye||ye.projection.name!==B.projection.name)continue;const he=m.isTileAffectedByFog(fe),Se=ye.programConfigurations.get(d.id),Ae=m.getOrCreateProgram("heatmap",{config:Se,defines:X,overrideFog:he}),{zoom:Pe}=m.transform;m.terrain&&m.terrain.setupElevationDraw(de,Ae),m.uploadCommonUniforms(S,Ae,fe.toUnwrapped());const Be=B.projection.createInversionMatrix(B,fe.canonical);Ae.draw(m,C.TRIANGLES,Er.disabled,M,L,ee,ec(m,fe,de,Be,Q,Pe,d.paint.get("heatmap-intensity")),d.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,d.paint,m.transform.zoom,Se,q?[ye.globeExtVertexBuffer]:null)}S.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(S,C){const M=S.context,L=M.gl,B=C.heatmapFbo;if(!B)return;M.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,B.colorAttachment.get()),M.activeTexture.set(L.TEXTURE1);let q=C.colorRampTexture;q||(q=C.colorRampTexture=new i.T(M,C.colorRamp,L.RGBA8)),q.bind(L.LINEAR,L.CLAMP_TO_EDGE),S.getOrCreateProgram("heatmapTexture").draw(S,L.TRIANGLES,Er.disabled,qr.disabled,S.colorModeForRenderPass(),Zr.disabled,((X,ee,Q,ne)=>({u_image:0,u_color_ramp:1,u_opacity:ee.paint.get("heatmap-opacity")}))(0,C),C.id,S.viewportBuffer,S.quadTriangleIndexBuffer,S.viewportSegments,C.paint,S.transform.zoom)}(m,d))},line:function(m,o,d,g){if(m.renderPass!=="translucent")return;const S=d.paint.get("line-opacity"),C=d.paint.get("line-width");if(S.constantOr(1)===0||C.constantOr(1)===0)return;const M=d.paint.get("line-emissive-strength"),L=d.paint.get("line-occlusion-opacity"),B=d.layout.get("line-elevation-reference"),q=d.layout.get("line-width-unit")==="meters",X=B==="sea",ee=!(!m.terrain||!m.terrain.enabled),Q=m.context,ne=Q.gl;if(d.hasElevatedBuckets&&m.transform.projection.name==="globe")return;const fe=d.layout.get("line-cross-slope"),de=fe!==void 0,ye=fe<1,he=m.colorModeForDrapableLayerRenderPass(M),Se=m.terrain&&m.terrain.renderingToTexture,Ae=Se?1:i.q.devicePixelRatio,Pe=d.paint.get("line-dasharray"),Be=Pe.constantOr(1),Fe=d.layout.get("line-cap"),je=Pe.constantOr(null),ke=Fe.constantOr(null),qe=d.paint.get("line-pattern"),Ze=qe.constantOr(1),yt=d.paint.get("line-pattern-cross-fade"),ut=qe.constantOr(null),At=d.paint.get("line-opacity").constantOr(1);let Mt=!Ze&&At!==1||m.depthOcclusion&&L>0&&L<1;const Zt=d.paint.get("line-gradient"),at=Ze?"linePattern":"line",gt=i.dM(d);let ot;if(Se&&m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(Mt=!1),L!==0&&m.depthOcclusion){const Ot=d.paint._values["line-opacity"];Ot&&Ot.value&&Ot.value.kind==="constant"?ot=Ot.value:i.w(`Occlusion opacity for layer ${d.id} is supported only when line-opacity isn't data-driven.`)}C.value.kind!=="constant"&&C.value.isLineProgressConstant===!1&&gt.push("VARIABLE_LINE_WIDTH");const Lt=(Ot,$t,Ut,wr,Ar,dr)=>{for(const Cr of Ot){const vr=o.getTile(Cr);if(Ze&&!vr.patternsLoaded())continue;const jr=vr.getBucket(d);if(!jr||jr.elevationType!=="none"&&!Ar||jr.elevationType==="none"&&Ar)continue;m.prepareDrawTile();const Qr=[...$t],_n=m.shadowRenderer,ii=jr.elevationType==="road"&&!!_n&&_n.enabled;let si=[0,0,0];if(ii){const pn=m.style.directionalLight,Si=m.style.ambientLight;pn&&Si&&(si=tl(m.style,pn,Si)),Qr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const fn=jr.programConfigurations.get(d.id);let Gi=!1;if(ut&&vr.imageAtlas){const pn=i.dN.from(ut),Si=pn.getPrimary().scaleSelf(Ae).toString(),zn=vr.imageAtlas.patternPositions.get(Si),ci=pn.getSecondary(),Zn=ci?vr.imageAtlas.patternPositions.get(ci.scaleSelf(Ae).toString()):null;Gi=!!zn&&!!Zn,zn&&fn.setConstantPatternPositions(zn,Zn)}yt>0&&(Gi||fn.getPatternTransitionVertexBuffer("line-pattern"))&&Qr.push("LINE_PATTERN_TRANSITION");const Pi=m.isTileAffectedByFog(Cr),en=m.getOrCreateProgram(at,{config:fn,defines:Qr,overrideFog:Pi,overrideRtt:!Ar&&void 0});if(!Ze&&je&&ke&&vr.lineAtlas){const pn=vr.lineAtlas.getDash(je,ke);pn&&fn.setConstantPatternPositions(pn)}ii&&_n.setupShadows(vr.tileID.toUnwrapped(),en,"vector-tile",vr.tileID.overscaledZ);let[kn,On]=d.paint.get("line-trim-offset");(ke==="round"||ke==="square")&&kn!==On&&(kn===0&&(kn-=1),On===1&&(On+=1));const oi=Se?Cr.projMatrix:null,Ss=q?1/jr.tileToMeter/i.aw(vr,1,m.transform.zoom):1,Hi=q?1/jr.tileToMeter/i.aw(vr,1,Math.floor(m.transform.zoom)):1,os=Ze?i.dO(m,vr,d,oi,Ae,Ss,Hi,[kn,On],si,yt):i.dP(m,vr,d,oi,jr.lineClipsArray.length,Ae,Ss,Hi,[kn,On],si);if(Zt){const pn=jr.gradients[d.id];let Si=pn.texture;if(d.gradientVersion!==pn.version){let zn=256;if(d.stepInterpolant){const ci=o.getSource().maxzoom,Zn=Cr.canonical.z===ci?Math.ceil(1<<m.transform.maxZoom-Cr.canonical.z):1;zn=i.aD(i.dQ(jr.maxLineLength/i.aj*1024*Zn),256,Q.maxTextureSize)}pn.gradient=i.dR({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:zn,image:pn.gradient||void 0,clips:jr.lineClipsArray}),pn.texture?pn.texture.update(pn.gradient):pn.texture=new i.T(Q,pn.gradient,ne.RGBA8),pn.version=d.gradientVersion,Si=pn.texture}Q.activeTexture.set(ne.TEXTURE1),Si.bind(d.stepInterpolant?ne.NEAREST:ne.LINEAR,ne.CLAMP_TO_EDGE)}Be&&(Q.activeTexture.set(ne.TEXTURE0),vr.lineAtlasTexture&&vr.lineAtlasTexture.bind(ne.LINEAR,ne.REPEAT),fn.updatePaintBuffers()),Ze&&(Q.activeTexture.set(ne.TEXTURE0),vr.imageAtlasTexture&&vr.imageAtlasTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),fn.updatePaintBuffers()),Ar&&!X&&m.terrain.setupElevationDraw(vr,en),m.uploadCommonUniforms(Q,en,Cr.toUnwrapped());const Di=pn=>{ot!=null&&(ot.value=At*L),en.draw(m,ne.TRIANGLES,Ut,pn,he,Zr.disabled,os,d.id,jr.layoutVertexBuffer,jr.indexBuffer,jr.segments,d.paint,m.transform.zoom,fn,[jr.layoutVertexBuffer2,jr.patternVertexBuffer,jr.zOffsetVertexBuffer]),ot!=null&&(ot.value=At)};if(Mt&&!Ar){const pn=m.stencilModeForClipping(Cr).ref;pn===0&&Se&&Q.clear({stencil:0});const Si={func:ne.EQUAL,mask:255};os.u_alpha_discard_threshold=.8,Di(new qr(Si,pn,255,ne.KEEP,ne.KEEP,ne.INVERT)),os.u_alpha_discard_threshold=0,Di(new qr(Si,pn,255,ne.KEEP,ne.KEEP,ne.KEEP))}else os.u_alpha_discard_threshold=Mt&&Ar&&dr?.8:0,Di(Ar?wr:m.stencilModeForClipping(Cr))}};let vt=m.depthModeForSublayer(0,Er.ReadOnly);const zt=new Er(m.depthOcclusion?ne.GREATER:ne.LEQUAL,Er.ReadOnly,m.depthRangeFor3D);if(d.hasNonElevatedBuckets){const Ot=!Se&&m.terrain;L!==0&&Ot?i.w(`Occlusion opacity for layer ${d.id} is supported on terrain only if the layer has line-z-offset enabled.`):Ot?i.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${d.id}.`):Lt(g,gt,vt,qr.disabled,!1,!0)}if(d.hasElevatedBuckets){B==="hd-road-markup"?ee||(vt=zt,gt.push("ELEVATED_ROADS")):(gt.push("ELEVATED"),vt=zt,de&&gt.push(ye?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),X&&gt.push("ELEVATION_REFERENCE_SEA"));const Ot=Mt?m.stencilModeFor3D():qr.disabled;m.forceTerrainMode=!0,Lt(g,gt,vt,Ot,!0,!0),Mt&&Lt(g,gt,vt,Ot,!0,!1),m.forceTerrainMode=!1}Mt&&(m.resetStencilClippingMasks(),Se&&Q.clear({stencil:0})),L===0||m.depthOcclusion||Se||m.layersWithOcclusionOpacity.push(m.currentLayer)},fill:function(m,o,d,g){const S=d.paint.get("fill-color"),C=d.paint.get("fill-opacity");if(C.constantOr(1)===0)return;const M=d.paint.get("fill-emissive-strength"),L=m.colorModeForDrapableLayerRenderPass(M),B=d.paint.get("fill-pattern"),q=m.opaquePassEnabledForLayer()&&!B.constantOr(1)&&S.constantOr(i.am.transparent).a===1&&C.constantOr(0)===1?"opaque":"translucent";let X="none";d.layout.get("fill-elevation-reference")!=="none"?X="road":d.paint.get("fill-z-offset").constantOr(1)!==0&&(X="offset");const ee=!(!m.terrain||!m.terrain.enabled),Q={painter:m,sourceCache:o,layer:d,coords:g,colorMode:L,elevationType:X,terrainEnabled:ee,pass:q};if(m.renderPass!=="shadow")if(X!=="offset"){if(yr(Q,!1),X==="road"){const ne=!ee&&m.renderPass==="translucent";ne&&Ad(m,o,d,g,"geometry"),yr(Q,!0,qr.disabled),ne&&function(fe){const{painter:de,sourceCache:ye,layer:he,coords:Se,colorMode:Ae}=fe,Pe=de.context.gl,Be=fe.painter.shadowRenderer,Fe=!!Be&&Be.enabled,je=new Er(de.context.gl.LEQUAL,Er.ReadOnly,de.depthRangeFor3D);let ke=[0,0,0];if(Fe){const qe=de.style.directionalLight,Ze=de.style.ambientLight;qe&&Ze&&(ke=tl(de.style,qe,Ze))}for(const qe of Se){const Ze=ye.getTile(qe),yt=Ze.getBucket(he);if(!yt)continue;const ut=yt.elevatedStructures;if(!ut||!ut.renderableSegments||ut.renderableSegments.segments[0].primitiveLength===0)continue;de.prepareDrawTile();const At=yt.bufferData.programConfigurations.get(he.id),Mt=de.isTileAffectedByFog(qe),Zt=[];Fe&&Zt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const at=de.getOrCreateProgram("elevatedStructures",{config:At,overrideFog:Mt,defines:Zt}),gt=de.translatePosMatrix(qe.projMatrix,Ze,he.paint.get("fill-translate"),he.paint.get("fill-translate-anchor"));Fe&&Be.setupShadows(Ze.tileID.toUnwrapped(),at,"vector-tile",Ze.tileID.overscaledZ);const ot=kh(gt,ke);de.uploadCommonUniforms(de.context,at,qe.toUnwrapped()),at.draw(de,Pe.TRIANGLES,je,qr.disabled,Ae,Zr.backCCW,ot,he.id,ut.vertexBuffer,ut.indexBuffer,ut.renderableSegments,he.paint,de.transform.zoom,At,[ut.vertexBufferNormal])}}(Q)}}else yr(Q,!1,m.stencilModeFor3D());else m.shadowRenderer&&X==="road"&&!ee&&function(ne){const{painter:fe,sourceCache:de,layer:ye,coords:he}=ne,Se=fe.context.gl,Ae=ne.painter.shadowRenderer;for(const Pe of he){const Be=de.getTile(Pe),Fe=Be.getBucket(ye);if(!Fe)continue;const je=Fe.elevatedStructures;if(!je||!je.shadowCasterSegments||je.shadowCasterSegments.segments[0].primitiveLength===0)continue;fe.prepareDrawTile();const ke=Fe.bufferData.programConfigurations.get(ye.id),qe=fe.isTileAffectedByFog(Pe),Ze=fe.getOrCreateProgram("elevatedStructuresDepth",{config:ke,overrideFog:qe}),yt=Ae.calculateShadowPassMatrixFromTile(Be.tileID.toUnwrapped());fe.uploadCommonUniforms(fe.context,Ze,Pe.toUnwrapped());const ut={u_matrix:yt,u_depth_bias:.001};Ze.draw(fe,Se.TRIANGLES,Ae.getShadowPassDepthMode(),qr.disabled,Ae.getShadowPassColorMode(),Zr.disabled,ut,ye.id,je.vertexBuffer,je.indexBuffer,je.shadowCasterSegments,ye.paint,fe.transform.zoom,ke)}}(Q)},"fill-extrusion":function(m,o,d,g){const S=d.paint.get("fill-extrusion-opacity"),C=m.context,M=C.gl,L=m.terrain,B=L&&L.renderingToTexture;if(S===0)return;const q=m.conflationActive&&m.style.isLayerClipped(d,o.getSource()),X=m.style.order.indexOf(d.fqid);if(q&&function(ee,Q,ne,fe,de){for(const ye of fe){const he=Q.getTile(ye).getBucket(ne);he&&(he.updateReplacement(ye,ee.replacementSource,de),he.uploadCentroid(ee.context))}}(m,o,d,g,X),L||q)for(const ee of g){const Q=o.getTile(ee).getBucket(d);Q&&nc(m.context,o,ee,Q,d,L,q)}if(m.renderPass==="shadow"&&m.shadowRenderer){const ee=m.shadowRenderer;if(L&&S<.65&&d._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.ab)return;const Q=ee.getShadowPassDepthMode(),ne=ee.getShadowPassColorMode();Qo(m,o,d,g,Q,qr.disabled,ne,q)}else if(m.renderPass==="translucent"){const ee=!d.paint.get("fill-extrusion-pattern").constantOr(1),Q=d.paint.get("fill-extrusion-color").constantOr(i.am.white);if(!B&&Q.a!==0){const ne=new Er(m.context.gl.LEQUAL,Er.ReadWrite,m.depthRangeFor3D);S===1&&ee?Qo(m,o,d,g,ne,qr.disabled,gn.unblended,q):(Qo(m,o,d,g,ne,qr.disabled,gn.disabled,q),Qo(m,o,d,g,ne,m.stencilModeFor3D(),m.colorModeForRenderPass(),q),m.resetStencilClippingMasks())}if(m.style.enable3dLights()&&ee&&(!L&&m.transform.projection.name!=="globe"||B)){const ne=d.paint.get("fill-extrusion-opacity"),fe=d.paint.get("fill-extrusion-ambient-occlusion-intensity"),de=d.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ye=d.paint.get("fill-extrusion-flood-light-intensity"),he=d.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Se=d.paint.get("fill-extrusion-flood-light-color").toRenderColor(he?null:d.lut).toArray01().slice(0,3),Ae=fe>0&&de>0,Pe=ye>0,Be=(je,ke,qe)=>(1-qe)*je+qe*ke,Fe=je=>{const ke=m.depthModeForSublayer(1,Er.ReadOnly,M.LEQUAL,!0),qe=d.paint.get(je?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ze=Be(.1,3,qe),yt=m._showOverdrawInspector;if(!yt){const ut=new qr({func:M.ALWAYS,mask:255},255,255,M.KEEP,M.KEEP,M.REPLACE),At=new gn([M.ONE,M.ONE,M.ONE,M.ONE],i.am.transparent,[!1,!1,!1,!0],M.MIN);Ba(m,o,d,g,ke,ut,At,Zr.disabled,je,"sdf",ne,fe,de,ye,Se,Ze,q,!1)}{const ut=yt?qr.disabled:new qr({func:M.EQUAL,mask:255},255,255,M.KEEP,M.DECR,M.DECR),At=yt?m.colorModeForRenderPass():new gn([M.ONE_MINUS_DST_ALPHA,M.DST_ALPHA,M.ONE,M.ONE],i.am.transparent,[!0,!0,!0,!0]);Ba(m,o,d,g,ke,ut,At,Zr.disabled,je,"color",ne,fe,de,ye,Se,Ze,q,!1)}};if(B){const je=(ke,qe,Ze)=>{const yt=m.depthModeForSublayer(1,Er.ReadOnly,M.LEQUAL,!1),ut=d.paint.get(ke?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),At=Be(.1,3,ut);{const Mt=new gn([M.ONE,M.ONE,M.ONE,M.ONE],i.am.transparent,[!1,!1,!1,!0]);Ba(m,o,d,g,yt,qr.disabled,Mt,Zr.disabled,ke,"clear",ne,fe,de,ye,Se,At,q,qe)}{const Mt=new qr({func:M.ALWAYS,mask:255},255,255,M.KEEP,M.KEEP,M.REPLACE),Zt=new gn([M.ONE,M.ONE,M.ONE,M.ONE],i.am.transparent,[!1,!1,!1,!0],M.MIN);Ba(m,o,d,g,yt,Mt,Zt,Zr.disabled,ke,"sdf",ne,fe,de,ye,Se,At,q,qe)}{const Mt=ke?M.ZERO:M.ONE_MINUS_DST_ALPHA,Zt=new qr({func:M.EQUAL,mask:255},255,255,M.KEEP,M.DECR,M.DECR),at=new gn([Mt,M.DST_ALPHA,M.ONE_MINUS_DST_ALPHA,M.ZERO],i.am.transparent,[!0,!0,!0,!0]);Ba(m,o,d,g,yt,Zt,at,Zr.disabled,ke,"color",ne,fe,de,ye,Se,At,q,qe)}{const Mt=new gn([M.ONE,M.ONE,M.ONE,ke?M.ZERO:M.ONE],i.am.transparent,[!1,!1,!1,!0],ke?M.FUNC_ADD:M.MAX);Ba(m,o,d,g,yt,qr.disabled,Mt,Zr.disabled,ke,"clear",ne,fe,de,ye,Se,At,q,qe,Ze)}};if(Ae||Pe){let ke;if(m.prepareDrawTile(),L){const qe=L.drapeBufferSize[0],Ze=L.drapeBufferSize[1];ke=L.framebufferCopyTexture,ke&&(!ke||ke.size[0]===qe&&ke.size[1]===Ze)||(ke&&ke.destroy(),ke=L.framebufferCopyTexture=new i.T(C,new i.r({width:qe,height:Ze}),M.RGBA8)),ke.bind(M.LINEAR,M.CLAMP_TO_EDGE),M.copyTexSubImage2D(M.TEXTURE_2D,0,0,0,0,0,qe,Ze)}Ae&&je(!0,!1,ke),Pe&&je(!1,!0,ke)}}else Ae&&Fe(!0),Pe&&Fe(!1),(Ae||Pe)&&m.resetStencilClippingMasks()}}},hillshade:function(m,o,d,g){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent"||m.style.disableElevatedTerrain)return;const S=m.context,C=m.terrain&&m.terrain.renderingToTexture,[M,L]=m.renderPass!=="translucent"||C?[{},g]:m.stencilConfigForOverlap(g);for(const B of L){const q=o.getTile(B);if(q.needsHillshadePrepare&&m.renderPass==="offscreen")hg(m,q,d);else if(m.renderPass==="translucent"){const X=m.depthModeForSublayer(0,Er.ReadOnly),ee=d.paint.get("hillshade-emissive-strength"),Q=m.colorModeForDrapableLayerRenderPass(ee),ne=C&&m.terrain?m.terrain.stencilModeForRTTOverlap(B):M[B.overscaledZ];Vy(m,B,q,d,X,ne,Q)}}S.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,o,d,g,S,C){if(m.renderPass!=="translucent"||d.paint.get("raster-opacity")===0)return;const M=m.transform.projection.name==="globe",L=d.paint.get("raster-elevation")!==0,B=L&&M;if(m.renderElevatedRasterBackface&&!B)return;const q=m.context,X=q.gl,ee=o.getSource(),Q=function(Fe,je,ke,qe){const Ze=je.paint.get("raster-color"),yt=Fe.type==="raster-array",ut=[],At=je.paint.get("raster-resampling"),Mt=je.paint.get("raster-color-mix");let Zt=je.paint.get("raster-color-range");const at=[Mt[0],Mt[1],Mt[2],0],gt=Mt[3];let ot=At==="nearest"?qe.NEAREST:qe.LINEAR;if(yt&&(ut.push("RASTER_ARRAY"),Ze||ut.push("RASTER_COLOR"),At==="linear"&&ut.push("RASTER_ARRAY_LINEAR"),ot=qe.NEAREST,!Zt&&Fe.rasterLayers)){const Lt=Fe.rasterLayers.find(({id:vt})=>vt===je.sourceLayer);Lt&&Lt.fields&&Lt.fields.range&&(Zt=Lt.fields.range)}if(Zt=Zt||[0,1],Ze){ut.push("RASTER_COLOR"),ke.activeTexture.set(qe.TEXTURE2),je.updateColorRamp(Zt);let Lt=je.colorRampTexture;Lt||(Lt=je.colorRampTexture=new i.T(ke,je.colorRamp,qe.RGBA8)),Lt.bind(qe.LINEAR,qe.CLAMP_TO_EDGE)}return{mix:at,range:Zt,offset:gt,defines:ut,resampling:ot}}(ee,d,q,X);if(ee instanceof i.aP&&!g.length&&!M)return;const ne=d.paint.get("raster-emissive-strength"),fe=m.colorModeForDrapableLayerRenderPass(ne),de=m.terrain&&m.terrain.renderingToTexture,ye=!m.options.moving,he=d.paint.get("raster-resampling")==="nearest"?X.NEAREST:X.LINEAR;if(ee instanceof i.aP&&!g.length&&(ee.onNorthPole||ee.onSouthPole)){const Fe=L?m.stencilModeFor3D():qr.disabled;return void $a(!!ee.onNorthPole,null,m,o,d,ne,Q,Zr.disabled,Fe)}if(!g.length)return;const[Se,Ae]=ee instanceof i.aP||de?[{},g]:m.stencilConfigForOverlap(g),Pe=Ae[Ae.length-1].overscaledZ;B&&Q.defines.push("PROJECTION_GLOBE_VIEW"),L&&Q.defines.push("RENDER_CUTOFF");const Be=(Fe,je,ke)=>{for(const qe of Fe){const Ze=qe.toUnwrapped(),yt=o.getTile(qe);if(de&&(!yt||!yt.hasData()))continue;q.activeTexture.set(X.TEXTURE0);const ut=Wp(yt,ee,d,Q);if(!ut||!ut.texture)continue;const{texture:At,mix:Mt,offset:Zt,tileSize:at,buffer:gt}=ut;let ot,Lt;de?(ot=Er.disabled,Lt=qe.projMatrix):L?(ot=new Er(X.LEQUAL,Er.ReadWrite,m.depthRangeFor3D),Lt=M?Float32Array.from(m.transform.expandedFarZProjMatrix):m.transform.calculateProjMatrix(Ze,ye)):(ot=m.depthModeForSublayer(qe.overscaledZ-Pe,d.paint.get("raster-opacity")===1?Er.ReadWrite:Er.ReadOnly,X.LESS),Lt=m.transform.calculateProjMatrix(Ze,ye));const vt=m.terrain&&de?m.terrain.stencilModeForRTTOverlap(qe):Se[qe.overscaledZ],zt=C?0:d.paint.get("raster-fade-duration");yt.registerFadeDuration(zt);const Ot=o.findLoadedParent(qe,0),$t=ro(yt,Ot,o,m.transform,zt);let Ut,wr;m.terrain&&m.terrain.prepareDrawTile(),q.activeTexture.set(X.TEXTURE0),At.bind(he,X.CLAMP_TO_EDGE),q.activeTexture.set(X.TEXTURE1),Ot?(Ot.texture&&Ot.texture.bind(he,X.CLAMP_TO_EDGE),Ut=Math.pow(2,Ot.tileID.overscaledZ-yt.tileID.overscaledZ),wr=[yt.tileID.canonical.x*Ut%1,yt.tileID.canonical.y*Ut%1]):At.bind(he,X.CLAMP_TO_EDGE),"useMipmap"in At&&q.extTextureFilterAnisotropic&&m.transform.pitch>20&&X.texParameterf(X.TEXTURE_2D,q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,q.extTextureFilterAnisotropicMax);const Ar=m.transform;let dr;const Cr=L?Hc(Ar):[0,0,0,0];let vr,jr,Qr,_n,ii,si=0;if(B&&ee instanceof i.aP&&ee.coordinates.length>3)vr=Float32Array.from(i.bh(i.dr(new i.cp(0,0,0)))),jr=Float32Array.from(Ar.globeMatrix),Qr=Float32Array.from(i.dm(Ar)),_n=[i.ay(Ar.center.lng),i.aH(Ar.center.lat)],dr=ee.elevatedGlobePerspectiveTransform,ii=ee.elevatedGlobeGridMatrix||new Float32Array(9);else if(B){const en=i.dn(qe.canonical);si=i.dp(en.getCenter().lat),vr=Float32Array.from(i.bh(i.dr(qe.canonical))),jr=Float32Array.from(Ar.globeMatrix),Qr=Float32Array.from(i.dm(Ar)),_n=[i.ay(Ar.center.lng),i.aH(Ar.center.lat)],dr=[0,0],ii=Float32Array.from(i.dq(qe.canonical,en,si,Ar.worldSize/Ar._pixelsPerMercatorPixel))}else dr=ee instanceof i.aP?ee.perspectiveTransform:[0,0],vr=new Float32Array(16),jr=new Float32Array(9),Qr=new Float32Array(16),_n=[0,0],ii=new Float32Array(9);const fn=tc(Lt,vr,jr,Qr,ii,wr||[0,0],i.ah(m.transform.zoom),_n,Cr,Ut||1,$t,d,dr,L?d.paint.get("raster-elevation"):0,2,Mt,Zt,Q.range,at,gt,ne),Gi=m.isTileAffectedByFog(qe),Pi=m.getOrCreateProgram("raster",{defines:Q.defines,overrideFog:Gi});if(m.uploadCommonUniforms(q,Pi,Ze),ee instanceof i.aP){const en=ee.elevatedGlobeVertexBuffer,kn=ee.elevatedGlobeIndexBuffer;if(de||!M)ee.boundsBuffer&&ee.boundsSegments&&Pi.draw(m,X.TRIANGLES,ot,qr.disabled,fe,Zr.disabled,fn,d.id,ee.boundsBuffer,m.quadTriangleIndexBuffer,ee.boundsSegments);else if(en&&kn){const On=Ar.zoom<=i.cL?ee.elevatedGlobeSegments:ee.getSegmentsForLongitude(Ar.center.lng);On&&Pi.draw(m,X.TRIANGLES,ot,qr.disabled,fe,je,fn,d.id,en,kn,On)}}else if(B){ot=new Er(X.LEQUAL,Er.ReadOnly,m.depthRangeFor3D);const en=m.globeSharedBuffers;if(en){const[kn,On,oi]=en.getGridBuffers(si,!1);Pi.draw(m,X.TRIANGLES,ot,ke||vt,m.colorModeForRenderPass(),je,fn,d.id,kn,On,oi)}}else{const{tileBoundsBuffer:en,tileBoundsIndexBuffer:kn,tileBoundsSegments:On}=m.getTileBoundsBuffers(yt);Pi.draw(m,X.TRIANGLES,ot,vt,fe,Zr.disabled,fn,d.id,en,kn,On)}}if(!(ee instanceof i.aP)&&B)for(const qe of Fe){const Ze=qe.canonical.y===(1<<qe.canonical.z)-1;qe.canonical.y===0&&$a(!0,qe,m,o,d,ne,Q,je,ke||qr.disabled),Ze&&$a(!1,qe,m,o,d,ne,Q,je===Zr.frontCW?Zr.backCW:Zr.frontCW,ke||qr.disabled)}};B?Be(Ae,m.renderElevatedRasterBackface?Zr.backCW:Zr.frontCW,m.stencilModeFor3D()):Be(Ae,Zr.disabled,void 0),m.resetStencilClippingMasks()},"raster-particle":function(m,o,d,g,S,C){m.renderPass==="offscreen"&&function(M,L,B,q){if(!q.length)return;const X=M.context,ee=X.gl,Q=L.getSource();if(!(Q instanceof nd))return;const ne=Math.ceil(Math.sqrt(B.paint.get("raster-particle-count")));let fe=B.particlePositionRGBAImage;if(!fe||fe.width!==ne){const Ae=function(Pe){const Be=Pe*Pe,Fe=new Uint8Array(4*Be),je=function(qe){return qe|=0,qe=Math.imul(2747636419^qe,2654435769),qe=Math.imul(qe^qe>>>16,2654435769),((qe=Math.imul(qe^qe>>>16,2654435769))>>>0)/4294967296},ke=1/1.1;for(let qe=0;qe<Be;qe++){const Ze=ke*(je(2*qe+0)+As),yt=ke*(je(2*qe+1)+As),ut=255*Ze%1,At=255*yt%1,Mt=ut,Zt=yt-At/255,at=At;Fe[4*qe+0]=255*(Ze-ut/255),Fe[4*qe+1]=255*Mt,Fe[4*qe+2]=255*Zt,Fe[4*qe+3]=255*at}return Fe}(ne);fe=B.particlePositionRGBAImage=new i.r({width:ne,height:ne},Ae)}let de=B.particleFramebuffer;de?de.width!==ne&&(de.destroy(),de=B.particleFramebuffer=X.createFramebuffer(ne,ne,!0,null)):de=B.particleFramebuffer=X.createFramebuffer(ne,ne,!0,null);const ye=[];for(const Ae of q){const Pe=L.getTile(Ae);if(!(Pe instanceof ih))continue;const Be=Gy(Pe,Q,B);if(!Be)continue;const Fe=[Pe.tileSize,Pe.tileSize];let je=B.tileFramebuffer;je||(je=B.tileFramebuffer=X.createFramebuffer(Fe[0],Fe[1],!0,null));let ke=Pe.rasterParticleState;ke||(ke=Pe.rasterParticleState=new Zp(X,Ae,Fe,fe));const qe=ke.update(B.lastInvalidatedAt);ke.particleTextureDimension!==ne&&ke.updateParticleTexture(Ae,fe);const Ze=ke.targetColorTexture;ke.targetColorTexture=ke.backgroundColorTexture,ke.backgroundColorTexture=Ze;const yt=ke.particleTexture0;ke.particleTexture0=ke.particleTexture1,ke.particleTexture1=yt,ye.push([Ae,Be,ke,qe])}if(ye.length===0)return;const he=i.q.now(),Se=B.previousDrawTimestamp?.001*(he-B.previousDrawTimestamp):.0167;if(B.previousDrawTimestamp=he,B.hasColorMap()){X.activeTexture.set(ee.TEXTURE0+2);let Ae=B.colorRampTexture;Ae||(Ae=B.colorRampTexture=new i.T(X,B.colorRamp,ee.RGBA8)),Ae.bind(ee.LINEAR,ee.CLAMP_TO_EDGE)}X.bindFramebuffer.set(B.tileFramebuffer.framebuffer),function(Ae,Pe,Be){const Fe=Ae.context,je=Fe.gl,ke=Pe.tileFramebuffer;Fe.activeTexture.set(je.TEXTURE0);const qe={u_texture:0,u_opacity:1.05*(yt=Pe.paint.get("raster-particle-fade-opacity-factor"))/(yt+.05)},Ze=Ae.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var yt;for(const ut of Be){const[,,At,Mt]=ut;ke.colorAttachment.set(At.targetColorTexture.texture),Fe.viewport.set([0,0,ke.width,ke.height]),Fe.clear({color:i.am.transparent}),Mt&&(At.backgroundColorTexture.bind(je.NEAREST,je.CLAMP_TO_EDGE),Ze.draw(Ae,je.TRIANGLES,Er.disabled,qr.disabled,gn.alphaBlended,Zr.disabled,qe,Pe.id,Ae.viewportBuffer,Ae.quadTriangleIndexBuffer,Ae.viewportSegments))}}(M,B,ye),function(Ae,Pe,Be,Fe){const je=Ae.context,ke=je.gl,qe=Be.tileFramebuffer,Ze=Ae.transform.projection.name==="globe",yt=Be.paint.get("raster-particle-max-speed");for(const ut of Fe){const[At,Mt,Zt]=ut;je.activeTexture.set(ke.TEXTURE0+0),Mt.texture.bind(ke.LINEAR,ke.CLAMP_TO_EDGE),qe.colorAttachment.set(Zt.targetColorTexture.texture);const at=Ae.getOrCreateProgram("rasterParticleDraw",{defines:Mt.defines,overrideFog:!1});je.activeTexture.set(ke.TEXTURE0+1);const gt=Mt.scalarData?[]:[0,1,2,3].map(vt=>i.dU[vt](At));gt.push(At);const ot=At.canonical.x,Lt=At.canonical.y;for(const vt of gt){const zt=Pe.getTile(Ze?vt.wrapped():vt);if(!zt)continue;const Ot=zt.rasterParticleState;if(!Ot)continue;const $t=vt.canonical.x+(1<<vt.canonical.z)*(vt.wrap-At.wrap),Ut=vt.canonical.y;Ot.particleTexture0.bind(ke.NEAREST,ke.CLAMP_TO_EDGE);const wr=ys(1,Ot.particleTexture0.size[0],[$t-ot,Ut-Lt],0,Mt.texture.size,2,yt,Mt.textureOffset,Mt.scale,Mt.offset);at.draw(Ae,ke.POINTS,Er.disabled,qr.disabled,gn.alphaBlended,Zr.disabled,wr,Be.id,Ot.particleIndexBuffer,void 0,Ot.particleSegment)}}}(M,L,B,ye),X.bindFramebuffer.set(B.particleFramebuffer.framebuffer),function(Ae,Pe,Be,Fe){const je=Ae.context,ke=je.gl,qe=Pe.paint.get("raster-particle-max-speed"),Ze=Fe*Pe.paint.get("raster-particle-speed-factor")*.15,yt=function(At){return Math.pow(At,6)}(.01+1*Pe.paint.get("raster-particle-reset-rate-factor")),ut=Pe.particleFramebuffer;je.viewport.set([0,0,ut.width,ut.height]);for(const At of Be){const[,Mt,Zt]=At;je.activeTexture.set(ke.TEXTURE0+0),Mt.texture.bind(ke.LINEAR,ke.CLAMP_TO_EDGE),je.activeTexture.set(ke.TEXTURE0+1);const at=Zt.particleTexture0;at.bind(ke.NEAREST,ke.CLAMP_TO_EDGE);const gt=sl(1,at.size[0],0,Mt.texture.size,qe,Ze,yt,Mt.textureOffset,Mt.scale,Mt.offset);ut.colorAttachment.set(Zt.particleTexture1.texture),je.clear({color:i.am.transparent}),Ae.getOrCreateProgram("rasterParticleUpdate",{defines:Mt.defines}).draw(Ae,ke.TRIANGLES,Er.disabled,qr.disabled,gn.unblended,Zr.disabled,gt,Pe.id,Ae.viewportBuffer,Ae.quadTriangleIndexBuffer,Ae.viewportSegments)}}(M,B,ye,Se)}(m,o,d,g),m.renderPass==="translucent"&&(function(M,L,B,q,X){const ee=M.context,Q=ee.gl,ne=L.getSource().tileSize,fe=5*(1-i.af(i.cx,i.cx+1,M.transform.zoom))*ne+B.paint.get("raster-particle-elevation"),de=!M.options.moving,ye=M.transform.projection.name==="globe";if(!q.length)return;const[he,Se]=M.stencilConfigForOverlap(q),Ae=[];ye&&Ae.push("PROJECTION_GLOBE_VIEW");const Pe=M.stencilModeFor3D();for(const Be of Se){const Fe=Be.toUnwrapped(),je=L.getTile(Be);if(!je.rasterParticleState)continue;const ke=je.rasterParticleState,qe=100;je.registerFadeDuration(qe);const Ze=L.findLoadedParent(Be,0),yt=ro(je,Ze,L,M.transform,qe);let ut,At;M.terrain&&M.terrain.prepareDrawTile(),ee.activeTexture.set(Q.TEXTURE0),ke.targetColorTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),ee.activeTexture.set(Q.TEXTURE1),Ze&&Ze.rasterParticleState?(Ze.rasterParticleState.targetColorTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),ut=Math.pow(2,Ze.tileID.overscaledZ-je.tileID.overscaledZ),At=[je.tileID.canonical.x*ut%1,je.tileID.canonical.y*ut%1]):ke.targetColorTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const Mt=ye?Float32Array.from(M.transform.expandedFarZProjMatrix):M.transform.calculateProjMatrix(Fe,de),Zt=M.transform,at=Pd(Zt),gt=i.dn(Be.canonical),ot=i.dp(gt.getCenter().lat);let Lt,vt,zt,Ot,$t;ye?(Lt=Float32Array.from(i.bh(i.dr(Be.canonical))),vt=Float32Array.from(Zt.globeMatrix),zt=Float32Array.from(i.dm(Zt)),Ot=[i.ay(Zt.center.lng),i.aH(Zt.center.lat)],$t=Float32Array.from(i.dq(Be.canonical,gt,ot,Zt.worldSize/Zt._pixelsPerMercatorPixel))):(Lt=new Float32Array(16),vt=new Float32Array(9),zt=new Float32Array(16),Ot=[0,0],$t=new Float32Array(9));const Ut=ha(Mt,Lt,vt,zt,$t,At||[0,0],i.ah(M.transform.zoom),Ot,at,ut||1,yt,fe),wr=M.isTileAffectedByFog(Be),Ar=M.getOrCreateProgram("rasterParticle",{defines:Ae,overrideFog:wr});if(M.uploadCommonUniforms(ee,Ar,Fe),ye){const dr=new Er(Q.LEQUAL,Er.ReadOnly,M.depthRangeFor3D),Cr=0,vr=M.globeSharedBuffers;if(vr){const[jr,Qr,_n]=vr.getGridBuffers(ot,Cr!==0);Ar.draw(M,Q.TRIANGLES,dr,Pe,gn.alphaBlended,M.renderElevatedRasterBackface?Zr.frontCCW:Zr.backCCW,Ut,B.id,jr,Qr,_n)}}else{const dr=M.depthModeForSublayer(0,Er.ReadOnly),Cr=he[Be.overscaledZ],{tileBoundsBuffer:vr,tileBoundsIndexBuffer:jr,tileBoundsSegments:Qr}=M.getTileBoundsBuffers(je);Ar.draw(M,Q.TRIANGLES,dr,Cr,gn.alphaBlended,Zr.disabled,Ut,B.id,vr,jr,Qr)}}M.resetStencilClippingMasks()}(m,o,d,g),m.style.map.triggerRepaint())},background:function(m,o,d,g){const S=d.paint.get("background-color"),C=d.paint.get("background-color-use-theme").constantOr("default")==="none",M=d.paint.get("background-opacity"),L=d.paint.get("background-emissive-strength"),B=d.paint.get("background-pitch-alignment")==="viewport";if(M===0)return;const q=m.context,X=q.gl,ee=m.transform,Q=ee.tileSize,ne=d.paint.get("background-pattern");let fe;if(ne!==void 0&&(ne===null||(fe=m.imageManager.getPattern(i.I.from(ne.toString()),d.scope,m.style.getLut(d.scope)),!fe)))return;const de=!ne&&S.a===1&&M===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==de)return;const ye=qr.disabled,he=m.depthModeForSublayer(0,de==="opaque"?Er.ReadWrite:Er.ReadOnly),Se=m.colorModeForDrapableLayerRenderPass(L),Ae=ne?"backgroundPattern":"background";let Pe,Be=g;if(Be||(Pe=m.getBackgroundTiles(),Be=Object.values(Pe).map(Fe=>Fe.tileID)),ne&&(q.activeTexture.set(X.TEXTURE0),m.imageManager.bind(m.context,d.scope)),B){const Fe=m.getOrCreateProgram(Ae,{overrideFog:!1,overrideRtt:!0}),je=new Float32Array(i.bx([])),ke=new i.aM(0,0,0,0,0),qe=ne?Hp(je,L,M,m,0,d.scope,fe,B,{tileID:ke,tileSize:Q}):Oh(je,L,M,S.toRenderColor(C?null:d.lut));Fe.draw(m,X.TRIANGLES,he,ye,Se,Zr.disabled,qe,d.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments)}else for(const Fe of Be){const je=m.isTileAffectedByFog(Fe),ke=m.getOrCreateProgram(Ae,{overrideFog:je}),qe=Fe.toUnwrapped(),Ze=g?Fe.projMatrix:m.transform.calculateProjMatrix(qe);m.prepareDrawTile();const yt=o?o.getTile(Fe):Pe?Pe[Fe.key]:new Ul(Fe,Q,ee.zoom,m),ut=ne?Hp(Ze,L,M,m,0,d.scope,fe,B,{tileID:Fe,tileSize:Q}):Oh(Ze,L,M,S.toRenderColor(C?null:d.lut));m.uploadCommonUniforms(q,ke,qe);const{tileBoundsBuffer:At,tileBoundsIndexBuffer:Mt,tileBoundsSegments:Zt}=m.getTileBoundsBuffers(yt);ke.draw(m,X.TRIANGLES,he,ye,Se,Zr.disabled,ut,d.id,At,Mt,Zt)}},sky:function(m,o,d){const g=m._atmosphere?i.ah(m.transform.zoom):1,S=d.paint.get("sky-opacity")*g;if(S===0)return;const C=m.context,M=d.paint.get("sky-type"),L=new Er(C.gl.LEQUAL,Er.ReadOnly,[0,1]),B=m.frameCounter/1e3%1;M==="atmosphere"?m.renderPass==="offscreen"?d.needsSkyboxCapture(m)&&(function(q,X,ee,Q){const ne=q.context,fe=ne.gl;let de=X.skyboxFbo;if(!de){de=X.skyboxFbo=ne.createFramebuffer(32,32,!0,null),X.skyboxGeometry=new Iu(ne),X.skyboxTexture=ne.gl.createTexture(),fe.bindTexture(fe.TEXTURE_CUBE_MAP,X.skyboxTexture),fe.texParameteri(fe.TEXTURE_CUBE_MAP,fe.TEXTURE_WRAP_S,fe.CLAMP_TO_EDGE),fe.texParameteri(fe.TEXTURE_CUBE_MAP,fe.TEXTURE_WRAP_T,fe.CLAMP_TO_EDGE),fe.texParameteri(fe.TEXTURE_CUBE_MAP,fe.TEXTURE_MIN_FILTER,fe.LINEAR),fe.texParameteri(fe.TEXTURE_CUBE_MAP,fe.TEXTURE_MAG_FILTER,fe.LINEAR);for(let Ae=0;Ae<6;++Ae)fe.texImage2D(fe.TEXTURE_CUBE_MAP_POSITIVE_X+Ae,0,fe.RGBA,32,32,0,fe.RGBA,fe.UNSIGNED_BYTE,null)}ne.bindFramebuffer.set(de.framebuffer),ne.viewport.set([0,0,32,32]);const ye=X.getCenter(q,!0),he=q.getOrCreateProgram("skyboxCapture"),Se=new Float64Array(16);i.bx(Se),i.e3(Se,Se,.5*-Math.PI),oc(q,X,he,Se,ye,0),i.bx(Se),i.e3(Se,Se,.5*Math.PI),oc(q,X,he,Se,ye,1),i.bx(Se),i.cG(Se,Se,.5*-Math.PI),oc(q,X,he,Se,ye,2),i.bx(Se),i.cG(Se,Se,.5*Math.PI),oc(q,X,he,Se,ye,3),i.bx(Se),oc(q,X,he,Se,ye,4),i.bx(Se),i.e3(Se,Se,Math.PI),oc(q,X,he,Se,ye,5),ne.viewport.set([0,0,q.width,q.height])}(m,d),d.markSkyboxValid(m)):m.renderPass==="sky"&&function(q,X,ee,Q,ne){const fe=q.context,de=fe.gl,ye=q.transform,he=q.getOrCreateProgram("skybox");fe.activeTexture.set(de.TEXTURE0),de.bindTexture(de.TEXTURE_CUBE_MAP,X.skyboxTexture);const Se=((Ae,Pe,Be,Fe,je)=>({u_matrix:Ae,u_sun_direction:Pe,u_cubemap:0,u_opacity:Fe,u_temporal_offset:je}))(ye.skyboxMatrix,X.getCenter(q,!1),0,Q,ne);q.uploadCommonUniforms(fe,he),he.draw(q,de.TRIANGLES,ee,qr.disabled,q.colorModeForRenderPass(),Zr.backCW,Se,"skybox",X.skyboxGeometry.vertexBuffer,X.skyboxGeometry.indexBuffer,X.skyboxGeometry.segment)}(m,d,L,S,B):M==="gradient"&&m.renderPass==="sky"&&function(q,X,ee,Q,ne){const fe=q.context,de=fe.gl,ye=q.transform,he=q.getOrCreateProgram("skyboxGradient");X.skyboxGeometry||(X.skyboxGeometry=new Iu(fe)),fe.activeTexture.set(de.TEXTURE0);let Se=X.colorRampTexture;Se||(Se=X.colorRampTexture=new i.T(fe,X.colorRamp,de.RGBA8)),Se.bind(de.LINEAR,de.CLAMP_TO_EDGE);const Ae=((Pe,Be,Fe,je,ke)=>({u_matrix:Pe,u_color_ramp:0,u_center_direction:Be,u_radius:i.al(Fe),u_opacity:je,u_temporal_offset:ke}))(ye.skyboxMatrix,X.getCenter(q,!1),X.paint.get("sky-gradient-radius"),Q,ne);q.uploadCommonUniforms(fe,he),he.draw(q,de.TRIANGLES,ee,qr.disabled,q.colorModeForRenderPass(),Zr.backCW,Ae,"skyboxGradient",X.skyboxGeometry.vertexBuffer,X.skyboxGeometry.indexBuffer,X.skyboxGeometry.segment)}(m,d,L,S,B)},debug:function(m,o,d,g,S,C){for(let M=0;M<d.length;M++)if(S){const q=new i.am(g.r*.8,g.g*.8,g.b*.8,1);al(m,o,d[M],g,-1,-1,C),al(m,o,d[M],g,-1,1,C),al(m,o,d[M],g,1,1,C),al(m,o,d[M],g,1,-1,C),al(m,o,d[M],q,0,0,C)}else al(m,o,d[M],g,0,0,C)},custom:function(m,o,d,g){const S=m.context,C=d.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||m.renderPass==="offscreen")&&d.isDraped(o)){if(m.renderPass==="offscreen"){const M=C.prerender;if(M){if(m.setCustomLayerDefaults(),S.setColorMode(m.colorModeForRenderPass()),m.transform.projection.name==="globe"){const L=m.transform.pointMerc;M.call(C,S.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),i.ah(m.transform.zoom),[L.x,L.y],m.transform.pixelsPerMeterRatio)}else M.call(C,S.gl,m.transform.customLayerMatrix());S.setDirty(),m.setBaseState()}}else if(m.renderPass==="translucent"){if(m.terrain&&m.terrain.renderingToTexture){const L=C.renderToTile;if(L){const B=g[0].canonical,q={x:B.x+g[0].wrap*(C.wrapTileId?0:1<<B.z),y:B.y,z:B.z};S.setDepthMode(Er.disabled),S.setStencilMode(qr.disabled),S.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),L.call(C,S.gl,q),S.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),S.setColorMode(m.colorModeForRenderPass()),S.setStencilMode(qr.disabled);const M=C.renderingMode==="3d"?new Er(m.context.gl.LEQUAL,Er.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,Er.ReadOnly);if(S.setDepthMode(M),m.transform.projection.name==="globe"){const L=m.transform.pointMerc;C.render(S.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),i.ah(m.transform.zoom),[L.x,L.y],m.transform.pixelsPerMeterRatio)}else C.render(S.gl,m.transform.customLayerMatrix());S.setDirty(),m.setBaseState(),S.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(m,o,d,g){if(m.renderPass==="opaque")return;const S=d.paint.get("model-opacity").constantOr(1);if(S===0)return;const C=d.paint.get("model-cast-shadows");if(m.renderPass==="shadow"&&(!C||m.terrain&&S<.65&&d._transitionablePaint._values["model-opacity"].value.expression instanceof i.ab))return;const M=m.shadowRenderer,L=d.paint.get("model-receive-shadows");M&&(M.useNormalOffset=!0,L||(M.enabled=!1));const B=()=>{M&&(M.useNormalOffset=!0,L||(M.enabled=!0))},q=o.getSource();if(m.renderPass==="light-beam"&&q.type!=="batched-model")return;if(q.type==="vector"||q.type==="geojson")return function(he,Se,Ae,Pe,Be){const Fe=he.transform;if(Fe.projection.name!=="mercator")return void i.w(`Drawing 3D models for ${Fe.projection.name} projection is not yet implemented`);const je=Fe.getFreeCameraOptions().position;if(!he.modelManager)return;const ke=he.modelManager;Ae.modelManager=ke;const qe=he.shadowRenderer;if(!Ae._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ze=Ae._unevaluatedLayout._values["model-id"],yt=Object.assign({},Ae.layout.get("model-id").parameters),ut=he.style.order.indexOf(Ae.fqid);for(const At of Pe){const Mt=Se.getTile(At).getBucket(Ae);if(!Mt||Mt.projection.name!==Fe.projection.name)continue;const Zt=Mt.getModelUris();Zt&&!Mt.modelsRequested&&(ke.addModelsFromBucket(Zt,Be),Mt.modelsRequested=!0);const at=Ua(At,Fe);yt.zoom=at;const gt=Ze.possiblyEvaluate(yt);if(ft(he,Mt,At),Va.shadowUniformsInitialized=!1,Va.useSingleShadowCascade=!!qe&&qe.getMaxCascadeForTile(At.toUnwrapped())===0,he.renderPass==="shadow"&&qe){if(he.currentShadowCascade===1&&Mt.isInsideFirstShadowMapFrustum)continue;const vt=Fe.calculatePosMatrix(At.toUnwrapped(),Fe.worldSize);if(Va.tileMatrix.set(vt),Va.shadowTileMatrix=Float32Array.from(qe.calculateShadowPassMatrixFromMatrix(vt)),Va.aabb.min.fill(0),Va.aabb.max[0]=Va.aabb.max[1]=i.aj,Va.aabb.max[2]=0,Xp(Mt,Va,he,Ae.scope))continue}const ot=1<<At.canonical.z,Lt=[((je.x-At.wrap)*ot-At.canonical.x)*i.aj,(je.y*ot-At.canonical.y)*i.aj,je.z*ot*i.aj];he.conflationActive&&Object.keys(Mt.instancesPerModel).length>0&&he.style.isLayerClipped(Ae,Se.getSource())&&Mt.updateReplacement(At,he.replacementSource,ut,Be)&&(Mt.uploaded=!1,Mt.upload(he.context));for(let vt in Mt.instancesPerModel){const zt=Mt.instancesPerModel[vt];zt.features.length>0&&(vt=gt.evaluate(zt.features[0].feature,{}));const Ot=ke.getModel(vt,Be);if(Ot||ke.hasURLBeenRequested(vt)||Mt.modelUris.includes(vt)||(Mt.modelUris.push(vt),Mt.modelsRequested=!1),Ot&&Ot.uploaded)for(const $t of Ot.nodes)fa(he,Ae,$t,zt,Lt,At,Va)}}}(m,o,d,g,q.type==="vector"?d.scope:""),void B();if(!q.loaded())return;if(q.type==="batched-model")return function(he,Se,Ae,Pe){Ae.resetLayerRenderingStats(he);const Be=he.context,Fe=he.transform,je=he.style.fog,ke=he.shadowRenderer;if(Fe.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${Fe.projection.name} projection is not yet implemented`);const qe=he.transform.getFreeCameraOptions().position,Ze=i.b$([],[qe.x,qe.y,qe.z],he.transform.worldSize),yt=i.eb([],Ze),ut=i.bx([]),At=i.ec(Fe.center.lat,Fe.zoom),Mt=i.bn([],[1,1,1/At]);i.bo(ut,ut,yt);const Zt=Ae.paint.get("model-opacity").constantOr(1),at=new Er(Be.gl.LEQUAL,Er.ReadWrite,he.depthRangeFor3D),gt=new Er(Be.gl.LEQUAL,Er.ReadOnly,he.depthRangeFor3D),ot=new i.cV([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Lt=he.renderPass==="shadow",vt=Lt&&ke?ke.getCurrentCascadeFrustum():Fe.getFrustum(Fe.scaleZoom(Fe.worldSize)),zt=Ae.paint.get("model-front-cutoff"),Ot=zt[2]<1,$t=El(he,Ae.paint.get("model-cutoff-fade-range")),Ut=Ae.getLayerRenderingStats();(function(wr,Ar,dr,Cr){const vr=wr.terrain?wr.terrain.exaggeration():0,jr=wr.transform.zoom;for(const Qr of Cr){const _n=Ar.getTile(Qr).getBucket(dr);_n&&(_n.setFilter(dr.filter),wr.conflationActive&&_n.updateReplacement(Qr,wr.replacementSource),_n.evaluateScale(wr,dr),wr.terrain&&vr>0&&_n.elevationUpdate(wr.terrain,vr,Qr,dr.source),_n.needsReEvaluation(wr,jr,dr)&&_n.evaluate(dr))}})(he,Se,Ae,Pe),function(){let wr,Ar,dr;Ot?(wr=Pe.length-1,Ar=-1,dr=-1):(wr=0,Ar=Pe.length,dr=1);const Cr=new Float64Array(16),vr=i.eg(),jr=new i.P(0,0);for(let Qr=wr;Qr!==Ar;Qr+=dr){const _n=Pe[Qr],ii=Se.getTile(_n).getBucket(Ae);if(!ii||!ii.uploaded)continue;let si=!1;ke&&(si=ke.getMaxCascadeForTile(_n.toUnwrapped())===0);const fn=Fe.calculatePosMatrix(_n.toUnwrapped(),Fe.worldSize),Gi=ii.modelTraits;!Lt&&Ot&&(i.bi(Cr,fn),i.ad(vr,Ze,Cr),jr.x=vr[0],jr.y=vr[1]);const Pi=[];ii.setFilter(Ae.filter);for(const en of ii.getNodesInfo()){if(en.hiddenByReplacement||!en.node.meshes)continue;const kn=en.node;let On=0;he.terrain&&kn.elevation&&(On=kn.elevation*he.terrain.exaggeration());const oi=(()=>{const pi=en.aabb;return ot.min=[...pi.min],ot.max=[...pi.max],ot.min[2]+=On,ot.max[2]+=On,i.ad(ot.min,ot.min,fn),i.ad(ot.max,ot.max,fn),ot})(),Ss=en.evaluatedScale;if(Ss[0]<=1&&Ss[1]<=1&&Ss[2]<=1&&oi.intersects(vt)===0)continue;if(!Lt&&Ot){const pi=.16666666666666666;en.cameraCollisionOpacity=Ze[0]>oi.min[0]&&Ze[0]<oi.max[0]&&Ze[1]>oi.min[1]&&Ze[1]<oi.max[1]&&Ze[2]*At<oi.max[2]&&kn.footprint&&i.bS(jr,kn.footprint)?Math.max(en.cameraCollisionOpacity-pi,0):Math.min(1,en.cameraCollisionOpacity+pi)}const Hi=[...fn],os=kn.anchor?kn.anchor[0]:0,Di=kn.anchor?kn.anchor[1]:0;i.bo(Hi,Hi,[os*(Ss[0]-1),Di*(Ss[1]-1),On]),i.ci(Ss,i.eh)||i.cE(Hi,Hi,Ss);const pn=i.az([],Hi,kn.matrix),Si=i.az([],Fe.expandedFarZProjMatrix,pn),zn=i.az([],Fe.expandedFarZProjMatrix,Hi),ci=i.aA([],[os,Di,On,1],Si)[2];kn.hidden=!1;let Zn=Zt;Lt||(Ot&&(Zn*=en.cameraCollisionOpacity,Zn*=Od(Hi,Fe,en.aabb,zt)),Zn*=Kp($t,ci)),Zn!==0?Pi.push({nodeInfo:en,depth:ci,opacity:Zn,wvpForNode:Si,wvpForTile:zn,nodeModelMatrix:pn,tileModelMatrix:Hi}):kn.hidden=!0}Lt||Pi.sort((en,kn)=>!Ot||en.opacity===1&&kn.opacity===1?en.depth<kn.depth?-1:1:en.opacity===1?-1:kn.opacity===1?1:en.depth>kn.depth?-1:1);for(const en of Pi){const kn=en.nodeInfo,On=kn.node;let oi=i.az([],Mt,en.tileModelMatrix);i.az(oi,ut,oi);const Ss=i.bi([],oi);i.ee(Ss,Ss),i.cE(Ss,Ss,kd),oi=i.az(oi,oi,On.matrix);const Hi=he.renderPass==="light-beam",os=Ae.paint.get("model-color-use-theme").constantOr("default")==="none",Di=Gi&i.em.HasMapboxMeshFeatures,pn=Di?0:kn.evaluatedRMEA[0][2];for(let Si=0;Si<On.meshes.length;++Si){const zn=On.meshes[Si],ci=Si===On.lightMeshIndex;let Zn=en.wvpForNode;if(ci){if(!Hi&&!he.terrain&&he.shadowRenderer){he.currentLayer<he.firstLightBeamLayer&&(he.firstLightBeamLayer=he.currentLayer);continue}Zn=en.wvpForTile}else if(Hi)continue;const pi={defines:[]},Vs=[];if(!Lt&&ke&&(ke.useNormalOffset=!!zn.normalBuffer),er(pi.defines,Vs,zn,he,os?null:Ae.lut),Di||pi.defines.push("DIFFUSE_SHADED"),si&&pi.defines.push("SHADOWS_SINGLE_CASCADE"),Ut&&(Lt?Ut.numRenderedVerticesInShadowPass+=zn.vertexArray.length:Ut.numRenderedVerticesInTransparentPass+=zn.vertexArray.length),Lt){qi(zn,en.nodeModelMatrix,he,Ae);continue}let Mn=null;if(je){const ma=Ml(en.nodeModelMatrix,he.transform);if(Mn=new Float32Array(ma),Fe.projection.name!=="globe"){const dl=zn.aabb.min,Ws=zn.aabb.max,[hl,Rl]=je.getOpacityForBounds(ma,dl[0],dl[1],Ws[0],Ws[1]);pi.overrideFog=hl>=ar||Rl>=ar}}const oo=zn.material;let ds;oo.occlusionTexture&&oo.occlusionTexture.offsetScale&&(ds=oo.occlusionTexture.offsetScale,pi.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const yo=he.getOrCreateProgram("model",pi);!Lt&&ke&&ke.setupShadowsFromMatrix(en.tileModelMatrix,yo,ke.useNormalOffset),he.uploadCommonUniforms(Be,yo,null,Mn);const Ll=oo.pbrMetallicRoughness;Ll.metallicFactor=.9,Ll.roughnessFactor=.5;const fc=rc(new Float32Array(Zn),new Float32Array(oi),new Float32Array(Ss),new Float32Array(On.matrix),he,en.opacity,Ll.baseColorFactor.toRenderColor(null),oo.emissiveFactor,Ll.metallicFactor,Ll.roughnessFactor,oo,pn,Ae,[0,0,0],ds);!ci&&(kn.hasTranslucentParts||en.opacity<1)&&yo.draw(he,Be.gl.TRIANGLES,at,qr.disabled,gn.disabled,Zr.backCCW,fc,Ae.id,zn.vertexBuffer,zn.indexBuffer,zn.segments,Ae.paint,he.transform.zoom,void 0,Vs),yo.draw(he,Be.gl.TRIANGLES,ci?gt:at,qr.disabled,ci||en.opacity<1||kn.hasTranslucentParts?gn.alphaBlended:gn.unblended,Zr.backCCW,fc,Ae.id,zn.vertexBuffer,zn.indexBuffer,zn.segments,Ae.paint,he.transform.zoom,void 0,Vs)}}}}()}(m,o,d,g),void B();if(q.type!=="model")return;const X=q.getModels(),ee=[],Q=m.transform.getFreeCameraOptions().position,ne=i.b$([],[Q.x,Q.y,Q.z],m.transform.worldSize);i.eb(ne,ne);const fe=[],de=[];let ye=0;for(const he of X){const Se=d.paint.get("model-rotation").constantOr(null),Ae=d.paint.get("model-scale").constantOr(null),Pe=d.paint.get("model-translation").constantOr(null);he.computeModelMatrix(m,Se,Ae,Pe,!0,!0,!1);const Be=i.bx([]),Fe=i.ec(he.position.lat,m.transform.zoom),je=i.bn([],[1,1,1/Fe]);i.bo(Be,Be,ne),ee.push({zScaleMatrix:je,negCameraPosMatrix:Be});for(const ke of he.nodes)$s(m.transform,ke,he.matrix,m.transform.expandedFarZProjMatrix,ye,fe,de);ye++}if(fe.sort((he,Se)=>Se.depth-he.depth),m.renderPass!=="shadow"){if(S===1)for(const he of de)br(he,m,d,ee[he.modelIndex],qr.disabled,m.colorModeForRenderPass());else{for(const he of de)br(he,m,d,ee[he.modelIndex],qr.disabled,gn.disabled);for(const he of de)br(he,m,d,ee[he.modelIndex],m.stencilModeFor3D(),m.colorModeForRenderPass());m.resetStencilClippingMasks()}for(const he of fe)br(he,m,d,ee[he.modelIndex],qr.disabled,m.colorModeForRenderPass());B()}else{for(const he of de)qi(he.mesh,he.nodeModelMatrix,m,d);for(const he of fe)qi(he.mesh,he.nodeModelMatrix,m,d);B()}}},qf={line:function(m,o,d){if(m.hasElevatedBuckets=!1,m.hasNonElevatedBuckets=!1,m._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||m._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(o){const g=o.getVisibleCoordinates();for(const S of g){const C=o.getTile(S).getBucket(m);if(C&&(C.elevationType!=="none"?m.hasElevatedBuckets=!0:m.hasNonElevatedBuckets=!0,m.hasElevatedBuckets&&m.hasNonElevatedBuckets))break}}}else m.hasNonElevatedBuckets=!0},model:function(m,o,d){const g=o.getSource();if(!g.loaded())return;if(g.type==="vector"||g.type==="geojson")return void(d.modelManager&&d.modelManager.upload(d,g.type==="vector"?m.scope:""));if(g.type==="batched-model"||g.type!=="model")return;const S=g.getModels();for(const C of S)C.upload(d.context)},raster:function(m,o,d){const g=o.getSource();if(!(g instanceof nd&&g.loaded()))return;const S=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!S)return;const C=m.paint.get("raster-array-band")||g.getInitialBand(S);if(C==null)return;const M=o.getIds().map(L=>o.getTileByID(L));for(const L of M)L.updateNeeded(S,C)&&g.prepareTile(L,S,C)},"raster-particle":function(m,o,d){const g=o.getSource();if(!(g instanceof nd&&g.loaded()))return;const S=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!S)return;const C=m.paint.get("raster-particle-array-band")||g.getInitialBand(S);if(C==null)return;const M=o.getIds().map(L=>o.getTileByID(L));for(const L of M)L.updateNeeded(S,C)&&g.prepareTile(L,S,C)}},lc={fill:Ad};class Gf{constructor(o,d,g,S,C){this.context=new Td(o,d),this.transform=g,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=C,this._timeStamp=i.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const M=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const B of M)this._debugParams.enabledLayers[B]=!0;C.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),C.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),C.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),C.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),C.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),C.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const B of M)C.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],B);this.occlusionParams=new Tg(C),this.setup(),this.numSublayers=ho.maxUnderzooming+ho.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.et,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new H_(this),this._wireframeDebugCache=new Wy,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const L=new i.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new i.T(this.context,L,o.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=S}updateTerrain(o,d){const g=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Do(this,o));const S=this._terrain;this.transform.elevation=g?S:null,S.update(o,this.transform,d),this.transform.elevation&&!S.enabled&&(this.transform.elevation=null)}_updateFog(o){const d=o.fog;if(!d||this.transform.projection.name==="globe"||d.getOpacity(this.transform.pitch)<1||d.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,S]=d.getFovAdjustedRange(this.transform._fov);if(g>S)return void(this.transform.fogCullDistSq=null);const C=g+.78*(S-g);this.transform.fogCullDistSq=C*C}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(o){o&&!this._terrain&&(this._terrain=new Do(this,this.style)),this._forceTerrainMode=o}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(o,d){if(this.width=o*i.q.devicePixelRatio,this.height=d*i.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._mergedLayers[g].resize()}setup(){const o=this.context,d=new i.ba;d.emplaceBack(0,0),d.emplaceBack(i.aj,0),d.emplaceBack(0,i.aj),d.emplaceBack(i.aj,i.aj),this.tileExtentBuffer=o.createVertexBuffer(d,i.bc.members),this.tileExtentSegments=i.bd.simpleSegment(0,0,4,2);const g=new i.ba;g.emplaceBack(0,0),g.emplaceBack(i.aj,0),g.emplaceBack(0,i.aj),g.emplaceBack(i.aj,i.aj),this.debugBuffer=o.createVertexBuffer(g,i.bc.members),this.debugSegments=i.bd.simpleSegment(0,0,4,5);const S=new i.ba;S.emplaceBack(-1,-1),S.emplaceBack(1,-1),S.emplaceBack(-1,1),S.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(S,i.bc.members),this.viewportSegments=i.bd.simpleSegment(0,0,4,2);const C=new i.aZ;C.emplaceBack(0,0,0,0),C.emplaceBack(i.aj,0,i.aj,0),C.emplaceBack(0,i.aj,0,i.aj),C.emplaceBack(i.aj,i.aj,i.aj,i.aj),this.mercatorBoundsBuffer=o.createVertexBuffer(C,i.bf.members),this.mercatorBoundsSegments=i.bd.simpleSegment(0,0,4,2);const M=new i.a_;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(M);const L=new i.bb;for(const q of[0,1,3,2,0])L.emplaceBack(q);this.debugIndexBuffer=o.createIndexBuffer(L),this.emptyTexture=new i.T(o,new i.r({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA8),this.identityMat=i.bz();const B=this.context.gl;this.stencilClearMode=new qr({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,o.TRIANGLES,Er.disabled,this.stencilClearMode,gn.disabled,Zr.disabled,Bs(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,d,g){if(!d||this.currentStencilSource===d.id||!o.isTileClipped()||!g||g.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let L=!1;for(const B of g)if(this._tileClippingMaskIDs[B.key]===void 0){L=!0;break}if(!L)return}this.currentStencilSource=d.id;const S=this.context,C=S.gl;this.nextStencilID+g.length>256&&this.clearStencil(),S.setColorMode(gn.disabled),S.setDepthMode(Er.disabled);const M=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const L of g){const B=d.getTile(L),q=this._tileClippingMaskIDs[L.key]=this.nextStencilID++,{tileBoundsBuffer:X,tileBoundsIndexBuffer:ee,tileBoundsSegments:Q}=this.getTileBoundsBuffers(B);M.draw(this,C.TRIANGLES,Er.disabled,new qr({func:C.ALWAYS,mask:0},q,255,C.KEEP,C.KEEP,C.REPLACE),gn.disabled,Zr.disabled,Bs(L.projMatrix),"$clipping",X,ee,Q)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,d=this.context.gl;return new qr({func:d.NOTEQUAL,mask:255},o,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const d=this.context.gl;return new qr({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(o){const d=this.context.gl,g=o.sort((M,L)=>L.overscaledZ-M.overscaledZ),S=g[g.length-1].overscaledZ,C=g[0].overscaledZ-S+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();const M={};for(let L=0;L<C;L++)M[L+S]=new qr({func:d.GEQUAL,mask:255},L+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=C,[M,g]}return[{[S]:qr.disabled},g]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new gn([o.CONSTANT_COLOR,o.ONE,o.CONSTANT_COLOR,o.ONE],new i.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?gn.unblended:gn.alphaBlended}colorModeForDrapableLayerRenderPass(o){const d=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new gn([d.ONE,d.ONE_MINUS_SRC_ALPHA,d.CONSTANT_ALPHA,d.ONE_MINUS_SRC_ALPHA],new i.am(0,0,0,o===void 0?0:o),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(o,d,g,S=!1){if(this.depthOcclusion)return new Er(this.context.gl.GREATER,Er.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!S)return Er.disabled;const C=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new Er(g||this.context.gl.LEQUAL,d,[C,C])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const o=this.context.gl,d=Math.ceil(this.width),g=Math.ceil(this.height),S=this.context.bindFramebuffer.get(),C=o.getParameter(o.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===d&&this.depthFBO.height===g||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),d!==0&&g!==0&&(this.depthFBO=new Ed(this.context,d,g,!1,"texture"),this.depthTexture=new i.T(this.context,{width:d,height:g,data:null},o.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(S),o.bindTexture(o.TEXTURE_2D,C),this.depthFBO&&(o.bindFramebuffer(o.READ_FRAMEBUFFER,null),o.bindFramebuffer(o.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),o.blitFramebuffer(0,0,d,g,0,0,d,g,o.DEPTH_BUFFER_BIT,o.NEAREST),o.bindFramebuffer(o.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((o,d)=>o+d/this._fpsHistory.length,0))}render(o,d){const g=i.q.now();this._dt=g-this._timeStamp,this._timeStamp=g,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=o.map.repaint,this.style=o,this.options=d;const S=this.style._mergedLayers,C=!(!this.terrain||!this.terrain.enabled),M=()=>this.style._getOrder(C).filter(at=>{const gt=S[at];return!(gt.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[gt.type]});let L=M(),B=!1,q=!1;for(const at of L){const gt=S[at];gt.type==="circle"&&(B=!0),gt.type==="symbol"&&(gt.hasInitialOcclusionOpacityProperties?q=!0:B=!0)}let X=L.map(at=>S[at]);const ee=this.style._mergedSourceCaches;this.imageManager=o.imageManager,this.modelManager=o.modelManager,this.symbolFadeChange=o.placement.symbolFadeChange(i.q.now()),this.imageManager.beginFrame();let Q=0,ne=!1;for(const at in ee){const gt=ee[at];gt.used&&(gt.prepare(this.context),gt.getSource().usedInConflation&&++Q)}let fe=!1;for(const at of X)at.isHidden(this.transform.zoom)||(at.type==="clip"&&(fe=!0),this.prepareLayer(at));const de={},ye={},he={},Se={},Ae={};for(const at in ee){const gt=ee[at];de[at]=gt.getVisibleCoordinates(),ye[at]=de[at].slice().reverse(),he[at]=gt.getVisibleCoordinates(!0).reverse(),Se[at]=gt.getShadowCasterCoordinates(),Ae[at]=gt.sortCoordinatesByDistance(de[at])}const Pe=at=>{const gt=this.style.getLayerSourceCache(at);return gt&&gt.used?gt.getSource():null};if(Q||fe||this._clippingActiveLastFrame){const at=[],gt=[];let ot=0;for(const Lt of X)this.isSourceForClippingOrConflation(Lt,Pe(Lt))&&(at.push(Lt),gt.push(ot)),ot++;if(at&&(fe||at.length>1)||this._clippingActiveLastFrame){fe=!1;const Lt=[];for(let vt=0;vt<at.length;vt++){const zt=at[vt],Ot=gt[vt],$t=this.style.getLayerSourceCache(zt);if(!$t||!$t.used||!$t.getSource().usedInConflation&&zt.type!=="clip")continue;let Ut=i.ev,wr=i.bQ.None;const Ar=[];let dr=!0;if(zt.type==="clip"){Ut=Ot;for(const Cr of zt.layout.get("clip-layer-types"))wr|=Cr==="model"?i.bQ.Model:Cr==="symbol"?i.bQ.Symbol:i.bQ.FillExtrusion;for(const Cr of zt.layout.get("clip-layer-scope"))Ar.push(Cr);zt.isHidden(this.transform.zoom)?dr=!1:fe=!0}dr&&Lt.push({layer:zt.fqid,cache:$t,order:Ut,clipMask:wr,clipScope:Ar})}this.replacementSource.setSources(Lt),ne=!0}}this._clippingActiveLastFrame=fe,ne||this.replacementSource.clear(),this.conflationActive=ne,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let at=0;at<X.length;at++){const gt=X[at],ot=gt.cutoffRange();if(this.longestCutoffRange=Math.max(ot,this.longestCutoffRange),ot>0){const Lt=Pe(gt);Lt&&(this.minCutoffZoom=Math.max(Lt.minzoom,this.minCutoffZoom)),gt.minzoom&&(this.minCutoffZoom=Math.max(gt.minzoom,this.minCutoffZoom))}gt.is3D(C)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=at),this._lastOcclusionLayer=at)}const Be=this.style&&this.style.fog;Be?(this._fogVisible=Be.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Be.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(he),this.opaquePassCutoff=0,L=M(),X=L.map(at=>S[at]));const Fe=this._shadowRenderer;if(Fe){Fe.updateShadowParameters(this.transform,this.style.directionalLight);for(const at in ee)for(const gt of de[at]){let ot={min:0,max:0};this.terrain&&(ot=this.terrain.getMinMaxForTile(gt)||ot),Fe.addShadowReceiver(gt.toUnwrapped(),ot.min,ot.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.eu(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Wc(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const je=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ke=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(je&&!this._snow&&(this._snow=new Ai(this)),!je&&this._snow&&(this._snow.destroy(),delete this._snow),ke&&!this._rain&&(this._rain=new Zy(this)),!ke&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!ur.has(this.context.gl))return;this.renderPass="offscreen";for(const at of X){const gt=o.getLayerSourceCache(at);if(!at.hasOffscreenPass()||at.isHidden(this.transform.zoom))continue;const ot=gt?ye[gt.id]:void 0;(at.type==="custom"||at.type==="raster"||at.type==="raster-particle"||at.isSky()||ot&&ot.length)&&this.renderLayer(this,gt,at,ot)}this.depthRangeFor3D=[0,1-(X.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,Se)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const qe=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ze=(()=>{if(d.showOverdrawInspector)return i.am.black;const at=this.style.fog;if(at&&this.transform.projection.supportsFog){const gt=this.style.getLut(at.scope);if(!qe){const ot=at.properties.get("color-use-theme")==="none",Lt=at.properties.get("color").toRenderColor(ot?null:gt).toArray01();return new i.am(...Lt)}if(qe){const ot=at.properties.get("space-color-use-theme")==="none",Lt=at.properties.get("space-color").toRenderColor(ot?null:gt).toArray01();return new i.am(...Lt)}}return i.am.transparent})();if(this.context.clear({color:Ze,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&qe&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=L.length-1;this.currentLayer>=0;this.currentLayer--){const at=X[this.currentLayer],gt=o.getLayerSourceCache(at);if(at.isSky())continue;const ot=gt?(at.is3D(C)?Ae:ye)[gt.id]:void 0;this._renderTileClippingMasks(at,gt,ot),this.renderLayer(this,gt,at,ot)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&qe&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<L.length;this.currentLayer++){const at=X[this.currentLayer],gt=o.getLayerSourceCache(at);at.isSky()&&this.renderLayer(this,gt,at,gt?ye[gt.id]:void 0)}function yt(at,gt){let ot;return gt&&(ot=(at.type==="symbol"?he:at.is3D(C)?Ae:ye)[gt.id]),ot}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<L.length;){const at=X[this.currentLayer];if(at.type==="raster"||at.type==="raster-particle"){const gt=o.getLayerSourceCache(at);this.renderLayer(this,gt,at,yt(at,gt))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ut=0;Fe&&(ut=Fe.getShadowCastingLayerCount());let At=!1,Mt=-1;for(let at=0;at<L.length;++at){const gt=X[at];gt.isHidden(this.transform.zoom)||gt.is3D(C)&&(Mt=at)}q&&Mt===-1&&(B=!0);let Zt=!1;for(;this.currentLayer<L.length;){const at=X[this.currentLayer],gt=o.getLayerSourceCache(at);if(at.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(at)){if(at.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Zt&&at.is3D(C)&&!C){const ot=this.currentLayer,Lt=vt=>{for(this.currentLayer=0;this.currentLayer<X.length;this.currentLayer++){const zt=X[this.currentLayer];if(lc[zt.type]){const Ot=this.style.getLayerSourceCache(zt);lc[zt.type](this,Ot,zt,yt(zt,Ot),vt)}}};Lt("initialize"),Lt("reset"),this.currentLayer=ot,Zt=!0}if(B&&!At&&this.terrain&&!this.transform.isOrthographic&&(At=!0,this.blitDepth()),q&&Mt!==-1&&this.currentLayer===Mt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(at,gt,gt?de[gt.id]:void 0),this.renderLayer(this,gt,at,yt(at,gt)),!this.terrain&&Fe&&ut>0&&at.hasShadowPass()&&--ut==0&&(Fe.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const ot=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ot;this.currentLayer++){const Lt=X[this.currentLayer];if(!Lt.hasLightBeamPass())continue;const vt=o.getLayerSourceCache(Lt);this.renderLayer(this,vt,Lt,vt?ye[vt.id]:void 0)}this.currentLayer=ot,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const ot=this.currentLayer;this.depthOcclusion=!0;for(const Lt of this.layersWithOcclusionOpacity){this.currentLayer=Lt;const vt=X[this.currentLayer],zt=o.getLayerSourceCache(vt),Ot=zt?ye[zt.id]:void 0;this.terrain||this._renderTileClippingMasks(vt,zt,zt?de[zt.id]:void 0),this.renderLayer(this,zt,vt,Ot)}this.depthOcclusion=!1,this.currentLayer=ot,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let at=null;X.forEach(gt=>{const ot=o.getLayerSourceCache(gt);ot&&!gt.isHidden(this.transform.zoom)&&ot.getVisibleCoordinates().length&&(!at||at.getSource().maxzoom<ot.getSource().maxzoom)&&(at=ot)}),at&&this.options.showTileBoundaries&&qn.debug(this,at,at.getVisibleCoordinates(),i.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&qn.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(at){const gt=at.transform.padding;$f(at,at.transform.height-(gt.top||0),3,ol),$f(at,gt.bottom||0,3,Md),Dh(at,gt.left||0,3,Id),Dh(at,at.transform.width-(gt.right||0),3,no);const ot=at.transform.centerPoint;(function(Lt,vt,zt,Ot){us(Lt,vt-1,zt-10,2,20,Ot),us(Lt,vt-10,zt-1,20,2,Ot)})(at,ot.x,at.transform.height-ot.y,sc)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),ne||(this.conflationActive=!1)}prepareLayer(o){this.gpuTimingStart(o);const{unsupportedLayers:d}=this.transform.projection,g=!d||!d.includes(o.type);if(qf[o.type]&&(g||this.terrain&&o.type==="custom")){const S=this.style.getLayerSourceCache(o);qf[o.type](o,S,this)}this.gpuTimingEnd()}renderLayer(o,d,g,S){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="sky"||g.type==="custom"||g.type==="model"||g.type==="raster"||g.type==="raster-particle"||S&&S.length)&&(this.id=g.id,this.gpuTimingStart(g),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(g.type)&&(!o.terrain||g.type!=="custom")||g.type==="clip"||qn[g.type](o,d,g,S,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const d=this.context.extTimerQuery,g=this.context.gl;let S=this.gpuTimers[o.id];S||(S=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:g.createQuery()}),S.calls++,g.beginQuery(d.TIME_ELAPSED_EXT,S.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const o=this.context.extTimerQuery,d=this.context.gl,g=d.createQuery();this.deferredRenderGpuTimeQueries.push(g),d.beginQuery(o.TIME_ELAPSED_EXT,g)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}collectDeferredRenderGpuQueries(){const o=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],o}queryGpuTimers(o){const d={};for(const g in o){const S=o[g],C=this.context.extTimerQuery,M=C.getQueryParameter(S.query,this.context.gl.QUERY_RESULT)/1e6;C.deleteQueryEXT(S.query),d[g]=M}return d}queryGpuTimeDeferredRender(o){if(!this.options.gpuTimingDeferredRender)return 0;const d=this.context.gl;let g=0;for(const S of o)g+=d.getQueryParameter(S,d.QUERY_RESULT)/1e6,d.deleteQuery(S);return g}translatePosMatrix(o,d,g,S,C){if(!g[0]&&!g[1])return o;const M=C?S==="map"?this.transform.angle:0:S==="viewport"?-this.transform.angle:0;if(M){const q=Math.sin(M),X=Math.cos(M);g=[g[0]*X-g[1]*q,g[0]*q+g[1]*X]}const L=[C?g[0]:i.aw(d,g[0],this.transform.zoom),C?g[1]:i.aw(d,g[1],this.transform.zoom),0],B=new Float32Array(16);return i.bo(B,o,L),B}saveTileTexture(o){const d=o.size[0],g=this._tileTextures[d];g?g.push(o):this._tileTextures[d]=[o]}getTileTexture(o){const d=this._tileTextures[o];return d&&d.length>0?d.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(o,d,g){const S=g===void 0?this.terrain&&this.terrain.renderingToTexture:g,C=[];return this.style&&this.style.enable3dLights()&&(o==="globeRaster"||o==="terrainRaster"?(C.push("LIGHTING_3D_MODE"),C.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):S||C.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||C.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(C.push("TERRAIN"),this.linearFloatFilteringSupported()&&C.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&C.push("GLOBE"),!this._fogVisible||S||d!==void 0&&!d||C.push("FOG","FOG_DITHERING"),S&&C.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&C.push("OVERDRAW_INSPECTOR"),C}getOrCreateProgram(o,d){this.cache=this.cache||{};const g=d&&d.defines||[],S=d&&d.config,C=this.currentGlobalDefines(o,d&&d.overrideFog,d&&d.overrideRtt).concat(g),M=bd.cacheKey(wu[o],o,C,S);return this.cache[M]||(this.cache[M]=new bd(this.context,o,wu[o],S,Lh[o],C)),this.cache[M]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(o,d){if(this.style.enable3dLights()){const g=this.style.directionalLight,S=this.style.ambientLight;if(g&&S){const C=((M,L,B)=>{const q=M.properties.get("direction"),X=M.properties.get("color-use-theme")==="none",ee=M.properties.get("color").toRenderColor(X?null:B.getLut(M.scope)).toArray01(),Q=M.properties.get("intensity"),ne=L.properties.get("color-use-theme")==="none",fe=L.properties.get("color").toRenderColor(ne?null:B.getLut(L.scope)).toArray01(),de=L.properties.get("intensity"),ye=[q.x,q.y,q.z],he=i.dw(fe,de),Se=i.dw(ee,Q);return{u_lighting_ambient_color:he,u_lighting_directional_dir:ye,u_lighting_directional_color:Se,u_ground_radiance:Ph(ye,Se,he)}})(g,S,this.style);d.setLightsUniformValues(o,C)}}}uploadCommonUniforms(o,d,g,S,C){if(this.uploadCommonLightUniforms(o,d),this.terrain&&this.terrain.renderingToTexture)return;const M=this.style.fog;if(M){const L=M.getOpacity(this.transform.pitch),B=((q,X,ee,Q,ne,fe,de,ye,he,Se,Ae,Pe)=>{const Be=q.transform,Fe=X.properties.get("color-use-theme")==="none",je=X.properties.get("color").toRenderColor(Fe?null:q.style.getLut(X.scope)).toArray01();je[3]=Q;const ke=q.frameCounter/1e3%1,[qe,Ze]=X.properties.get("vertical-range");return{u_fog_matrix:ee?Be.calculateFogTileMatrix(ee):Pe||q.identityMat,u_fog_range:X.getFovAdjustedRange(Be._fov),u_fog_color:je,u_fog_horizon_blend:X.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(qe,Ze),Ze],u_fog_temporal_offset:ke,u_frustum_tl:ne,u_frustum_tr:fe,u_frustum_br:de,u_frustum_bl:ye,u_globe_pos:he,u_globe_radius:Se,u_viewport:Ae,u_globe_transition:i.ah(Be.zoom),u_is_globe:+(Be.projection.name==="globe")}})(this,M,g,L,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.q.devicePixelRatio,this.transform.height*i.q.devicePixelRatio],S);d.setFogUniformValues(o,B)}C&&d.setCutoffUniformValues(o,C.uniformValues)}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){const o=this.canvasCopy();o&&(this.frameCopies.push(o),this.tileLoaded=!1)}canvasCopy(){const o=this.context.gl,d=o.createTexture();return o.bindTexture(o.TEXTURE_2D,d),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),d}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&o.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const o=this._backgroundTiles,d=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const S of g)d[S.key]=o[S.key]||new Ul(S,512,this.transform.tileZoom,this);return d}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(o,d){return!(!o.is3D(!(!this.terrain||!this.terrain.enabled))||o.type!=="clip"&&(o.minzoom&&o.minzoom>this.transform.zoom||(this.style._clipLayerPresent||o.sourceLayer!=="building")&&(!d||d.type!=="batched-model")))}isTileAffectedByFog(o){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let d=this._cachedTileFogOpacities[o.key];return d||(this._cachedTileFogOpacities[o.key]=d=this.style.fog.getOpacityForTile(o)),d[0]>=ar||d[1]>=ar}setupDepthForOcclusion(o,d,g){const S=this.context,C=S.gl,M=!!g;var L;g||(g={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),S.activeTexture.set(C.TEXTURE3),o&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),g.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],g.u_depth_range_unpack=[2/((L=this.depthRangeFor3D)[1]-L[0]),-1-2*L[0]/(L[1]-L[0])],g.u_occluder_half_size=.5*this.occlusionParams.occluderSize,g.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),S.activeTexture.set(C.TEXTURE0),M||d.setTerrainUniformValues(S,g)}}function Lu(m,o){let d=!1,g=null;const S=()=>{g=null,d&&(m(),g=setTimeout(S,o),d=!1)};return()=>(d=!0,g||S(),g)}class Bh{constructor(o){this._hashName=o&&encodeURIComponent(o),i.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Lu(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const o=this._map;if(!o)return"";const d=Hf(o);if(this._hashName){const g=this._hashName;let S=!1;const C=location.hash.slice(1).split("&").map(M=>{const L=M.split("=")[0];return L===g?(S=!0,`${L}=${d}`):M}).filter(M=>M);return S||C.push(`${g}=${d}`),`#${C.join("&")}`}return`#${d}`}_getCurrentHash(){const o=location.hash.replace("#","");if(this._hashName){let d;return o.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(d=g)}),(d&&d[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._map;if(!o)return!1;const d=this._getCurrentHash();if(d.length>=3&&!d.some(g=>isNaN(Number(g)))){const g=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(d[3]||0):o.getBearing();return o.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:g,pitch:+(d[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Hf(m,o){const d=m.getCenter(),g=Math.round(100*m.getZoom())/100,S=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),C=Math.pow(10,S),M=Math.round(d.lng*C)/C,L=Math.round(d.lat*C)/C,B=m.getBearing(),q=m.getPitch();let X=o?`/${M}/${L}/${g}`:`${g}/${L}/${M}`;return(B||q)&&(X+="/"+Math.round(10*B)/10),q&&(X+=`/${Math.round(q)}`),X}const $h={linearity:.3,easing:i.ew(0,0,.3,1)},Ag=i.l({deceleration:2500,maxSpeed:1400},$h),Qp=i.l({deceleration:20,maxSpeed:1400},$h),Il=i.l({deceleration:1e3,maxSpeed:360},$h),cc=i.l({deceleration:1e3,maxSpeed:90},$h);class Ld{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.q.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,d=i.q.now();for(;o.length>0&&d-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const d={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:C}of this._inertiaBuffer)d.zoom+=C.zoomDelta||0,d.bearing+=C.bearingDelta||0,d.pitch+=C.pitchDelta||0,C.panDelta&&d.pan._add(C.panDelta),C.around&&(d.around=C.around),C.pinchAround&&(d.pinchAround=C.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,S={};if(d.pan.mag()){const C=Vh(d.pan.mag(),g,i.l({},Ag,o||{}));S.offset=d.pan.mult(C.amount/d.pan.mag()),S.center=this._map.transform.center,Rd(S,C)}if(d.zoom){const C=Vh(d.zoom,g,Qp);S.zoom=this._map.transform.zoom+C.amount,Rd(S,C)}if(d.bearing){const C=Vh(d.bearing,g,Il);S.bearing=this._map.transform.bearing+i.aD(C.amount,-179,179),Rd(S,C)}if(d.pitch){const C=Vh(d.pitch,g,cc);S.pitch=this._map.transform.pitch+C.amount,Rd(S,C)}if(S.zoom||S.bearing){const C=d.pinchAround===void 0?d.around:d.pinchAround;S.around=C?this._map.unproject(C):this._map.getCenter()}return this.clear(),S.noMoveStart=!0,S}}function Rd(m,o){(!m.duration||m.duration<o.duration)&&(m.duration=o.duration,m.easing=o.easing)}function Vh(m,o,d){const{maxSpeed:g,linearity:S,deceleration:C}=d,M=i.aD(m*S/(o/1e3),-g,g),L=Math.abs(M)/(C*S);return{easing:d.easing,duration:1e3*L,amount:M*(L/2)}}class pa extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,g,S={}){const C=ce(d.getCanvasContainer(),g),M=d.unproject(C);super(o,i.l({point:C,lngLat:M,originalEvent:g},S)),this._defaultPrevented=!1,this.target=d}}class so extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,g){const S=o==="touchend"?g.changedTouches:g.touches,C=ge(d.getCanvasContainer(),S),M=C.map(B=>d.unproject(B)),L=C.reduce((B,q,X,ee)=>B.add(q.div(ee.length)),new i.P(0,0));super(o,{points:C,point:L,lngLats:M,lngLat:d.unproject(L),originalEvent:g}),this._defaultPrevented=!1}}class Wf extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d){super("wheel",{originalEvent:d}),this._defaultPrevented=!1}}class kl{constructor(o,d){this._map=o,this._clickTolerance=d.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new Wf(this._map,o))}mousedown(o,d){return this._mousedownPos=d,this._firePreventable(new pa(o.type,this._map,o))}mouseup(o){this._map.fire(new pa(o.type,this._map,o))}preclick(o){const d=i.l({},o);d.type="preclick",this._map.fire(new pa(d.type,this._map,d))}click(o,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||(this.preclick(o),this._map.fire(new pa(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new pa(o.type,this._map,o))}mouseover(o){this._map.fire(new pa(o.type,this._map,o))}mouseout(o){this._map.fire(new pa(o.type,this._map,o))}touchstart(o){return this._firePreventable(new so(o.type,this._map,o))}touchmove(o){this._map.fire(new so(o.type,this._map,o))}touchend(o){this._map.fire(new so(o.type,this._map,o))}touchcancel(o){this._map.fire(new so(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class em{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new pa(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new pa("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new pa(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Zf{constructor(o,d){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,d){this.isEnabled()&&o.shiftKey&&o.button===0&&(J(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(o,d){if(!this._active)return;const g=d,S=this._startPos,C=this._lastPos;if(!S||!C||C.equals(g)||!this._box&&g.dist(S)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=O("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const M=Math.min(S.x,g.x),L=Math.max(S.x,g.x),B=Math.min(S.y,g.y),q=Math.max(S.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${M}px,${B}px)`,this._box.style.width=L-M+"px",this._box.style.height=q-B+"px")})}mouseupWindow(o,d){if(!this._active)return;const g=this._startPos,S=d;if(g&&o.button===0){if(this.reset(),ie(),g.x!==S.x||g.y!==S.y)return this._map.fire(new i.A("boxzoomend",{originalEvent:o})),{cameraAnimation:C=>C.fitScreenCoordinates(g,S,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),G(),delete this._startPos,delete this._lastPos}_fireEvent(o,d){return this._map.fire(new i.A(o,{originalEvent:d}))}}function Uh(m,o){const d={};for(let g=0;g<m.length;g++)d[m[g].identifier]=o[g];return d}class Xf{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,d,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=o.timeStamp),g.length===this.numTouches&&(this.centroid=function(S){const C=new i.P(0,0);for(const M of S)C._add(M);return C.div(S.length)}(d),this.touches=Uh(g,d)))}touchmove(o,d,g){if(this.aborted||!this.centroid)return;const S=Uh(g,d);for(const C in this.touches){const M=S[C];(!M||M.dist(this.touches[C])>30)&&(this.aborted=!0)}}touchend(o,d,g){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){const S=!this.aborted&&this.centroid;if(this.reset(),S)return S}}}class bs{constructor(o){this.singleTap=new Xf(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,d,g){this.singleTap.touchstart(o,d,g)}touchmove(o,d,g){this.singleTap.touchmove(o,d,g)}touchend(o,d,g){const S=this.singleTap.touchend(o,d,g);if(S){const C=o.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(S)<30;if(C&&M||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=S,this.count===this.numTaps)return this.reset(),S}}}class Kf{constructor(){this._zoomIn=new bs({numTouches:1,numTaps:2}),this._zoomOut=new bs({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,d,g){this._zoomIn.touchstart(o,d,g),this._zoomOut.touchstart(o,d,g)}touchmove(o,d,g){this._zoomIn.touchmove(o,d,g),this._zoomOut.touchmove(o,d,g)}touchend(o,d,g){const S=this._zoomIn.touchend(o,d,g),C=this._zoomOut.touchend(o,d,g);return S?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()+1,around:M.unproject(S)},{originalEvent:o})}):C?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()-1,around:M.unproject(C)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Yf={0:1,2:2},Ru={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class qh{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,d){return!1}_move(o,d){return{}}mousedown(o,d){if(this._lastPoint)return;const g=be(o);this._correctButton(o,g)&&(this._lastPoint=d,this._eventButton=g)}mousemoveWindow(o,d){const g=this._lastPoint;if(g){if(o.preventDefault(),this._eventButton!=null&&function(S,C){const M=Yf[C];return S.buttons===void 0||(S.buttons&M)!==M}(o,this._eventButton))this.reset();else if(this._moved||!(d.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(g,d)}}mouseupWindow(o){this._lastPoint&&be(o)===this._eventButton&&(this._moved&&ie(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tm extends qh{mousedown(o,d){super.mousedown(o,d),this._lastPoint&&(this._active=!0)}_correctButton(o,d){return d===0&&!o.ctrlKey}_move(o,d){return{around:d,panDelta:d.sub(o)}}}class Jf extends qh{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?Ru[o.pitchRotateKey]:void 0}_correctButton(o,d){return this._pitchRotateKey?d===0&&o[this._pitchRotateKey]:d===0&&o.ctrlKey||d===2}_move(o,d){const g=.8*(d.x-o.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class ju extends qh{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?Ru[o.pitchRotateKey]:void 0}_correctButton(o,d){return this._pitchRotateKey?d===0&&o[this._pitchRotateKey]:d===0&&o.ctrlKey||d===2}_move(o,d){const g=-.5*(d.y-o.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class rm{constructor(o,d){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset(),i.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(o,d,g){return this._calculateTransform(o,d,g)}touchmove(o,d,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(g.length===1&&!i.ex())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.cancelable&&o.preventDefault(),this._calculateTransform(o,d,g)}}touchend(o,d,g){this._calculateTransform(o,d,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,d,g){g.length>0&&(this._active=!0);const S=Uh(g,d),C=new i.P(0,0),M=new i.P(0,0);let L=0;for(const q in S){const X=S[q],ee=this._touches[q];ee&&(C._add(X),M._add(X.sub(ee)),L++,S[q]=X)}if(this._touches=S,L<this._minTouches||!M.mag())return;const B=M.div(L);return this._sum._add(B),this._sum.mag()<this._clickTolerance?void 0:{around:C.div(L),panDelta:B}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=O("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Qf{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,d,g){return{}}touchstart(o,d,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([d[0],d[1]]))}touchmove(o,d,g){const S=this._firstTwoTouches;if(!S)return;o.preventDefault();const[C,M]=S,L=fo(g,d,C),B=fo(g,d,M);if(!L||!B)return;const q=this._aroundCenter?null:L.add(B).div(2);return this._move([L,B],q,o)}touchend(o,d,g){if(!this._firstTwoTouches)return;const[S,C]=this._firstTwoTouches,M=fo(g,d,S),L=fo(g,d,C);M&&L||(this._active&&ie(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function fo(m,o,d){for(let g=0;g<m.length;g++)if(m[g].identifier===d)return o[g]}function po(m,o){return Math.log(m/o)/Math.LN2}class nm extends Qf{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,d){const g=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(po(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:po(this._distance,g),pinchAround:d}}}function ep(m,o){return 180*m.angleWith(o)/Math.PI}class Pg extends Qf{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,d){const g=this._vector;if(this._vector=o[0].sub(o[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:ep(this._vector,g),pinchAround:d}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const d=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;const S=ep(o,g);return Math.abs(S)<d}}function tp(m){return Math.abs(m.y)>Math.abs(m.x)}class Mg extends Qf{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,tp(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,d,g){const S=this._lastPoints;if(!S)return;const C=o[0].sub(S[0]),M=o[1].sub(S[1]);return this._map._cooperativeGestures&&!i.ex()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(C,M,g.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(C.y+M.y)/2*-.5})}gestureBeginsVertically(o,d,g){if(this._valid!==void 0)return this._valid;const S=o.mag()>=2,C=d.mag()>=2;if(!S&&!C)return;if(!S||!C)return this._firstMove==null&&(this._firstMove=g),g-this._firstMove<100&&void 0;const M=o.y>0==d.y>0;return tp(o)&&tp(d)&&M}}const im={panStep:100,bearingStep:15,pitchStep:10};class Ig{constructor(){const o=im;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let d=0,g=0,S=0,C=0,M=0;switch(o.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:o.shiftKey?g=-1:(o.preventDefault(),C=-1);break;case 39:o.shiftKey?g=1:(o.preventDefault(),C=1);break;case 38:o.shiftKey?S=1:(o.preventDefault(),M=-1);break;case 40:o.shiftKey?S=-1:(o.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(g=0,S=0),{cameraAnimation:L=>{const B=L.getZoom();L.easeTo({duration:300,easeId:"keyboardHandler",easing:sm,zoom:d?Math.round(B)+d*(o.shiftKey?2:1):B,bearing:L.getBearing()+g*this._bearingStep,pitch:L.getPitch()+S*this._pitchStep,offset:[-C*this._panStep,-M*this._panStep],center:L.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function sm(m){return m*(2-m)}const om=4.000244140625,kg=1/450;class am{constructor(o,d){this._map=o,this._el=o.getCanvasContainer(),this._handler=d,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=kg,i.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||i.ex()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let d=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const g=i.q.now(),S=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,d!==0&&d%om==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":S>400?(this._type=null,this._lastValue=d,this._timeout=window.setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(S*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),o.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=o,this._delta-=d,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=ce(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:d,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform;this._type==="wheel"&&o.projection.wrap&&(o._center.lng>=180||o._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const d=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(this._delta!==0){const q=this._type==="wheel"&&Math.abs(this._delta)>om?this._wheelZoomRate:this._defaultZoomRate;let X=2/(1+Math.exp(-Math.abs(this._delta*q)));this._delta<0&&X!==0&&(X=1/X);const ee=d(),Q=Math.pow(2,ee),ne=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):Q;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(ne*X))),this._type==="wheel"&&(this._startZoom=ee,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const g=typeof this._targetZoom=="number"?this._targetZoom:d(),S=this._startZoom,C=this._easing;let M,L=!1;if(this._type==="wheel"&&S&&C){const q=Math.min((i.q.now()-this._lastWheelEventTime)/200,1),X=C(q);M=i.ai(S,g,X),q<1?this._frameId||(this._frameId=!0):L=!0}else M=g,L=!0;this._active=!0,L&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let B=M-d();return B*this._lastDelta<0&&(B=0),{noInertia:!0,needsRenderFrame:!L,zoomDelta:B,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let d=i.ey;if(this._prevEase){const g=this._prevEase,S=(i.q.now()-g.start)/g.duration,C=g.easing(S+.01)-g.easing(S),M=.27/Math.sqrt(C*C+1e-4)*.01,L=Math.sqrt(.0729-M*M);d=i.ew(M,L,.25,1)}return this._prevEase={start:i.q.now(),duration:o,easing:d},d}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=O("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class lm{constructor(o,d){this._clickZoom=o,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Og{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,d){return o.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(o.shiftKey?-1:1),around:g.unproject(d)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cm{constructor(){this._tap=new bs({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,d,g){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=d[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(o,d,g))}touchmove(o,d,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const S=d[0],C=S.y-this._swipePoint.y;return this._swipePoint=S,o.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(o,d,g)}touchend(o,d,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(o,d,g)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rp{constructor(o,d,g){this._el=o,this._mousePan=d,this._touchPan=g}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Q_{constructor(o,d,g){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=d,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Xy{constructor(o,d,g,S){this._el=o,this._touchZoom=d,this._touchRotate=g,this._tapDragZoom=S,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ji=m=>m.zoom||m.drag||m.pitch||m.rotate;class Lg extends i.A{}class um{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,d){const g=i.at([],d,o);this.radius=i.ae(g[2]<0?i.eA([],g,this.constants):[g[0],g[1],0])}projectRay(o){i.eA(o,o,this.constants),i.au(o,o),i.eB(o,o,this.constants);const d=i.b$([],o,this.radius);if(d[2]>0){const g=i.b$([],[0,0,1],i.bE(d,[0,0,1])),S=i.b$([],i.au([],[d[0],d[1],0]),this.radius),C=i.cU([],d,i.b$([],i.at([],i.cU([],S,g),d),2));d[0]=C[0],d[1]=C[1]}return d}}function Ea(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class e0{constructor(o,d){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ld(o),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new um,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(d),i.aV(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(const[S,C,M]of this._listeners){const L=S===document?this.handleWindowEvent:this.handleEvent;S.addEventListener(C,L,M)}}destroy(){for(const[o,d,g]of this._listeners){const S=o===document?this.handleWindowEvent:this.handleEvent;o.removeEventListener(d,S,g)}}_addDefaultHandlers(o){const d=this._map,g=d.getCanvasContainer();this._add("mapEvent",new kl(d,o));const S=d.boxZoom=new Zf(d,o);this._add("boxZoom",S);const C=new Kf,M=new Og;d.doubleClickZoom=new lm(M,C),this._add("tapZoom",C),this._add("clickZoom",M);const L=new cm;this._add("tapDragZoom",L);const B=d.touchPitch=new Mg(d);this._add("touchPitch",B);const q=new Jf(o),X=new ju(o);d.dragRotate=new Q_(o,q,X),this._add("mouseRotate",q,["mousePitch"]),this._add("mousePitch",X,["mouseRotate"]);const ee=new tm(o),Q=new rm(d,o);d.dragPan=new rp(g,ee,Q),this._add("mousePan",ee),this._add("touchPan",Q,["touchZoom","touchRotate"]);const ne=new Pg,fe=new nm;d.touchZoomRotate=new Xy(g,fe,ne,L),this._add("touchRotate",ne,["touchPan","touchZoom"]),this._add("touchZoom",fe,["touchPan","touchRotate"]),this._add("blockableMapEvent",new em(d));const de=d.scrollZoom=new am(d,this);this._add("scrollZoom",de,["mousePan"]);const ye=d.keyboard=new Ig;this._add("keyboard",ye);for(const he of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[he]&&d[he].enable(o[he])}_add(o,d,g){this._handlers.push({handlerName:o,handler:d,allowed:g}),this._handlersById[o]=d}stop(o){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ji(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(o,d,g){for(const S in o)if(S!==g&&(!d||d.indexOf(S)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const d=[];for(const g of o)this._el.contains(g.target)&&d.push(g);return d}handleEvent(o,d){this._updatingCamera=!0;const g=o.type==="renderFrame",S=g?void 0:o,C={needsRenderFrame:!1},M={},L={},B=o.touches?this._getMapTouches(o.touches):void 0,q=B?ge(this._el,B):g?void 0:ce(this._el,o);for(const{handlerName:Q,handler:ne,allowed:fe}of this._handlers){if(!ne.isEnabled())continue;let de;this._blockedByActive(L,fe,Q)?ne.reset():ne[d||o.type]&&(de=ne[d||o.type](o,q,B),this.mergeHandlerResult(C,M,de,Q,S),de&&de.needsRenderFrame&&this._triggerRenderFrame()),(de||ne.isActive())&&(L[Q]=ne)}const X={};for(const Q in this._previousActiveHandlers)L[Q]||(X[Q]=S);this._previousActiveHandlers=L,(Object.keys(X).length||Ea(C))&&(this._changes.push([C,M,X]),this._triggerRenderFrame()),(Object.keys(L).length||Ea(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ee}=C;ee&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ee(this._map))}mergeHandlerResult(o,d,g,S,C){if(!g)return;i.l(o,g);const M={handlerName:S,originalEvent:g.originalEvent||C};g.zoomDelta!==void 0&&(d.zoom=M),g.panDelta!==void 0&&(d.drag=M),g.pitchDelta!==void 0&&(d.pitch=M),g.bearingDelta!==void 0&&(d.rotate=M)}_applyChanges(){const o={},d={},g={};for(const[S,C,M]of this._changes)S.panDelta&&(o.panDelta=(o.panDelta||new i.P(0,0))._add(S.panDelta)),S.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+S.zoomDelta),S.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+S.bearingDelta),S.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+S.pitchDelta),S.around!==void 0&&(o.around=S.around),S.aroundCoord!==void 0&&(o.aroundCoord=S.aroundCoord),S.pinchAround!==void 0&&(o.pinchAround=S.pinchAround),S.noInertia&&(o.noInertia=S.noInertia),i.l(d,C),i.l(g,M);this._updateMapTransform(o,d,g),this._changes=[]}_updateMapTransform(o,d,g){const S=this._map,C=S.transform,M=Se=>[Se.x,Se.y,Se.z];if((Se=>{const Ae=this._eventsInProgress.drag;return Ae&&!this._handlersById[Ae.handlerName].isActive()})()&&!Ea(o)){const Se=C.zoom;C.cameraElevationReference="sea",this._originalZoom!=null&&C._orthographicProjectionAtLowPitch&&C.projection.name!=="globe"&&C.pitch===0?(C.cameraElevationReference="ground",C.zoom=this._originalZoom):(C.recenterOnTerrain(),C.cameraElevationReference="ground"),Se!==C.zoom&&this._map._update(!0)}if(C._isCameraConstrained&&S._stop(!0),!Ea(o))return void this._fireEvents(d,g,!0);let{panDelta:L,zoomDelta:B,bearingDelta:q,pitchDelta:X,around:ee,aroundCoord:Q,pinchAround:ne}=o;C._isCameraConstrained&&(B>0&&(B=0),C._isCameraConstrained=!1),ne!==void 0&&(ee=ne),(B||(Se=>d[Se]&&!this._eventsInProgress[Se])("drag"))&&ee&&(this._dragOrigin=M(C.pointCoordinate3D(ee)),this._originalZoom=C.zoom,this._trackingEllipsoid.setup(C._camera.position,this._dragOrigin)),C.cameraElevationReference="sea",S._stop(!0),ee=ee||S.transform.centerPoint,q&&(C.bearing+=q),X&&(C.pitch+=X),C._updateCameraState();const fe=[0,0,0];if(L)if(C.projection.name==="mercator"){const Se=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay(ee).dir),Ae=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay(ee.sub(L)).dir);fe[0]=Ae[0]-Se[0],fe[1]=Ae[1]-Se[1]}else{const Se=C.pointCoordinate(ee);if(C.projection.name==="globe"){L=L.rotate(-C.angle);const Ae=C._pixelsPerMercatorPixel/C.worldSize;fe[0]=-L.x*i.ez(i.aY(Se.y))*Ae,fe[1]=-L.y*i.ez(C.center.lat)*Ae}else{const Ae=C.pointCoordinate(ee.sub(L));Se&&Ae&&(fe[0]=Ae.x-Se.x,fe[1]=Ae.y-Se.y)}}const de=C.zoom,ye=[0,0,0];if(B){const Se=M(Q||C.pointCoordinate3D(ee)),Ae={dir:i.au([],i.at([],Se,C._camera.position))};if(Ae.dir[2]<0){const Pe=C.zoomDeltaToMovement(Se,B);i.b$(ye,Ae.dir,Pe)}}const he=i.cU(fe,fe,ye);C._translateCameraConstrained(he),B&&Math.abs(C.zoom-de)>1e-4&&C.recenterOnTerrain(),C.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(d,g,!0)}_fireEvents(o,d,g){const S=ji(this._eventsInProgress),C=ji(o),M={};for(const X in o){const{originalEvent:ee}=o[X];this._eventsInProgress[X]||(M[`${X}start`]=ee),this._eventsInProgress[X]=o[X]}!S&&C&&this._fireEvent("movestart",C.originalEvent);for(const X in M)this._fireEvent(X,M[X]);C&&this._fireEvent("move",C.originalEvent);for(const X in o){const{originalEvent:ee}=o[X];this._fireEvent(X,ee)}const L={};let B;for(const X in this._eventsInProgress){const{handlerName:ee,originalEvent:Q}=this._eventsInProgress[X];this._handlersById[ee].isActive()||(delete this._eventsInProgress[X],B=d[ee]||Q,L[`${X}end`]=B)}for(const X in L)this._fireEvent(X,L[X]);const q=ji(this._eventsInProgress);if(g&&(S||C)&&!q){this._updatingCamera=!0;const X=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ee=Q=>Q!==0&&-this._bearingSnap<Q&&Q<this._bearingSnap;X?(ee(X.bearing||this._map.getBearing())&&(X.bearing=0),this._map.easeTo(X,{originalEvent:B})):(this._map.fire(new i.A("moveend",{originalEvent:B})),ee(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,d){this._map.fire(new i.A(o,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new Lg("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const jd="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class dm extends i.E{constructor(o,d){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=d.bearingSnap,this._respectPrefersReducedMotion=d.respectPrefersReducedMotion!==!1,i.aV(["_renderFrameCallback"],this)}getCenter(){return new i.cd(this.transform.center.lng,this.transform.center.lat)}setCenter(o,d){return this.jumpTo({center:o},d)}panBy(o,d,g){return o=i.P.convert(o).mult(-1),this.panTo(this.transform.center,i.l({offset:o},d),g)}panTo(o,d,g){return this.easeTo(i.l({center:o},d),g)}getZoom(){return this.transform.zoom}setZoom(o,d){return this.jumpTo({zoom:o},d),this}zoomTo(o,d,g){return this.easeTo(i.l({zoom:o},d),g)}zoomIn(o,d){return this.zoomTo(this.getZoom()+1,o,d),this}zoomOut(o,d){return this.zoomTo(this.getZoom()-1,o,d),this}getBearing(){return this.transform.bearing}setBearing(o,d){return this.jumpTo({bearing:o},d),this}getPadding(){return this.transform.padding}setPadding(o,d){return this.jumpTo({padding:o},d),this}rotateTo(o,d,g){return this.easeTo(i.l({bearing:o},d),g)}resetNorth(o,d){return this.rotateTo(0,i.l({duration:1e3},o),d),this}resetNorthPitch(o,d){return this.easeTo(i.l({bearing:0,pitch:0,duration:1e3},o),d),this}snapToNorth(o,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,d):this}getPitch(){return this.transform.pitch}setPitch(o,d){return this.jumpTo({pitch:o},d),this}cameraForBounds(o,d){o=i.aG.convert(o);const g=d&&d.bearing||0,S=d&&d.pitch||0,C=o.getNorthWest(),M=o.getSouthEast();return this._cameraForBounds(this.transform,C,M,g,S,d)}_extendPadding(o){const d={top:0,right:0,bottom:0,left:0};return o==null?i.l({},d,this.transform.padding):typeof o=="number"?{top:o,bottom:o,right:o,left:o}:i.l({},d,o)}_extendCameraOptions(o){return(o=i.l({offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=this._extendPadding(o.padding),o}_minimumAABBFrustumDistance(o,d){const g=d.max[0]-d.min[0],S=d.max[1]-d.min[1];return g/S>o.aspect?g/(2*Math.tan(.5*o.fovX)*o.aspect):S/(2*Math.tan(.5*o.fovY)*o.aspect)}_cameraForBoundsOnGlobe(o,d,g,S,C,M){const L=o.clone(),B=this._extendCameraOptions(M);L.bearing=S,L.pitch=C;const q=i.cd.convert(d),X=i.cd.convert(g),ee=.5*(q.lat+X.lat),Q=.5*(q.lng+X.lng),ne=i.eC(ee,Q),fe=i.au([],ne),de=i.au([],i.bG([],fe,[0,1,0])),ye=i.bG([],de,fe),he=[de[0],de[1],de[2],0,ye[0],ye[1],ye[2],0,fe[0],fe[1],fe[2],0,0,0,0,1],Se=[ne,i.eC(q.lat,q.lng),i.eC(X.lat,q.lng),i.eC(X.lat,X.lng),i.eC(q.lat,X.lng),i.eC(ee,q.lng),i.eC(ee,X.lng),i.eC(q.lat,Q),i.eC(X.lat,Q)];let Ae=i.cV.fromPoints(Se.map(vt=>[i.bE(de,vt),i.bE(ye,vt),i.bE(fe,vt)]));const Pe=i.ad([],Ae.center,he);i.eD(Pe)===0&&i.eE(Pe,0,0,1),i.au(Pe,Pe),i.b$(Pe,Pe,i.aE),L.center=i.eF(Pe);const Be=L.getWorldToCameraMatrix(),Fe=i.bi(new Float64Array(16),Be);Ae=i.cV.applyTransform(Ae,i.az([],Be,he));const je=this._extendAABB(Ae,L,B,S);if(!je)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Ae=je,i.ad(Pe,Pe,Be);const ke=.5*(Ae.max[2]-Ae.min[2]),qe=this._minimumAABBFrustumDistance(L,Ae),Ze=i.b$([],[0,0,1],ke),yt=i.cU(Ze,Pe,Ze),ut=qe+(L.pitch===0?0:i.bD(Pe,yt)),At=L.globeCenterInViewSpace,Mt=i.at([],Pe,[At[0],At[1],At[2]]);i.au(Mt,Mt),i.b$(Mt,Mt,ut);const Zt=i.cU([],Pe,Mt);i.ad(Zt,Zt,Fe);const at=i.eq/i.aE,gt=i.ae(Zt),ot=i.c6(Math.max(gt*at-i.eq,Number.EPSILON),0),Lt=Math.min(L.zoomFromMercatorZAdjusted(ot),B.maxZoom);return Lt>.5*(i.cL+i.cx)?(L.setProjection({name:"mercator"}),L.zoom=Lt,this._cameraForBounds(L,d,g,S,C,M)):{center:L.center,zoom:Lt,bearing:S,pitch:C}}_extendAABB(o,d,g,S){const C=.5*((g.padding.left||0)+(g.padding.right||0)),M=.5*((g.padding.top||0)+(g.padding.bottom||0)),L=M,B=C,q=C,X=M,ee=d.width-(B+q),Q=d.height-(L+X),ne=i.at([],o.max,o.min),fe=Math.min(ee/ne[0],Q/ne[1]),de=Math.min(d.scaleZoom(d.scale*fe),g.maxZoom);if(isNaN(de))return null;const ye=d.scale/d.zoomScale(de),he=new i.cV([o.min[0]-B*ye,o.min[1]-X*ye,o.min[2]],[o.max[0]+q*ye,o.max[1]+L*ye,o.max[2]]),Se=(typeof g.offset.x=="number"&&typeof g.offset.y=="number"?new i.P(g.offset.x,g.offset.y):i.P.convert(g.offset)).rotate(-i.al(S));return he.center[0]-=Se.x*ye,he.center[1]+=Se.y*ye,he}queryTerrainElevation(o,d){const g=this.transform.elevation;return g?(d=i.l({},{exaggerated:!0},d),g.getAtPoint(i.ac.fromLngLat(o),null,d.exaggerated)):null}_cameraForBounds(o,d,g,S,C,M){if(o.projection.name==="globe")return this._cameraForBoundsOnGlobe(o,d,g,S,C,M);const L=o.clone(),B=this._extendCameraOptions(M);L.bearing=S,L.pitch=C;const q=i.cd.convert(d),X=i.cd.convert(g),ee=new i.cd(q.lng,X.lat),Q=new i.cd(X.lng,q.lat),ne=L.project(q),fe=L.project(X),de=this.queryTerrainElevation(q),ye=this.queryTerrainElevation(X),he=this.queryTerrainElevation(ee),Se=this.queryTerrainElevation(Q),Ae=[[ne.x,ne.y,Math.min(de||0,ye||0,he||0,Se||0)],[fe.x,fe.y,Math.max(de||0,ye||0,he||0,Se||0)]];let Pe=i.cV.fromPoints(Ae);const Be=L.getWorldToCameraMatrix(),Fe=i.bi(new Float64Array(16),Be);Pe=i.cV.applyTransform(Pe,Be);const je=this._extendAABB(Pe,L,B,S);if(!je)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Pe=je;const ke=.5*i.at([],Pe.max,Pe.min)[2],qe=this._minimumAABBFrustumDistance(L,Pe),Ze=[0,0,1,0];i.aA(Ze,Ze,Be),i.eG(Ze,Ze);const yt=i.b$([],Ze,qe+ke),ut=i.cU([],Pe.center,yt);i.ad(Pe.center,Pe.center,Fe),i.ad(ut,ut,Fe);const At=L.unproject(new i.P(Pe.center[0],Pe.center[1])),Mt=i.eH(L.projection,At),Zt=Math.pow(2,Mt),at=Math.min(L._zoomFromMercatorZ(ut[2]*L.pixelsPerMeter*Zt/L.worldSize),B.maxZoom);return L.mercatorFromTransition&&at<.5*(i.cL+i.cx)?(L.setProjection({name:"globe"}),L.zoom=at,this._cameraForBounds(L,d,g,S,C,M)):{center:At,zoom:at,bearing:S,pitch:C}}fitBounds(o,d,g){const S=this.cameraForBounds(o,d);return this._fitInternal(S,d,g)}fitScreenCoordinates(o,d,g,S,C){const M=i.P.convert(o),L=i.P.convert(d),B=new i.P(Math.min(M.x,L.x),Math.min(M.y,L.y)),q=new i.P(Math.max(M.x,L.x),Math.max(M.y,L.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(M,L))return this;const X=this.transform.pointLocation3D(B),ee=this.transform.pointLocation3D(q),Q=this.transform.pointLocation3D(new i.P(B.x,q.y)),ne=this.transform.pointLocation3D(new i.P(q.x,B.y)),fe=[Math.min(X.lng,ee.lng,Q.lng,ne.lng),Math.min(X.lat,ee.lat,Q.lat,ne.lat)],de=[Math.max(X.lng,ee.lng,Q.lng,ne.lng),Math.max(X.lat,ee.lat,Q.lat,ne.lat)],ye=S&&S.pitch?S.pitch:this.getPitch(),he=this._cameraForBounds(this.transform,fe,de,g,ye,S);return this._fitInternal(he,S,C)}_fitInternal(o,d,g){return o?(d=i.l(o,d)).linear?this.easeTo(d,g):this.flyTo(d,g):this}jumpTo(o,d){this.stop();const g=o.preloadOnly?this.transform.clone():this.transform;let S=!1,C=!1,M=!1;"zoom"in o&&g.zoom!==+o.zoom&&(S=!0,g.zoom=+o.zoom),o.center!==void 0&&(g.center=i.cd.convert(o.center)),"bearing"in o&&g.bearing!==+o.bearing&&(C=!0,g.bearing=+o.bearing),"pitch"in o&&g.pitch!==+o.pitch&&(M=!0,g.pitch=+o.pitch);const L=typeof o.padding=="number"?this._extendPadding(o.padding):o.padding;if(o.padding!=null&&!g.isPaddingEqual(L))if(o.retainPadding===!1){const B=g.clone();B.padding=L,g.setLocationAtPoint(g.center,B.centerPoint)}else g.padding=L;return o.preloadOnly?(this._preloadTiles(g),this):(this.fire(new i.A("movestart",d)).fire(new i.A("move",d)),S&&this.fire(new i.A("zoomstart",d)).fire(new i.A("zoom",d)).fire(new i.A("zoomend",d)),C&&this.fire(new i.A("rotatestart",d)).fire(new i.A("rotate",d)).fire(new i.A("rotateend",d)),M&&this.fire(new i.A("pitchstart",d)).fire(new i.A("pitch",d)).fire(new i.A("pitchend",d)),this.fire(new i.A("moveend",d)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(jd),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,d){const g=this.transform;if(!g.projection.supportsFreeCamera)return i.w(jd),this;this.stop();const S=g.zoom,C=g.pitch,M=g.bearing;g.setFreeCameraOptions(o);const L=S!==g.zoom,B=C!==g.pitch,q=M!==g.bearing;return this.fire(new i.A("movestart",d)).fire(new i.A("move",d)),L&&this.fire(new i.A("zoomstart",d)).fire(new i.A("zoom",d)).fire(new i.A("zoomend",d)),q&&this.fire(new i.A("rotatestart",d)).fire(new i.A("rotate",d)).fire(new i.A("rotateend",d)),B&&this.fire(new i.A("pitchstart",d)).fire(new i.A("pitch",d)).fire(new i.A("pitchend",d)),this.fire(new i.A("moveend",d)),this}easeTo(o,d){this._stop(!1,o.easeId),((o=i.l({offset:[0,0],duration:500,easing:i.ey},o)).animate===!1||this._prefersReducedMotion(o))&&(o.duration=0);const g=this.transform,S=this.getZoom(),C=this.getBearing(),M=this.getPitch(),L=this.getPadding(),B="zoom"in o?+o.zoom:S,q="bearing"in o?this._normalizeBearing(o.bearing,C):C,X="pitch"in o?+o.pitch:M,ee=this._extendPadding(o.padding),Q=i.P.convert(o.offset);let ne,fe,de;if(g.projection.name==="globe"){const Ze=i.ac.fromLngLat(g.center),yt=Q.rotate(-g.angle);Ze.x+=yt.x/g.worldSize,Ze.y+=yt.y/g.worldSize;const ut=Ze.toLngLat(),At=i.cd.convert(o.center||ut);this._normalizeCenter(At),ne=g.centerPoint.add(yt),fe=new i.P(Ze.x,Ze.y).mult(g.worldSize),de=new i.P(i.ay(At.lng),i.aH(At.lat)).mult(g.worldSize).sub(fe)}else{ne=g.centerPoint.add(Q);const Ze=g.pointLocation(ne),yt=i.cd.convert(o.center||Ze);this._normalizeCenter(yt),fe=g.project(Ze),de=g.project(yt).sub(fe)}const ye=g.zoomScale(B-S);let he,Se;o.around&&(he=i.cd.convert(o.around),Se=g.locationPoint(he));const Ae=this._zooming||B!==S,Pe=this._rotating||C!==q,Be=this._pitching||X!==M,Fe=!g.isPaddingEqual(ee),je=o.retainPadding===!1?g.clone():g,ke=Ze=>yt=>{if(Ae&&(Ze.zoom=i.ai(S,B,yt)),Pe&&(Ze.bearing=i.ai(C,q,yt)),Be&&(Ze.pitch=i.ai(M,X,yt)),Fe&&(je.interpolatePadding(L,ee,yt),ne=je.centerPoint.add(Q)),he)Ze.setLocationAtPoint(he,Se);else{const ut=Ze.zoomScale(Ze.zoom-S),At=B>S?Math.min(2,ye):Math.max(.5,ye),Mt=Math.pow(At,1-yt),Zt=Ze.unproject(fe.add(de.mult(yt*Mt)).mult(ut));Ze.setLocationAtPoint(Ze.renderWorldCopies?Zt.wrap():Zt,ne)}return o.preloadOnly||this._fireMoveEvents(d),Ze};if(o.preloadOnly){const Ze=this._emulate(ke,o.duration,g);return this._preloadTiles(Ze),this}const qe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Ae,this._rotating=Pe,this._pitching=Be,this._padding=Fe,this._easeId=o.easeId,this._prepareEase(d,o.noMoveStart,qe),this._ease(ke(g),Ze=>{g.cameraElevationReference==="sea"&&g.recenterOnTerrain(),this._afterEase(d,Ze)},o),this}_prepareEase(o,d,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),d||g.moving||this.fire(new i.A("movestart",o)),this._zooming&&!g.zooming&&this.fire(new i.A("zoomstart",o)),this._rotating&&!g.rotating&&this.fire(new i.A("rotatestart",o)),this._pitching&&!g.pitching&&this.fire(new i.A("pitchstart",o))}_fireMoveEvents(o){this.fire(new i.A("move",o)),this._zooming&&this.fire(new i.A("zoom",o)),this._rotating&&this.fire(new i.A("rotate",o)),this._pitching&&this.fire(new i.A("pitch",o))}_afterEase(o,d){if(this._easeId&&d&&this._easeId===d)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const g=this._zooming,S=this._rotating,C=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new i.A("zoomend",o)),S&&this.fire(new i.A("rotateend",o)),C&&this.fire(new i.A("pitchend",o)),this.fire(new i.A("moveend",o))}flyTo(o,d){if(this._prefersReducedMotion(o)){const vt=i.aF(o,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(vt,d)}this.stop(),o=i.l({offset:[0,0],speed:1.2,curve:1.42,easing:i.ey},o);const g=this.transform,S=this.getZoom(),C=this.getBearing(),M=this.getPitch(),L=this.getPadding(),B="zoom"in o?i.aD(+o.zoom,g.minZoom,g.maxZoom):S,q="bearing"in o?this._normalizeBearing(o.bearing,C):C,X="pitch"in o?+o.pitch:M,ee=this._extendPadding(o.padding),Q=g.zoomScale(B-S),ne=i.P.convert(o.offset);let fe=g.centerPoint.add(ne);const de=g.pointLocation(fe),ye=i.cd.convert(o.center||de);this._normalizeCenter(ye);const he=g.project(de),Se=g.project(ye).sub(he);let Ae=o.curve;const Pe=Math.max(g.width,g.height),Be=Pe/Q,Fe=Se.mag();if("minZoom"in o){const vt=i.aD(Math.min(o.minZoom,S,B),g.minZoom,g.maxZoom),zt=Pe/g.zoomScale(vt-S);Ae=Math.sqrt(zt/Fe*2)}const je=Ae*Ae;function ke(vt){const zt=(Be*Be-Pe*Pe+(vt?-1:1)*je*je*Fe*Fe)/(2*(vt?Be:Pe)*je*Fe);return Math.log(Math.sqrt(zt*zt+1)-zt)}function qe(vt){return(Math.exp(vt)-Math.exp(-vt))/2}function Ze(vt){return(Math.exp(vt)+Math.exp(-vt))/2}const yt=ke(0);let ut=function(vt){return Ze(yt)/Ze(yt+Ae*vt)},At=function(vt){return Pe*((Ze(yt)*(qe(zt=yt+Ae*vt)/Ze(zt))-qe(yt))/je)/Fe;var zt},Mt=(ke(1)-yt)/Ae;if(Math.abs(Fe)<1e-6||!isFinite(Mt)){if(Math.abs(Pe-Be)<1e-6)return this.easeTo(o,d);const vt=Be<Pe?-1:1;Mt=Math.abs(Math.log(Be/Pe))/Ae,At=function(){return 0},ut=function(zt){return Math.exp(vt*Ae*zt)}}o.duration="duration"in o?+o.duration:1e3*Mt/("screenSpeed"in o?+o.screenSpeed/Ae:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const Zt=C!==q,at=X!==M,gt=!g.isPaddingEqual(ee),ot=o.retainPadding===!1?g.clone():g,Lt=vt=>zt=>{const Ot=zt*Mt,$t=1/ut(Ot);vt.zoom=zt===1?B:S+vt.scaleZoom($t),Zt&&(vt.bearing=i.ai(C,q,zt)),at&&(vt.pitch=i.ai(M,X,zt)),gt&&(ot.interpolatePadding(L,ee,zt),fe=ot.centerPoint.add(ne));const Ut=zt===1?ye:vt.unproject(he.add(Se.mult(At(Ot))).mult($t));return vt.setLocationAtPoint(vt.renderWorldCopies?Ut.wrap():Ut,fe),vt._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(d),vt};if(o.preloadOnly){const vt=this._emulate(Lt,o.duration,g);return this._preloadTiles(vt),this}return this._zooming=!0,this._rotating=Zt,this._pitching=at,this._padding=gt,this._prepareEase(d,!1),this._ease(Lt(g),()=>this._afterEase(d),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(o){}_cancelRenderFrame(o){}_stop(o,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,d)}if(!o){const g=this.handlers;g&&g.stop(!1)}return this}_ease(o,d,g){g.animate===!1||g.duration===0?(o(1),d()):(this._easeStart=i.q.now(),this._easeOptions=g,this._onEaseFrame=o,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((i.q.now()-this._easeStart)/this._easeOptions.duration,1),d=this._onEaseFrame;d&&d(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,d){o=i.bX(o,-180,180);const g=Math.abs(o-d);return Math.abs(o-360-d)<g&&(o-=360),Math.abs(o+360-d)<g&&(o+=360),o}_normalizeCenter(o){const d=this.transform;if(d.maxBounds||d.projection.name!=="globe"&&!d.renderWorldCopies)return;const g=o.lng-d.center.lng;o.lng+=g>180?-360:g<-180?360:0}_prefersReducedMotion(o){return this._respectPrefersReducedMotion&&i.q.prefersReducedMotion&&!(o&&o.essential)}_emulate(o,d,g){const S=Math.ceil(15*d/1e3),C=[],M=o(g.clone());for(let L=0;L<=S;L++){const B=M(L/S);C.push(B.clone())}return C}_preloadTiles(o,d){}}class np{constructor(o={}){this.options=o,i.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const d=this.options&&this.options.compact,g=o._getUIString("AttributionControl.ToggleAttribution");this._map=o,this._container=O("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=O("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",g);const S=O("span","mapboxgl-ctrl-icon",this._compactButton);return S.setAttribute("aria-hidden","true"),S.setAttribute("title",g),this._innerContainer=O("div","mapboxgl-ctrl-attrib-inner",this._container),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.e.ACCESS_TOKEN}];if(o){const g=d.reduce((S,C,M)=>(C.value&&(S+=`${C.key}=${C.value}${M<d.length-1?"&":""}`),S),"?");o.href=`${i.e.FEEDBACK_URL}/${g}#${Hf(this._map,!0)}`,o.rel="noopener nofollow"}}_updateData(o){!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const S=this._map.style.stylesheet;this.styleOwner=S.owner,this.styleId=S.id}const d=this._map.style._mergedSourceCaches;for(const S in d){const C=d[S];if(C.used){const M=C.getSource();M.attribution&&o.indexOf(M.attribution)<0&&o.push(M.attribution)}}o.sort((S,C)=>S.length-C.length),o=o.filter((S,C)=>{for(let M=C+1;M<o.length;M++)if(o[M].indexOf(S)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const g=o.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,o.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Gh{constructor(){i.aV(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=O("div","mapboxgl-ctrl");const d=O("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&o.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(Object.entries(o).length===0)return!0;for(const d in o){const g=o[d].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const d=o[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}}}class Ta{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const d=++this._id;return this._queue.push({callback:o,id:d,cancelled:!1}),d}remove(o){const d=this._currentlyRunning,g=d?this._queue.concat(d):this._queue;for(const S of g)if(S.id===o)return void(S.cancelled=!0)}run(o=0){const d=this._currentlyRunning=this._queue;this._queue=[];for(const g of d)if(!g.cancelled&&(g.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class mo{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const d=i.dk((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-d)+this._end*d}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,d,g){this._start=this.getValue(d),this._end=o,this._startTime=d,this._endTime=d+g}}const ws={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Ol extends i.A{constructor(o,d,g,S){const{point:C,lngLat:M,originalEvent:L,target:B}=o;super(o.type,{point:C,lngLat:M,originalEvent:L,target:B}),this.preventDefault=()=>{o.preventDefault()},this.id=d,this.interaction=g,this.feature=S}}class Du{constructor(o){this.map=o,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(o,d){if(this.typeById.has(o))throw new Error(`Interaction id "${o}" already exists.`);const g=d.filter;let S=d.type;g&&this.filters.set(o,i.b3(g)),S==="mouseover"&&(S="mouseenter"),S==="mouseout"&&(S="mouseleave");const C=this.interactionsByType.get(S)||new Map;S==="mouseenter"||S==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(o,d)):C.size===0&&this.map.on(S,this.handleType),C.size===0&&this.interactionsByType.set(S,C),C.set(o,d),this.typeById.set(o,S)}get(o){const d=this.typeById.get(o);if(!d)return;const g=this.interactionsByType.get(d);return g?g.get(o):void 0}remove(o){const d=this.typeById.get(o);if(!d)return;this.typeById.delete(o),this.filters.delete(o);const g=this.interactionsByType.get(d);g&&(g.delete(o),d==="mouseenter"||d==="mouseleave"?(this.delegatedInteractions.delete(o),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):g.size===0&&this.map.off(d,this.handleType))}queryTargets(o,d){const g=[];for(const[S,C]of d)C.target&&g.push({targetId:S,target:C.target,filter:this.filters.get(S)});return this.map.style.queryRenderedTargets(o,g,this.map.transform)}handleMove(o){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const d=this.queryTargets(o.point,Array.from(this.delegatedInteractions).reverse());d.length&&(o.type="mouseenter",this.handleType(o,d));const g=new Map;for(const[S,{feature:C}]of this.prevHoveredFeatures)this.hoveredFeatures.has(S)||g.set(C.id,C);g.size&&(o.type="mouseleave",this.handleType(o,Array.from(g.values())))}handleOut(o){const d=Array.from(this.hoveredFeatures.values()).map(({feature:g})=>g);d.length&&(o.type="mouseleave",this.handleType(o,d)),this.hoveredFeatures.clear()}handleType(o,d){const g=Array.from(this.interactionsByType.get(o.type)).reverse(),S=!!d;d=d||this.queryTargets(o.point,g);const C=o.type==="mouseenter";let M=!1;const L=new Set;for(const B of d){for(const[q,X]of g){if(!X.target)continue;const ee=B.variants?B.variants[q]:null;if(ee){for(const Q of ee){if(Pc(Q,B,L,q))continue;const ne=new i.df(B,Q),fe=id(Q,B,q);S&&(ne.state=this.map.getFeatureState(ne));const de=C?this.prevHoveredFeatures.get(fe):null,ye=new Ol(o,q,X,ne),he=de?de.stop:X.handler(ye);if(C&&this.hoveredFeatures.set(fe,{feature:B,stop:he}),he!==!1){M=!0;break}}if(M)break}}if(M)break}if(!M)for(const[B,q]of g){const{handler:X,target:ee}=q;if(!ee&&X(new Ol(o,B,q,null))!==!1)break}}}function go(m,o){if(Array.isArray(m)&&Array.isArray(o)){const d=new Set(m),g=new Set(o);return d.size===g.size&&m.every(S=>g.has(S))}return i.bv(m,o)}const Ky={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},hn={showCompass:!0,showZoom:!0,visualizePitch:!1};class uc{constructor(o,d,g=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new Jf({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,g&&(this.mousePitch=new ju({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),i.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),d.addEventListener("mousedown",this.mousedown),d.addEventListener("touchstart",this.touchstart,{passive:!1}),d.addEventListener("touchmove",this.touchmove),d.addEventListener("touchend",this.touchend),d.addEventListener("touchcancel",this.reset)}down(o,d){this.mouseRotate.mousedown(o,d),this.mousePitch&&this.mousePitch.mousedown(o,d),J()}move(o,d){const g=this.map,S=this.mouseRotate.mousemoveWindow(o,d),C=S&&S.bearingDelta;if(C&&g.setBearing(g.getBearing()+C),this.mousePitch){const M=this.mousePitch.mousemoveWindow(o,d),L=M&&M.pitchDelta;L&&g.setPitch(g.getPitch()+L)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){G(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(i.l({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),ce(this.element,o)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,ce(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ge(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=ge(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function hm(m,o,d){if(m=new i.cd(m.lng,m.lat),o){const g=new i.cd(m.lng-360,m.lat),S=new i.cd(m.lng+360,m.lat),C=360*Math.ceil(Math.abs(m.lng-d.center.lng)/360),M=d.locationPoint3D(m).distSqr(o),L=o.x<0||o.y<0||o.x>d.width||o.y>d.height;d.locationPoint3D(g).distSqr(o)<M&&(L||Math.abs(g.lng-d.center.lng)<C)?m=g:d.locationPoint3D(S).distSqr(o)<M&&(L||Math.abs(S.lng-d.center.lng)<C)&&(m=S)}for(;Math.abs(m.lng-d.center.lng)>180;){const g=d.locationPoint3D(m);if(g.x>=0&&g.y>=0&&g.x<=d.width&&g.y<=d.height)break;m.lng>d.center.lng?m.lng-=360:m.lng+=360}return m}const fm={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},ll={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Xc extends i.E{constructor(o,d){super(),(o instanceof HTMLElement||d)&&(o=i.l({element:o},d)),i.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:g="center",color:S="#3FB1CE",scale:C=1,draggable:M=!1,clickTolerance:L=0,rotation:B=ll.rotation,rotationAlignment:q=ll.rotationAlignment,pitchAlignment:X=ll.pitchAlignment,occludedOpacity:ee=ll.occludedOpacity,altitude:Q=ll.altitude}=o||{};this._anchor=g,this._color=S,this._scale=C,this._draggable=M,this._clickTolerance=L,this._rotation=B,this._rotationAlignment=q,this._pitchAlignment=X,this._occludedOpacity=ee,this._altitude=Q,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),o&&o.element?(this._element=o.element,this._offset=i.P.convert(o&&o.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=i.P.convert(o&&o.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",de=>{de.preventDefault()}),this._element.addEventListener("mousedown",de=>{de.preventDefault()});const ne=this._element.classList;for(const de in fm)ne.remove(`mapboxgl-marker-anchor-${de}`);ne.add(`mapboxgl-marker-anchor-${this._anchor}`);const fe=o&&o.className?o.className.trim().split(/\s+/):[];ne.add(...fe),this._popup=null}_createDefaultMarker(){const o=O("div"),d=N("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},o);if(this._altitude===0){const g=N("radialGradient",{id:"shadowGradient"},N("defs",{},d));N("stop",{offset:"10%","stop-opacity":.4},g),N("stop",{offset:"100%","stop-opacity":.05},g),N("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},d)}return N("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},d),N("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},d),N("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},d),o}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){const o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=i.cd.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(o){return o===this._altitude||(this._defaultMarker&&(this._altitude===0&&o!==0||this._altitude!==0&&o===0)&&(this._element=this._createDefaultMarker()),this._altitude=o||ll.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const S=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[S,-1*(38.1-13.5+S)],"bottom-right":[-S,-1*(38.1-13.5+S)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,o._marker=this,o._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const d=o.code,g=o.charCode||o.keyCode;d!=="Space"&&d!=="Enter"&&g!==32&&g!==13||this.togglePopup()}_onMapClick(o){const d=o.originalEvent.target,g=this._element;this._popup&&(d===g||g.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const o=this._map,d=this._pos;if(!o||!d)return!1;const g=o.unproject(d,this._altitude),S=o.getFreeCameraOptions();if(!S.position)return!1;const C=S.position.toLngLat();return C.distanceTo(g)<.9*C.distanceTo(this._lngLat)}_evaluateOpacity(){const o=this._map;if(!o)return;const d=this._pos;if(!d||d.x<0||d.x>o.transform.width||d.y<0||d.y>o.transform.height)return void this._clearFadeTimer();const g=o.unproject(d,this._altitude);let S;o._showingGlobe()&&i.eK(o.transform,this._lngLat)?S=0:(S=1-o._queryFogOpacity(g),o.transform._terrainEnabled()&&o.getTerrain()&&this._behindTerrain()&&(S*=this._occludedOpacity)),this._element.style.opacity=`${S}`,this._element.style.pointerEvents=S>0?"auto":"none",this._popup&&this._popup._setOpacity(S),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const o=this._pos;if(!o||!this._map)return;const d=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${o.x}px,${o.y}px)
            ${fm[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${d.x}px,${d.y}px)
        `}_calculateXYTransform(){const o=this._pos,d=this._map,g=this.getPitchAlignment();if(!d||!o||g!=="map")return"";if(!d._showingGlobe()){const B=d.getPitch();return B?`rotateX(${B}deg)`:""}const S=i.cJ(i.eL(d.transform,this._lngLat)),C=o.sub(i.eM(d.transform)),M=Math.abs(C.x)+Math.abs(C.y);if(M===0)return"";const L=S/M;return`rotateX(${-C.y*L}deg) rotateY(${C.x*L}deg)`}_calculateZTransform(){const o=this._pos,d=this._map;if(!d||!o)return"";let g=0;const S=this.getRotationAlignment();if(S==="map")if(d._showingGlobe()){const C=d.project(new i.cd(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),M=d.project(new i.cd(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(C);g=i.cJ(Math.atan2(M.y,M.x))-90}else g=-d.getBearing();else if(S==="horizon"){const C=i.af(4,6,d.getZoom()),M=i.eM(d.transform);M.y+=C*d.transform.height;const L=o.sub(M),B=i.cJ(Math.atan2(L.y,L.x));g=(B>90?B-270:B+90)*(1-C)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(o){cancelAnimationFrame(this._updateFrameId);const d=this._map;d&&(d.transform.renderWorldCopies&&(this._lngLat=hm(this._lngLat,this._pos,d.transform)),this._pos=d.project(this._lngLat,this._altitude),o===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),d._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(d._showingGlobe()||d.getTerrain()||d.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=i.P.convert(o),this._update(),this}addClassName(o){return this._element.classList.add(o),this}removeClassName(o){return this._element.classList.remove(o),this}toggleClassName(o){return this._element.classList.toggle(o)}_onMove(o){const d=this._map;if(!d)return;const g=this._pointerdownPos,S=this._positionDelta;if(g&&S){if(!this._isDragging){const C=this._clickTolerance||d._clickTolerance;if(o.point.dist(g)<C)return;this._isDragging=!0}this._pos=o.point.sub(S),this._lngLat=d.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.A("dragstart"))),this.fire(new i.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.A("dragend")),this._state="inactive"}_addDragHandler(o){const d=this._map,g=this._pos;d&&g&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(g),this._pointerdownPos=o.point,this._state="pending",d.on("mousemove",this._onMove),d.on("touchmove",this._onMove),d.once("mouseup",this._onUp),d.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;const d=this._map;return d&&(o?(d.on("mousedown",this._addDragHandler),d.on("touchstart",this._addDragHandler)):(d.off("mousedown",this._addDragHandler),d.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||ll.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||ll.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o||ll.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(o){return this._occludedOpacity=o||ll.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Nu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},zu={maxWidth:100,unit:"metric"},dc={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},cl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},ul=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function hc(m=new i.P(0,0),o="bottom"){if(typeof m=="number"){const d=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(o){case"top":return new i.P(0,m);case"top-left":return new i.P(d,d);case"top-right":return new i.P(-d,d);case"bottom":return new i.P(0,-m);case"bottom-left":return new i.P(d,-d);case"bottom-right":return new i.P(-d,-d);case"left":return new i.P(m,0);case"right":return new i.P(-m,0)}return new i.P(0,0)}return m instanceof i.P||Array.isArray(m)?i.P.convert(m):i.P.convert(m[o]||[0,0])}return{version:y,supported:D.supported,setRTLTextPlugin:i.eN,getRTLTextPluginStatus:i.eO,Map:class extends dm{constructor(m){T.mark(w.create);const o=m;if((m=i.l({},Ky,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&i.eI(window)&&(m.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new yu(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies,null,null),m),this._repaint=!!m.repaint,this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new Ta,this._domRenderTaskQueue=new Ta,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.a$(),this._locale=i.l({},ws,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._tessellationStep=m.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=m.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new mo(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=m.scaleFactor,this._requestManager=new Xe(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,this._contextCreateOptions=m.contextCreateOptions?Object.assign({},m.contextCreateOptions):{},typeof m.container=="string"){const d=document.getElementById(m.container);if(!d)throw new Error(`Container '${m.container.toString()}' not found.`);this._container=d}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),this._spriteFormat=m.spriteFormat,i.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Yp),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new e0(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,(m.style||!m.testMode)&&this.setStyle(m.style||i.e.DEFAULT_STYLE,{config:m.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),this.indoor=new $y(this),m.hash&&(this._hash=new Bh(typeof m.hash=="string"&&m.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){o.center==null&&o.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch});const d=m.bounds;d&&(this.resize(),this.fitBounds(d,i.l({},m.fitBoundsOptions,{duration:0})))}this.resize(),m.attributionControl&&this.addControl(new np({customAttribution:m.customAttribution})),this._logoControl=new Gh,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",d=>{this._update(d.dataType==="style"),this.fire(new i.A(`${d.dataType}data`,d))}),this.on("dataloading",d=>{this.fire(new i.A(`${d.dataType}dataloading`,d))}),this._interactions=new Du(this)}_getMapId(){return this._mapId}addControl(m,o){if(o===void 0&&(o=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new i.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=m.onAdd(this);this._controls.push(m);const g=this._controlPositions[o];return o.indexOf("bottom")!==-1?g.insertBefore(d,g.firstChild):g.appendChild(d),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new i.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(m);return o>-1&&this._controls.splice(o,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new i.A("movestart",m)).fire(new i.A("move",m)),this.fire(new i.A("resize",m)),o&&this.fire(new i.A("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(i.aG.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new i.A("zoomstart")).fire(new i.A("zoom")).fire(new i.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new i.A("zoomstart")).fire(new i.A("zoom")).fire(new i.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new i.A("pitchstart")).fire(new i.A("pitch")).fire(new i.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new i.A("pitchstart")).fire(new i.A("pitch")).fire(new i.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(m){return this._scaleFactor=m,this.painter.scaleFactor=m,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(o=>o.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return m==="auto"?navigator.language:Array.isArray(m)?m.length===0?void 0:m.map(o=>o==="auto"?navigator.language:o):m}setLanguage(m){const o=this._parseLanguage(m);if(!this.style||o===this._language)return this;this._language=o,this.style.reloadSources();for(const d of this._controls)d._setLanguage&&d._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(m){return this._lazyInitEmptyStyle(),m?typeof m=="string"&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const m=this.transform,o=m.projection.name;let d;o==="globe"&&m.zoom>=i.cx?(m.setMercatorFromTransition(),d=!0):o==="mercator"&&m.zoom<i.cx&&(m.setProjection({name:"globe"}),d=!0),d&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(m,o){return this._updateProjection(m||o||{name:"mercator"})}_updateProjection(m){let o;return o=m.name==="globe"&&this.transform.zoom>=i.cx?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate(),o&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(m,o){return this.transform.locationPoint3D(i.cd.convert(m),o)}unproject(m,o){return this.transform.pointLocation3D(i.P.convert(m),o)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,o,d){const g=S=>{let C=[];if(Array.isArray(o)){const M=o.filter(L=>this.getLayer(L));C=M.length?this.queryRenderedFeatures(S,{layers:M}):[]}else C=this.queryRenderedFeatures(S,{target:o});return C};if(m==="mouseenter"||m==="mouseover"){let S=!1;return{listener:d,targets:o,delegates:{mousemove:M=>{const L=g(M.point);L.length?S||(S=!0,d.call(this,new pa(m,this,M.originalEvent,{features:L}))):S=!1},mouseout:()=>{S=!1}}}}if(m==="mouseleave"||m==="mouseout"){let S=!1;return{listener:d,targets:o,delegates:{mousemove:L=>{g(L.point).length?S=!0:S&&(S=!1,d.call(this,new pa(m,this,L.originalEvent)))},mouseout:L=>{S&&(S=!1,d.call(this,new pa(m,this,L.originalEvent)))}}}}{const S=C=>{const M=g(C.point);M.length&&(C.features=M,d.call(this,C),delete C.features)};return{listener:d,targets:o,delegates:{[m]:S}}}}on(m,o,d){if(typeof o=="function"||d===void 0)return super.on(m,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const g=this._createDelegatedListener(m,o,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(g);for(const S in g.delegates)this.on(S,g.delegates[S]);return this}once(m,o,d){if(typeof o=="function"||d===void 0)return super.once(m,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const g=this._createDelegatedListener(m,o,d);for(const S in g.delegates)this.once(S,g.delegates[S]);return this}off(m,o,d){if(typeof o=="function"||d===void 0)return super.off(m,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const g=this._delegatedListeners?this._delegatedListeners[m]:void 0;return g&&(S=>{for(let C=0;C<S.length;C++){const M=S[C];if(M.listener===d&&go(M.targets,o)){for(const L in M.delegates)this.off(L,M.delegates[L]);return S.splice(C,1),this}}})(g),this}queryRenderedFeatures(m,o){if(!this.style)return[];if(m===void 0||m instanceof i.P||Array.isArray(m)||o!==void 0||(o=m,m=void 0),m=m||[[0,0],[this.transform.width,this.transform.height]],!o){const C=this.style.queryRenderedFeatures(m,void 0,this.transform),M=this.style.queryRenderedFeatureset(m,void 0,this.transform);return C.concat(M)}let d=!0;if(o.target&&(d=this._isTargetValid(o.target),d&&!o.layers))return this.style.queryRenderedFeatureset(m,o,this.transform);let g=!0;if(o.layers&&Array.isArray(o.layers)){for(const C of o.layers)if(!this._isValidId(C)){g=!1;break}if(g&&!o.target)return this.style.queryRenderedFeatures(m,o,this.transform)}let S=[];return g&&(S=S.concat(this.style.queryRenderedFeatures(m,o,this.transform))),d&&(S=S.concat(this.style.queryRenderedFeatureset(m,o,this.transform))),S}querySourceFeatures(m,o){return!m||typeof m=="string"&&!this._isValidId(m)?[]:this.style.querySourceFeatures(m,o)}isPointOnSurface(m){const{name:o}=this.transform.projection;return o!=="globe"&&o!=="mercator"&&i.w(`${o} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(m))}addInteraction(m,o){return this._interactions.add(m,o),this}removeInteraction(m){return this._interactions.remove(m),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(m){return this._cooperativeGestures=m,this}setStyle(m,o){return o=i.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o),this.style&&m&&o.diff!==!1&&o.localFontFamily===this._localFontFamily&&o.localIdeographFontFamily===this._localIdeographFontFamily&&!o.config?(this.style._diffStyle(m,(d,g)=>{if(d){const S=typeof d=="string"?d:d instanceof Error?d.message:d.error;i.w(`Unable to perform style diff: ${S}. Rebuilding the style from scratch.`),this._updateStyle(m,o)}else g&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(m,o))}_getUIString(m){const o=this._locale[m];if(o==null)throw new Error(`Missing UI string '${m}'`);return o}_updateStyle(m,o){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m){const d=i.l({},o);o&&o.config&&(d.initialConfig=o.config,delete d.config),this.style=new il(this,d).load(m),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new il(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(m){return m==null?(this.fire(new i.z(new Error("IDs can't be empty."))),!1):!i.d9(m)||(this.fire(new i.z(new Error(`IDs can't contain special symbols: "${m}".`))),!1)}_isTargetValid(m){return"featuresetId"in m?this._isValidId("importId"in m?m.importId:m.featuresetId):"layerId"in m&&this._isValidId(m.layerId)}_areTargetsValid(m){if(Array.isArray(m)){for(const o of m)if(!this._isValidId(o))return!1;return!0}return this._isTargetValid(m)}addSource(m,o){return this._isValidId(m)?(this._lazyInitEmptyStyle(),this.style.addSource(m,o),this._update(!0)):this}isSourceLoaded(m){return!!this._isValidId(m)&&!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(m,o,d){this._lazyInitEmptyStyle(),this.style.addSourceType(m,o,d)}removeSource(m){return this._isValidId(m)?(this.style.removeSource(m),this._updateTerrain(),this._update(!0)):this}getSource(m){return this._isValidId(m)?this.style.getOwnSource(m):null}addImage(m,o,{pixelRatio:d=1,sdf:g=!1,stretchX:S,stretchY:C,content:M}={}){this._lazyInitEmptyStyle();const L=i.I.from(m);if(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap){const{width:B,height:q,data:X}=i.q.getImageData(o);this.style.addImage(L,{data:new i.r({width:B,height:q},X),pixelRatio:d,stretchX:S,stretchY:C,content:M,sdf:g,version:0,usvg:!1})}else if(o.width===void 0||o.height===void 0)this.fire(new i.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:B,height:q}=o,X=o;this.style.addImage(L,{data:new i.r({width:B,height:q},new Uint8Array(X.data)),pixelRatio:d,stretchX:S,stretchY:C,content:M,sdf:g,usvg:!1,version:0,userImage:X}),X.onAdd&&X.onAdd(this,m)}}updateImage(m,o){this._lazyInitEmptyStyle();const d=i.I.from(m),g=this.style.getImage(d);if(!g)return void this.fire(new i.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const S=o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap?i.q.getImageData(o):o,{width:C,height:M,data:L}=S;if(C===void 0||M===void 0)return void this.fire(new i.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(C!==(g.usvg?g.icon.usvg_tree.width:g.data.width)||M!==(g.usvg?g.icon.usvg_tree.height:g.data.height))return void this.fire(new i.z(new Error(`The width and height of the updated image (${C}, ${M})
                must be that same as the previous version of the image
                (${g.data.width}, ${g.data.height})`)));const B=!(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap);let q=!1;g.usvg?(g.data=new i.r({width:C,height:M},new Uint8Array(L)),g.usvg=!1,g.icon=void 0,q=!0):g.data.replace(L,B),this.style.updateImage(d,g,q)}hasImage(m){return m?!!this.style&&!!this.style.getImage(i.I.from(m)):(this.fire(new i.z(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(i.I.from(m))}loadImage(m,o){i.o(this._requestManager.transformRequest(m,i.R.Image),(d,g)=>{o(d,g instanceof HTMLImageElement?i.q.getImageData(g):g)})}listImages(){return this.style.listImages().map(m=>m.name)}addModel(m,o){this._lazyInitEmptyStyle(),this.style.addModel(m,o)}hasModel(m){return m?this.style.hasModel(m):(this.fire(new i.z(new Error("Missing required model id"))),!1)}removeModel(m){this.style.removeModel(m)}listModels(){return this.style.listModels()}addLayer(m,o){return this._isValidId(m.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(m,o),this._update(!0)):this}getSlot(m){const o=this.getLayer(m);return o&&o.slot||null}setSlot(m,o){return this.style.setSlot(m,o),this.style.mergeLayers(),this._update(!0)}addImport(m,o){return this.style.addImport(m,o).catch(d=>this.fire(new i.z(new Error("Failed to add import",d)))),this}updateImport(m,o){return typeof o!="string"&&o.id!==m?(this.removeImport(m),this.addImport(o)):(this.style.updateImport(m,o),this._update(!0))}removeImport(m){return this.style.removeImport(m),this}moveImport(m,o){return this.style.moveImport(m,o),this._update(!0)}moveLayer(m,o){return this._isValidId(m)?(this.style.moveLayer(m,o),this._update(!0)):this}removeLayer(m){return this._isValidId(m)?(this.style.removeLayer(m),this._update(!0)):this}getLayer(m){if(!this._isValidId(m))return null;const o=this.style.getOwnLayer(m);return o?o.type==="custom"?o.implementation:o.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(m,o,d){return this._isValidId(m)?(this.style.setLayerZoomRange(m,o,d),this._update(!0)):this}setFilter(m,o,d={}){return this._isValidId(m)?(this.style.setFilter(m,o,d),this._update(!0)):this}getFilter(m){return this._isValidId(m)?this.style.getFilter(m):null}setPaintProperty(m,o,d,g={}){return this._isValidId(m)?(this.style.setPaintProperty(m,o,d,g),this._update(!0)):this}getPaintProperty(m,o){return this._isValidId(m)?this.style.getPaintProperty(m,o):null}setLayoutProperty(m,o,d,g={}){return this._isValidId(m)?(this.style.setLayoutProperty(m,o,d,g),this._update(!0)):this}getLayoutProperty(m,o){return this._isValidId(m)?this.style.getLayoutProperty(m,o):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(m){return this.style.setGlyphsUrl(m),this._update(!0)}getSchema(m){return this.style.getSchema(m)}setSchema(m,o){return this.style.setSchema(m,o),this._update(!0)}getConfig(m){return this.style.getConfig(m)}setConfig(m,o){return this.style.setConfig(m,o),this._update(!0)}getConfigProperty(m,o){return this.style.getConfigProperty(m,o)}setConfigProperty(m,o,d){return this.style.setConfigProperty(m,o,d),this._update(!0)}getFeaturesetDescriptors(m){return this.style.getFeaturesetDescriptors(m)}setLights(m){if(this._lazyInitEmptyStyle(),m&&m.length===1&&m[0].type==="flat"){const o=m[0];o.properties?this.style.setFlatLight(o.properties,o.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(m),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const m=this.style.getLights()||[];return m.length===0&&m.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),m}setLight(m,o={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:m}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(m){return this._lazyInitEmptyStyle(),this.style.setSnow(m),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(m){return this._lazyInitEmptyStyle(),this.style.setRain(m),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(m){return this._lazyInitEmptyStyle(),this.style.setColorTheme(m),this._update(!0)}setImportColorTheme(m,o){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(m,o),this._update(!0)}setCamera(m){return this.style.setCamera(m),this._triggerCameraUpdate(m)}_triggerCameraUpdate(m){return this._update(this.transform.setOrthographicProjectionAtLowPitch(m["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.cd.convert(m),this.transform):0}setFeatureState(m,o){return m.source&&!this._isValidId(m.source)?this:(this.style.setFeatureState(m,o),this._update())}removeFeatureState(m,o){return m.source&&!this._isValidId(m.source)?this:(this.style.removeFeatureState(m,o),this._update())}getFeatureState(m){return m.source&&!this._isValidId(m.source)?null:this.style.getFeatureState(m)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let d,g,S,C=this._container;for(;C&&(!g||!S);){const M=window.getComputedStyle(C).transform;M&&M!=="none"&&(d=M.match(/matrix.*\((.+)\)/)[1].split(", "),d[0]&&d[0]!=="0"&&d[0]!=="1"&&(g=d[0]),d[3]&&d[3]!=="0"&&d[3]!=="1"&&(S=d[3])),C=C.parentElement}this._containerWidth=g?Math.abs(m/g):m,this._containerHeight=S?Math.abs(o/S):o}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=O("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=O("div","mapboxgl-canvas-container",m);this._canvas=O("canvas","mapboxgl-canvas",o),this._interactive&&(o.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const d=this._controlContainer=O("div","mapboxgl-control-container",m),g=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(S=>{g[S]=O("div",`mapboxgl-ctrl-${S}`,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,o){const d=i.q.devicePixelRatio||1;this._canvas.width=d*Math.ceil(m),this._canvas.height=d*Math.ceil(o),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${o}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const o=this._markers.indexOf(m);o!==-1&&this._markers.splice(o,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const o=this._popups.indexOf(m);o!==-1&&this._popups.splice(o,1)}_setupPainter(){const m=i.l({},D.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl2",m);o?(Jt(o,!0),this.painter=new Gf(o,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",d=>{d.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.m.testSupport(o)):this.fire(new i.z(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.A("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new i.A("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let o;this.fire(new i.A("renderstart")),++this._frameId;const d=this.painter.context.extTimerQuery,g=i.q.now(),S=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(o=S.createQuery(),S.beginQuery(d.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const C=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const q=this.transform.zoom,X=this.transform.pitch,ee=i.q.now(),Q=new i.aa(q,{now:ee,fadeDuration:C,pitch:X,transition:this.style.transition});this.style.update(Q)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let M=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),M=this._updateAverageElevation(g),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):M=this._updateAverageElevation(g);const L=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,C,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),L&&(this._placementDirty=L.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:C,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,T.mark(w.load),this.fire(new i.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){const q=i.q.now()-g;S.endQuery(d.TIME_ELAPSED_EXT),setTimeout(()=>{const X=S.getQueryParameter(o,S.QUERY_RESULT)/1e6;S.deleteQuery(o),this.fire(new i.A("gpu-timing-frame",{cpuTime:q,gpuTime:X}))},50)}if(this.listens("gpu-timing-layer")){const q=this.painter.collectGpuTimers();setTimeout(()=>{const X=this.painter.queryGpuTimers(q);this.fire(new i.A("gpu-timing-layer",{layerTimes:X}))},50)}if(this.listens("gpu-timing-deferred-render")){const q=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const X=this.painter.queryGpuTimeDeferredRender(q);this.fire(new i.A("gpu-timing-deferred-render",{gpuTime:X}))},50)}const B=this._sourcesDirty||this._styleDirty||this._placementDirty||M;if(B||this._repaint)this.triggerRepaint();else{const q=this.idle();if(q&&(M=this._updateAverageElevation(g,!0)),M)this.triggerRepaint();else if(this._triggerFrame(!1),q&&(this.fire(new i.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const X=this._calculateSpeedIndex();this.fire(new i.A("speedindexcompleted",{speedIndex:X})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||B||(this._fullyLoaded=!0,T.mark(w.fullLoad),this._performanceMetricsCollection&&Wt(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const o of this._markers)m&&!this.getRenderWorldCopies()&&(o._lngLat=o._lngLat.wrap()),o._update();for(const o of this._popups)!m||this.getRenderWorldCopies()||o._trackPointer||(o._lngLat=o._lngLat.wrap()),o._update()}_updateAverageElevation(m,o=!1){const d=S=>(this.transform.averageElevation=S,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&d(0);const g=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(g||(o||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const S=this.transform.averageElevation;let C=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(C)?C=0:this._averageElevationLastSampledAt=m;const M=Math.abs(S-C);if(M>1){if(this._isInitialLoad||g)return this._averageElevation.jumpTo(C),d(C);this._averageElevation.easeTo(C,m,300)}else if(M>1e-4)return this._averageElevation.jumpTo(C),d(C)}return!!this._averageElevation.isEasing(m)&&d(this._averageElevation.getValue(m))}_authenticate(){Ht(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===ze||m.status===401)){const o=this.painter.context.gl;Jt(o,!1),this._logoControl instanceof Gh&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Ye(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Et(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const d=this.painter.context.gl,g=d.createFramebuffer();function S(C){d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,C,0);const M=new Uint8Array(d.drawingBufferWidth*d.drawingBufferHeight*4);return d.readPixels(0,0,d.drawingBufferWidth,d.drawingBufferHeight,d.RGBA,d.UNSIGNED_BYTE,M),M}return d.bindFramebuffer(d.FRAMEBUFFER,g),this._canvasPixelComparison(S(m),o.canvasCopies.map(S),o.timeStamps)}_canvasPixelComparison(m,o,d){let g=d[1]-d[0];const S=m.length/4;for(let C=0;C<o.length;C++){const M=o[C];let L=0;for(let B=0;B<M.length;B+=4)M[B]===m[B]&&M[B+1]===m[B+1]&&M[B+2]===m[B+2]&&M[B+3]===m[B+3]&&(L+=1);g+=(d[C+2]-d[C+1])*(1-L/S)}return g}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),ur.delete(this.painter.context.gl),Tt.remove(),lt.remove(),this._removed=!0,this.fire(new i.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=i.q.frame(o=>{const d=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,d&&this._render(o)}))}_preloadTiles(m){const o=this.style?this.style.getSourceCaches():[];return i.bt(o,(d,g)=>d._preloadTiles(m,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(m){this._showParseStatus!==m&&(this._showParseStatus=m,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(m){this._showLayers2DWireframe!==m&&(this._showLayers2DWireframe=m,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(m){this._showLayers3DWireframe!==m&&(this._showLayers3DWireframe=m,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,this._tp.refreshUI(),m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,this._tp.refreshUI(),m&&this._update())}_setCacheLimits(m,o){i.eJ(m,o)}get version(){return y}},NavigationControl:class{constructor(m={}){this.options=i.l({},hn,m),this._container=O("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(i.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),O("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),O("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{const d=this._map;d&&(this.options.visualizePitch?d.resetNorthPitch({},{originalEvent:o}):d.resetNorth({},{originalEvent:o}))}),this._compassIcon=O("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const o=m.getZoom(),d=o===m.getMaxZoom(),g=o===m.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new uc(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,o){const d=O("button",m,this._container);return d.type="button",d.addEventListener("click",o),d}_setButtonTitle(m,o){if(!this._map)return;const d=this._map._getUIString(`NavigationControl.${o}`);m.setAttribute("aria-label",d),m.firstElementChild&&m.firstElementChild.setAttribute("title",d)}},GeolocateControl:class extends i.E{constructor(m={}){super();const o=navigator.geolocation;this.options=i.l({geolocation:o},Nu,m),i.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Lu(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=O("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const o=(d=!!this.options.geolocation)=>{this._supportsGeolocation=d,m(d)};this._supportsGeolocation!==void 0?m(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(d=>o(d.state!=="denied")).catch(()=>o()):o()}_isOutOfMapMaxBounds(m){const o=this._map.getMaxBounds(),d=m.coords;return!!o&&(d.longitude<o.getWest()||d.longitude>o.getEast()||d.latitude<o.getSouth()||d.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new i.A("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.A("geolocate",m)),this._finish()}}_updateCamera(m){const o=new i.cd(m.coords.longitude,m.coords.latitude),d=m.coords.accuracy,g=this._map.getBearing(),S=i.l({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(d),S,{geolocateSource:!0})}_updateMarker(m){if(m){const o=new i.cd(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,o=i.c6(1,m._center.lat)*m.worldSize,d=Math.ceil(2*this._accuracy*o);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.A("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=O("button","mapboxgl-ctrl-geolocate",this._container),O("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=O("div","mapboxgl-user-location"),this._dotElement.appendChild(O("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(O("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Xc({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=O("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Xc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.A("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:m.absolute===!0&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(o=>{o==="granted"&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:np,ScaleControl:class{constructor(m={}){this.options=i.l({},zu,m),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),i.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,o=this._map,d=o._containerHeight/2,g=o._containerWidth/2-m/2,S=o.unproject([g,d]),C=o.unproject([g+m,d]),M=S.distanceTo(C);if(this.options.unit==="imperial"){const L=3.2808*M;L>5280?this._setScale(m,L/5280,"mile"):this._setScale(m,L,"foot")}else this.options.unit==="nautical"?this._setScale(m,M/1852,"nautical-mile"):M>=1e3?this._setScale(m,M/1e3,"kilometer"):this._setScale(m,M,"meter")}_setScale(m,o,d){this._map._requestDomTask(()=>{const g=function(C){const M=Math.pow(10,`${Math.floor(C)}`.length-1);let L=C/M;return L=L>=10?10:L>=5?5:L>=3?3:L>=2?2:L>=1?1:function(B){const q=Math.pow(10,Math.ceil(-Math.log(B)/Math.LN10));return Math.round(B*q)/q}(L),M*L}(o),S=g/o;this._container.innerHTML=this._isNumberFormatSupported&&d!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:d}).format(g):`${g}&nbsp;${dc[d]}`,this._container.style.width=m*S+"px"})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=O("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m={}){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:i.w("Full screen control 'container' must be a DOM element.")),i.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=O("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=O("button","mapboxgl-ctrl-fullscreen",this._controlContainer);O("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends i.E{constructor(m){super(),this.options=i.l(Object.create(cl),m),this._altitude=this.options.altitude,i.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new i.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new i.A("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=i.cd.convert(m),this._pos=null,this._trackPointer=!1,this._update();const o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(m){return this._altitude=m,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const o=document.createDocumentFragment(),d=document.createElement("body");let g;for(d.innerHTML=m;g=d.firstChild,g;)o.appendChild(g);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=O("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(m),this.options.closeButton){const d=this._closeButton=O("button","mapboxgl-popup-close-button",o);d.type="button",d.setAttribute("aria-label","Close popup"),d.innerHTML='<span aria-hidden="true">&#215;</span>',d.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let o;return this._classList.delete(m)?o=!1:(this._classList.add(m),o=!0),this._updateClassList(),o}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const o=this._map,d=this._container,g=this._pos;if(!o||!d||!g)return"bottom";const S=d.offsetWidth,C=d.offsetHeight,M=g.x<S/2,L=g.x>o.transform.width-S/2;if(g.y+m<C)return M?"top-left":L?"top-right":"top";if(g.y>o.transform.height-C){if(M)return"bottom-left";if(L)return"bottom-right"}return M?"left":L?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),m.className=o.join(" ")}_update(m){const o=this._map,d=this._content;if(!o||!this._lngLat&&!this._trackPointer||!d)return;let g=this._container;if(g||(g=this._container=O("div","mapboxgl-popup",o.getContainer()),this._tip=O("div","mapboxgl-popup-tip",g),g.appendChild(d)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=hm(this._lngLat,this._pos,o.transform)),!this._trackPointer||m){const S=this._pos=this._trackPointer&&m instanceof i.P?m:o.project(this._lngLat,this._altitude),C=hc(this.options.offset),M=this._anchor=this._getAnchor(C.y),L=hc(this.options.offset,M),B=S.add(L).round();o._requestDomTask(()=>{this._container&&M&&(this._container.style.transform=`${fm[M]} translate(${B.x}px,${B.y}px)`)})}if(!this._marker&&o._showingGlobe()){const S=i.eK(o.transform,this._lngLat)?0:1;this._setOpacity(S)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(ul);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:Xc,Style:il,LngLat:i.cd,LngLatBounds:i.aG,Point:i.P,MercatorCoordinate:i.ac,FreeCameraOptions:Oc,Evented:i.E,config:i.e,prewarm:i.eP,clearPrewarmedResources:i.eQ,get accessToken(){return i.e.ACCESS_TOKEN},set accessToken(m){i.e.ACCESS_TOKEN=m},get baseApiUrl(){return i.e.API_URL},set baseApiUrl(m){i.e.API_URL=m},get workerCount(){return i.eR.workerCount},set workerCount(m){i.eR.workerCount=m},get maxParallelImageRequests(){return i.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){i.e.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){i.eS(m)},get workerUrl(){return i.eT.workerUrl},set workerUrl(m){i.eT.workerUrl=m},get workerClass(){return i.eT.workerClass},set workerClass(m){i.eT.workerClass=m},get workerParams(){return i.eT.workerParams},set workerParams(m){i.eT.workerParams=m},get dracoUrl(){return i.eU()},set dracoUrl(m){i.eV(m)},get meshoptUrl(){return i.eW()},set meshoptUrl(m){i.eX(m)},setNow:i.q.setNow,restoreNow:i.q.restoreNow}});var f=a;return f})}(Yw)),Yw.exports}var dje=uje();const lp=vs(dje);var ak,F9;function V_(){if(F9)return ak;F9=1,ak=t;var e=Object.prototype.hasOwnProperty;function t(){for(var r={},n=0;n<arguments.length;n++){var a=arguments[n];for(var u in a)e.call(a,u)&&(r[u]=a[u])}return r}return ak}var lk={exports:{}},B9;function hje(){return B9||(B9=1,function(e,t){(function(){var r={};e.exports=r,r.simpleFilter=function(n,a){return a.filter(function(u){return r.test(n,u)})},r.test=function(n,a){return r.match(n,a)!==null},r.match=function(n,a,u){u=u||{};var f=0,i=[],y=a.length,w=0,T=0,A=u.pre||"",k=u.post||"",F=u.caseSensitive&&a||a.toLowerCase(),D;n=u.caseSensitive&&n||n.toLowerCase();for(var O=0;O<y;O++)D=a[O],F[O]===n[f]?(D=A+D+k,f+=1,T+=1+T):T=0,w+=T,i[i.length]=D;return f===n.length?(w=F===n?1/0:w,{rendered:i.join(""),score:w}):null},r.filter=function(n,a,u){return!a||a.length===0?[]:typeof n!="string"?a:(u=u||{},a.reduce(function(f,i,y,w){var T=i;u.extract&&(T=u.extract(i));var A=r.match(n,T,u);return A!=null&&(f[f.length]={string:A.rendered,score:A.score,index:y,original:i}),f},[]).sort(function(f,i){var y=i.score-f.score;return y||f.index-i.index}))}})()}(lk)),lk.exports}var ck,$9;function fje(){if($9)return ck;$9=1;var e=function(t){return this.component=t,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,t.el.parentNode.insertBefore(this.wrapper,t.el.nextSibling),this};return e.prototype.show=function(){this.element.style.display="block"},e.prototype.hide=function(){this.element.style.display="none"},e.prototype.add=function(t){this.items.push(t)},e.prototype.clear=function(){this.items=[],this.active=0},e.prototype.isEmpty=function(){return!this.items.length},e.prototype.isVisible=function(){return this.element.style.display==="block"},e.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var t=0;t<this.items.length;t++)this.drawItem(this.items[t],this.active===t);this.show()},e.prototype.drawItem=function(t,r){var n=document.createElement("li"),a=document.createElement("a");r&&(n.className+=" active"),a.innerHTML=t.string,n.appendChild(a),this.element.appendChild(n),n.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),n.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,t)}).bind(this))},e.prototype.handleMouseUp=function(t){this.selectingListItem=!1,this.component.value(t.original),this.clear(),this.draw()},e.prototype.move=function(t){this.active=t,this.draw()},e.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)},e.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},e.prototype.drawError=function(t){var r=document.createElement("li");r.innerHTML=t,this.element.appendChild(r),this.show()},ck=e,ck}var uk,V9;function pje(){if(V9)return uk;V9=1;var e=V_(),t=hje(),r=fje(),n=function(a,u,f){return f=f||{},this.options=e({minLength:2,limit:5,filter:!0,hideOnBlur:!0},f),this.el=a,this.data=u||[],this.list=new r(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(i){this.handleKeyUp(i.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(i){this.handleKeyDown(i)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(i){this.handlePaste(i)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};return n.prototype.handleKeyUp=function(a){a===40||a===38||a===27||a===13||a===9||this.handleInputChange(this.el.value)},n.prototype.handleKeyDown=function(a){switch(a.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&a.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}},n.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},n.prototype.handlePaste=function(a){if(a.clipboardData)this.handleInputChange(a.clipboardData.getData("Text"));else{var u=this;setTimeout(function(){u.handleInputChange(a.target.value)},100)}},n.prototype.handleInputChange=function(a){if(this.query=this.normalize(a),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(u){for(var f=0;f<u.length&&(this.list.add(u[f]),f!==this.options.limit-1);f++);this.list.draw()}).bind(this))},n.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},n.prototype.update=function(a){this.data=a,this.handleKeyUp()},n.prototype.clear=function(){this.data=[],this.list.clear()},n.prototype.normalize=function(a){return a=a.toLowerCase(),a},n.prototype.match=function(a,u){return a.indexOf(u)>-1},n.prototype.value=function(a){if(this.selected=a,this.el.value=this.getItemValue(a),document.createEvent){var u=document.createEvent("HTMLEvents");u.initEvent("change",!0,!1),this.el.dispatchEvent(u)}else this.el.fireEvent("onchange")},n.prototype.getCandidates=function(a){var u={pre:"<strong>",post:"</strong>",extract:(function(i){return this.getItemValue(i)}).bind(this)},f;this.options.filter?(f=t.filter(this.query,this.data,u),f=f.map((function(i){return{original:i.original,string:this.render(i.original,i.string)}}).bind(this))):f=this.data.map((function(i){var y=this.render(i);return{original:i,string:y}}).bind(this)),a(f)},n.prototype.getItemValue=function(a){return a},n.prototype.render=function(a,u){if(u)return u;for(var f=a.original?this.getItemValue(a.original):this.getItemValue(a),i=this.normalize(f),y=i.lastIndexOf(this.query);y>-1;){var w=y+this.query.length;f=f.slice(0,y)+"<strong>"+f.slice(y,w)+"</strong>"+f.slice(w),y=i.slice(0,y).lastIndexOf(this.query)}return f},n.prototype.renderError=function(a){this.list.drawError(a)},uk=n,uk}var dk,U9;function mje(){if(U9)return dk;U9=1;var e=pje();return dk=e,typeof window<"u"&&(window.Suggestions=e),dk}var hk,q9;function gje(){if(q9)return hk;q9=1;var e="Expected a function",t=NaN,r="[object Symbol]",n=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,u=/^0b[01]+$/i,f=/^0o[0-7]+$/i,i=parseInt,y=typeof Wu=="object"&&Wu&&Wu.Object===Object&&Wu,w=typeof self=="object"&&self&&self.Object===Object&&self,T=y||w||Function("return this")(),A=Object.prototype,k=A.toString,F=Math.max,D=Math.min,O=function(){return T.Date.now()};function N(G,Y,ie){var ce,ge,be,xe,Le,ze,Xe=0,Je=!1,tt=!1,st=!0;if(typeof G!="function")throw new TypeError(e);Y=J(Y)||0,V(ie)&&(Je=!!ie.leading,tt="maxWait"in ie,be=tt?F(J(ie.maxWait)||0,Y):be,st="trailing"in ie?!!ie.trailing:st);function Ne(kt){var Wt=ce,Tt=ge;return ce=ge=void 0,Xe=kt,xe=G.apply(Tt,Wt),xe}function We(kt){return Xe=kt,Le=setTimeout(Ke,Y),Je?Ne(kt):xe}function Ue(kt){var Wt=kt-ze,Tt=kt-Xe,Ht=Y-Wt;return tt?D(Ht,be-Tt):Ht}function De(kt){var Wt=kt-ze,Tt=kt-Xe;return ze===void 0||Wt>=Y||Wt<0||tt&&Tt>=be}function Ke(){var kt=O();if(De(kt))return lt(kt);Le=setTimeout(Ke,Ue(kt))}function lt(kt){return Le=void 0,st&&ce?Ne(kt):(ce=ge=void 0,xe)}function Ye(){Le!==void 0&&clearTimeout(Le),Xe=0,ce=ze=ge=Le=void 0}function Ve(){return Le===void 0?xe:lt(O())}function Et(){var kt=O(),Wt=De(kt);if(ce=arguments,ge=this,ze=kt,Wt){if(Le===void 0)return We(ze);if(tt)return Le=setTimeout(Ke,Y),Ne(ze)}return Le===void 0&&(Le=setTimeout(Ke,Y)),xe}return Et.cancel=Ye,Et.flush=Ve,Et}function V(G){var Y=typeof G;return!!G&&(Y=="object"||Y=="function")}function H(G){return!!G&&typeof G=="object"}function Z(G){return typeof G=="symbol"||H(G)&&k.call(G)==r}function J(G){if(typeof G=="number")return G;if(Z(G))return t;if(V(G)){var Y=typeof G.valueOf=="function"?G.valueOf():G;G=V(Y)?Y+"":Y}if(typeof G!="string")return G===0?G:+G;G=G.replace(n,"");var ie=u.test(G);return ie||f.test(G)?i(G.slice(2),ie?2:8):a.test(G)?t:+G}return hk=N,hk}var Mw={exports:{}},G9;function yje(){if(G9)return Mw.exports;G9=1;var e=typeof Reflect=="object"?Reflect:null,t=e&&typeof e.apply=="function"?e.apply:function(G,Y,ie){return Function.prototype.apply.call(G,Y,ie)},r;e&&typeof e.ownKeys=="function"?r=e.ownKeys:Object.getOwnPropertySymbols?r=function(G){return Object.getOwnPropertyNames(G).concat(Object.getOwnPropertySymbols(G))}:r=function(G){return Object.getOwnPropertyNames(G)};function n(J){console&&console.warn&&console.warn(J)}var a=Number.isNaN||function(G){return G!==G};function u(){u.init.call(this)}Mw.exports=u,Mw.exports.once=V,u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var f=10;function i(J){if(typeof J!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof J)}Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return f},set:function(J){if(typeof J!="number"||J<0||a(J))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+J+".");f=J}}),u.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},u.prototype.setMaxListeners=function(G){if(typeof G!="number"||G<0||a(G))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+G+".");return this._maxListeners=G,this};function y(J){return J._maxListeners===void 0?u.defaultMaxListeners:J._maxListeners}u.prototype.getMaxListeners=function(){return y(this)},u.prototype.emit=function(G){for(var Y=[],ie=1;ie<arguments.length;ie++)Y.push(arguments[ie]);var ce=G==="error",ge=this._events;if(ge!==void 0)ce=ce&&ge.error===void 0;else if(!ce)return!1;if(ce){var be;if(Y.length>0&&(be=Y[0]),be instanceof Error)throw be;var xe=new Error("Unhandled error."+(be?" ("+be.message+")":""));throw xe.context=be,xe}var Le=ge[G];if(Le===void 0)return!1;if(typeof Le=="function")t(Le,this,Y);else for(var ze=Le.length,Xe=D(Le,ze),ie=0;ie<ze;++ie)t(Xe[ie],this,Y);return!0};function w(J,G,Y,ie){var ce,ge,be;if(i(Y),ge=J._events,ge===void 0?(ge=J._events=Object.create(null),J._eventsCount=0):(ge.newListener!==void 0&&(J.emit("newListener",G,Y.listener?Y.listener:Y),ge=J._events),be=ge[G]),be===void 0)be=ge[G]=Y,++J._eventsCount;else if(typeof be=="function"?be=ge[G]=ie?[Y,be]:[be,Y]:ie?be.unshift(Y):be.push(Y),ce=y(J),ce>0&&be.length>ce&&!be.warned){be.warned=!0;var xe=new Error("Possible EventEmitter memory leak detected. "+be.length+" "+String(G)+" listeners added. Use emitter.setMaxListeners() to increase limit");xe.name="MaxListenersExceededWarning",xe.emitter=J,xe.type=G,xe.count=be.length,n(xe)}return J}u.prototype.addListener=function(G,Y){return w(this,G,Y,!1)},u.prototype.on=u.prototype.addListener,u.prototype.prependListener=function(G,Y){return w(this,G,Y,!0)};function T(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function A(J,G,Y){var ie={fired:!1,wrapFn:void 0,target:J,type:G,listener:Y},ce=T.bind(ie);return ce.listener=Y,ie.wrapFn=ce,ce}u.prototype.once=function(G,Y){return i(Y),this.on(G,A(this,G,Y)),this},u.prototype.prependOnceListener=function(G,Y){return i(Y),this.prependListener(G,A(this,G,Y)),this},u.prototype.removeListener=function(G,Y){var ie,ce,ge,be,xe;if(i(Y),ce=this._events,ce===void 0)return this;if(ie=ce[G],ie===void 0)return this;if(ie===Y||ie.listener===Y)--this._eventsCount===0?this._events=Object.create(null):(delete ce[G],ce.removeListener&&this.emit("removeListener",G,ie.listener||Y));else if(typeof ie!="function"){for(ge=-1,be=ie.length-1;be>=0;be--)if(ie[be]===Y||ie[be].listener===Y){xe=ie[be].listener,ge=be;break}if(ge<0)return this;ge===0?ie.shift():O(ie,ge),ie.length===1&&(ce[G]=ie[0]),ce.removeListener!==void 0&&this.emit("removeListener",G,xe||Y)}return this},u.prototype.off=u.prototype.removeListener,u.prototype.removeAllListeners=function(G){var Y,ie,ce;if(ie=this._events,ie===void 0)return this;if(ie.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):ie[G]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete ie[G]),this;if(arguments.length===0){var ge=Object.keys(ie),be;for(ce=0;ce<ge.length;++ce)be=ge[ce],be!=="removeListener"&&this.removeAllListeners(be);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(Y=ie[G],typeof Y=="function")this.removeListener(G,Y);else if(Y!==void 0)for(ce=Y.length-1;ce>=0;ce--)this.removeListener(G,Y[ce]);return this};function k(J,G,Y){var ie=J._events;if(ie===void 0)return[];var ce=ie[G];return ce===void 0?[]:typeof ce=="function"?Y?[ce.listener||ce]:[ce]:Y?N(ce):D(ce,ce.length)}u.prototype.listeners=function(G){return k(this,G,!0)},u.prototype.rawListeners=function(G){return k(this,G,!1)},u.listenerCount=function(J,G){return typeof J.listenerCount=="function"?J.listenerCount(G):F.call(J,G)},u.prototype.listenerCount=F;function F(J){var G=this._events;if(G!==void 0){var Y=G[J];if(typeof Y=="function")return 1;if(Y!==void 0)return Y.length}return 0}u.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]};function D(J,G){for(var Y=new Array(G),ie=0;ie<G;++ie)Y[ie]=J[ie];return Y}function O(J,G){for(;G+1<J.length;G++)J[G]=J[G+1];J.pop()}function N(J){for(var G=new Array(J.length),Y=0;Y<G.length;++Y)G[Y]=J[Y].listener||J[Y];return G}function V(J,G){return new Promise(function(Y,ie){function ce(be){J.removeListener(G,ge),ie(be)}function ge(){typeof J.removeListener=="function"&&J.removeListener("error",ce),Y([].slice.call(arguments))}Z(J,G,ge,{once:!0}),G!=="error"&&H(J,ce,{once:!0})})}function H(J,G,Y){typeof J.on=="function"&&Z(J,"error",G,Y)}function Z(J,G,Y,ie){if(typeof J.on=="function")ie.once?J.once(G,Y):J.on(G,Y);else if(typeof J.addEventListener=="function")J.addEventListener(G,function ce(ge){ie.once&&J.removeEventListener(G,ce),Y(ge)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof J)}return Mw.exports}var fk,H9;function vje(){return H9||(H9=1,fk={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}}),fk}var pk,W9;function _je(){if(W9)return pk;W9=1;function e(n){var a=n.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return a?{key:a[1],value:a[2]}:null}function t(n){var a=n.match(/<?([^>]*)>(.*)/);if(!a)return null;var u=a[1],f=a[2].split(";"),i=null,y=f.reduce(function(w,T){var A=e(T);return A?A.key==="rel"?(i||(i=A.value),w):(w[A.key]=A.value,w):w},{});return i?{url:u,rel:i,params:y}:null}function r(n){return n?n.split(/,\s*</).reduce(function(a,u){var f=t(u);if(!f)return a;var i=f.rel.split(/\s+/);return i.forEach(function(y){a[y]||(a[y]={url:f.url,params:f.params})}),a},{}):{}}return pk=r,pk}var mk,Z9;function xje(){if(Z9)return mk;Z9=1;var e=_je();function t(r,n){this.request=r,this.headers=n.headers,this.rawBody=n.body,this.statusCode=n.statusCode;try{this.body=JSON.parse(n.body||"{}")}catch{this.body=n.body}this.links=e(this.headers.link)}return t.prototype.hasNextPage=function(){return!!this.links.next},t.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null},mk=t,mk}var gk,X9;function V2(){return X9||(X9=1,gk={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"}),gk}var yk,K9;function bje(){if(K9)return yk;K9=1;var e=V2();function t(r){var n=r.type||e.ERROR_HTTP,a;if(r.body)try{a=JSON.parse(r.body)}catch{a=r.body}else a=null;var u=r.message||null;u||(typeof a=="string"?u=a:a&&typeof a.message=="string"?u=a.message:n===e.ERROR_REQUEST_ABORTED&&(u="Request aborted")),this.message=u,this.type=n,this.statusCode=r.statusCode||null,this.request=r.request,this.body=a}return yk=t,yk}var vk,Y9;function wje(){if(Y9)return vk;Y9=1;function e(r){var n=r.indexOf(":"),a=r.substring(0,n).trim().toLowerCase(),u=r.substring(n+1).trim();return{name:a,value:u}}function t(r){var n={};return r&&r.trim().split(/[\r|\n]+/).forEach(function(a){var u=e(a);n[u.name]=u.value}),n}return vk=t,vk}var _k,J9;function Sje(){if(J9)return _k;J9=1;var e=xje(),t=bje(),r=V2(),n=wje(),a={};function u(A){var k=a[A.id];k&&(k.abort(),delete a[A.id])}function f(A,k){return new e(A,{body:k.response,headers:n(k.getAllResponseHeaders()),statusCode:k.status})}function i(A){var k=A.total,F=A.loaded,D=100*F/k;return{total:k,transferred:F,percent:D}}function y(A,k){return new Promise(function(F,D){k.onprogress=function(V){A.emitter.emit(r.EVENT_PROGRESS_DOWNLOAD,i(V))};var O=A.file;O&&(k.upload.onprogress=function(V){A.emitter.emit(r.EVENT_PROGRESS_UPLOAD,i(V))}),k.onerror=function(V){D(V)},k.onabort=function(){var V=new t({request:A,type:r.ERROR_REQUEST_ABORTED});D(V)},k.onload=function(){if(delete a[A.id],k.status<200||k.status>=400){var V=new t({request:A,body:k.response,statusCode:k.status});D(V);return}F(k)};var N=A.body;typeof N=="string"?k.send(N):N?k.send(JSON.stringify(N)):O?k.send(O):k.send(),a[A.id]=k}).then(function(F){return f(A,F)})}function w(A,k){var F=A.url(k),D=new window.XMLHttpRequest;return D.open(A.method,F),Object.keys(A.headers).forEach(function(O){D.setRequestHeader(O,A.headers[O])}),D}function T(A){return Promise.resolve().then(function(){var k=w(A,A.client.accessToken);return y(A,k)})}return _k={browserAbort:u,sendRequestXhr:y,browserSend:T,createRequestXhr:w},_k}var dx={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */var Eje=dx.exports,Q9;function Tje(){return Q9||(Q9=1,function(e,t){(function(r){var n=t,a=e&&e.exports==n&&e,u=typeof Wu=="object"&&Wu;(u.global===u||u.window===u)&&(r=u);var f=function(D){this.message=D};f.prototype=new Error,f.prototype.name="InvalidCharacterError";var i=function(D){throw new f(D)},y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",w=/[\t\n\f\r ]/g,T=function(D){D=String(D).replace(w,"");var O=D.length;O%4==0&&(D=D.replace(/==?$/,""),O=D.length),(O%4==1||/[^+a-zA-Z0-9/]/.test(D))&&i("Invalid character: the string to be decoded is not correctly encoded.");for(var N=0,V,H,Z="",J=-1;++J<O;)H=y.indexOf(D.charAt(J)),V=N%4?V*64+H:H,N++%4&&(Z+=String.fromCharCode(255&V>>(-2*N&6)));return Z},A=function(D){D=String(D),/[^\0-\xFF]/.test(D)&&i("The string to be encoded contains characters outside of the Latin1 range.");for(var O=D.length%3,N="",V=-1,H,Z,J,G,Y=D.length-O;++V<Y;)H=D.charCodeAt(V)<<16,Z=D.charCodeAt(++V)<<8,J=D.charCodeAt(++V),G=H+Z+J,N+=y.charAt(G>>18&63)+y.charAt(G>>12&63)+y.charAt(G>>6&63)+y.charAt(G&63);return O==2?(H=D.charCodeAt(V)<<8,Z=D.charCodeAt(++V),G=H+Z,N+=y.charAt(G>>10)+y.charAt(G>>4&63)+y.charAt(G<<2&63)+"="):O==1&&(G=D.charCodeAt(V),N+=y.charAt(G>>2)+y.charAt(G<<4&63)+"=="),N},k={encode:A,decode:T,version:"0.1.0"};if(n&&!n.nodeType)if(a)a.exports=k;else for(var F in k)k.hasOwnProperty(F)&&(n[F]=k[F]);else r.base64=k})(Eje)}(dx,dx.exports)),dx.exports}var xk,e7;function LQ(){if(e7)return xk;e7=1;var e=Tje(),t={};function r(u){if(t[u])return t[u];var f=u.split("."),i=f[0],y=f[1];if(!y)throw new Error("Invalid token");var w=n(y),T={usage:i,user:w.u};return a(w,"a")&&(T.authorization=w.a),a(w,"exp")&&(T.expires=w.exp*1e3),a(w,"iat")&&(T.created=w.iat*1e3),a(w,"scopes")&&(T.scopes=w.scopes),a(w,"client")&&(T.client=w.client),a(w,"ll")&&(T.lastLogin=w.ll),a(w,"iu")&&(T.impersonator=w.iu),t[u]=T,T}function n(u){try{return JSON.parse(e.decode(u))}catch{throw new Error("Invalid token")}}function a(u,f){return Object.prototype.hasOwnProperty.call(u,f)}return xk=r,xk}var bk={exports:{}},t7;function Cje(){return t7||(t7=1,function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function a(y,w,T){this.fn=y,this.context=w,this.once=T||!1}function u(y,w,T,A,k){if(typeof T!="function")throw new TypeError("The listener must be a function");var F=new a(T,A||y,k),D=r?r+w:w;return y._events[D]?y._events[D].fn?y._events[D]=[y._events[D],F]:y._events[D].push(F):(y._events[D]=F,y._eventsCount++),y}function f(y,w){--y._eventsCount===0?y._events=new n:delete y._events[w]}function i(){this._events=new n,this._eventsCount=0}i.prototype.eventNames=function(){var w=[],T,A;if(this._eventsCount===0)return w;for(A in T=this._events)t.call(T,A)&&w.push(r?A.slice(1):A);return Object.getOwnPropertySymbols?w.concat(Object.getOwnPropertySymbols(T)):w},i.prototype.listeners=function(w){var T=r?r+w:w,A=this._events[T];if(!A)return[];if(A.fn)return[A.fn];for(var k=0,F=A.length,D=new Array(F);k<F;k++)D[k]=A[k].fn;return D},i.prototype.listenerCount=function(w){var T=r?r+w:w,A=this._events[T];return A?A.fn?1:A.length:0},i.prototype.emit=function(w,T,A,k,F,D){var O=r?r+w:w;if(!this._events[O])return!1;var N=this._events[O],V=arguments.length,H,Z;if(N.fn){switch(N.once&&this.removeListener(w,N.fn,void 0,!0),V){case 1:return N.fn.call(N.context),!0;case 2:return N.fn.call(N.context,T),!0;case 3:return N.fn.call(N.context,T,A),!0;case 4:return N.fn.call(N.context,T,A,k),!0;case 5:return N.fn.call(N.context,T,A,k,F),!0;case 6:return N.fn.call(N.context,T,A,k,F,D),!0}for(Z=1,H=new Array(V-1);Z<V;Z++)H[Z-1]=arguments[Z];N.fn.apply(N.context,H)}else{var J=N.length,G;for(Z=0;Z<J;Z++)switch(N[Z].once&&this.removeListener(w,N[Z].fn,void 0,!0),V){case 1:N[Z].fn.call(N[Z].context);break;case 2:N[Z].fn.call(N[Z].context,T);break;case 3:N[Z].fn.call(N[Z].context,T,A);break;case 4:N[Z].fn.call(N[Z].context,T,A,k);break;default:if(!H)for(G=1,H=new Array(V-1);G<V;G++)H[G-1]=arguments[G];N[Z].fn.apply(N[Z].context,H)}}return!0},i.prototype.on=function(w,T,A){return u(this,w,T,A,!1)},i.prototype.once=function(w,T,A){return u(this,w,T,A,!0)},i.prototype.removeListener=function(w,T,A,k){var F=r?r+w:w;if(!this._events[F])return this;if(!T)return f(this,F),this;var D=this._events[F];if(D.fn)D.fn===T&&(!k||D.once)&&(!A||D.context===A)&&f(this,F);else{for(var O=0,N=[],V=D.length;O<V;O++)(D[O].fn!==T||k&&!D[O].once||A&&D[O].context!==A)&&N.push(D[O]);N.length?this._events[F]=N.length===1?N[0]:N:f(this,F)}return this},i.prototype.removeAllListeners=function(w){var T;return w?(T=r?r+w:w,this._events[T]&&f(this,T)):(this._events=new n,this._eventsCount=0),this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prefixed=r,i.EventEmitter=i,e.exports=i}(bk)),bk.exports}var wk,r7;function Aje(){if(r7)return wk;r7=1;function e(f){return f.map(encodeURIComponent).join(",")}function t(f){return Array.isArray(f)?e(f):encodeURIComponent(String(f))}function r(f,i,y){if(y===!1||y===null)return f;var w=/\?/.test(f)?"&":"?",T=encodeURIComponent(i);return y!==void 0&&y!==""&&y!==!0&&(T+="="+t(y)),""+f+w+T}function n(f,i){if(!i)return f;var y=f;return Object.keys(i).forEach(function(w){var T=i[w];T!==void 0&&(Array.isArray(T)&&(T=T.filter(function(A){return A!=null}).join(",")),y=r(y,w,T))}),y}function a(f,i){if(!i||f.slice(0,4)==="http")return f;var y=f[0]==="/"?"":"/";return""+i.replace(/\/$/,"")+y+f}function u(f,i){return i?f.replace(/\/:([a-zA-Z0-9]+)/g,function(y,w){var T=i[w];if(T===void 0)throw new Error("Unspecified route parameter "+w);var A=t(T);return"/"+A}):f}return wk={appendQueryObject:n,appendQueryParam:r,prependOrigin:a,interpolateRouteParams:u},wk}var Sk,n7;function Pje(){if(n7)return Sk;n7=1;var e=LQ(),t=V_(),r=Cje(),n=Aje(),a=V2(),u=1;function f(i,y){if(!i)throw new Error("MapiRequest requires a client");if(!y||!y.path||!y.method)throw new Error("MapiRequest requires an options object with path and method properties");var w={};y.body&&(w["content-type"]="application/json");var T=t(w,y.headers),A=Object.keys(T).reduce(function(k,F){return k[F.toLowerCase()]=T[F],k},{});this.id=u++,this._options=y,this.emitter=new r,this.client=i,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=y.path,this.method=y.method,this.origin=y.origin||i.origin,this.query=y.query||{},this.params=y.params||{},this.body=y.body||null,this.file=y.file||null,this.encoding=y.encoding||"utf8",this.sendFileAs=y.sendFileAs||null,this.headers=A}return f.prototype.url=function(y){var w=n.prependOrigin(this.path,this.origin);w=n.appendQueryObject(w,this.query);var T=this.params,A=y??this.client.accessToken;if(A){w=n.appendQueryParam(w,"access_token",A);var k=e(A).user;T=t({ownerId:k},T)}return w=n.interpolateRouteParams(w,T),w},f.prototype.send=function(){var y=this;if(y.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return y.sent=!0,y.client.sendRequest(y).then(function(w){return y.response=w,y.emitter.emit(a.EVENT_RESPONSE,w),w},function(w){throw y.error=w,y.emitter.emit(a.EVENT_ERROR,w),w})},f.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))},f.prototype.eachPage=function(y){var w=this;function T(F){function D(){delete w._nextPageRequest;var O=F.nextPage();O&&(w._nextPageRequest=O,k(O))}y(null,F,D)}function A(F){y(F,null,function(){})}function k(F){F.send().then(T,A)}k(this)},f.prototype.clone=function(){return this._extend()},f.prototype._extend=function(y){var w=t(this._options,y);return new f(this.client,w)},Sk=f,Sk}var Ek,i7;function RQ(){if(i7)return Ek;i7=1;var e=LQ(),t=Pje(),r=V2();function n(a){if(!a||!a.accessToken)throw new Error("Cannot create a client without an access token");e(a.accessToken),this.accessToken=a.accessToken,this.origin=a.origin||r.API_ORIGIN}return n.prototype.createRequest=function(u){return new t(this,u)},Ek=n,Ek}var Tk,s7;function jQ(){if(s7)return Tk;s7=1;var e=Sje(),t=RQ();function r(a){t.call(this,a)}r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.prototype.sendRequest=e.browserSend,r.prototype.abortRequest=e.browserAbort;function n(a){return new r(a)}return Tk=n,Tk}var Ck,o7;function Mje(){if(o7)return Ck;o7=1;var e=jQ();return Ck=e,Ck}var Ak,a7;function Ije(){if(a7)return Ak;a7=1;var e=Object.prototype.toString;return Ak=function(t){var r;return e.call(t)==="[object Object]"&&(r=Object.getPrototypeOf(t),r===null||r===Object.getPrototypeOf({}))},Ak}var Pk,l7;function kje(){if(l7)return Pk;l7=1;var e=Ije(),t=V_(),r="value",n=`
  `,a={};a.assert=function(D,O){return O=O||{},function(N){var V=f(D,N);if(V){var H=i(V,O);throw O.apiName&&(H=O.apiName+": "+H),new Error(H)}}},a.shape=function(O){var N=F(O);return function(H){var Z=f(a.plainObject,H);if(Z)return Z;for(var J,G,Y=[],ie=0;ie<N.length;ie++)J=N[ie].key,G=N[ie].value,Z=f(G,H[J]),Z&&Y.push([J].concat(Z));return Y.length<2?Y[0]:function(ce){Y=Y.map(function(xe){var Le=xe[0],ze=i(xe,ce).split(`
`).join(n);return"- "+Le+": "+ze});var ge=ce.path.join("."),be=ge===r?"":" of "+ge;return"The following properties"+be+" have invalid values:"+n+Y.join(n)}}},a.strictShape=function(O){var N=a.shape(O);return function(H){var Z=N(H);if(Z)return Z;var J=Object.keys(H).reduce(function(G,Y){return O[Y]===void 0&&G.push(Y),G},[]);if(J.length!==0)return function(){return"The following keys are invalid: "+J.join(", ")}}},a.arrayOf=function(O){return u(O)},a.tuple=function(){var O=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return u(O)};function u(D){var O=Array.isArray(D),N=function(V){return O?D[V]:D};return function(H){var Z=f(a.plainArray,H);if(Z)return Z;if(O&&H.length!==D.length)return"an array with "+D.length+" items";for(var J=0;J<H.length;J++)if(Z=f(N(J),H[J]),Z)return[J].concat(Z)}}a.required=function(O){function N(V){return V==null?function(H){return A(H,k(H.path)?"cannot be undefined/null.":"is required.")}:O.apply(this,arguments)}return N.__required=!0,N},a.oneOfType=function(){var O=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(V){var H=O.map(function(Z){return f(Z,V)}).filter(Boolean);if(H.length===O.length)return H.every(function(Z){return Z.length===1&&typeof Z[0]=="string"})?y(H.map(function(Z){return Z[0]})):H.reduce(function(Z,J){return J.length>Z.length?J:Z})}},a.equal=function(O){return function(V){if(V!==O)return JSON.stringify(O)}},a.oneOf=function(){var O=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),N=O.map(function(V){return a.equal(V)});return a.oneOfType.apply(this,N)},a.range=function(O){var N=O[0],V=O[1];return function(Z){var J=f(a.number,Z);if(J||Z<N||Z>V)return"number between "+N+" & "+V+" (inclusive)"}},a.any=function(){},a.boolean=function(O){if(typeof O!="boolean")return"boolean"},a.number=function(O){if(typeof O!="number")return"number"},a.plainArray=function(O){if(!Array.isArray(O))return"array"},a.plainObject=function(O){if(!e(O))return"object"},a.string=function(O){if(typeof O!="string")return"string"},a.func=function(O){if(typeof O!="function")return"function"};function f(D,O){if(!(O==null&&!D.hasOwnProperty("__required"))){var N=D(O);if(N)return Array.isArray(N)?N:[N]}}function i(D,O){var N=D.length,V=D[N-1],H=D.slice(0,N-1);return H.length===0&&(H=[r]),O=t(O,{path:H}),typeof V=="function"?V(O):A(O,w(V))}function y(D){return D.length<2?D[0]:D.length===2?D.join(" or "):D.slice(0,-1).join(", ")+", or "+D.slice(-1)}function w(D){return"must be "+T(D)+"."}function T(D){return/^an? /.test(D)?D:/^[aeiou]/i.test(D)?"an "+D:/^[a-z]/i.test(D)?"a "+D:D}function A(D,O){var N=k(D.path),V=D.path.join(".")+" "+O,H=N?"Item at position ":"";return H+V}function k(D){return typeof D[D.length-1]=="number"||typeof D[0]=="number"}function F(D){return Object.keys(D||{}).map(function(O){return{key:O,value:D[O]}})}return a.validate=f,a.processMessage=i,Pk=a,Pk}var Mk,c7;function Oje(){if(c7)return Mk;c7=1;var e=V_(),t=kje();function r(f){if(typeof window<"u")return f instanceof Wu.Blob||f instanceof Wu.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof f=="string"||f.pipe!==void 0))return"Filename or Readable stream"}function n(f,i){return t.assert(t.strictShape(f),i)}function a(f){var i="date";if(typeof f=="boolean")return i;try{var y=new Date(f);if(y.getTime&&isNaN(y.getTime()))return i}catch{return i}}function u(f){return t.tuple(t.number,t.number)(f)}return Mk=e(t,{file:r,date:a,coordinates:u,assertShape:n}),Mk}var Ik,u7;function Lje(){if(u7)return Ik;u7=1;function e(t,r){var n=function(a,u){return r.indexOf(a)!==-1&&u!==void 0};return typeof r=="function"&&(n=r),Object.keys(t).filter(function(a){return n(a,t[a])}).reduce(function(a,u){return a[u]=t[u],a},{})}return Ik=e,Ik}var kk,d7;function Rje(){if(d7)return kk;d7=1;function e(t,r){return Object.keys(t).reduce(function(n,a){return n[a]=r(a,t[a]),n},{})}return kk=e,kk}var Ok,h7;function jje(){if(h7)return Ok;h7=1;var e=Rje();function t(r){return e(r,function(n,a){return typeof a=="boolean"?JSON.stringify(a):a})}return Ok=t,Ok}var Lk,f7;function Dje(){if(f7)return Lk;f7=1;var e=RQ(),t=jQ();function r(n){return function(a){var u;e.prototype.isPrototypeOf(a)?u=a:u=t(a);var f=Object.create(n);return f.client=u,f}}return Lk=r,Lk}var Rk,p7;function Nje(){if(p7)return Rk;p7=1;var e=V_(),t=Oje(),r=Lje(),n=jje(),a=Dje(),u={},f=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];return u.forwardGeocode=function(i){t.assertShape({query:t.required(t.string),mode:t.oneOf("mapbox.places","mapbox.places-permanent"),countries:t.arrayOf(t.string),proximity:t.oneOf(t.coordinates,"ip"),types:t.arrayOf(t.oneOf(f)),autocomplete:t.boolean,bbox:t.arrayOf(t.number),limit:t.number,language:t.arrayOf(t.string),routing:t.boolean,fuzzyMatch:t.boolean,worldview:t.string,session_token:t.string})(i),i.mode=i.mode||"mapbox.places";var y=n(e({country:i.countries},r(i,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview","session_token"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:r(i,["mode","query"]),query:y})},u.reverseGeocode=function(i){t.assertShape({query:t.required(t.coordinates),mode:t.oneOf("mapbox.places","mapbox.places-permanent"),countries:t.arrayOf(t.string),types:t.arrayOf(t.oneOf(f)),bbox:t.arrayOf(t.number),limit:t.number,language:t.arrayOf(t.string),reverseMode:t.oneOf("distance","score"),routing:t.boolean,worldview:t.string,session_token:t.string})(i),i.mode=i.mode||"mapbox.places";var y=n(e({country:i.countries},r(i,["country","types","bbox","limit","language","reverseMode","routing","worldview","session_token"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:r(i,["mode","query"]),query:y})},Rk=a(u),Rk}let zje="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",DQ=e=>crypto.getRandomValues(new Uint8Array(e)),NQ=(e,t,r)=>{let n=(2<<Math.log(e.length-1)/Math.LN2)-1,a=-~(1.6*n*t/e.length);return(u=t)=>{let f="";for(;;){let i=r(a),y=a|0;for(;y--;)if(f+=e[i[y]&n]||"",f.length===u)return f}}},Fje=(e,t=21)=>NQ(e,t,DQ),Bje=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((t,r)=>(r&=63,r<36?t+=r.toString(36):r<62?t+=(r-26).toString(36).toUpperCase():r>62?t+="-":t+="_",t),"");const $je=Object.freeze(Object.defineProperty({__proto__:null,customAlphabet:Fje,customRandom:NQ,nanoid:Bje,random:DQ,urlAlphabet:zje},Symbol.toStringTag,{value:"Module"})),Vje=Tne($je);var jk,m7;function Uje(){if(m7)return jk;m7=1;var e=Vje.nanoid;function t(r){this.origin=r.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=r.accessToken,this.version="0.3.0",this.pluginSessionID=this.generateSessionID(),this.sessionIncrementer=0,this.userAgent=this.getUserAgent(),this.options=r,this.send=this.send.bind(this),this.countries=r.countries?r.countries.split(","):null,this.types=r.types?r.types.split(","):null,this.bbox=r.bbox?r.bbox:null,this.language=r.language?r.language.split(","):null,this.limit=r.limit?+r.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(r),this.eventQueue=new Array,this.flushInterval=r.flushInterval||1e3,this.maxQueueSize=r.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}return t.prototype={select:function(r,n){var a=this.getEventPayload("search.select",n,{selectedFeature:r});if(a&&!(a.resultIndex===this.lastSentIndex&&a.queryString===this.lastSentInput||a.resultIndex==-1))return this.lastSentIndex=a.resultIndex,this.lastSentInput=a.queryString,this.push(a)},start:function(r){var n=this.getEventPayload("search.start",r);if(n)return this.push(n)},keyevent:function(r,n){if(r.key&&!(r.metaKey||[9,27,37,39,13,38,40].indexOf(r.keyCode)!==-1)){var a=this.getEventPayload("search.keystroke",n,{key:r.key});if(a)return this.push(a)}},send:function(r,n){if(!this.enableEventLogging)return n?n():void 0;var a=this.getRequestOptions(r);this.request(a,(function(u){if(u)return this.handleError(u,n);if(n)return n()}).bind(this))},getRequestOptions:function(r){Array.isArray(r)||(r=[r]);var n={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(r)};return n},getEventPayload:function(r,n,a={}){if(r==="search.select"&&!a.selectedFeature||r==="search.keystroke"&&!a.key)return null;var u;if(!n.options.proximity)u=null;else if(typeof n.options.proximity=="object")u=[n.options.proximity.longitude,n.options.proximity.latitude];else if(n.options.proximity==="ip"){var f=n._headers?n._headers["ip-proximity"]:null;f&&typeof f=="string"?u=f.split(",").map(parseFloat):u=[999,999]}else u=n.options.proximity;var i=n._map?n._map.getZoom():void 0,y={event:r,version:this.getEventSchemaVersion(r),created:+new Date,sessionIdentifier:this.getSessionId(),country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:n.options.autocomplete,fuzzyMatch:n.options.fuzzyMatch,proximity:u,limit:n.options.limit,routing:n.options.routing,worldview:n.options.worldview,mapZoom:i,keyboardLocale:this.locale};if(r==="search.select"?y.queryString=n.inputString:r!="search.select"&&n._inputEl?y.queryString=n._inputEl.value:y.queryString=n.inputString,["search.keystroke","search.select"].includes(r)&&(y.path="geocoding/v5/mapbox.places"),r==="search.keystroke"&&a.key)y.lastAction=a.key;else if(r==="search.select"&&a.selectedFeature){var w=a.selectedFeature,T=this.getSelectedIndex(w,n);if(y.resultIndex=T,y.resultPlaceName=w.place_name,y.resultId=w.id,w.properties&&(y.resultMapboxId=w.properties.mapbox_id),n._typeahead){var A=n._typeahead.data;A&&A.length>0&&(y.suggestionIds=this.getSuggestionIds(A),y.suggestionNames=this.getSuggestionNames(A),y.suggestionTypes=this.getSuggestionTypes(A),y.suggestionSources=this.getSuggestionSources(A))}}return this.validatePayload(y)?y:null},request:function(r,n){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(this.readyState==4)return this.status==204?n(null):n(this.statusText)},a.open(r.method,r.host+"/"+r.path,!0);for(var u in r.headers){var f=r.headers[u];a.setRequestHeader(u,f)}a.send(r.body)},handleError:function(r,n){if(n)return n(r)},generateSessionID:function(){return e()},getSessionId:function(){return this.pluginSessionID+"."+this.sessionIncrementer},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(r,n){if(n._typeahead){var a=n._typeahead.data,u=r.id,f=a.map(function(y){return y.id}),i=f.indexOf(u);return i}},getSuggestionIds:function(r){return r.map(function(n){return n.properties?n.properties.mapbox_id||"":n.id||""})},getSuggestionNames:function(r){return r.map(function(n){return n.place_name||""})},getSuggestionTypes:function(r){return r.map(function(n){return n.place_type&&Array.isArray(n.place_type)&&n.place_type[0]||""})},getSuggestionSources:function(r){return r.map(function(n){return n._source||""})},getEventSchemaVersion:function(r){return["search.keystroke","search.select"].includes(r)?"2.2":"2.0"},validatePayload:function(r){if(!r||!r.event)return!1;var n=["event","created","sessionIdentifier","queryString"],a=["event","created","sessionIdentifier","queryString","lastAction"],u=["event","created","sessionIdentifier","queryString","resultIndex","path","suggestionIds"],f=r.event;return f==="search.start"?this.objectHasRequiredProps(r,n):f==="search.keystroke"?this.objectHasRequiredProps(r,a):f==="search.select"?this.objectHasRequiredProps(r,u):!0},objectHasRequiredProps:function(r,n){return n.every(function(a){return a==="queryString"?typeof r[a]=="string"&&r[a].length>0:r[a]!==void 0})},shouldEnableLogging:function(r){return!(r.enableEventLogging===!1||r.origin&&r.origin!=="https://api.mapbox.com")},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(r,n){this.eventQueue.push(r),(this.eventQueue.length>=this.maxQueueSize||n)&&this.flush()},remove:function(){this.flush()}},jk=t,jk}var Dk,g7;function qje(){if(g7)return Dk;g7=1;var e={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"};return Dk={placeholder:e},Dk}var Jw={exports:{}},Gje=Jw.exports,y7;function Hje(){return y7||(y7=1,function(e){(function(t,r,n){e.exports?e.exports=n():t[r]=n()})(Gje,"subtag",function(){var t="",r=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function n(y){return y.match(r)||[]}function a(y){return n(y).filter(function(w,T){return w&&T})}function u(y){return y=n(y),{language:y[1]||t,extlang:y[2]||t,script:y[3]||t,region:y[4]||t}}function f(y,w,T){Object.defineProperty(y,w,{value:T,enumerable:!0})}function i(y,w,T){function A(k){return n(k)[y]||t}f(A,"pattern",w),f(u,T,A)}return i(1,/^[a-zA-Z]{2,3}$/,"language"),i(2,/^[a-zA-Z]{3}$/,"extlang"),i(3,/^[a-zA-Z]{4}$/,"script"),i(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),f(u,"split",a),u})}(Jw)),Jw.exports}var Nk,v7;function Wje(){if(v7)return Nk;v7=1;function e(){}return e.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const t={enableHighAccuracy:!0};return new Promise(function(r,n){window.navigator.geolocation.getCurrentPosition(r,n,t)})}},Nk=e,Nk}var zk,_7;function Zje(){if(_7)return zk;_7=1;function e(n,a){const u=t(n),f=["address","street","place","country"];var i;if(typeof a=="function")return a(u);const y=f.indexOf(a);return y===-1?i=f:i=f.slice(y),i.reduce(function(w,T){return u[T]?(w!==""&&(w=w+", "),w+u[T]):w},"")}function t(n){const a=n.address||"",u=n.text||"",f=n.place_name||"",y={address:f.split(",")[0],houseNumber:a,street:u,placeName:f};return n.context.forEach(function(w){const T=w.id.split(".")[0];y[T]=w.text}),y}return zk={transformFeatureToGeolocationText:e,getAddressInfo:t,REVERSE_GEOCODE_COORD_RGX:/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/},zk}var Fk,x7;function Xje(){if(x7)return Fk;x7=1;var e=mje(),t=gje(),r=V_(),n=yje().EventEmitter,a=vje(),u=Mje(),f=Nje(),i=Uje(),y=qje(),w=Hje(),T=Wje(),A=Zje();const k={FORWARD:0,LOCAL:1,REVERSE:2};function F(){var O=document.createElement("div");return O.className="mapboxgl-ctrl-geocoder--powered-by",O.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',O}function D(O){this._eventEmitter=new n,this.options=r({},this.options,O),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new T}return D.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(O){return O.place_name},render:function(O){var N=O.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+N[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+N.splice(1,N.length).join(",")+"</div></div>"}},_headers:{},addTo:function(O){function N(V,H){if(!document.body.contains(H))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const Z=V.onAdd();H.appendChild(Z)}if(O._controlContainer)O.addControl(this);else if(O instanceof HTMLElement)N(this,O);else if(typeof O=="string"){const V=document.querySelectorAll(O);if(V.length===0)throw new Error("Element ",O,"not found.");if(V.length>1)throw new Error("Geocoder can only be added to a single html element");N(this,V[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(O){if(O&&typeof O!="string"&&(this._map=O),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=f(u({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new i(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var N=this.container=document.createElement("div");N.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var V=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",t(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",(function(ce){this.eventManager.keyevent(ce,this)}).bind(this));var H=document.createElement("div");H.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var Z=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(Z),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),H.appendChild(this._clearEl),H.appendChild(this._loadingEl),N.appendChild(V),N.appendChild(this._inputEl),N.appendChild(H),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var J=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(J),H.appendChild(this._geolocateEl),this._showGeolocateButton()}var G=this._typeahead=new e(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),G.getItemValue=this.options.getItemValue;var Y=G.list.draw,ie=this._footerNode=F();return G.list.draw=function(){Y.call(this),ie.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),ie.addEventListener("mouseup",(function(){this.selectingListItem=!1}).bind(this)),this.element.appendChild(ie)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),N},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then((function(O){this._hideLoadingIcon();const N={geometry:{type:"Point",coordinates:[O.coords.longitude,O.coords.latitude]}};this._handleMarker(N),this._fly(N),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(N),this._showClearButton(),this.fresh=!1;const V={limit:1,language:[this.options.language],query:N.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const H=N.geometry.coordinates[0]+","+N.geometry.coordinates[1];this._setInputValue(H),this._eventEmitter.emit("result",{result:N})}else this.geocoderService.reverseGeocode(V).send().then((function(H){const Z=H.body.features[0];if(Z){const J=A.transformFeatureToGeolocationText(Z,this.options.addressAccuracy);this._setInputValue(J),Z.user_coordinates=N.geometry.coordinates,this._eventEmitter.emit("result",{result:Z})}else this._eventEmitter.emit("result",{result:{user_coordinates:N.geometry.coordinates}})}).bind(this))}).bind(this)).catch((function(O){O.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}).bind(this))},createIcon:function(O,N){var V=document.createElementNS("http://www.w3.org/2000/svg","svg");return V.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+O),V.setAttribute("viewBox","0 0 18 18"),V.setAttribute("xml:space","preserve"),V.setAttribute("width",18),V.setAttribute("height",18),V.innerHTML=N,V},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(O){this._inputEl.value=O,setTimeout((function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}).bind(this),1)},_onPaste:function(O){var N=(O.clipboardData||window.clipboardData).getData("text");N.length>=this.options.minLength&&this._geocode(N)},_onKeyDown:function(O){var N=27,V=9;if(O.keyCode===N&&this.options.clearAndBlurOnEsc)return this._clear(O),this._inputEl.blur();var H=O.target&&O.target.shadowRoot?O.target.shadowRoot.activeElement:O.target,Z=H?H.value:"";if(!Z)return this.fresh=!0,O.keyCode!==V&&this.clear(O),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(O.metaKey||[V,N,37,39,13,38,40].indexOf(O.keyCode)!==-1)&&H.value.length>=this.options.minLength&&this._geocode(H.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(O){this.options.clearOnBlur&&this._clearOnBlur(O),this.options.collapsed&&this._collapse()},_onChange:function(){var O=this._typeahead.selected;O&&JSON.stringify(O)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(O),this.options.marker&&this._mapboxgl&&this._handleMarker(O),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(O),this._eventEmitter.emit("result",{result:O}),this.eventManager.select(O,this))},_fly:function(O){var N;if(O.properties&&a[O.properties.short_code])N=r({},this.options.flyTo),this._map&&this._map.fitBounds(a[O.properties.short_code].bbox,N);else if(O.bbox){var V=O.bbox;N=r({},this.options.flyTo),this._map&&this._map.fitBounds([[V[0],V[1]],[V[2],V[3]]],N)}else{var H={zoom:this.options.zoom};N=r({},H,this.options.flyTo),O.center?N.center=O.center:O.geometry&&O.geometry.type&&O.geometry.type==="Point"&&O.geometry.coordinates&&(N.center=O.geometry.coordinates),this._map&&this._map.flyTo(N)}},_requestType:function(O,N){var V;return O.localGeocoderOnly?V=k.LOCAL:O.reverseGeocode&&A.REVERSE_GEOCODE_COORD_RGX.test(N)?V=k.REVERSE:V=k.FORWARD,V},_setupConfig:function(O,N){const V=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],H=/[\s,]+/;var Z=this,J=V.reduce(function(Y,ie){if(Z.options[ie]===void 0||Z.options[ie]===null)return Y;["countries","types","language"].indexOf(ie)>-1?Y[ie]=Z.options[ie].split(H):Y[ie]=Z.options[ie];const ce=typeof Z.options[ie].longitude=="number"&&typeof Z.options[ie].latitude=="number";if(ie==="proximity"&&ce){const ge=Z.options[ie].longitude,be=Z.options[ie].latitude;Y[ie]=[ge,be]}return Y},{});switch(O){case k.REVERSE:{var G=N.split(H).map(function(Y){return parseFloat(Y,10)});Z.options.flipCoordinates||G.reverse(),J.types&&J.types[0],J=r(J,{query:G,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(Y){Y in J&&delete J[Y]})}break;case k.FORWARD:{const Y=N.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(Y)&&(N=N.replace(/,/g," ")),J=r(J,{query:N})}break}return J.session_token=this.eventManager.getSessionId(),J},_geocode:function(O){this.inputString=O,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:O});const N=this._requestType(this.options,O),V=this._setupConfig(N,O);var H;switch(N){case k.LOCAL:H=Promise.resolve();break;case k.FORWARD:H=this.geocoderService.forwardGeocode(V).send();break;case k.REVERSE:H=this.geocoderService.reverseGeocode(V).send();break}var Z=this.options.localGeocoder?this.options.localGeocoder(O)||[]:[],J=[],G=null;return H.catch((function(Y){G=Y}).bind(this)).then((function(Y){this._hideLoadingIcon();var ie={};return Y?Y.statusCode=="200"&&(ie=Y.body,ie.request=Y.request,ie.headers=Y.headers,this._headers=Y.headers):ie={type:"FeatureCollection",features:[]},ie.config=V,this.fresh&&(this.eventManager.start(this),this.fresh=!1),ie.features&&ie.features.length&&ie.features.map(function(ce){ce._source="mapbox"}),ie.features=ie.features?Z.concat(ie.features):Z,this.options.externalGeocoder?(J=this.options.externalGeocoder(O,ie.features)||Promise.resolve([]),J.then(function(ce){return ie.features=ie.features?ce.concat(ie.features):ce,ie},function(){return ie})):ie}).bind(this)).then((function(Y){if(G)throw G;this.options.filter&&Y.features.length&&(Y.features=Y.features.filter(this.options.filter)),Y.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",Y),this._typeahead.update(Y.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",Y))}).bind(this)).catch((function(Y){this._hideLoadingIcon(),this._hideAttribution(),Z.length&&this.options.localGeocoder||J.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(Z)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:Z}),this._eventEmitter.emit("error",{error:Y})}).bind(this)),H},_clear:function(O){O&&O.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this.eventManager.sessionIncrementer++,this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(O){this._clear(O),this._inputEl.focus()},_clearOnBlur:function(O){var N=this;O.relatedTarget&&N._clear(O)},_onQueryResult:function(O){var N=O.body;if(N.features.length){var V=N.features[0];this._typeahead.selected=V,this._inputEl.value=V.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var O=this._map.getCenter().wrap();this.setProximity({longitude:O.lng,latitude:O.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(O){return this._geocode(O).then(this._onQueryResult),this},_renderError:function(){var O="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(O)},_renderLocationError:function(){var O="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(O)},_renderNoResults:function(){var O="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(O)},_renderUserDeniedGeolocationError:function(){var O="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(O)},_renderMessage:function(O){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(O)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var O=this.options.language.split(",")[0],N=w.language(O),V=y.placeholder[N];if(V)return V}return"Search"},setInput:function(O,N){return N===void 0&&(N=!1),this._inputEl.value=O,this._typeahead.selected=null,this._typeahead.clear(),O.length>=this.options.minLength&&(N?this._geocode(O):this._onChange()),this},setProximity:function(O,N=!0){return this.options.proximity=O,N&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(O){return O&&typeof O=="function"&&(this._typeahead.render=O),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(O){var N=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=O||this.options.language||N,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(O){return this.options.zoom=O,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(O){return this.options.flyTo=O,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(O){return this.options.placeholder=O||this._getPlaceholderText(),this._inputEl.placeholder=this.options.placeholder,this._inputEl.setAttribute("aria-label",this.options.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(O){return this.options.bbox=O,this},getCountries:function(){return this.options.countries},setCountries:function(O){return this.options.countries=O,this},getTypes:function(){return this.options.types},setTypes:function(O){return this.options.types=O,this},getMinLength:function(){return this.options.minLength},setMinLength:function(O){return this.options.minLength=O,this._typeahead&&(this._typeahead.options.minLength=O),this},getLimit:function(){return this.options.limit},setLimit:function(O){return this.options.limit=O,this._typeahead&&(this._typeahead.options.limit=O),this},getFilter:function(){return this.options.filter},setFilter:function(O){return this.options.filter=O,this},setOrigin:function(O){return this.options.origin=O,this.geocoderService=f(u({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(O){return this.options.accessToken=O,this.geocoderService=f(u({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(O){return this.options.autocomplete=O,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(O){return this.options.fuzzyMatch=O,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(O){return this.options.routing=O,this},getRouting:function(){return this.options.routing},setWorldview:function(O){return this.options.worldview=O,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(O){if(this._map){this._removeMarker();var N={color:"#4668F2"},V=r({},N,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(V),O.center?this.mapMarker.setLngLat(O.center).addTo(this._map):O.geometry&&O.geometry.type&&O.geometry.type==="Point"&&O.geometry.coordinates&&this.mapMarker.setLngLat(O.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(O,N){return this._eventEmitter.on(O,N),this},off:function(O,N){return this._eventEmitter.removeListener(O,N),this.eventManager.remove(),this}},Fk=D,Fk}var Kje=Xje();const Yje=vs(Kje),gR=({options:e,defaultValue:t,onValueChange:r})=>b.jsx("select",{defaultValue:t,onChange:n=>r(n.target.value),className:"text-sm px-2 py-1 border rounded",children:e.map(n=>b.jsx("option",{value:n.value,children:n.label},n.value))});lp.accessToken="pk.eyJ1IjoiaGVybmFuZGV6ODciLCJhIjoiY21hdDJnbzh6MDJpeDJsc2gyeDZwNTVxMCJ9.YXFT01T6B9sMX9Wj8WJmvQ";const Jje={streets:"mapbox://styles/mapbox/streets-v12",satellite:"mapbox://styles/mapbox/satellite-streets-v12",dark:"mapbox://styles/mapbox/dark-v11"},Qje=({googleApiKey:e,onSitesChange:t,defaultCoords:r=[],label:n="Localisation des sites"})=>{const a=j.useRef(null),u=j.useRef(null),[f,i]=j.useState("satellite"),[y,w]=j.useState([]),[T,A]=j.useState([]),[k,F]=j.useState(null),D=async()=>{try{const Z=await(await fetch(`https://www.googleapis.com/geolocation/v1/geolocate?key=${e}`,{method:"POST"})).json();return[Z.location.lat,Z.location.lng]}catch{return alert("Impossible d'obtenir la localisation GPS exacte"),null}};j.useEffect(()=>{if(!a.current)return;const H=new lp.Map({container:a.current,style:Jje[f],center:[9.7861,4.0615],zoom:13,pitch:45,bearing:-17.6,antialias:!0});u.current=H;const Z=new Yje({accessToken:lp.accessToken||"",mapboxgl:lp,marker:!1,placeholder:"🔍 Rechercher une adresse..."});if(H.addControl(Z),r.forEach(J=>{const[G,Y]=J.split(",").map(Number),ie=new lp.Marker({color:"blue"}).setLngLat([Y,G]).addTo(H);w(ce=>[...ce,ie]),A(ce=>[...ce,{coord:J,type:"gps_fixe"}])}),r.length>0){const[J,G]=r[0].split(",").map(Number);H.flyTo({center:[G,J],zoom:15})}return Z.on("result",J=>{const[G,Y]=J.result.center,ie=`${Y},${G}`;F(ie),H.flyTo({center:[G,Y],zoom:15})}),H.on("click",J=>{const G=`${J.lngLat.lat},${J.lngLat.lng}`;F(G)}),H.on("load",async()=>{const J=await D();if(J){const[G,Y]=J,ie=new lp.Marker({color:"red"}).setLngLat([Y,G]).setPopup(new lp.Popup().setText("📍 Ma position")).addTo(H);w(ce=>[...ce,ie]),A(ce=>[...ce,{coord:`${G},${Y}`,type:"gps_dynamique"}]),H.flyTo({center:[Y,G],zoom:16})}}),()=>H.remove()},[f]);const O=()=>{if(!k)return;const[H,Z]=k.split(",").map(Number),J=new lp.Marker({color:"blue"}).setLngLat([Z,H]).setPopup(new lp.Popup().setText(`Ajouté : ${k}`)).addTo(u.current);w(G=>[...G,J]),A(G=>[...G,{coord:k,type:"gps_fixe"}]),F(null)},N=H=>{y[H].remove(),w(J=>J.filter((G,Y)=>Y!==H));const Z=T.filter((J,G)=>G!==H);A(Z),t(Z.map(J=>J.coord))},V=(H,Z)=>{const J=[...T];J[H].type=Z,A(J)};return j.useEffect(()=>{t(T.map(H=>H.coord))},[T]),b.jsxs("div",{className:"space-y-4",children:[b.jsx("label",{className:"text-sm font-medium",children:n}),b.jsx("p",{className:"text-xs text-muted-foreground",children:"Cliquez sur la carte ou utilisez la recherche pour sélectionner un point. Validez ensuite avec le bouton."}),b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx("span",{className:"text-xs font-semibold",children:"🗺️ Style :"}),b.jsx(gR,{defaultValue:f,onValueChange:H=>i(H),options:[{label:"Satellite",value:"satellite"},{label:"Rue",value:"streets"},{label:"Nuit",value:"dark"}]}),b.jsx(cr,{disabled:!k,onClick:O,children:"📍 Ajouter ce point"})]}),b.jsx("div",{ref:a,className:"h-96 rounded border shadow"}),b.jsxs("div",{className:"space-y-2",children:[b.jsx("h4",{className:"text-sm font-bold",children:"📋 Points sélectionnés :"}),T.map((H,Z)=>b.jsxs("div",{className:"flex items-center justify-between bg-gray-100 p-2 rounded text-sm",children:[b.jsx("span",{children:H.coord}),b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx(gR,{defaultValue:H.type,onValueChange:J=>V(Z,J),options:[{label:"GPS Fixe",value:"gps_fixe"},{label:"GPS Dynamique",value:"gps_dynamique"}]}),b.jsx(cr,{size:"icon",variant:"ghost",onClick:()=>N(Z),children:b.jsx(Os,{className:"w-4 h-4"})})]})]},Z))]}),b.jsx(cr,{type:"button",variant:"secondary",onClick:()=>{y.forEach(H=>H.remove()),w([]),A([])},children:"🔄 Réinitialiser tous les points"})]})},eDe=({label:e="Photos de votre service",onImagesSelected:t,valeursExistantes:r=[]})=>{const[n,a]=j.useState([]),[u,f]=j.useState([]),i=j.useRef(null),y=j.useRef(null),[w,T]=j.useState(!1),[A,k]=j.useState(null),[F,D]=j.useState("");j.useEffect(()=>{a(r)},[r]);const O=Y=>{const ie=Array.from(Y.target.files||[]),ce=ie.map(ge=>URL.createObjectURL(ge));f(ge=>[...ge,...ie]),a(ge=>[...ge,...ce]),t([...u,...ie])},N=()=>{if(y.current&&i.current){const Y=y.current.getContext("2d");Y&&(Y.drawImage(i.current,0,0,320,240),y.current.toBlob(ie=>{if(ie){const ce=new File([ie],`photo_${Date.now()}.jpg`,{type:"image/jpeg"}),ge=URL.createObjectURL(ce);a(xe=>[...xe,ge]);const be=[...u,ce];f(be),t(be)}},"image/jpeg"))}},V=async()=>{try{const Y=await navigator.mediaDevices.getUserMedia({video:!0});k(Y),i.current&&(i.current.srcObject=Y),T(!0)}catch{alert("Impossible d'accéder à la caméra.")}},H=()=>{A&&A.getTracks().forEach(Y=>Y.stop()),T(!1)},Z=Y=>{const ie=[...n];ie.splice(Y,1);const ce=[...u];ce.splice(Y,1),a(ie),f(ce),t(ce)},J=()=>{F&&F.startsWith("http")&&(a(Y=>[...Y,F]),D(""))},G=()=>{if(!window.google||!window.google.accounts||!window.google.picker){alert("Google Picker non chargé. Vérifiez votre script loader.");return}new window.google.picker.PickerBuilder().addView(window.google.picker.ViewId.DOCS_IMAGES).setOAuthToken("VOTRE_TOKEN_OAUTH").setDeveloperKey("VOTRE_API_KEY").setCallback(ie=>{if(ie.action===window.google.picker.Action.PICKED){const ce=ie.docs[0].url;a(ge=>[...ge,ce])}}).build().setVisible(!0)};return b.jsxs("div",{className:"space-y-2",children:[b.jsx("label",{className:"text-sm font-medium",children:e}),b.jsx("p",{className:"text-xs text-muted-foreground",children:"Les images déjà enregistrées sont listées ci-dessous. Vous pouvez en ajouter via galerie, cloud, URL ou prise directe."}),b.jsx($i,{type:"file",accept:"image/*",multiple:!0,onChange:O}),b.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:n.map((Y,ie)=>b.jsxs("div",{className:"relative w-24 h-24 rounded overflow-hidden border shadow-sm",children:[b.jsx("img",{src:Y,alt:`img-${ie}`,className:"object-cover w-full h-full"}),b.jsx(cr,{variant:"ghost",size:"icon",onClick:()=>Z(ie),className:"absolute top-1 right-1 bg-white/80 text-red-500",children:b.jsx(Os,{size:16})})]},ie))}),b.jsxs("div",{className:"flex gap-2 items-center",children:[b.jsx($i,{type:"url",placeholder:"Coller une URL d'image",value:F,onChange:Y=>D(Y.target.value)}),b.jsxs(cr,{onClick:J,variant:"secondary",children:[b.jsx(lS,{size:16,className:"mr-1"}),"Ajouter URL"]})]}),b.jsxs(cr,{type:"button",variant:"outline",onClick:G,children:[b.jsx($ce,{className:"mr-2",size:16}),"Importer depuis Google Drive"]}),w?b.jsxs("div",{className:"mt-4 space-y-2",children:[b.jsx("video",{ref:i,autoPlay:!0,playsInline:!0,width:320,height:240,className:"border rounded"}),b.jsxs("div",{className:"flex gap-2 flex-wrap",children:[b.jsx(cr,{type:"button",onClick:N,children:"📷 Capturer"}),b.jsx(cr,{type:"button",variant:"destructive",onClick:H,children:"✅ Terminer la capture"})]}),b.jsx("canvas",{ref:y,width:320,height:240,className:"hidden"})]}):b.jsxs(cr,{type:"button",variant:"secondary",onClick:V,children:[b.jsx(ZW,{className:"mr-2",size:16}),"📸 Prendre une photo"]})]})},tDe=({label:e="🎙️ Ajoutez un message audio explicatif (facultatif)",valeurExistante:t,onAudioSelected:r})=>{const[n,a]=j.useState(null),[u,f]=j.useState(t||null),i=j.useRef(null);j.useEffect(()=>{t&&f(t)},[t]);const y=T=>{var k;const A=(k=T.target.files)==null?void 0:k[0];A&&(a(A),f(URL.createObjectURL(A)),r(A))},w=()=>{a(null),f(null),r(null),i.current&&(i.current.value="")};return b.jsxs("div",{className:"space-y-2",children:[b.jsx("label",{className:"text-sm font-medium",children:e}),b.jsx("p",{className:"text-xs text-muted-foreground",children:"Ce fichier sera analysé par l’IA pour mieux comprendre votre besoin. Formats supportés : MP3, WAV, AAC, etc."}),b.jsx($i,{type:"file",accept:"audio/*",ref:i,onChange:y}),u&&b.jsxs("div",{className:"mt-3 border rounded p-2 flex items-center gap-4 bg-gray-50",children:[b.jsx("audio",{controls:!0,src:u,className:"flex-1 rounded"}),b.jsx(cr,{type:"button",variant:"ghost",size:"icon",onClick:w,className:"text-red-500",title:"Supprimer le fichier audio",children:b.jsx(Os,{size:18})})]})]})},rDe=({label:e="Vidéo explicative",onVideoSelected:t,valeurExistante:r=""})=>{const[n,a]=j.useState(null),[u,f]=j.useState(null);j.useEffect(()=>{r&&a(r)},[r]);const i=w=>{var A;const T=((A=w.target.files)==null?void 0:A[0])||null;if(T){f(T);const k=URL.createObjectURL(T);a(k),t(T)}},y=()=>{f(null),a(null),t(null)};return b.jsxs("div",{className:"space-y-2",children:[b.jsx("label",{className:"text-sm font-medium",children:e}),b.jsxs("p",{className:"text-xs text-muted-foreground",children:["Vous pouvez charger une vidéo depuis votre appareil, ou visualiser celle déjà envoyée. ",b.jsx("br",{}),"Formats supportés : .mp4, .mov, .webm"]}),b.jsx($i,{type:"file",accept:"video/*",onChange:i}),n&&b.jsxs("div",{className:"relative mt-2 border rounded overflow-hidden",children:[b.jsx("video",{controls:!0,src:n,className:"w-full max-h-64"}),b.jsx(cr,{variant:"ghost",size:"icon",onClick:y,className:"absolute top-1 right-1 bg-white/80 text-red-500",children:b.jsx(Os,{size:16})})]})]})},nDe=({label:e="Fichier Excel (facultatif)",onExcelSelected:t,valeurExistante:r=""})=>{const[n,a]=j.useState(null),[u,f]=j.useState(null);j.useEffect(()=>{r&&f("Fichier Excel déjà importé")},[r]);const i=w=>{var A;const T=((A=w.target.files)==null?void 0:A[0])||null;T&&(a(T),f(T.name),t(T))},y=()=>{a(null),f(null),t(null)};return b.jsxs("div",{className:"space-y-2",children:[b.jsx("label",{className:"text-sm font-medium",children:e}),b.jsxs("p",{className:"text-xs text-muted-foreground",children:["Vous pouvez joindre un fichier Excel (.xlsx) pour enrichir la demande. ",b.jsx("br",{}),"Exemple : planning, tableau de stock, configuration personnalisée..."]}),b.jsx($i,{type:"file",accept:".xlsx, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onChange:i}),u&&b.jsxs("div",{className:"mt-2 flex items-center justify-between border p-2 rounded bg-gray-50",children:[b.jsx("span",{className:"text-sm text-gray-700 truncate",children:u}),b.jsx(cr,{variant:"ghost",size:"icon",onClick:y,children:b.jsx(Os,{size:16})})]})]})},iDe=({label:e="Documents justificatifs",onDocumentsSelected:t,valeursExistantes:r=[]})=>{const[n,a]=j.useState([]),[u,f]=j.useState([]);j.useEffect(()=>{f(r)},[r]);const i=w=>{const T=Array.from(w.target.files||[]),A=T.map(k=>URL.createObjectURL(k));a(k=>[...k,...T]),f(k=>[...k,...A]),t([...n,...T])},y=w=>{const T=[...u];T.splice(w,1);const A=[...n];A.splice(w,1),f(T),a(A),t(A)};return b.jsxs("div",{className:"space-y-2",children:[b.jsx("label",{className:"text-sm font-medium",children:e}),b.jsx("p",{className:"text-xs text-muted-foreground",children:"Vous pouvez joindre des fichiers PDF, Word, ou tout autre document justificatif utile."}),b.jsx($i,{type:"file",multiple:!0,accept:".pdf,.doc,.docx,.odt,.txt",onChange:i}),u.length>0&&b.jsx("ul",{className:"mt-2 space-y-1",children:u.map((w,T)=>b.jsxs("li",{className:"flex justify-between items-center bg-gray-50 px-2 py-1 rounded text-sm border",children:[b.jsx("span",{className:"truncate w-64",children:w.startsWith("blob:")?`Document ${T+1}`:w}),b.jsx(cr,{variant:"ghost",size:"icon",onClick:()=>y(T),className:"text-red-500",children:b.jsx(Os,{size:16})})]},T))})]})},b7=["Alimentaire","Électronique","Vêtements","Maison","Santé","Service","Transport","Éducation","Fournitures scolaires","Autre"],w7=["pièce","kg","g","l","ml","m","cm","m²","m³","heure","jour","mois","année","lot","carton"],S7=["XAF","EUR","USD"],E7=({value:e=[],onChange:t,label:r="Liste des produits",readonly:n=!1})=>{const[a,u]=j.useState(e),[f,i]=j.useState(null),[y,w]=j.useState(null),[T,A]=j.useState({nom:"",categorie:"Autre",quantite:1,unite:"pièce",prix:{montant:0,devise:"XAF"}});j.useEffect(()=>{const Z=Array.isArray(e)?e.map(J=>({...J,prix:J.prix||{montant:0,devise:"XAF"},nom:J.nom||"",categorie:J.categorie||"Autre",quantite:J.quantite||1,unite:J.unite||"pièce",marque:J.marque||""})):[];u(Z)},[e]);const k=()=>{if(!T.nom.trim())return;const Z=[...a,{...T}];u(Z),t(Z),A({nom:"",categorie:"Autre",quantite:1,unite:"pièce",prix:{montant:0,devise:"XAF"}})},F=Z=>{const J=a.filter((G,Y)=>Y!==Z);u(J),t(J)},D=(Z,J)=>{const G=[...a];G[Z]=J,u(G),t(G),i(null),w(null)},O=Z=>{i(Z),w({...a[Z]})},N=()=>{f!==null&&y&&D(f,y)},V=()=>{i(null),w(null)},H=j.useCallback(({produit:Z,index:J,isEditing:G})=>{var ie,ce;const Y={...Z,prix:Z.prix||{montant:0,devise:"XAF"},nom:Z.nom||"",categorie:Z.categorie||"Autre",quantite:Z.quantite||1,unite:Z.unite||"pièce",marque:Z.marque||""};return G&&y?b.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-300 rounded-lg p-4 shadow-lg",children:[b.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[b.jsxs("div",{className:"col-span-2",children:[b.jsx("label",{className:"text-xs font-semibold text-blue-800 mb-1 block",children:"Nom du produit"}),b.jsx($i,{value:y.nom,onChange:ge=>{w({...y,nom:ge.target.value})},placeholder:"Nom du produit",className:"w-full text-sm border-blue-200 focus:border-blue-400"})]}),b.jsxs("div",{children:[b.jsx("label",{className:"text-xs font-semibold text-blue-800 mb-1 block",children:"Catégorie"}),b.jsx("select",{value:y.categorie,onChange:ge=>{w({...y,categorie:ge.target.value})},className:"w-full text-sm px-2 py-1 border border-blue-200 rounded focus:border-blue-400",children:b7.map(ge=>b.jsx("option",{value:ge,children:ge},ge))})]}),b.jsxs("div",{children:[b.jsx("label",{className:"text-xs font-semibold text-blue-800 mb-1 block",children:"Marque"}),b.jsx($i,{value:y.marque||"",onChange:ge=>{w({...y,marque:ge.target.value})},placeholder:"Marque",className:"w-full text-sm border-blue-200 focus:border-blue-400"})]}),b.jsxs("div",{children:[b.jsx("label",{className:"text-xs font-semibold text-blue-800 mb-1 block",children:"Quantité"}),b.jsxs("div",{className:"flex gap-1",children:[b.jsx($i,{type:"number",value:y.quantite,onChange:ge=>{w({...y,quantite:parseInt(ge.target.value)||1})},className:"w-16 text-sm border-blue-200 focus:border-blue-400",min:1}),b.jsx("select",{value:y.unite,onChange:ge=>{w({...y,unite:ge.target.value})},className:"w-20 text-sm px-1 py-1 border border-blue-200 rounded focus:border-blue-400",children:w7.map(ge=>b.jsx("option",{value:ge,children:ge},ge))})]})]}),b.jsxs("div",{children:[b.jsx("label",{className:"text-xs font-semibold text-blue-800 mb-1 block",children:"Prix"}),b.jsxs("div",{className:"flex gap-1",children:[b.jsx($i,{type:"number",value:((ie=y.prix)==null?void 0:ie.montant)||0,onChange:ge=>{w({...y,prix:{...y.prix||{},montant:parseFloat(ge.target.value)||0}})},className:"w-20 text-sm border-blue-200 focus:border-blue-400",min:0}),b.jsx("select",{value:((ce=y.prix)==null?void 0:ce.devise)||"XAF",onChange:ge=>{w({...y,prix:{...y.prix||{},devise:ge.target.value}})},className:"w-16 text-sm px-1 py-1 border border-blue-200 rounded focus:border-blue-400",children:S7.map(ge=>b.jsx("option",{value:ge,children:ge},ge))})]})]})]}),b.jsxs("div",{className:"flex gap-2 mt-3",children:[b.jsxs(cr,{onClick:N,className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 text-xs flex items-center gap-1",children:[b.jsx(Uue,{className:"w-3 h-3"}),"Sauvegarder"]}),b.jsxs(cr,{onClick:V,className:"bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 text-xs flex items-center gap-1",children:[b.jsx(Os,{className:"w-3 h-3"}),"Annuler"]})]})]}):b.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm hover:shadow-md transition-all duration-200",children:b.jsxs("div",{className:"flex items-start justify-between mb-3",children:[b.jsxs("div",{className:"flex-1",children:[b.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[b.jsx(w4,{className:"w-4 h-4 text-blue-600"}),b.jsx("h3",{className:"font-semibold text-gray-800 text-sm",children:Y.nom}),Y.marque&&b.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full",children:Y.marque})]}),b.jsxs("div",{className:"grid grid-cols-2 gap-4 text-xs text-gray-600",children:[b.jsxs("div",{className:"flex items-center gap-1",children:[b.jsx(cue,{className:"w-3 h-3 text-green-600"}),b.jsxs("span",{className:"font-medium",children:[Y.quantite," ",Y.unite]})]}),b.jsxs("div",{className:"flex items-center gap-1",children:[b.jsx(Zce,{className:"w-3 h-3 text-orange-600"}),b.jsxs("span",{className:"font-medium",children:[Y.prix.montant.toLocaleString()," ",Y.prix.devise]})]})]}),b.jsx("div",{className:"mt-2",children:b.jsx("span",{className:"text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded",children:Y.categorie})})]}),!n&&b.jsxs("div",{className:"flex gap-1",children:[b.jsx(cr,{onClick:()=>O(J),className:"bg-blue-600 hover:bg-blue-700 text-white p-1 text-xs",size:"sm",children:b.jsx(JW,{className:"w-3 h-3"})}),b.jsx(cr,{onClick:()=>F(J),className:"bg-red-600 hover:bg-red-700 text-white p-1 text-xs",size:"sm",children:b.jsx(rZ,{className:"w-3 h-3"})})]})]})})},[y,n]);return b.jsxs("div",{className:"space-y-4",children:[b.jsx("div",{className:"flex items-center justify-between",children:b.jsxs("h3",{className:"font-bold text-gray-800 text-sm flex items-center gap-2",children:[b.jsx(w4,{className:"w-4 h-4 text-blue-600"}),r," (",a.length,")"]})}),b.jsx("div",{className:"grid gap-3",children:a.map((Z,J)=>b.jsx(H,{produit:Z,index:J,isEditing:f===J},J))}),!n&&b.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[b.jsxs("h4",{className:"font-semibold text-gray-700 text-sm mb-3 flex items-center gap-2",children:[b.jsx(S4,{className:"w-4 h-4 text-green-600"}),"Ajouter un produit"]}),b.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[b.jsxs("div",{className:"col-span-2",children:[b.jsx("label",{className:"text-xs font-semibold text-gray-700 mb-1 block",children:"Nom du produit"}),b.jsx($i,{value:T.nom,onChange:Z=>{A({...T,nom:Z.target.value})},placeholder:"Nom du produit",className:"w-full text-sm"})]}),b.jsxs("div",{children:[b.jsx("label",{className:"text-xs font-semibold text-gray-700 mb-1 block",children:"Catégorie"}),b.jsx("select",{value:T.categorie,onChange:Z=>{A({...T,categorie:Z.target.value})},className:"w-full text-sm px-2 py-1 border rounded",children:b7.map(Z=>b.jsx("option",{value:Z,children:Z},Z))})]}),b.jsxs("div",{children:[b.jsx("label",{className:"text-xs font-semibold text-gray-700 mb-1 block",children:"Marque"}),b.jsx($i,{value:T.marque||"",onChange:Z=>{A({...T,marque:Z.target.value})},placeholder:"Marque",className:"w-full text-sm"})]}),b.jsxs("div",{children:[b.jsx("label",{className:"text-xs font-semibold text-gray-700 mb-1 block",children:"Quantité"}),b.jsxs("div",{className:"flex gap-1",children:[b.jsx($i,{type:"number",value:T.quantite,onChange:Z=>{A({...T,quantite:parseInt(Z.target.value)||1})},className:"w-16 text-sm",min:1}),b.jsx("select",{value:T.unite,onChange:Z=>{A({...T,unite:Z.target.value})},className:"w-20 text-sm px-1 py-1 border rounded",children:w7.map(Z=>b.jsx("option",{value:Z,children:Z},Z))})]})]}),b.jsxs("div",{children:[b.jsx("label",{className:"text-xs font-semibold text-gray-700 mb-1 block",children:"Prix"}),b.jsxs("div",{className:"flex gap-1",children:[b.jsx($i,{type:"number",value:T.prix.montant,onChange:Z=>{A({...T,prix:{...T.prix,montant:parseFloat(Z.target.value)||0}})},className:"w-20 text-sm",min:0}),b.jsx("select",{value:T.prix.devise,onChange:Z=>{A({...T,prix:{...T.prix,devise:Z.target.value}})},className:"w-16 text-sm px-1 py-1 border rounded",children:S7.map(Z=>b.jsx("option",{value:Z,children:Z},Z))})]})]})]}),b.jsxs(cr,{onClick:k,disabled:!T.nom.trim(),className:"mt-3 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-4 py-2 text-sm flex items-center gap-2",children:[b.jsx(S4,{className:"w-4 h-4"}),"Ajouter le produit"]})]})]})},sDe=({value:e,onChange:t})=>{var n;const r=[{label:"🆕 Neuf",value:"neuf",description:"Bien jamais utilisé, encore sous garantie ou étiquette."},{label:"♻️ Occasion",value:"occasion",description:"Déjà utilisé, mais en bon état général."},{label:"🛠️ Réparable",value:"reparable",description:"Usagé ou endommagé mais potentiellement réutilisable."}];return b.jsxs("div",{className:"space-y-1",children:[b.jsxs("label",{className:"text-sm font-medium flex items-center gap-1",children:["État du bien",b.jsx(yue,{size:14,className:"text-muted-foreground"})]}),b.jsx("div",{className:"w-full sm:w-60",children:b.jsx(gR,{options:r.map(({label:a,value:u})=>({label:a,value:u})),defaultValue:e,onValueChange:t})}),b.jsx("p",{className:"text-xs text-muted-foreground",children:((n=r.find(a=>a.value===e))==null?void 0:n.description)||"Sélectionnez l'état du bien."})]})},oDe=({value:e="",onChange:t,placeholder:r="+237 690000000",label:n,required:a=!1})=>{const u=f=>{const i=f.target.value;(i===""||/^\+?\d*$/.test(i))&&t&&t(i)};return b.jsx("div",{className:"space-y-1",children:b.jsx($i,{type:"tel",placeholder:r,value:e,onChange:u,required:a,pattern:"^\\\\+?\\\\d+$",className:"tracking-wide w-full text-xs h-8 px-2 border-gray-300 bg-white focus:ring-1 focus:ring-orange-400 focus:border-orange-400"})})},zo=({children:e,isInContactBlock:t,isInInfoGeneraleBlock:r,label:n,obligatoire:a,tooltip:u,hasError:f})=>b.jsx("div",{className:`${t||r?"bg-transparent border-0 shadow-none":f?"bg-white rounded border-2 border-red-300 shadow-sm transition-all duration-200":"bg-white rounded border border-gray-200 shadow-sm hover:shadow hover:border-orange-200 transition-all duration-200"} overflow-hidden w-full max-w-sm mx-auto`,children:b.jsxs("div",{className:"p-2",children:[b.jsxs("div",{className:"flex items-center justify-between mb-1",children:[b.jsxs("label",{className:`text-xs font-bold flex items-center gap-1 ${f?"text-red-700":"text-gray-700"}`,children:[n,a&&b.jsx("span",{className:"text-orange-600 text-[10px] bg-orange-50 px-1 rounded",children:"*"})]}),u&&u.trim()&&b.jsx("span",{className:"text-[10px] text-gray-500 max-w-[150px] truncate",children:u})]}),e,f&&b.jsx("div",{className:"mt-1 text-xs text-red-600 font-medium",children:"⚠️ Ce champ est obligatoire"})]})}),Iw=({champ:e,valeurExistante:t,onChange:r,isInContactBlock:n=!1,isInInfoGeneraleBlock:a=!1,readonly:u=!1})=>{const[f,i]=j.useState(!1),[y,w]=j.useState(null),T=j.useCallback(H=>e.labelFrancais?e.labelFrancais:H.toLowerCase()==="email"?"Email":H.replace(/_/g," ").replace(/\b\w/g,Z=>Z.toUpperCase()).replace("Is ","").replace("Gps ","GPS ").replace("Url ","URL "),[e.labelFrancais]),A=j.useCallback(H=>u||H==="is_tarissable"||H==="is_tarissable_important"||H==="vitesse_tarissement",[u]),k=j.useCallback(H=>{r&&!u&&r(e.nomChamp,H)},[r,e.nomChamp,u]),F=j.useCallback(H=>{k(H),i(!1)},[k]),D=t||"",O=j.useMemo(()=>D,[D]),N=j.useMemo(()=>(e.nomChamp.toLowerCase().includes("whatsapp")||e.nomChamp.toLowerCase().includes("telephone")||e.nomChamp.toLowerCase().includes("email")||e.nomChamp.toLowerCase().includes("siteweb"))&&O&&typeof O=="string"&&O.trim()!=="",[e.nomChamp,O]),V=j.useMemo(()=>({isInContactBlock:n,isInInfoGeneraleBlock:a,label:T(e.nomChamp),obligatoire:!!e.obligatoire,tooltip:e.tooltip,hasError:!!e.obligatoire&&!O}),[n,a,T,e.nomChamp,e.obligatoire,e.tooltip,O]);if(e.nomChamp==="etat_bien"&&e.typeDonnee==="liste")return b.jsx(zo,{...V,children:b.jsx(sDe,{value:O,onChange:u?()=>{}:k})});if(e.typeDonnee==="listeproduit")return b.jsx(zo,{...V,children:b.jsx(E7,{value:Array.isArray(O)?O:[],onChange:k,label:T(e.nomChamp),readonly:u})});if(e.nomChamp.includes("gps")||e.typeDonnee==="gps")return b.jsxs(b.Fragment,{children:[b.jsx(zo,{...V,children:b.jsxs("div",{className:"relative",children:[b.jsxs("button",{type:"button",onClick:()=>!u&&i(!0),disabled:u,className:`w-full flex items-center justify-between text-xs h-8 px-2 border border-gray-300 rounded transition-colors ${u?"bg-gray-50 cursor-not-allowed text-gray-600":"bg-white hover:bg-gray-50 focus:ring-1 focus:ring-orange-400 focus:border-orange-400"}`,children:[b.jsxs("span",{className:"flex items-center gap-2",children:[b.jsx(ou,{className:"w-3 h-3 text-gray-500"}),O?"Modifier la position":"Sélectionner une position"]}),b.jsx("span",{className:"text-gray-400",children:"→"})]}),y&&b.jsx("div",{className:"mt-2",children:b.jsx("img",{src:y,alt:"Aperçu de la position",className:"w-full h-20 object-cover rounded border"})})]})}),f&&!u&&b.jsx(Aj,{onClose:()=>i(!1),onSelect:F})]});if(e.nomChamp.includes("gps")&&e.typeDonnee==="liste")return b.jsx(zo,{...V,children:b.jsx(Qje,{googleApiKey:"pk.eyJ1IjoiaGVybmFuZGV6ODciLCJhIjoiY21hdDJnbzh6MDJpeDJsc2gyeDZwNTVxMCJ9.YXFT01T6B9sMX9Wj8WJmvQ",defaultCoords:typeof O=="string"?[O]:Array.isArray(O)?O:[],onSitesChange:H=>k(H)})});if((e.nomChamp.toLowerCase().includes("telephone")||e.nomChamp.toLowerCase().includes("whatsapp"))&&(e.typeDonnee==="téléphone"||e.typeDonnee==="whatsapp"||e.typeDonnee==="string"||e.typeDonnee==="tel"))return b.jsx(zo,{...V,children:b.jsx(oDe,{value:O,onChange:k,placeholder:"Numéro de téléphone",required:!!e.obligatoire})});if(e.nomChamp.toLowerCase().includes("email"))return b.jsx(zo,{...V,children:b.jsx(ije,{value:O,onChange:k,placeholder:"Adresse email"})});if(e.composant==="input")return b.jsxs(zo,{...V,children:[b.jsx($i,{placeholder:e.exemple||"",value:O,onChange:H=>k(H.target.value),readOnly:A(e.nomChamp),type:e.typeDonnee==="whatsapp"||e.typeDonnee==="téléphone"?"tel":e.typeDonnee==="website"||e.typeDonnee==="url"?"url":"text",className:`w-full text-xs h-8 px-2 ${A(e.nomChamp)?"bg-gray-50 border-gray-200 cursor-not-allowed text-gray-600":N?"border-green-300 bg-green-50 focus:ring-1 focus:ring-green-400 focus:border-green-400":"border-gray-300 bg-white focus:ring-1 focus:ring-orange-400 focus:border-orange-400"}`}),e.nomChamp==="vitesse_tarissement"&&b.jsx("div",{className:"mt-1 text-[10px] text-blue-600 bg-blue-50 border border-blue-100 rounded px-2 py-1",children:"🤖 Déterminé automatiquement par l'IA selon votre service"}),N&&b.jsx("div",{className:"mt-1 text-[10px] text-green-600 bg-green-50 border border-green-100 rounded px-2 py-1",children:"✅ Pré-rempli depuis vos services précédents"})]});switch(e.composant){case"number":return b.jsx(zo,{...V,children:b.jsx($i,{type:"number",placeholder:e.exemple,value:O,onChange:H=>k(H.target.value),readOnly:A(e.nomChamp),className:`w-full text-xs h-8 px-2 ${A(e.nomChamp)?"bg-gray-50 border-gray-200 cursor-not-allowed text-gray-600":"border-gray-300 bg-white focus:ring-1 focus:ring-orange-400 focus:border-orange-400"}`})});case"checkbox":return b.jsx(zo,{...V,children:b.jsxs("div",{className:"flex items-center space-x-2",children:[b.jsx(kQ,{id:e.nomChamp,checked:!!O,onCheckedChange:k,disabled:A(e.nomChamp),className:"w-4 h-4"}),b.jsx("label",{htmlFor:e.nomChamp,className:"text-xs text-gray-700",children:e.tooltip||T(e.nomChamp)})]})});case"textarea":return b.jsx(zo,{...V,children:b.jsx(Sy,{placeholder:e.exemple,value:O,onChange:H=>k(H.target.value),readOnly:A(e.nomChamp),className:`w-full text-xs min-h-[60px] px-2 py-1 resize-none ${A(e.nomChamp)?"bg-gray-50 border-gray-200 cursor-not-allowed text-gray-600":"border-gray-300 bg-white focus:ring-1 focus:ring-orange-400 focus:border-orange-400"}`})});case"date":return b.jsx(zo,{...V,children:b.jsx(sje,{defaultValue:O,onChange:k})});case"tags":return b.jsx(zo,{...V,children:b.jsx(aje,{valeur:O,onChange:k})});case"object":return b.jsx(zo,{...V,children:b.jsx(lje,{valeur:O,onChange:k})});case"image":return b.jsx(zo,{...V,children:b.jsx(eDe,{valeursExistantes:O,onImagesSelected:H=>k(H)})});case"audio":return b.jsx(zo,{...V,children:b.jsx(tDe,{valeurExistante:O,onAudioSelected:H=>k(H)})});case"video":return b.jsx(zo,{...V,children:b.jsx(rDe,{valeurExistante:O,onVideoSelected:H=>k(H)})});case"excel":return b.jsx(zo,{...V,children:b.jsx(nDe,{valeurExistante:O,onExcelSelected:H=>k(H)})});case"document":return b.jsx(zo,{...V,children:b.jsx(iDe,{valeursExistantes:O,onDocumentsSelected:H=>k(H)})});case"array":return e.nomChamp.toLowerCase().includes("produit")||e.nomChamp.toLowerCase().includes("listeproduit")?b.jsx(zo,{...V,children:b.jsx(E7,{value:Array.isArray(O)?O:[],onChange:k,label:T(e.nomChamp),readonly:u})}):b.jsx(zo,{...V,children:b.jsxs("div",{className:"space-y-2",children:[b.jsxs("div",{className:"text-xs text-gray-600 bg-gray-50 p-2 rounded",children:["📋 Tableau de ",e.nomChamp," (",Array.isArray(O)?O.length:0," éléments)"]}),Array.isArray(O)&&O.length>0?b.jsx("div",{className:"max-h-32 overflow-y-auto space-y-1",children:O.map((H,Z)=>b.jsx("div",{className:"text-xs bg-white p-2 rounded border",children:typeof H=="object"?JSON.stringify(H,null,2):String(H)},Z))}):b.jsx("div",{className:"text-xs text-gray-500 text-center py-2",children:"Aucun élément dans ce tableau"})]})});default:return b.jsx(zo,{...V,children:b.jsx($i,{placeholder:e.exemple||"",value:O,onChange:H=>k(H.target.value),readOnly:A(e.nomChamp),className:`w-full text-xs h-8 px-2 ${A(e.nomChamp)?"bg-gray-50 border-gray-200 cursor-not-allowed text-gray-600":"border-gray-300 bg-white focus:ring-1 focus:ring-orange-400 focus:border-orange-400"}`})})}},aDe=()=>{Yn.success("Service créé avec succès !",{duration:5e3,icon:"✅"})},zQ=e=>{Yn.error(e||"Erreur lors de la création du service. Veuillez réessayer.",{duration:5e3,icon:"❌"})},lDe=({mediaFiles:e,onMediaChange:t,readonly:r=!1})=>{const[n,a]=j.useState(!1),[u,f]=j.useState("general"),i=j.useRef(null),y=V=>{V.preventDefault(),V.stopPropagation(),V.type==="dragenter"||V.type==="dragover"?a(!0):V.type==="dragleave"&&a(!1)},w=V=>{V.preventDefault(),V.stopPropagation(),a(!1),V.dataTransfer.files&&V.dataTransfer.files[0]&&A(V.dataTransfer.files)},T=V=>{V.target.files&&V.target.files[0]&&A(V.target.files)},A=V=>{console.log("📁 [MediaManager] Traitement de",V.length,"fichiers"),Array.from(V).forEach((H,Z)=>{console.log(`📄 [MediaManager] Fichier ${Z+1}:`,{name:H.name,type:H.type,size:H.size});const J=new FileReader;J.onload=G=>{var ce;const Y=(ce=G.target)==null?void 0:ce.result,ie=k(H);if(console.log(`📊 [MediaManager] Fichier ${Z+1} traité:`,{fileName:H.name,mediaType:ie,base64Length:Y==null?void 0:Y.length,hasBase64:!!Y}),ie){const ge={...e},be=ge[ie]||[];ge[ie]=[...be,Y],console.log(`✅ [MediaManager] Ajout à ${ie}:`,{avant:be.length,après:ge[ie].length,totalFichiers:Object.values(ge).flat().length}),t(ge)}else console.warn("⚠️ [MediaManager] Type de média non reconnu pour:",H.name,H.type)},J.onerror=G=>{console.error("❌ [MediaManager] Erreur lecture fichier:",H.name,G)},J.readAsDataURL(H)})},k=V=>V.type.startsWith("image/")?"images":V.type.startsWith("video/")?"videos":V.type.startsWith("audio/")?"audios":V.type.includes("document")||V.type.includes("pdf")?"documents":V.type.includes("spreadsheet")||V.type.includes("excel")?"excel":null,F=(V,H)=>{const Z={...e};Array.isArray(Z[V])&&(Z[V]=Z[V].filter((J,G)=>G!==H),t(Z))},D=V=>{switch(V){case"images":return b.jsx(Fv,{className:"w-4 h-4"});case"videos":return b.jsx(qm,{className:"w-4 h-4"});case"audios":return b.jsx(QW,{className:"w-4 h-4"});case"documents":return b.jsx(aS,{className:"w-4 h-4"});case"excel":return b.jsx(rue,{className:"w-4 h-4"});case"logo":return b.jsx(v4,{className:"w-4 h-4"});case"banner":return b.jsx(_4,{className:"w-4 h-4"});default:return b.jsx(aS,{className:"w-4 h-4"})}},O=V=>{switch(V){case"images":return"Images";case"videos":return"Vidéos";case"audios":return"Audios";case"documents":return"Documents";case"excel":return"Fichiers Excel";case"logo":return"Logo";case"banner":return"Bannière";default:return"Fichiers"}},N=Object.values(e).reduce((V,H)=>V+(Array.isArray(H)?H.length:0),0);return b.jsxs("div",{className:"space-y-3",children:[b.jsxs("div",{className:"flex space-x-1 bg-white rounded-lg p-1",children:[b.jsx("button",{onClick:()=>f("general"),className:`flex-1 py-2 px-3 text-xs font-medium rounded-md transition-colors ${u==="general"?"bg-blue-600 text-white":"text-gray-600 hover:text-gray-900"}`,children:"📁 Général"}),b.jsx("button",{onClick:()=>f("branding"),className:`flex-1 py-2 px-3 text-xs font-medium rounded-md transition-colors ${u==="branding"?"bg-blue-600 text-white":"text-gray-600 hover:text-gray-900"}`,children:"🎨 Identité visuelle"})]}),u==="general"&&b.jsxs(b.Fragment,{children:[!r&&b.jsxs("div",{className:`relative border-2 border-dashed rounded-lg p-6 text-center transition-colors ${n?"border-blue-400 bg-blue-50":"border-gray-300 bg-white hover:border-blue-300"}`,onDragEnter:y,onDragLeave:y,onDragOver:y,onDrop:w,children:[b.jsx(ade,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),b.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Glissez-déposez vos fichiers ici ou cliquez pour sélectionner"}),b.jsx("p",{className:"text-xs text-gray-500",children:"Images, vidéos, audios, documents, Excel"}),b.jsx("input",{ref:i,type:"file",multiple:!0,accept:"image/*,video/*,audio/*,.pdf,.doc,.docx,.xls,.xlsx",onChange:T,className:"hidden"}),b.jsx("button",{type:"button",onClick:()=>{var V;return(V=i.current)==null?void 0:V.click()},className:"mt-2 px-4 py-2 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors",children:"Sélectionner des fichiers"})]}),N>0&&b.jsxs("div",{className:"bg-white rounded p-3 border border-blue-200",children:[b.jsxs("h4",{className:"font-semibold text-sm text-blue-800 mb-3",children:["📊 Résumé des médias (",N," fichier",N>1?"s":"",")"]}),b.jsx("div",{className:"space-y-3",children:Object.entries(e).map(([V,H])=>!Array.isArray(H)||H.length===0||V==="logo"||V==="banner"?null:b.jsxs("div",{className:"border-l-4 border-blue-300 pl-3",children:[b.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[D(V),b.jsxs("span",{className:"font-medium text-sm text-gray-700",children:[O(V)," (",H.length,")"]})]}),b.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:H.map((Z,J)=>b.jsxs("div",{className:"relative group",children:[V==="images"?b.jsx("img",{src:Z,alt:`Image ${J+1}`,className:"w-full h-20 object-cover rounded border border-gray-200"}):b.jsx("div",{className:"w-full h-20 bg-gray-100 rounded border border-gray-200 flex items-center justify-center",children:D(V)}),!r&&b.jsx("button",{type:"button",onClick:()=>F(V,J),className:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:b.jsx(Os,{className:"w-3 h-3"})})]},J))})]},V))})]})]}),u==="branding"&&b.jsxs(b.Fragment,{children:[b.jsxs("div",{className:"bg-white rounded p-3 border border-blue-200",children:[b.jsxs("h4",{className:"font-semibold text-sm text-blue-800 mb-3 flex items-center gap-2",children:[b.jsx(v4,{className:"w-4 h-4"}),"Logo de votre service"]}),!r&&b.jsxs("div",{className:"mb-3",children:[b.jsx("input",{type:"file",accept:"image/*",onChange:V=>{if(V.target.files&&V.target.files[0]){const H=new FileReader;H.onload=Z=>{var G;const J={...e};J.logo=[(G=Z.target)==null?void 0:G.result],t(J)},H.readAsDataURL(V.target.files[0])}},className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),b.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Format recommandé : PNG ou SVG, taille max 2MB"})]}),e.logo&&e.logo.length>0&&b.jsxs("div",{className:"relative group",children:[b.jsx("img",{src:e.logo[0],alt:"Logo du service",className:"w-32 h-32 object-contain border border-gray-200 rounded"}),!r&&b.jsx("button",{type:"button",onClick:()=>{const V={...e};V.logo=[],t(V)},className:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:b.jsx(Os,{className:"w-3 h-3"})})]})]}),b.jsxs("div",{className:"bg-white rounded p-3 border border-blue-200",children:[b.jsxs("h4",{className:"font-semibold text-sm text-blue-800 mb-3 flex items-center gap-2",children:[b.jsx(_4,{className:"w-4 h-4"}),"Bannière de votre service"]}),!r&&b.jsxs("div",{className:"mb-3",children:[b.jsx("input",{type:"file",accept:"image/*",onChange:V=>{if(V.target.files&&V.target.files[0]){const H=new FileReader;H.onload=Z=>{var G;const J={...e};J.banner=[(G=Z.target)==null?void 0:G.result],t(J)},H.readAsDataURL(V.target.files[0])}},className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),b.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Format recommandé : JPG ou PNG, taille max 5MB, ratio 16:9 ou 3:1"})]}),e.banner&&e.banner.length>0&&b.jsxs("div",{className:"relative group",children:[b.jsx("img",{src:e.banner[0],alt:"Bannière du service",className:"w-full h-32 object-cover border border-gray-200 rounded"}),!r&&b.jsx("button",{type:"button",onClick:()=>{const V={...e};V.banner=[],t(V)},className:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:b.jsx(Os,{className:"w-3 h-3"})})]})]})]}),b.jsxs("div",{className:"text-xs text-gray-600 bg-gray-50 p-2 rounded",children:["💡 ",b.jsx("strong",{children:"Conseil :"})," Ajoutez des images de qualité pour attirer plus de clients. Un logo professionnel et une bannière attractive peuvent considérablement améliorer la présentation de votre service."]})]})};function cDe(){var Ve,Et,kt,Wt,Tt,Ht,ur,Jt,Rt;const e=Sc(),t=Mo(),{user:r,isLoading:n}=Rs(),a=((Ve=e.state)==null?void 0:Ve.suggestion)||{},{confidence:u,tokens_consumed:f}=a,i=((Et=e.state)==null?void 0:Et.mediaData)||{},y=((kt=e.state)==null?void 0:kt.gpsData)||{};(Wt=e.state)!=null&&Wt.type;const w=((Tt=e.state)==null?void 0:Tt.mode)||"edit",T=(Ht=e.state)==null?void 0:Ht.serviceId,[A,k]=j.useState(1),[F,D]=j.useState([]),[O,N]=j.useState(!1),[V,H]=j.useState({images:i.base64_image||[],audios:i.audio_base64||[],videos:i.video_base64||[],documents:i.doc_base64||[],excel:i.excel_base64||[],logo:i.logo||[],banner:i.banner||[]}),[Z,J]=j.useState(null),[G,Y]=j.useState(void 0),[ie,ce]=j.useState({}),[ge,be]=j.useState(null),[xe,Le]=j.useState(!1),[ze,Xe]=j.useState(!1),[Je,tt]=j.useState(null),{setStats:st}=j.useContext(VE),Ne=Dt=>{H(Dt)},We=async()=>{var Dt,sr,mr,Vr,rn,$r,Yr;if(r!=null&&r.id)try{const un=localStorage.getItem("token"),Fn=await Wn.get("/api/services/last",{headers:un?{Authorization:`Bearer ${un}`}:{}});if(Fn.data&&Object.keys(Fn.data).length>0){const vi={whatsapp:((Dt=Fn.data.whatsapp)==null?void 0:Dt.valeur)||Fn.data.whatsapp||"",telephone:((sr=Fn.data.telephone)==null?void 0:sr.valeur)||Fn.data.telephone||"",email:((mr=Fn.data.email)==null?void 0:mr.valeur)||Fn.data.email||"",website:((Vr=Fn.data.website)==null?void 0:Vr.valeur)||Fn.data.website||((rn=Fn.data.siteweb)==null?void 0:rn.valeur)||Fn.data.siteweb||(($r=Fn.data.site)==null?void 0:$r.valeur)||Fn.data.site||((Yr=Fn.data.url)==null?void 0:Yr.valeur)||Fn.data.url||""};Object.values(vi).some(Hr=>Hr&&Hr.trim()!=="")&&be(vi)}}catch(un){console.warn("Impossible de charger les contacts précédents:",un)}};j.useEffect(()=>{navigator.geolocation.getCurrentPosition(Dt=>{const sr=`${Dt.coords.latitude},${Dt.coords.longitude}`;Y(sr)},()=>{console.warn("Impossible de récupérer la position GPS")}),st({confidence:0,tokensUsed:0,tokensFactured:0,isProcessing:!1,inputLength:0,tokensCostXaf:void 0}),We()},[r==null?void 0:r.id]);const Ue=(Dt,sr)=>{ce(mr=>({...mr,[Dt]:sr}))},De=()=>{const Dt=[];return F.forEach(sr=>{if(sr.obligatoire){const mr=ie[sr.nomChamp];if(!mr||typeof mr=="string"&&mr.trim()===""){const Vr=sr.labelFrancais||sr.nomChamp.replace(/_/g," ").replace(/\b\w/g,rn=>rn.toUpperCase());Dt.push(`${Vr} est obligatoire`)}}}),Dt},Ke=async()=>{var sr;if(O)return;const Dt=De();if(Dt.length>0){Yn.error(`⚠️ Veuillez remplir les champs obligatoires :
${Dt.join(`
`)}`,{duration:6e3});return}try{N(!0);let mr,Vr=null;if(T){const Yr={texte:F.map(un=>`${un.nomChamp}: ${ie[un.nomChamp]||""}`).join(`
`),intention:"creation_service",base64_image:V.images,audio_base64:V.audios,video_base64:V.videos,doc_base64:V.documents,excel_base64:V.excel,logo:V.logo,banner:V.banner};mr=await Wn.put(`/api/services/${T}`,Yr,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})}else{const Yr={texte:F.map(wn=>`${wn.nomChamp}: ${ie[wn.nomChamp]||""}`).join(`
`),intention:"creation_service",base64_image:V.images,audio_base64:V.audios,video_base64:V.videos,doc_base64:V.documents,excel_base64:V.excel,logo:V.logo,banner:V.banner};console.log("[FormulaireYukpoIntelligent] Données brutes pour génération IA:",Yr),Vr=await Xve({texte:Yr.texte||"",base64_image:Yr.base64_image||[],audio_base64:Yr.audio_base64||[],video_base64:Yr.video_base64||[],doc_base64:Yr.doc_base64||[],excel_base64:Yr.excel_base64||[],logo:Yr.logo||[],banner:Yr.banner||[]}),console.log("[FormulaireYukpoIntelligent] Réponse IA reçue:",Vr);const un=Vr.data.tokens_consumed||Vr.data.tokens_used||Vr.data.tokens||0;console.log("[FormulaireYukpoIntelligent] Tokens IA externes consommés:",un);const vi=Math.round(un*.004*100);console.log("💰 [FormulaireYukpoIntelligent] Coût RÉEL calculé:",vi,"FCFA pour",un,"tokens");try{const wn=localStorage.getItem("token");if(!wn){Yn.error("❌ Vous devez être connecté pour créer un service");return}const xi=await fetch("/api/users/balance",{headers:{Authorization:`Bearer ${wn}`}});if(!xi.ok){Yn.error("❌ Impossible de vérifier votre solde. Veuillez réessayer.");return}const Ui=(await xi.json()).tokens_balance||0;if(console.log("💰 [FormulaireYukpoIntelligent] Solde actuel:",Ui),Ui<vi){Yn.error(`💸 Solde insuffisant !

Coût réel : ${vi.toLocaleString()} FCFA
Votre solde : ${Ui.toLocaleString()} FCFA

Veuillez recharger votre compte avant de créer ce service.`,{duration:1e4});return}if(!window.confirm(`💰 Création de service

Coût réel : ${vi.toLocaleString()} FCFA
Tokens consommés : ${un.toLocaleString()}
Votre solde : ${Ui.toLocaleString()} FCFA
Solde après création : ${(Ui-vi).toLocaleString()} FCFA

Confirmez-vous la création de ce service ?`))return}catch(wn){console.error("❌ [FormulaireYukpoIntelligent] Erreur vérification solde:",wn),Yn.error("❌ Erreur lors de la vérification du solde. Veuillez réessayer.");return}const xr=Vr.data;console.log("[FormulaireYukpoIntelligent] JSON structuré généré:",xr);let Hr=xr;xr.service_data&&xr.service_data.data?(Hr=xr.service_data.data,console.log("[FormulaireYukpoIntelligent] Données de service extraites depuis service_data.data:",Hr)):xr.data&&(Hr=xr.data,console.log("[FormulaireYukpoIntelligent] Données de service extraites depuis data:",Hr)),console.log("[FormulaireYukpoIntelligent] Transmission tokens IA externe au backend:",un),mr=await $X(Hr,un),console.log("[FormulaireYukpoIntelligent] Service créé avec succès:",mr)}window.dispatchEvent(new CustomEvent("service_created")),localStorage.setItem("force_refresh_services",Date.now().toString());let rn=0,$r=0;if(Vr)$r=Vr.data.tokens_consumed||Vr.data.tokens_used||Vr.data.tokens||0,rn=Math.round($r*.004*100),console.log("[FormulaireYukpoIntelligent] Coût réel utilisé pour le toast:",rn,"FCFA");else{mr.data&&typeof mr.data=="object"&&($r=mr.data.tokens_consumed||mr.data.tokens_used||mr.data.tokens||0);let Yr=null;if(mr.headers)if(typeof mr.headers.get=="function")Yr=mr.headers.get("x-tokens-cost-xaf");else{const un=mr.headers;Yr=un["x-tokens-cost-xaf"]?String(un["x-tokens-cost-xaf"]):null}Yr?rn=parseInt(Yr,10)||0:(rn=Math.round($r*.004*10),console.log("[FormulaireYukpoIntelligent] Coût calculé localement (fallback):",rn))}st({confidence:95,tokensUsed:$r,tokensFactured:$r,isProcessing:!1,inputLength:F.map(Yr=>ie[Yr.nomChamp]||"").join(" ").length||0,tokensCostXaf:rn}),console.log("[FormulaireYukpoIntelligent] Coût final pour le toast:",rn,"FCFA"),tt({serviceId:((sr=mr.data)==null?void 0:sr.id)||"nouveau",cout:rn}),Xe(!0),setTimeout(()=>{t("/dashboard/mes-services")},5e3)}catch(mr){console.error("Erreur lors de la création du service:",mr),st({confidence:0,tokensUsed:0,tokensFactured:0,isProcessing:!1,inputLength:0,tokensCostXaf:0}),zQ(mr.message||"Erreur lors de la création du service")}finally{N(!1)}};j.useEffect(()=>{console.log("[FormulaireYukpoIntelligent] useEffect déclenché - suggestion:",a),console.log("[FormulaireYukpoIntelligent] Type de suggestion:",typeof a),console.log("[FormulaireYukpoIntelligent] Clés de suggestion:",a?Object.keys(a):"null"),console.log("[FormulaireYukpoIntelligent] suggestion.data:",a==null?void 0:a.data);let Dt,sr={};const mr=a&&typeof a=="object"&&Object.keys(a).length>0&&a.data&&typeof a.data=="object"&&(a.data.titre_service||a.data.category||a.data.description);if(console.log("[FormulaireYukpoIntelligent] hasValidIAData:",mr),mr){console.log("[FormulaireYukpoIntelligent] Utilisation des données de l'IA:",a.data),console.log("[FormulaireYukpoIntelligent] Appel de dispatchChampsFormulaireIA avec:",a);const Vr=mR(a);if(console.log("[FormulaireYukpoIntelligent] Résultat de dispatchChampsFormulaireIA:",Vr),console.log("[FormulaireYukpoIntelligent] Type de composantsGeneres:",typeof Vr),console.log("[FormulaireYukpoIntelligent] Longueur de composantsGeneres:",Vr==null?void 0:Vr.length),Dt=Vr,Dt==null||Dt.forEach(rn=>{const $r=a.data[rn.nomChamp];console.log(`[FormulaireYukpoIntelligent] Données pour ${rn.nomChamp}:`,$r),$r&&(typeof $r=="object"&&"valeur"in $r?(sr[rn.nomChamp]=$r.valeur,console.log(`[FormulaireYukpoIntelligent] Valeur extraite (format objet) pour ${rn.nomChamp}:`,$r.valeur)):(sr[rn.nomChamp]=$r,console.log(`[FormulaireYukpoIntelligent] Valeur extraite (format direct) pour ${rn.nomChamp}:`,$r)))}),y.gps_fixe){console.log("[FormulaireYukpoIntelligent] Données GPS reçues:",y);let rn=y.gps_fixe;if(typeof rn=="string"&&rn.startsWith("["))try{const $r=JSON.parse(rn);if(Array.isArray($r)&&$r.length>0){const Yr=$r[0];Yr.lat&&Yr.lng&&(rn=`${Yr.lat},${Yr.lng}`,console.log("[FormulaireYukpoIntelligent] GPS converti en format simple:",rn))}}catch($r){console.warn("[FormulaireYukpoIntelligent] Erreur parsing GPS:",$r)}sr.gps_fixe=rn,console.log("[FormulaireYukpoIntelligent] GPS fixe appliqué:",rn)}}else{console.log("[FormulaireYukpoIntelligent] Génération de composants par défaut...");const Vr={intention:"creation_service",data:{titre_service:{type_donnee:"string",valeur:"",origine_champs:"formulaire"},category:{type_donnee:"string",valeur:"",origine_champs:"formulaire"},description:{type_donnee:"string",valeur:"",origine_champs:"formulaire"},is_tarissable:{type_donnee:"boolean",valeur:!0,origine_champs:"formulaire"},whatsapp:{type_donnee:"string",valeur:"",origine_champs:"formulaire"},telephone:{type_donnee:"string",valeur:"",origine_champs:"formulaire"},email:{type_donnee:"string",valeur:"",origine_champs:"formulaire"},website:{type_donnee:"string",valeur:"",origine_champs:"formulaire"}}};Dt=mR(Vr),Dt==null||Dt.forEach(rn=>{const $r=Vr.data[rn.nomChamp];$r&&(sr[rn.nomChamp]=$r.valeur)})}Dt&&Dt.length>0&&(console.log("[FormulaireYukpoIntelligent] Composants générés:",Dt),console.log("[FormulaireYukpoIntelligent] Valeurs à appliquer:",sr),console.log("[FormulaireYukpoIntelligent] Nombre de composants:",Dt.length),console.log("[FormulaireYukpoIntelligent] Nombre de valeurs:",Object.keys(sr).length),Dt.forEach(Vr=>{const rn=sr[Vr.nomChamp];console.log(`[FormulaireYukpoIntelligent] Composant ${Vr.nomChamp}: valeur =`,rn)}),D(Dt),ce(sr))},[a]);const lt=j.useMemo(()=>{const Dt={base:[],contact:[],gpsFixe:null,listeProduits:null,autres:[]};return F.forEach(sr=>{sr.nomChamp==="gps_fixe"?Dt.gpsFixe=sr:sr.nomChamp==="liste_produits"?Dt.listeProduits=sr:["whatsapp","telephone","email","website"].includes(sr.nomChamp)?Dt.contact.push(sr):["titre_service","category","description","is_tarissable"].includes(sr.nomChamp)?Dt.base.push(sr):Dt.autres.push(sr)}),Dt},[F]),Ye=()=>{if(ie.gps_fixe)return{coords:ie.gps_fixe,source:"Modifiées dans le formulaire",isRealTime:!1};if(y.gps_fixe_coords)try{const Dt=JSON.parse(y.gps_fixe_coords);if(Array.isArray(Dt)&&Dt.length>0){const{lat:sr,lng:mr}=Dt[0];return{coords:`${sr.toFixed(6)}, ${mr.toFixed(6)}`,source:"Sélectionnées sur la carte",isRealTime:!1}}}catch(Dt){console.warn("[FormulaireYukpoIntelligent] Erreur parsing GPS sélectionné:",Dt)}return G?{coords:G,source:"Position actuelle",isRealTime:!0}:null};return n?b.jsx(Ka,{children:b.jsx("div",{className:"flex items-center justify-center min-h-screen",children:b.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-orange-600"})})}):b.jsxs(Ka,{children:[b.jsx(nZ,{}),b.jsxs("div",{className:"container mx-auto px-4 py-8",children:[b.jsxs("div",{className:"mb-6 flex justify-between items-start",children:[b.jsx("button",{onClick:()=>t("/"),className:"text-orange-600 hover:text-orange-800 font-medium flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-orange-50 transition-colors",children:"← 🏠 Retour à l'accueil"}),b.jsxs("div",{className:"text-red-600 text-sm bg-red-50 px-3 py-2 rounded-lg border border-red-200",children:["⚠️ ",b.jsx("strong",{children:"Rappel :"})," Les champs marqués d'un astérisque (*) sont obligatoires"]})]}),F.length>0?b.jsxs("div",{className:"space-y-3",children:[lt.base.length>0&&b.jsxs("div",{className:"p-2 space-y-2",children:[b.jsx("h3",{className:"font-bold text-sm text-center text-white bg-blue-500 rounded py-1 mb-1 max-w-sm mx-auto",children:"📝 Informations générales"}),b.jsx("div",{className:"space-y-2",children:lt.base.map((Dt,sr)=>b.jsx(Iw,{champ:Dt,valeurExistante:ie[Dt.nomChamp],onChange:Ue,readonly:w==="readonly"},`${Dt.nomChamp}-${sr}`))})]}),lt.listeProduits&&b.jsxs("div",{className:"p-2 space-y-2",children:[b.jsx("h3",{className:"font-bold text-sm text-center text-white bg-green-500 rounded py-1 mb-1 max-w-sm mx-auto",children:"📦 Liste des produits"}),b.jsx("div",{children:b.jsx(Iw,{champ:lt.listeProduits,valeurExistante:ie[lt.listeProduits.nomChamp],onChange:Ue,readonly:w==="readonly"},lt.listeProduits.nomChamp)})]}),lt.contact.length>0&&b.jsxs("div",{className:"p-2 space-y-2",children:[b.jsx("h3",{className:"font-bold text-sm text-center text-white bg-orange-500 rounded py-1 mb-1 max-w-sm mx-auto",children:"📞 Contact"}),b.jsx("div",{className:"space-y-2",children:lt.contact.map((Dt,sr)=>b.jsx(Iw,{champ:Dt,valeurExistante:ie[Dt.nomChamp],onChange:Ue,isInContactBlock:!0,readonly:w==="readonly"},`${Dt.nomChamp}-${sr}`))})]}),lt.gpsFixe&&b.jsxs("div",{className:"p-2 space-y-2",children:[b.jsx("h3",{className:"font-bold text-sm text-center text-white bg-purple-500 rounded py-1 mb-1 max-w-sm mx-auto",children:"🎯 Position GPS fixe"}),b.jsx("div",{children:b.jsx(Iw,{champ:lt.gpsFixe,valeurExistante:ie[lt.gpsFixe.nomChamp],onChange:Ue,readonly:w==="readonly"},lt.gpsFixe.nomChamp)})]}),b.jsxs("div",{className:"p-2 space-y-2",children:[b.jsx("h3",{className:"font-bold text-sm text-center text-white bg-blue-500 rounded py-1 mb-1 max-w-sm mx-auto",children:"📍 Localisation du service"}),b.jsx("div",{className:"space-y-2",children:b.jsxs("div",{className:"bg-gray-50 rounded p-2 max-w-sm mx-auto",children:[b.jsx("label",{className:"text-xs font-bold text-gray-700 mb-1 block",children:"🎯 Position GPS fixe (optionnel)"}),b.jsxs("div",{className:"relative",children:[b.jsxs("button",{type:"button",onClick:()=>w!=="readonly"&&Le(!0),disabled:w==="readonly",className:`w-full flex items-center justify-between text-xs h-8 px-2 border border-gray-300 rounded transition-colors ${w==="readonly"?"bg-gray-50 cursor-not-allowed text-gray-600":"bg-white hover:bg-gray-50 focus:ring-1 focus:ring-green-400 focus:border-green-400"}`,children:[b.jsxs("span",{className:"flex items-center gap-2",children:[b.jsx(ou,{className:"w-3 h-3 text-gray-500"}),ie.gps_fixe?"Modifier la position":"Sélectionner une position"]}),b.jsx("span",{className:"text-gray-400",children:"▼"})]}),Ye()&&b.jsxs("div",{className:"mt-2 text-xs text-green-600",children:["✅ Position GPS enregistrée: ",(ur=Ye())==null?void 0:ur.coords,b.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["📍 ",(Jt=Ye())==null?void 0:Jt.source,(Rt=Ye())!=null&&Rt.isRealTime?" (temps réel)":""]})]})]}),b.jsxs("div",{className:"mt-2 text-xs text-gray-600 bg-gray-50 p-2 rounded",children:["💡 ",b.jsx("strong",{children:"Conseil :"})," Renseignez ce champ si votre service est basé dans un lieu fixe (boutique, bureau, atelier). Cela aide les clients à vous localiser plus facilement."]}),xe&&w!=="readonly"&&b.jsx(Aj,{onClose:()=>Le(!1),onSelect:Dt=>{Ue("gps_fixe",Dt),Le(!1)}})]})})]}),b.jsxs("div",{className:"p-2 space-y-2",children:[b.jsx("h3",{className:"font-bold text-sm text-center text-white bg-orange-500 rounded py-1 mb-1 max-w-sm mx-auto",children:"📁 Médias du service"}),b.jsx("div",{className:"space-y-2",children:b.jsx("div",{className:"max-w-sm mx-auto",children:b.jsx(lDe,{mediaFiles:V,onMediaChange:Ne,readonly:w==="readonly"})})})]}),b.jsxs("div",{className:"p-2 space-y-2",children:[b.jsx("h3",{className:"font-bold text-sm text-center text-white bg-red-500 rounded py-1 mb-1 max-w-sm mx-auto",children:"🎉 Promotion et Offres"}),b.jsx("div",{className:"space-y-2",children:b.jsxs("div",{className:"max-w-sm mx-auto",children:[b.jsxs("label",{className:"flex items-center gap-2 text-xs font-bold text-gray-700 mb-2",children:[b.jsx("input",{type:"checkbox",checked:ie.promotion_active||!1,onChange:Dt=>Ue("promotion_active",Dt.target.checked),disabled:w==="readonly",className:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500"}),"Activer une promotion pour ce service"]}),ie.promotion_active&&b.jsxs("div",{className:"space-y-3 mt-3",children:[b.jsxs("div",{children:[b.jsx("label",{className:"text-xs font-bold text-gray-700 mb-1 block",children:"🏷️ Type de promotion"}),b.jsxs("select",{value:ie.promotion_type||"reduction",onChange:Dt=>Ue("promotion_type",Dt.target.value),disabled:w==="readonly",className:"w-full text-xs p-2 border border-gray-300 rounded focus:ring-1 focus:ring-orange-400 focus:border-orange-400",children:[b.jsx("option",{value:"reduction",children:"Réduction"}),b.jsx("option",{value:"offre",children:"Offre spéciale"}),b.jsx("option",{value:"bon_plan",children:"Bon plan"}),b.jsx("option",{value:"flash",children:"Offre flash"})]})]}),b.jsxs("div",{children:[b.jsx("label",{className:"text-xs font-bold text-gray-700 mb-1 block",children:"💰 Valeur de la promotion"}),b.jsx("input",{type:"text",placeholder:"ex: 20%, 50€, Gratuit",value:ie.promotion_valeur||"",onChange:Dt=>Ue("promotion_valeur",Dt.target.value),disabled:w==="readonly",className:"w-full text-xs p-2 border border-gray-300 rounded focus:ring-1 focus:ring-orange-400 focus:border-orange-400"})]}),b.jsxs("div",{children:[b.jsx("label",{className:"text-xs font-bold text-gray-700 mb-1 block",children:"📝 Description de la promotion"}),b.jsx("textarea",{placeholder:"Décrivez votre offre promotionnelle...",value:ie.promotion_description||"",onChange:Dt=>Ue("promotion_description",Dt.target.value),disabled:w==="readonly",rows:2,className:"w-full text-xs p-2 border border-gray-300 rounded focus:ring-1 focus:ring-orange-400 focus:border-orange-400"})]}),b.jsxs("div",{children:[b.jsx("label",{className:"text-xs font-bold text-gray-700 mb-1 block",children:"📅 Date de fin de promotion"}),b.jsx("input",{type:"date",value:ie.promotion_date_fin||"",onChange:Dt=>Ue("promotion_date_fin",Dt.target.value),disabled:w==="readonly",min:new Date().toISOString().split("T")[0],className:"w-full text-xs p-2 border border-gray-300 rounded focus:ring-1 focus:ring-orange-400 focus:border-orange-400"})]}),b.jsxs("div",{children:[b.jsx("label",{className:"text-xs font-bold text-gray-700 mb-1 block",children:"⚠️ Conditions (optionnel)"}),b.jsx("textarea",{placeholder:"Conditions spéciales, limitations...",value:ie.promotion_conditions||"",onChange:Dt=>Ue("promotion_conditions",Dt.target.value),disabled:w==="readonly",rows:2,className:"w-full text-xs p-2 border border-gray-300 rounded focus:ring-1 focus:ring-orange-400 focus:border-orange-400"})]})]}),b.jsxs("div",{className:"mt-2 text-xs text-gray-600 bg-gray-50 p-2 rounded",children:["💡 ",b.jsx("strong",{children:"Conseil :"})," Les promotions attirent l'attention et peuvent augmenter vos chances d'être contacté. Pensez à des offres attractives comme des réductions, des services gratuits ou des bonus."]})]})})]}),F.length>0&&b.jsx("div",{className:"flex justify-center pt-4",children:w==="readonly"?b.jsx(cr,{onClick:()=>t("/dashboard/mes-services"),className:"bg-gray-600 hover:bg-gray-700 text-white px-8 py-3 font-semibold",children:"🔙 Retour à mes services"}):b.jsx(cr,{onClick:Ke,disabled:O,className:"bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 text-white px-8 py-3 font-semibold shadow-lg",children:O?b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Création en cours..."]}):"🚀 Créer ce service"})})]}):b.jsx("div",{className:"text-center py-8",children:b.jsx("p",{className:"text-gray-500",children:"Aucun composant à afficher"})}),ze&&Je&&b.jsx("div",{className:"fixed top-4 right-4 bg-green-500 text-white p-6 rounded-lg shadow-xl z-50 max-w-md",children:b.jsxs("div",{className:"flex items-start gap-3",children:[b.jsx("div",{className:"flex-shrink-0",children:b.jsx("div",{className:"w-8 h-8 bg-green-400 rounded-full flex items-center justify-center",children:b.jsx("span",{className:"text-green-800 text-xl",children:"✅"})})}),b.jsxs("div",{className:"flex-1",children:[b.jsx("h3",{className:"font-bold text-lg mb-2",children:"🎉 Service créé avec succès !"}),b.jsx("p",{className:"text-green-100 mb-3",children:"Votre service a été créé et est maintenant disponible."}),b.jsxs("div",{className:"bg-green-600 rounded p-3 mb-4",children:[b.jsxs("p",{className:"text-sm",children:[b.jsx("strong",{children:"Coût de création :"})," ",Je.cout," FCFA"]}),b.jsxs("p",{className:"text-xs text-green-200 mt-1",children:["ID du service : ",Je.serviceId]})]}),b.jsxs("div",{className:"flex gap-2",children:[b.jsx("button",{onClick:()=>{Xe(!1),t("/")},className:"flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-sm font-medium transition-colors",children:"🏠 Retour à l'accueil"}),b.jsx("button",{onClick:()=>{Xe(!1),t("/dashboard/mes-services")},className:"flex-1 bg-green-700 hover:bg-green-800 text-white px-4 py-2 rounded text-sm font-medium transition-colors",children:"📋 Mes Services"})]})]}),b.jsx("button",{onClick:()=>Xe(!1),className:"flex-shrink-0 text-green-200 hover:text-white transition-colors",children:"✕"})]})})]})]})}function uDe(e){if(!/^[0-9a-zA-Z-]+$/.test(e))throw new Error(`[@mantine/use-form] Form name "${e}" is invalid, it should contain only letters, numbers and dashes`)}const dDe=typeof window<"u"?j.useLayoutEffect:j.useEffect;function Ga(e,t){dDe(()=>{if(e)return window.addEventListener(e,t),()=>window.removeEventListener(e,t)},[e])}function hDe(e,t){e&&uDe(e),Ga(`mantine-form:${e}:set-field-value`,r=>t.setFieldValue(r.detail.path,r.detail.value)),Ga(`mantine-form:${e}:set-values`,r=>t.setValues(r.detail)),Ga(`mantine-form:${e}:set-initial-values`,r=>t.setInitialValues(r.detail)),Ga(`mantine-form:${e}:set-errors`,r=>t.setErrors(r.detail)),Ga(`mantine-form:${e}:set-field-error`,r=>t.setFieldError(r.detail.path,r.detail.error)),Ga(`mantine-form:${e}:clear-field-error`,r=>t.clearFieldError(r.detail)),Ga(`mantine-form:${e}:clear-errors`,t.clearErrors),Ga(`mantine-form:${e}:reset`,t.reset),Ga(`mantine-form:${e}:validate`,t.validate),Ga(`mantine-form:${e}:validate-field`,r=>t.validateField(r.detail)),Ga(`mantine-form:${e}:reorder-list-item`,r=>t.reorderListItem(r.detail.path,r.detail.payload)),Ga(`mantine-form:${e}:remove-list-item`,r=>t.removeListItem(r.detail.path,r.detail.index)),Ga(`mantine-form:${e}:insert-list-item`,r=>t.insertListItem(r.detail.path,r.detail.item,r.detail.index)),Ga(`mantine-form:${e}:set-dirty`,r=>t.setDirty(r.detail)),Ga(`mantine-form:${e}:set-touched`,r=>t.setTouched(r.detail)),Ga(`mantine-form:${e}:reset-dirty`,r=>t.resetDirty(r.detail)),Ga(`mantine-form:${e}:reset-touched`,t.resetTouched)}function fDe(e){return t=>{if(!t)e(t);else if(typeof t=="function")e(t);else if(typeof t=="object"&&"nativeEvent"in t){const{currentTarget:r}=t;r instanceof HTMLInputElement?r.type==="checkbox"?e(r.checked):e(r.value):(r instanceof HTMLTextAreaElement||r instanceof HTMLSelectElement)&&e(r.value)}else e(t)}}function yR(e){return e===null||typeof e!="object"?{}:Object.keys(e).reduce((t,r)=>{const n=e[r];return n!=null&&n!==!1&&(t[r]=n),t},{})}function pDe(e){const[t,r]=j.useState(yR(e)),n=j.useRef(t),a=j.useCallback(y=>{r(w=>{const T=yR(typeof y=="function"?y(w):y);return n.current=T,T})},[]),u=j.useCallback(()=>a({}),[]),f=j.useCallback(y=>{n.current[y]!==void 0&&a(w=>{const T={...w};return delete T[y],T})},[t]),i=j.useCallback((y,w)=>{w==null||w===!1?f(y):n.current[y]!==w&&a(T=>({...T,[y]:w}))},[t]);return{errorsState:t,setErrors:a,clearErrors:u,setFieldError:i,clearFieldError:f}}function vR(e,t){if(t===null||typeof t!="object")return{};const r={...t};return Object.keys(t).forEach(n=>{n.includes(`${String(e)}.`)&&delete r[n]}),r}function T7(e,t){const r=e.substring(t.length+1).split(".")[0];return parseInt(r,10)}function C7(e,t,r,n){if(t===void 0)return r;const a=`${String(e)}`;let u=r;n===-1&&(u=vR(`${a}.${t}`,u));const f={...u},i=new Set;return Object.entries(u).filter(([y])=>{if(!y.startsWith(`${a}.`))return!1;const w=T7(y,a);return Number.isNaN(w)?!1:w>=t}).forEach(([y,w])=>{const T=T7(y,a),A=y.replace(`${a}.${T}`,`${a}.${T+n}`);f[A]=w,i.add(A),i.has(y)||delete f[y]}),f}function mDe(e,{from:t,to:r},n){const a=`${e}.${t}`,u=`${e}.${r}`,f={...n},i=new Set;return Object.keys(n).forEach(y=>{if(i.has(y))return;let w,T;if(y.startsWith(a)?(w=y,T=y.replace(a,u)):y.startsWith(u)&&(w=y.replace(u,a),T=y),w&&T){const A=f[w],k=f[T];k===void 0?delete f[w]:f[w]=k,A===void 0?delete f[T]:f[T]=A,i.add(w),i.add(T)}}),f}function A7(e,t,r){typeof r.value=="object"&&(r.value=Nv(r.value)),!r.enumerable||r.get||r.set||!r.configurable||!r.writable||t==="__proto__"?Object.defineProperty(e,t,r):e[t]=r.value}function Nv(e){if(typeof e!="object")return e;var t=0,r,n,a,u=Object.prototype.toString.call(e);if(u==="[object Object]"?a=Object.create(e.__proto__||null):u==="[object Array]"?a=Array(e.length):u==="[object Set]"?(a=new Set,e.forEach(function(f){a.add(Nv(f))})):u==="[object Map]"?(a=new Map,e.forEach(function(f,i){a.set(Nv(i),Nv(f))})):u==="[object Date]"?a=new Date(+e):u==="[object RegExp]"?a=new RegExp(e.source,e.flags):u==="[object DataView]"?a=new e.constructor(Nv(e.buffer)):u==="[object ArrayBuffer]"?a=e.slice(0):u.slice(-6)==="Array]"&&(a=new e.constructor(e)),a){for(n=Object.getOwnPropertySymbols(e);t<n.length;t++)A7(a,n[t],Object.getOwnPropertyDescriptor(e,n[t]));for(t=0,n=Object.getOwnPropertyNames(e);t<n.length;t++)Object.hasOwnProperty.call(a,r=n[t])&&a[r]===e[r]||A7(a,r,Object.getOwnPropertyDescriptor(e,r))}return a||e}function FQ(e){return typeof e!="string"?[]:e.split(".")}function Pa(e,t){const r=FQ(e);if(r.length===0||typeof t!="object"||t===null)return;let n=t[r[0]];for(let a=1;a<r.length&&n!=null;a+=1)n=n[r[a]];return n}function e1(e,t,r){const n=FQ(e);if(n.length===0)return r;const a=Nv(r);if(n.length===1)return a[n[0]]=t,a;let u=a[n[0]];for(let f=1;f<n.length-1;f+=1){if(u===void 0)return a;u=u[n[f]]}return u[n[n.length-1]]=t,a}function gDe(e,{from:t,to:r},n){const a=Pa(e,n);if(!Array.isArray(a))return n;const u=[...a],f=a[t];return u.splice(t,1),u.splice(r,0,f),e1(e,u,n)}function yDe(e,t,r,n){const a=Pa(e,n);if(!Array.isArray(a))return n;const u=[...a];return u.splice(typeof r=="number"?r:u.length,0,t),e1(e,u,n)}function vDe(e,t,r){const n=Pa(e,r);return Array.isArray(n)?e1(e,n.filter((a,u)=>u!==t),r):r}function _De(e,t,r,n){const a=Pa(e,n);if(!Array.isArray(a)||a.length<=r)return n;const u=[...a];return u[r]=t,e1(e,u,n)}function xDe({$values:e,$errors:t,$status:r}){const n=j.useCallback((i,y)=>{r.clearFieldDirty(i),t.setErrors(w=>mDe(i,y,w)),e.setValues({values:gDe(i,y,e.refValues.current),updateState:!0})},[]),a=j.useCallback((i,y)=>{r.clearFieldDirty(i),t.setErrors(w=>C7(i,y,w,-1)),e.setValues({values:vDe(i,y,e.refValues.current),updateState:!0})},[]),u=j.useCallback((i,y,w)=>{r.clearFieldDirty(i),t.setErrors(T=>C7(i,w,T,1)),e.setValues({values:yDe(i,y,w,e.refValues.current),updateState:!0})},[]),f=j.useCallback((i,y,w)=>{r.clearFieldDirty(i),e.setValues({values:_De(i,w,y,e.refValues.current),updateState:!0})},[]);return{reorderListItem:n,removeListItem:a,insertListItem:u,replaceListItem:f}}var Bk,P7;function bDe(){return P7||(P7=1,Bk=function e(t,r){if(t===r)return!0;if(t&&r&&typeof t=="object"&&typeof r=="object"){if(t.constructor!==r.constructor)return!1;var n,a,u;if(Array.isArray(t)){if(n=t.length,n!=r.length)return!1;for(a=n;a--!==0;)if(!e(t[a],r[a]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if(u=Object.keys(t),n=u.length,n!==Object.keys(r).length)return!1;for(a=n;a--!==0;)if(!Object.prototype.hasOwnProperty.call(r,u[a]))return!1;for(a=n;a--!==0;){var f=u[a];if(!e(t[f],r[f]))return!1}return!0}return t!==t&&r!==r}),Bk}var wDe=bDe();const kw=vs(wDe);function J0(e,t){const r=Object.keys(e);if(typeof t=="string"){const n=r.filter(a=>a.startsWith(`${t}.`));return e[t]||n.some(a=>e[a])||!1}return r.some(n=>e[n])}function SDe({initialDirty:e,initialTouched:t,mode:r,$values:n}){const[a,u]=j.useState(t),[f,i]=j.useState(e),y=j.useRef(t),w=j.useRef(e),T=j.useCallback(Y=>{const ie=typeof Y=="function"?Y(y.current):Y;y.current=ie,r==="controlled"&&u(ie)},[]),A=j.useCallback((Y,ie=!1)=>{const ce=typeof Y=="function"?Y(w.current):Y;w.current=ce,(r==="controlled"||ie)&&i(ce)},[]),k=j.useCallback(()=>T({}),[]),F=j.useCallback(Y=>{const ie=Y?{...n.refValues.current,...Y}:n.refValues.current;n.setValuesSnapshot(ie),A({})},[]),D=j.useCallback((Y,ie)=>{T(ce=>J0(ce,Y)===ie?ce:{...ce,[Y]:ie})},[]),O=j.useCallback((Y,ie,ce)=>{A(ge=>J0(ge,Y)===ie?ge:{...ge,[Y]:ie},ce)},[]),N=j.useCallback((Y,ie)=>{const ce=J0(w.current,Y),ge=!kw(Pa(Y,n.getValuesSnapshot()),ie),be=vR(Y,w.current);be[Y]=ge,A(be,ce!==ge)},[]),V=j.useCallback(Y=>J0(y.current,Y),[]),H=j.useCallback(Y=>A(ie=>{if(typeof Y!="string")return ie;const ce=vR(Y,ie);return delete ce[Y],kw(ce,ie)?ie:ce}),[]),Z=j.useCallback(Y=>{if(Y){const ce=Pa(Y,w.current);if(typeof ce=="boolean")return ce;const ge=Pa(Y,n.refValues.current),be=Pa(Y,n.valuesSnapshot.current);return!kw(ge,be)}return Object.keys(w.current).length>0?J0(w.current):!kw(n.refValues.current,n.valuesSnapshot.current)},[]),J=j.useCallback(()=>w.current,[]),G=j.useCallback(()=>y.current,[]);return{touchedState:a,dirtyState:f,touchedRef:y,dirtyRef:w,setTouched:T,setDirty:A,resetDirty:F,resetTouched:k,isTouched:V,setFieldTouched:D,setFieldDirty:O,setTouchedState:u,setDirtyState:i,clearFieldDirty:H,isDirty:Z,getDirty:J,getTouched:G,setCalculatedFieldDirty:N}}function EDe({initialValues:e,onValuesChange:t,mode:r}){const n=j.useRef(!1),[a,u]=j.useState(e||{}),f=j.useRef(a),i=j.useRef(a),y=j.useCallback(({values:N,subscribers:V,updateState:H=!0,mergeWithPreviousValues:Z=!0})=>{const J=f.current,G=N instanceof Function?N(f.current):N,Y=Z?{...J,...G}:G;f.current=Y,H&&(u(Y),r==="uncontrolled"&&(f.current=Y)),t==null||t(Y,J),V==null||V.filter(Boolean).forEach(ie=>ie({updatedValues:Y,previousValues:J}))},[t]),w=j.useCallback(N=>{var Z;const V=Pa(N.path,f.current),H=N.value instanceof Function?N.value(V):N.value;if(V!==H){const J=f.current,G=e1(N.path,H,f.current);y({values:G,updateState:N.updateState}),(Z=N.subscribers)==null||Z.filter(Boolean).forEach(Y=>Y({path:N.path,updatedValues:G,previousValues:J}))}},[y]),T=j.useCallback(N=>{i.current=N},[]),A=j.useCallback((N,V)=>{n.current||(n.current=!0,y({values:N,updateState:r==="controlled"}),T(N),V())},[y]),k=j.useCallback(()=>{y({values:i.current,updateState:!0,mergeWithPreviousValues:!1})},[y]),F=j.useCallback(()=>f.current,[]),D=j.useCallback(()=>i.current,[]),O=j.useCallback(N=>{const V=Pa(N,i.current);typeof V>"u"||w({path:N,value:V,updateState:r==="uncontrolled"||void 0})},[w,r]);return{initialized:n,stateValues:a,refValues:f,valuesSnapshot:i,setValues:y,setFieldValue:w,resetValues:k,setValuesSnapshot:T,initialize:A,getValues:F,getValuesSnapshot:D,resetField:O}}function TDe({$status:e}){const t=j.useRef({}),r=j.useCallback((a,u)=>{j.useEffect(()=>(t.current[a]=t.current[a]||[],t.current[a].push(u),()=>{t.current[a]=t.current[a].filter(f=>f!==u)}),[u])},[]),n=j.useCallback(a=>t.current[a]?t.current[a].map(u=>f=>u({previousValue:Pa(a,f.previousValues),value:Pa(a,f.updatedValues),touched:e.isTouched(a),dirty:e.isDirty(a)})):[],[]);return{subscribers:t,watch:r,getFieldSubscribers:n}}function M7(e,t){return e?`${e}-${t.toString()}`:t.toString()}const Ow=Symbol("root-rule");function I7(e){const t=yR(e);return{hasErrors:Object.keys(t).length>0,errors:t}}function _R(e,t,r="",n={}){return typeof e!="object"||e===null?n:Object.keys(e).reduce((a,u)=>{const f=e[u],i=`${r===""?"":`${r}.`}${u}`,y=Pa(i,t);let w=!1;return typeof f=="function"&&(a[i]=f(y,t,i)),typeof f=="object"&&Array.isArray(y)&&(w=!0,y.forEach((T,A)=>_R(f,t,`${i}.${A}`,a)),Ow in f&&(a[i]=f[Ow](y,t,i))),typeof f=="object"&&typeof y=="object"&&y!==null&&(w||_R(f,t,i,a),Ow in f&&(a[i]=f[Ow](y,t,i))),a},n)}function xR(e,t){return I7(typeof e=="function"?e(t):_R(e,t))}function Lw(e,t,r){if(typeof e!="string")return{hasError:!1,error:null};const n=xR(t,r),a=Object.keys(n.errors).find(u=>e.split(".").every((f,i)=>f===u.split(".")[i]));return{hasError:!!a,error:a?n.errors[a]:null}}const CDe="__MANTINE_FORM_INDEX__";function k7(e,t){return t?typeof t=="boolean"?t:Array.isArray(t)?t.includes(e.replace(/[.][0-9]+/g,`.${CDe}`)):!1:!1}function ADe({name:e,mode:t="controlled",initialValues:r,initialErrors:n={},initialDirty:a={},initialTouched:u={},clearInputErrorOnChange:f=!0,validateInputOnChange:i=!1,validateInputOnBlur:y=!1,onValuesChange:w,transformValues:T=O=>O,enhanceGetInputProps:A,validate:k,onSubmitPreventDefault:F="always",touchTrigger:D="change"}={}){const O=pDe(n),N=EDe({initialValues:r,onValuesChange:w,mode:t}),V=SDe({initialDirty:a,initialTouched:u,$values:N,mode:t}),H=xDe({$values:N,$errors:O,$status:V}),Z=TDe({$status:V}),[J,G]=j.useState(0),[Y,ie]=j.useState({}),[ce,ge]=j.useState(!1),be=j.useCallback(()=>{N.resetValues(),O.clearErrors(),V.resetDirty(),V.resetTouched(),t==="uncontrolled"&&G(Ve=>Ve+1)},[]),xe=j.useCallback(Ve=>{f&&O.clearErrors(),t==="uncontrolled"&&G(Et=>Et+1),Object.keys(Z.subscribers.current).forEach(Et=>{const kt=Pa(Et,N.refValues.current),Wt=Pa(Et,Ve);kt!==Wt&&Z.getFieldSubscribers(Et).forEach(Tt=>Tt({previousValues:Ve,updatedValues:N.refValues.current}))})},[f]),Le=j.useCallback(Ve=>{const Et=N.refValues.current;N.initialize(Ve,()=>t==="uncontrolled"&&G(kt=>kt+1)),xe(Et)},[xe]),ze=j.useCallback((Ve,Et,kt)=>{const Wt=k7(Ve,i),Tt=Et instanceof Function?Et(Pa(Ve,N.refValues.current)):Et;V.setCalculatedFieldDirty(Ve,Tt),D==="change"&&V.setFieldTouched(Ve,!0),!Wt&&f&&O.clearFieldError(Ve),N.setFieldValue({path:Ve,value:Et,updateState:t==="controlled",subscribers:[...Z.getFieldSubscribers(Ve),Wt?Ht=>{const ur=Lw(Ve,k,Ht.updatedValues);ur.hasError?O.setFieldError(Ve,ur.error):O.clearFieldError(Ve)}:null,(kt==null?void 0:kt.forceUpdate)!==!1&&t!=="controlled"?()=>ie(Ht=>({...Ht,[Ve]:(Ht[Ve]||0)+1})):null]})},[w,k]),Xe=j.useCallback(Ve=>{const Et=N.refValues.current;N.setValues({values:Ve,updateState:t==="controlled"}),xe(Et)},[w,xe]),Je=j.useCallback(()=>{const Ve=xR(k,N.refValues.current);return O.setErrors(Ve.errors),Ve},[k]),tt=j.useCallback(Ve=>{const Et=Lw(Ve,k,N.refValues.current);return Et.hasError?O.setFieldError(Ve,Et.error):O.clearFieldError(Ve),Et},[k]),st=(Ve,{type:Et="input",withError:kt=!0,withFocus:Wt=!0,...Tt}={})=>{const ur={onChange:fDe(Jt=>ze(Ve,Jt,{forceUpdate:!1})),"data-path":M7(e,Ve)};return kt&&(ur.error=O.errorsState[Ve]),Et==="checkbox"?ur[t==="controlled"?"checked":"defaultChecked"]=Pa(Ve,N.refValues.current):ur[t==="controlled"?"value":"defaultValue"]=Pa(Ve,N.refValues.current),Wt&&(ur.onFocus=()=>V.setFieldTouched(Ve,!0),ur.onBlur=()=>{if(k7(Ve,y)){const Jt=Lw(Ve,k,N.refValues.current);Jt.hasError?O.setFieldError(Ve,Jt.error):O.clearFieldError(Ve)}}),Object.assign(ur,A==null?void 0:A({inputProps:ur,field:Ve,options:{type:Et,withError:kt,withFocus:Wt,...Tt},form:Ye}))},Ne=(Ve,Et)=>kt=>{F==="always"&&(kt==null||kt.preventDefault());const Wt=Je();if(Wt.hasErrors)F==="validation-failed"&&(kt==null||kt.preventDefault()),Et==null||Et(Wt.errors,N.refValues.current,kt);else{const Tt=Ve==null?void 0:Ve(T(N.refValues.current),kt);Tt instanceof Promise&&(ge(!0),Tt.finally(()=>ge(!1)))}},We=Ve=>T(Ve||N.refValues.current),Ue=j.useCallback(Ve=>{Ve.preventDefault(),be()},[]),De=j.useCallback(Ve=>Ve?!Lw(Ve,k,N.refValues.current).hasError:!xR(k,N.refValues.current).hasErrors,[k]),Ke=Ve=>`${J}-${Ve}-${Y[Ve]||0}`,lt=j.useCallback(Ve=>document.querySelector(`[data-path="${M7(e,Ve)}"]`),[]),Ye={watch:Z.watch,initialized:N.initialized.current,values:t==="uncontrolled"?N.refValues.current:N.stateValues,getValues:N.getValues,getInitialValues:N.getValuesSnapshot,setInitialValues:N.setValuesSnapshot,resetField:N.resetField,initialize:Le,setValues:Xe,setFieldValue:ze,submitting:ce,setSubmitting:ge,errors:O.errorsState,setErrors:O.setErrors,setFieldError:O.setFieldError,clearFieldError:O.clearFieldError,clearErrors:O.clearErrors,resetDirty:V.resetDirty,setTouched:V.setTouched,setDirty:V.setDirty,isTouched:V.isTouched,resetTouched:V.resetTouched,isDirty:V.isDirty,getTouched:V.getTouched,getDirty:V.getDirty,reorderListItem:H.reorderListItem,insertListItem:H.insertListItem,removeListItem:H.removeListItem,replaceListItem:H.replaceListItem,reset:be,validate:Je,validateField:tt,getInputProps:st,onSubmit:Ne,onReset:Ue,isValid:De,getTransformedValues:We,key:Ke,getInputNode:lt};return hDe(e,Ye),Ye}function sa(e){return Object.keys(e)}function $k(e){return e&&typeof e=="object"&&!Array.isArray(e)}function FD(e,t){const r={...e},n=t;return $k(e)&&$k(t)&&Object.keys(t).forEach(a=>{$k(n[a])&&a in e?r[a]=FD(r[a],n[a]):r[a]=n[a]}),r}function PDe(e){return e.replace(/[A-Z]/g,t=>`-${t.toLowerCase()}`)}function MDe(e){var t;return typeof e!="string"||!e.includes("var(--mantine-scale)")?e:(t=e.match(/^calc\((.*?)\)$/))==null?void 0:t[1].split("*")[0].trim()}function Ab(e){const t=MDe(e);return typeof t=="number"?t:typeof t=="string"?t.includes("calc")||t.includes("var")?t:t.includes("px")?Number(t.replace("px","")):t.includes("rem")?Number(t.replace("rem",""))*16:t.includes("em")?Number(t.replace("em",""))*16:Number(t):NaN}function O7(e){return e==="0rem"?"0rem":`calc(${e} * var(--mantine-scale))`}function BQ(e,{shouldScale:t=!1}={}){function r(n){if(n===0||n==="0")return`0${e}`;if(typeof n=="number"){const a=`${n/16}${e}`;return t?O7(a):a}if(typeof n=="string"){if(n===""||n.startsWith("calc(")||n.startsWith("clamp(")||n.includes("rgba("))return n;if(n.includes(","))return n.split(",").map(u=>r(u)).join(",");if(n.includes(" "))return n.split(" ").map(u=>r(u)).join(" ");const a=n.replace("px","");if(!Number.isNaN(Number(a))){const u=`${Number(a)/16}${e}`;return t?O7(u):u}}return n}return r}const Nr=BQ("rem",{shouldScale:!0}),L7=BQ("em");function Ny(e){return Object.keys(e).reduce((t,r)=>(e[r]!==void 0&&(t[r]=e[r]),t),{})}function $Q(e){if(typeof e=="number")return!0;if(typeof e=="string"){if(e.startsWith("calc(")||e.startsWith("var(")||e.includes(" ")&&e.trim()!=="")return!0;const t=/^[+-]?[0-9]+(\.[0-9]+)?(px|em|rem|ex|ch|lh|rlh|vw|vh|vmin|vmax|vb|vi|svw|svh|lvw|lvh|dvw|dvh|cm|mm|in|pt|pc|q|cqw|cqh|cqi|cqb|cqmin|cqmax|%)?$/;return e.trim().split(/\s+/).every(n=>t.test(n))}return!1}function BD(e){const t=j.createContext(null);return[({children:a,value:u})=>b.jsx(t.Provider,{value:u,children:a}),()=>{const a=j.useContext(t);if(a===null)throw new Error(e);return a}]}function VQ(e=null){const t=j.createContext(e);return[({children:a,value:u})=>b.jsx(t.Provider,{value:u,children:a}),()=>j.useContext(t)]}function Xa(e,t="size",r=!0){if(e!==void 0)return $Q(e)?r?Nr(e):e:`var(--${t}-${e})`}function xl(e){return Xa(e,"mantine-spacing")}function ng(e){return e===void 0?"var(--mantine-radius-default)":Xa(e,"mantine-radius")}function cu(e){return Xa(e,"mantine-font-size")}function IDe(e){return Xa(e,"mantine-line-height",!1)}function kDe(e){if(e)return Xa(e,"mantine-shadow",!1)}function ODe(e,t){return e in t?Ab(t[e]):Ab(e)}function $D(e,t){const r=e.map(n=>({value:n,px:ODe(n,t)}));return r.sort((n,a)=>n.px-a.px),r}function Kd(e){return typeof e=="object"&&e!==null?"base"in e?e.base:void 0:e}function LDe(e="mantine-"){return`${e}${Math.random().toString(36).slice(2,11)}`}function RDe(e,t){try{return e.addEventListener("change",t),()=>e.removeEventListener("change",t)}catch{return e.addListener(t),()=>e.removeListener(t)}}function jDe(e,t){return typeof window<"u"&&"matchMedia"in window?window.matchMedia(e).matches:!1}function DDe(e,t,{getInitialValueInEffect:r}={getInitialValueInEffect:!0}){const[n,a]=j.useState(r?t:jDe(e)),u=j.useRef(null);return j.useEffect(()=>{if("matchMedia"in window)return u.current=window.matchMedia(e),a(u.current.matches),RDe(u.current,f=>a(f.matches))},[e]),n||!1}const VD=typeof document<"u"?j.useLayoutEffect:j.useEffect;function NDe(e,t){const r=j.useRef(!1);j.useEffect(()=>()=>{r.current=!1},[]),j.useEffect(()=>{if(r.current)return e();r.current=!0},t)}const zDe=jt.useId||(()=>{});function FDe(){const e=zDe();return e?`mantine-${e.replace(/:/g,"")}`:""}function BDe(e){const t=FDe(),[r,n]=j.useState(t);return VD(()=>{n(LDe())},[]),typeof e=="string"?e:typeof window>"u"?t:r}function $De(e,t){return DDe("(prefers-reduced-motion: reduce)",e,t)}const VDe={};function UDe(e){const t={};return e.forEach(r=>{Object.entries(r).forEach(([n,a])=>{t[n]?t[n]=Li(t[n],a):t[n]=a})}),t}function U2({theme:e,classNames:t,props:r,stylesCtx:n}){const u=(Array.isArray(t)?t:[t]).map(f=>typeof f=="function"?f(e,r,n):f||VDe);return UDe(u)}function ME({theme:e,styles:t,props:r,stylesCtx:n}){return(Array.isArray(t)?t:[t]).reduce((u,f)=>typeof f=="function"?{...u,...f(e,r,n)}:{...u,...f},{})}const UQ=j.createContext(null);function ig(){const e=j.useContext(UQ);if(!e)throw new Error("[@mantine/core] MantineProvider was not found in tree");return e}function qDe(){return ig().cssVariablesResolver}function GDe(){return ig().classNamesPrefix}function UD(){return ig().getStyleNonce}function HDe(){return ig().withStaticClasses}function WDe(){return ig().headless}function ZDe(){var e;return(e=ig().stylesTransform)==null?void 0:e.sx}function XDe(){var e;return(e=ig().stylesTransform)==null?void 0:e.styles}function KDe(){return ig().env||"default"}function YDe(e){return/^#?([0-9A-F]{3}){1,2}([0-9A-F]{2})?$/i.test(e)}function JDe(e){let t=e.replace("#","");if(t.length===3){const f=t.split("");t=[f[0],f[0],f[1],f[1],f[2],f[2]].join("")}if(t.length===8){const f=parseInt(t.slice(6,8),16)/255;return{r:parseInt(t.slice(0,2),16),g:parseInt(t.slice(2,4),16),b:parseInt(t.slice(4,6),16),a:f}}const r=parseInt(t,16),n=r>>16&255,a=r>>8&255,u=r&255;return{r:n,g:a,b:u,a:1}}function QDe(e){const[t,r,n,a]=e.replace(/[^0-9,./]/g,"").split(/[/,]/).map(Number);return{r:t,g:r,b:n,a:a===void 0?1:a}}function eNe(e){const t=/^hsla?\(\s*(\d+)\s*,\s*(\d+%)\s*,\s*(\d+%)\s*(,\s*(0?\.\d+|\d+(\.\d+)?))?\s*\)$/i,r=e.match(t);if(!r)return{r:0,g:0,b:0,a:1};const n=parseInt(r[1],10),a=parseInt(r[2],10)/100,u=parseInt(r[3],10)/100,f=r[5]?parseFloat(r[5]):void 0,i=(1-Math.abs(2*u-1))*a,y=n/60,w=i*(1-Math.abs(y%2-1)),T=u-i/2;let A,k,F;return y>=0&&y<1?(A=i,k=w,F=0):y>=1&&y<2?(A=w,k=i,F=0):y>=2&&y<3?(A=0,k=i,F=w):y>=3&&y<4?(A=0,k=w,F=i):y>=4&&y<5?(A=w,k=0,F=i):(A=i,k=0,F=w),{r:Math.round((A+T)*255),g:Math.round((k+T)*255),b:Math.round((F+T)*255),a:f||1}}function qD(e){return YDe(e)?JDe(e):e.startsWith("rgb")?QDe(e):e.startsWith("hsl")?eNe(e):{r:0,g:0,b:0,a:1}}function Rw(e,t){if(e.startsWith("var("))return`color-mix(in srgb, ${e}, black ${t*100}%)`;const{r,g:n,b:a,a:u}=qD(e),f=1-t,i=y=>Math.round(y*f);return`rgba(${i(r)}, ${i(n)}, ${i(a)}, ${u})`}function Pb(e,t){return typeof e.primaryShade=="number"?e.primaryShade:t==="dark"?e.primaryShade.dark:e.primaryShade.light}function Vk(e){return e<=.03928?e/12.92:((e+.055)/1.055)**2.4}function tNe(e){const t=e.match(/oklch\((.*?)%\s/);return t?parseFloat(t[1]):null}function rNe(e){if(e.startsWith("oklch("))return(tNe(e)||0)/100;const{r:t,g:r,b:n}=qD(e),a=t/255,u=r/255,f=n/255,i=Vk(a),y=Vk(u),w=Vk(f);return .2126*i+.7152*y+.0722*w}function Q0(e,t=.179){return e.startsWith("var(")?!1:rNe(e)>t}function t1({color:e,theme:t,colorScheme:r}){if(typeof e!="string")throw new Error(`[@mantine/core] Failed to parse color. Expected color to be a string, instead got ${typeof e}`);if(e==="bright")return{color:e,value:r==="dark"?t.white:t.black,shade:void 0,isThemeColor:!1,isLight:Q0(r==="dark"?t.white:t.black,t.luminanceThreshold),variable:"--mantine-color-bright"};if(e==="dimmed")return{color:e,value:r==="dark"?t.colors.dark[2]:t.colors.gray[7],shade:void 0,isThemeColor:!1,isLight:Q0(r==="dark"?t.colors.dark[2]:t.colors.gray[6],t.luminanceThreshold),variable:"--mantine-color-dimmed"};if(e==="white"||e==="black")return{color:e,value:e==="white"?t.white:t.black,shade:void 0,isThemeColor:!1,isLight:Q0(e==="white"?t.white:t.black,t.luminanceThreshold),variable:`--mantine-color-${e}`};const[n,a]=e.split("."),u=a?Number(a):void 0,f=n in t.colors;if(f){const i=u!==void 0?t.colors[n][u]:t.colors[n][Pb(t,r||"light")];return{color:n,value:i,shade:u,isThemeColor:f,isLight:Q0(i,t.luminanceThreshold),variable:a?`--mantine-color-${n}-${u}`:`--mantine-color-${n}-filled`}}return{color:e,value:e,isThemeColor:f,isLight:Q0(e,t.luminanceThreshold),shade:u,variable:void 0}}function My(e,t){const r=t1({color:e||t.primaryColor,theme:t});return r.variable?`var(${r.variable})`:e}function bR(e,t){const r={from:(e==null?void 0:e.from)||t.defaultGradient.from,to:(e==null?void 0:e.to)||t.defaultGradient.to,deg:(e==null?void 0:e.deg)??t.defaultGradient.deg??0},n=My(r.from,t),a=My(r.to,t);return`linear-gradient(${r.deg}deg, ${n} 0%, ${a} 100%)`}function cp(e,t){if(typeof e!="string"||t>1||t<0)return"rgba(0, 0, 0, 1)";if(e.startsWith("var(")){const u=(1-t)*100;return`color-mix(in srgb, ${e}, transparent ${u}%)`}if(e.startsWith("oklch"))return e.includes("/")?e.replace(/\/\s*[\d.]+\s*\)/,`/ ${t})`):e.replace(")",` / ${t})`);const{r,g:n,b:a}=qD(e);return`rgba(${r}, ${n}, ${a}, ${t})`}const xv=cp,nNe=({color:e,theme:t,variant:r,gradient:n,autoContrast:a})=>{const u=t1({color:e,theme:t}),f=typeof a=="boolean"?a:t.autoContrast;if(r==="none")return{background:"transparent",hover:"transparent",color:"inherit",border:"none"};if(r==="filled"){const i=f&&u.isLight?"var(--mantine-color-black)":"var(--mantine-color-white)";return u.isThemeColor?u.shade===void 0?{background:`var(--mantine-color-${e}-filled)`,hover:`var(--mantine-color-${e}-filled-hover)`,color:i,border:`${Nr(1)} solid transparent`}:{background:`var(--mantine-color-${u.color}-${u.shade})`,hover:`var(--mantine-color-${u.color}-${u.shade===9?8:u.shade+1})`,color:i,border:`${Nr(1)} solid transparent`}:{background:e,hover:Rw(e,.1),color:i,border:`${Nr(1)} solid transparent`}}if(r==="light"){if(u.isThemeColor){if(u.shade===void 0)return{background:`var(--mantine-color-${e}-light)`,hover:`var(--mantine-color-${e}-light-hover)`,color:`var(--mantine-color-${e}-light-color)`,border:`${Nr(1)} solid transparent`};const i=t.colors[u.color][u.shade];return{background:cp(i,.1),hover:cp(i,.12),color:`var(--mantine-color-${u.color}-${Math.min(u.shade,6)})`,border:`${Nr(1)} solid transparent`}}return{background:cp(e,.1),hover:cp(e,.12),color:e,border:`${Nr(1)} solid transparent`}}if(r==="outline")return u.isThemeColor?u.shade===void 0?{background:"transparent",hover:`var(--mantine-color-${e}-outline-hover)`,color:`var(--mantine-color-${e}-outline)`,border:`${Nr(1)} solid var(--mantine-color-${e}-outline)`}:{background:"transparent",hover:cp(t.colors[u.color][u.shade],.05),color:`var(--mantine-color-${u.color}-${u.shade})`,border:`${Nr(1)} solid var(--mantine-color-${u.color}-${u.shade})`}:{background:"transparent",hover:cp(e,.05),color:e,border:`${Nr(1)} solid ${e}`};if(r==="subtle"){if(u.isThemeColor){if(u.shade===void 0)return{background:"transparent",hover:`var(--mantine-color-${e}-light-hover)`,color:`var(--mantine-color-${e}-light-color)`,border:`${Nr(1)} solid transparent`};const i=t.colors[u.color][u.shade];return{background:"transparent",hover:cp(i,.12),color:`var(--mantine-color-${u.color}-${Math.min(u.shade,6)})`,border:`${Nr(1)} solid transparent`}}return{background:"transparent",hover:cp(e,.12),color:e,border:`${Nr(1)} solid transparent`}}return r==="transparent"?u.isThemeColor?u.shade===void 0?{background:"transparent",hover:"transparent",color:`var(--mantine-color-${e}-light-color)`,border:`${Nr(1)} solid transparent`}:{background:"transparent",hover:"transparent",color:`var(--mantine-color-${u.color}-${Math.min(u.shade,6)})`,border:`${Nr(1)} solid transparent`}:{background:"transparent",hover:"transparent",color:e,border:`${Nr(1)} solid transparent`}:r==="white"?u.isThemeColor?u.shade===void 0?{background:"var(--mantine-color-white)",hover:Rw(t.white,.01),color:`var(--mantine-color-${e}-filled)`,border:`${Nr(1)} solid transparent`}:{background:"var(--mantine-color-white)",hover:Rw(t.white,.01),color:`var(--mantine-color-${u.color}-${u.shade})`,border:`${Nr(1)} solid transparent`}:{background:"var(--mantine-color-white)",hover:Rw(t.white,.01),color:e,border:`${Nr(1)} solid transparent`}:r==="gradient"?{background:bR(n,t),hover:bR(n,t),color:"var(--mantine-color-white)",border:"none"}:r==="default"?{background:"var(--mantine-color-default)",hover:"var(--mantine-color-default-hover)",color:"var(--mantine-color-default-color)",border:`${Nr(1)} solid var(--mantine-color-default-border)`}:{}},iNe={dark:["#C9C9C9","#b8b8b8","#828282","#696969","#424242","#3b3b3b","#2e2e2e","#242424","#1f1f1f","#141414"],gray:["#f8f9fa","#f1f3f5","#e9ecef","#dee2e6","#ced4da","#adb5bd","#868e96","#495057","#343a40","#212529"],red:["#fff5f5","#ffe3e3","#ffc9c9","#ffa8a8","#ff8787","#ff6b6b","#fa5252","#f03e3e","#e03131","#c92a2a"],pink:["#fff0f6","#ffdeeb","#fcc2d7","#faa2c1","#f783ac","#f06595","#e64980","#d6336c","#c2255c","#a61e4d"],grape:["#f8f0fc","#f3d9fa","#eebefa","#e599f7","#da77f2","#cc5de8","#be4bdb","#ae3ec9","#9c36b5","#862e9c"],violet:["#f3f0ff","#e5dbff","#d0bfff","#b197fc","#9775fa","#845ef7","#7950f2","#7048e8","#6741d9","#5f3dc4"],indigo:["#edf2ff","#dbe4ff","#bac8ff","#91a7ff","#748ffc","#5c7cfa","#4c6ef5","#4263eb","#3b5bdb","#364fc7"],blue:["#e7f5ff","#d0ebff","#a5d8ff","#74c0fc","#4dabf7","#339af0","#228be6","#1c7ed6","#1971c2","#1864ab"],cyan:["#e3fafc","#c5f6fa","#99e9f2","#66d9e8","#3bc9db","#22b8cf","#15aabf","#1098ad","#0c8599","#0b7285"],teal:["#e6fcf5","#c3fae8","#96f2d7","#63e6be","#38d9a9","#20c997","#12b886","#0ca678","#099268","#087f5b"],green:["#ebfbee","#d3f9d8","#b2f2bb","#8ce99a","#69db7c","#51cf66","#40c057","#37b24d","#2f9e44","#2b8a3e"],lime:["#f4fce3","#e9fac8","#d8f5a2","#c0eb75","#a9e34b","#94d82d","#82c91e","#74b816","#66a80f","#5c940d"],yellow:["#fff9db","#fff3bf","#ffec99","#ffe066","#ffd43b","#fcc419","#fab005","#f59f00","#f08c00","#e67700"],orange:["#fff4e6","#ffe8cc","#ffd8a8","#ffc078","#ffa94d","#ff922b","#fd7e14","#f76707","#e8590c","#d9480f"]},R7="-apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji",GD={scale:1,fontSmoothing:!0,focusRing:"auto",white:"#fff",black:"#000",colors:iNe,primaryShade:{light:6,dark:8},primaryColor:"blue",variantColorResolver:nNe,autoContrast:!1,luminanceThreshold:.3,fontFamily:R7,fontFamilyMonospace:"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, Liberation Mono, Courier New, monospace",respectReducedMotion:!1,cursorType:"default",defaultGradient:{from:"blue",to:"cyan",deg:45},defaultRadius:"sm",activeClassName:"mantine-active",focusClassName:"",headings:{fontFamily:R7,fontWeight:"700",textWrap:"wrap",sizes:{h1:{fontSize:Nr(34),lineHeight:"1.3"},h2:{fontSize:Nr(26),lineHeight:"1.35"},h3:{fontSize:Nr(22),lineHeight:"1.4"},h4:{fontSize:Nr(18),lineHeight:"1.45"},h5:{fontSize:Nr(16),lineHeight:"1.5"},h6:{fontSize:Nr(14),lineHeight:"1.5"}}},fontSizes:{xs:Nr(12),sm:Nr(14),md:Nr(16),lg:Nr(18),xl:Nr(20)},lineHeights:{xs:"1.4",sm:"1.45",md:"1.55",lg:"1.6",xl:"1.65"},radius:{xs:Nr(2),sm:Nr(4),md:Nr(8),lg:Nr(16),xl:Nr(32)},spacing:{xs:Nr(10),sm:Nr(12),md:Nr(16),lg:Nr(20),xl:Nr(32)},breakpoints:{xs:"36em",sm:"48em",md:"62em",lg:"75em",xl:"88em"},shadows:{xs:`0 ${Nr(1)} ${Nr(3)} rgba(0, 0, 0, 0.05), 0 ${Nr(1)} ${Nr(2)} rgba(0, 0, 0, 0.1)`,sm:`0 ${Nr(1)} ${Nr(3)} rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.05) 0 ${Nr(10)} ${Nr(15)} ${Nr(-5)}, rgba(0, 0, 0, 0.04) 0 ${Nr(7)} ${Nr(7)} ${Nr(-5)}`,md:`0 ${Nr(1)} ${Nr(3)} rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.05) 0 ${Nr(20)} ${Nr(25)} ${Nr(-5)}, rgba(0, 0, 0, 0.04) 0 ${Nr(10)} ${Nr(10)} ${Nr(-5)}`,lg:`0 ${Nr(1)} ${Nr(3)} rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.05) 0 ${Nr(28)} ${Nr(23)} ${Nr(-7)}, rgba(0, 0, 0, 0.04) 0 ${Nr(12)} ${Nr(12)} ${Nr(-7)}`,xl:`0 ${Nr(1)} ${Nr(3)} rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.05) 0 ${Nr(36)} ${Nr(28)} ${Nr(-7)}, rgba(0, 0, 0, 0.04) 0 ${Nr(17)} ${Nr(17)} ${Nr(-7)}`},other:{},components:{}};function j7(e){return e==="auto"||e==="dark"||e==="light"}function sNe({key:e="mantine-color-scheme-value"}={}){let t;return{get:r=>{if(typeof window>"u")return r;try{const n=window.localStorage.getItem(e);return j7(n)?n:r}catch{return r}},set:r=>{try{window.localStorage.setItem(e,r)}catch(n){console.warn("[@mantine/core] Local storage color scheme manager was unable to save color scheme.",n)}},subscribe:r=>{t=n=>{n.storageArea===window.localStorage&&n.key===e&&j7(n.newValue)&&r(n.newValue)},window.addEventListener("storage",t)},unsubscribe:()=>{window.removeEventListener("storage",t)},clear:()=>{window.localStorage.removeItem(e)}}}const oNe="[@mantine/core] MantineProvider: Invalid theme.primaryColor, it accepts only key of theme.colors, learn more – https://mantine.dev/theming/colors/#primary-color",D7="[@mantine/core] MantineProvider: Invalid theme.primaryShade, it accepts only 0-9 integers or an object { light: 0-9, dark: 0-9 }";function Uk(e){return e<0||e>9?!1:parseInt(e.toString(),10)===e}function N7(e){if(!(e.primaryColor in e.colors))throw new Error(oNe);if(typeof e.primaryShade=="object"&&(!Uk(e.primaryShade.dark)||!Uk(e.primaryShade.light)))throw new Error(D7);if(typeof e.primaryShade=="number"&&!Uk(e.primaryShade))throw new Error(D7)}function aNe(e,t){var n;if(!t)return N7(e),e;const r=FD(e,t);return t.fontFamily&&!((n=t.headings)!=null&&n.fontFamily)&&(r.headings.fontFamily=t.fontFamily),N7(r),r}const HD=j.createContext(null),lNe=()=>j.useContext(HD)||GD;function td(){const e=j.useContext(HD);if(!e)throw new Error("@mantine/core: MantineProvider was not found in component tree, make sure you have it in your app");return e}function qQ({theme:e,children:t,inherit:r=!0}){const n=lNe(),a=j.useMemo(()=>aNe(r?n:GD,e),[e,n,r]);return b.jsx(HD.Provider,{value:a,children:t})}qQ.displayName="@mantine/core/MantineThemeProvider";function cNe(){const e=td(),t=UD(),r=sa(e.breakpoints).reduce((n,a)=>{const u=e.breakpoints[a].includes("px"),f=Ab(e.breakpoints[a]),i=u?`${f-.1}px`:L7(f-.1),y=u?`${f}px`:L7(f);return`${n}@media (max-width: ${i}) {.mantine-visible-from-${a} {display: none !important;}}@media (min-width: ${y}) {.mantine-hidden-from-${a} {display: none !important;}}`},"");return b.jsx("style",{"data-mantine-styles":"classes",nonce:t==null?void 0:t(),dangerouslySetInnerHTML:{__html:r}})}function qk(e){return Object.entries(e).map(([t,r])=>`${t}: ${r};`).join("")}function ex(e,t){return(Array.isArray(e)?e:[e]).reduce((n,a)=>`${a}{${n}}`,t)}function uNe(e,t){const r=qk(e.variables),n=r?ex(t,r):"",a=qk(e.dark),u=qk(e.light),f=a?ex(t===":host"?`${t}([data-mantine-color-scheme="dark"])`:`${t}[data-mantine-color-scheme="dark"]`,a):"",i=u?ex(t===":host"?`${t}([data-mantine-color-scheme="light"])`:`${t}[data-mantine-color-scheme="light"]`,u):"";return`${n}${f}${i}`}function GQ({color:e,theme:t,autoContrast:r}){return(typeof r=="boolean"?r:t.autoContrast)&&t1({color:e||t.primaryColor,theme:t}).isLight?"var(--mantine-color-black)":"var(--mantine-color-white)"}function z7(e,t){return GQ({color:e.colors[e.primaryColor][Pb(e,t)],theme:e,autoContrast:null})}function jw({theme:e,color:t,colorScheme:r,name:n=t,withColorValues:a=!0}){if(!e.colors[t])return{};if(r==="light"){const i=Pb(e,"light"),y={[`--mantine-color-${n}-text`]:`var(--mantine-color-${n}-filled)`,[`--mantine-color-${n}-filled`]:`var(--mantine-color-${n}-${i})`,[`--mantine-color-${n}-filled-hover`]:`var(--mantine-color-${n}-${i===9?8:i+1})`,[`--mantine-color-${n}-light`]:xv(e.colors[t][i],.1),[`--mantine-color-${n}-light-hover`]:xv(e.colors[t][i],.12),[`--mantine-color-${n}-light-color`]:`var(--mantine-color-${n}-${i})`,[`--mantine-color-${n}-outline`]:`var(--mantine-color-${n}-${i})`,[`--mantine-color-${n}-outline-hover`]:xv(e.colors[t][i],.05)};return a?{[`--mantine-color-${n}-0`]:e.colors[t][0],[`--mantine-color-${n}-1`]:e.colors[t][1],[`--mantine-color-${n}-2`]:e.colors[t][2],[`--mantine-color-${n}-3`]:e.colors[t][3],[`--mantine-color-${n}-4`]:e.colors[t][4],[`--mantine-color-${n}-5`]:e.colors[t][5],[`--mantine-color-${n}-6`]:e.colors[t][6],[`--mantine-color-${n}-7`]:e.colors[t][7],[`--mantine-color-${n}-8`]:e.colors[t][8],[`--mantine-color-${n}-9`]:e.colors[t][9],...y}:y}const u=Pb(e,"dark"),f={[`--mantine-color-${n}-text`]:`var(--mantine-color-${n}-4)`,[`--mantine-color-${n}-filled`]:`var(--mantine-color-${n}-${u})`,[`--mantine-color-${n}-filled-hover`]:`var(--mantine-color-${n}-${u===9?8:u+1})`,[`--mantine-color-${n}-light`]:xv(e.colors[t][Math.max(0,u-2)],.15),[`--mantine-color-${n}-light-hover`]:xv(e.colors[t][Math.max(0,u-2)],.2),[`--mantine-color-${n}-light-color`]:`var(--mantine-color-${n}-${Math.max(u-5,0)})`,[`--mantine-color-${n}-outline`]:`var(--mantine-color-${n}-${Math.max(u-4,0)})`,[`--mantine-color-${n}-outline-hover`]:xv(e.colors[t][Math.max(u-4,0)],.05)};return a?{[`--mantine-color-${n}-0`]:e.colors[t][0],[`--mantine-color-${n}-1`]:e.colors[t][1],[`--mantine-color-${n}-2`]:e.colors[t][2],[`--mantine-color-${n}-3`]:e.colors[t][3],[`--mantine-color-${n}-4`]:e.colors[t][4],[`--mantine-color-${n}-5`]:e.colors[t][5],[`--mantine-color-${n}-6`]:e.colors[t][6],[`--mantine-color-${n}-7`]:e.colors[t][7],[`--mantine-color-${n}-8`]:e.colors[t][8],[`--mantine-color-${n}-9`]:e.colors[t][9],...f}:f}function dNe(e){return!!e&&typeof e=="object"&&"mantine-virtual-color"in e}function bv(e,t,r){sa(t).forEach(n=>Object.assign(e,{[`--mantine-${r}-${n}`]:t[n]}))}const HQ=e=>{const t=Pb(e,"light"),r=e.defaultRadius in e.radius?e.radius[e.defaultRadius]:Nr(e.defaultRadius),n={variables:{"--mantine-scale":e.scale.toString(),"--mantine-cursor-type":e.cursorType,"--mantine-color-scheme":"light dark","--mantine-webkit-font-smoothing":e.fontSmoothing?"antialiased":"unset","--mantine-moz-font-smoothing":e.fontSmoothing?"grayscale":"unset","--mantine-color-white":e.white,"--mantine-color-black":e.black,"--mantine-line-height":e.lineHeights.md,"--mantine-font-family":e.fontFamily,"--mantine-font-family-monospace":e.fontFamilyMonospace,"--mantine-font-family-headings":e.headings.fontFamily,"--mantine-heading-font-weight":e.headings.fontWeight,"--mantine-heading-text-wrap":e.headings.textWrap,"--mantine-radius-default":r,"--mantine-primary-color-filled":`var(--mantine-color-${e.primaryColor}-filled)`,"--mantine-primary-color-filled-hover":`var(--mantine-color-${e.primaryColor}-filled-hover)`,"--mantine-primary-color-light":`var(--mantine-color-${e.primaryColor}-light)`,"--mantine-primary-color-light-hover":`var(--mantine-color-${e.primaryColor}-light-hover)`,"--mantine-primary-color-light-color":`var(--mantine-color-${e.primaryColor}-light-color)`},light:{"--mantine-primary-color-contrast":z7(e,"light"),"--mantine-color-bright":"var(--mantine-color-black)","--mantine-color-text":e.black,"--mantine-color-body":e.white,"--mantine-color-error":"var(--mantine-color-red-6)","--mantine-color-placeholder":"var(--mantine-color-gray-5)","--mantine-color-anchor":`var(--mantine-color-${e.primaryColor}-${t})`,"--mantine-color-default":"var(--mantine-color-white)","--mantine-color-default-hover":"var(--mantine-color-gray-0)","--mantine-color-default-color":"var(--mantine-color-black)","--mantine-color-default-border":"var(--mantine-color-gray-4)","--mantine-color-dimmed":"var(--mantine-color-gray-6)","--mantine-color-disabled":"var(--mantine-color-gray-2)","--mantine-color-disabled-color":"var(--mantine-color-gray-5)","--mantine-color-disabled-border":"var(--mantine-color-gray-3)"},dark:{"--mantine-primary-color-contrast":z7(e,"dark"),"--mantine-color-bright":"var(--mantine-color-white)","--mantine-color-text":"var(--mantine-color-dark-0)","--mantine-color-body":"var(--mantine-color-dark-7)","--mantine-color-error":"var(--mantine-color-red-8)","--mantine-color-placeholder":"var(--mantine-color-dark-3)","--mantine-color-anchor":`var(--mantine-color-${e.primaryColor}-4)`,"--mantine-color-default":"var(--mantine-color-dark-6)","--mantine-color-default-hover":"var(--mantine-color-dark-5)","--mantine-color-default-color":"var(--mantine-color-white)","--mantine-color-default-border":"var(--mantine-color-dark-4)","--mantine-color-dimmed":"var(--mantine-color-dark-2)","--mantine-color-disabled":"var(--mantine-color-dark-6)","--mantine-color-disabled-color":"var(--mantine-color-dark-3)","--mantine-color-disabled-border":"var(--mantine-color-gray-6)"}};bv(n.variables,e.breakpoints,"breakpoint"),bv(n.variables,e.spacing,"spacing"),bv(n.variables,e.fontSizes,"font-size"),bv(n.variables,e.lineHeights,"line-height"),bv(n.variables,e.shadows,"shadow"),bv(n.variables,e.radius,"radius"),e.colors[e.primaryColor].forEach((u,f)=>{n.variables[`--mantine-primary-color-${f}`]=`var(--mantine-color-${e.primaryColor}-${f})`}),sa(e.colors).forEach(u=>{const f=e.colors[u];if(dNe(f)){Object.assign(n.light,jw({theme:e,name:f.name,color:f.light,colorScheme:"light",withColorValues:!0})),Object.assign(n.dark,jw({theme:e,name:f.name,color:f.dark,colorScheme:"dark",withColorValues:!0}));return}f.forEach((i,y)=>{n.variables[`--mantine-color-${u}-${y}`]=i}),Object.assign(n.light,jw({theme:e,color:u,colorScheme:"light",withColorValues:!1})),Object.assign(n.dark,jw({theme:e,color:u,colorScheme:"dark",withColorValues:!1}))});const a=e.headings.sizes;return sa(a).forEach(u=>{n.variables[`--mantine-${u}-font-size`]=a[u].fontSize,n.variables[`--mantine-${u}-line-height`]=a[u].lineHeight,n.variables[`--mantine-${u}-font-weight`]=a[u].fontWeight||e.headings.fontWeight}),n};function hNe({theme:e,generator:t}){const r=HQ(e),n=t==null?void 0:t(e);return n?FD(r,n):r}const Gk=HQ(GD);function fNe(e){const t={variables:{},light:{},dark:{}};return sa(e.variables).forEach(r=>{Gk.variables[r]!==e.variables[r]&&(t.variables[r]=e.variables[r])}),sa(e.light).forEach(r=>{Gk.light[r]!==e.light[r]&&(t.light[r]=e.light[r])}),sa(e.dark).forEach(r=>{Gk.dark[r]!==e.dark[r]&&(t.dark[r]=e.dark[r])}),t}function pNe(e){return`
  ${e}[data-mantine-color-scheme="dark"] { --mantine-color-scheme: dark; }
  ${e}[data-mantine-color-scheme="light"] { --mantine-color-scheme: light; }
`}function WQ({cssVariablesSelector:e,deduplicateCssVariables:t}){const r=td(),n=UD(),a=qDe(),u=hNe({theme:r,generator:a}),f=e===":root"&&t,i=f?fNe(u):u,y=uNe(i,e);return y?b.jsx("style",{"data-mantine-styles":!0,nonce:n==null?void 0:n(),dangerouslySetInnerHTML:{__html:`${y}${f?"":pNe(e)}`}}):null}WQ.displayName="@mantine/CssVariables";function wv(e,t){var a,u;const r=typeof window<"u"&&"matchMedia"in window&&((a=window.matchMedia("(prefers-color-scheme: dark)"))==null?void 0:a.matches),n=e!=="auto"?e:r?"dark":"light";(u=t())==null||u.setAttribute("data-mantine-color-scheme",n)}function mNe({manager:e,defaultColorScheme:t,getRootElement:r,forceColorScheme:n}){const a=j.useRef(null),[u,f]=j.useState(()=>e.get(t)),i=n||u,y=j.useCallback(T=>{n||(wv(T,r),f(T),e.set(T))},[e.set,i,n]),w=j.useCallback(()=>{f(t),wv(t,r),e.clear()},[e.clear,t]);return j.useEffect(()=>(e.subscribe(y),e.unsubscribe),[e.subscribe,e.unsubscribe]),VD(()=>{wv(e.get(t),r)},[]),j.useEffect(()=>{var A;if(n)return wv(n,r),()=>{};n===void 0&&wv(u,r),typeof window<"u"&&"matchMedia"in window&&(a.current=window.matchMedia("(prefers-color-scheme: dark)"));const T=k=>{u==="auto"&&wv(k.matches?"dark":"light",r)};return(A=a.current)==null||A.addEventListener("change",T),()=>{var k;return(k=a.current)==null?void 0:k.removeEventListener("change",T)}},[u,n]),{colorScheme:i,setColorScheme:y,clearColorScheme:w}}function gNe({respectReducedMotion:e,getRootElement:t}){VD(()=>{var r;e&&((r=t())==null||r.setAttribute("data-respect-reduced-motion","true"))},[e])}function ZQ({theme:e,children:t,getStyleNonce:r,withStaticClasses:n=!0,withGlobalClasses:a=!0,deduplicateCssVariables:u=!0,withCssVariables:f=!0,cssVariablesSelector:i=":root",classNamesPrefix:y="mantine",colorSchemeManager:w=sNe(),defaultColorScheme:T="light",getRootElement:A=()=>document.documentElement,cssVariablesResolver:k,forceColorScheme:F,stylesTransform:D,env:O}){const{colorScheme:N,setColorScheme:V,clearColorScheme:H}=mNe({defaultColorScheme:T,forceColorScheme:F,manager:w,getRootElement:A});return gNe({respectReducedMotion:(e==null?void 0:e.respectReducedMotion)||!1,getRootElement:A}),b.jsx(UQ.Provider,{value:{colorScheme:N,setColorScheme:V,clearColorScheme:H,getRootElement:A,classNamesPrefix:y,getStyleNonce:r,cssVariablesResolver:k,cssVariablesSelector:i,withStaticClasses:n,stylesTransform:D,env:O},children:b.jsxs(qQ,{theme:e,children:[f&&b.jsx(WQ,{cssVariablesSelector:i,deduplicateCssVariables:u}),a&&b.jsx(cNe,{}),t]})})}ZQ.displayName="@mantine/core/MantineProvider";function yNe({classNames:e,styles:t,props:r,stylesCtx:n}){const a=td();return{resolvedClassNames:U2({theme:a,classNames:e,props:r,stylesCtx:n||void 0}),resolvedStyles:ME({theme:a,styles:t,props:r,stylesCtx:n||void 0})}}const vNe={always:"mantine-focus-always",auto:"mantine-focus-auto",never:"mantine-focus-never"};function _Ne({theme:e,options:t,unstyled:r}){return Li((t==null?void 0:t.focusable)&&!r&&(e.focusClassName||vNe[e.focusRing]),(t==null?void 0:t.active)&&!r&&e.activeClassName)}function xNe({selector:e,stylesCtx:t,options:r,props:n,theme:a}){return U2({theme:a,classNames:r==null?void 0:r.classNames,props:(r==null?void 0:r.props)||n,stylesCtx:t})[e]}function F7({selector:e,stylesCtx:t,theme:r,classNames:n,props:a}){return U2({theme:r,classNames:n,props:a,stylesCtx:t})[e]}function bNe({rootSelector:e,selector:t,className:r}){return e===t?r:void 0}function wNe({selector:e,classes:t,unstyled:r}){return r?void 0:t[e]}function SNe({themeName:e,classNamesPrefix:t,selector:r,withStaticClass:n}){return n===!1?[]:e.map(a=>`${t}-${a}-${r}`)}function ENe({themeName:e,theme:t,selector:r,props:n,stylesCtx:a}){return e.map(u=>{var f,i;return(i=U2({theme:t,classNames:(f=t.components[u])==null?void 0:f.classNames,props:n,stylesCtx:a}))==null?void 0:i[r]})}function TNe({options:e,classes:t,selector:r,unstyled:n}){return e!=null&&e.variant&&!n?t[`${r}--${e.variant}`]:void 0}function CNe({theme:e,options:t,themeName:r,selector:n,classNamesPrefix:a,classNames:u,classes:f,unstyled:i,className:y,rootSelector:w,props:T,stylesCtx:A,withStaticClasses:k,headless:F,transformedStyles:D}){return Li(_Ne({theme:e,options:t,unstyled:i||F}),ENe({theme:e,themeName:r,selector:n,props:T,stylesCtx:A}),TNe({options:t,classes:f,selector:n,unstyled:i}),F7({selector:n,stylesCtx:A,theme:e,classNames:u,props:T}),F7({selector:n,stylesCtx:A,theme:e,classNames:D,props:T}),xNe({selector:n,stylesCtx:A,options:t,props:T,theme:e}),bNe({rootSelector:w,selector:n,className:y}),wNe({selector:n,classes:f,unstyled:i||F}),k&&!F&&SNe({themeName:r,classNamesPrefix:a,selector:n,withStaticClass:t==null?void 0:t.withStaticClass}),t==null?void 0:t.className)}function ANe({theme:e,themeName:t,props:r,stylesCtx:n,selector:a}){return t.map(u=>{var f;return ME({theme:e,styles:(f=e.components[u])==null?void 0:f.styles,props:r,stylesCtx:n})[a]}).reduce((u,f)=>({...u,...f}),{})}function wR({style:e,theme:t}){return Array.isArray(e)?[...e].reduce((r,n)=>({...r,...wR({style:n,theme:t})}),{}):typeof e=="function"?e(t):e??{}}function PNe(e){return e.reduce((t,r)=>(r&&Object.keys(r).forEach(n=>{t[n]={...t[n],...Ny(r[n])}}),t),{})}function MNe({vars:e,varsResolver:t,theme:r,props:n,stylesCtx:a,selector:u,themeName:f,headless:i}){var y;return(y=PNe([i?{}:t==null?void 0:t(r,n,a),...f.map(w=>{var T,A,k;return(k=(A=(T=r.components)==null?void 0:T[w])==null?void 0:A.vars)==null?void 0:k.call(A,r,n,a)}),e==null?void 0:e(r,n,a)]))==null?void 0:y[u]}function INe({theme:e,themeName:t,selector:r,options:n,props:a,stylesCtx:u,rootSelector:f,styles:i,style:y,vars:w,varsResolver:T,headless:A,withStylesTransform:k}){return{...!k&&ANe({theme:e,themeName:t,props:a,stylesCtx:u,selector:r}),...!k&&ME({theme:e,styles:i,props:a,stylesCtx:u})[r],...!k&&ME({theme:e,styles:n==null?void 0:n.styles,props:(n==null?void 0:n.props)||a,stylesCtx:u})[r],...MNe({theme:e,props:a,stylesCtx:u,vars:w,varsResolver:T,selector:r,themeName:t,headless:A}),...f===r?wR({style:y,theme:e}):null,...wR({style:n==null?void 0:n.style,theme:e})}}function kNe({props:e,stylesCtx:t,themeName:r}){var f;const n=td(),a=(f=XDe())==null?void 0:f();return{getTransformedStyles:i=>a?[...i.map(w=>a(w,{props:e,theme:n,ctx:t})),...r.map(w=>{var T;return a((T=n.components[w])==null?void 0:T.styles,{props:e,theme:n,ctx:t})})].filter(Boolean):[],withStylesTransform:!!a}}function xo({name:e,classes:t,props:r,stylesCtx:n,className:a,style:u,rootSelector:f="root",unstyled:i,classNames:y,styles:w,vars:T,varsResolver:A}){const k=td(),F=GDe(),D=HDe(),O=WDe(),N=(Array.isArray(e)?e:[e]).filter(Z=>Z),{withStylesTransform:V,getTransformedStyles:H}=kNe({props:r,stylesCtx:n,themeName:N});return(Z,J)=>({className:CNe({theme:k,options:J,themeName:N,selector:Z,classNamesPrefix:F,classNames:y,classes:t,unstyled:i,className:a,rootSelector:f,props:r,stylesCtx:n,withStaticClasses:D,headless:O,transformedStyles:H([J==null?void 0:J.styles,w])}),style:INe({theme:k,themeName:N,selector:Z,options:J,props:r,stylesCtx:n,rootSelector:f,styles:w,style:u,vars:T,varsResolver:A,headless:O,withStylesTransform:V})})}function ONe(e,t){return typeof e=="boolean"?e:t.autoContrast}function ss(e,t,r){var f;const n=td(),a=(f=n.components[e])==null?void 0:f.defaultProps,u=typeof a=="function"?a(n):a;return{...t,...u,...Ny(r)}}function Hk(e){return sa(e).reduce((t,r)=>e[r]!==void 0?`${t}${PDe(r)}:${e[r]};`:t,"").trim()}function LNe({selector:e,styles:t,media:r,container:n}){const a=t?Hk(t):"",u=Array.isArray(r)?r.map(i=>`@media${i.query}{${e}{${Hk(i.styles)}}}`):[],f=Array.isArray(n)?n.map(i=>`@container ${i.query}{${e}{${Hk(i.styles)}}}`):[];return`${a?`${e}{${a}}`:""}${u.join("")}${f.join("")}`.trim()}function r1(e){const t=UD();return b.jsx("style",{"data-mantine-styles":"inline",nonce:t==null?void 0:t(),dangerouslySetInnerHTML:{__html:LNe(e)}})}function WD(e){const{m:t,mx:r,my:n,mt:a,mb:u,ml:f,mr:i,me:y,ms:w,p:T,px:A,py:k,pt:F,pb:D,pl:O,pr:N,pe:V,ps:H,bd:Z,bdrs:J,bg:G,c:Y,opacity:ie,ff:ce,fz:ge,fw:be,lts:xe,ta:Le,lh:ze,fs:Xe,tt:Je,td:tt,w:st,miw:Ne,maw:We,h:Ue,mih:De,mah:Ke,bgsz:lt,bgp:Ye,bgr:Ve,bga:Et,pos:kt,top:Wt,left:Tt,bottom:Ht,right:ur,inset:Jt,display:Rt,flex:Dt,hiddenFrom:sr,visibleFrom:mr,lightHidden:Vr,darkHidden:rn,sx:$r,...Yr}=e;return{styleProps:Ny({m:t,mx:r,my:n,mt:a,mb:u,ml:f,mr:i,me:y,ms:w,p:T,px:A,py:k,pt:F,pb:D,pl:O,pr:N,pe:V,ps:H,bd:Z,bg:G,c:Y,opacity:ie,ff:ce,fz:ge,fw:be,lts:xe,ta:Le,lh:ze,fs:Xe,tt:Je,td:tt,w:st,miw:Ne,maw:We,h:Ue,mih:De,mah:Ke,bgsz:lt,bgp:Ye,bgr:Ve,bga:Et,pos:kt,top:Wt,left:Tt,bottom:Ht,right:ur,inset:Jt,display:Rt,flex:Dt,bdrs:J,hiddenFrom:sr,visibleFrom:mr,lightHidden:Vr,darkHidden:rn,sx:$r}),rest:Yr}}const RNe={m:{type:"spacing",property:"margin"},mt:{type:"spacing",property:"marginTop"},mb:{type:"spacing",property:"marginBottom"},ml:{type:"spacing",property:"marginLeft"},mr:{type:"spacing",property:"marginRight"},ms:{type:"spacing",property:"marginInlineStart"},me:{type:"spacing",property:"marginInlineEnd"},mx:{type:"spacing",property:"marginInline"},my:{type:"spacing",property:"marginBlock"},p:{type:"spacing",property:"padding"},pt:{type:"spacing",property:"paddingTop"},pb:{type:"spacing",property:"paddingBottom"},pl:{type:"spacing",property:"paddingLeft"},pr:{type:"spacing",property:"paddingRight"},ps:{type:"spacing",property:"paddingInlineStart"},pe:{type:"spacing",property:"paddingInlineEnd"},px:{type:"spacing",property:"paddingInline"},py:{type:"spacing",property:"paddingBlock"},bd:{type:"border",property:"border"},bdrs:{type:"radius",property:"borderRadius"},bg:{type:"color",property:"background"},c:{type:"textColor",property:"color"},opacity:{type:"identity",property:"opacity"},ff:{type:"fontFamily",property:"fontFamily"},fz:{type:"fontSize",property:"fontSize"},fw:{type:"identity",property:"fontWeight"},lts:{type:"size",property:"letterSpacing"},ta:{type:"identity",property:"textAlign"},lh:{type:"lineHeight",property:"lineHeight"},fs:{type:"identity",property:"fontStyle"},tt:{type:"identity",property:"textTransform"},td:{type:"identity",property:"textDecoration"},w:{type:"spacing",property:"width"},miw:{type:"spacing",property:"minWidth"},maw:{type:"spacing",property:"maxWidth"},h:{type:"spacing",property:"height"},mih:{type:"spacing",property:"minHeight"},mah:{type:"spacing",property:"maxHeight"},bgsz:{type:"size",property:"backgroundSize"},bgp:{type:"identity",property:"backgroundPosition"},bgr:{type:"identity",property:"backgroundRepeat"},bga:{type:"identity",property:"backgroundAttachment"},pos:{type:"identity",property:"position"},top:{type:"size",property:"top"},left:{type:"size",property:"left"},bottom:{type:"size",property:"bottom"},right:{type:"size",property:"right"},inset:{type:"size",property:"inset"},display:{type:"identity",property:"display"},flex:{type:"identity",property:"flex"}};function ZD(e,t){const r=t1({color:e,theme:t});return r.color==="dimmed"?"var(--mantine-color-dimmed)":r.color==="bright"?"var(--mantine-color-bright)":r.variable?`var(${r.variable})`:r.color}function jNe(e,t){const r=t1({color:e,theme:t});return r.isThemeColor&&r.shade===void 0?`var(--mantine-color-${r.color}-text)`:ZD(e,t)}function DNe(e,t){if(typeof e=="number")return Nr(e);if(typeof e=="string"){const[r,n,...a]=e.split(" ").filter(f=>f.trim()!=="");let u=`${Nr(r)}`;return n&&(u+=` ${n}`),a.length>0&&(u+=` ${ZD(a.join(" "),t)}`),u.trim()}return e}const B7={text:"var(--mantine-font-family)",mono:"var(--mantine-font-family-monospace)",monospace:"var(--mantine-font-family-monospace)",heading:"var(--mantine-font-family-headings)",headings:"var(--mantine-font-family-headings)"};function NNe(e){return typeof e=="string"&&e in B7?B7[e]:e}const zNe=["h1","h2","h3","h4","h5","h6"];function FNe(e,t){return typeof e=="string"&&e in t.fontSizes?`var(--mantine-font-size-${e})`:typeof e=="string"&&zNe.includes(e)?`var(--mantine-${e}-font-size)`:typeof e=="number"||typeof e=="string"?Nr(e):e}function BNe(e){return e}const $Ne=["h1","h2","h3","h4","h5","h6"];function VNe(e,t){return typeof e=="string"&&e in t.lineHeights?`var(--mantine-line-height-${e})`:typeof e=="string"&&$Ne.includes(e)?`var(--mantine-${e}-line-height)`:e}function UNe(e,t){return typeof e=="string"&&e in t.radius?`var(--mantine-radius-${e})`:typeof e=="number"||typeof e=="string"?Nr(e):e}function qNe(e){return typeof e=="number"?Nr(e):e}function GNe(e,t){if(typeof e=="number")return Nr(e);if(typeof e=="string"){const r=e.replace("-","");if(!(r in t.spacing))return Nr(e);const n=`--mantine-spacing-${r}`;return e.startsWith("-")?`calc(var(${n}) * -1)`:`var(${n})`}return e}const Wk={color:ZD,textColor:jNe,fontSize:FNe,spacing:GNe,radius:UNe,identity:BNe,size:qNe,lineHeight:VNe,fontFamily:NNe,border:DNe};function $7(e){return e.replace("(min-width: ","").replace("em)","")}function HNe({media:e,...t}){const n=Object.keys(e).sort((a,u)=>Number($7(a))-Number($7(u))).map(a=>({query:a,styles:e[a]}));return{...t,media:n}}function WNe(e){if(typeof e!="object"||e===null)return!1;const t=Object.keys(e);return!(t.length===1&&t[0]==="base")}function ZNe(e){return typeof e=="object"&&e!==null?"base"in e?e.base:void 0:e}function XNe(e){return typeof e=="object"&&e!==null?sa(e).filter(t=>t!=="base"):[]}function KNe(e,t){return typeof e=="object"&&e!==null&&t in e?e[t]:e}function YNe({styleProps:e,data:t,theme:r}){return HNe(sa(e).reduce((n,a)=>{if(a==="hiddenFrom"||a==="visibleFrom"||a==="sx")return n;const u=t[a],f=Array.isArray(u.property)?u.property:[u.property],i=ZNe(e[a]);if(!WNe(e[a]))return f.forEach(w=>{n.inlineStyles[w]=Wk[u.type](i,r)}),n;n.hasResponsiveStyles=!0;const y=XNe(e[a]);return f.forEach(w=>{i&&(n.styles[w]=Wk[u.type](i,r)),y.forEach(T=>{const A=`(min-width: ${r.breakpoints[T]})`;n.media[A]={...n.media[A],[w]:Wk[u.type](KNe(e[a],T),r)}})}),n},{hasResponsiveStyles:!1,styles:{},inlineStyles:{},media:{}}))}function q2(){return`__m__-${j.useId().replace(/:/g,"")}`}function XQ(e){return e.startsWith("data-")?e:`data-${e}`}function JNe(e){return Object.keys(e).reduce((t,r)=>{const n=e[r];return n===void 0||n===""||n===!1||n===null||(t[XQ(r)]=e[r]),t},{})}function KQ(e){return e?typeof e=="string"?{[XQ(e)]:!0}:Array.isArray(e)?[...e].reduce((t,r)=>({...t,...KQ(r)}),{}):JNe(e):null}function SR(e,t){return Array.isArray(e)?[...e].reduce((r,n)=>({...r,...SR(n,t)}),{}):typeof e=="function"?e(t):e??{}}function QNe({theme:e,style:t,vars:r,styleProps:n}){const a=SR(t,e),u=SR(r,e);return{...a,...u,...n}}const YQ=j.forwardRef(({component:e,style:t,__vars:r,className:n,variant:a,mod:u,size:f,hiddenFrom:i,visibleFrom:y,lightHidden:w,darkHidden:T,renderRoot:A,__size:k,...F},D)=>{var ce;const O=td(),N=e||"div",{styleProps:V,rest:H}=WD(F),Z=ZDe(),J=(ce=Z==null?void 0:Z())==null?void 0:ce(V.sx),G=q2(),Y=YNe({styleProps:V,theme:O,data:RNe}),ie={ref:D,style:QNe({theme:O,style:t,vars:r,styleProps:Y.inlineStyles}),className:Li(n,J,{[G]:Y.hasResponsiveStyles,"mantine-light-hidden":w,"mantine-dark-hidden":T,[`mantine-hidden-from-${i}`]:i,[`mantine-visible-from-${y}`]:y}),"data-variant":a,"data-size":$Q(f)?void 0:f||void 0,size:k,...KQ(u),...H};return b.jsxs(b.Fragment,{children:[Y.hasResponsiveStyles&&b.jsx(r1,{selector:`.${G}`,styles:Y.styles,media:Y.media}),typeof A=="function"?A(ie):b.jsx(N,{...ie})]})});YQ.displayName="@mantine/core/Box";const is=YQ;function JQ(e){return e}function wa(e){const t=j.forwardRef(e);return t.extend=JQ,t.withProps=r=>{const n=j.forwardRef((a,u)=>b.jsx(t,{...r,...a,ref:u}));return n.extend=t.extend,n.displayName=`WithProps(${t.displayName})`,n},t}function mf(e){const t=j.forwardRef(e);return t.withProps=r=>{const n=j.forwardRef((a,u)=>b.jsx(t,{...r,...a,ref:u}));return n.extend=t.extend,n.displayName=`WithProps(${t.displayName})`,n},t.extend=JQ,t}var QQ={root:"m_87cf2631"};const e3e={__staticSelector:"UnstyledButton"},n1=mf((e,t)=>{const r=ss("UnstyledButton",e3e,e),{className:n,component:a="button",__staticSelector:u,unstyled:f,classNames:i,styles:y,style:w,...T}=r,A=xo({name:u,props:r,classes:QQ,className:n,style:w,classNames:i,styles:y,unstyled:f});return b.jsx(is,{...A("root",{focusable:!0}),component:a,ref:t,type:a==="button"?"button":void 0,...T})});n1.classes=QQ;n1.displayName="@mantine/core/UnstyledButton";var eee={root:"m_1b7284a3"};const t3e={},r3e=(e,{radius:t,shadow:r})=>({root:{"--paper-radius":t===void 0?void 0:ng(t),"--paper-shadow":kDe(r)}}),Mb=mf((e,t)=>{const r=ss("Paper",t3e,e),{classNames:n,className:a,style:u,styles:f,unstyled:i,withBorder:y,vars:w,radius:T,shadow:A,variant:k,mod:F,...D}=r,O=xo({name:"Paper",props:r,classes:eee,className:a,style:u,classNames:n,styles:f,unstyled:i,vars:w,varsResolver:r3e});return b.jsx(is,{ref:t,mod:[{"data-with-border":y},F],...O("root"),variant:k,...D})});Mb.classes=eee;Mb.displayName="@mantine/core/Paper";const tx=e=>({in:{opacity:1,transform:"scale(1)"},out:{opacity:0,transform:`scale(.9) translateY(${e==="bottom"?10:-10}px)`},transitionProperty:"transform, opacity"}),Dw={fade:{in:{opacity:1},out:{opacity:0},transitionProperty:"opacity"},"fade-up":{in:{opacity:1,transform:"translateY(0)"},out:{opacity:0,transform:"translateY(30px)"},transitionProperty:"opacity, transform"},"fade-down":{in:{opacity:1,transform:"translateY(0)"},out:{opacity:0,transform:"translateY(-30px)"},transitionProperty:"opacity, transform"},"fade-left":{in:{opacity:1,transform:"translateX(0)"},out:{opacity:0,transform:"translateX(30px)"},transitionProperty:"opacity, transform"},"fade-right":{in:{opacity:1,transform:"translateX(0)"},out:{opacity:0,transform:"translateX(-30px)"},transitionProperty:"opacity, transform"},scale:{in:{opacity:1,transform:"scale(1)"},out:{opacity:0,transform:"scale(0)"},common:{transformOrigin:"top"},transitionProperty:"transform, opacity"},"scale-y":{in:{opacity:1,transform:"scaleY(1)"},out:{opacity:0,transform:"scaleY(0)"},common:{transformOrigin:"top"},transitionProperty:"transform, opacity"},"scale-x":{in:{opacity:1,transform:"scaleX(1)"},out:{opacity:0,transform:"scaleX(0)"},common:{transformOrigin:"left"},transitionProperty:"transform, opacity"},"skew-up":{in:{opacity:1,transform:"translateY(0) skew(0deg, 0deg)"},out:{opacity:0,transform:"translateY(-20px) skew(-10deg, -5deg)"},common:{transformOrigin:"top"},transitionProperty:"transform, opacity"},"skew-down":{in:{opacity:1,transform:"translateY(0) skew(0deg, 0deg)"},out:{opacity:0,transform:"translateY(20px) skew(-10deg, -5deg)"},common:{transformOrigin:"bottom"},transitionProperty:"transform, opacity"},"rotate-left":{in:{opacity:1,transform:"translateY(0) rotate(0deg)"},out:{opacity:0,transform:"translateY(20px) rotate(-5deg)"},common:{transformOrigin:"bottom"},transitionProperty:"transform, opacity"},"rotate-right":{in:{opacity:1,transform:"translateY(0) rotate(0deg)"},out:{opacity:0,transform:"translateY(20px) rotate(5deg)"},common:{transformOrigin:"top"},transitionProperty:"transform, opacity"},"slide-down":{in:{opacity:1,transform:"translateY(0)"},out:{opacity:0,transform:"translateY(-100%)"},common:{transformOrigin:"top"},transitionProperty:"transform, opacity"},"slide-up":{in:{opacity:1,transform:"translateY(0)"},out:{opacity:0,transform:"translateY(100%)"},common:{transformOrigin:"bottom"},transitionProperty:"transform, opacity"},"slide-left":{in:{opacity:1,transform:"translateX(0)"},out:{opacity:0,transform:"translateX(100%)"},common:{transformOrigin:"left"},transitionProperty:"transform, opacity"},"slide-right":{in:{opacity:1,transform:"translateX(0)"},out:{opacity:0,transform:"translateX(-100%)"},common:{transformOrigin:"right"},transitionProperty:"transform, opacity"},pop:{...tx("bottom"),common:{transformOrigin:"center center"}},"pop-bottom-left":{...tx("bottom"),common:{transformOrigin:"bottom left"}},"pop-bottom-right":{...tx("bottom"),common:{transformOrigin:"bottom right"}},"pop-top-left":{...tx("top"),common:{transformOrigin:"top left"}},"pop-top-right":{...tx("top"),common:{transformOrigin:"top right"}}},V7={entering:"in",entered:"in",exiting:"out",exited:"out","pre-exiting":"out","pre-entering":"out"};function n3e({transition:e,state:t,duration:r,timingFunction:n}){const a={WebkitBackfaceVisibility:"hidden",willChange:"transform, opacity",transitionDuration:`${r}ms`,transitionTimingFunction:n};return typeof e=="string"?e in Dw?{transitionProperty:Dw[e].transitionProperty,...a,...Dw[e].common,...Dw[e][V7[t]]}:{}:{transitionProperty:e.transitionProperty,...a,...e.common,...e[V7[t]]}}function i3e({duration:e,exitDuration:t,timingFunction:r,mounted:n,onEnter:a,onExit:u,onEntered:f,onExited:i,enterDelay:y,exitDelay:w}){const T=td(),A=$De(),k=T.respectReducedMotion?A:!1,[F,D]=j.useState(k?0:e),[O,N]=j.useState(n?"entered":"exited"),V=j.useRef(-1),H=j.useRef(-1),Z=j.useRef(-1);function J(){window.clearTimeout(V.current),window.clearTimeout(H.current),cancelAnimationFrame(Z.current)}const G=ie=>{J();const ce=ie?a:u,ge=ie?f:i,be=k?0:ie?e:t;D(be),be===0?(typeof ce=="function"&&ce(),typeof ge=="function"&&ge(),N(ie?"entered":"exited")):Z.current=requestAnimationFrame(()=>{oH.flushSync(()=>{N(ie?"pre-entering":"pre-exiting")}),Z.current=requestAnimationFrame(()=>{typeof ce=="function"&&ce(),N(ie?"entering":"exiting"),V.current=window.setTimeout(()=>{typeof ge=="function"&&ge(),N(ie?"entered":"exited")},be)})})},Y=ie=>{if(J(),typeof(ie?y:w)!="number"){G(ie);return}H.current=window.setTimeout(()=>{G(ie)},ie?y:w)};return NDe(()=>{Y(n)},[n]),j.useEffect(()=>()=>{J()},[]),{transitionDuration:F,transitionStatus:O,transitionTimingFunction:r||"ease"}}function XD({keepMounted:e,transition:t="fade",duration:r=250,exitDuration:n=r,mounted:a,children:u,timingFunction:f="ease",onExit:i,onEntered:y,onEnter:w,onExited:T,enterDelay:A,exitDelay:k}){const F=KDe(),{transitionDuration:D,transitionStatus:O,transitionTimingFunction:N}=i3e({mounted:a,exitDuration:n,duration:r,timingFunction:f,onExit:i,onEntered:y,onEnter:w,onExited:T,enterDelay:A,exitDelay:k});return D===0||F==="test"?a?b.jsx(b.Fragment,{children:u({})}):e?u({display:"none"}):null:O==="exited"?e?u({display:"none"}):null:b.jsx(b.Fragment,{children:u(n3e({transition:t,duration:D,state:O,timingFunction:N}))})}XD.displayName="@mantine/core/Transition";var Yd={root:"m_5ae2e3c",barsLoader:"m_7a2bd4cd",bar:"m_870bb79","bars-loader-animation":"m_5d2b3b9d",dotsLoader:"m_4e3f22d7",dot:"m_870c4af","loader-dots-animation":"m_aac34a1",ovalLoader:"m_b34414df","oval-loader-animation":"m_f8e89c4b"};const tee=j.forwardRef(({className:e,...t},r)=>b.jsxs(is,{component:"span",className:Li(Yd.barsLoader,e),...t,ref:r,children:[b.jsx("span",{className:Yd.bar}),b.jsx("span",{className:Yd.bar}),b.jsx("span",{className:Yd.bar})]}));tee.displayName="@mantine/core/Bars";const ree=j.forwardRef(({className:e,...t},r)=>b.jsxs(is,{component:"span",className:Li(Yd.dotsLoader,e),...t,ref:r,children:[b.jsx("span",{className:Yd.dot}),b.jsx("span",{className:Yd.dot}),b.jsx("span",{className:Yd.dot})]}));ree.displayName="@mantine/core/Dots";const nee=j.forwardRef(({className:e,...t},r)=>b.jsx(is,{component:"span",className:Li(Yd.ovalLoader,e),...t,ref:r}));nee.displayName="@mantine/core/Oval";const iee={bars:tee,oval:nee,dots:ree},s3e={loaders:iee,type:"oval"},o3e=(e,{size:t,color:r})=>({root:{"--loader-size":Xa(t,"loader-size"),"--loader-color":r?My(r,e):void 0}}),E_=wa((e,t)=>{const r=ss("Loader",s3e,e),{size:n,color:a,type:u,vars:f,className:i,style:y,classNames:w,styles:T,unstyled:A,loaders:k,variant:F,children:D,...O}=r,N=xo({name:"Loader",props:r,classes:Yd,className:i,style:y,classNames:w,styles:T,unstyled:A,vars:f,varsResolver:o3e});return D?b.jsx(is,{...N("root"),ref:t,...O,children:D}):b.jsx(is,{...N("root"),ref:t,component:k[u],variant:F,size:n,...O})});E_.defaultLoaders=iee;E_.classes=Yd;E_.displayName="@mantine/core/Loader";const see=j.forwardRef(({size:e="var(--cb-icon-size, 70%)",style:t,...r},n)=>b.jsx("svg",{viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{...t,width:e,height:e},ref:n,...r,children:b.jsx("path",{d:"M11.7816 4.03157C12.0062 3.80702 12.0062 3.44295 11.7816 3.2184C11.5571 2.99385 11.193 2.99385 10.9685 3.2184L7.50005 6.68682L4.03164 3.2184C3.80708 2.99385 3.44301 2.99385 3.21846 3.2184C2.99391 3.44295 2.99391 3.80702 3.21846 4.03157L6.68688 7.49999L3.21846 10.9684C2.99391 11.193 2.99391 11.557 3.21846 11.7816C3.44301 12.0061 3.80708 12.0061 4.03164 11.7816L7.50005 8.31316L10.9685 11.7816C11.193 12.0061 11.5571 12.0061 11.7816 11.7816C12.0062 11.557 12.0062 11.193 11.7816 10.9684L8.31322 7.49999L11.7816 4.03157Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"})}));see.displayName="@mantine/core/CloseIcon";var oee={root:"m_86a44da5","root--subtle":"m_220c80f2"};const a3e={variant:"subtle"},l3e=(e,{size:t,radius:r,iconSize:n})=>({root:{"--cb-size":Xa(t,"cb-size"),"--cb-radius":r===void 0?void 0:ng(r),"--cb-icon-size":Nr(n)}}),KD=mf((e,t)=>{const r=ss("CloseButton",a3e,e),{iconSize:n,children:a,vars:u,radius:f,className:i,classNames:y,style:w,styles:T,unstyled:A,"data-disabled":k,disabled:F,variant:D,icon:O,mod:N,__staticSelector:V,...H}=r,Z=xo({name:V||"CloseButton",props:r,className:i,style:w,classes:oee,classNames:y,styles:T,unstyled:A,vars:u,varsResolver:l3e});return b.jsxs(n1,{ref:t,...H,unstyled:A,variant:D,disabled:F,mod:[{disabled:F||k},N],...Z("root",{variant:D,active:!F&&!k}),children:[O||b.jsx(see,{}),a]})});KD.classes=oee;KD.displayName="@mantine/core/CloseButton";function c3e(e){return j.Children.toArray(e).filter(Boolean)}var aee={root:"m_4081bf90"};const u3e={preventGrowOverflow:!0,gap:"md",align:"center",justify:"flex-start",wrap:"wrap"},d3e=(e,{grow:t,preventGrowOverflow:r,gap:n,align:a,justify:u,wrap:f},{childWidth:i})=>({root:{"--group-child-width":t&&r?i:void 0,"--group-gap":xl(n),"--group-align":a,"--group-justify":u,"--group-wrap":f}}),zv=wa((e,t)=>{const r=ss("Group",u3e,e),{classNames:n,className:a,style:u,styles:f,unstyled:i,children:y,gap:w,align:T,justify:A,wrap:k,grow:F,preventGrowOverflow:D,vars:O,variant:N,__size:V,mod:H,...Z}=r,J=c3e(y),G=J.length,Y=xl(w??"md"),ce={childWidth:`calc(${100/G}% - (${Y} - ${Y} / ${G}))`},ge=xo({name:"Group",props:r,stylesCtx:ce,className:a,style:u,classes:aee,classNames:n,styles:f,unstyled:i,vars:O,varsResolver:d3e});return b.jsx(is,{...ge("root"),ref:t,variant:N,mod:[{grow:F},H],size:V,...Z,children:J})});zv.classes=aee;zv.displayName="@mantine/core/Group";const[h3e,f3e]=VQ({size:"sm"}),p3e={},lee=wa((e,t)=>{const r=ss("InputClearButton",p3e,e),{size:n,variant:a,vars:u,classNames:f,styles:i,...y}=r,w=f3e(),{resolvedClassNames:T,resolvedStyles:A}=yNe({classNames:f,styles:i,props:r});return b.jsx(KD,{variant:a||"transparent",ref:t,size:n||(w==null?void 0:w.size)||"sm",classNames:T,styles:A,__staticSelector:"InputClearButton",...y})});lee.displayName="@mantine/core/InputClearButton";const[m3e,G2]=VQ({offsetBottom:!1,offsetTop:!1,describedBy:void 0,getStyles:null,inputId:void 0,labelId:void 0});var rd={wrapper:"m_6c018570",input:"m_8fb7ebe7",section:"m_82577fc2",placeholder:"m_88bacfd0",root:"m_46b77525",label:"m_8fdc1311",required:"m_78a94662",error:"m_8f816625",description:"m_fe47ce59"};const U7={},g3e=(e,{size:t})=>({description:{"--input-description-size":t===void 0?void 0:`calc(${cu(t)} - ${Nr(2)})`}}),H2=wa((e,t)=>{const r=ss("InputDescription",U7,e),{classNames:n,className:a,style:u,styles:f,unstyled:i,vars:y,size:w,__staticSelector:T,__inheritStyles:A=!0,variant:k,...F}=ss("InputDescription",U7,r),D=G2(),O=xo({name:["InputWrapper",T],props:r,classes:rd,className:a,style:u,classNames:n,styles:f,unstyled:i,rootSelector:"description",vars:y,varsResolver:g3e}),N=A&&(D==null?void 0:D.getStyles)||O;return b.jsx(is,{component:"p",ref:t,variant:k,size:w,...N("description",D!=null&&D.getStyles?{className:a,style:u}:void 0),...F})});H2.classes=rd;H2.displayName="@mantine/core/InputDescription";const y3e={},v3e=(e,{size:t})=>({error:{"--input-error-size":t===void 0?void 0:`calc(${cu(t)} - ${Nr(2)})`}}),W2=wa((e,t)=>{const r=ss("InputError",y3e,e),{classNames:n,className:a,style:u,styles:f,unstyled:i,vars:y,size:w,__staticSelector:T,__inheritStyles:A=!0,variant:k,...F}=r,D=xo({name:["InputWrapper",T],props:r,classes:rd,className:a,style:u,classNames:n,styles:f,unstyled:i,rootSelector:"error",vars:y,varsResolver:v3e}),O=G2(),N=A&&(O==null?void 0:O.getStyles)||D;return b.jsx(is,{component:"p",ref:t,variant:k,size:w,...N("error",O!=null&&O.getStyles?{className:a,style:u}:void 0),...F})});W2.classes=rd;W2.displayName="@mantine/core/InputError";const q7={labelElement:"label"},_3e=(e,{size:t})=>({label:{"--input-label-size":cu(t),"--input-asterisk-color":void 0}}),Z2=wa((e,t)=>{const r=ss("InputLabel",q7,e),{classNames:n,className:a,style:u,styles:f,unstyled:i,vars:y,labelElement:w,size:T,required:A,htmlFor:k,onMouseDown:F,children:D,__staticSelector:O,variant:N,mod:V,...H}=ss("InputLabel",q7,r),Z=xo({name:["InputWrapper",O],props:r,classes:rd,className:a,style:u,classNames:n,styles:f,unstyled:i,rootSelector:"label",vars:y,varsResolver:_3e}),J=G2(),G=(J==null?void 0:J.getStyles)||Z;return b.jsxs(is,{...G("label",J!=null&&J.getStyles?{className:a,style:u}:void 0),component:w,variant:N,size:T,ref:t,htmlFor:w==="label"?k:void 0,mod:[{required:A},V],onMouseDown:Y=>{F==null||F(Y),!Y.defaultPrevented&&Y.detail>1&&Y.preventDefault()},...H,children:[D,A&&b.jsx("span",{...G("required"),"aria-hidden":!0,children:" *"})]})});Z2.classes=rd;Z2.displayName="@mantine/core/InputLabel";const G7={},YD=wa((e,t)=>{const r=ss("InputPlaceholder",G7,e),{classNames:n,className:a,style:u,styles:f,unstyled:i,vars:y,__staticSelector:w,variant:T,error:A,mod:k,...F}=ss("InputPlaceholder",G7,r),D=xo({name:["InputPlaceholder",w],props:r,classes:rd,className:a,style:u,classNames:n,styles:f,unstyled:i,rootSelector:"placeholder"});return b.jsx(is,{...D("placeholder"),mod:[{error:!!A},k],component:"span",variant:T,ref:t,...F})});YD.classes=rd;YD.displayName="@mantine/core/InputPlaceholder";function x3e(e,{hasDescription:t,hasError:r}){const n=e.findIndex(y=>y==="input"),a=e.slice(0,n),u=e.slice(n+1),f=t&&a.includes("description")||r&&a.includes("error");return{offsetBottom:t&&u.includes("description")||r&&u.includes("error"),offsetTop:f}}const b3e={labelElement:"label",inputContainer:e=>e,inputWrapperOrder:["label","description","input","error"]},w3e=(e,{size:t})=>({label:{"--input-label-size":cu(t),"--input-asterisk-color":void 0},error:{"--input-error-size":t===void 0?void 0:`calc(${cu(t)} - ${Nr(2)})`},description:{"--input-description-size":t===void 0?void 0:`calc(${cu(t)} - ${Nr(2)})`}}),JD=wa((e,t)=>{const r=ss("InputWrapper",b3e,e),{classNames:n,className:a,style:u,styles:f,unstyled:i,vars:y,size:w,variant:T,__staticSelector:A,inputContainer:k,inputWrapperOrder:F,label:D,error:O,description:N,labelProps:V,descriptionProps:H,errorProps:Z,labelElement:J,children:G,withAsterisk:Y,id:ie,required:ce,__stylesApiProps:ge,mod:be,...xe}=r,Le=xo({name:["InputWrapper",A],props:ge||r,classes:rd,className:a,style:u,classNames:n,styles:f,unstyled:i,vars:y,varsResolver:w3e}),ze={size:w,variant:T,__staticSelector:A},Xe=BDe(ie),Je=typeof Y=="boolean"?Y:ce,tt=(Z==null?void 0:Z.id)||`${Xe}-error`,st=(H==null?void 0:H.id)||`${Xe}-description`,Ne=Xe,We=!!O&&typeof O!="boolean",Ue=!!N,De=`${We?tt:""} ${Ue?st:""}`,Ke=De.trim().length>0?De.trim():void 0,lt=(V==null?void 0:V.id)||`${Xe}-label`,Ye=D&&b.jsx(Z2,{labelElement:J,id:lt,htmlFor:Ne,required:Je,...ze,...V,children:D},"label"),Ve=Ue&&b.jsx(H2,{...H,...ze,size:(H==null?void 0:H.size)||ze.size,id:(H==null?void 0:H.id)||st,children:N},"description"),Et=b.jsx(j.Fragment,{children:k(G)},"input"),kt=We&&j.createElement(W2,{...Z,...ze,size:(Z==null?void 0:Z.size)||ze.size,key:"error",id:(Z==null?void 0:Z.id)||tt},O),Wt=F.map(Tt=>{switch(Tt){case"label":return Ye;case"input":return Et;case"description":return Ve;case"error":return kt;default:return null}});return b.jsx(m3e,{value:{getStyles:Le,describedBy:Ke,inputId:Ne,labelId:lt,...x3e(F,{hasDescription:Ue,hasError:We})},children:b.jsx(is,{ref:t,variant:T,size:w,mod:[{error:!!O},be],...Le("root"),...xe,children:Wt})})});JD.classes=rd;JD.displayName="@mantine/core/InputWrapper";const S3e={variant:"default",leftSectionPointerEvents:"none",rightSectionPointerEvents:"none",withAria:!0,withErrorStyles:!0},E3e=(e,t,r)=>({wrapper:{"--input-margin-top":r.offsetTop?"calc(var(--mantine-spacing-xs) / 2)":void 0,"--input-margin-bottom":r.offsetBottom?"calc(var(--mantine-spacing-xs) / 2)":void 0,"--input-height":Xa(t.size,"input-height"),"--input-fz":cu(t.size),"--input-radius":t.radius===void 0?void 0:ng(t.radius),"--input-left-section-width":t.leftSectionWidth!==void 0?Nr(t.leftSectionWidth):void 0,"--input-right-section-width":t.rightSectionWidth!==void 0?Nr(t.rightSectionWidth):void 0,"--input-padding-y":t.multiline?Xa(t.size,"input-padding-y"):void 0,"--input-left-section-pointer-events":t.leftSectionPointerEvents,"--input-right-section-pointer-events":t.rightSectionPointerEvents}}),Ju=mf((e,t)=>{const r=ss("Input",S3e,e),{classNames:n,className:a,style:u,styles:f,unstyled:i,required:y,__staticSelector:w,__stylesApiProps:T,size:A,wrapperProps:k,error:F,disabled:D,leftSection:O,leftSectionProps:N,leftSectionWidth:V,rightSection:H,rightSectionProps:Z,rightSectionWidth:J,rightSectionPointerEvents:G,leftSectionPointerEvents:Y,variant:ie,vars:ce,pointer:ge,multiline:be,radius:xe,id:Le,withAria:ze,withErrorStyles:Xe,mod:Je,inputSize:tt,__clearSection:st,__clearable:Ne,__defaultRightSection:We,...Ue}=r,{styleProps:De,rest:Ke}=WD(Ue),lt=G2(),Ye={offsetBottom:lt==null?void 0:lt.offsetBottom,offsetTop:lt==null?void 0:lt.offsetTop},Ve=xo({name:["Input",w],props:T||r,classes:rd,className:a,style:u,classNames:n,styles:f,unstyled:i,stylesCtx:Ye,rootSelector:"wrapper",vars:ce,varsResolver:E3e}),Et=ze?{required:y,disabled:D,"aria-invalid":!!F,"aria-describedby":lt==null?void 0:lt.describedBy,id:(lt==null?void 0:lt.inputId)||Le}:{},kt=H||Ne&&st||We;return b.jsx(h3e,{value:{size:A||"sm"},children:b.jsxs(is,{...Ve("wrapper"),...De,...k,mod:[{error:!!F&&Xe,pointer:ge,disabled:D,multiline:be,"data-with-right-section":!!kt,"data-with-left-section":!!O},Je],variant:ie,size:A,children:[O&&b.jsx("div",{...N,"data-position":"left",...Ve("section",{className:N==null?void 0:N.className,style:N==null?void 0:N.style}),children:O}),b.jsx(is,{component:"input",...Ke,...Et,ref:t,required:y,mod:{disabled:D,error:!!F&&Xe},variant:ie,__size:tt,...Ve("input")}),kt&&b.jsx("div",{...Z,"data-position":"right",...Ve("section",{className:Z==null?void 0:Z.className,style:Z==null?void 0:Z.style}),children:kt})]})})});Ju.classes=rd;Ju.Wrapper=JD;Ju.Label=Z2;Ju.Error=W2;Ju.Description=H2;Ju.Placeholder=YD;Ju.ClearButton=lee;Ju.displayName="@mantine/core/Input";function T3e(e,t,r){const n=ss(e,t,r),{label:a,description:u,error:f,required:i,classNames:y,styles:w,className:T,unstyled:A,__staticSelector:k,__stylesApiProps:F,errorProps:D,labelProps:O,descriptionProps:N,wrapperProps:V,id:H,size:Z,style:J,inputContainer:G,inputWrapperOrder:Y,withAsterisk:ie,variant:ce,vars:ge,mod:be,...xe}=n,{styleProps:Le,rest:ze}=WD(xe),Xe={label:a,description:u,error:f,required:i,classNames:y,className:T,__staticSelector:k,__stylesApiProps:F||n,errorProps:D,labelProps:O,descriptionProps:N,unstyled:A,styles:w,size:Z,style:J,inputContainer:G,inputWrapperOrder:Y,withAsterisk:ie,variant:ce,id:H,mod:be,...V};return{...ze,classNames:y,styles:w,unstyled:A,wrapperProps:{...Xe,...Le},inputProps:{required:i,classNames:y,styles:w,unstyled:A,size:Z,__staticSelector:k,__stylesApiProps:F||n,error:f,variant:ce,id:H}}}const C3e={__staticSelector:"InputBase",withAria:!0},X2=mf((e,t)=>{const{inputProps:r,wrapperProps:n,...a}=T3e("InputBase",C3e,e);return b.jsx(Ju.Wrapper,{...n,children:b.jsx(Ju,{...r,...a,ref:t})})});X2.classes={...Ju.classes,...Ju.Wrapper.classes};X2.displayName="@mantine/core/InputBase";var cee={root:"m_b6d8b162"};function A3e(e){if(e==="start")return"start";if(e==="end"||e)return"end"}const P3e={inherit:!1},M3e=(e,{variant:t,lineClamp:r,gradient:n,size:a,color:u})=>({root:{"--text-fz":cu(a),"--text-lh":IDe(a),"--text-gradient":t==="gradient"?bR(n,e):void 0,"--text-line-clamp":typeof r=="number"?r.toString():void 0,"--text-color":u?My(u,e):void 0}}),Cx=mf((e,t)=>{const r=ss("Text",P3e,e),{lineClamp:n,truncate:a,inline:u,inherit:f,gradient:i,span:y,__staticSelector:w,vars:T,className:A,style:k,classNames:F,styles:D,unstyled:O,variant:N,mod:V,size:H,...Z}=r,J=xo({name:["Text",w],props:r,classes:cee,className:A,style:k,classNames:F,styles:D,unstyled:O,vars:T,varsResolver:M3e});return b.jsx(is,{...J("root",{focusable:!0}),ref:t,component:y?"span":"p",variant:N,mod:[{"data-truncate":A3e(a),"data-line-clamp":typeof n=="number","data-inline":u,"data-inherit":f},V],size:H,...Z})});Cx.classes=cee;Cx.displayName="@mantine/core/Text";function I3e({size:e,style:t,...r}){const n=e!==void 0?{width:Nr(e),height:Nr(e),...t}:t;return b.jsx("svg",{viewBox:"0 0 10 7",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:n,"aria-hidden":!0,...r,children:b.jsx("path",{d:"M4 4.586L1.707 2.293A1 1 0 1 0 .293 3.707l3 3a.997.997 0 0 0 1.414 0l5-5A1 1 0 1 0 8.293.293L4 4.586z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"})})}var uee={root:"m_347db0ec","root--dot":"m_fbd81e3d",label:"m_5add502a",section:"m_91fdda9b"};const k3e={},O3e=(e,{radius:t,color:r,gradient:n,variant:a,size:u,autoContrast:f})=>{const i=e.variantColorResolver({color:r||e.primaryColor,theme:e,gradient:n,variant:a||"filled",autoContrast:f});return{root:{"--badge-height":Xa(u,"badge-height"),"--badge-padding-x":Xa(u,"badge-padding-x"),"--badge-fz":Xa(u,"badge-fz"),"--badge-radius":t===void 0?void 0:ng(t),"--badge-bg":r||a?i.background:void 0,"--badge-color":r||a?i.color:void 0,"--badge-bd":r||a?i.border:void 0,"--badge-dot-color":a==="dot"?My(r,e):void 0}}},IE=mf((e,t)=>{const r=ss("Badge",k3e,e),{classNames:n,className:a,style:u,styles:f,unstyled:i,vars:y,radius:w,color:T,gradient:A,leftSection:k,rightSection:F,children:D,variant:O,fullWidth:N,autoContrast:V,circle:H,mod:Z,...J}=r,G=xo({name:"Badge",props:r,classes:uee,className:a,style:u,classNames:n,styles:f,unstyled:i,vars:y,varsResolver:O3e});return b.jsxs(is,{variant:O,mod:[{block:N,circle:H,"with-right-section":!!F,"with-left-section":!!k},Z],...G("root",{variant:O}),ref:t,...J,children:[k&&b.jsx("span",{...G("section"),"data-position":"left",children:k}),b.jsx("span",{...G("label"),children:D}),F&&b.jsx("span",{...G("section"),"data-position":"right",children:F})]})});IE.classes=uee;IE.displayName="@mantine/core/Badge";var U_={root:"m_77c9d27d",inner:"m_80f1301b",label:"m_811560b9",section:"m_a74036a",loader:"m_a25b86ee",group:"m_80d6d844",groupSection:"m_70be2a01"};const H7={orientation:"horizontal"},L3e=(e,{borderWidth:t})=>({group:{"--button-border-width":Nr(t)}}),QD=wa((e,t)=>{const r=ss("ButtonGroup",H7,e),{className:n,style:a,classNames:u,styles:f,unstyled:i,orientation:y,vars:w,borderWidth:T,variant:A,mod:k,...F}=ss("ButtonGroup",H7,e),D=xo({name:"ButtonGroup",props:r,classes:U_,className:n,style:a,classNames:u,styles:f,unstyled:i,vars:w,varsResolver:L3e,rootSelector:"group"});return b.jsx(is,{...D("group"),ref:t,variant:A,mod:[{"data-orientation":y},k],role:"group",...F})});QD.classes=U_;QD.displayName="@mantine/core/ButtonGroup";const W7={},R3e=(e,{radius:t,color:r,gradient:n,variant:a,autoContrast:u,size:f})=>{const i=e.variantColorResolver({color:r||e.primaryColor,theme:e,gradient:n,variant:a||"filled",autoContrast:u});return{groupSection:{"--section-height":Xa(f,"section-height"),"--section-padding-x":Xa(f,"section-padding-x"),"--section-fz":f!=null&&f.includes("compact")?cu(f.replace("compact-","")):cu(f),"--section-radius":t===void 0?void 0:ng(t),"--section-bg":r||a?i.background:void 0,"--section-color":i.color,"--section-bd":r||a?i.border:void 0}}},eN=wa((e,t)=>{const r=ss("ButtonGroupSection",W7,e),{className:n,style:a,classNames:u,styles:f,unstyled:i,vars:y,variant:w,gradient:T,radius:A,autoContrast:k,...F}=ss("ButtonGroupSection",W7,e),D=xo({name:"ButtonGroupSection",props:r,classes:U_,className:n,style:a,classNames:u,styles:f,unstyled:i,vars:y,varsResolver:R3e,rootSelector:"groupSection"});return b.jsx(is,{...D("groupSection"),ref:t,variant:w,...F})});eN.classes=U_;eN.displayName="@mantine/core/ButtonGroupSection";const j3e={in:{opacity:1,transform:`translate(-50%, calc(-50% + ${Nr(1)}))`},out:{opacity:0,transform:"translate(-50%, -200%)"},common:{transformOrigin:"center"},transitionProperty:"transform, opacity"},D3e={},N3e=(e,{radius:t,color:r,gradient:n,variant:a,size:u,justify:f,autoContrast:i})=>{const y=e.variantColorResolver({color:r||e.primaryColor,theme:e,gradient:n,variant:a||"filled",autoContrast:i});return{root:{"--button-justify":f,"--button-height":Xa(u,"button-height"),"--button-padding-x":Xa(u,"button-padding-x"),"--button-fz":u!=null&&u.includes("compact")?cu(u.replace("compact-","")):cu(u),"--button-radius":t===void 0?void 0:ng(t),"--button-bg":r||a?y.background:void 0,"--button-hover":r||a?y.hover:void 0,"--button-color":y.color,"--button-bd":r||a?y.border:void 0,"--button-hover-color":r||a?y.hoverColor:void 0}}},zm=mf((e,t)=>{const r=ss("Button",D3e,e),{style:n,vars:a,className:u,color:f,disabled:i,children:y,leftSection:w,rightSection:T,fullWidth:A,variant:k,radius:F,loading:D,loaderProps:O,gradient:N,classNames:V,styles:H,unstyled:Z,"data-disabled":J,autoContrast:G,mod:Y,...ie}=r,ce=xo({name:"Button",props:r,classes:U_,className:u,style:n,classNames:V,styles:H,unstyled:Z,vars:a,varsResolver:N3e}),ge=!!w,be=!!T;return b.jsxs(n1,{ref:t,...ce("root",{active:!i&&!D&&!J}),unstyled:Z,variant:k,disabled:i||D,mod:[{disabled:i||J,loading:D,block:A,"with-left-section":ge,"with-right-section":be},Y],...ie,children:[b.jsx(XD,{mounted:!!D,transition:j3e,duration:150,children:xe=>b.jsx(is,{component:"span",...ce("loader",{style:xe}),"aria-hidden":!0,children:b.jsx(E_,{color:"var(--button-color)",size:"calc(var(--button-height) / 1.8)",...O})})}),b.jsxs("span",{...ce("inner"),children:[w&&b.jsx(is,{component:"span",...ce("section"),mod:{position:"left"},children:w}),b.jsx(is,{component:"span",mod:{loading:D},...ce("label"),children:y}),T&&b.jsx(is,{component:"span",...ce("section"),mod:{position:"right"},children:T})]})]})});zm.classes=U_;zm.displayName="@mantine/core/Button";zm.Group=QD;zm.GroupSection=eN;const[z3e,F3e]=BD("Card component was not found in tree");var tN={root:"m_e615b15f",section:"m_599a2148"};const B3e={},K2=mf((e,t)=>{const r=ss("CardSection",B3e,e),{classNames:n,className:a,style:u,styles:f,vars:i,withBorder:y,inheritPadding:w,mod:T,...A}=r,k=F3e();return b.jsx(is,{ref:t,mod:[{"with-border":y,"inherit-padding":w},T],...k.getStyles("section",{className:a,style:u,styles:f,classNames:n}),...A})});K2.classes=tN;K2.displayName="@mantine/core/CardSection";const $3e={},V3e=(e,{padding:t})=>({root:{"--card-padding":xl(t)}}),Y2=mf((e,t)=>{const r=ss("Card",$3e,e),{classNames:n,className:a,style:u,styles:f,unstyled:i,vars:y,children:w,padding:T,...A}=r,k=xo({name:"Card",props:r,classes:tN,className:a,style:u,classNames:n,styles:f,unstyled:i,vars:y,varsResolver:V3e}),F=j.Children.toArray(w),D=F.map((O,N)=>typeof O=="object"&&O&&"type"in O&&O.type===K2?j.cloneElement(O,{"data-first-section":N===0||void 0,"data-last-section":N===F.length-1||void 0}):O);return b.jsx(z3e,{value:{getStyles:k},children:b.jsx(Mb,{ref:t,unstyled:i,...k("root"),...A,children:D})})});Y2.classes=tN;Y2.displayName="@mantine/core/Card";Y2.Section=K2;const[Z7,dee]=BD("Grid component was not found in tree"),ER=(e,t)=>e==="content"?"auto":e==="auto"?"0rem":e?`${100/(t/e)}%`:void 0,X7=(e,t,r)=>r||e==="auto"?"100%":e==="content"?"unset":ER(e,t),K7=(e,t)=>{if(e)return e==="auto"||t?"1":"auto"},Y7=(e,t)=>e===0?"0":e?`${100/(t/e)}%`:void 0;function U3e({span:e,order:t,offset:r,selector:n}){var F;const a=td(),u=dee(),f=u.breakpoints||a.breakpoints,y=Kd(e)===void 0?12:Kd(e),w=Ny({"--col-order":(F=Kd(t))==null?void 0:F.toString(),"--col-flex-grow":K7(y,u.grow),"--col-flex-basis":ER(y,u.columns),"--col-width":y==="content"?"auto":void 0,"--col-max-width":X7(y,u.columns,u.grow),"--col-offset":Y7(Kd(r),u.columns)}),T=sa(f).reduce((D,O)=>{var N;return D[O]||(D[O]={}),typeof t=="object"&&t[O]!==void 0&&(D[O]["--col-order"]=(N=t[O])==null?void 0:N.toString()),typeof e=="object"&&e[O]!==void 0&&(D[O]["--col-flex-grow"]=K7(e[O],u.grow),D[O]["--col-flex-basis"]=ER(e[O],u.columns),D[O]["--col-width"]=e[O]==="content"?"auto":void 0,D[O]["--col-max-width"]=X7(e[O],u.columns,u.grow)),typeof r=="object"&&r[O]!==void 0&&(D[O]["--col-offset"]=Y7(r[O],u.columns)),D},{}),k=$D(sa(T),f).filter(D=>sa(T[D.value]).length>0).map(D=>({query:u.type==="container"?`mantine-grid (min-width: ${f[D.value]})`:`(min-width: ${f[D.value]})`,styles:T[D.value]}));return b.jsx(r1,{styles:w,media:u.type==="container"?void 0:k,container:u.type==="container"?k:void 0,selector:n})}var rN={container:"m_8478a6da",root:"m_410352e9",inner:"m_dee7bd2f",col:"m_96bdd299"};const q3e={span:12},nN=wa((e,t)=>{const r=ss("GridCol",q3e,e),{classNames:n,className:a,style:u,styles:f,vars:i,span:y,order:w,offset:T,...A}=r,k=dee(),F=q2();return b.jsxs(b.Fragment,{children:[b.jsx(U3e,{selector:`.${F}`,span:y,order:w,offset:T}),b.jsx(is,{ref:t,...k.getStyles("col",{className:Li(a,F),style:u,classNames:n,styles:f}),...A})]})});nN.classes=rN;nN.displayName="@mantine/core/GridCol";function J7({gutter:e,selector:t,breakpoints:r,type:n}){const a=td(),u=r||a.breakpoints,f=Ny({"--grid-gutter":xl(Kd(e))}),i=sa(u).reduce((T,A)=>(T[A]||(T[A]={}),typeof e=="object"&&e[A]!==void 0&&(T[A]["--grid-gutter"]=xl(e[A])),T),{}),w=$D(sa(i),u).filter(T=>sa(i[T.value]).length>0).map(T=>({query:n==="container"?`mantine-grid (min-width: ${u[T.value]})`:`(min-width: ${u[T.value]})`,styles:i[T.value]}));return b.jsx(r1,{styles:f,media:n==="container"?void 0:w,container:n==="container"?w:void 0,selector:t})}const G3e={gutter:"md",grow:!1,columns:12},H3e=(e,{justify:t,align:r,overflow:n})=>({root:{"--grid-justify":t,"--grid-align":r,"--grid-overflow":n}}),Ib=wa((e,t)=>{const r=ss("Grid",G3e,e),{classNames:n,className:a,style:u,styles:f,unstyled:i,vars:y,grow:w,gutter:T,columns:A,align:k,justify:F,children:D,breakpoints:O,type:N,...V}=r,H=xo({name:"Grid",classes:rN,props:r,className:a,style:u,classNames:n,styles:f,unstyled:i,vars:y,varsResolver:H3e}),Z=q2();return N==="container"&&O?b.jsxs(Z7,{value:{getStyles:H,grow:w,columns:A,breakpoints:O,type:N},children:[b.jsx(J7,{selector:`.${Z}`,...r}),b.jsx("div",{...H("container"),children:b.jsx(is,{ref:t,...H("root",{className:Z}),...V,children:b.jsx("div",{...H("inner"),children:D})})})]}):b.jsxs(Z7,{value:{getStyles:H,grow:w,columns:A,breakpoints:O,type:N},children:[b.jsx(J7,{selector:`.${Z}`,...r}),b.jsx(is,{ref:t,...H("root",{className:Z}),...V,children:b.jsx("div",{...H("inner"),children:D})})]})});Ib.classes=rN;Ib.displayName="@mantine/core/Grid";Ib.Col=nN;function W3e({spacing:e,verticalSpacing:t,cols:r,selector:n}){var T;const a=td(),u=t===void 0?e:t,f=Ny({"--sg-spacing-x":xl(Kd(e)),"--sg-spacing-y":xl(Kd(u)),"--sg-cols":(T=Kd(r))==null?void 0:T.toString()}),i=sa(a.breakpoints).reduce((A,k)=>(A[k]||(A[k]={}),typeof e=="object"&&e[k]!==void 0&&(A[k]["--sg-spacing-x"]=xl(e[k])),typeof u=="object"&&u[k]!==void 0&&(A[k]["--sg-spacing-y"]=xl(u[k])),typeof r=="object"&&r[k]!==void 0&&(A[k]["--sg-cols"]=r[k]),A),{}),w=$D(sa(i),a.breakpoints).filter(A=>sa(i[A.value]).length>0).map(A=>({query:`(min-width: ${a.breakpoints[A.value]})`,styles:i[A.value]}));return b.jsx(r1,{styles:f,media:w,selector:n})}function Zk(e){return typeof e=="object"&&e!==null?sa(e):[]}function Z3e(e){return e.sort((t,r)=>Ab(t)-Ab(r))}function X3e({spacing:e,verticalSpacing:t,cols:r}){const n=Array.from(new Set([...Zk(e),...Zk(t),...Zk(r)]));return Z3e(n)}function K3e({spacing:e,verticalSpacing:t,cols:r,selector:n}){var w;const a=t===void 0?e:t,u=Ny({"--sg-spacing-x":xl(Kd(e)),"--sg-spacing-y":xl(Kd(a)),"--sg-cols":(w=Kd(r))==null?void 0:w.toString()}),f=X3e({spacing:e,verticalSpacing:t,cols:r}),i=f.reduce((T,A)=>(T[A]||(T[A]={}),typeof e=="object"&&e[A]!==void 0&&(T[A]["--sg-spacing-x"]=xl(e[A])),typeof a=="object"&&a[A]!==void 0&&(T[A]["--sg-spacing-y"]=xl(a[A])),typeof r=="object"&&r[A]!==void 0&&(T[A]["--sg-cols"]=r[A]),T),{}),y=f.map(T=>({query:`simple-grid (min-width: ${T})`,styles:i[T]}));return b.jsx(r1,{styles:u,container:y,selector:n})}var hee={container:"m_925c2d2c",root:"m_2415a157"};const Y3e={cols:1,spacing:"md",type:"media"},iN=wa((e,t)=>{const r=ss("SimpleGrid",Y3e,e),{classNames:n,className:a,style:u,styles:f,unstyled:i,vars:y,cols:w,verticalSpacing:T,spacing:A,type:k,...F}=r,D=xo({name:"SimpleGrid",classes:hee,props:r,className:a,style:u,classNames:n,styles:f,unstyled:i,vars:y}),O=q2();return k==="container"?b.jsxs(b.Fragment,{children:[b.jsx(K3e,{...r,selector:`.${O}`}),b.jsx("div",{...D("container"),children:b.jsx(is,{ref:t,...D("root",{className:O}),...F})})]}):b.jsxs(b.Fragment,{children:[b.jsx(W3e,{...r,selector:`.${O}`}),b.jsx(is,{ref:t,...D("root",{className:O}),...F})]})});iN.classes=hee;iN.displayName="@mantine/core/SimpleGrid";var fee={root:"m_18320242","skeleton-fade":"m_299c329c"};const J3e={visible:!0,animate:!0},Q3e=(e,{width:t,height:r,radius:n,circle:a})=>({root:{"--skeleton-height":Nr(r),"--skeleton-width":Nr(a?r:t),"--skeleton-radius":a?"1000px":n===void 0?void 0:ng(n)}}),sN=wa((e,t)=>{const r=ss("Skeleton",J3e,e),{classNames:n,className:a,style:u,styles:f,unstyled:i,vars:y,width:w,height:T,circle:A,visible:k,radius:F,animate:D,mod:O,...N}=r,V=xo({name:"Skeleton",classes:fee,props:r,className:a,style:u,classNames:n,styles:f,unstyled:i,vars:y,varsResolver:Q3e});return b.jsx(is,{ref:t,...V("root"),mod:[{visible:k,animate:D},O],...N})});sN.classes=fee;sN.displayName="@mantine/core/Skeleton";var pee={root:"m_6d731127"};const eze={gap:"md",align:"stretch",justify:"flex-start"},tze=(e,{gap:t,align:r,justify:n})=>({root:{"--stack-gap":xl(t),"--stack-align":r,"--stack-justify":n}}),oN=wa((e,t)=>{const r=ss("Stack",eze,e),{classNames:n,className:a,style:u,styles:f,unstyled:i,vars:y,align:w,justify:T,gap:A,variant:k,...F}=r,D=xo({name:"Stack",props:r,classes:pee,className:a,style:u,classNames:n,styles:f,unstyled:i,vars:y,varsResolver:tze});return b.jsx(is,{ref:t,...D("root"),variant:k,...F})});oN.classes=pee;oN.displayName="@mantine/core/Stack";const[rze,nze]=BD("Stepper component was not found in tree"),kE=()=>null;kE.displayName="@mantine/core/StepperCompleted";var aN={root:"m_cbb4ea7e",steps:"m_aaf89d0b",separator:"m_2a371ac9",content:"m_78da155d",step:"m_cbb57068","step--horizontal":"m_f56b1e2c","step--vertical":"m_833edb7e",verticalSeparator:"m_6496b3f3",stepWrapper:"m_818e70b",stepIcon:"m_1959ad01",stepCompletedIcon:"m_a79331dc",stepBody:"m_1956aa2a",stepLabel:"m_12051f6c",stepDescription:"m_164eea74"};const Nw=(e,t)=>typeof e=="function"?b.jsx(e,{step:t||0}):e,ize={withIcon:!0,allowStepClick:!0,iconPosition:"left"},lN=wa((e,t)=>{const{classNames:r,className:n,style:a,styles:u,vars:f,step:i,state:y,color:w,icon:T,completedIcon:A,progressIcon:k,label:F,description:D,withIcon:O,iconSize:N,loading:V,allowStepClick:H,allowStepSelect:Z,iconPosition:J,orientation:G,mod:Y,...ie}=ss("StepperStep",ize,e),ce=nze(),ge=td(),be={classNames:r,styles:u},xe=y==="stepCompleted"?null:y==="stepProgress"?k:T,Le={"data-progress":y==="stepProgress"||void 0,"data-completed":y==="stepCompleted"||void 0};return b.jsxs(n1,{...ce.getStyles("step",{className:n,style:a,variant:ce.orientation,...be}),mod:[{"icon-position":J||ce.iconPosition,"allow-click":H},Y],ref:t,...Le,...ie,__vars:{"--step-color":w?My(w,ge):void 0},tabIndex:H?0:-1,children:[O&&b.jsxs("span",{...ce.getStyles("stepWrapper",be),children:[b.jsxs("span",{...ce.getStyles("stepIcon",be),...Le,children:[b.jsx(XD,{mounted:y==="stepCompleted",transition:"pop",duration:200,children:ze=>b.jsx("span",{...ce.getStyles("stepCompletedIcon",{style:ze,...be}),children:V?b.jsx(E_,{color:"var(--mantine-color-white)",size:"calc(var(--stepper-icon-size) / 2)",...ce.getStyles("stepLoader",be)}):Nw(A,i)||b.jsx(I3e,{size:"60%"})})}),y!=="stepCompleted"?V?b.jsx(E_,{...ce.getStyles("stepLoader",be),size:"calc(var(--stepper-icon-size) / 2)",color:w}):Nw(xe||T,i):null]}),G==="vertical"&&b.jsx("span",{...ce.getStyles("verticalSeparator",be),"data-active":y==="stepCompleted"||void 0})]}),(F||D)&&b.jsxs("span",{...ce.getStyles("stepBody",be),"data-orientation":ce.orientation,"data-icon-position":J||ce.iconPosition,children:[F&&b.jsx("span",{...ce.getStyles("stepLabel",be),children:Nw(F,i)}),D&&b.jsx("span",{...ce.getStyles("stepDescription",be),children:Nw(D,i)})]})]})});lN.classes=aN;lN.displayName="@mantine/core/StepperStep";const sze={orientation:"horizontal",iconPosition:"left",allowNextStepsSelect:!0,wrap:!0},oze=(e,{color:t,iconSize:r,size:n,contentPadding:a,radius:u,autoContrast:f})=>({root:{"--stepper-color":t?My(t,e):void 0,"--stepper-icon-color":ONe(f,e)?GQ({color:t,theme:e,autoContrast:f}):void 0,"--stepper-icon-size":r===void 0?Xa(n,"stepper-icon-size"):Nr(r),"--stepper-content-padding":xl(a),"--stepper-radius":u===void 0?void 0:ng(u),"--stepper-fz":cu(n),"--stepper-spacing":xl(n)}}),_y=wa((e,t)=>{var Ne,We,Ue;const r=ss("Stepper",sze,e),{classNames:n,className:a,style:u,styles:f,unstyled:i,vars:y,children:w,onStepClick:T,active:A,icon:k,completedIcon:F,progressIcon:D,color:O,iconSize:N,contentPadding:V,orientation:H,iconPosition:Z,size:J,radius:G,allowNextStepsSelect:Y,wrap:ie,autoContrast:ce,...ge}=r,be=xo({name:"Stepper",classes:aN,props:r,className:a,style:u,classNames:n,styles:f,unstyled:i,vars:y,varsResolver:oze}),xe=j.Children.toArray(w),Le=xe.filter(De=>De.type!==kE),ze=xe.find(De=>De.type===kE),Xe=Le.reduce((De,Ke,lt)=>{const Ye=A===lt?"stepProgress":A>lt?"stepCompleted":"stepInactive",Et=typeof T!="function"?!1:typeof Ke.props.allowStepSelect=="boolean"?Ke.props.allowStepSelect:Ye==="stepCompleted"||Y;return De.push(j.cloneElement(Ke,{icon:Ke.props.icon||k||lt+1,key:lt,step:lt,state:Ye,onClick:()=>Et&&(T==null?void 0:T(lt)),allowStepClick:Et,completedIcon:Ke.props.completedIcon||F,progressIcon:Ke.props.progressIcon||D,color:Ke.props.color||O,iconSize:N,iconPosition:Ke.props.iconPosition||Z,orientation:H})),H==="horizontal"&&lt!==Le.length-1&&De.push(j.createElement("div",{...be("separator"),"data-active":lt<A||void 0,"data-orientation":H,key:`separator-${lt}`})),De},[]),Je=(We=(Ne=Le[A])==null?void 0:Ne.props)==null?void 0:We.children,tt=(Ue=ze==null?void 0:ze.props)==null?void 0:Ue.children,st=A>Le.length-1?tt:Je;return b.jsx(rze,{value:{getStyles:be,orientation:H,iconPosition:Z},children:b.jsxs(is,{...be("root"),ref:t,size:J,...ge,children:[b.jsx(is,{...be("steps"),mod:{orientation:H,"icon-position":Z,wrap:ie&&H!=="vertical"},children:Xe}),st&&b.jsx("div",{...be("content"),children:st})]})})});_y.classes=aN;_y.displayName="@mantine/core/Stepper";_y.Completed=kE;_y.Step=lN;const aze={},cN=wa((e,t)=>{const r=ss("TextInput",aze,e);return b.jsx(X2,{component:"input",ref:t,...r,__staticSelector:"TextInput"})});cN.classes=X2.classes;cN.displayName="@mantine/core/TextInput";const lze=["h1","h2","h3","h4","h5","h6"],cze=["xs","sm","md","lg","xl"];function uze(e,t){const r=t!==void 0?t:`h${e}`;return lze.includes(r)?{fontSize:`var(--mantine-${r}-font-size)`,fontWeight:`var(--mantine-${r}-font-weight)`,lineHeight:`var(--mantine-${r}-line-height)`}:cze.includes(r)?{fontSize:`var(--mantine-font-size-${r})`,fontWeight:`var(--mantine-h${e}-font-weight)`,lineHeight:`var(--mantine-h${e}-line-height)`}:{fontSize:Nr(r),fontWeight:`var(--mantine-h${e}-font-weight)`,lineHeight:`var(--mantine-h${e}-line-height)`}}var mee={root:"m_8a5d1357"};const dze={order:1},hze=(e,{order:t,size:r,lineClamp:n,textWrap:a})=>{const u=uze(t||1,r);return{root:{"--title-fw":u.fontWeight,"--title-lh":u.lineHeight,"--title-fz":u.fontSize,"--title-line-clamp":typeof n=="number"?n.toString():void 0,"--title-text-wrap":a}}},uN=wa((e,t)=>{const r=ss("Title",dze,e),{classNames:n,className:a,style:u,styles:f,unstyled:i,order:y,vars:w,size:T,variant:A,lineClamp:k,textWrap:F,mod:D,...O}=r,N=xo({name:"Title",props:r,classes:mee,className:a,style:u,classNames:n,styles:f,unstyled:i,vars:w,varsResolver:hze});return[1,2,3,4,5,6].includes(y)?b.jsx(is,{...N("root"),component:`h${y}`,variant:A,ref:t,mod:[{order:y,"data-line-clamp":typeof k=="number"},D],size:T,...O}):null});uN.classes=mee;uN.displayName="@mantine/core/Title";const fze=()=>{var O;const e=Sc(),t=Mo(),{user:r}=Rs(),n=((O=e.state)==null?void 0:O.suggestion)||{},{confidence:a,tokens_consumed:u}=n,[f,i]=j.useState(1),[y,w]=j.useState([]),[T,A]=j.useState(!1),k=ADe({initialValues:n.data||{}});j.useEffect(()=>{n&&n.data&&w(mR(n))},[n]);const F=async N=>{if(!r){Yn.error("Vous devez être connecté");return}A(!0);try{await $X({intention:n.intention||"creation_service",data:N}),window.dispatchEvent(new CustomEvent("service_created")),aDe(),t($n.MES_SERVICES)}catch(V){zQ(V.message)}finally{A(!1)}},D=async()=>{if(r){A(!0);try{await Yve({intention:n.intention,data:n.data}),Yn.success("✅ Service vectorisé !")}catch{Yn.error("Erreur vectorisation")}finally{A(!1)}}};return b.jsx(Ka,{padding:!0,children:b.jsxs(Mb,{p:"lg",shadow:"sm",radius:"md",className:"max-w-4xl mx-auto",children:[b.jsx(uN,{order:2,mb:"md",children:"Finalisez votre service"}),b.jsxs(_y,{active:f,onStepClick:i,mb:"xl",children:[b.jsx(_y.Step,{label:"Génération IA"}),b.jsx(_y.Step,{label:"Finalisation"})]}),T?b.jsx(sN,{height:300,radius:"md",animate:!0}):f===1?b.jsxs(oN,{spacing:"md",children:[b.jsx(Cx,{children:"Revoyez les suggestions générées par l’IA"}),b.jsxs(zv,{spacing:"md",children:[b.jsxs(IE,{color:"blue",children:["Confiance IA: ",a??0,"%"]}),b.jsxs(IE,{color:"green",children:["Tokens: ",u??0]})]}),b.jsx(iN,{cols:2,spacing:"md",breakpoints:[{maxWidth:"sm",cols:1}],mb:"md",children:y.map(N=>{var V;return b.jsxs(Mb,{p:"sm",withBorder:!0,radius:"md",children:[b.jsx(Cx,{weight:500,children:N.nomChamp}),b.jsx(Cx,{size:"sm",mt:"xs",children:typeof k.values[N.nomChamp]=="object"?((V=k.values[N.nomChamp])==null?void 0:V.valeur)??"-":k.values[N.nomChamp]??"-"})]},N.nomChamp)})}),b.jsx(zv,{position:"right",children:b.jsx(zm,{onClick:()=>i(2),children:"Suivant"})})]}):b.jsxs("form",{onSubmit:k.onSubmit(F),children:[b.jsx(Ib,{gutter:"md",children:y.map(N=>b.jsx(Ib.Col,{xs:12,md:6,children:b.jsx(Y2,{shadow:"xs",p:"sm",radius:"md",children:b.jsx(cN,{label:N.nomChamp,placeholder:`Entrez ${N.nomChamp}`,...k.getInputProps(N.nomChamp)})})},N.nomChamp))}),b.jsxs(zv,{position:"apart",mt:"md",children:[b.jsx(zm,{variant:"outline",onClick:()=>i(1),children:"Précédent"}),b.jsxs(zv,{children:[b.jsx(zm,{type:"submit",loading:T,children:"Enregistrer"}),b.jsx(zm,{variant:"outline",onClick:D,loading:T,children:"Vectoriser"})]})]})]})]})})},pze=[{id:"orange_money",name:"Orange Money",description:"Paiement mobile sécurisé",icon:"📱",enabled:!0,currencies:["XAF","XOF"],regions:["africa_west","africa_central"]},{id:"mtn_momo",name:"MTN Mobile Money",description:"Paiement mobile MTN",icon:"📱",enabled:!0,currencies:["XAF","XOF"],regions:["africa_west","africa_central"]},{id:"airtel_money",name:"Airtel Money",description:"Paiement mobile Airtel",icon:"📱",enabled:!0,currencies:["XAF"],regions:["africa_central"]},{id:"visa",name:"Visa",description:"Carte Visa",icon:"💳",enabled:!0,currencies:["USD","EUR","XAF","GBP","ZAR","NGN"],regions:["global"]},{id:"mastercard",name:"Mastercard",description:"Carte Mastercard",icon:"💳",enabled:!0,currencies:["USD","EUR","XAF","GBP","ZAR","NGN"],regions:["global"]},{id:"paypal",name:"PayPal",description:"Compte PayPal",icon:"🌐",enabled:!0,currencies:["USD","EUR","GBP"],regions:["america","europe"]},{id:"crypto_btc",name:"Bitcoin",description:"Paiement en Bitcoin",icon:"₿",enabled:!1,currencies:["BTC"],regions:["global"]}],mze={XAF:{name:"Franc CFA",symbol:"FCFA",decimals:0},XOF:{name:"Franc CFA (Ouest)",symbol:"FCFA",decimals:0},EUR:{name:"Euro",symbol:"€",decimals:2},USD:{name:"Dollar US",symbol:"$",decimals:2},GBP:{name:"Livre Sterling",symbol:"£",decimals:2},ZAR:{name:"Rand",symbol:"R",decimals:2},NGN:{name:"Naira",symbol:"₦",decimals:2}};function gze(e,t){return pze.filter(r=>r.enabled&&(r.currencies.includes(e)||r.regions.includes("global"))&&(r.regions.includes(t)||r.regions.includes("global")))}function yze(){const e=Intl.DateTimeFormat().resolvedOptions().timeZone;return e.includes("Africa")?e.includes("Dakar")||e.includes("Abidjan")?"africa_west":e.includes("Douala")||e.includes("Yaounde")?"africa_central":e.includes("Lagos")?"africa_west":e.includes("Johannesburg")?"africa_south":"africa_central":e.includes("Europe")?"europe":e.includes("America")?"america":"global"}async function vze(e){const t=localStorage.getItem("token");if(!t)throw new Error("Token d'authentification manquant");return(await Wn.post("/api/payments/initiate",e,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}})).data}async function _ze(e){const t=localStorage.getItem("token");if(!t)throw new Error("Token d'authentification manquant");return(await Wn.post("/api/payments/confirm",e,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}})).data}async function xze(e,t=!0){return _ze({payment_id:e,transaction_id:`sim_${Date.now()}`,status:t?"success":"failed"})}const bze=[{tokens:100,price_xaf:100,popular:!1},{tokens:500,price_xaf:500,popular:!0},{tokens:1e3,price_xaf:1e3,popular:!1},{tokens:2500,price_xaf:2500,popular:!1},{tokens:5e3,price_xaf:5e3,popular:!1}],wze=()=>{const{user:e}=Rs(),{creditDevise:t,devise:r}=EK(!1),[n,a]=j.useState(null),[u,f]=j.useState(null),[i,y]=j.useState(!1),[w,T]=j.useState(1),[A,k]=j.useState([]),F=yze();j.useEffect(()=>{const Z=gze(r,F);k(Z),r!=="XAF"&&D()},[r,F]);const D=async()=>{var Z;try{const G=await(await fetch(`https://api.exchangerate.host/latest?base=XAF&symbols=${r}`)).json(),Y=((Z=G==null?void 0:G.rates)==null?void 0:Z[r])||1;T(Y)}catch(J){console.error("Erreur lors de la récupération du taux de change:",J),T(1)}},O=Z=>r==="XAF"?Z:Math.round(Z*w*100)/100,N=Z=>Z*10,V=Z=>{const J=mze[r];return J?J.decimals===0?`${Math.round(Z)} ${J.symbol}`:`${Z.toFixed(J.decimals)} ${J.symbol}`:`${Z} ${r}`},H=async()=>{var Z,J;if(!n||!u){Yn.error("Veuillez sélectionner un pack et un moyen de paiement");return}y(!0);try{const G={amount_xaf:N(n.price_xaf),payment_method:u.id,currency:r,phone_number:(u.id.includes("money"),void 0)},Y=await vze(G);Yn.success(Y.instructions),u.id.includes("money")||u.id.includes("momo")?setTimeout(async()=>{try{const ie=await xze(Y.payment_id,!0);ie.success?(Yn.success(`✅ ${ie.message}`),setTimeout(()=>window.location.reload(),1500)):Yn.error("❌ Paiement échoué")}catch{Yn.error("Erreur lors de la confirmation")}},3e3):Y.payment_url&&window.open(Y.payment_url,"_blank")}catch(G){console.error("Erreur paiement:",G),Yn.error(((J=(Z=G.response)==null?void 0:Z.data)==null?void 0:J.message)||"Erreur lors du paiement")}finally{y(!1)}};return e?b.jsx(Ka,{padding:!0,children:b.jsxs("div",{className:"max-w-4xl mx-auto",children:[b.jsxs(va.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:[b.jsx("div",{className:"flex items-center gap-4 mb-6",children:b.jsxs(cr,{variant:"ghost",size:"sm",onClick:()=>window.history.back(),className:"flex items-center gap-2",children:[b.jsx(BE,{size:16}),"Retour"]})}),b.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Recharger vos tokens"}),b.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:["Solde actuel: ",b.jsx("span",{className:"font-semibold text-green-600",children:t!==null?V(t):"..."})]})]}),b.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[b.jsxs(va.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"space-y-4",children:[b.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Choisir un pack"}),bze.map((Z,J)=>b.jsxs("div",{className:`relative border rounded-lg p-4 cursor-pointer transition-all duration-200 ${n===Z?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300"} ${Z.popular?"ring-2 ring-blue-500 ring-opacity-50":""}`,onClick:()=>a(Z),children:[Z.popular&&b.jsx("span",{className:"absolute -top-2 left-4 bg-blue-500 text-white text-xs px-2 py-1 rounded",children:"Populaire"}),b.jsxs("div",{className:"flex justify-between items-center",children:[b.jsxs("div",{children:[b.jsxs("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[Z.tokens," tokens"]}),b.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:V(O(Z.price_xaf))})]}),n===Z&&b.jsx(yO,{className:"text-green-500",size:20})]})]},J))]}),b.jsxs(va.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"space-y-4",children:[b.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Moyen de paiement"}),A.map(Z=>b.jsx("div",{className:`border rounded-lg p-4 cursor-pointer transition-all duration-200 ${u===Z?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300"}`,onClick:()=>f(Z),children:b.jsxs("div",{className:"flex items-center gap-3",children:[b.jsx("span",{className:"text-2xl",children:Z.icon}),b.jsxs("div",{className:"flex-1",children:[b.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:Z.name}),b.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:Z.description})]}),u===Z&&b.jsx(yO,{className:"text-green-500",size:20})]})},Z.id))]})]}),n&&u&&b.jsxs(va.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mt-8 bg-gradient-to-r from-green-50 to-blue-50 dark:from-green-900/20 dark:to-blue-900/20 rounded-lg p-6",children:[b.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Résumé de l'achat"}),b.jsxs("div",{className:"space-y-2 mb-6",children:[b.jsxs("div",{className:"flex justify-between",children:[b.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Pack sélectionné:"}),b.jsxs("span",{className:"font-semibold",children:[n.tokens," tokens"]})]}),b.jsxs("div",{className:"flex justify-between",children:[b.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Prix:"}),b.jsx("span",{className:"font-semibold",children:V(O(n.price_xaf))})]}),b.jsxs("div",{className:"flex justify-between",children:[b.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Moyen de paiement:"}),b.jsx("span",{className:"font-semibold",children:u.name})]})]}),b.jsx(cr,{onClick:H,disabled:i,className:"w-full bg-gradient-to-r from-green-600 to-blue-600 hover:from-green-700 hover:to-blue-700 text-white font-medium py-3 px-4 rounded-lg",children:i?b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Traitement en cours..."]}):`Acheter ${n.tokens} tokens`})]})]})}):b.jsx(Ka,{padding:!0,children:b.jsx("div",{className:"text-center py-20",children:b.jsx("p",{className:"text-gray-500",children:"Connectez-vous pour recharger vos tokens"})})})},Sze=e=>`${window.location.origin}/service/${e}`,Eze=({open:e,onClose:t,serviceId:r,titre:n})=>{const a=Sze(r),{toast:u}=Oy(),f=()=>{navigator.clipboard.writeText(a),u({title:"✅ Lien copié !",description:"Le lien a été copié dans votre presse-papiers"})},i=w=>{let T="";const A=n||"Service Yukpo",k=`Découvrez ce service exceptionnel sur Yukpo : ${A}`,F=`${k}

${a}`;switch(w){case"whatsapp":T=`https://wa.me/?text=${encodeURIComponent(F)}`;break;case"facebook":T=`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(a)}&quote=${encodeURIComponent(k)}`;break;case"twitter":const O=`${k}

#Yukpo #Services #Cameroun

${a}`;T=`https://twitter.com/intent/tweet?text=${encodeURIComponent(O)}`;break;case"linkedin":T=`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(a)}`;break;case"telegram":T=`https://t.me/share/url?url=${encodeURIComponent(a)}&text=${encodeURIComponent(k)}`;break;case"email":const N=`Service Yukpo : ${A}`,V=`Bonjour,

Je vous partage ce service intéressant sur Yukpo :

${A}

${a}

Cordialement`;T=`mailto:?subject=${encodeURIComponent(N)}&body=${encodeURIComponent(V)}`;break}window.open(T,"_blank","width=600,height=400,scrollbars=yes,resizable=yes")},y=()=>{navigator.share?navigator.share({title:n||"Service Yukpo",text:`Découvrez ce service exceptionnel sur Yukpo : ${n||"Service Yukpo"}`,url:a}).then(()=>{u({title:"✅ Partage réussi !",description:"Le service a été partagé avec succès"})}).catch(w=>{console.log("Erreur de partage natif:",w),f()}):f()};return e?b.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:b.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-2xl shadow-2xl w-full max-w-md mx-auto relative animate-in fade-in-0 zoom-in-95 duration-200",children:[b.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[b.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[b.jsx(Kv,{className:"h-5 w-5 text-blue-600"}),"Partager ce service"]}),b.jsx("button",{className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",onClick:t,children:b.jsx(Os,{className:"h-5 w-5"})})]}),b.jsxs("div",{className:"p-6 space-y-6",children:[b.jsxs("div",{className:"space-y-2",children:[b.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Lien du service"}),b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx("input",{type:"text",value:a,readOnly:!0,className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",onFocus:w=>w.target.select()}),b.jsx(cr,{variant:"outline",size:"sm",onClick:f,className:"shrink-0",title:"Copier le lien",children:b.jsx(Uce,{className:"h-4 w-4"})})]})]}),b.jsxs("div",{className:"space-y-3",children:[b.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Partager sur"}),b.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[b.jsxs(cr,{className:"w-full bg-green-500 hover:bg-green-600 text-white transition-colors",onClick:()=>i("whatsapp"),children:[b.jsx(xy,{className:"h-4 w-4 mr-2"}),"WhatsApp"]}),b.jsxs(cr,{className:"w-full bg-blue-600 hover:bg-blue-700 text-white transition-colors",onClick:()=>i("facebook"),children:[b.jsx(eue,{className:"h-4 w-4 mr-2"}),"Facebook"]}),b.jsxs(cr,{className:"w-full bg-sky-500 hover:bg-sky-600 text-white transition-colors",onClick:()=>i("twitter"),children:[b.jsx(sde,{className:"h-4 w-4 mr-2"}),"Twitter"]}),b.jsxs(cr,{className:"w-full bg-blue-700 hover:bg-blue-800 text-white transition-colors",onClick:()=>i("linkedin"),children:[b.jsx("svg",{className:"h-4 w-4 mr-2",fill:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{d:"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"})}),"LinkedIn"]}),b.jsxs(cr,{className:"w-full bg-blue-500 hover:bg-blue-600 text-white transition-colors",onClick:()=>i("telegram"),children:[b.jsx("svg",{className:"h-4 w-4 mr-2",fill:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{d:"M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"})}),"Telegram"]}),b.jsxs(cr,{className:"w-full bg-gray-600 hover:bg-gray-700 text-white transition-colors",onClick:()=>i("email"),children:[b.jsx($E,{className:"h-4 w-4 mr-2"}),"Email"]})]})]}),b.jsx("div",{className:"pt-2",children:b.jsxs(cr,{className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white transition-all duration-200",onClick:y,children:[b.jsx(_ue,{className:"h-4 w-4 mr-2"}),"Partage natif"]})})]})]})}):null};function gee({logo:e,banniere:t,images_realisations:r=[],videos:n=[],className:a=""}){const[u,f]=j.useState(null),[i,y]=j.useState(0),[w,T]=j.useState(!1),A=[...e?[{type:"logo",url:e,label:"Logo"}]:[],...t?[{type:"banniere",url:t,label:"Bannière"}]:[],...r.map((N,V)=>({type:"image",url:N,label:`Réalisation ${V+1}`})),...n.map((N,V)=>({type:"video",url:N,label:`Vidéo ${V+1}`}))],k=(N,V)=>{f(N),y(V),T(!0)},F=()=>{T(!1),f(null)},D=()=>{if(A.length>1){const N=(i+1)%A.length;y(N),f(A[N])}},O=()=>{if(A.length>1){const N=i===0?A.length-1:i-1;y(N),f(A[N])}};return A.length===0?null:b.jsxs(b.Fragment,{children:[b.jsxs("div",{className:`space-y-3 ${a}`,children:[(e||t)&&b.jsxs("div",{className:"flex gap-2",children:[e&&b.jsxs("div",{className:"relative group",children:[b.jsx("img",{src:e,alt:"Logo du service",className:"w-16 h-16 object-cover rounded-lg border-2 border-gray-200 hover:border-blue-400 transition-colors cursor-pointer shadow-sm",onClick:()=>k({type:"logo",url:e,label:"Logo"},0)}),b.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all rounded-lg flex items-center justify-center",children:b.jsx(Fv,{className:"w-5 h-5 text-white opacity-0 group-hover:opacity-100 transition-opacity"})})]}),t&&b.jsxs("div",{className:"relative group flex-1",children:[b.jsx("img",{src:t,alt:"Bannière du service",className:"w-full h-16 object-cover rounded-lg border-2 border-gray-200 hover:border-blue-400 transition-colors cursor-pointer shadow-sm",onClick:()=>k({type:"banniere",url:t,label:"Bannière"},e?1:0)}),b.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all rounded-lg flex items-center justify-center",children:b.jsx(Fv,{className:"w-5 h-5 text-white opacity-0 group-hover:opacity-100 transition-opacity"})})]})]}),r.length>0&&b.jsx("div",{children:b.jsx("div",{className:"grid grid-cols-3 gap-2",children:r.slice(0,6).map((N,V)=>b.jsxs("div",{className:"relative group",children:[b.jsx("img",{src:N,alt:`Réalisation ${V+1}`,className:"w-full h-20 object-cover rounded-lg border border-gray-200 hover:border-blue-400 transition-colors cursor-pointer shadow-sm",onClick:()=>k({type:"image",url:N,label:`Réalisation ${V+1}`},(e?1:0)+(t?1:0)+V)}),b.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all rounded-lg flex items-center justify-center",children:b.jsx(Fv,{className:"w-4 h-4 text-white opacity-0 group-hover:opacity-100 transition-opacity"})}),V===5&&r.length>6&&b.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center",children:b.jsxs("span",{className:"text-white text-xs font-bold",children:["+",r.length-6]})})]},V))})}),n.length>0&&b.jsx("div",{children:b.jsx("div",{className:"grid grid-cols-2 gap-2",children:n.slice(0,4).map((N,V)=>b.jsxs("div",{className:"relative group",children:[b.jsx("div",{className:"w-full h-20 bg-gray-100 rounded-lg border border-gray-200 hover:border-blue-400 transition-colors cursor-pointer flex items-center justify-center shadow-sm",onClick:()=>k({type:"video",url:N,label:`Vidéo ${V+1}`},(e?1:0)+(t?1:0)+r.length+V),children:b.jsx(QW,{className:"w-6 h-6 text-gray-500 group-hover:text-blue-500 transition-colors"})}),b.jsx("div",{className:"absolute top-1 right-1 bg-black bg-opacity-70 text-white text-xs px-1 py-0.5 rounded",children:"Vidéo"})]},V))})})]}),w&&u&&b.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",children:b.jsxs("div",{className:"relative max-w-4xl max-h-full",children:[b.jsx(cr,{variant:"ghost",size:"icon",onClick:F,className:"absolute top-4 right-4 z-10 bg-white bg-opacity-20 hover:bg-opacity-30 text-white",children:b.jsx(Os,{className:"w-6 h-6"})}),A.length>1&&b.jsxs(b.Fragment,{children:[b.jsx(cr,{variant:"ghost",size:"icon",onClick:O,className:"absolute left-4 top-1/2 transform -translate-y-1/2 z-10 bg-white bg-opacity-20 hover:bg-opacity-30 text-white",children:b.jsx(Rce,{className:"w-6 h-6"})}),b.jsx(cr,{variant:"ghost",size:"icon",onClick:D,className:"absolute right-4 top-1/2 transform -translate-y-1/2 z-10 bg-white bg-opacity-20 hover:bg-opacity-30 text-white",children:b.jsx(Dce,{className:"w-6 h-6"})})]}),b.jsxs("div",{className:"text-center",children:[b.jsx("h3",{className:"text-white text-lg font-medium mb-4",children:u.label}),u.type==="video"?b.jsx("video",{src:u.url,controls:!0,className:"max-w-full max-h-[80vh] rounded-lg",autoPlay:!0,children:"Votre navigateur ne supporte pas la lecture de vidéos."}):b.jsx("img",{src:u.url,alt:u.label,className:"max-w-full max-h-[80vh] object-contain rounded-lg"})]}),A.length>1&&b.jsx("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-2",children:A.map((N,V)=>b.jsx("div",{className:`w-2 h-2 rounded-full ${V===i?"bg-white":"bg-white bg-opacity-50"}`},V))})]})})]})}const Tze=()=>{var Xe,Je,tt,st,Ne,We,Ue,De,Ke,lt;console.log("[MesServices] Composant monté");const{user:e,isLoading:t}=Rs(),r=Mo(),[n,a]=j.useState(()=>{const Ye=localStorage.getItem("mes_services");return Ye?JSON.parse(Ye):[]}),[u,f]=j.useState(!0),[i,y]=j.useState("tous"),[w,T]=j.useState(!1),[A,k]=j.useState(!1),[F,D]=j.useState(!1),[O,N]=j.useState(null),[V,H]=j.useState(!1),[Z,J]=j.useState(null);console.log("[MesServices] État initial - user:",e,"isLoading:",t,"loading:",u,"services count:",n.length),j.useEffect(()=>{!t&&!e&&r("/login",{replace:!0})},[e,t,r]),j.useEffect(()=>{const Ye=()=>{console.log("[MesServices] Event service_created reçu, actualisation immédiate des services..."),G()},Ve=()=>{!document.hidden&&e&&(console.log("[MesServices] Page redevenue visible, rafraîchissement des services..."),G())},kt=setInterval(()=>{localStorage.getItem("force_refresh_services")&&(console.log("[MesServices] Flag de rafraîchissement forcé détecté, actualisation..."),localStorage.removeItem("force_refresh_services"),G())},2e3);return window.addEventListener("service_created",Ye),document.addEventListener("visibilitychange",Ve),()=>{window.removeEventListener("service_created",Ye),document.removeEventListener("visibilitychange",Ve),clearInterval(kt)}},[e]);const G=()=>{console.log("[MesServices] Rafraîchissement immédiat déclenché"),k(!1),a([])};if(j.useEffect(()=>{if(!e)return;const Ye=setInterval(()=>{console.log("[MesServices] Rafraîchissement automatique des services..."),G()},3e4);return()=>clearInterval(Ye)},[e]),j.useEffect(()=>{if(!e||A){console.log("[MesServices] useEffect ignoré - user:",!!e,"hasFetched:",A);return}if(k(!0),console.log("[MesServices] useEffect déclenché, user:",e),!e){console.log("[MesServices] Pas d'utilisateur, arrêt du chargement");return}(async()=>{var Ve,Et;try{console.log("[MesServices] Début du chargement des services"),f(!0);const kt=localStorage.getItem("token");console.log("[MesServices] Token présent:",!!kt);const Wt=await Wn.get("/api/prestataire/services",{headers:{Authorization:`Bearer ${kt}`},timeout:1e4});console.log("[MesServices] Réponse API reçue:",Wt.status,Wt.data),console.log("[MesServices] Nombre de services:",((Ve=Wt.data)==null?void 0:Ve.length)||0);const Tt=Wt.data.sort((Ht,ur)=>new Date(ur.created_at).getTime()-new Date(Ht.created_at).getTime());console.log("[MesServices] Services triés:",Tt),a(Tt),localStorage.setItem("mes_services",JSON.stringify(Tt))}catch(kt){console.error("[MesServices] Erreur lors du chargement des services:",kt),console.error("[MesServices] Détails de l'erreur:",(Et=kt.response)==null?void 0:Et.data),Yn.error("Erreur lors du chargement des services")}finally{f(!1)}})()},[e,A]),u)return b.jsx(Ka,{children:b.jsx("div",{className:"flex justify-center items-center min-h-screen",children:b.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})})});const Y=Ye=>{if(!Ye)return"Date inconnue";try{return new Date(Ye).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}catch{return"Date invalide"}},ie=n.filter(Ye=>{if(i==="tous")return!0;const Ve=Ye.is_active!==void 0?Ye.is_active:Ye.actif;return i==="actif"?Ve:i==="inactif"?!Ve:!0}),ce=async(Ye,Ve)=>{try{if(!Ve){const kt=localStorage.getItem("token"),Tt=(await Wn.get("/api/users/balance",{headers:{Authorization:`Bearer ${kt}`}})).data.tokens_balance,Ht=500;if(Tt<Ht){Yn.error(`Solde insuffisant pour réactiver le service. Solde actuel: ${Tt} FCFA, Coût: ${Ht} FCFA`);return}await Wn.post("/api/users/deduct-balance",{amount:Ht,reason:"service_reactivation"},{headers:{Authorization:`Bearer ${kt}`}});const ur=Tt-Ht;localStorage.setItem("tokens_balance",ur.toString()),window.dispatchEvent(new CustomEvent("tokens_updated")),Yn.success(`Service réactivé ! Coût: ${Ht} FCFA. Nouveau solde: ${ur} FCFA`,{duration:5e3,icon:"💰"})}await Wn.patch(`/api/services/${Ye}/toggle-status`,{actif:!Ve},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});const Et=n.map(kt=>kt.id===Ye?{...kt,is_active:!Ve,actif:!Ve}:kt);a(Et),Ve&&(Et.filter(Wt=>Wt.is_active!==void 0?Wt.is_active:Wt.actif).length===0&&window.dispatchEvent(new CustomEvent("service_deleted")),Yn.success("Service désactivé"))}catch(Et){console.error("Erreur lors du changement de statut:",Et),Yn.error("Erreur lors du changement de statut")}},ge=Ye=>{J(Ye),H(!0)},be=Ye=>{N(Ye),D(!0)},xe=()=>{H(!1),J(null)},Le=async Ye=>{try{const Ve=localStorage.getItem("token");await Wn.delete(`/api/services/${Ye}/delete`,{headers:{Authorization:`Bearer ${Ve}`}}),a(n.filter(Et=>Et.id!==Ye)),Yn.success("Service supprimé avec succès"),window.dispatchEvent(new CustomEvent("service_deleted")),ze()}catch(Ve){console.error("Erreur lors de la suppression:",Ve),Yn.error("Erreur lors de la suppression du service")}},ze=async()=>{try{T(!0),localStorage.removeItem("mes_services"),k(!1);const Ye=localStorage.getItem("token"),Et=(await Wn.get("/api/prestataire/services",{headers:{Authorization:`Bearer ${Ye}`},timeout:1e4})).data.sort((kt,Wt)=>new Date(Wt.created_at).getTime()-new Date(kt.created_at).getTime());console.log("[MesServices] Services récupérés depuis l'API:",Et.length,"services"),console.log("[MesServices] Premier service (le plus récent):",Et[0]),console.log("[MesServices] Dernier service (le plus ancien):",Et[Et.length-1]),console.log("[MesServices] IDs des 5 derniers services:",Et.slice(0,5).map(kt=>kt.id)),a(Et),localStorage.setItem("mes_services",JSON.stringify(Et)),Yn.success("Services mis à jour !")}catch(Ye){console.error("[MesServices] Erreur lors du rafraîchissement:",Ye),Yn.error("Erreur lors du rafraîchissement")}finally{T(!1)}};return b.jsxs(Ka,{children:[b.jsxs("div",{className:"max-w-6xl mx-auto py-10 px-4 space-y-6",children:[b.jsxs("div",{className:"flex justify-between items-center",children:[b.jsx("h1",{className:"text-3xl font-bold text-primary",children:"🧰 Mes services Yukpo"}),b.jsxs("div",{className:"flex gap-2",children:[b.jsx(cr,{onClick:()=>r("/"),variant:"outline",size:"sm",className:"flex items-center gap-2",children:"🏠 Accueil"}),b.jsx(cr,{onClick:ze,disabled:w,variant:"outline",size:"sm",className:"flex items-center gap-2",children:w?b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"}),"Actualisation..."]}):b.jsx(b.Fragment,{children:"🔄 Actualiser"})})]})]}),b.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center",children:b.jsxs("p",{className:"text-blue-800",children:["Vous avez ",b.jsx("span",{className:"font-bold",children:n.length})," service(s) créé(s)",u&&b.jsx("span",{className:"ml-2 text-sm text-blue-600",children:"🔄 Actualisation en cours..."})]})}),b.jsxs("div",{className:"flex justify-center gap-2 flex-wrap",children:[b.jsxs(cr,{variant:i==="tous"?"default":"outline",onClick:()=>y("tous"),size:"sm",children:["📋 Tous (",n.length,")"]}),b.jsxs(cr,{variant:i==="actif"?"default":"outline",onClick:()=>y("actif"),size:"sm",children:["✅ Actifs (",n.filter(Ye=>Ye.is_active!==void 0?Ye.is_active:Ye.actif).length,")"]}),b.jsxs(cr,{variant:i==="inactif"?"default":"outline",onClick:()=>y("inactif"),size:"sm",children:["🚫 Inactifs (",n.filter(Ye=>!(Ye.is_active!==void 0?Ye.is_active:Ye.actif)).length,")"]})]}),ie.length===0?b.jsxs("div",{className:"text-center py-12",children:[b.jsx("p",{className:"text-gray-500 mb-4",children:i==="tous"?"Aucun service créé pour le moment.":`Aucun service ${i}.`}),b.jsx(cr,{onClick:()=>r("/formulaire-yukpo-intelligent"),children:"➕ Créer un nouveau service"})]}):b.jsx("div",{className:"grid gap-6 sm:grid-cols-2 lg:grid-cols-3",children:ie.map(Ye=>{var Ht,ur,Jt,Rt,Dt,sr,mr,Vr,rn,$r,Yr,un,Fn,vi,xr,Hr,wn,xi,ms,Ui,js,es,Uo,Ys,Js,bo,wo,So,Jn,Ds,Io,_s,uo,qo,oa,Qt;const Ve=((ur=(Ht=Ye.data)==null?void 0:Ht.titre_service)==null?void 0:ur.valeur)||((Rt=(Jt=Ye.data)==null?void 0:Jt.titre)==null?void 0:Rt.valeur)||Ye.titre||"Service sans titre",Et=((sr=(Dt=Ye.data)==null?void 0:Dt.description)==null?void 0:sr.valeur)||Ye.description||"Aucune description",kt=((Vr=(mr=Ye.data)==null?void 0:mr.category)==null?void 0:Vr.valeur)||(($r=(rn=Ye.data)==null?void 0:rn.categorie)==null?void 0:$r.valeur)||Ye.categorie||null,Wt=((un=(Yr=Ye.data)==null?void 0:Yr.prix)==null?void 0:un.valeur)||Ye.prix||null,Tt=((vi=(Fn=Ye.data)==null?void 0:Fn.localisation)==null?void 0:vi.valeur)||Ye.localisation||null;return b.jsxs("div",{className:`border rounded-lg p-5 space-y-3 shadow-sm hover:shadow-lg transition-all duration-200 relative overflow-hidden group ${(Ye.is_active!==void 0?Ye.is_active:Ye.actif)?"border-green-200 bg-white":"border-red-200 bg-red-50"}`,children:[(((Hr=(xr=Ye.data)==null?void 0:xr.banniere)==null?void 0:Hr.valeur)||Ye.banniere)&&b.jsx("div",{className:"absolute inset-0 bg-cover bg-center opacity-10 transition-opacity duration-300 group-hover:opacity-20",style:{backgroundImage:`url(${((xi=(wn=Ye.data)==null?void 0:wn.banniere)==null?void 0:xi.valeur)||Ye.banniere})`,backgroundSize:"cover",backgroundPosition:"center"}}),b.jsxs("div",{className:"relative bg-white/95 backdrop-blur-sm min-h-full p-4 rounded-lg",children:[(((Ui=(ms=Ye.data)==null?void 0:ms.logo)==null?void 0:Ui.valeur)||Ye.logo)&&b.jsx("div",{className:"absolute top-2 right-2 z-30",children:b.jsx("div",{className:"w-14 h-14 rounded-full border-3 border-white shadow-lg overflow-hidden bg-white",children:b.jsx("img",{src:((es=(js=Ye.data)==null?void 0:js.logo)==null?void 0:es.valeur)||Ye.logo,className:"w-full h-full object-cover",alt:"Logo du service",onError:Hs=>{Hs.currentTarget.style.display="none"}})})}),b.jsxs("div",{className:`${(Ys=(Uo=Ye.data)==null?void 0:Uo.logo)!=null&&Ys.valeur||Ye.logo?"pt-16":"pt-2"}`,children:[b.jsxs("div",{className:"flex justify-between items-start",children:[b.jsx("h2",{className:"text-lg font-semibold flex-1 pr-2",children:Ve}),b.jsx("span",{className:`px-2 py-1 text-xs rounded-full font-medium ${(Ye.is_active!==void 0?Ye.is_active:Ye.actif)?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:(Ye.is_active!==void 0?Ye.is_active:Ye.actif)?"● Actif":"○ Inactif"})]}),b.jsx("p",{className:"text-sm text-gray-600 line-clamp-2 mt-2",children:Et}),b.jsx("div",{className:"mt-3",children:b.jsx(gee,{logo:((bo=(Js=Ye.data)==null?void 0:Js.logo)==null?void 0:bo.valeur)||Ye.logo,banniere:((So=(wo=Ye.data)==null?void 0:wo.banniere)==null?void 0:So.valeur)||Ye.banniere,images_realisations:Array.isArray((Ds=(Jn=Ye.data)==null?void 0:Jn.images_realisations)==null?void 0:Ds.valeur)?Ye.data.images_realisations.valeur:Array.isArray((Io=Ye.data)==null?void 0:Io.images_realisations)?Ye.data.images_realisations:Array.isArray(Ye.images_realisations)?Ye.images_realisations:[],videos:Array.isArray((uo=(_s=Ye.data)==null?void 0:_s.videos)==null?void 0:uo.valeur)?Ye.data.videos.valeur:Array.isArray((qo=Ye.data)==null?void 0:qo.videos)?Ye.data.videos:Array.isArray(Ye.videos)?Ye.videos:[],className:"bg-gray-50 rounded-lg p-3"})}),b.jsxs("div",{className:"space-y-1 text-xs text-gray-500 mt-3",children:[kt&&b.jsxs("p",{children:["📁 ",b.jsx("span",{className:"font-medium",children:kt})]}),Tt&&b.jsxs("p",{children:["📍 ",Tt]}),Wt&&b.jsxs("p",{className:"text-blue-600 font-mono font-medium",children:["💰 ",Wt," FCFA"]}),b.jsxs("p",{className:"text-gray-400",children:["🗓 Créé le ",Y(Ye.created_at)]})]}),b.jsxs("div",{className:"flex flex-wrap gap-2 mt-3 pt-3 border-t",children:[b.jsx(cr,{size:"icon",variant:"ghost",onClick:()=>r("/formulaire-yukpo-intelligent",{state:{suggestion:{data:Ye.data||{},intention:Ye.intention||"creation_service",confidence:Ye.confidence||.8},type:"modification_service",mode:"edit",serviceId:Ye.id}}),title:"Modifier",children:b.jsx(JW,{className:"h-5 w-5"})}),b.jsx(cr,{size:"icon",variant:"ghost",onClick:()=>r("/formulaire-yukpo-intelligent",{state:{suggestion:{data:Ye.data||{},intention:Ye.intention||"creation_service",confidence:Ye.confidence||.8},type:"visualisation_service",mode:"readonly"}}),title:"Voir",children:b.jsx(jx,{className:"h-5 w-5"})}),b.jsx(cr,{size:"icon",variant:"ghost",onClick:()=>ge(Ye),title:"Partager",children:b.jsx(Kv,{className:"h-5 w-5 text-blue-600"})}),b.jsx(cr,{size:"icon",variant:"ghost",onClick:()=>be(Ye),title:"Gérer la promotion",className:(oa=Ye.promotion)!=null&&oa.active?"text-orange-600":"text-gray-600",children:(Qt=Ye.promotion)!=null&&Qt.active?b.jsxs("div",{className:"relative",children:[b.jsx("span",{className:"text-lg",children:"🎉"}),b.jsx("div",{className:"absolute -top-1 -right-1 w-2 h-2 bg-orange-500 rounded-full"})]}):b.jsx("span",{className:"text-lg",children:"🎉"})}),b.jsx(cr,{size:"icon",variant:"ghost",onClick:()=>ce(Ye.id,Ye.is_active!==void 0?Ye.is_active:Ye.actif),title:Ye.is_active!==void 0?Ye.is_active?"Désactiver":"Activer":Ye.actif?"Désactiver":"Activer",children:(Ye.is_active!==void 0?Ye.is_active:Ye.actif)?b.jsx(Fue,{className:"h-5 w-5 text-red-600"}):b.jsx($ue,{className:"h-5 w-5 text-green-600"})}),b.jsx(cr,{size:"icon",variant:"ghost",onClick:()=>{var Hs,Go,dt,ae;window.confirm(`Êtes-vous sûr de vouloir supprimer définitivement le service "${((Go=(Hs=Ye.data)==null?void 0:Hs.titre)==null?void 0:Go.valeur)||((ae=(dt=Ye.data)==null?void 0:dt.titre_service)==null?void 0:ae.valeur)||"ce service"}" ?

Cette action est irréversible.`)&&Le(Ye.id)},title:"Supprimer",children:b.jsx(rZ,{className:"h-5 w-5 text-red-600"})})]})]})]})]},Ye.id)})}),b.jsx("div",{className:"mt-8 pt-8 border-t border-gray-200",children:b.jsx("div",{className:"flex justify-center",children:b.jsx(cr,{onClick:()=>r("/"),className:"bg-blue-600 hover:bg-blue-700 text-white text-lg px-8 py-3 rounded-lg shadow-lg hover:shadow-xl transition-all duration-200",children:"🏠 Retour à l'accueil"})})})]}),Z&&b.jsx(Eze,{open:V,onClose:xe,serviceId:Z.id.toString(),titre:((Je=(Xe=Z.data)==null?void 0:Xe.titre_service)==null?void 0:Je.valeur)||((st=(tt=Z.data)==null?void 0:tt.titre)==null?void 0:st.valeur)||Z.titre||"Service Yukpo"}),O&&b.jsx("div",{className:`fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 ${F?"block":"hidden"}`,children:b.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[b.jsxs("div",{className:"flex justify-between items-center mb-4",children:[b.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"🎉 Promotion du service"}),b.jsx("button",{onClick:()=>D(!1),className:"text-gray-400 hover:text-gray-600",children:b.jsx(Os,{className:"h-6 w-6"})})]}),b.jsxs("div",{className:"mb-4",children:[b.jsx("p",{className:"text-sm text-gray-600 mb-3",children:b.jsx("strong",{children:((We=(Ne=O.data)==null?void 0:Ne.titre_service)==null?void 0:We.valeur)||((De=(Ue=O.data)==null?void 0:Ue.titre)==null?void 0:De.valeur)||"Service"})}),b.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 mb-4",children:[b.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Statut actuel"}),(Ke=O.promotion)!=null&&Ke.active?b.jsxs("div",{className:"space-y-2",children:[b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx("span",{className:"text-orange-600",children:"🎉"}),b.jsxs("span",{className:"text-sm font-medium",children:[O.promotion.type==="reduction"?"Réduction":"Promotion"," active"]})]}),b.jsxs("div",{className:"text-sm text-gray-600",children:[b.jsx("strong",{children:"Valeur :"})," ",O.promotion.valeur]}),O.promotion.description&&b.jsxs("div",{className:"text-sm text-gray-600",children:[b.jsx("strong",{children:"Description :"})," ",O.promotion.description]}),O.promotion.date_fin&&b.jsxs("div",{className:"text-sm text-gray-600",children:[b.jsx("strong",{children:"Valide jusqu'au :"})," ",Y(O.promotion.date_fin)]})]}):b.jsx("div",{className:"text-sm text-gray-500",children:"Aucune promotion active"})]}),b.jsxs("div",{className:"space-y-3",children:[(lt=O.promotion)!=null&&lt.active?b.jsxs(b.Fragment,{children:[b.jsx(cr,{onClick:()=>{window.confirm("Êtes-vous sûr de vouloir désactiver cette promotion ?")&&(Yn.success("Promotion désactivée avec succès"),D(!1),chargerServices())},variant:"outline",className:"w-full text-red-600 border-red-300 hover:bg-red-50",children:"❌ Désactiver la promotion"}),b.jsx(cr,{onClick:()=>{D(!1),r("/formulaire-yukpo-intelligent",{state:{suggestion:{data:O.data||{},intention:O.intention||"creation_service",confidence:O.confidence||.8},type:"modification_service",mode:"edit",serviceId:O.id}})},variant:"outline",className:"w-full",children:"✏️ Modifier la promotion"})]}):b.jsx(b.Fragment,{children:b.jsx(cr,{onClick:()=>{D(!1),r("/formulaire-yukpo-intelligent",{state:{suggestion:{data:O.data||{},intention:O.intention||"creation_service",confidence:O.confidence||.8},type:"modification_service",mode:"edit",serviceId:O.id}})},className:"w-full bg-orange-600 hover:bg-orange-700 text-white",children:"🎉 Créer une promotion"})}),b.jsx(cr,{onClick:()=>D(!1),variant:"ghost",className:"w-full",children:"Fermer"})]})]})]})})]})},Cze=e=>{const[t,r]=j.useState(!1),[n,a]=j.useState(null),[u,f]=j.useState(!1),[i,y]=j.useState(null);Rs();const w=j.useCallback(T=>{r(!0),a(new Date),y({id:T,status:"online"}),f(!0)},[]);return j.useEffect(()=>{e>0&&(r(!0),f(!0),a(new Date),y({id:e,status:"online"}))},[e]),{isOnline:t,lastSeen:n,status:t?"online":"offline",isConnected:u,checkUserStatus:w,userStatus:i}},Aze=e=>{const[t,r]=j.useState([]),[n,a]=j.useState(!1),[u,f]=j.useState(0);Rs();const i=j.useCallback(A=>{r(k=>k.map(F=>F.id===A?{...F,read:!0}:F)),f(k=>Math.max(0,k-1))},[]),y=j.useCallback(()=>{r(A=>A.map(k=>({...k,read:!0}))),f(0)},[]),w=j.useCallback(A=>{r(k=>{const F=k.find(D=>D.id===A);return F&&!F.read&&f(D=>Math.max(0,D-1)),k.filter(D=>D.id!==A)})},[]),T=j.useCallback(A=>{r(k=>[A,...k]),A.read||f(k=>k+1)},[]);return j.useEffect(()=>{if(e>0){a(!0);const A=[{id:"1",type:"message",title:"Nouveau message",content:"Vous avez reçu un nouveau message",timestamp:new Date,read:!1},{id:"2",type:"service",title:"Service mis à jour",content:"Votre service a été mis à jour",timestamp:new Date(Date.now()-36e5),read:!0}];r(A),f(A.filter(F=>!F.read).length);const k=setTimeout(()=>{a(!1)},3e5);return()=>{clearTimeout(k),a(!1)}}},[e]),{notifications:t,isConnected:n,unreadCount:u,markAsRead:i,markAllAsRead:y,removeNotification:w,addNotification:T}},Ax=j.forwardRef(({className:e,variant:t="default",...r},n)=>{const a={default:"border-transparent bg-blue-500 text-white hover:bg-blue-600",secondary:"border-transparent bg-gray-200 text-gray-800 hover:bg-gray-300",destructive:"border-transparent bg-red-500 text-white hover:bg-red-600",outline:"border border-gray-300 text-gray-700 hover:bg-gray-50"};return b.jsx("div",{ref:n,className:Ec("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors",a[t],e),...r})});Ax.displayName="Badge";const Pze=({service:e,onRatingSubmit:t,onReviewHelpful:r,showReviewForm:n=!1,className:a=""})=>{var J;const[u,f]=j.useState(n),[i,y]=j.useState(e.user_rating||0),[w,T]=j.useState(""),[A,k]=j.useState(!1),F=(J=e.data)==null?void 0:J.stats,D=e.reviews||[],O=async()=>{if(i!==0){k(!0);try{t&&(await t(i,w),T(""),f(!1))}catch(G){console.error("Erreur lors de la soumission de la note:",G)}finally{k(!1)}}},N=(G,Y=!1,ie="w-4 h-4")=>b.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(ce=>b.jsx("button",{type:Y?"button":void 0,onClick:Y?()=>y(ce):void 0,className:`${Y?"cursor-pointer hover:scale-110 transition-transform":""}`,disabled:!Y,children:b.jsx(uS,{className:`${ie} ${ce<=G?"text-yellow-400 fill-current":"text-gray-300"}`})},ce))}),V=()=>F?b.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600 bg-gray-50 px-2 py-1 rounded-full",children:[N(F.average_rating,!1,"w-3 h-3"),b.jsx("span",{className:"font-medium",children:F.average_rating.toFixed(1)}),b.jsx("span",{children:"•"}),b.jsxs("span",{children:[F.total_reviews," avis"]}),F.completion_rate>0&&b.jsxs(b.Fragment,{children:[b.jsx("span",{children:"•"}),b.jsx(oy,{className:"w-3 h-3 text-green-500"}),b.jsxs("span",{children:[Math.round(F.completion_rate*100),"%"]})]}),F.response_time>0&&b.jsxs(b.Fragment,{children:[b.jsx("span",{children:"•"}),b.jsx(XW,{className:"w-3 h-3 text-blue-500"}),b.jsxs("span",{children:[Math.round(F.response_time),"h"]})]})]}):null,H=()=>u?b.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[b.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-3",children:"Donner votre avis"}),b.jsxs("div",{className:"mb-3",children:[b.jsx("label",{className:"block text-xs text-blue-700 mb-2",children:"Note"}),N(i,!0,"w-6 h-6")]}),b.jsxs("div",{className:"mb-3",children:[b.jsx("label",{className:"block text-xs text-blue-700 mb-2",children:"Commentaire"}),b.jsx("textarea",{value:w,onChange:G=>T(G.target.value),placeholder:"Partagez votre expérience avec ce service...",className:"w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",rows:3})]}),b.jsxs("div",{className:"flex gap-2",children:[b.jsx(cr,{onClick:O,disabled:i===0||A,className:"bg-blue-600 hover:bg-blue-700 text-white text-sm",size:"sm",children:A?"Envoi...":"Envoyer l'avis"}),b.jsx(cr,{variant:"outline",onClick:()=>f(!1),className:"text-gray-600 border-gray-300 text-sm",size:"sm",children:"Annuler"})]})]}):null,Z=()=>D.length===0?null:b.jsxs("div",{className:"mt-4 space-y-3",children:[b.jsxs("h4",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[b.jsx(KW,{className:"w-4 h-4"}),"Avis récents (",D.length,")"]}),b.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:D.slice(0,3).map(G=>b.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[b.jsxs("div",{className:"flex items-start justify-between mb-2",children:[b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center text-white text-xs font-medium",children:G.user_name.charAt(0).toUpperCase()}),b.jsx("span",{className:"text-sm font-medium text-gray-900",children:G.user_name})]}),N(G.rating,!1,"w-3 h-3")]}),b.jsx("p",{className:"text-sm text-gray-700 mb-2",children:G.comment}),b.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[b.jsx("span",{children:new Date(G.created_at).toLocaleDateString()}),b.jsxs("button",{onClick:()=>r==null?void 0:r(G.id),className:"flex items-center gap-1 text-blue-600 hover:text-blue-800",children:[b.jsx(tZ,{className:"w-3 h-3"}),b.jsx("span",{children:G.helpful_count})]})]})]},G.id))})]});return b.jsxs("div",{className:`space-y-3 ${a}`,children:[V(),!u&&b.jsxs(cr,{variant:"outline",onClick:()=>f(!0),className:"w-full text-sm border-gray-300 hover:border-blue-500 hover:text-blue-600",size:"sm",children:[b.jsx(uS,{className:"w-4 h-4 mr-2"}),"Donner un avis"]}),H(),Z()]})},Mze=({service:e,serviceCreatorInfo:t,className:r="",compact:n=!1})=>{const[a,u]=j.useState(null),[f,i]=j.useState(!0),y=j.useCallback(D=>{if(!D)return"";if(typeof D=="object"&&D.valeur!==void 0){const O=D.valeur;return typeof O=="string"?O:typeof O=="number"?O.toString():String(O)}return typeof D=="string"?D:typeof D=="number"?D.toString():""},[]),w=j.useCallback(async D=>{try{console.log("🔍 [LocationDisplayModern] Conversion GPS:",D);const[O,N]=D.split(",").map(V=>parseFloat(V.trim()));if(isNaN(O)||isNaN(N))return console.warn("⚠️ [LocationDisplayModern] Coordonnées invalides:",D),"Position non valide";console.log("📍 [LocationDisplayModern] Coordonnées parsées:",{lat:O,lng:N});try{const V=await fetch("/api/geocoding/reverse",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({latitude:O,longitude:N})});if(console.log("🔗 [LocationDisplayModern] Statut API interne:",V.status),V.ok){const H=await V.json();if(console.log("📍 [LocationDisplayModern] Réponse API interne:",H),H.formatted_address&&H.formatted_address!=="Lieu inconnu")return console.log("✅ [LocationDisplayModern] Localisation depuis API interne:",H.formatted_address),H.formatted_address;if(H.address_components&&Array.isArray(H.address_components))return T(H,O,N)}else console.warn("⚠️ [LocationDisplayModern] API interne échouée (status:",V.status,")")}catch(V){console.warn("⚠️ [LocationDisplayModern] Erreur API interne:",V)}console.log("🌍 [LocationDisplayModern] Utilisation Google Maps API directe");try{const V=await fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${O},${N}&language=fr&key=YOUR_GOOGLE_MAPS_API_KEY`);if(V.ok){const H=await V.json();if(console.log("🗺️ [LocationDisplayModern] Réponse Google Maps:",H),H.results&&H.results.length>0)return T(H.results[0],O,N)}}catch(V){console.warn("⚠️ [LocationDisplayModern] Google Maps API échouée:",V)}return console.log("🔧 [LocationDisplayModern] Utilisation fallback intelligent"),A(O,N)}catch(O){console.error("❌ [LocationDisplayModern] Erreur géocodage:",O);const N=D.split(",");if(N.length===2){const V=parseFloat(N[0]),H=parseFloat(N[1]);return A(V,H)}return"Position mobile"}},[]),T=(D,O,N)=>{console.log("🔍 [LocationDisplayModern] Extraction depuis données Google:",D);let V=[];if(D.address_components&&Array.isArray(D.address_components)){const H=D.address_components.find(G=>G.types.includes("sublocality")||G.types.includes("sublocality_level_1")||G.types.includes("neighborhood")||G.types.includes("route")),Z=D.address_components.find(G=>G.types.includes("locality")||G.types.includes("administrative_area_level_2")),J=D.address_components.find(G=>G.types.includes("administrative_area_level_1"));console.log("🏘️ [LocationDisplayModern] Composants trouvés:",{quartier:H==null?void 0:H.long_name,ville:Z==null?void 0:Z.long_name,region:J==null?void 0:J.long_name}),H&&H.long_name&&V.push(H.long_name),Z&&Z.long_name&&Z.long_name!==(H==null?void 0:H.long_name)&&V.push(Z.long_name),J&&J.long_name&&J.long_name!==(Z==null?void 0:Z.long_name)&&V.push(J.long_name)}if(V.length===0&&D.formatted_address&&(console.log("📮 [LocationDisplayModern] Utilisation formatted_address:",D.formatted_address),V=D.formatted_address.split(",").slice(0,3).map(Z=>Z.trim()).filter(Z=>Z.length>0)),V.length>0){const H=V.join(", ");return console.log("✅ [LocationDisplayModern] Localisation construite:",H),H}return A(O,N)},A=(D,O)=>(console.log("🔧 [LocationDisplayModern] Génération fallback pour:",{lat:D,lng:O}),D>=3.5&&D<=13&&O>=8&&O<=16?D>=10&&O>=13?"Extrême-Nord, Cameroun":D>=8.5&&O>=13?"Nord, Cameroun":D>=6.5&&O>=11?"Adamaoua, Cameroun":D>=5.5&&O>=10?"Centre, Cameroun":D>=4&&O>=9.5?"Sud, Cameroun":D>=4.5&&O<=10?"Littoral, Cameroun":D>=5&&O<=11?"Ouest, Cameroun":D>=6&&O<=12?"Nord-Ouest, Cameroun":D>=5.5&&O<=12.5?"Sud-Ouest, Cameroun":D>=3.5&&O>=11?"Est, Cameroun":"Cameroun":D>=-5&&D<=5&&O>=-5&&O<=20?"Afrique Centrale":D>=30&&D<=50&&O>=-5&&O<=10?"Europe du Sud":D>=40&&D<=60&&O>=-10&&O<=30?"Europe":`Position ${D.toFixed(1)}°, ${O.toFixed(1)}°`);j.useEffect(()=>{(async()=>{var O,N;try{i(!0),console.log("🔍 [LocationDisplayModern] === DÉBUT DEBUG GPS ==="),console.log("📊 [LocationDisplayModern] Service ID:",e==null?void 0:e.id),console.log("📊 [LocationDisplayModern] Service data complet:",e==null?void 0:e.data),console.log("📊 [LocationDisplayModern] ServiceCreatorInfo:",t);const V=y((O=e==null?void 0:e.data)==null?void 0:O.gps_fixe);if(console.log("📍 [LocationDisplayModern] GPS fixe service brut:",(N=e==null?void 0:e.data)==null?void 0:N.gps_fixe),console.log("📍 [LocationDisplayModern] GPS fixe service traité:",V),V&&V.includes(",")){const H=V.split(",").map(Z=>parseFloat(Z.trim()));if(console.log("📊 [LocationDisplayModern] Coordonnées service parsées:",H),H.length===2&&!H.some(isNaN)){console.log("✅ [LocationDisplayModern] Utilisation GPS fixe service");const Z=await w(V);console.log("🏙️ [LocationDisplayModern] Lieu résolu:",Z),u({location:Z,country:"Cameroun",coordinates:{lat:H[0],lng:H[1]},source:"service",isRealTime:!1});return}}if(console.log("👤 [LocationDisplayModern] GPS créateur brut:",t==null?void 0:t.gps),t!=null&&t.gps&&t.gps.includes(",")){const H=t.gps.split(",").map(Z=>parseFloat(Z.trim()));if(console.log("📊 [LocationDisplayModern] Coordonnées créateur parsées:",H),H.length===2&&!H.some(isNaN)){console.log("✅ [LocationDisplayModern] Utilisation GPS créateur");const Z=await w(t.gps);console.log("🏙️ [LocationDisplayModern] Lieu créateur résolu:",Z),u({location:Z,country:"Cameroun",coordinates:{lat:H[0],lng:H[1]},source:"creator",isRealTime:!1});return}}console.log("🔍 [LocationDisplayModern] Récupération GPS depuis API...");try{const H=localStorage.getItem("token"),Z=await fetch(`/api/users/${e.user_id}`,{headers:H?{Authorization:`Bearer ${H}`}:{}});if(Z.ok){const J=await Z.json();if(console.log("👤 [LocationDisplayModern] Données utilisateur API:",J),J.gps&&J.gps.includes(",")){const G=J.gps.split(",").map(Y=>parseFloat(Y.trim()));if(console.log("📊 [LocationDisplayModern] Coordonnées API parsées:",G),G.length===2&&!G.some(isNaN)){console.log("✅ [LocationDisplayModern] Utilisation GPS API");const Y=await w(J.gps);console.log("🏙️ [LocationDisplayModern] Lieu API résolu:",Y),u({location:Y,country:"Cameroun",coordinates:{lat:G[0],lng:G[1]},source:"creator",isRealTime:!1});return}}}}catch(H){console.warn("⚠️ [LocationDisplayModern] Erreur API utilisateur:",H)}console.log("📱 [LocationDisplayModern] Récupération position temps réel...");try{const H=await new Promise((G,Y)=>{navigator.geolocation.getCurrentPosition(G,Y,{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})}),Z=`${H.coords.latitude},${H.coords.longitude}`;console.log("📍 [LocationDisplayModern] Position temps réel:",Z);const J=await w(Z);console.log("🏙️ [LocationDisplayModern] Lieu temps réel résolu:",J),u({location:J,country:"Cameroun",coordinates:{lat:H.coords.latitude,lng:H.coords.longitude},source:"user",isRealTime:!0});return}catch(H){console.warn("⚠️ [LocationDisplayModern] Géolocalisation échouée:",H)}console.log("🔧 [LocationDisplayModern] Fallback service mobile"),u({location:"Service mobile",country:"Cameroun",coordinates:null,source:"creator",isRealTime:!1})}catch(V){console.error("❌ [LocationDisplayModern] Erreur:",V),u({location:"Service disponible",country:"Cameroun",coordinates:null,source:"service",isRealTime:!1})}finally{i(!1),console.log("🔍 [LocationDisplayModern] === FIN DEBUG GPS ===")}})()},[e,t]);const k=()=>{if(a!=null&&a.coordinates){const{lat:D,lng:O}=a.coordinates,N=`https://www.google.com/maps?q=${D},${O}&z=16&hl=fr`;window.open(N,"_blank")}else if(a!=null&&a.location){const D=`https://www.google.com/maps/search/${encodeURIComponent(a.location)}?z=15&hl=fr`;window.open(D,"_blank")}},F=()=>{if(!a)return b.jsx(ou,{className:"w-4 h-4 text-blue-600"});switch(a.source){case"service":return b.jsx(hue,{className:"w-4 h-4 text-blue-600"});case"user":case"creator":return b.jsx(cde,{className:"w-4 h-4 text-green-600"});default:return b.jsx(ou,{className:"w-4 h-4 text-gray-600"})}};return f?b.jsx("div",{className:`text-center ${r}`,children:b.jsxs("div",{className:"animate-pulse p-2",children:[b.jsx(ou,{className:"w-4 h-4 mx-auto text-gray-400"}),b.jsx("span",{className:"text-xs text-gray-500",children:"Chargement..."})]})}):a?n?b.jsxs("div",{className:`text-center space-y-1 p-2 ${r}`,children:[b.jsxs("div",{className:"flex items-center justify-center gap-2",children:[F(),b.jsx("span",{className:"font-semibold text-sm text-gray-800",children:a.location}),a.isRealTime&&b.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"})]}),a.country&&b.jsx("div",{className:"text-xs text-gray-600 font-medium",children:a.country}),b.jsxs(cr,{variant:"outline",size:"sm",onClick:k,className:"bg-white hover:bg-blue-50 border-gray-200 hover:border-blue-300 text-gray-700 hover:text-blue-700 transition-all rounded-lg px-3 py-1 text-xs font-medium",children:[b.jsx(_O,{className:"w-3 h-3 mr-1"}),"Carte",b.jsx(vO,{className:"w-3 h-3 ml-1"})]})]}):b.jsx("div",{className:`bg-white rounded-xl p-4 border border-gray-100 shadow-sm ${r}`,children:b.jsxs("div",{className:"text-center space-y-3",children:[b.jsxs("div",{className:"flex items-center justify-center gap-2",children:[b.jsx(ou,{className:"w-5 h-5 text-blue-600"}),b.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Localisation"})]}),b.jsxs("div",{className:"flex items-center justify-center gap-3",children:[F(),b.jsx("span",{className:"font-bold text-xl text-gray-900",children:a.location}),a.isRealTime&&b.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"})]}),a.country&&b.jsxs("div",{className:"flex items-center justify-center gap-2",children:[b.jsx(lS,{className:"w-4 h-4 text-gray-500"}),b.jsx("span",{className:"bg-blue-50 text-blue-700 px-3 py-1 rounded-full text-sm font-medium",children:a.country})]}),b.jsxs(cr,{onClick:k,className:"bg-blue-500 hover:bg-blue-600 text-white font-medium px-4 py-2 rounded-lg transition-all",children:[b.jsx(_O,{className:"w-4 h-4 mr-2"}),"Ouvrir dans Google Maps",b.jsx(vO,{className:"w-4 h-4 ml-2"})]}),b.jsxs("div",{className:"text-xs bg-gray-100 text-gray-600 rounded-lg px-3 py-2 font-medium",children:[a.source==="service"&&"Position fixe du service",a.source==="user"&&"Votre position actuelle",a.source==="creator"&&(a.isRealTime?"Position temps réel du créateur":"Position du créateur")]})]})}):null},Ize=(e,t)=>{const[r,n]=j.useState(null),[a,u]=j.useState(!0),[f,i]=j.useState(null);return j.useEffect(()=>{const y=async()=>{try{u(!0);const T=localStorage.getItem("token"),A=await fetch(`/api/services/${e}/stats`,{headers:T?{Authorization:`Bearer ${T}`}:{}});if(A.ok){const k=await A.json();console.log(`📊 [ServiceStats] Statistiques réelles récupérées pour service ${e}:`,k);const F=new Date(t),O=Math.abs(new Date().getTime()-F.getTime()),N=Math.ceil(O/(1e3*60*60*24));n({views:k.views||0,shares:k.shares||0,likes:k.likes||0,contacts:k.contacts||0,messages:k.messages||0,rating:k.average_rating||0,totalRatings:k.total_ratings||0,createdDaysAgo:N})}else{console.log(`📊 [ServiceStats] API stats non disponible, génération basée sur l'activité pour service ${e}`);const k=await fetch(`/api/services/${e}/interactions`,{headers:T?{Authorization:`Bearer ${T}`}:{}});let F=0,D=0,O=0;if(k.ok){const J=await k.json();F=J.filter(G=>G.type==="view").length,D=J.filter(G=>G.type==="contact").length,O=J.filter(G=>G.type==="message").length}const N=new Date(t),H=Math.abs(new Date().getTime()-N.getTime()),Z=Math.ceil(H/(1e3*60*60*24));n({views:F,shares:Math.floor(F*.1),likes:Math.floor(F*.15),contacts:D,messages:O,rating:4.2+Math.random()*.8,totalRatings:Math.floor(D*.3),createdDaysAgo:Z})}}catch(T){console.error("❌ [ServiceStats] Erreur récupération statistiques:",T),i("Impossible de charger les statistiques");const A=new Date(t),F=Math.abs(new Date().getTime()-A.getTime()),D=Math.ceil(F/(1e3*60*60*24));n({views:Math.max(1,D),shares:0,likes:0,contacts:0,messages:0,rating:0,totalRatings:0,createdDaysAgo:D})}finally{u(!1)}};y();const w=setInterval(y,5*60*1e3);return()=>clearInterval(w)},[e,t]),{stats:r,loading:a,error:f}},kze=({service:e,className:t="",compact:r=!1})=>{const{stats:n,loading:a,error:u}=Ize(e.id,e.created_at);if(a)return b.jsx("div",{className:`animate-pulse ${t}`,children:b.jsx("div",{className:"flex items-center gap-3",children:[1,2,3,4].map(y=>b.jsxs("div",{className:"flex items-center gap-1",children:[b.jsx("div",{className:"w-3 h-3 bg-gray-200 rounded-full"}),b.jsx("div",{className:"w-6 h-3 bg-gray-200 rounded"})]},y))})});if(u||!n)return null;const i=(()=>{const y=n.views+n.shares*5+n.likes*3+n.contacts*10;return y>200?{label:"Populaire",color:"text-green-600"}:y>100?{label:"Actif",color:"text-blue-600"}:y>50?{label:"Apprécié",color:"text-purple-600"}:{label:"Nouveau",color:"text-gray-600"}})();return r?b.jsxs("div",{className:`flex items-center justify-between ${t}`,children:[b.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[b.jsxs("div",{className:"flex items-center gap-1 bg-blue-50 px-2 py-1 rounded-full",children:[b.jsx(jx,{className:"w-3 h-3 text-blue-600"}),b.jsx("span",{className:"font-medium text-blue-700",children:n.views})]}),b.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-2 py-1 rounded-full",children:[b.jsx(Kv,{className:"w-3 h-3 text-gray-600"}),b.jsx("span",{className:"font-medium text-gray-700",children:n.shares})]}),b.jsxs("div",{className:"flex items-center gap-1 bg-blue-50 px-2 py-1 rounded-full",children:[b.jsx(cS,{className:"w-3 h-3 text-blue-600"}),b.jsx("span",{className:"font-medium text-blue-700",children:n.likes})]}),b.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-2 py-1 rounded-full",children:[b.jsx(xO,{className:"w-3 h-3 text-gray-600"}),b.jsx("span",{className:"font-medium text-gray-700",children:n.contacts})]})]}),b.jsx("div",{className:`text-xs ${i.color} bg-white px-2 py-1 rounded-full shadow-sm border border-gray-200 font-medium`,children:i.label})]}):b.jsxs("div",{className:`bg-gray-50 rounded-xl p-4 border border-gray-200 ${t}`,children:[b.jsxs("div",{className:"flex items-center justify-between mb-3",children:[b.jsx("h4",{className:"text-sm font-semibold text-gray-800",children:"Statistiques"}),b.jsx("div",{className:`text-xs ${i.color} bg-white px-2 py-1 rounded-full border border-gray-200 font-medium`,children:i.label})]}),b.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[b.jsxs("div",{className:"text-center",children:[b.jsxs("div",{className:"flex items-center justify-center gap-1 text-blue-600 mb-1",children:[b.jsx(jx,{className:"w-4 h-4"}),b.jsx("span",{className:"text-lg font-bold",children:n.views})]}),b.jsx("p",{className:"text-xs text-gray-600",children:"Vues"})]}),b.jsxs("div",{className:"text-center",children:[b.jsxs("div",{className:"flex items-center justify-center gap-1 text-gray-600 mb-1",children:[b.jsx(Kv,{className:"w-4 h-4"}),b.jsx("span",{className:"text-lg font-bold",children:n.shares})]}),b.jsx("p",{className:"text-xs text-gray-600",children:"Partages"})]}),b.jsxs("div",{className:"text-center",children:[b.jsxs("div",{className:"flex items-center justify-center gap-1 text-blue-600 mb-1",children:[b.jsx(cS,{className:"w-4 h-4"}),b.jsx("span",{className:"text-lg font-bold",children:n.likes})]}),b.jsx("p",{className:"text-xs text-gray-600",children:"J'aime"})]}),b.jsxs("div",{className:"text-center",children:[b.jsxs("div",{className:"flex items-center justify-center gap-1 text-gray-600 mb-1",children:[b.jsx(xO,{className:"w-4 h-4"}),b.jsx("span",{className:"text-lg font-bold",children:n.contacts})]}),b.jsx("p",{className:"text-xs text-gray-600",children:"Contacts"})]})]}),b.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 text-center",children:b.jsxs("div",{className:"flex items-center justify-center gap-1 text-xs text-gray-500",children:[b.jsx(Ace,{className:"w-3 h-3"}),b.jsxs("span",{children:["Créé il y a ",n.createdDaysAgo===0?"aujourd'hui":n.createdDaysAgo===1?"hier":`${n.createdDaysAgo} jours`]})]})})]})},Oze=e=>{const[t,r]=j.useState({images:[],videos:[],audios:[],documents:[],excel:[],loading:!0,error:null,totalCount:0});return j.useEffect(()=>{e&&(async()=>{try{r(y=>({...y,loading:!0,error:null})),console.log("🖼️ [useServiceMedia] === DÉBUT RÉCUPÉRATION MÉDIAS ==="),console.log(`📊 [useServiceMedia] Service ID: ${e}`);const a=localStorage.getItem("token"),u=await fetch(`/api/services/${e}/media`,{headers:a?{Authorization:`Bearer ${a}`}:{}});if(console.log(`🔗 [useServiceMedia] Statut API: ${u.status}`),!u.ok)throw new Error(`Erreur HTTP ${u.status}: ${u.statusText}`);const f=await u.json();console.log(`📊 [useServiceMedia] ${f.length} médias récupérés depuis DB:`,f);const i=f.reduce((y,w)=>{const T=`/api/media/${w.path}`;switch(console.log(`🔗 [useServiceMedia] URL construite pour ${w.type}: ${T}`),w.type){case"image":y.images.push(T);break;case"video":y.videos.push(T);break;case"audio":y.audios.push(T);break;case"document":y.documents.push(T);break;case"excel":y.excel.push(T);break;default:console.warn(`⚠️ [useServiceMedia] Type de média non reconnu: ${w.type}`)}return y},{images:[],videos:[],audios:[],documents:[],excel:[]});r({...i,loading:!1,error:null,totalCount:f.length}),console.log("✅ [useServiceMedia] Médias groupés et URLs créées:",{images:i.images.length,videos:i.videos.length,audios:i.audios.length,documents:i.documents.length,excel:i.excel.length,total:f.length}),console.log("🖼️ [useServiceMedia] === FIN RÉCUPÉRATION MÉDIAS ===")}catch(a){console.error("❌ [useServiceMedia] Erreur récupération médias:",a),r(u=>({...u,loading:!1,error:a instanceof Error?a.message:"Erreur inconnue",totalCount:0}))}})()},[e]),t},ap=e=>{if(!e)return"Non spécifié";if(typeof e=="string")return e;if(e&&typeof e=="object"){if(e.valeur!==void 0){const t=e.valeur;return typeof t=="string"?t:typeof t=="boolean"?t?"Oui":"Non":typeof t=="number"?t.toString():Array.isArray(t)?t.join(", "):String(t)}if(Object.keys(e).length>0){const t=["value","content","text","data","info"];for(const r of t)if(e[r]!==void 0){const n=e[r];if(typeof n=="string")return n;if(typeof n=="boolean")return n?"Oui":"Non";if(typeof n=="number")return n.toString()}}}return typeof e=="boolean"?e?"Oui":"Non":typeof e=="number"?e.toString():"Non spécifié"},Q7=e=>{if(!e)return!1;if(typeof e=="string")return e.trim()!==""&&e!=="Non spécifié";if(e.valeur!==void 0){const t=e.valeur;if(typeof t=="string")return t.trim()!==""&&t!=="Non spécifié";if(Array.isArray(t))return t.length>0}return!1},zw=e=>{if(!e)return[];if(Array.isArray(e))return e;if(e.valeur!==void 0){if(Array.isArray(e.valeur))return e.valeur;if(typeof e.valeur=="string")return[e.valeur]}return[]},Lze=e=>{if(!e)return"Date non disponible";try{const t=new Date(e),r=t.getDate(),n=t.getMonth(),a=t.getFullYear();return`${r} ${["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"][n]} ${a}`}catch{return"Date invalide"}},Rze=(e,t,r,n)=>{const[a,u]=j.useState(!1),[f,i]=j.useState(null);return j.useEffect(()=>{if(t&&r){const y=r.status==="online"||r.isActive;u(y),!y&&r.lastSeen&&i(new Date(r.lastSeen))}else{const y=new Date,w=new Date(n||y),T=(y.getTime()-w.getTime())/(1e3*60*60);u(T<24)}},[e,t,r,n]),{isOnline:a,lastSeen:f}},jze=({service:e,prestataires:t,user:r,wsConnected:n,userStatus:a,onContact:u,onChat:f,onGallery:i})=>{var H,Z,J,G,Y,ie,ce,ge,be;const y=t.get(e.user_id),{isOnline:w,lastSeen:T}=Rze(e.user_id,n,a,e.created_at),{toast:A}=Oy(),k=Oze(e.id),F=()=>{A({title:"Ajouté aux favoris !",description:"Ce service a été ajouté à votre liste de favoris",type:"success"})},D=()=>{var xe,Le;if(navigator.share)navigator.share({title:ap((xe=e.data)==null?void 0:xe.titre_service),text:ap((Le=e.data)==null?void 0:Le.description),url:`${window.location.origin}/service/${e.id}`}).catch(console.error);else{const ze=`${window.location.origin}/service/${e.id}`;navigator.clipboard.writeText(ze).then(()=>{A({title:"Lien copié !",description:"Le lien du service a été copié dans le presse-papier",type:"success"})})}},O=()=>{console.log("🖼️ [ServiceCard] Ouverture galerie pour service:",e.id),console.log("📊 [ServiceCard] Médias disponibles:",k),i(e)},V=(()=>{var Le,ze,Xe,Je;if(console.log("📊 [ServiceCard] État médias:",{loading:k.loading,error:k.error,totalCount:k.totalCount,images:k.images.length,videos:k.videos.length}),k.loading)return{images:[],videos:[],hasMedia:!1};if(k.error)return console.warn("⚠️ [ServiceCard] Erreur médias, utilisation fallback:",k.error),{images:zw((Le=e.data)==null?void 0:Le.images_realisations),videos:zw((ze=e.data)==null?void 0:ze.videos),hasMedia:zw((Xe=e.data)==null?void 0:Xe.images_realisations).length>0||zw((Je=e.data)==null?void 0:Je.videos).length>0};const xe=k.images.length>0||k.videos.length>0;return console.log("✅ [ServiceCard] Utilisation médias DB:",{images:k.images,videos:k.videos,hasMedia:xe}),{images:k.images,videos:k.videos,hasMedia:xe}})();return b.jsxs(nu,{className:"relative overflow-hidden transition-all duration-300 hover:shadow-xl border-2 border-blue-200 hover:border-blue-400 bg-white group transform hover:scale-[1.01] font-['SF_Pro_Display',_'Segoe_UI',_'system-ui',_sans-serif]",children:[b.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-50/40 to-indigo-50/60"}),Q7((H=e.data)==null?void 0:H.banniere)&&b.jsx("div",{className:"absolute inset-0 bg-cover bg-center opacity-8 transition-opacity duration-300 group-hover:opacity-12",style:{backgroundImage:`url(${ap((Z=e.data)==null?void 0:Z.banniere)})`,backgroundSize:"cover",backgroundPosition:"center"}}),b.jsxs("div",{className:"relative z-10",children:[Q7((J=e.data)==null?void 0:J.logo)&&b.jsx("div",{className:"absolute top-3 right-3 z-20",children:b.jsx("div",{className:"w-12 h-12 rounded-xl bg-white shadow-md border border-gray-100 p-1",children:b.jsxs(e_,{className:"w-full h-full rounded-lg",children:[b.jsx(Ux,{src:ap((G=e.data)==null?void 0:G.logo),alt:"Logo",className:"object-cover rounded-lg"}),b.jsx(t_,{className:"bg-blue-50 text-blue-600 font-bold text-xs rounded-lg",children:ap((Y=e.data)==null?void 0:Y.titre_service).substring(0,2).toUpperCase()})]})})}),b.jsxs(Dj,{className:"pb-2 pt-4 px-4",children:[b.jsxs("div",{className:"flex items-center justify-between mb-3",children:[b.jsx(kze,{service:e,compact:!0}),b.jsx(cr,{variant:"ghost",size:"sm",onClick:D,className:"text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg w-8 h-8 p-0 transition-all",title:"Partager",children:b.jsx(Kv,{className:"w-4 h-4"})})]}),b.jsx(Nj,{className:"text-lg font-bold text-gray-900 leading-snug mb-2",children:ap((ie=e.data)==null?void 0:ie.titre_service)}),b.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[b.jsx(Ax,{className:"bg-blue-500 text-white text-xs font-medium px-3 py-1",children:ap((ce=e.data)==null?void 0:ce.category)}),b.jsx("span",{className:"text-xs text-gray-500 font-medium ml-auto",children:Lze(e.created_at)})]}),b.jsx("div",{className:"bg-gray-50 rounded-lg p-3 mb-2 border border-gray-100",children:b.jsx("p",{className:"text-gray-700 text-sm leading-relaxed text-center",children:ap((ge=e.data)==null?void 0:ge.description)})}),b.jsxs("div",{className:"text-center mb-2 bg-blue-50 rounded-lg p-2 border border-blue-100",children:[b.jsx("h4",{className:"font-semibold text-base text-gray-900 mb-1",children:(y==null?void 0:y.nom_complet)||ap((be=e.data)==null?void 0:be.nom_prestataire)||`Créateur #${e.user_id}`}),b.jsx("div",{className:"flex items-center justify-center gap-1",children:n&&a?w?b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),b.jsx("span",{className:"text-green-600 text-xs font-medium",children:"En ligne"})]}):b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full"}),b.jsx("span",{className:"text-gray-500 text-xs",children:T?`Il y a ${Math.floor((Date.now()-T.getTime())/(1e3*60))}min`:"Hors ligne"})]}):b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse"}),b.jsx("span",{className:"text-gray-400 text-xs",children:"Vérification..."})]})})]}),b.jsx("div",{className:"mb-2",children:t.has(e.user_id)?b.jsx(Mze,{service:e,serviceCreatorInfo:t.get(e.user_id),compact:!0,className:"bg-green-50 rounded-lg border border-green-100"}):b.jsx("div",{className:"text-center bg-yellow-50 rounded-lg p-2 border border-yellow-100",children:b.jsx("span",{className:"text-yellow-600 text-xs font-medium",children:"Localisation en cours..."})})})]}),b.jsxs(iu,{className:"pt-0 pb-4 px-4",children:[V.hasMedia&&b.jsx("div",{className:"mb-3",children:b.jsx(gee,{logo:void 0,banniere:void 0,images_realisations:V.images,videos:V.videos,className:"bg-gray-50 rounded-lg p-3 border border-gray-100"})}),b.jsx("div",{className:"mb-3",children:b.jsx(cr,{onClick:()=>f(e),className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg transition-all duration-300 transform hover:scale-[1.02] shadow-lg hover:shadow-xl",children:b.jsxs("div",{className:"flex items-center justify-center gap-2",children:[b.jsx(xy,{className:"w-5 h-5"}),b.jsx("span",{className:"text-base",children:"Démarrer une conversation"}),w&&b.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"})]})})}),b.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[b.jsxs(cr,{variant:"outline",onClick:O,className:"bg-white hover:bg-gray-50 border-gray-200 hover:border-gray-300 text-gray-700 hover:text-gray-900 py-2 rounded-lg transition-all duration-300 text-sm font-medium",children:[b.jsx(jx,{className:"w-4 h-4 mr-2"}),"Galerie"]}),b.jsxs(cr,{variant:"outline",onClick:F,className:"bg-white hover:bg-red-50 border-gray-200 hover:border-red-200 text-gray-700 hover:text-red-600 py-2 rounded-lg transition-all duration-300 text-sm font-medium",children:[b.jsx(cS,{className:"w-4 h-4 mr-2"}),"Favoris"]})]}),b.jsx("div",{className:"border-t border-gray-200 pt-3",children:b.jsx(Pze,{service:e,onRatingSubmit:()=>{},onReviewHelpful:()=>{},className:"bg-gray-50 rounded-lg p-3 border border-gray-100"})})]})]})]})},Fw=e=>{if(!e)return"Non spécifié";if(typeof e=="string")return e;if(e&&typeof e=="object"){if(e.valeur!==void 0){const t=e.valeur;return typeof t=="string"?t:typeof t=="boolean"?t?"Oui":"Non":typeof t=="number"?t.toString():Array.isArray(t)?t.join(", "):String(t)}if(Object.keys(e).length>0){const t=["value","content","text","data","info"];for(const r of t)if(e[r]!==void 0){const n=e[r];if(typeof n=="string")return n;if(typeof n=="boolean")return n?"Oui":"Non";if(typeof n=="number")return n.toString()}}}return typeof e=="boolean"?e?"Oui":"Non":typeof e=="number"?e.toString():"Non spécifié"},Dze=({service:e,prestataires:t,user:r,wsConnected:n,onClose:a})=>{var ur,Jt;const[u,f]=j.useState([]),[i,y]=j.useState(!1),[w,T]=j.useState(""),[A,k]=j.useState(null),[F,D]=j.useState(""),[O,N]=j.useState(!1),[V,H]=j.useState(null),[Z,J]=j.useState(null),[G,Y]=j.useState(!1),[ie,ce]=j.useState(!1),{toast:ge}=Oy(),be=j.useRef(null),xe=t.get(e.user_id),Le=(xe==null?void 0:xe.nom_complet)||`Prestataire #${e.user_id}`,ze=Fw((ur=e.data)==null?void 0:ur.titre_service),Xe=Fw((Jt=e.data)==null?void 0:Jt.category),Je=["😊","😂","❤️","👍","👎","😍","🤔","😢","😮","🔥","💯","🎉","👏","🙏","💪"],tt=()=>{var sr,mr;const Rt=Fw((sr=e.data)==null?void 0:sr.telephone);if(Rt&&Rt!=="Non spécifié")return Rt;const Dt=Fw((mr=e.data)==null?void 0:mr.whatsapp);return Dt&&Dt!=="Non spécifié"?Dt:xe!=null&&xe.telephone?xe.telephone:null};j.useEffect(()=>{const Rt={id:Date.now().toString(),from:"prestataire",content:`Bonjour 👋, je suis ${Le} pour le service "${ze||"Service"}"${Xe?` (${Xe})`:""}. Que puis-je faire pour vous ?`,timestamp:new Date,status:"read",type:"text",editable:!1};f([Rt])},[e,t]),j.useEffect(()=>{var Rt;(Rt=be.current)==null||Rt.scrollIntoView({behavior:"smooth"})},[u]);const st=()=>{if(!w.trim())return;const Rt={id:Date.now().toString(),from:"client",content:w,timestamp:new Date,status:"sent",type:"text",editable:!0};f(Dt=>[...Dt,Rt]),T("")},Ne=async()=>{try{console.log("🎤 [ChatModal] Démarrage enregistrement audio...");const Rt=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,sampleRate:44100}}),Dt=new MediaRecorder(Rt,{mimeType:"audio/webm;codecs=opus"}),sr=[];Dt.ondataavailable=mr=>{console.log("📊 [ChatModal] Chunk audio reçu:",mr.data.size,"bytes"),mr.data.size>0&&sr.push(mr.data)},Dt.onstop=()=>{if(console.log("⏹️ [ChatModal] Enregistrement arrêté, chunks:",sr.length),Rt.getTracks().forEach(mr=>mr.stop()),sr.length>0){const mr=new Blob(sr,{type:"audio/webm;codecs=opus"}),Vr=URL.createObjectURL(mr);H(Vr),console.log("✅ [ChatModal] Audio blob créé:",mr.size,"bytes"),ge({title:"✅ Audio enregistré",description:"Cliquez 'Envoyer' pour envoyer votre message vocal",type:"success"})}},J(Dt),N(!0),Dt.start(1e3),ge({title:"🎤 Enregistrement en cours",description:"Parlez maintenant, cliquez 'Arrêter' quand vous avez fini",type:"success"})}catch(Rt){console.error("❌ [ChatModal] Erreur enregistrement audio:",Rt),ge({title:"❌ Erreur microphone",description:"Veuillez autoriser l'accès au microphone",type:"error"})}},We=()=>{console.log("⏹️ [ChatModal] Arrêt enregistrement..."),Z&&O&&(Z.stop(),N(!1))},Ue=()=>{if(console.log("📤 [ChatModal] Envoi message audio..."),V){const Rt={id:Date.now().toString(),from:"client",content:"🎤 Message vocal",timestamp:new Date,status:"sent",type:"audio",audioUrl:V,editable:!0};f(Dt=>[...Dt,Rt]),H(null),ge({title:"🎵 Message vocal envoyé",description:"Votre message vocal a été envoyé avec succès",type:"success"})}},De=()=>{console.log("❌ [ChatModal] Annulation audio..."),H(null),N(!1),Z&&Z.stop()},Ke=(Rt,Dt)=>{f(sr=>sr.map(mr=>mr.id===Rt?{...mr,content:Dt,edited:!0,editedAt:new Date}:mr)),k(null),D(""),ge({title:"✅ Message modifié",description:"Votre message a été mis à jour",type:"success"})},lt=Rt=>{f(Dt=>Dt.filter(sr=>sr.id!==Rt)),ge({title:"🗑️ Message supprimé",description:"Le message a été supprimé de la conversation",type:"success"})},Ye=Rt=>{k(Rt.id),D(Rt.content)},Ve=()=>{k(null),D("")},Et=()=>{const Rt=tt();if(Rt){const Dt=Rt.replace(/[^\d+]/g,"");console.log(`📞 [ChatModal] Appel vers le numéro: ${Dt}`),window.open(`tel:${Dt}`,"_self"),ge({title:"📞 Appel en cours",description:`Appel vers ${Le} (${Rt})`,type:"success"})}else ge({title:"❌ Numéro non disponible",description:"Aucun numéro de téléphone n'est renseigné pour ce prestataire",type:"error"})},kt=()=>{navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(()=>{const Rt=`/video-call?service=${e.id}&prestataire=${e.user_id}&client=${r==null?void 0:r.id}`,Dt=window.open(Rt,"video-call","width=1200,height=800,scrollbars=no,resizable=yes,location=no,menubar=no,toolbar=no");ge(Dt?{title:"🎥 Appel vidéo démarré",description:`Connexion vidéo avec ${Le}`,type:"success"}:{title:"❌ Erreur",description:"Impossible d'ouvrir la fenêtre d'appel vidéo. Vérifiez les popups.",type:"error"})}).catch(Rt=>{console.error("Erreur permissions média:",Rt),ge({title:"❌ Permissions requises",description:"Veuillez autoriser l'accès à la caméra et au microphone pour les appels vidéo",type:"error"})}):ge({title:"❌ Non supporté",description:"Votre navigateur ne supporte pas les appels vidéo",type:"error"})},Wt=Rt=>{T(Dt=>Dt+Rt),ce(!1)},Tt=()=>{Y(!0)},Ht=Rt=>{try{const Dt=typeof Rt=="string"?new Date(Rt):Rt;return isNaN(Dt.getTime())?"--:--":Dt.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})}catch{return"--:--"}};return b.jsxs("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:[b.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-4xl h-[80vh] flex flex-col shadow-2xl border border-gray-200 overflow-hidden",children:[b.jsxs("div",{className:"flex justify-between items-center p-6 border-b bg-gray-50",children:[b.jsxs("div",{className:"flex items-center gap-4",children:[b.jsxs(e_,{className:"w-12 h-12 ring-2 ring-blue-200",children:[b.jsx(Ux,{src:(xe==null?void 0:xe.avatar)||(xe==null?void 0:xe.photo_profil),alt:"Avatar prestataire"}),b.jsx(t_,{className:"bg-blue-500 text-white font-semibold",children:Le.substring(0,2).toUpperCase()})]}),b.jsxs("div",{className:"flex-1",children:[b.jsx("h3",{className:"text-xl font-bold text-gray-900",children:Le}),b.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[n?b.jsxs("div",{className:"flex items-center gap-1",children:[b.jsx(gde,{className:"w-4 h-4 text-green-500"}),b.jsx("span",{className:"text-green-600 font-medium",children:"En ligne"}),b.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"})]}):b.jsxs("div",{className:"flex items-center gap-1",children:[b.jsx(pde,{className:"w-4 h-4 text-gray-400"}),b.jsx("span",{className:"text-gray-500",children:"Hors ligne"})]}),b.jsx("span",{className:"text-gray-300",children:"•"}),b.jsx("span",{className:"text-gray-600",children:ze||"Service"}),Xe&&b.jsxs(b.Fragment,{children:[b.jsx("span",{className:"text-gray-300",children:"•"}),b.jsx("span",{className:"text-blue-600 font-medium",children:Xe})]})]})]})]}),b.jsxs("div",{className:"flex items-center gap-3",children:[b.jsx(cr,{variant:"ghost",size:"sm",onClick:Tt,className:"text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-xl",title:"Voir la galerie",children:b.jsx(mue,{className:"w-5 h-5"})}),b.jsx(cr,{variant:"ghost",size:"sm",onClick:Et,disabled:!tt(),className:`rounded-xl ${tt()?"text-green-600 hover:text-green-700 hover:bg-green-50":"text-gray-400 cursor-not-allowed"}`,title:tt()?`Appeler ${tt()}`:"Numéro non disponible",children:b.jsx(jb,{className:"w-5 h-5"})}),b.jsx(cr,{variant:"ghost",size:"sm",onClick:kt,className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded-xl",title:"Appel vidéo",children:b.jsx(qm,{className:"w-5 h-5"})}),b.jsx(cr,{variant:"ghost",size:"sm",onClick:a,className:"text-gray-600 hover:text-gray-700 hover:bg-gray-50 rounded-xl",title:"Fermer",children:b.jsx(Os,{className:"w-5 h-5"})})]})]}),b.jsx("div",{className:"flex-1 overflow-y-auto p-4 bg-gray-50",children:b.jsxs("div",{className:"space-y-4",children:[u.map(Rt=>b.jsx("div",{className:`flex ${Rt.from==="client"?"justify-end":"justify-start"}`,children:b.jsx("div",{className:`max-w-[70%] p-4 rounded-2xl shadow-sm group relative ${Rt.from==="client"?"bg-white border-2 border-blue-200 text-gray-900":"bg-gray-100 border border-gray-200 text-gray-900"}`,children:A===Rt.id?b.jsxs("div",{className:"space-y-3",children:[b.jsx("textarea",{value:F,onChange:Dt=>D(Dt.target.value),className:"w-full p-3 text-sm border border-gray-300 rounded-lg resize-none text-gray-900 bg-white focus:ring-2 focus:ring-blue-500",rows:3,autoFocus:!0}),b.jsxs("div",{className:"flex gap-2 justify-end",children:[b.jsx(cr,{size:"sm",onClick:()=>Ke(Rt.id,F),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 text-sm font-medium",children:"✅ Sauver"}),b.jsx(cr,{variant:"outline",size:"sm",onClick:Ve,className:"px-4 py-2 text-sm",children:"❌ Annuler"})]})]}):b.jsxs(b.Fragment,{children:[Rt.type==="audio"?b.jsxs("div",{className:"space-y-3",children:[b.jsxs("div",{className:"flex items-center gap-3",children:[b.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-400 to-blue-500 rounded-full flex items-center justify-center",children:b.jsx(Rm,{className:"w-5 h-5 text-white"})}),b.jsxs("div",{children:[b.jsx("div",{className:"text-sm font-bold text-gray-800",children:"🎤 Message vocal"}),b.jsx("div",{className:"text-xs text-gray-500",children:"Cliquez pour écouter"})]})]}),b.jsxs("audio",{controls:!0,className:"w-full rounded-lg",children:[b.jsx("source",{src:Rt.audioUrl,type:"audio/webm"}),b.jsx("source",{src:Rt.audioUrl,type:"audio/wav"}),"Votre navigateur ne supporte pas l'audio."]})]}):b.jsx("p",{className:"text-sm leading-relaxed font-medium",children:Rt.content}),b.jsxs("div",{className:"flex items-center justify-between mt-3 pt-2 border-t border-gray-100",children:[b.jsxs("div",{className:"text-xs text-gray-500 font-medium",children:[Ht(Rt.timestamp),Rt.edited&&b.jsx("span",{className:"ml-2 text-blue-600",children:"(modifié)"})]}),Rt.from==="client"&&Rt.editable&&Rt.type!=="audio"&&b.jsxs("div",{className:"flex gap-2",children:[b.jsx(cr,{variant:"ghost",size:"sm",onClick:()=>Ye(Rt),className:"p-2 h-8 w-8 rounded-lg bg-blue-50 hover:bg-blue-100 text-blue-600 hover:text-blue-700 shadow-sm border border-blue-200",title:"Modifier ce message",children:"✏️"}),b.jsx(cr,{variant:"ghost",size:"sm",onClick:()=>lt(Rt.id),className:"p-2 h-8 w-8 rounded-lg bg-red-50 hover:bg-red-100 text-red-600 hover:text-red-700 shadow-sm border border-red-200",title:"Supprimer ce message",children:"🗑️"})]}),Rt.from==="client"&&Rt.editable&&Rt.type==="audio"&&b.jsx("div",{className:"flex justify-end",children:b.jsx(cr,{variant:"ghost",size:"sm",onClick:()=>lt(Rt.id),className:"p-2 h-8 w-8 rounded-lg bg-red-50 hover:bg-red-100 text-red-600 hover:text-red-700 shadow-sm border border-red-200",title:"Supprimer ce message vocal",children:"🗑️"})})]})]})})},Rt.id)),i&&b.jsx("div",{className:"flex justify-start",children:b.jsx("div",{className:"bg-white border border-gray-200 rounded-2xl p-3 shadow-sm",children:b.jsxs("div",{className:"flex items-center gap-1",children:[b.jsxs("div",{className:"flex gap-1",children:[b.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),b.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),b.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),b.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"En train d'écrire..."})]})})}),b.jsx("div",{ref:be})]})}),b.jsxs("div",{className:"p-4 border-t bg-white",children:[O&&b.jsxs("div",{className:"mb-4 bg-red-50 border-2 border-red-200 rounded-xl p-4",children:[b.jsxs("div",{className:"flex items-center justify-between mb-3",children:[b.jsxs("div",{className:"flex items-center gap-3",children:[b.jsx("div",{className:"w-12 h-12 bg-red-500 rounded-full flex items-center justify-center animate-pulse",children:b.jsx(Rm,{className:"w-6 h-6 text-white"})}),b.jsxs("div",{children:[b.jsx("div",{className:"text-red-700 font-bold text-lg",children:"🔴 Enregistrement en cours"}),b.jsx("div",{className:"text-red-600 text-sm",children:"Parlez clairement dans votre microphone"})]})]}),b.jsx(cr,{onClick:We,className:"bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-xl font-bold text-sm shadow-lg",children:"⏹️ Arrêter"})]}),b.jsx("div",{className:"bg-red-100 rounded-lg p-3",children:b.jsxs("div",{className:"flex items-center gap-3",children:[b.jsx("span",{className:"text-red-700 font-bold",children:"🎤 REC"}),b.jsx("div",{className:"flex-1 bg-red-200 rounded-full h-3 overflow-hidden",children:b.jsx("div",{className:"w-full h-full bg-red-500 animate-pulse"})}),b.jsx("span",{className:"text-red-700 text-sm font-medium",children:"En cours d'enregistrement..."})]})})]}),V&&!O&&b.jsxs("div",{className:"mb-4 bg-green-50 border-2 border-green-200 rounded-xl p-4",children:[b.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[b.jsx("div",{className:"w-12 h-12 bg-green-500 rounded-full flex items-center justify-center",children:b.jsx(Rm,{className:"w-6 h-6 text-white"})}),b.jsxs("div",{children:[b.jsx("div",{className:"text-green-700 font-bold text-lg",children:"✅ Audio prêt à envoyer"}),b.jsx("div",{className:"text-green-600 text-sm",children:"Écoutez votre message puis envoyez-le"})]})]}),b.jsx("div",{className:"bg-green-100 rounded-lg p-3 mb-3",children:b.jsxs("audio",{controls:!0,className:"w-full",children:[b.jsx("source",{src:V,type:"audio/webm"}),b.jsx("source",{src:V,type:"audio/wav"}),"Votre navigateur ne supporte pas l'audio."]})}),b.jsxs("div",{className:"flex gap-3 justify-center",children:[b.jsx(cr,{onClick:Ue,className:"bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-xl font-bold text-sm shadow-lg",children:"📤 Envoyer l'audio"}),b.jsx(cr,{variant:"outline",onClick:De,className:"px-6 py-3 rounded-xl font-medium text-sm border-2",children:"🗑️ Annuler"})]})]}),ie&&b.jsx("div",{className:"mb-3 bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:b.jsx("div",{className:"grid grid-cols-8 gap-2",children:Je.map(Rt=>b.jsx("button",{onClick:()=>Wt(Rt),className:"text-2xl hover:bg-yellow-100 rounded-lg p-2 transition-colors transform hover:scale-110",children:Rt},Rt))})}),b.jsxs("div",{className:"flex items-end gap-3",children:[b.jsxs("div",{className:"flex gap-2",children:[b.jsx(cr,{variant:"ghost",size:"sm",className:"text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-xl p-2",title:"Joindre une image",children:b.jsx(Fv,{className:"w-5 h-5"})}),b.jsx(cr,{variant:"ghost",size:"sm",onClick:Ne,disabled:O||V!==null,className:`rounded-xl p-2 transition-all duration-300 ${O||V?"text-gray-400 cursor-not-allowed":"text-green-600 hover:text-green-700 hover:bg-green-50"}`,title:"Enregistrer un message vocal",children:b.jsx(Rm,{className:"w-5 h-5"})}),b.jsx(cr,{variant:"ghost",size:"sm",className:"text-gray-500 hover:text-purple-600 hover:bg-purple-50 rounded-xl p-2",title:"Joindre un fichier",children:b.jsx(YW,{className:"w-5 h-5"})})]}),b.jsxs("div",{className:"flex-1 relative",children:[b.jsx("textarea",{value:w,onChange:Rt=>T(Rt.target.value),onKeyPress:Rt=>{Rt.key==="Enter"&&!Rt.shiftKey&&(Rt.preventDefault(),st())},placeholder:O?"🎤 Enregistrement en cours...":"Tapez votre message...",className:`w-full p-3 pr-12 border-2 rounded-xl focus:ring-2 resize-none max-h-24 text-sm transition-all font-medium ${O?"border-red-300 bg-red-50 focus:ring-red-500 focus:border-red-500 cursor-not-allowed":"border-gray-300 focus:ring-blue-500 focus:border-blue-500"}`,rows:1,style:{minHeight:"48px"},disabled:O}),b.jsx(cr,{variant:"ghost",size:"sm",onClick:()=>ce(!ie),className:"absolute right-2 bottom-2 text-gray-500 hover:text-yellow-600 hover:bg-yellow-50 rounded-lg p-1",title:"Émojis",disabled:O,children:b.jsx(eZ,{className:"w-5 h-5"})})]}),b.jsx(cr,{onClick:st,disabled:!w.trim()||O,className:"bg-blue-600 hover:bg-blue-700 text-white rounded-xl px-6 py-3 transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none shadow-lg font-bold",children:"📤"})]}),b.jsxs("div",{className:"flex items-center justify-between mt-3 text-xs text-gray-500",children:[b.jsx("div",{className:"flex items-center gap-2",children:n?b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),b.jsx("span",{children:"Connexion sécurisée"})]}):b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),b.jsx("span",{children:"Mode hors ligne"})]})}),b.jsxs("div",{className:"flex items-center gap-4",children:[tt()&&b.jsxs("span",{className:"text-green-600 font-medium",children:["📞 ",tt()]}),b.jsx("span",{className:"font-medium",children:"Entrée pour envoyer • Shift+Entrée pour nouvelle ligne"})]})]})]})]}),G&&b.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-60 p-4",children:b.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-6xl h-[90vh] flex flex-col",children:[b.jsxs("div",{className:"flex justify-between items-center p-4 border-b",children:[b.jsxs("h3",{className:"text-xl font-bold",children:["🖼️ Galerie - ",ze]}),b.jsx(cr,{variant:"ghost",onClick:()=>Y(!1),className:"text-gray-600 hover:text-gray-800",children:b.jsx(Os,{className:"w-5 h-5"})})]}),b.jsx("div",{className:"flex-1 p-4 overflow-y-auto",children:b.jsx("div",{className:"text-center text-gray-500",children:"Galerie du service - À implémenter avec ServiceMediaGallery"})})]})})]})},rx=e=>{if(!e)return"Non spécifié";if(typeof e=="string")return e;if(e&&typeof e=="object"&&e.valeur!==void 0){const t=e.valeur;return typeof t=="string"?t:typeof t=="boolean"?t?"Oui":"Non":typeof t=="number"?t.toString():Array.isArray(t)?t.join(", "):String(t)}return typeof e=="boolean"?e?"Oui":"Non":typeof e=="number"?e.toString():"Non spécifié"},yee=({service:e,prestataires:t,user:r,onClose:n})=>{var i,y,w;const a=()=>{var A;const T=rx((A=e.data)==null?void 0:A.telephone);T&&T!=="Non spécifié"&&window.open(`tel:${T}`,"_self")},u=()=>{var A;const T=rx((A=e.data)==null?void 0:A.email);T&&T!=="Non spécifié"&&window.open(`mailto:${T}?subject=Demande de service`,"_self")},f=()=>{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){console.error("Caméra non disponible");return}navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(T=>{window.open(`/video-call?service=${e.id}&user=${r==null?void 0:r.id}`,"video-call","width=800,height=600,scrollbars=no,resizable=yes")&&console.log("Appel vidéo démarré")}).catch(T=>{console.error("Erreur accès caméra:",T)})};return b.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:b.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full",children:[b.jsxs("div",{className:"flex justify-between items-center mb-4",children:[b.jsx("h3",{className:"text-lg font-semibold",children:"Contacter le prestataire"}),b.jsx(cr,{variant:"ghost",size:"sm",onClick:n,className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),b.jsxs("div",{className:"mb-4",children:[b.jsxs("p",{className:"text-gray-600 mb-2",children:[b.jsx("strong",{children:"Service :"})," ",rx((i=e.data)==null?void 0:i.titre_service)]}),b.jsxs("p",{className:"text-gray-600 mb-2",children:[b.jsx("strong",{children:"Prestataire :"})," ",rx((y=e.data)==null?void 0:y.nom_prestataire)||`#${e.user_id}`]}),b.jsxs("p",{className:"text-gray-600",children:[b.jsx("strong",{children:"Localisation :"})," ",rx((w=e.data)==null?void 0:w.gps_fixe)]})]}),b.jsxs("div",{className:"space-y-3",children:[b.jsxs(cr,{onClick:a,className:"w-full bg-green-600 hover:bg-green-700 text-white",children:[b.jsx(jb,{className:"w-4 h-4 mr-2"}),"Appeler"]}),b.jsxs(cr,{onClick:u,className:"w-full bg-blue-600 hover:bg-blue-700 text-white",children:[b.jsx($E,{className:"w-4 h-4 mr-2"}),"Envoyer un email"]}),b.jsxs(cr,{onClick:f,className:"w-full bg-purple-600 hover:bg-purple-700 text-white",children:[b.jsx(qm,{className:"w-4 h-4 mr-2"}),"Appel vidéo"]})]}),b.jsx("div",{className:"mt-4 text-center",children:b.jsx(cr,{variant:"outline",onClick:n,className:"w-full",children:"Fermer"})})]})})},nx=e=>{if(!e)return"Non spécifié";if(typeof e=="string")return e;if(e&&typeof e=="object"&&e.valeur!==void 0){const t=e.valeur;return typeof t=="string"?t:typeof t=="boolean"?t?"Oui":"Non":typeof t=="number"?t.toString():Array.isArray(t)?t.join(", "):String(t)}return typeof e=="boolean"?e?"Oui":"Non":typeof e=="number"?e.toString():"Non spécifié"},Nze=({service:e,prestataires:t,user:r,onClose:n})=>{var T;const[a,u]=j.useState([]),[f,i]=j.useState(!1),y=async()=>{var A,k,F,D,O,N,V,H;i(!0);try{const Z=await fetch(`/api/services/${e.id}/media`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(Z.ok){const J=await Z.json();u(J)}else{const J=[];if((A=e.data)!=null&&A.realisations&&Array.isArray(e.data.realisations))J.push(...e.data.realisations);else if((k=e.data)!=null&&k.realisations&&typeof e.data.realisations=="object"){const G=nx(e.data.realisations);Array.isArray(G)&&J.push(...G)}if((F=e.data)!=null&&F.videos&&Array.isArray(e.data.videos))J.push(...e.data.videos);else if((D=e.data)!=null&&D.videos&&typeof e.data.videos=="object"){const G=nx(e.data.videos);Array.isArray(G)&&J.push(...G)}u(J)}}catch(Z){console.error("Erreur chargement galerie:",Z);const J=[];if((O=e.data)!=null&&O.realisations&&Array.isArray(e.data.realisations))J.push(...e.data.realisations);else if((N=e.data)!=null&&N.realisations&&typeof e.data.realisations=="object"){const G=nx(e.data.realisations);Array.isArray(G)&&J.push(...G)}if((V=e.data)!=null&&V.videos&&Array.isArray(e.data.videos))J.push(...e.data.videos);else if((H=e.data)!=null&&H.videos&&typeof e.data.videos=="object"){const G=nx(e.data.videos);Array.isArray(G)&&J.push(...G)}u(J)}finally{i(!1)}},w=async A=>{try{const k={id:Date.now().toString()+Math.random(),from:"prestataire",content:A.type==="image"?"🖼️ Réalisation":"🎥 Vidéo de présentation",timestamp:new Date,status:"sent",type:A.type==="image"?"image":"video",fileUrl:A.url||A.valeur,fileName:A.label||A.nom||"Média",fileSize:A.size||0};console.log("Média partagé:",k),n()}catch(k){console.error("Erreur partage média:",k)}};return b.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:b.jsxs("div",{className:"bg-white rounded-lg w-full max-w-4xl h-96 flex flex-col",children:[b.jsxs("div",{className:"flex justify-between items-center p-4 border-b bg-gray-50",children:[b.jsxs("div",{className:"flex items-center gap-3",children:[b.jsx("svg",{className:"w-6 h-6 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),b.jsxs("div",{children:[b.jsx("h3",{className:"text-lg font-semibold",children:"Galerie du prestataire"}),b.jsxs("p",{className:"text-sm text-gray-600",children:["Réalisations et vidéos de ",nx((T=e.data)==null?void 0:T.nom_prestataire)||`Prestataire #${e.user_id}`]})]})]}),b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx(cr,{variant:"ghost",size:"sm",onClick:()=>{a.length===0&&y()},className:"text-blue-600 hover:text-blue-800",disabled:f,children:f?b.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}):b.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),b.jsx(cr,{variant:"ghost",size:"sm",onClick:n,className:"text-gray-500 hover:text-gray-700",children:"✕"})]})]}),b.jsx("div",{className:"flex-1 p-4 bg-gray-50 overflow-y-auto",children:f?b.jsx("div",{className:"flex items-center justify-center h-full",children:b.jsxs("div",{className:"text-center",children:[b.jsx("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),b.jsx("p",{className:"text-gray-600",children:"Chargement de la galerie..."})]})}):a.length===0?b.jsx("div",{className:"flex items-center justify-center h-full",children:b.jsxs("div",{className:"text-center",children:[b.jsx("svg",{className:"w-16 h-16 text-gray-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),b.jsx("h4",{className:"text-lg font-medium text-gray-600 mb-2",children:"Aucun média disponible"}),b.jsx("p",{className:"text-gray-500 mb-4",children:"Ce prestataire n'a pas encore ajouté de réalisations ou de vidéos à sa galerie."}),b.jsx(cr,{onClick:y,className:"bg-blue-600 hover:bg-blue-700 text-white",children:"🔄 Actualiser"})]})}):b.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:a.map((A,k)=>{var F,D;return b.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden hover:shadow-lg transition-all duration-200 cursor-pointer group",onClick:()=>w(A),children:[A.type==="image"||(F=A.url)!=null&&F.includes("image")||(D=A.valeur)!=null&&D.includes("image")?b.jsxs("div",{className:"aspect-square bg-gray-100 flex items-center justify-center",children:[b.jsx("img",{src:A.url||A.valeur,alt:A.label||A.nom||`Image ${k+1}`,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200",onError:O=>{var N;O.currentTarget.style.display="none",(N=O.currentTarget.nextElementSibling)==null||N.classList.remove("hidden")}}),b.jsx("div",{className:"hidden w-full h-full bg-gray-200 flex items-center justify-center",children:b.jsx("svg",{className:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})]}):b.jsx("div",{className:"aspect-square bg-gray-100 flex items-center justify-center",children:b.jsx("svg",{className:"w-16 h-16 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),b.jsxs("div",{className:"p-3",children:[b.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:A.label||A.nom||`Média ${k+1}`}),b.jsx("p",{className:"text-xs text-gray-500",children:A.type==="image"?"🖼️ Image":"🎥 Vidéo"}),b.jsx("div",{className:"mt-2",children:b.jsx(cr,{size:"sm",className:"w-full bg-purple-600 hover:bg-purple-700 text-white text-xs",onClick:O=>{O.stopPropagation(),w(A)},children:"📤 Partager dans le chat"})})]})]},k)})})})]})})},zze=()=>{const[e,t]=j.useState(new Map),[r,n]=j.useState(!1),[a,u]=j.useState(null),f=j.useCallback(()=>{u(null)},[]),i=j.useCallback(async w=>{if(!e.has(w))try{n(!0),u(null);const T=await fetch(`/api/prestataires/${w}`,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(!T.ok)throw new Error(`Erreur ${T.status}: ${T.statusText}`);const A=await T.json();t(k=>new Map(k).set(w,A))}catch(T){console.error("Erreur récupération prestataire:",T),u(T instanceof Error?T.message:"Erreur inconnue")}finally{n(!1)}},[e]),y=j.useCallback(async w=>{if(w.length===0)return;const T=w.filter(A=>!e.has(A));if(T.length!==0){console.log("🔍 [usePrestataireInfo] Chargement batch prestataires:",{totalIds:w.length,missingIds:T,existingPrestataires:e.size});try{n(!0),u(null);const A=await fetch("/api/prestataires/batch",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify({user_ids:T})});if(!A.ok)throw new Error(`Erreur ${A.status}: ${A.statusText}`);const F=(await A.json()).prestataires;console.log("✅ [usePrestataireInfo] Prestataires reçus:",{count:F.length,prestataires:F.map(D=>{var O;return{id:D.id,nom:D.nom_complet,gps:D.gps,hasGps:!!D.gps,gpsType:typeof D.gps,gpsLength:(O=D.gps)==null?void 0:O.length}})}),t(D=>{const O=new Map(D);return F.forEach(N=>{O.set(N.id,N)}),console.log("🗺️ [usePrestataireInfo] Map mise à jour:",{newSize:O.size,prestataireWithGps:Array.from(O.values()).filter(N=>N.gps).length}),O})}catch(A){console.error("❌ [usePrestataireInfo] Erreur récupération batch prestataires:",A),u(A instanceof Error?A.message:"Erreur inconnue")}finally{n(!1)}}},[e]);return{prestataires:e,loading:r,error:a,fetchPrestataire:i,fetchPrestatairesBatch:y,clearError:f}},Fze=()=>{const e=Mo(),t=Sc(),{user:r}=Rs(),{toast:n}=Oy(),[a,u]=j.useState([]),[f,i]=j.useState(!0),[y,w]=j.useState(null),[T,A]=j.useState(!1),[k,F]=j.useState(!1),[D,O]=j.useState(!1),[N,V]=j.useState(null),H=r!=null&&r.id?parseInt(r.id,10):0,{isConnected:Z,userStatus:J}=Cze(isNaN(H)?0:H);Aze(isNaN(H)?0:H);const{prestataires:G,fetchPrestatairesBatch:Y,loading:ie}=zze(),[ce,ge]=j.useState(!1);j.useEffect(()=>{G.size>0&&!ie&&(console.log("✅ [ResultatBesoin] Prestataires chargés, mise à jour de l'état"),ge(!0))},[G.size,ie]),j.useEffect(()=>{if(r!=null&&r.id)return console.log("🚀 Initialisation du suivi GPS pour l'utilisateur:",r.id),vx.startTracking(),()=>{vx.stopTracking()}},[r==null?void 0:r.id]),j.useEffect(()=>{if(console.log("🔄 [ResultatBesoin] useEffect prestataires déclenché:",{servicesLength:a.length,services:a.map(Ne=>{var We,Ue;return{id:Ne.id,userId:Ne.user_id,gpsData:(We=Ne.data)==null?void 0:We.gps_fixe,rawGps:(Ue=Ne.data)==null?void 0:Ue.gps_fixe_coords}})}),a.forEach((Ne,We)=>{var Ue,De,Ke,lt,Ye,Ve,Et,kt;console.log(`📍 [ResultatBesoin] Service ${We+1} GPS:`,{serviceId:Ne.id,gpsFixe:(Ue=Ne.data)==null?void 0:Ue.gps_fixe,gpsCoords:(De=Ne.data)==null?void 0:De.gps_fixe_coords,hasGpsData:!!((Ke=Ne.data)!=null&&Ke.gps_fixe),hasGpsCoords:!!((lt=Ne.data)!=null&&lt.gps_fixe_coords),usesRealtimeGPS:!((Ye=Ne.data)!=null&&Ye.gps_fixe)&&!!((Ve=Ne.data)!=null&&Ve.gps_fixe_coords)}),!((Et=Ne.data)!=null&&Et.gps_fixe)&&((kt=Ne.data)!=null&&kt.gps_fixe_coords)&&console.warn(`⚠️ [ResultatBesoin] Service ${Ne.id} utilise le GPS en temps réel au lieu du GPS fixe`)}),a.length>0){const Ne=a.map(We=>We.user_id).filter(We=>We!==void 0);console.log("👥 [ResultatBesoin] UserIDs extraits:",Ne),Ne.length>0&&(console.log("🚀 [ResultatBesoin] Appel fetchPrestatairesBatch avec:",Ne),Y(Ne))}},[a,Y]),j.useEffect(()=>{(async()=>{var We;if((We=t.state)!=null&&We.results){const Ue=t.state.results;if(!Array.isArray(Ue)){i(!1);return}const De=await Le(Ue),Ke=De.map(lt=>lt.service_id).filter(lt=>lt&&lt!=="undefined").map(lt=>lt.toString());Ke.length>0?ze(Ke,De):i(!1)}else i(!1)})()},[t.state]);const be=()=>new Promise(Ne=>{if(!navigator.geolocation){console.warn("Géolocalisation non supportée"),Ne(null);return}navigator.geolocation.getCurrentPosition(We=>{const{latitude:Ue,longitude:De}=We.coords;console.log(`📍 Position utilisateur: ${Ue}, ${De}`),Ne({lat:Ue,lon:De})},We=>{console.warn("Erreur géolocalisation:",We.message),Ne(null)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})}),xe=(Ne,We,Ue,De)=>{const lt=(Ue-Ne)*Math.PI/180,Ye=(De-We)*Math.PI/180,Ve=Math.sin(lt/2)*Math.sin(lt/2)+Math.cos(Ne*Math.PI/180)*Math.cos(Ue*Math.PI/180)*Math.sin(Ye/2)*Math.sin(Ye/2);return 6371*(2*Math.atan2(Math.sqrt(Ve),Math.sqrt(1-Ve)))},Le=async Ne=>{try{const We=await be();return We?Ne.map(De=>{let Ke=1/0;if(De.gps&&typeof De.gps=="string"&&De.gps.includes(","))try{const lt=De.gps.split(",");if(lt.length>=2){const Ye=parseFloat(lt[0]),Ve=parseFloat(lt[1]);!isNaN(Ye)&&!isNaN(Ve)&&(Ke=xe(We.lat,We.lon,Ye,Ve))}}catch(lt){console.warn("Erreur parsing GPS:",lt)}return{...De,distance:Ke,proximityScore:Ke<1?1:Ke<5?.8:Ke<10?.6:.4}}).sort((De,Ke)=>{const lt=(De.score||0)*.7+(De.proximityScore||0)*.3;return(Ke.score||0)*.7+(Ke.proximityScore||0)*.3-lt}):(console.log("📍 Géolocalisation non disponible, tri par score uniquement"),Ne.sort((De,Ke)=>(Ke.score||0)-(De.score||0)))}catch(We){return console.error("❌ Erreur lors du tri des résultats:",We),Ne.sort((Ue,De)=>(De.score||0)-(Ue.score||0))}},ze=async(Ne,We=[])=>{try{i(!0),V(null);const Ue=Ne.map(async(lt,Ye)=>{var Ve,Et,kt,Wt,Tt,Ht;try{const ur=await fetch(`/api/services/${lt}`,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});return ur.ok?{...await ur.json(),score:((Ve=We[Ye])==null?void 0:Ve.score)||0,semantic_score:((Et=We[Ye])==null?void 0:Et.semantic_score)||0,interaction_score:((kt=We[Ye])==null?void 0:kt.interaction_score)||0,gps:((Wt=We[Ye])==null?void 0:Wt.gps)||null,distance:(Tt=We[Ye])==null?void 0:Tt.distance,proximityScore:(Ht=We[Ye])==null?void 0:Ht.proximityScore}:ur.status===404?(console.warn(`⚠️ Service ${lt} non trouvé (404)`),null):(console.error(`❌ Erreur ${ur.status} pour le service ${lt}`),null)}catch(ur){return console.error(`❌ Erreur réseau pour le service ${lt}:`,ur),null}}),Ke=(await Promise.all(Ue)).filter(lt=>lt!==null);if(Ke.length===0)V("Aucun service trouvé. Les services recherchés ne sont plus disponibles."),u([]);else if(Ke.length<Ne.length){const lt=Ne.length-Ke.length;console.warn(`⚠️ ${lt} services manquants sur ${Ne.length} demandés`),n({title:"Services partiellement trouvés",description:`${Ke.length} sur ${Ne.length} services trouvés`,type:"default"}),u(Ke)}else u(Ke)}catch(Ue){console.error("❌ Erreur lors de la récupération des services:",Ue),V("Erreur lors de la récupération des services"),u([])}finally{i(!1)}},Xe=Ne=>{if(!r){n({title:"Connexion requise",description:"Veuillez vous connecter pour contacter le prestataire",type:"error"}),e("/login",{state:{from:"/resultat-besoin"}});return}w(Ne),A(!0)},Je=Ne=>{if(!r){n({title:"Connexion requise",description:"Veuillez vous connecter pour chatter avec le prestataire",type:"error"}),e("/login",{state:{from:"/resultat-besoin"}});return}w(Ne),F(!0)},tt=Ne=>{w(Ne),O(!0)},st=async()=>{var We;const Ne=await be();if(Ne){if(n({title:"Géolocalisation activée",description:`Position: ${Ne.lat.toFixed(4)}, ${Ne.lon.toFixed(4)}`,type:"default"}),(We=t.state)!=null&&We.results){const Ue=await Le(t.state.results),De=Ue.map(Ke=>Ke.service_id).filter(Ke=>Ke&&Ke!=="undefined").map(Ke=>Ke.toString());De.length>0&&ze(De,Ue)}}else n({title:"Géolocalisation échouée",description:"Impossible de récupérer votre position",type:"error"})};return f?b.jsx("div",{className:"container mx-auto px-4 py-8",children:b.jsxs("div",{className:"text-center",children:[b.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),b.jsx("p",{className:"mt-4 text-gray-600",children:"Recherche des services en cours..."})]})}):b.jsx(Ka,{padding:!1,children:b.jsxs("div",{className:"container mx-auto px-4 py-8",children:[b.jsx("div",{className:"mb-6",children:b.jsx("div",{className:"flex justify-between items-center",children:b.jsxs(cr,{onClick:()=>e("/"),variant:"ghost",className:"text-gray-600 hover:text-gray-800",children:[b.jsx(BE,{className:"w-4 h-4 mr-2"}),"Retour à l'accueil"]})})}),b.jsxs("div",{className:"mb-8 text-center",children:[b.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Services correspondants à votre besoin"}),a.some(Ne=>{var We,Ue;return!((We=Ne.data)!=null&&We.gps_fixe)&&((Ue=Ne.data)==null?void 0:Ue.gps_fixe_coords)})&&b.jsxs("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg max-w-2xl mx-auto",children:[b.jsxs("div",{className:"flex items-center gap-2 text-yellow-800",children:[b.jsx(gx,{className:"w-5 h-5"}),b.jsx("span",{className:"text-sm font-medium",children:"⚠️ Certains services utilisent la position GPS en temps réel du créateur"})]}),b.jsx("p",{className:"text-xs text-yellow-700 mt-1",children:"Cela peut expliquer pourquoi des coordonnées du Nigeria s'affichent si le créateur est actuellement là-bas"})]}),b.jsxs("div",{className:"flex justify-center items-center gap-8 text-gray-600 mb-4",children:[b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx(oy,{className:"w-5 h-5 text-green-500"}),b.jsxs("span",{children:[a.length," service",a.length>1?"s":""," trouvé",a.length>1?"s":""]})]}),b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx(XW,{className:"w-5 h-5 text-blue-500"}),b.jsx("span",{children:"Résultats en temps réel"})]})]}),b.jsx("div",{className:"flex justify-center",children:b.jsxs(cr,{onClick:st,variant:"outline",className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white border-0 hover:from-blue-600 hover:to-purple-700",children:[b.jsx(ou,{className:"w-4 h-4 mr-2"}),"Activer la géolocalisation pour trier par proximité"]})})]}),N&&b.jsx(nu,{className:"max-w-2xl mx-auto",children:b.jsxs(iu,{className:"p-8 text-center",children:[b.jsx(gx,{className:"w-16 h-16 text-red-400 mx-auto mb-4"}),b.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Erreur de chargement"}),b.jsx("p",{className:"text-gray-600 mb-6",children:N}),b.jsx(cr,{onClick:()=>e("/besoins"),className:"px-6",children:"Retour aux besoins"})]})}),!a||a.length===0?b.jsx(nu,{className:"max-w-2xl mx-auto",children:b.jsxs(iu,{className:"p-8 text-center",children:[b.jsx(gx,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),b.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Aucun service trouvé"}),b.jsx("p",{className:"text-gray-600 mb-6",children:"Aucun prestataire ne correspond à vos critères pour le moment."}),b.jsx(cr,{onClick:()=>e("/besoins"),className:"px-6",children:"Retour aux besoins"})]})}):ce?b.jsx("div",{className:"flex justify-center",children:b.jsx("div",{className:`grid gap-6 ${a.length===1?"grid-cols-1 max-w-md":a.length===2?"grid-cols-1 md:grid-cols-2 max-w-4xl":a.length<=4?"grid-cols-1 md:grid-cols-2 lg:grid-cols-3 max-w-5xl":"grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 max-w-7xl"}`,children:Array.isArray(a)&&a.map(Ne=>b.jsx(jze,{service:Ne,prestataires:G,user:r,wsConnected:Z,userStatus:J,onContact:Xe,onChat:Je,onGallery:tt},Ne.id))})}):b.jsx(nu,{className:"max-w-2xl mx-auto",children:b.jsxs(iu,{className:"p-8 text-center",children:[b.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-500 mx-auto mb-4"}),b.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Chargement des informations prestataire"}),b.jsx("p",{className:"text-gray-600 mb-6",children:"Récupération des données GPS et des informations des prestataires..."})]})}),a.length>0&&b.jsx("div",{className:"mt-12 text-center",children:b.jsxs("div",{className:"max-w-2xl mx-auto p-6 bg-blue-50 rounded-lg border border-blue-200",children:[b.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-2",children:"Comment procéder ?"}),b.jsxs("div",{className:"grid md:grid-cols-3 gap-4 text-sm text-blue-700",children:[b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx("div",{className:"w-6 h-6 bg-blue-200 rounded-full flex items-center justify-center text-blue-800 font-semibold",children:"1"}),b.jsx("span",{children:"Choisissez le service qui vous convient"})]}),b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx("div",{className:"w-6 h-6 bg-blue-200 rounded-full flex items-center justify-center text-blue-800 font-semibold",children:"2"}),b.jsx("span",{children:"Contactez le prestataire via le bouton"})]}),b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx("div",{className:"w-6 h-6 bg-blue-200 rounded-full flex items-center justify-center text-blue-800 font-semibold",children:"3"}),b.jsx("span",{children:"Échangez et finalisez votre projet"})]})]})]})}),y&&T&&b.jsx(yee,{service:y,prestataires:G,user:r,onClose:()=>A(!1)}),y&&k&&b.jsx(Dze,{service:y,prestataires:G,user:r,wsConnected:Z,onClose:()=>F(!1)}),y&&D&&b.jsx(Nze,{service:y,prestataires:G,user:r,onClose:()=>O(!1)})]})})},Bze=()=>{const e=Mo(),t=()=>{const r=[{id:"test_1",score:.95,metadata:{ia_response:JSON.stringify({intention:"recherche_besoin",titre:{valeur:"Recherche d'un plombier"},description:{valeur:"L'utilisateur cherche un plombier pour des travaux de plomberie."},category:{valeur:"Plomberie"},reponse_intelligente:{valeur:"Nous vous recommandons de contacter un plombier professionnel."},suggestions_complementaires:{valeur:[{service:{valeur:"Réparation de fuites"},description:{valeur:"Service de réparation de fuites d'eau par un plombier qualifié."}},{service:{valeur:"Installation de chauffe-eau"},description:{valeur:"Installation professionnelle de chauffe-eau pour assurer un fonctionnement optimal."}}]}}),service_id:123}},{id:"test_2",score:.92,metadata:{ia_response:JSON.stringify({intention:"creation_service",data:{titre_service:{valeur:"Services de plomberie à Yaoundé"},description:{valeur:"Je propose des services de plomberie dans la ville de Yaoundé, incluant l'installation, la réparation et l'entretien de systèmes de plomberie."},category:{valeur:"Plomberie"}}}),service_id:456}}];e("/resultat-besoin",{state:{results:r,type:"recherche_besoin"}})};return b.jsxs("div",{className:"container mx-auto px-4 py-8",children:[b.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Test ResultatBesoin"}),b.jsxs("div",{className:"space-y-4",children:[b.jsx("button",{onClick:t,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Tester avec données"}),b.jsx("button",{onClick:()=>e("/resultat-besoin"),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Tester sans données"}),b.jsx("button",{onClick:()=>e("/"),className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600",children:"Retour à l'accueil"})]})]})},$ze=({service:e,serviceCreatorInfo:t,className:r="",compact:n=!1,showMap:a=!1})=>{const[u,f]=j.useState("Chargement..."),[i,y]=j.useState(""),[w,T]=j.useState({flag:"",code:"",countryName:""}),[A,k]=j.useState(!0),[F,D]=j.useState(null),[O,N]=j.useState(null),[V,H]=j.useState("service"),Z=j.useRef(!1),{user:J}=Rs(),G=j.useCallback(be=>{if(!be)return"";if(typeof be=="object"){if(be.valeur!==void 0){const xe=be.valeur;return typeof xe=="string"?xe:typeof xe=="boolean"?xe?"Oui":"Non":typeof xe=="number"?xe.toString():Array.isArray(xe)?xe.join(", "):String(xe)}if(be.value!==void 0)return be.value;if(be.content!==void 0)return be.content;if(be.text!==void 0)return be.text;if(be.data!==void 0)return be.data;if(Object.keys(be).length>0){const xe=["value","content","text","data","info"];for(const Le of xe)if(be[Le]!==void 0){const ze=be[Le];if(typeof ze=="string")return ze;if(typeof ze=="boolean")return ze?"Oui":"Non";if(typeof ze=="number")return ze.toString()}}}return typeof be=="string"?be:typeof be=="boolean"?be?"Oui":"Non":typeof be=="number"?be.toString():""},[]);j.useCallback(async()=>null,[]);const Y=j.useCallback(be=>{if(console.log("🏳️ [extractCountryInfo] Données reçues:",be),console.log("🏳️ [extractCountryInfo] Type de données:",typeof be),console.log("🏳️ [extractCountryInfo] Clés disponibles:",Object.keys(be)),be.address_components&&Array.isArray(be.address_components)){console.log("🏳️ [extractCountryInfo] address_components trouvé, longueur:",be.address_components.length),console.log("🏳️ [extractCountryInfo] address_components:",be.address_components);const xe=be.address_components.find(Le=>Le.types.includes("country"));if(xe){const Le=xe.short_name,ze=xe.long_name;return console.log("🏳️ [extractCountryInfo] Pays trouvé dans address_components:",{code:Le,name:ze}),{flag:"",code:Le,countryName:ze}}else console.log("🏳️ [extractCountryInfo] Aucun pays trouvé dans address_components")}else console.log("🏳️ [extractCountryInfo] address_components non trouvé ou invalide"),console.log("🏳️ [extractCountryInfo] Type de address_components:",typeof be.address_components);if(be.formatted_address){const xe=be.formatted_address.toLowerCase();if(console.log("🏳️ [extractCountryInfo] Tentative extraction depuis formatted_address:",xe),xe.includes("douala")||xe.includes("littoral")||xe.includes("cameroun"))return console.log("🏳️ [extractCountryInfo] Cameroun détecté dans l'adresse"),{flag:"",code:"CM",countryName:"Cameroun"};if(xe.includes("nigeria")||xe.includes("lagos")||xe.includes("abuja")||xe.includes("kwara")||xe.includes("worumokato"))return console.log("🏳️ [extractCountryInfo] Nigeria détecté dans l'adresse"),{flag:"",code:"NG",countryName:"Nigeria"};if(xe.includes("senegal")||xe.includes("dakar"))return console.log("🏳️ [extractCountryInfo] Sénégal détecté dans l'adresse"),{flag:"",code:"SN",countryName:"Sénégal"};if(xe.includes("cote d'ivoire")||xe.includes("abidjan"))return console.log("🏳️ [extractCountryInfo] Côte d'Ivoire détecté dans l'adresse"),{flag:"",code:"CI",countryName:"Côte d'Ivoire"};if(xe.includes("ghana")||xe.includes("accra"))return console.log("🏳️ [extractCountryInfo] Ghana détecté dans l'adresse"),{flag:"",code:"GH",countryName:"Ghana"};if(xe.includes("france")||xe.includes("paris"))return console.log("🏳️ [extractCountryInfo] France détecté dans l'adresse"),{flag:"",code:"FR",countryName:"France"};if(xe.includes("united states")||xe.includes("usa")||xe.includes("new york"))return console.log("🏳️ [extractCountryInfo] États-Unis détecté dans l'adresse"),{flag:"",code:"US",countryName:"États-Unis"};if(xe.includes("canada")||xe.includes("toronto"))return console.log("🏳️ [extractCountryInfo] Canada détecté dans l'adresse"),{flag:"",code:"CA",countryName:"Canada"};if(xe.includes("united kingdom")||xe.includes("uk")||xe.includes("london"))return console.log("🏳️ [extractCountryInfo] Royaume-Uni détecté dans l'adresse"),{flag:"",code:"GB",countryName:"Royaume-Uni"};if(xe.includes("germany")||xe.includes("berlin"))return console.log("🏳️ [extractCountryInfo] Allemagne détecté dans l'adresse"),{flag:"",code:"DE",countryName:"Allemagne"};if(xe.includes("italy")||xe.includes("rome"))return console.log("🏳️ [extractCountryInfo] Italie détecté dans l'adresse"),{flag:"",code:"IT",countryName:"Italie"};if(xe.includes("spain")||xe.includes("madrid"))return console.log("🏳️ [extractCountryInfo] Espagne détecté dans l'adresse"),{flag:"",code:"ES",countryName:"Espagne"};if(xe.includes("japan")||xe.includes("tokyo"))return console.log("🏳️ [extractCountryInfo] Japon détecté dans l'adresse"),{flag:"",code:"JP",countryName:"Japon"};if(xe.includes("china")||xe.includes("beijing"))return console.log("🏳️ [extractCountryInfo] Chine détecté dans l'adresse"),{flag:"",code:"CN",countryName:"Chine"};if(xe.includes("india")||xe.includes("new delhi"))return console.log("🏳️ [extractCountryInfo] Inde détecté dans l'adresse"),{flag:"",code:"IN",countryName:"Inde"};if(xe.includes("brazil")||xe.includes("brasil")||xe.includes("sao paulo"))return console.log("🏳️ [extractCountryInfo] Brésil détecté dans l'adresse"),{flag:"",code:"BR",countryName:"Brésil"};if(xe.includes("australia")||xe.includes("sydney"))return console.log("🏳️ [extractCountryInfo] Australie détecté dans l'adresse"),{flag:"",code:"AU",countryName:"Australie"};if(xe.includes("south africa")||xe.includes("johannesburg"))return console.log("🏳️ [extractCountryInfo] Afrique du Sud détecté dans l'adresse"),{flag:"",code:"ZA",countryName:"Afrique du Sud"};console.log("🏳️ [extractCountryInfo] Aucun pays reconnu dans formatted_address")}else console.log("🏳️ [extractCountryInfo] formatted_address non trouvé");return be.results&&Array.isArray(be.results)&&be.results.length>0?(console.log("🏳️ [extractCountryInfo] Tentative depuis data.results[0]"),Y(be.results[0])):(console.log("🏳️ [extractCountryInfo] Retour des valeurs par défaut"),{flag:"",code:"XX",countryName:"Pays inconnu"})},[]),ie=j.useCallback(async be=>{if(!be||!be.includes(","))return be;try{const xe=be.split(",").map(tt=>parseFloat(tt.trim()));if(xe.length!==2||xe.some(isNaN))return be;let Le,ze;xe[0]>=-90&&xe[0]<=90?(Le=xe[0],ze=xe[1]):xe[1]>=-90&&xe[1]<=90?(Le=xe[1],ze=xe[0]):(Le=xe[0],ze=xe[1]);try{const tt=new AbortController,st=setTimeout(()=>tt.abort(),1e4);console.log("🌐 [LocationDisplay] Tentative API backend Google Maps pour:",{lat:Le,lng:ze});const Ne=await fetch("/api/geocoding/reverse",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({latitude:Le,longitude:ze,detail_level:"high"}),signal:tt.signal});if(clearTimeout(st),Ne.ok){const We=await Ne.json();if(console.log("✅ [LocationDisplay] API Google Maps réussie:",We),console.log("🔍 [LocationDisplay] Structure complète des données:",JSON.stringify(We,null,2)),We.formatted_address){let Ue=We.formatted_address;const De=Y(We);if(T(De),We.address_components){const Ke=We.address_components,lt=Ke.find(Et=>Et.types.includes("neighbourhood")),Ye=Ke.find(Et=>Et.types.includes("sublocality")),Ve=Ke.find(Et=>Et.types.includes("locality"));lt&&Ve?Ue=`${lt.long_name}, ${Ve.long_name}`:Ye&&Ve?Ue=`${Ye.long_name}, ${Ve.long_name}`:Ve&&(Ue=Ve.long_name)}return Ue}}else{console.log("⚠️ [LocationDisplay] API Google Maps erreur:",Ne.status,Ne.statusText);const We=await Ne.text();console.log("⚠️ [LocationDisplay] Détails de l'erreur:",We)}}catch(tt){tt instanceof Error&&tt.name==="AbortError"?console.log("⏰ [LocationDisplay] API Google Maps timeout après 10s"):console.log("❌ [LocationDisplay] API Google Maps erreur:",tt)}console.log("🔄 [LocationDisplay] API échouée, affichage des coordonnées");const Xe=Math.abs(Le)<10?Le.toFixed(3):Le.toFixed(2),Je=Math.abs(ze)<10?ze.toFixed(3):ze.toFixed(2);return`Coordonnées GPS (${Xe}, ${Je})`}catch(xe){return console.error("❌ [convertGpsToLocation] Erreur:",xe),be}},[Y]),ce=j.useCallback(async()=>{var be,xe,Le;console.log("🔍 [LocationDisplay] Début formatLocation"),console.log("📦 [LocationDisplay] Service reçu:",e),console.log("👤 [LocationDisplay] Info créateur du service reçu:",t),console.log("🔑 [LocationDisplay] User hook:",J);try{const ze=G((be=e==null?void 0:e.data)==null?void 0:be.gps_fixe);if(console.log("📍 [LocationDisplay] GPS fixe du service:",ze),ze&&ze.includes(",")){const tt=await ie(ze);if(tt&&tt!=="Localisation non disponible"){console.log("✅ [LocationDisplay] Utilisation GPS fixe du service:",tt),H("service");const st=ze.split(",").map(Ne=>parseFloat(Ne.trim()));if(st.length===2&&!st.some(isNaN)){let Ne,We;st[0]>=-90&&st[0]<=90?(Ne=st[0],We=st[1]):(Ne=st[1],We=st[0]),N({lat:Ne,lng:We})}return tt}}else console.log("❌ [LocationDisplay] GPS fixe non valide ou absent");if(console.log("🔍 [LocationDisplay] Recherche GPS du créateur du service..."),t!=null&&t.gps&&t.gps.includes(",")){console.log("✅ [LocationDisplay] GPS créateur du service trouvé:",t.gps);const tt=t.gps.split(",").map(st=>parseFloat(st.trim()));if(tt.length===2&&!tt.some(isNaN)){let st,Ne;if(tt[0]>=-90&&tt[0]<=90?(st=tt[0],Ne=tt[1]):(st=tt[1],Ne=tt[0]),st>=6&&st<=7&&Ne>=3&&Ne<=4||st>=8&&st<=9&&Ne>=4&&Ne<=5||st>=9&&st<=10&&Ne>=4&&Ne<=5){console.log("⚠️ [LocationDisplay] GPS créateur suspect (Nigeria par défaut), récupération position temps réel");try{if(navigator.geolocation){const De=await new Promise((Ye,Ve)=>{navigator.geolocation.getCurrentPosition(Ye,Ve,{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})}),Ke=`${De.coords.latitude},${De.coords.longitude}`;console.log("📍 [LocationDisplay] Position temps réel récupérée:",Ke);const lt=await ie(Ke);if(lt&&lt!=="Localisation non disponible")return H("user"),N({lat:De.coords.latitude,lng:De.coords.longitude}),lt}}catch(De){console.warn("⚠️ [LocationDisplay] Impossible de récupérer la position temps réel:",De)}return H("creator"),N({lat:st,lng:Ne}),"Position du créateur du service"}console.log("✅ [LocationDisplay] GPS créateur valide, utilisation avec avertissement");const Ue=await ie(t.gps);if(Ue&&Ue!=="Localisation non disponible")return console.log("✅ [LocationDisplay] Résultat GPS créateur du service:",Ue),H("creator"),N({lat:st,lng:Ne}),`${Ue} 📍 (Position actuelle du créateur)`}}else console.log("❌ [LocationDisplay] GPS créateur du service non trouvé ou invalide");const Xe=G((xe=e==null?void 0:e.data)==null?void 0:xe.adresse);if(console.log("🏠 [LocationDisplay] Adresse du service:",Xe),Xe)return console.log("✅ [LocationDisplay] Utilisation de l'adresse:",Xe),H("adresse"),Xe;const Je=G((Le=e==null?void 0:e.data)==null?void 0:Le.titre);return console.log("📝 [LocationDisplay] Titre du service:",Je),Je?(console.log("✅ [LocationDisplay] Utilisation du titre:",Je),H("titre"),Je):(console.log("❌ [LocationDisplay] Aucune localisation trouvée"),"Localisation non disponible")}catch(ze){return console.error("❌ [formatLocation] Erreur:",ze),"Erreur de chargement"}},[e,t,J,G,ie]);j.useEffect(()=>{if(Z.current)return;console.log("🚀 [LocationDisplay] useEffect déclenché"),console.log("📦 [LocationDisplay] Props reçues:",{service:e,serviceCreatorInfo:t,compact:n,showMap:a}),(async()=>{try{k(!0);const xe=await ce();if(console.log("✅ [LocationDisplay] Résultat final:",xe),f(xe),xe&&xe!=="Localisation non disponible"&&xe!=="Erreur de chargement"&&!xe.includes("Chargement")){let Le=xe;w.code!=="XX"&&(Le+=` ${w.countryName||"Pays inconnu"}`),y(Le)}Z.current=!0}catch(xe){console.error("❌ [LocationDisplay] Erreur:",xe),f("Erreur de chargement"),Z.current=!0}finally{k(!1)}})()},[]);const ge=j.useCallback(()=>{if(O){const be=`https://www.google.com/maps?q=${O.lat},${O.lng}&z=16&hl=fr`;console.log("🗺️ [LocationDisplay] Ouverture Google Maps avec coordonnées:",O),window.open(be,"_blank");return}if(u&&u!=="Localisation non disponible"&&u!=="Erreur de chargement"){const be=`https://www.google.com/maps/search/${encodeURIComponent(u)}?z=15&hl=fr`;console.log("🗺️ [LocationDisplay] Ouverture Google Maps avec recherche:",u),window.open(be,"_blank")}},[O,u]);return A?b.jsx("div",{className:`space-y-3 ${r}`,children:b.jsxs("div",{className:"flex items-start gap-3",children:[b.jsx(ou,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),b.jsx("div",{className:"flex-1 min-w-0",children:b.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[b.jsx("span",{className:"font-medium text-gray-800 text-sm",children:"Chargement..."}),b.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"})]})})]})}):b.jsx("div",{className:`space-y-3 ${r}`,children:b.jsxs("div",{className:"flex items-start gap-3",children:[b.jsx(ou,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),b.jsxs("div",{className:"flex-1 min-w-0",children:[b.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[b.jsx("span",{className:"text-gray-800 font-medium truncate max-w-[200px]",title:u,children:u}),(w==null?void 0:w.countryName)&&b.jsx("span",{className:"text-xs text-gray-600 bg-gray-100 px-2 py-1 rounded flex-shrink-0",children:w.countryName}),b.jsxs("span",{className:"ml-auto text-lg flex-shrink-0",children:[V==="user"&&b.jsx("span",{title:"Position GPS en temps réel de l'utilisateur connecté",children:"👤"}),(V==="service"||V==="creator"||V==="adresse"||V==="titre")&&b.jsx("span",{title:"Position GPS fixe du service ou information du service",children:"🏠"})]}),a&&u!=="Localisation non disponible"&&u!=="Erreur de chargement"&&b.jsxs(cr,{variant:"outline",size:"sm",onClick:ge,className:"h-8 px-3 text-xs text-blue-600 hover:text-blue-800 hover:bg-blue-50 border-blue-200 hover:border-blue-300 transition-all duration-200 flex-shrink-0",children:[b.jsx(_O,{className:"w-3 h-3 mr-1.5"}),b.jsx("span",{className:"mr-1",children:"Voir sur la carte"}),b.jsx(vO,{className:"w-3 h-3"})]})]}),!n&&i&&i!==u&&b.jsx("div",{className:"text-xs text-gray-600 bg-gray-50 px-3 py-2 rounded-md",children:i})]})]})})},Vze=()=>{const e=[{id:1,data:{gps_fixe:"3.848033,11.502075",adresse:"Yaoundé, Région du Centre, Cameroun"},user_id:1},{id:2,data:{gps_fixe:"4.0511,-9.7679",adresse:"Monrovia, Montserrado, Libéria"},user_id:2},{id:3,data:{gps_fixe:"Non spécifié",adresse:"Douala, Littoral, Cameroun"},user_id:3},{id:4,data:{gps_fixe:"Non spécifié",adresse:"Non spécifié"},user_id:4},{id:5,data:{gps_fixe:"48.8566,2.3522",adresse:"Paris, Île-de-France, France"},user_id:5},{id:6,data:{gps_fixe:"40.7128,-74.0060",adresse:"New York, NY, USA"},user_id:6}],t=new Map([[1,{gps:"3.848033,11.502075"}],[2,{gps:"4.0511,-9.7679"}],[3,{gps:"4.0511,9.7679"}],[4,{gps:"Non spécifié"}],[5,{gps:"48.8566,2.3522"}],[6,{gps:"40.7128,-74.0060"}]]);return b.jsxs("div",{className:"p-6 space-y-6",children:[b.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"🗺️ Démonstration LocationDisplay - Version Optimisée"}),b.jsxs("div",{className:"bg-green-50 p-4 rounded-lg mb-6",children:[b.jsx("h3",{className:"font-semibold text-green-800 mb-2",children:"✨ Nouvelles fonctionnalités :"}),b.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[b.jsxs("li",{children:["✅ ",b.jsx("strong",{children:"Pays et drapeau intégrés"})," - Affichés directement après le nom du lieu"]}),b.jsxs("li",{children:["✅ ",b.jsx("strong",{children:"Niveau quartier"})," - Géocodage jusqu'au niveau du quartier pour plus de précision"]}),b.jsxs("li",{children:["✅ ",b.jsx("strong",{children:"Google Maps optimisé"})," - Chargement léger et centrage parfait sur le lieu"]}),b.jsxs("li",{children:["✅ ",b.jsx("strong",{children:"Interface en 2 lignes"})," - Icône et lieu sur la 1ère, détails sur la 2nde"]}),b.jsxs("li",{children:["✅ ",b.jsx("strong",{children:"Affichage détaillé"})," - Nom du lieu et drapeau et code pays en une ligne"]})]})]}),b.jsx("div",{className:"grid gap-4",children:e.map((r,n)=>{var a;return b.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-white shadow-sm",children:[b.jsxs("h3",{className:"font-semibold text-gray-700 mb-2",children:["Test ",n+1,": ",r.data.adresse||"Pas d'adresse"]}),b.jsxs("div",{className:"space-y-2",children:[b.jsxs("div",{className:"text-sm text-gray-600",children:[b.jsx("strong",{children:"GPS fixe:"})," ",r.data.gps_fixe]}),b.jsxs("div",{className:"text-sm text-gray-600",children:[b.jsx("strong",{children:"GPS prestataire:"})," ",(a=t.get(r.user_id))==null?void 0:a.gps]}),b.jsxs("div",{className:"border-t pt-2",children:[b.jsx("strong",{children:"Affichage:"}),b.jsx($ze,{service:r,prestataireInfo:t.get(r.user_id),compact:!1,showMap:!0})]})]})]},r.id)})}),b.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:[b.jsx("h3",{className:"font-semibold text-blue-800 mb-2",children:"🔧 Fonctionnalités techniques :"}),b.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[b.jsxs("li",{children:["✅ ",b.jsx("strong",{children:"Géocodage niveau quartier"})," - Priorité: neighbourhood puis sublocality puis locality"]}),b.jsxs("li",{children:["✅ ",b.jsx("strong",{children:"Pays et drapeau automatiques"})," - Récupérés via Google Maps API"]}),b.jsxs("li",{children:["✅ ",b.jsx("strong",{children:"URL Google Maps simplifiée"})," - Paramètres essentiels uniquement pour un chargement rapide"]}),b.jsxs("li",{children:["✅ ",b.jsx("strong",{children:"Zoom optimal (z=16)"})," - Centrage parfait sur le lieu sans surcharge"]}),b.jsxs("li",{children:["✅ ",b.jsx("strong",{children:"Fallback intelligent"})," : Google Maps puis coordonnées puis adresse puis titre"]})]})]}),b.jsxs("div",{className:"mt-6 p-4 bg-yellow-50 rounded-lg",children:[b.jsx("h3",{className:"font-semibold text-yellow-800 mb-2",children:"📍 Comment ça fonctionne maintenant :"}),b.jsxs("ol",{className:"text-sm text-yellow-700 space-y-1 list-decimal list-inside",children:[b.jsx("li",{children:"Le composant reçoit les données GPS et appelle l'API Google Maps avec un niveau de détail élevé"}),b.jsx("li",{children:"Il extrait le niveau quartier (neighbourhood) en priorité, puis sublocality, puis locality"}),b.jsx("li",{children:"Il ajoute automatiquement le pays et le drapeau après le nom du lieu"}),b.jsx("li",{children:"Il affiche le tout sur 2 lignes : icône et lieu et pays/drapeau, puis détails complets"}),b.jsx("li",{children:"Le bouton ouvre Google Maps avec une URL simplifiée pour un chargement rapide et un centrage parfait"})]})]}),b.jsxs("div",{className:"mt-6 p-4 bg-purple-50 rounded-lg",children:[b.jsx("h3",{className:"font-semibold text-purple-800 mb-2",children:"🚀 Exemples d'affichage :"}),b.jsxs("div",{className:"text-sm text-purple-700 space-y-2",children:[b.jsxs("div",{className:"bg-white p-3 rounded border",children:[b.jsx("strong",{children:"Avant (niveau ville) :"}),' "Yaoundé, Cameroun"']}),b.jsxs("div",{className:"bg-white p-3 rounded border",children:[b.jsx("strong",{children:"Maintenant (niveau quartier) :"}),' "Bastos, Yaoundé 🇨🇲 CM"']}),b.jsxs("div",{className:"bg-white p-3 rounded border",children:[b.jsx("strong",{children:"Avant (niveau ville) :"}),' "Paris, France"']}),b.jsxs("div",{className:"bg-white p-3 rounded border",children:[b.jsx("strong",{children:"Maintenant (niveau quartier) :"}),' "Le Marais, Paris 🇫🇷 FR"']})]})]}),b.jsxs("div",{className:"mt-6 p-4 bg-indigo-50 rounded-lg",children:[b.jsx("h3",{className:"font-semibold text-indigo-800 mb-2",children:"🎯 Optimisations Google Maps :"}),b.jsxs("ul",{className:"text-sm text-indigo-700 space-y-1",children:[b.jsxs("li",{children:["🔧 ",b.jsx("strong",{children:"URL simplifiée"})," - Suppression des paramètres lourds qui ralentissaient le chargement"]}),b.jsxs("li",{children:["🎯 ",b.jsx("strong",{children:"Zoom optimal (z=16)"})," - Parfait pour voir le lieu et ses environs immédiats"]}),b.jsxs("li",{children:["⚡ ",b.jsx("strong",{children:"Chargement rapide"})," - Plus de paramètres complexes qui surchargent l'API"]}),b.jsxs("li",{children:["📍 ",b.jsx("strong",{children:"Centrage parfait"})," - Le lieu est automatiquement centré sur la carte"]}),b.jsxs("li",{children:["🌍 ",b.jsx("strong",{children:"Langue française"})," - Interface Google Maps en français"]})]})]})]})},ey=({children:e="Yukpo"})=>b.jsx("span",{className:"bg-gradient-to-r from-yellow-500 via-orange-500 to-red-600 text-transparent bg-clip-text font-bold",children:e}),Uze=()=>b.jsx(Ka,{children:b.jsx("section",{className:"py-20 px-6 font-sans text-gray-800 dark:text-gray-200",style:{backgroundImage:"url('/assets/ndop-texture.png')",backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed"},children:b.jsxs("div",{className:"max-w-4xl mx-auto bg-white/80 dark:bg-gray-900/80 rounded-xl shadow-xl p-10 backdrop-blur-sm space-y-8",children:[b.jsxs("h1",{className:"text-4xl font-extrabold text-center",children:[b.jsx(ey,{children:"Yukpomnang"})," — l’écoute qui comprend vraiment"]}),b.jsxs("p",{className:"text-lg leading-relaxed text-center text-gray-700 dark:text-gray-300",children:["Aussi appelé ",b.jsx(ey,{children:"Yukpo"}),", le nom de la plateforme signifie ",b.jsx("em",{children:"« l’écoute des gens »"})," en langue ",b.jsx("strong",{children:"Bayangam"}),", parlée au cœur de l’Afrique centrale par ",b.jsx("strong",{children:"un peuple Bamiléké du Cameroun"}),"."]}),b.jsxs("p",{className:"leading-relaxed text-gray-800 dark:text-gray-200 text-justify",children:["Fidèle à cette racine linguistique et humaine, ",b.jsx(ey,{children:"Yukpomnang"})," est une plateforme de connexion directe entre ",b.jsx("span",{className:"text-yellow-600 font-medium",children:"les besoins exprimés"})," et ",b.jsx("span",{className:"text-orange-600 font-medium",children:"les solutions concrètes"})," : services, opportunités, accompagnement."]}),b.jsxs("p",{className:"leading-relaxed text-gray-800 dark:text-gray-200 text-justify",children:["Grâce à son infrastructure multilingue, ",b.jsx(ey,{})," comprend et transmet les besoins dans plusieurs langues parlées sur le continent africain :",b.jsxs("span",{className:"text-blue-600 font-medium",children:[" ","fulfuldé, lingala, ewé, swahili, wolof, baoulé, mooré, bambara, haoussa, sango"]}),", mais aussi dans les langues internationales comme le français, l’anglais, l’arabe ou le portugais."]}),b.jsxs("p",{className:"leading-relaxed text-gray-800 dark:text-gray-200 text-justify",children:["Que vous vous exprimiez à l’oral ou à l’écrit, même dans votre langue maternelle, ",b.jsx(ey,{})," vous comprend et vous répond. La plateforme est conçue pour être accessible même aux personnes ",b.jsx("span",{className:"text-pink-600 font-medium",children:"aveugles, analphabètes ou en situation de handicap"}),"."]}),b.jsxs("p",{className:"leading-relaxed text-gray-800 dark:text-gray-200 text-justify",children:["Que vous soyez ",b.jsx("span",{className:"text-red-600 font-semibold",children:"citoyen, entrepreneur, diaspora ou acteur public"}),",",b.jsx(ey,{children:"Yukpomnang"})," vous accompagne à chaque étape : recherche, recommandation, mise en relation. C’est un réseau de confiance, enraciné dans la culture et tourné vers l’avenir."]}),b.jsxs("p",{className:"text-center text-lg font-semibold",children:["🌍 ",b.jsx(ey,{})," — une oreille pour chacun, une réponse pour tous."]})]})})}),dN=({children:e,className:t="",as:r="main"})=>b.jsx(r,{className:`w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 overflow-x-hidden ${t}`,children:e}),qze=()=>{const[e,t]=j.useState({nom:"",email:"",message:""}),[r,n]=j.useState(!1),[a,u]=j.useState(!1),f=y=>{t({...e,[y.target.name]:y.target.value})},i=async y=>{y.preventDefault(),u(!0),await new Promise(w=>setTimeout(w,700)),n(!0),t({nom:"",email:"",message:""}),u(!1)};return b.jsx(Ka,{children:b.jsx("section",{className:"min-h-screen bg-gradient-to-br from-yellow-50 via-white to-pink-50 dark:from-gray-900 dark:to-gray-950 py-20",children:b.jsxs(dN,{className:"max-w-2xl",children:[b.jsxs("div",{className:"text-center mb-10",children:[b.jsx("h1",{className:"text-3xl md:text-4xl font-extrabold text-gray-800 dark:text-white flex justify-center items-center gap-2",children:"📬 Contactez-nous"}),b.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm mt-2",children:"Une question ? Une collaboration ? Écrivez-nous simplement ici."})]}),b.jsxs("form",{onSubmit:i,className:"bg-white dark:bg-gray-900 shadow-xl rounded-2xl p-8 mx-auto space-y-6 w-full max-w-2xl",children:[b.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[b.jsx("input",{name:"nom",placeholder:"Votre nom",value:e.nom,onChange:f,required:!0,className:"flex-1 px-4 py-3 rounded-xl border focus:ring-2 focus:ring-yellow-400 outline-none dark:bg-gray-800 dark:border-gray-700"}),b.jsx("input",{type:"email",name:"email",placeholder:"Votre email",value:e.email,onChange:f,required:!0,className:"flex-1 px-4 py-3 rounded-xl border focus:ring-2 focus:ring-yellow-400 outline-none dark:bg-gray-800 dark:border-gray-700"})]}),b.jsx("textarea",{name:"message",placeholder:"Votre message...",value:e.message,onChange:f,required:!0,rows:5,className:"w-full px-4 py-3 rounded-xl border focus:ring-2 focus:ring-yellow-400 outline-none dark:bg-gray-800 dark:border-gray-700"}),b.jsx("div",{className:"flex justify-center",children:b.jsxs("button",{type:"submit",disabled:a,className:"flex items-center justify-center gap-2 bg-yellow-500 hover:bg-yellow-600 text-white font-medium py-3 px-8 rounded-full transition-all shadow",children:[b.jsx($E,{size:18}),a?"Envoi...":"Envoyer"]})}),r&&b.jsx("p",{className:"text-green-600 text-sm mt-4 text-center animate-pulse",children:"✅ Message envoyé avec succès !"})]})]})})})},Gze=()=>({plan:void 0,isFree:!1,isPro:!1,isEnterprise:!1}),Xk=()=>b.jsx("span",{className:"bg-gradient-to-r from-yellow-500 via-orange-500 to-red-500 bg-clip-text text-transparent font-bold",children:"Yukpo"}),Hze=()=>{const{user:e}=Rs(),{plan:t}=Gze(),r=Mo(),[n,a]=j.useState([]);j.useEffect(()=>{setTimeout(()=>{a([{id:1,nom:"Yukpo Immobilier",description:"Publier des biens professionnels",plan:"free"},{id:2,nom:"Yukpo Transport",description:"Réserver billets ou hôtels partenaires",plan:"pro"}])},500)},[]);const u=i=>{const y=["free","pro","enterprise"];return e&&y.indexOf(t)>=y.indexOf(i.plan||"free")},f=i=>{r(`/services/${i}`)};return b.jsx(Ka,{children:b.jsxs("section",{className:"py-16 px-4 font-sans text-center bg-gradient-to-br from-yellow-50 via-white to-red-50",children:[b.jsxs("h1",{className:"text-4xl font-bold text-gray-900 dark:text-white mb-12",children:["Comment ",b.jsx(Xk,{})," peut vous aider ?"]}),b.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 mb-16 max-w-4xl mx-auto",children:[b.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow-md p-6 rounded-lg hover:shadow-lg transition",children:[b.jsx("h3",{className:"text-lg font-bold mb-2",children:"🎯 Trouver un service"}),b.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Exprimez un besoin, ",b.jsx(Xk,{})," vous connecte automatiquement."]}),b.jsx("button",{onClick:()=>r($n.MATCH),className:"mt-4 text-primary underline text-sm",children:"Lancer une recherche"})]}),b.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow-md p-6 rounded-lg hover:shadow-lg transition",children:[b.jsx("h3",{className:"text-lg font-bold mb-2",children:"⚙️ Créer un service"}),b.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Service assisté personnalisé en quelques clics."}),b.jsx("button",{onClick:()=>r($n.SERVICE_CREATE),className:"mt-4 text-primary underline text-sm",children:"Créer maintenant"})]})]}),b.jsx("h2",{className:"text-2xl font-bold mb-6",children:"📦 Services disponibles"}),b.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-6xl mx-auto",children:n.map(i=>{var y;return u(i)&&b.jsxs("div",{onClick:()=>f(i.id),className:"cursor-pointer border p-5 rounded-lg hover:shadow-lg bg-white dark:bg-gray-800",children:[b.jsx("h3",{className:"text-lg font-bold",children:i.nom}),b.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:i.description}),b.jsx("span",{className:"text-xs mt-2 inline-block bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-300 px-2 py-1 rounded",children:(y=i.plan)==null?void 0:y.toUpperCase()})]},i.id)})}),b.jsxs("div",{className:"mt-16 flex flex-wrap gap-4 justify-center text-sm",children:[b.jsx("a",{href:$n.PLANS,className:"px-4 py-2 bg-yellow-400 text-black rounded hover:bg-yellow-500 transition",children:"Voir les formules"}),b.jsxs("a",{href:$n.CONTACT,className:"px-4 py-2 bg-gray-100 border text-gray-800 rounded hover:bg-gray-200 transition",children:["Contacter l'équipe ",b.jsx(Xk,{})]})]})]})})},vee=({role:e,anyOf:t,allOf:r,not:n,plan:a,children:u,fallback:f=null})=>{const{user:i}=Rs(),y=i||null;if(!y)return b.jsx(b.Fragment,{children:f});const w=[y.role],T=y.plan;return a&&T!==a?b.jsx(b.Fragment,{children:f}):e&&!w.includes(e)?b.jsx(b.Fragment,{children:f}):t&&!t.some(A=>w.includes(A))?b.jsx(b.Fragment,{children:f}):r&&!r.every(A=>w.includes(A))?b.jsx(b.Fragment,{children:f}):n&&w.includes(n)?b.jsx(b.Fragment,{children:f}):b.jsx(b.Fragment,{children:u})},Wze=()=>{const{user:e,isLoading:t}=Rs(),[r,n]=j.useState(!1),[a,u]=j.useState(!0),f=async()=>{var i;console.log("[useUserServices] checkUserServices appelé");try{const y=localStorage.getItem("token");if(console.log("[useUserServices] Token présent:",!!y),!y){console.log("[useUserServices] Pas de token, hasServices = false"),n(!1),u(!1);return}console.log("[useUserServices] Appel API /api/prestataire/services...");const w=await Wn.get("/api/prestataire/services",{headers:{Authorization:`Bearer ${y}`},timeout:5e3});console.log("[useUserServices] Réponse API:",w.status,"Services count:",((i=w.data)==null?void 0:i.length)||0);const T=w.data&&w.data.length>0;console.log("[useUserServices] hasServices =",T),n(T)}catch(y){console.error("[useUserServices] Erreur lors de la vérification des services:",y),n(!1)}finally{u(!1)}};return j.useEffect(()=>{if(console.log("[useUserServices] useEffect - user:",!!e,"isLoading:",t),!e||t){console.log("[useUserServices] Pas d'utilisateur ou en cours de chargement, hasServices = false"),n(!1),u(!1);return}console.log("[useUserServices] Utilisateur connecté, vérification des services..."),f()},[e,t]),j.useEffect(()=>{const i=()=>{console.log("[useUserServices] Service créé, mise à jour de l'état..."),f()},y=()=>{console.log("[useUserServices] Service supprimé, mise à jour de l'état..."),f()};return window.addEventListener("service_created",i),window.addEventListener("service_deleted",y),()=>{window.removeEventListener("service_created",i),window.removeEventListener("service_deleted",y)}},[e]),console.log("[useUserServices] Return - hasServices:",r,"loading:",a),{hasServices:r,loading:a,refreshServices:f}},Zze=()=>{const{user:e}=Rs(),{hasServices:t,loading:r}=Wze();return console.log("[Dashboard] Debug - user:",!!e,"loading:",r,"hasServices:",t),console.log("[Dashboard] Condition check:",e&&!r&&t),b.jsxs(dN,{children:[e&&!r&&b.jsx("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{className:"flex items-center space-x-2",children:[b.jsx(x4,{className:"w-5 h-5 text-blue-600"}),b.jsx("span",{className:"text-blue-800 font-medium",children:"Gestion de vos services"})]}),b.jsxs(Bo,{to:$n.MES_SERVICES,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[b.jsx(x4,{className:"w-4 h-4"}),b.jsx("span",{children:"Mes Services"})]})]})}),!1,b.jsx("h1",{className:"text-3xl font-bold mb-6",children:"📊 Tableau de bord Yukpomnang"}),b.jsx("ul",{className:"space-y-2",children:b.jsx(vee,{plan:"enterprise",children:b.jsx("li",{children:b.jsx(Bo,{to:$n.DASHBOARD,className:"text-blue-600 underline",children:"Accès Yukpomnang Premium"})})})}),b.jsxs("div",{className:"mt-6 flex flex-wrap gap-4 justify-center",children:[b.jsx(Bo,{to:$n.SERVICES,className:"px-4 py-2 bg-blue-100 text-blue-800 rounded-xl hover:bg-blue-200 transition",children:"Découvrir d'autres services"}),b.jsx(Bo,{to:$n.PLANS,className:"px-4 py-2 bg-green-100 text-green-800 rounded-xl hover:bg-green-200 transition",children:"Voir les formules"}),b.jsx(Bo,{to:$n.CONTACT,className:"px-4 py-2 bg-gray-100 text-gray-800 rounded-xl hover:bg-gray-200 transition",children:"Contacter l'équipe Yukpomnang"})]})]})},Xze=()=>{const{user:e,login:t}=Rs(),[r,n]=j.useState({name:"",email:"",photo:""});j.useEffect(()=>{e&&n({name:e.name||"",email:e.email||"",photo:e.photo||e.picture||""})},[e]);const a=i=>{n({...r,[i.target.name]:i.target.value})},u=i=>{i.preventDefault(),t({...e,...r}),alert("✅ Profil mis à jour localement.")},f=()=>{alert("🔐 Redirection vers changement de mot de passe (à implémenter).")};return e?b.jsx(vee,{role:"user",plan:"pro",children:b.jsxs(dN,{className:"py-10",children:[b.jsx("h1",{className:"text-2xl font-bold mb-6",children:"👤 Mon Profil"}),b.jsxs("form",{onSubmit:u,className:"flex flex-col gap-4 max-w-xl mx-auto",children:[b.jsxs("label",{className:"flex flex-col",children:["Nom complet",b.jsx("input",{type:"text",name:"name",value:r.name,onChange:a,className:"border p-2 rounded"})]}),b.jsxs("label",{className:"flex flex-col",children:["Adresse email",b.jsx("input",{type:"email",name:"email",value:r.email,onChange:a,className:"border p-2 rounded"})]}),b.jsxs("label",{className:"flex flex-col",children:["URL photo de profil",b.jsx("input",{type:"text",name:"photo",value:r.photo,onChange:a,className:"border p-2 rounded"})]}),b.jsxs("div",{className:"flex gap-4",children:[b.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"💾 Enregistrer"}),b.jsx("button",{type:"button",onClick:f,className:"bg-gray-200 text-gray-800 px-4 py-2 rounded hover:bg-gray-300",children:"🔐 Changer mon mot de passe"})]})]}),b.jsxs("div",{className:"mt-10 flex flex-wrap gap-4 justify-center text-sm",children:[b.jsx("a",{href:$n.SERVICES,className:"text-blue-600 hover:underline",children:"Découvrir d'autres services"}),b.jsx("a",{href:$n.PLANS,className:"text-blue-600 hover:underline",children:"Voir les formules"}),b.jsxs("a",{href:$n.CONTACT,className:"text-blue-600 hover:underline",children:["Contacter l’équipe"," ",b.jsx("span",{className:"bg-gradient-to-r from-yellow-500 via-orange-500 to-red-500 bg-clip-text text-transparent font-semibold",children:"Yukpo"})]})]})]})}):b.jsx("p",{className:"p-4 text-center text-red-600",children:"Vous devez être connecté pour voir cette page."})},Kze=()=>{const{serviceId:e}=IR(),t=Mo(),{user:r}=Rs(),{toast:n}=Oy(),[a,u]=j.useState(null),[f,i]=j.useState(!0),[y,w]=j.useState(!1),[T,A]=j.useState("description");j.useEffect(()=>{e&&k()},[e]);const k=async()=>{try{i(!0);const V=await fetch(`/api/services/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(V.ok){const H=await V.json();u(H.service)}else n({title:"Erreur",description:"Service non trouvé",type:"error"}),t("/")}catch(V){console.error("Erreur lors du chargement du service:",V),n({title:"Erreur",description:"Erreur de connexion",type:"error"})}finally{i(!1)}},F=()=>{if(!r){n({title:"Connexion requise",description:"Veuillez vous connecter pour contacter le prestataire",type:"error"}),t("/login",{state:{from:`/service/${e}`}});return}w(!0)},D=async()=>{if(!r){n({title:"Connexion requise",description:"Veuillez vous connecter pour ajouter aux favoris",type:"error"});return}if(a)try{(await fetch(`/api/services/${a.id}/favori`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}})).ok&&(u(H=>H?{...H,favori:!H.favori}:null),n({title:"Succès",description:"Favori mis à jour",type:"success"}))}catch{n({title:"Erreur",description:"Impossible de mettre à jour le favori",type:"error"})}},O=()=>{if(!a)return;const V=`${window.location.origin}/service/${a.id}`;navigator.share?navigator.share({title:a.titre,text:a.description,url:V}):(navigator.clipboard.writeText(V),n({title:"Lien copié",description:"Le lien du service a été copié",type:"success"}))},N=V=>Array.from({length:5},(H,Z)=>b.jsx(uS,{className:`w-4 h-4 ${Z<Math.floor(V)?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},Z));return f?b.jsx("div",{className:"container mx-auto px-4 py-8",children:b.jsx("div",{className:"flex items-center justify-center h-64",children:b.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})})}):a?b.jsxs("div",{className:"container mx-auto px-4 py-8",children:[b.jsxs("div",{className:"mb-6",children:[b.jsxs(cr,{variant:"ghost",onClick:()=>t(-1),className:"mb-4",children:[b.jsx(BE,{className:"w-4 h-4 mr-2"}),"Retour"]}),b.jsxs("div",{className:"flex justify-between items-start",children:[b.jsxs("div",{children:[b.jsx("h1",{className:"text-3xl font-bold mb-2",children:a.titre}),b.jsxs("div",{className:"flex items-center gap-4 text-gray-600 mb-4",children:[b.jsxs("div",{className:"flex items-center gap-1",children:[b.jsx(ou,{className:"w-4 h-4"}),a.localisation]}),b.jsxs("div",{className:"flex items-center gap-1",children:[b.jsx(jx,{className:"w-4 h-4"}),a.vues," vues"]}),b.jsxs("div",{className:"flex items-center gap-1",children:[b.jsx(tZ,{className:"w-4 h-4"}),a.likes," j'aime"]})]})]}),b.jsxs("div",{className:"flex gap-2",children:[b.jsx(cr,{variant:"ghost",onClick:D,className:a.favori?"text-red-500":"text-gray-400",children:b.jsx(cS,{className:`w-5 h-5 ${a.favori?"fill-current":""}`})}),b.jsx(cr,{variant:"ghost",onClick:O,children:b.jsx(Kv,{className:"w-5 h-5"})})]})]})]}),b.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[b.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[b.jsx("div",{className:"border-b",children:b.jsx("nav",{className:"flex space-x-8",children:[{id:"description",label:"Description",icon:KW},{id:"avis",label:"Avis",icon:uS},{id:"prestataire",label:"Prestataire",icon:xO}].map(V=>b.jsxs("button",{onClick:()=>A(V.id),className:`flex items-center gap-2 py-2 px-1 border-b-2 font-medium text-sm transition-colors ${T===V.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[b.jsx(V.icon,{className:"w-4 h-4"}),V.label]},V.id))})}),b.jsxs("div",{className:"min-h-64",children:[T==="description"&&b.jsxs("div",{className:"space-y-4",children:[b.jsx("p",{className:"text-gray-700 leading-relaxed",children:a.description}),b.jsxs("div",{children:[b.jsx("h3",{className:"font-semibold mb-2",children:"Compétences"}),b.jsx("div",{className:"flex flex-wrap gap-2",children:a.competences.map((V,H)=>b.jsx(Ax,{variant:"secondary",children:V},H))})]}),b.jsxs("div",{children:[b.jsx("h3",{className:"font-semibold mb-2",children:"Disponibilité"}),b.jsx("div",{className:"flex flex-wrap gap-2",children:a.disponibilite.map((V,H)=>b.jsx(Ax,{variant:"outline",children:V},H))})]})]}),T==="avis"&&b.jsx("div",{className:"space-y-4",children:a.avis.length>0?a.avis.map(V=>b.jsx(nu,{children:b.jsx(iu,{className:"p-4",children:b.jsxs("div",{className:"flex items-start gap-3",children:[b.jsxs(e_,{className:"w-10 h-10",children:[b.jsx(Ux,{src:V.utilisateur.avatar}),b.jsx(t_,{children:V.utilisateur.nom.charAt(0).toUpperCase()})]}),b.jsxs("div",{className:"flex-1",children:[b.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[b.jsx("span",{className:"font-medium",children:V.utilisateur.nom}),b.jsx("div",{className:"flex",children:N(V.note)})]}),b.jsx("p",{className:"text-gray-700 mb-2",children:V.commentaire}),b.jsx("span",{className:"text-xs text-gray-500",children:new Date(V.date).toLocaleDateString("fr-FR")})]})]})})},V.id)):b.jsx("div",{className:"text-center py-8 text-gray-500",children:"Aucun avis pour le moment"})}),T==="prestataire"&&b.jsx("div",{className:"space-y-4",children:b.jsx(nu,{children:b.jsxs(iu,{className:"p-6",children:[b.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[b.jsxs(e_,{className:"w-16 h-16",children:[b.jsx(Ux,{src:a.prestataire.avatar}),b.jsx(t_,{children:a.prestataire.nom.charAt(0).toUpperCase()})]}),b.jsxs("div",{children:[b.jsx("h3",{className:"text-xl font-semibold",children:a.prestataire.nom}),b.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[N(a.prestataire.note),b.jsxs("span",{className:"text-sm text-gray-600",children:["(",a.prestataire.nombre_avis," avis)"]})]}),b.jsxs("div",{className:"flex items-center gap-1",children:[b.jsx("div",{className:`w-2 h-2 rounded-full ${a.prestataire.statut==="online"?"bg-green-500":a.prestataire.statut==="away"?"bg-yellow-500":"bg-gray-400"}`}),b.jsx("span",{className:"text-sm text-gray-600 capitalize",children:a.prestataire.statut})]})]})]}),a.prestataire.description&&b.jsx("p",{className:"text-gray-700 mb-4",children:a.prestataire.description}),b.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[b.jsxs("div",{children:[b.jsx("h4",{className:"font-semibold mb-2",children:"Expérience"}),b.jsxs("p",{className:"text-gray-600",children:[a.prestataire.experience," an",a.prestataire.experience>1?"s":""]})]}),b.jsxs("div",{children:[b.jsx("h4",{className:"font-semibold mb-2",children:"Compétences"}),b.jsx("div",{className:"flex flex-wrap gap-1",children:a.prestataire.competences.map((V,H)=>b.jsx(Ax,{variant:"outline",className:"text-xs",children:V},H))})]})]})]})})})]})]}),b.jsxs("div",{className:"space-y-6",children:[b.jsx(nu,{children:b.jsxs(iu,{className:"p-6",children:[b.jsxs("div",{className:"text-center mb-6",children:[b.jsxs("div",{className:"text-3xl font-bold text-blue-600 mb-1",children:[a.prix," ",a.devise]}),b.jsx("p",{className:"text-gray-600",children:"Prix du service"})]}),b.jsxs("div",{className:"space-y-3",children:[b.jsxs(cr,{onClick:F,className:"w-full",children:[b.jsx(xy,{className:"w-4 h-4 mr-2"}),"Contacter le prestataire"]}),b.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[b.jsx(cr,{variant:"outline",size:"sm",onClick:F,disabled:!a.prestataire.telephone,children:b.jsx(jb,{className:"w-4 h-4"})}),b.jsx(cr,{variant:"outline",size:"sm",onClick:F,children:b.jsx(qm,{className:"w-4 h-4"})}),b.jsx(cr,{variant:"outline",size:"sm",onClick:F,children:b.jsx($E,{className:"w-4 h-4"})})]})]})]})}),b.jsxs(nu,{children:[b.jsx(Dj,{children:b.jsx(Nj,{className:"text-lg",children:"Informations"})}),b.jsxs(iu,{className:"space-y-3",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsx("span",{className:"text-gray-600",children:"Localisation"}),b.jsx("span",{className:"font-medium",children:a.localisation})]}),b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsx("span",{className:"text-gray-600",children:"Expérience"}),b.jsxs("span",{className:"font-medium",children:[a.experience," an",a.experience>1?"s":""]})]}),b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsx("span",{className:"text-gray-600",children:"Créé le"}),b.jsx("span",{className:"font-medium",children:new Date(a.date_creation).toLocaleDateString("fr-FR")})]})]})]})]})]}),a&&b.jsx(yee,{service:{id:parseInt(a.id),data:{titre_service:a.titre,description:a.description,telephone:a.prestataire.telephone,email:a.prestataire.email,gps_fixe:a.localisation},is_active:!0,created_at:a.date_creation,user_id:parseInt(a.prestataire.id)},prestataires:new Map,user:r,onClose:()=>w(!1)})]}):b.jsx("div",{className:"container mx-auto px-4 py-8",children:b.jsx(nu,{children:b.jsxs(iu,{className:"p-8 text-center",children:[b.jsx(gx,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),b.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Service non trouvé"}),b.jsx("p",{className:"text-gray-600 mb-4",children:"Le service que vous recherchez n'existe pas ou a été supprimé."}),b.jsx(cr,{onClick:()=>t("/"),children:"Retour à l'accueil"})]})})})},Yze=()=>{const[e]=Bie(),t=e.get("service"),r=e.get("user"),[n,a]=j.useState(!1),[u,f]=j.useState(!1),[i,y]=j.useState(!1),[w,T]=j.useState(!1),A=j.useRef(null),k=j.useRef(null),F=j.useRef(null),D=j.useRef(null),{toast:O}=Oy();j.useEffect(()=>(N(),()=>{V()}),[]);const N=async()=>{try{const Y=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});F.current=Y,A.current&&(A.current.srcObject=Y);const ie=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]});D.current=ie,Y.getTracks().forEach(ge=>{ie.addTrack(ge,Y)}),ie.onicecandidate=ge=>{ge.candidate&&console.log("Candidat ICE:",ge.candidate)},ie.ontrack=ge=>{k.current&&ge.streams[0]&&(k.current.srcObject=ge.streams[0],a(!0))};const ce=await ie.createOffer();await ie.setLocalDescription(ce),console.log("Offre créée:",ce),O({title:"Appel vidéo initialisé",description:"En attente de connexion avec le prestataire...",type:"default"})}catch(Y){console.error("Erreur initialisation appel:",Y),O({title:"Erreur",description:"Impossible d'initialiser l'appel vidéo",type:"error"})}},V=()=>{F.current&&F.current.getTracks().forEach(Y=>Y.stop()),D.current&&D.current.close()},H=()=>{if(F.current){const Y=F.current.getAudioTracks()[0];Y&&(Y.enabled=!Y.enabled,f(!Y.enabled))}},Z=()=>{if(F.current){const Y=F.current.getVideoTracks()[0];Y&&(Y.enabled=!Y.enabled,y(!Y.enabled))}},J=()=>{if(F.current&&remoteStreamRef.current){const Y=new MediaStream([...F.current.getTracks(),...remoteStreamRef.current.getTracks()]),ie=new MediaRecorder(Y),ce=[];ie.ondataavailable=ge=>{ge.data.size>0&&ce.push(ge.data)},ie.onstop=()=>{const ge=new Blob(ce,{type:"video/webm"}),be=URL.createObjectURL(ge),xe=document.createElement("a");xe.href=be,xe.download=`appel-video-${Date.now()}.webm`,xe.click(),URL.revokeObjectURL(be)},ie.start(),T(!0),setTimeout(()=>{ie.stop(),T(!1)},3e4)}},G=()=>{V(),window.close()};return b.jsx("div",{className:"min-h-screen bg-gray-900 text-white p-4",children:b.jsxs("div",{className:"max-w-6xl mx-auto",children:[b.jsxs("div",{className:"flex justify-between items-center mb-6",children:[b.jsxs("div",{children:[b.jsx("h1",{className:"text-2xl font-bold",children:"Appel vidéo"}),b.jsxs("p",{className:"text-gray-400",children:["Service: ",t," | Utilisateur: ",r]})]}),b.jsx("div",{className:"flex items-center gap-2",children:b.jsx("span",{className:`px-3 py-1 rounded-full text-sm ${n?"bg-green-600":"bg-yellow-600"}`,children:n?"Connecté":"En attente..."})})]}),b.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[b.jsxs("div",{className:"relative",children:[b.jsx("h3",{className:"text-sm font-medium mb-2",children:"Vous"}),b.jsx("video",{ref:A,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-64 bg-gray-800 rounded-lg object-cover"}),u&&b.jsx("div",{className:"absolute top-2 right-2 bg-red-600 rounded-full p-1",children:b.jsx(b4,{className:"w-4 h-4"})}),i&&b.jsx("div",{className:"absolute top-2 left-2 bg-red-600 rounded-full p-1",children:b.jsx(T4,{className:"w-4 h-4"})})]}),b.jsxs("div",{className:"relative",children:[b.jsx("h3",{className:"text-sm font-medium mb-2",children:"Prestataire"}),b.jsx("video",{ref:k,autoPlay:!0,playsInline:!0,className:"w-full h-64 bg-gray-800 rounded-lg object-cover"}),!n&&b.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-800 rounded-lg",children:b.jsxs("div",{className:"text-center",children:[b.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-2"}),b.jsx("p",{className:"text-gray-400",children:"En attente de connexion..."})]})})]})]}),b.jsxs("div",{className:"flex justify-center items-center gap-4",children:[b.jsx(cr,{onClick:H,className:`rounded-full p-4 ${u?"bg-red-600 hover:bg-red-700":"bg-gray-700 hover:bg-gray-600"}`,title:u?"Activer le micro":"Désactiver le micro",children:u?b.jsx(b4,{className:"w-6 h-6"}):b.jsx(Rm,{className:"w-6 h-6"})}),b.jsx(cr,{onClick:Z,className:`rounded-full p-4 ${i?"bg-red-600 hover:bg-red-700":"bg-gray-700 hover:bg-gray-600"}`,title:i?"Activer la caméra":"Désactiver la caméra",children:i?b.jsx(T4,{className:"w-6 h-6"}):b.jsx(qm,{className:"w-6 h-6"})}),b.jsx(cr,{onClick:J,disabled:w,className:`rounded-full p-4 ${w?"bg-red-600":"bg-gray-700 hover:bg-gray-600"}`,title:w?"Enregistrement en cours...":"Démarrer l'enregistrement",children:b.jsx("div",{className:"w-6 h-6",children:w?b.jsx("div",{className:"w-6 h-6 bg-red-600 rounded-full animate-pulse"}):b.jsx("div",{className:"w-6 h-6 bg-white rounded-full"})})}),b.jsx(cr,{onClick:G,className:"bg-red-600 hover:bg-red-700 rounded-full p-4",title:"Terminer l'appel",children:b.jsx(jb,{className:"w-6 h-6 rotate-90"})})]}),b.jsxs("div",{className:"mt-6 text-center text-sm text-gray-400",children:[b.jsx("p",{children:"Appel vidéo sécurisé via WebRTC"}),b.jsx("p",{children:"Votre connexion est chiffrée de bout en bout"})]})]})})};function Jze(){return b.jsx(ghe,{children:b.jsx(bde,{children:b.jsxs(xde,{children:[b.jsx(Die,{children:b.jsxs(Pie,{children:[b.jsx(Is,{path:$n.HOME,element:b.jsx(Jve,{})}),b.jsx(Is,{path:$n.REGISTER,element:b.jsx(Qve,{})}),b.jsx(Is,{path:$n.LOGIN,element:b.jsx(e_e,{})}),b.jsx(Is,{path:$n.CONFIRMATION,element:b.jsx(r_e,{})}),b.jsx(Is,{path:$n.ABOUT,element:b.jsx(Uze,{})}),b.jsx(Is,{path:$n.CONTACT,element:b.jsx(qze,{})}),b.jsx(Is,{path:$n.SERVICES,element:b.jsx(Hze,{})}),b.jsx(Is,{path:$n.SERVICE_CREATE,element:b.jsx(v0e,{})}),b.jsx(Is,{path:$n.CREATION_SMART_SERVICE,element:b.jsx(b0e,{})}),b.jsx(Is,{path:$n.RECHERCHE_BESOIN,element:b.jsx(B0e,{})}),b.jsx(Is,{path:$n.YUKPO_IA_HUB,element:b.jsx($0e,{})}),b.jsx(Is,{path:$n.CHAT_DIALOG,element:b.jsx(G6,{})}),b.jsx(Is,{path:$n.FORMULAIRE_YUKPO_INTELLIGENT,element:b.jsx(cDe,{})}),b.jsx(Is,{path:$n.FORMULAIRE_SERVICE_MODERNE,element:b.jsx(fze,{})}),b.jsx(Is,{path:"/formulaire-pre-rempli/:type",element:b.jsx(D0,{children:b.jsx(V0e,{})})}),b.jsx(Is,{path:$n.MON_SOLDE,element:b.jsx(rje,{})}),b.jsx(Is,{path:$n.RECHARGE_TOKENS,element:b.jsx(wze,{})}),b.jsx(Is,{path:$n.DASHBOARD,element:b.jsx(D0,{children:b.jsx(Zze,{})})}),b.jsx(Is,{path:$n.MES_SERVICES,element:b.jsx(D0,{children:b.jsx(Tze,{})})}),b.jsx(Is,{path:"/dashboard/profil",element:b.jsx(D0,{children:b.jsx(Xze,{})})}),b.jsx(Is,{path:"/resultat-besoin",element:b.jsx(Fze,{})}),b.jsx(Is,{path:"/test-resultat-besoin",element:b.jsx(Bze,{})}),b.jsx(Is,{path:"/test-location-display",element:b.jsx(Vze,{})}),b.jsx(Is,{path:"/service/:serviceId",element:b.jsx(Kze,{})}),b.jsx(Is,{path:"/chat/:prestataireId",element:b.jsx(D0,{children:b.jsx(G6,{})})}),b.jsx(Is,{path:"/video-call",element:b.jsx(Yze,{})}),b.jsx(Is,{path:"*",element:b.jsx(n_e,{})})]})}),b.jsx(dhe,{position:"top-right",toastOptions:{duration:4e3,style:{background:"#363636",color:"#fff"},success:{duration:5e3,iconTheme:{primary:"#4ade80",secondary:"#fff"}},error:{duration:5e3,iconTheme:{primary:"#ef4444",secondary:"#fff"}}}})]})})})}const{slice:Qze,forEach:eFe}=[];function tFe(e){return eFe.call(Qze.call(arguments,1),t=>{if(t)for(const r in t)e[r]===void 0&&(e[r]=t[r])}),e}function rFe(e){return typeof e!="string"?!1:[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(r=>r.test(e))}const eH=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,nFe=function(e,t){const n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{path:"/"},a=encodeURIComponent(t);let u=`${e}=${a}`;if(n.maxAge>0){const f=n.maxAge-0;if(Number.isNaN(f))throw new Error("maxAge should be a Number");u+=`; Max-Age=${Math.floor(f)}`}if(n.domain){if(!eH.test(n.domain))throw new TypeError("option domain is invalid");u+=`; Domain=${n.domain}`}if(n.path){if(!eH.test(n.path))throw new TypeError("option path is invalid");u+=`; Path=${n.path}`}if(n.expires){if(typeof n.expires.toUTCString!="function")throw new TypeError("option expires is invalid");u+=`; Expires=${n.expires.toUTCString()}`}if(n.httpOnly&&(u+="; HttpOnly"),n.secure&&(u+="; Secure"),n.sameSite)switch(typeof n.sameSite=="string"?n.sameSite.toLowerCase():n.sameSite){case!0:u+="; SameSite=Strict";break;case"lax":u+="; SameSite=Lax";break;case"strict":u+="; SameSite=Strict";break;case"none":u+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return n.partitioned&&(u+="; Partitioned"),u},tH={create(e,t,r,n){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};r&&(a.expires=new Date,a.expires.setTime(a.expires.getTime()+r*60*1e3)),n&&(a.domain=n),document.cookie=nFe(e,encodeURIComponent(t),a)},read(e){const t=`${e}=`,r=document.cookie.split(";");for(let n=0;n<r.length;n++){let a=r[n];for(;a.charAt(0)===" ";)a=a.substring(1,a.length);if(a.indexOf(t)===0)return a.substring(t.length,a.length)}return null},remove(e){this.create(e,"",-1)}};var iFe={name:"cookie",lookup(e){let{lookupCookie:t}=e;if(t&&typeof document<"u")return tH.read(t)||void 0},cacheUserLanguage(e,t){let{lookupCookie:r,cookieMinutes:n,cookieDomain:a,cookieOptions:u}=t;r&&typeof document<"u"&&tH.create(r,e,n,a,u)}},sFe={name:"querystring",lookup(e){var n;let{lookupQuerystring:t}=e,r;if(typeof window<"u"){let{search:a}=window.location;!window.location.search&&((n=window.location.hash)==null?void 0:n.indexOf("?"))>-1&&(a=window.location.hash.substring(window.location.hash.indexOf("?")));const f=a.substring(1).split("&");for(let i=0;i<f.length;i++){const y=f[i].indexOf("=");y>0&&f[i].substring(0,y)===t&&(r=f[i].substring(y+1))}}return r}};let Sv=null;const rH=()=>{if(Sv!==null)return Sv;try{if(Sv=typeof window<"u"&&window.localStorage!==null,!Sv)return!1;const e="i18next.translate.boo";window.localStorage.setItem(e,"foo"),window.localStorage.removeItem(e)}catch{Sv=!1}return Sv};var oFe={name:"localStorage",lookup(e){let{lookupLocalStorage:t}=e;if(t&&rH())return window.localStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupLocalStorage:r}=t;r&&rH()&&window.localStorage.setItem(r,e)}};let Ev=null;const nH=()=>{if(Ev!==null)return Ev;try{if(Ev=typeof window<"u"&&window.sessionStorage!==null,!Ev)return!1;const e="i18next.translate.boo";window.sessionStorage.setItem(e,"foo"),window.sessionStorage.removeItem(e)}catch{Ev=!1}return Ev};var aFe={name:"sessionStorage",lookup(e){let{lookupSessionStorage:t}=e;if(t&&nH())return window.sessionStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupSessionStorage:r}=t;r&&nH()&&window.sessionStorage.setItem(r,e)}},lFe={name:"navigator",lookup(e){const t=[];if(typeof navigator<"u"){const{languages:r,userLanguage:n,language:a}=navigator;if(r)for(let u=0;u<r.length;u++)t.push(r[u]);n&&t.push(n),a&&t.push(a)}return t.length>0?t:void 0}},cFe={name:"htmlTag",lookup(e){let{htmlTag:t}=e,r;const n=t||(typeof document<"u"?document.documentElement:null);return n&&typeof n.getAttribute=="function"&&(r=n.getAttribute("lang")),r}},uFe={name:"path",lookup(e){var a;let{lookupFromPathIndex:t}=e;if(typeof window>"u")return;const r=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(r)?(a=r[typeof t=="number"?t:0])==null?void 0:a.replace("/",""):void 0}},dFe={name:"subdomain",lookup(e){var a,u;let{lookupFromSubdomainIndex:t}=e;const r=typeof t=="number"?t+1:1,n=typeof window<"u"&&((u=(a=window.location)==null?void 0:a.hostname)==null?void 0:u.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i));if(n)return n[r]}};let _ee=!1;try{document.cookie,_ee=!0}catch{}const xee=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];_ee||xee.splice(1,1);const hFe=()=>({order:xee,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:e=>e});class bee{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(t,r)}init(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{languageUtils:{}},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=t,this.options=tFe(r,this.options||{},hFe()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=a=>a.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=n,this.addDetector(iFe),this.addDetector(sFe),this.addDetector(oFe),this.addDetector(aFe),this.addDetector(lFe),this.addDetector(cFe),this.addDetector(uFe),this.addDetector(dFe)}addDetector(t){return this.detectors[t.name]=t,this}detect(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.options.order,r=[];return t.forEach(n=>{if(this.detectors[n]){let a=this.detectors[n].lookup(this.options);a&&typeof a=="string"&&(a=[a]),a&&(r=r.concat(a))}}),r=r.filter(n=>n!=null&&!rFe(n)).map(n=>this.options.convertDetectedLanguage(n)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?r:r.length>0?r[0]:null}cacheUserLanguage(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.options.caches;r&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(t)>-1||r.forEach(n=>{this.detectors[n]&&this.detectors[n].cacheUserLanguage(t,this.options)}))}}bee.type="languageDetector";const fFe={title:"L’assistant intelligent qui transforme vos besoins en solutions.",cta:"Explorer les services"},pFe={home:"Accueil",services:"Services",plans:"Abonnement"},mFe={home:fFe,menu:pFe},gFe={title:"The smart assistant that transforms your needs into solutions.",cta:"Explore Services"},yFe={home:"Home",services:"Services",plans:"Plans"},vFe={home:gFe,menu:yFe},_Fe={title:"Janngirde mawɗo moƴƴi ɗum woni sahaa e mum.",cta:"Labo baɗte"},xFe={home:"Aade",services:"Baɗte",plans:"Ñaamde"},bFe={home:_Fe,menu:xFe},wFe={title:"O assistente inteligente que transforma suas necessidades em soluções.",cta:"Explorar serviços"},SFe={home:"Início",services:"Serviços",plans:"Planos"},EFe={home:wFe,menu:SFe},TFe={title:"المساعد الذكي الذي يحول احتياجاتك إلى حلول.",cta:"استكشاف الخدمات"},CFe={home:"الرئيسية",services:"الخدمات",plans:"الخطط"},AFe={home:TFe,menu:CFe};Ya.use(bee).use(wve).init({fallbackLng:"fr",supportedLngs:["fr","en","pt","ar","ff"],resources:{fr:{translation:mFe},en:{translation:vFe},pt:{translation:EFe},ar:{translation:AFe},ff:{translation:bFe}},detection:{order:["localStorage","navigator","htmlTag"],caches:["localStorage"]},interpolation:{escapeValue:!1}});const iH=document.getElementById("root");iH?Dne.createRoot(iH).render(b.jsx(jt.StrictMode,{children:b.jsx(ZQ,{children:b.jsx(mhe,{children:b.jsx(Jze,{})})})})):console.error("❌ Élément #root introuvable !");
